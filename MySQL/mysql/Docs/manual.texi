\input texinfo  @c -*-texinfo-*-
@c Copyright 1997-2004 TcX AB, Detron HB and MySQL Finland AB
@c
@c This manual is NOT distributed under a GPL style license.
@c Use of the manual is subject to the following terms:
@c - Conversion to other formats is allowed, but the actual
@c   content may not be altered or edited in any way.
@c - You may create a printed copy for your own personal use.
@c - For all other uses, such as selling printed copies or
@c   using (parts of) the manual in another publication,
@c   prior written agreement from MySQL AB is required.
@c
@c Please email docs@mysql.com for more information or if
@c you are interested in doing a translation.
@c
@c *********************************************************
@c Note that @node names are used on our web site.
@c So do not change node names without checking
@c Makefile.am and SitePages first.
@c *********************************************************
@c
@c %**start of header

@c there's a better way to do this... i just don't know it yet
@c sed will remove the "@c ifnusphere " to make this valid
@c ifnusphere @set nusphere 1

@setfilename mysql.info
@set language en

@c We want the types in the same index
@syncodeindex tp fn

@c Get version information. This file is generated by the Makefile!!
@include include.texi

@ifclear tex-debug
@c This removes the black squares in the right margin
@finalout
@end ifclear

@c Set background for HTML
@set _body_tags BGCOLOR=silver TEXT=#000000 LINK=#101090 VLINK=#7030B0
@c Set some style elements for the manual in HTML form. 'suggested'
@c natural language colors: aqua, black, blue, fuchsia, gray, green,
@c lime, maroon, navy, olive, purple, red, silver, teal, white, and
@c yellow. From Steeve Buehler <ahr@YogElements.com>
@set _extra_head <style> code {color:purple} tt {color:green} samp {color:navy} pre {color:maroon} </style>

@settitle MySQL Reference Manual for version @value{mysqlversion}.

@c We want single-sided heading format, with chapters on new pages. To
@c get double-sided format change 'on' below to 'odd'
@ifclear nusphere
@setchapternewpage on
@end ifclear

@ifset nusphere
@setchapternewpage odd
@end ifset

@paragraphindent 0

@ifset nusphere
@smallbook
@end ifset

@c %**end of header

@ifinfo
@format
START-INFO-DIR-ENTRY
* mysql: (mysql).               MySQL documentation.
END-INFO-DIR-ENTRY
@end format
@end ifinfo

@titlepage
@sp 10
@center @titlefont{MySQL Reference Manual}
@sp 10
@center Copyright @copyright{} 1997-2004 MySQL AB
@c blank page after title page makes page 1 be a page front.
@c also makes the back of the title page blank.
@page
@end titlepage

@c Short contents, blank page, long contents.
@c until i can figure out the blank page, no short contents.
@c @shortcontents
@c @page
@c @page
@contents

@c This should be added. The HTML conversion also needs a MySQL version
@c number somewhere.

@iftex
@c change this to double if you want formatting for double-sided
@c printing
@headings single

@oddheading @thischapter @| @| @thispage
@evenheading @thispage @| @| MySQL Technical Reference for Version @value{mysqlversion}

@end iftex


@node Top, Introduction, (dir), (dir)

@ifinfo
This is the Reference Manual for the @code{MySQL Database System}.
This version refers to the @value{mysqlversion} version of
@code{MySQL Server} but it is also applicable for any older
version (such as 3.23 and 4.0-production) as changes are always
indicated. There are also references for version 5.0 (development).
@end ifinfo

@menu
* Introduction::                General Information
* Installing::                  Installing MySQL
* Tutorial::                    MySQL Tutorial
* Using MySQL Programs::        Using MySQL Programs
* MySQL Database Administration::  Database Administration
* Replication::                 Replication in MySQL
* MySQL Optimisation::          MySQL Optimization
* Client-Side Scripts::         MySQL Client and Utility Programs
* Reference::                   MySQL Language Reference
* Language Structure::          Language Structure
* Column types::                Column Types
* Functions::                   Functions and Operators
* SQL Syntax::                  SQL Statement Syntax
* Table types::                 MySQL Table Types
* MaxDB::                       Introduction to MaxDB
* Charset::                     National Character Sets and Unicode
* Spatial extensions in MySQL::  Spatial Extensions in MySQL
* Stored Procedures::           Stored Procedures and Functions
* Clients::                     MySQL APIs
* Error-handling::              Error Handling in MySQL
* Extending MySQL::             Extending MySQL
* Problems::                    Problems and Common Errors
* Credits::                     Credits
* News::                        MySQL Change History
* Porting::                     Porting to Other Systems
* Environment variables::       Environment Variables
* Regexp::                      MySQL Regular Expressions
* GPL license::                 GNU General Public License
* Function Index::              SQL command, type and function index
* Concept Index::               Concept Index
@end menu


@node Introduction, Installing, Top, Top
@chapter General Information

@cindex overview
@cindex general information

@c TODO: change this to a Registered symbol

The @code{MySQL} (R) software delivers a very fast, multi-threaded,
multi-user, and robust @code{SQL} (@code{Structured Query Language})
database server.
@code{MySQL Server} is intended for mission-critical, heavy-load
production systems as well as for embedding into mass-deployed software.
@code{MySQL} is a trademark of @code{MySQL AB}.

The @code{MySQL} software is @code{Dual Licensed}. Users can choose to
use the @code{MySQL} software as an @code{Open Source}/@code{Free Software}
product under the terms of the @code{GNU General Public License}
(@uref{http://www.fsf.org/licenses/}) or can purchase a standard
commercial license from @code{MySQL AB}.
@xref{Licensing and Support}.

The @code{MySQL} web site (@uref{http://www.mysql.com/}) provides the
latest information about the @code{MySQL} software.

The following list describes some sections of particular interest in this manual:

@itemize @bullet
@item
For information about the company behind the @code{MySQL Database Server},
see @ref{What is MySQL AB}.

@item
For a discussion about the capabilities of the @code{MySQL Database Server},
see @ref{Features}.

@item
For installation instructions, see @ref{Installing}.

@item
For tips on porting the @code{MySQL Database Software} to new architectures
or operating systems, see @ref{Porting}.

@item
For information about upgrading from a Version 4.0 release, see
@ref{Upgrading-from-4.0}.

@item
For information about upgrading from a Version 3.23 release, see
@ref{Upgrading-from-3.23}.

@item
For information about upgrading from a Version 3.22 release, see
@ref{Upgrading-from-3.22}.

@item
For a tutorial introduction to the @code{MySQL Database Server},
see @ref{Tutorial}.

@item
For examples of @code{SQL} and benchmarking information, see the
benchmarking directory (@file{sql-bench} in the distribution).

@item
For a history of new features and bug fixes, see @ref{News}.

@item
For a list of currently known bugs and misfeatures, see @ref{Bugs}.

@item
For future plans, see @ref{TODO}.

@item
For a list of all the contributors to this project, see @ref{Credits}.
@end itemize

@strong{Important}:

Reports of errors (often called bugs), as well as questions and comments,
should be sent to the general MySQL mailing list.
@xref{Mailing-list}.
@xref{Bug reports}.

The @code{mysqlbug} script should be used to generate bug reports on Unix.
(Windows distributions contain a file @file{mysqlbug.txt} in the base
directory that can be used as a template for a bug report.)

For source distributions, the @code{mysqlbug} script can be found in the
@file{scripts} directory. For binary distributions, @code{mysqlbug}
can be found in the @file{bin} directory (@file{/usr/bin} for the
@code{MySQL-server} RPM package).

If you have found a sensitive security bug in @code{MySQL Server}, please let
us know immediately by sending an email message to @email{security@@mysql.com}.

@cindex errors, reporting
@cindex reporting, errors
@cindex mailing list address
@cindex @code{mysqlbug} script, location


@menu
* Manual-info::                 About This Manual
* What-is::                     Overview of the MySQL Database Management System
* What is MySQL AB::            Overview of MySQL AB
* Licensing and Support::       MySQL Support and Licensing
* Roadmap::                     MySQL Development Roadmap
* TODO::                        MySQL and the Future (The TODO)
* MySQL Information Sources::   MySQL Information Sources
* Compatibility::               MySQL Standards Compliance
@end menu


@node Manual-info, What-is, Introduction, Introduction
@section About This Manual

@cindex online location of manual
@cindex manual, online location

This is the @code{MySQL} reference manual; it documents @code{MySQL}
up to Version @value{mysqlversion}. Functional changes are always
indicated with reference to the version, so this manual is also suitable
if you are using an older version of the @code{MySQL} software
(such as 3.23 or 4.0-production).
There are also references for version 5.0 (development).

Being a reference manual, it does not provide general instruction on
@code{SQL} or relational database concepts. It also will not teach you how to
use your operating system or command line interpreter.

As the @code{MySQL Database Software} is under constant development,
the manual is also updated frequently.
The most recent version of this manual is available at
@uref{http://www.mysql.com/documentation/} in many different formats,
including HTML, PDF, and Windows HLP versions.

@cindex manual, available formats
@cindex Texinfo

The primary document is the Texinfo file.
The HTML version is produced automatically using a modified version of
@code{texi2html}.
The plain text and Info versions are produced with @code{makeinfo}.
The PostScript version is produced using @code{texi2dvi} and @code{dvips}.
The PDF version is produced with @code{pdftex}.

The index can assist you in finding information in the manual. For online use,
you can try the searchable version of the manual available at
@uref{http://www.mysql.com/doc/}.

If you have any suggestions concerning additions or corrections to this
manual, please send them to the documentation team at @email{docs@@mysql.com}.

This manual was initially written by David Axmark and Michael (Monty)
Widenius. It is now maintained by the MySQL Documentation Team,
consisting of Arjen Lentz, Paul DuBois and Stefan Hinz.
For the many other contributors, see @ref{Credits}.

The copyright (2004) to this manual is owned by the Swedish company
@code{MySQL AB}. @xref{Copyright}.

@menu
* Manual conventions::          Conventions Used in This Manual
@end menu

@node Manual conventions,  , Manual-info, Manual-info
@subsection Conventions Used in This Manual

This manual uses certain typographical conventions:

@cindex manual, typographical conventions
@cindex typographical conventions
@cindex conventions, typographical

@table @asis
@item @code{constant}
Constant-width font is used for command names and options; SQL statements;
database, table, and column names; C and Perl code; and environment variables.
Example: ``To see how @code{mysqladmin} works, invoke it with the
@code{--help} option.''

@item @file{filename}
Constant-width font with surrounding quotes is used for filenames and
pathnames.  Example: ``The distribution is installed under the
@file{/usr/local/} directory.''

@item @samp{c}
Constant-width font with surrounding quotes is also used to indicate
character sequences.  Example: ``To specify a wildcard, use the @samp{%}
character.''

@item @emph{italic}
Italic font is used for emphasis, @emph{like this}.

@item @strong{boldface}
Boldface font is used in table headings and to convey
@strong{especially strong emphasis}.
@end table

When commands are shown that are meant to be executed by a particular
program, the program is indicated by a prompt shown before the command.  For
example, @code{shell>} indicates a command that you execute from your login
shell, and @code{mysql>} indicates a statement that you execute from the
@code{mysql} client program:

@example
shell> type a shell command here
mysql> type a mysql statement here
@end example

The ``shell'' is your command interpreter. On Unix, this is typically a
program such as @code{sh} or @code{csh}. On Windows, the equivalent is
@code{command.com} or @code{cmd.exe}, typically run in a Windows console.

Note that to enter a command or statement from an example, you do not type
the prompt shown in the example.

Commands to set shell variables are shown using Bourne shell syntax.  If you
are using @code{csh} or @code{tcsh}, you will need to issue commands somewhat
differently.
For example, the sequence to set an environment variable and run a command
looks like this in Bourne shell syntax:

@example
shell> VARNAME=value some_command
@end example

@cindex shell syntax
@cindex command syntax

For @code{csh} or @code{tcsh}, you would execute the sequence like this:

@example
shell> setenv VARNAME value
shell> some_command
@end example

Database, table, and column names must often be substituted into commands.  To
indicate that such substitution is necessary, this manual uses
@code{db_name}, @code{tbl_name}, and @code{col_name}.  For example, you might
see a statement like this:

@example
mysql> SELECT col_name FROM db_name.tbl_name;
@end example

This means that if you were to enter a similar statement, you would supply
your own database, table, and column names, perhaps like this:

@example
mysql> SELECT author_name FROM biblio_db.author_list;
@end example

SQL keywords are not case sensitive and may be written in uppercase or
lowercase.  This manual uses uppercase.

In syntax descriptions, square brackets (@samp{[} and @samp{]}) are used
to indicate optional words or clauses.  For example, in the following
statement, @code{IF EXISTS} is optional:

@example
DROP TABLE [IF EXISTS] tbl_name
@end example

When a syntax element consists of a number of alternatives, the alternatives
are separated by vertical bars (@samp{|}).  When one member from a set of
choices @strong{may} be chosen, the alternatives are listed within square
brackets (@samp{[} and @samp{]}):

@example
TRIM([[BOTH | LEADING | TRAILING] [remstr] FROM] str)
@end example

When one member from a set of choices @strong{must} be chosen, the
alternatives are listed within braces (@samp{@{} and @samp{@}}):

@example
@{DESCRIBE | DESC@} tbl_name @{col_name | wild@}
@end example

An ellipsis (@code{...}) indicates the omission of a section of a statement,
typically to provide a shorter version of more complex syntax. For example,
@code{INSERT ... SELECT} is shorthand for the form of @code{INSERT} statement
that is followed by a @code{SELECT} statement.

An ellipsis can also indicate that the preceding syntax element of a statement
may be repeated. In the following example, multiple @code{reset_option} values
may be given, with each of those after the first preceded by commas:

@example
RESET reset_option [,reset_option] ...
@end example


@node What-is, What is MySQL AB, Manual-info, Introduction
@section Overview of the MySQL Database Management System

@cindex MySQL, defined
@cindex MySQL, introduction

@code{MySQL}, the most popular @code{Open Source} SQL database management
system, is
developed, distributed, and supported by @code{MySQL AB}.  @code{MySQL AB} is a
commercial company, founded by the MySQL developers, that builds its business
by providing services around the @code{MySQL} database management system.
@xref{What is MySQL AB}.

The @code{MySQL} web site (@uref{http://www.mysql.com/})
provides the latest information about @code{MySQL} software and
@code{MySQL AB}.

@table @asis

@c TODO: These item headings are not consistent in tone. Some ask questions,
@c others are statements...

@item @code{MySQL} is a database management system.

A database is a structured collection of data.  It may be anything from a
simple shopping list to a picture gallery or the vast amounts of
information in a corporate network.  To add, access, and process data
stored in a computer database, you need a database management system
such as @code{MySQL} Server.  Since computers are very good at handling large
amounts of data, database management systems play a central role in computing,
as stand-alone utilities or as parts of other applications.

@cindex databases, defined

@item MySQL is a relational database management system.

A relational database stores data in separate tables rather than putting
all the data in one big storeroom.  This adds speed and flexibility.
The @code{SQL} part of ``@code{MySQL}'' stands for ``@code{Structured
Query Language}''. SQL is the most common standardized language used to
access databases and is defined by the ANSI/ISO SQL Standard.(The SQL 
standard has been evolving since 1986 and several versions exist. In this 
manual, ``@code{SQL-92}'' refers to the standard released in 1992,
``@code{SQL-99}'' refers to the standard released in 1999, and
``@code{SQL:2003}'' refers to the next version of the standard.
We use the term ``@code{the SQL standard}'' to 
mean the current version of the SQL Standard at any time.)


@cindex relational databases, defined
@cindex SQL, defined
@item MySQL software is @code{Open Source}.

@code{Open Source} means that it is possible for anyone to use and modify the software.
Anybody can download the @code{MySQL} software from the Internet and use it
without paying anything.  If you wish, you may study the source code
and change it to suit your needs.  The @code{MySQL} software uses the
@code{GPL} (@code{GNU General Public License}),
@uref{http://www.fsf.org/licenses/}, to define what you
may and may not do with the software in different situations.
If you feel uncomfortable with the @code{GPL} or need to embed
@code{MySQL} code into a commercial application, you can buy a
commercially licensed version from us.
@xref{MySQL licenses}.

@cindex @code{Open Source}, defined
@cindex General Public License

@item Why use the MySQL Database Server?

The @code{MySQL Database Server} is very fast, reliable, and easy to use.
If that is what you are looking for, you should give it a try.
@code{MySQL Server} also has a practical set of features developed in
close cooperation with our users.  You can find a performance comparison
of @code{MySQL Server} with other database managers on our benchmark page.
@xref{MySQL Benchmarks}.

@code{MySQL Server} was originally developed to handle large databases
much faster than existing solutions and has been successfully used in
highly demanding production environments for several years.  Though
under constant development, @code{MySQL Server} today offers a rich and
useful set of functions.  Its connectivity, speed, and security make
@code{MySQL Server} highly suited for accessing databases on the Internet.

@item The technical features of MySQL Server

The @code{MySQL Database Software} is a client/server system that consists
of a multi-threaded @code{SQL} server that supports different backends,
several different client programs and libraries, administrative tools,
and a wide range of application programming interfaces (APIs).

We also provide @code{MySQL Server} as a multi-threaded library which you
can link into your application to get a smaller, faster, easier-to-manage
product.

@item There is a large amount of contributed MySQL software available.

It is very likely that you will find that your favorite application or
language already supports the @code{MySQL Database Server}.

@end table

@cindex pronunciation, MySQL
@cindex MySQL, pronunciation
@cindex goals of MySQL
The official way to pronounce @code{MySQL} is ``My Ess Que Ell'' (not
``my sequel''), but we don't mind if you pronounce it as ``my sequel''
or in some other localized way.


@menu
* History::                     History of MySQL
* Features::                    The Main Features of MySQL
* Stability::                   MySQL Stability
* Table size::                  How Big MySQL Tables Can Be
* Year 2000 compliance::        Year 2000 Compliance
@end menu

@node History, Features, What-is, What-is
@subsection History of MySQL

@cindex MySQL history
@cindex history of MySQL
@cindex MySQL name
@cindex My, derivation
@cindex MySQL Dolphin name
@cindex Sakila

We started out with the intention of using @code{mSQL} to connect to our
tables using our own fast low-level (ISAM) routines. However, after some
testing, we came to the conclusion that @code{mSQL} was not fast enough or
flexible enough for our needs.  This resulted in a new SQL interface to our
database but with almost the same API interface as @code{mSQL}.  This API was
designed to allow third-party code that was written for use with @code{mSQL} to
be ported easily for use with @code{MySQL}.

The derivation of the name @code{MySQL} is not clear.  Our base
directory and a large number of our libraries and tools have had the prefix
``my'' for well over 10 years.  However, co-founder Monty Widenius's daughter
is also named My.  Which of the two gave its name to
@code{MySQL} is still a mystery, even for us.

The name of the MySQL Dolphin (our logo) is @code{Sakila}. @code{Sakila} was chosen
by the founders of MySQL AB from a huge list of names suggested by users
in our ``Name the Dolphin'' contest. The winning name was submitted by
Ambrose Twebaze, an open source software developer from Swaziland, Africa.
According to Ambrose, the name Sakila has its roots in SiSwati, the local
language of Swaziland. Sakila is also the name of a town in Arusha,
Tanzania, near Ambrose's country of origin, Uganda.


@node Features, Stability, History, What-is
@subsection The Main Features of MySQL

@cindex main features of MySQL
@cindex features of MySQL

The following list describes some of the important characteristics
of the @code{MySQL Database Software}. @xref{MySQL 4.0 Nutshell}.

@c This list is too technical and should be divided into one feature
@c list comparable to commercial competition and a very technical on
@c with max limits (from crash-me) and so on.
@table @asis
@item Internals and Portability
@itemize @bullet
@item
Written in C and C++.
@item
Tested with a broad range of different compilers.
@item
Works on many different platforms.  @xref{Which OS}.
@item
Uses GNU Automake, Autoconf, and Libtool for portability.
@item
APIs for C, C++, Eiffel, Java, Perl, PHP, Python, Ruby, and Tcl are available.
@xref{Clients}.
@item
Fully multi-threaded using kernel threads.  This means it can easily
use multiple CPUs if they are available.
@item
Provides transactional and non-transactional storage engines.
@item
Uses very fast B-tree disk tables (@code{MyISAM}) with index compression.
@item
Relatively easy to add another storage engine. This is useful if you
want to add an SQL interface to an in-house database.
@item
A very fast thread-based memory allocation system.
@item
Very fast joins using an optimized one-sweep multi-join.
@item
In-memory hash tables which are used as temporary tables.
@item
SQL functions are implemented using a highly optimized class library and
should be as fast as possible.  Usually there is no memory allocation
at all after query initialization.
@item
The @code{MySQL} code is tested with Purify
(a commercial memory leakage detector) as well as with Valgrind,
a @code{GPL} tool (@uref{http://developer.kde.org/~sewardj/}).
@item
The server is available as a separate program for use in a client/server
networked environment.  It is also available as a library that can be
embedded (linked) into standalone applications. Such applications can be
used in isolation or in environments where no network is available.
@end itemize

@item Column Types
@itemize @bullet
@item
Many column types: signed/unsigned integers 1, 2, 3, 4, and 8 bytes
long, @code{FLOAT}, @code{DOUBLE}, @code{CHAR}, @code{VARCHAR},
@code{TEXT}, @code{BLOB}, @code{DATE}, @code{TIME}, @code{DATETIME},
@code{TIMESTAMP}, @code{YEAR}, @code{SET}, @code{ENUM}, and OpenGIS geometry
types.
@xref{Column types}.
@item
Fixed-length and variable-length records.
@end itemize

@item Commands and Functions
@itemize @bullet
@item
Full operator and function support in the @code{SELECT} and @code{WHERE}
clauses of queries.  For example:

@example
mysql> SELECT CONCAT(first_name, ' ', last_name)
    -> FROM tbl_name
    -> WHERE income/dependents > 10000 AND age > 30;
@end example

@item
Full support for SQL @code{GROUP BY} and
@code{ORDER BY} clauses.  Support
for group functions (@code{COUNT()},
@code{COUNT(DISTINCT ...)},
@code{AVG()}, @code{STD()},
@code{SUM()}, @code{MAX()}, @code{MIN()}, and @code{GROUP_CONCAT()}).
@item
Support for @code{LEFT OUTER JOIN} and @code{RIGHT OUTER JOIN} with both standard
SQL and ODBC syntax.
@item
Support for aliases on tables and columns as required by SQL-92.
@item
@code{DELETE}, @code{INSERT}, @code{REPLACE}, and @code{UPDATE} return
the number of rows that were changed (affected).  It is possible to return
the number of rows matched instead by setting a flag when connecting to the
server.
@item
The @code{MySQL}-specific @code{SHOW} command can be used to retrieve
information about databases, tables, and indexes.  The @code{EXPLAIN} command
can be used to determine how the optimizer resolves a query.
@item
Function names do not clash with table or column names.  For example,
@code{ABS} is a valid column name.  The only restriction is that for a
function call, no spaces are allowed between the function name and the
@samp{(} that follows it.  @xref{Reserved words}.
@item
You can mix tables from different databases in the same query (as of
Version 3.22).
@end itemize

@item Security
@itemize @bullet
@item
A privilege and password system that is very flexible and secure, and
allows host-based verification.  Passwords are secure because all
password traffic is encrypted when you connect to a server.
@end itemize

@item Scalability and Limits
@itemize @bullet
@item
Handles large databases.  We use @code{MySQL Server} with databases that 
contain 50 million records. We also know of users that
use @code{MySQL Server} with 60,000 tables and about 5,000,000,000 rows.
@item
Up to 32 indexes per table are allowed.  Each index may consist of 1 to 16
columns or parts of columns.  The maximum index width is 500 bytes
(this may be changed when compiling @code{MySQL Server}).
An index may use a prefix of a @code{CHAR} or @code{VARCHAR} column.
@end itemize

@item Connectivity
@itemize @bullet
@item
Clients may connect to the @code{MySQL} server using TCP/IP sockets
on any platform.  On Windows systems in the NT family (NT, 2000,
or XP), clients may connect using named pipes. On Unix systems,
clients may connect using Unix domain socket files.
@item
The Connector/ODBC interface provides @code{MySQL} support for client programs
that use ODBC (Open-DataBase-Connectivity) connections.  For example,
you can use MS Access to connect to your @code{MySQL} server.  Clients may
be run on Windows or Unix.  Connector/ODBC source is available.  All ODBC
2.5 functions are supported, as are many others.
@xref{ODBC}.
@item
The Connector/JDBC interface provides @code{MySQL} support for Java client
programs that use JDBC connections.  Clients may be run on Windows or Unix.
Connector/JDBC source is available.
@xref{Java}.
@end itemize

@item Localization
@itemize @bullet
@item
The server can provide error messages to clients in many languages.
@xref{Languages}.
@item
Full support for several different character sets, including
ISO-8859-1 (Latin1), german, big5, ujis, and more.  For example,
the Scandinavian characters @samp{@^a}, @samp{@"a} and @samp{@"o} are
allowed in table and column names.
Unicode support is available as of @code{MySQL} 4.1.
@item
All data is saved in the chosen character set.  All comparisons for normal
string columns are case-insensitive.
@item
Sorting is done according to the chosen character set (the Swedish
way by default).  It is possible to change this when the @code{MySQL}
server is started.  To see an example of very advanced sorting, look
at the Czech sorting code.  @code{MySQL Server} supports many different
character sets that can be specified at compile and runtime.
@end itemize

@item Clients and Tools
@itemize @bullet
@item
The MySQL server has built-in support for SQL statements to check,
optimize, and repair tables.  These statements are available from the
command line through the @code{mysqlcheck} client. MySQL also includes
@code{myisamchk}, a very fast command-line utility for performing these
operations on @code{MyISAM} tables.
@xref{MySQL Database Administration}.
@item
All @code{MySQL} programs can be invoked with the @code{--help} or @code{-?}
options to obtain online assistance.
@end itemize

@end table


@node Stability, Table size, Features, What-is
@subsection MySQL Stability

@cindex stability

This section addresses the questions ``@emph{How stable is MySQL Server?}''
and ``@emph{Can I depend on MySQL Server in this project?}''
We will try to clarify these issues and answer some important
questions that concern many potential users. The information in this
section is based on data gathered from the mailing list, which is
very active in identifying problems as well as reporting types of use.

The original code stems back to the early 1980s. It provides a stable code
base, and the ISAM table format used by the original storage engine
remains backward-compatible.
At TcX, the predecessor of @code{MySQL AB}, @code{MySQL} code has worked
in projects since mid-1996, without any problems.
When the @code{MySQL Database Software} initially was released to a wider public,
our new users quickly found some pieces of ``untested code''. Each new release
since then has had fewer portability problems (even though each new release
has also had many new features).

Each release of the @code{MySQL Server} has been usable. Problems have occurred
only when users try code from the ``gray zones.''  Naturally, new users
don't know what the gray zones are; this section therefore attempts to
document those areas that are currently known.
The descriptions mostly deal with Version 3.23 and 4.0 of @code{MySQL Server}.
All known and reported bugs are fixed in the latest version, with the
exception of those listed in the bugs section, which
are design-related.  @xref{Bugs}.

The @code{MySQL Server} design is multi-layered with independent modules.
Some of the newer modules are listed here with an indication of how
well-tested each of them is:

@cindex modules, list of

@table @strong
@item Replication --- Gamma
Large groups of servers using replication are in production use, with
good results. Work on enhanced replication features is continuing
in @code{MySQL} 5.x.

@item @code{InnoDB} tables --- Stable (in 3.23 from 3.23.49)
The @code{InnoDB} transactional storage engine has been declared
stable in the @code{MySQL} 3.23 tree, starting from version 3.23.49.
@code{InnoDB} is being used in large, heavy-load production systems.

@item @code{BDB} tables --- Gamma
The @code{Berkeley DB} code is very stable, but we are still improving
the @code{BDB} transactional storage engine interface in
@code{MySQL Server}, so it will take some time before this is as well
tested as the other table types.

@item Full-text searches --- Beta
Full-text searching works but is not yet widely used.
Important enhancements have been implemented in @code{MySQL} 4.0.

@item @code{Connector/ODBC 3.51} (uses ODBC SDK 3.51) --- Stable
In wide production use. Some issues brought up appear to be
application-related and independent of the ODBC driver or underlying
database server.

@item Automatic recovery of @code{MyISAM} tables --- Gamma
This status applies only to the new code in the @code{MyISAM} storage
engine that checks if the table was closed properly on open and
executes an automatic check/repair of the table if it wasn't.

@item Bulk-insert --- Alpha
New feature in @code{MyISAM} tables in @code{MySQL} 4.0 for faster
insert of many rows.

@item Locking --- Gamma
This is very system-dependent.  On some systems there are big
problems using standard operating system locking (@code{fcntl()}).
In these cases, you should run @code{mysqld} with the
@code{--skip-external-locking} flag.  Problems are known to occur
on some Linux systems, and on SunOS when using NFS-mounted filesystems.

@end table

Paying customers receive high-quality support directly from MySQL AB.
MySQL AB also provides the MySQL mailing list as a community resource
where anyone may ask questions.

Bugs are usually fixed right away with a patch. For serious bugs, there
is almost always a new release.


@node Table size, Year 2000 compliance, Stability, What-is
@subsection How Big MySQL Tables Can Be

@c TODO: move to MyISAM storage engine section, replace with
@c more general "limits" section.

@cindex tables, maximum size
@cindex size of tables
@cindex operating systems, file-size limits
@cindex limits, file-size
@cindex files, size limits

@code{MySQL} Version 3.22 had a 4 GB (4 gigabyte) limit on table size. With the
@code{MyISAM} storage engine in @code{MySQL} Version 3.23, the maximum table
size was increased to 8 million terabytes (2 ^ 63 bytes). With this larger
allowed table size, the maximum effective table size for @code{MySQL}
databases now normally is determined by operating system constraints
on file sizes, not by MySQL internal limits.

The @code{InnoDB} storage engine maintains @code{InnoDB} tables within a
tablespace that can be created from several files. This allows a
table to exceed the maximum individual file size. The tablespace can include
raw disk partitions, which allows extremely large tables. The maximum
tablespace size is 64 TB.

The following table lists some examples of operating system file-size
limits:

@multitable @columnfractions .30 .50
@item @strong{Operating System} @tab @strong{File-Size Limit}
@item Linux-Intel 32-bit        @tab 2 GB, much more when using LFS
@item Linux-Alpha               @tab 8 TB (?)
@item Solaris 2.5.1             @tab 2 GB (4GB possible with patch)
@item Solaris 2.6               @tab 4 GB (can be changed with flag)
@item Solaris 2.7 Intel         @tab 4 GB
@item Solaris 2.7 UltraSPARC    @tab 512 GB
@end multitable

On Linux 2.2, you can get @code{MyISAM} tables larger than 2 GB in size by
using the LFS patch for the ext2 filesystem. On Linux 2.4, patches also
exist for ReiserFS to get support for big files. Most current Linux
distributions are based on kernel 2.4 and already include all the required
Large File Support (LFS) patches. However, the maximum available file size
still depends on several factors, one of them being the file system used to
store MySQL tables.

For a very detailed overview about LFS in Linux, have a look at Andreas
Jaeger's ``Large File Support in Linux'' page at
@url{http://www.suse.de/~aj/linux_lfs.html}.

By default, @code{MySQL} creates @code{MyISAM} tables with an internal
structure that allows a maximum size of about 4 GB.  You can
check the maximum table size for a table with the @code{SHOW TABLE STATUS}
command or with the @code{myisamchk -dv table_name}.
@xref{SHOW,  , @code{SHOW}}.

If you need a @code{MyISQM} table that will be larger than 4 GB in size (and your
operating system supports large files), the @code{CREATE TABLE} statement
allows @code{AVG_ROW_LENGTH} and @code{MAX_ROWS} options.
@xref{CREATE TABLE,  , @code{CREATE TABLE}}.
You can also change these options with @code{ALTER TABLE} after the table has
been created, to increase the table's maximum allowable size.
@xref{ALTER TABLE,  , @code{ALTER TABLE}}.

Other ways to work around file-size limits for @code{MyISAM} tables are as
follows:

@itemize @bullet
@item
If your large table is read-only, you can use @code{myisampack} to
compress it.  @code{myisampack} usually compresses a table by at
least 50%, so you can have, in effect, much bigger tables.
@code{myisampack} also can merge multiple tables into a single table.
@xref{myisampack, , @code{myisampack}}.

@item
Another way to get around the operating system file limit for @code{MyISAM}
datafiles is by using the @code{RAID} options.
@xref{CREATE TABLE,  , @code{CREATE TABLE}}.

@item
@code{MySQL} includes a @code{MERGE} library that allows
you to handle a collection of @code{MyISAM} tables that have identical
structure as a single @code{MERGE} table.
@xref{MERGE, , @code{MERGE} tables}.

@end itemize


@node Year 2000 compliance,  , Table size, What-is
@subsection Year 2000 Compliance

@cindex Year 2000 compliance
@cindex compliance, Y2K
@cindex date functions, Y2K compliance

The @code{MySQL Server} itself has no problems with Year 2000 (Y2K)
compliance:

@itemize @bullet
@item
@code{MySQL Server} uses Unix time functions that handle dates into the year
@code{2037} for @code{TIMESTAMP} values. For @code{DATE} and @code{DATETIME}
values, dates through the year @code{9999} are accepted.

@item
All @code{MySQL} date functions are implemented in one source file,
@file{sql/time.cc}, and are coded very carefully to be year 2000-safe.

@item
In @code{MySQL} Version 3.22 and later, the @code{YEAR} column type
can store years @code{0} and @code{1901} to @code{2155} in one byte and
display them using two or four digits.
All 2-digit years are considered to be in the range
@code{1970} to @code{2069}, which means that if you store @code{01} in a
@code{YEAR} column, @code{MySQL Server} treats it as @code{2001}.
@end itemize

The following simple demonstration illustrates that @code{MySQL Server}
doesn't have any problems with dates until after the year 2030:

@example
mysql> DROP TABLE IF EXISTS y2k;
Query OK, 0 rows affected (0.01 sec)

mysql> CREATE TABLE y2k (date DATE,
    ->                   date_time DATETIME,
    ->                   time_stamp TIMESTAMP);
Query OK, 0 rows affected (0.00 sec)

mysql> INSERT INTO y2k VALUES
    -> ('1998-12-31','1998-12-31 23:59:59',19981231235959),
    -> ('1999-01-01','1999-01-01 00:00:00',19990101000000),
    -> ('1999-09-09','1999-09-09 23:59:59',19990909235959),
    -> ('2000-01-01','2000-01-01 00:00:00',20000101000000),
    -> ('2000-02-28','2000-02-28 00:00:00',20000228000000),
    -> ('2000-02-29','2000-02-29 00:00:00',20000229000000),
    -> ('2000-03-01','2000-03-01 00:00:00',20000301000000),
    -> ('2000-12-31','2000-12-31 23:59:59',20001231235959),
    -> ('2001-01-01','2001-01-01 00:00:00',20010101000000),
    -> ('2004-12-31','2004-12-31 23:59:59',20041231235959),
    -> ('2005-01-01','2005-01-01 00:00:00',20050101000000),
    -> ('2030-01-01','2030-01-01 00:00:00',20300101000000),
    -> ('2050-01-01','2050-01-01 00:00:00',20500101000000);
Query OK, 13 rows affected (0.01 sec)
Records: 13  Duplicates: 0  Warnings: 0

mysql> SELECT * FROM y2k;
+------------+---------------------+----------------+
| date       | date_time           | time_stamp     |
+------------+---------------------+----------------+
| 1998-12-31 | 1998-12-31 23:59:59 | 19981231235959 |
| 1999-01-01 | 1999-01-01 00:00:00 | 19990101000000 |
| 1999-09-09 | 1999-09-09 23:59:59 | 19990909235959 |
| 2000-01-01 | 2000-01-01 00:00:00 | 20000101000000 |
| 2000-02-28 | 2000-02-28 00:00:00 | 20000228000000 |
| 2000-02-29 | 2000-02-29 00:00:00 | 20000229000000 |
| 2000-03-01 | 2000-03-01 00:00:00 | 20000301000000 |
| 2000-12-31 | 2000-12-31 23:59:59 | 20001231235959 |
| 2001-01-01 | 2001-01-01 00:00:00 | 20010101000000 |
| 2004-12-31 | 2004-12-31 23:59:59 | 20041231235959 |
| 2005-01-01 | 2005-01-01 00:00:00 | 20050101000000 |
| 2030-01-01 | 2030-01-01 00:00:00 | 20300101000000 |
| 2050-01-01 | 2050-01-01 00:00:00 | 00000000000000 |
+------------+---------------------+----------------+
13 rows in set (0.00 sec)

@end example

The final @code{TIMESTAMP} column value is zero because the final
year (@code{2050}) exceeds the @code{TIMESTAMP} maximum.  The
@code{TIMESTAMP} datatype, which is used to store the current time,
supports values that range from @code{19700101000000} to
@code{20300101000000} on 32-bit machines (signed value).  On 64-bit
machines, @code{TIMESTAMP} handles values up to @code{2106} (unsigned
value).

The example also shows that the @code{DATE} and @code{DATETIME} datatypes have
no problems with the dates used. They handle dates through the year
@code{9999}.

Although @code{MySQL Server} itself is Y2K-safe, you may run into
problems if you use it with applications that are not Y2K-safe.
For example, many old applications store or manipulate years using
2-digit values (which are ambiguous) rather than 4-digit values.
This problem may be compounded by applications that use
values such as @code{00} or @code{99} as ``missing'' value indicators.
Unfortunately, these problems may be difficult to fix because different
applications may be written by different programmers, each of whom may
use a different set of conventions and date-handling functions.

Thus, even though @code{MySQL Server} has no Y2K problems, it is
the application's responsibility to provide unambiguous input.
See @ref{Y2K issues} for @code{MySQL Server}'s rules for dealing
with ambiguous date input data that contains 2-digit year values.



@node What is MySQL AB, Licensing and Support, What-is, Introduction
@section Overview of MySQL AB

@cindex MySQL AB, defined

@code{MySQL AB} is the company of the @code{MySQL} founders and main
developers. @code{MySQL AB} was originally established in Sweden by
David Axmark, Allan Larsson, and Michael ``Monty'' Widenius.

The developers of the @code{MySQL} server are all employed by the company.
We are a virtual organization with people in a dozen countries around
the world. We communicate extensively over the Internet every day with one another 
and with our users, supporters, and partners.

We are dedicated to developing the @code{MySQL} database software and
promoting it to new users. @code{MySQL AB} owns the copyright to the
@code{MySQL} source code, the @code{MySQL} logo and trademark, and this
manual. @xref{What-is}.

@menu
* MySQL AB business model and services::  The Business Model and Services of MySQL AB
* Contact information::         Contact Information
@end menu

The @code{MySQL} core values show our dedication to @code{MySQL} and
@code{Open Source}.

We want the @code{MySQL Database Software} to be:
@itemize @bullet
@item
The best and the most widely used database in the world
@item
Available to, and affordable by all
@item
Easy to use
@item
Continuously improving while remaining fast and safe
@item
Fun to use and improve
@item
Free from bugs
@end itemize

@code{MySQL AB} and the people at @code{MySQL AB}:
@itemize @bullet
@item
Promote @code{Open Source} philosophy and support the
@code{Open Source} community
@item
Aim to be good citizens
@item
Prefer partners that share our values and mind-set
@item
Answer email and provide support
@item
Are a virtual company, networking with others
@item
Work against software patents
@end itemize

The @code{MySQL} web site (@uref{http://www.mysql.com/})
provides the latest information about @code{MySQL} and @code{MySQL AB}.

By the way, the ``AB'' part of the company name is the
acronym for the Swedish ``aktiebolag'', or ``stock company.''
It translates to ``MySQL, Inc.'' In fact, MySQL Inc. and MySQL GmbH
are examples of MySQL AB subsidiaries. They are located in the US and Germany,
respectively. 


@node MySQL AB business model and services, Contact information, What is MySQL AB, What is MySQL AB
@subsection The Business Model and Services of MySQL AB

One of the most common questions we encounter is:
``@emph{How can you make a living from something you give away for free?}''
This is how:

@itemize @bullet
@item
@code{MySQL AB} makes money on support, services, commercial licenses,
and royalties.
@item
We use these revenues to fund product development
and to expand the @code{MySQL} business.
@end itemize


@menu
* Business Services Support::   Support
* Business Services Training::  Training and Certification
* Business Services Consulting::  Consulting
* Business Services Commercial licenses::  Commercial Licenses
* Business Services Partnering::  Partnering
@end menu

The company has been profitable since its inception. In October 2001,
we accepted venture financing from leading Scandinavian investors and
a handful of business angels. This investment is used to solidify our
business model and build a basis for sustainable growth.


@node Business Services Support, Business Services Training, MySQL AB business model and services, MySQL AB business model and services
@subsubsection Support
@code{MySQL AB} is run and owned by the founders and main developers of
the @code{MySQL} database. The developers are committed to providing support
to customers and other users in order to stay in touch with their needs
and problems. All our support is provided by qualified developers. Really
tricky questions are answered by Michael @code{Monty} Widenius, principal
author of the @code{MySQL Server}.
@xref{Support}.

For more information and ordering support at various levels, see
@uref{http://www.mysql.com/support/} or contact our sales staff at
@email{sales@@mysql.com}.


@node Business Services Training, Business Services Consulting, Business Services Support, MySQL AB business model and services
@subsubsection Training and Certification
@cindex training
@cindex MySQL training
@cindex certification
@cindex MySQL certification
@code{MySQL AB} delivers @code{MySQL} and related training worldwide.
We offer both open courses and in-house courses tailored to the
specific needs of your company. @code{MySQL Training} is also available
through our partners, the @code{Authorized MySQL Training Centers}.

Our training material uses the same example databases used in our
documentation and our sample applications, and is always updated
to reflect the latest @code{MySQL} version. Our trainers are backed by
the development team to guarantee the quality of the training and the
continuous development of the course material. This also ensures
that no questions raised during the courses remain unanswered.

Attending our training courses will enable you to achieve your @code{MySQL} 
application goals. You will also:
@itemize @bullet
@item
Save time.
@item
Improve the performance of your applications.
@item
Reduce or eliminate the need for additional hardware, decreasing cost.
@item
Enhance security.
@item
Increase customers' and co-workers' satisfaction.
@item
Prepare yourself for @code{MySQL Certification}.
@end itemize

If you are interested in our training as a potential participant or
as a training partner, please visit the training section at
@uref{http://www.mysql.com/training/} or contact us at:
@email{training@@mysql.com}.

For details about the @code{MySQL Certification Program}, please see
@uref{http://www.mysql.com/certification/}.


@node Business Services Consulting, Business Services Commercial licenses, Business Services Training, MySQL AB business model and services
@subsubsection Consulting
@cindex consulting
@cindex MySQL consulting
@code{MySQL AB} and its @code{Authorized Partners} offer consulting
services to users of @code{MySQL Server} and to those who embed
@code{MySQL Server} in their own software, all over the world.

Our consultants can help you design and tune your databases, construct
efficient queries, tune your platform for optimal performance, resolve
migration issues, set up replication, build robust transactional
applications, and more.
We also help customers embed @code{MySQL Server} in their products and
applications for large-scale deployment.

Our consultants work in close collaboration with our development team,
which ensures the technical quality of our professional services.
Consulting assignments range from 2-day power-start sessions to
projects that span weeks and months. Our expertise not only covers
@code{MySQL Server}---it also extends into programming and scripting
languages such as PHP, Perl, and more.

If you are interested in our consulting services or want to become a
consulting partner, please visit the consulting section of our web site
at @uref{http://www.mysql.com/consulting/} or contact our consulting
staff at @email{consulting@@mysql.com}.


@node Business Services Commercial licenses, Business Services Partnering, Business Services Consulting, MySQL AB business model and services
@subsubsection Commercial Licenses
The @code{MySQL} database is released under the
@code{GNU General Public License} (@code{GPL}).
This means that the @code{MySQL} software can be used free of charge
under the @code{GPL}. If you do not want to be bound by the @code{GPL}
terms (such as the requirement that your application must also be @code{GPL}), 
you may purchase a commercial license for the same product
from @code{MySQL AB}; see @uref{http://www.mysql.com/products/pricing.html}.
Since @code{MySQL AB} owns the copyright to the @code{MySQL} source code,
we are able to employ @code{Dual Licensing}, which means that the same
product is available under @code{GPL} and under a commercial
license. This does not in any way affect the @code{Open Source}
commitment of @code{MySQL AB}. For details about when a commercial
license is required, please see @ref{MySQL licenses}.

We also sell commercial licenses of third-party @code{Open Source GPL}
software that adds value to @code{MySQL Server}. A good example is the
@code{InnoDB} transactional storage engine that offers @code{ACID}
support, row-level locking, crash recovery, multi-versioning, foreign
key support, and more. @xref{InnoDB}.


@node Business Services Partnering,  , Business Services Commercial licenses, MySQL AB business model and services
@subsubsection Partnering
@cindex partnering with MySQL AB
@code{MySQL AB} has a worldwide partner program that covers training
courses, consulting and support, publications, plus reselling and
distributing @code{MySQL} and related products. @code{MySQL AB Partners}
get visibility on the @uref{http://www.mysql.com/} web site and the right
to use special versions of the @code{MySQL} trademarks to identify their
products and promote their business.

If you are interested in becoming a @code{MySQL AB Partner}, please email
@email{partner@@mysql.com}.

The word @code{MySQL} and the @code{MySQL} dolphin logo are trademarks of
@code{MySQL AB}. @xref{MySQL AB Logos and Trademarks}.
These trademarks represent a significant value that the @code{MySQL}
founders have built over the years.

The @code{MySQL} web site (@uref{http://www.mysql.com/}) is popular among
developers and users. In December 2003, we served 16 million page views.
Our visitors represent a group that makes purchase decisions and
recommendations for both software and hardware. Twelve percent of our
visitors authorize purchase decisions, and only nine percent are not
involved in purchase decisions at all. More than 65% have made one or
more online business purchases within the last half-year, and 70% plan
to make one in the next few months.


@node Contact information,  , MySQL AB business model and services, What is MySQL AB
@subsection Contact Information

@cindex contact information
@cindex employment, contact information
@cindex licensing, contact information
@cindex employment with MySQL
@cindex jobs at MySQL

The @code{MySQL} web site (@uref{http://www.mysql.com/})
provides the latest information about @code{MySQL} and @code{MySQL AB}.

For press services and inquiries not covered in our News releases
(@uref{http://www.mysql.com/news/}), please send email to
@email{press@@mysql.com}.

If you have a valid support contract with @code{MySQL AB}, you will
get timely, precise answers to your technical questions about the
@code{MySQL} software. For more information, see @ref{Support}.
On our web site, see @uref{http://www.mysql.com/support/}, or send
an email message to @email{sales@@mysql.com}.

For information about @code{MySQL} training, please visit the training
section at @uref{http://www.mysql.com/training/}. If you have
restricted access to the Internet, please contact the @code{MySQL AB}
training staff via email at @email{training@@mysql.com}.
@xref{Business Services Training}.

For information on the @code{MySQL Certification Program}, please see
@uref{http://www.mysql.com/certification/}.
@xref{Business Services Training}.

If you're interested in consulting, please visit the consulting
section of our web site at @uref{http://www.mysql.com/consulting/}. If you have
restricted access to the Internet, please contact the @code{MySQL AB}
consulting staff via email at @email{consulting@@mysql.com}.
@xref{Business Services Consulting}.

Commercial licenses may be purchased online at
@uref{https://order.mysql.com/}. There you will also find information
on how to fax your purchase order to @code{MySQL AB}. More information
about licensing can be found at
@uref{http://www.mysql.com/products/pricing.html}.
If you have
questions regarding licensing or you want a quote for a high-volume
license deal, please fill in the contact form on our web site
(@uref{http://www.mysql.com/}) or send email
to @email{licensing@@mysql.com} (for licensing questions) or to
@email{sales@@mysql.com} (for sales inquiries).
@xref{MySQL licenses}.

If you represent a business that is interested in partnering with
@code{MySQL AB}, please send email to @email{partner@@mysql.com}.
@xref{Business Services Partnering}.

For more information on the @code{MySQL} trademark policy, refer to
@uref{http://www.mysql.com/company/trademark.html} or send email to
@email{trademark@@mysql.com}.
@xref{MySQL AB Logos and Trademarks}.

If you are interested in any of the @code{MySQL AB} jobs listed in our
jobs section (@uref{http://www.mysql.com/company/jobs/}),
please send email to @email{jobs@@mysql.com}.
Please do not send your CV as an attachment, but rather as plain text
at the end of your email message.

For general discussion among our many users, please direct your
attention to the appropriate mailing list.
@xref{Questions}.

Reports of errors (often called bugs), as well as questions and
comments, should be sent to the general MySQL mailing list.
@xref{Mailing-list}.
If you have found a sensitive security bug in @code{MySQL Server}, please let
us know immediately by sending an email message to @email{security@@mysql.com}.
@xref{Bug reports}.

If you have benchmark results that we can publish, please
contact us via email at @email{benchmarks@@mysql.com}.

If you have suggestions concerning additions or corrections to this
manual, please send them to the manual team via email at @email{docs@@mysql.com}.

For questions or comments about the workings or content of the
@code{MySQL} web site (@uref{http://www.mysql.com/}),
please send email to @email{webmaster@@mysql.com}.

@code{MySQL AB} has a privacy policy, which can be read at
@uref{http://www.mysql.com/company/privacy.html}.
For any queries regarding this policy, please send email to
@email{privacy@@mysql.com}.

For all other inquires, please send an email to @email{info@@mysql.com}.


@node Licensing and Support, Roadmap, What is MySQL AB, Introduction
@section MySQL Support and Licensing

@cindex licensing terms
@cindex support terms

This section describes @code{MySQL} support and licensing arrangements.

@menu
* Support::                     Support Offered by MySQL AB
* Copyright::                   Copyrights and Licenses Used by MySQL
* MySQL licenses::              MySQL Licenses
* MySQL AB Logos and Trademarks::  MySQL AB Logos and Trademarks
@end menu


@node Support, Copyright, Licensing and Support, Licensing and Support
@subsection Support Offered by MySQL AB

@cindex support, types
@cindex types of support
@cindex commercial support, types
@cindex costs, support
@cindex licensing costs
@cindex support costs
@cindex prices, support

Technical support from @code{MySQL AB} means individualized answers
to your unique problems direct from the software engineers who code
the @code{MySQL} database engine.

We try to take a broad and inclusive view of technical support. Almost
any problem involving @code{MySQL} software is important to us if it's
important to you.
Typically customers seek help on how to get different commands and
utilities to work, remove performance bottlenecks, restore crashed
systems, understand the impact of operating system or networking issues
on @code{MySQL},
set up best practices for backup and recovery, utilize APIs, and so on.
Our support covers only the @code{MySQL} server and our own utilities,
not third-party products that access the @code{MySQL} server, though we
try to help with these where we can.

Detailed information about our various support options is given at
@uref{http://www.mysql.com/support/}, where support contracts can also be
ordered online. If you have restricted access to the Internet, please contact
our sales staff via email at @email{sales@@mysql.com}.

Technical support is like life insurance. You can live happily
without it for years. However, when your hour arrives, it becomes
critically important, but it's too late to buy it.
If you use @code{MySQL Server} for important applications and encounter
sudden difficulties, it may be too time consuming to figure out all the
answers yourself. You may need immediate access to the most experienced
@code{MySQL} troubleshooters available, those employed by @code{MySQL AB}.


@node Copyright, MySQL licenses, Support, Licensing and Support
@subsection Copyrights and Licenses Used by MySQL

@cindex copyrights
@cindex licenses

@code{MySQL AB} owns the copyright to the @code{MySQL} source code,
the @code{MySQL} logos and trademarks and this manual.
@xref{What is MySQL AB}.
Several different licenses are relevant to the @code{MySQL}
distribution:

@enumerate
@item
All the @code{MySQL}-specific source in the server, the @code{mysqlclient}
library and the client, as well as the @code{GNU} @code{readline} library
is covered by the @code{GNU General Public License}.
@xref{GPL license}.
The text of this license can be found as the file @file{COPYING}
in the distribution.

@item
The @code{GNU} @code{getopt} library is covered by the
@code{GNU Lesser General Public License}.
See @url{http://www.fsf.org/licenses/}.

@item
Some parts of the source (the @code{regexp} library) are covered
by a Berkeley-style copyright.

@item
Older versions of @code{MySQL} (3.22 and earlier) are subject to a
stricter license
(@uref{http://www.mysql.com/products/mypl.html}).
See the documentation of the specific version for information.

@item
The @code{MySQL} reference manual is currently @strong{not} distributed 
under a @code{GPL}-style license. Use of the manual is subject to the 
following terms:
@itemize @bullet
@item
Conversion to other formats is allowed, but the actual content
may not be altered or edited in any way.
@item
You may create a printed copy for your own personal use.
@item
For all other uses, such as selling printed copies or using
(parts of) the manual in another publication, prior written
agreement from @code{MySQL AB} is required.
@end itemize
Please send an email message to @email{docs@@mysql.com} for more information or
if you are interested in doing a translation.
@end enumerate

For information about how the @code{MySQL} licenses work in practice,
please refer to @ref{MySQL licenses}.
Also see @ref{MySQL AB Logos and Trademarks}.


@node MySQL licenses, MySQL AB Logos and Trademarks, Copyright, Licensing and Support
@subsection MySQL Licenses

@cindex licensing policy
@cindex technical support, licensing
@cindex support, licensing
@cindex General Public License, MySQL
@cindex GPL, MySQL
@cindex licensing, examples
@cindex selling products
@cindex products, selling

The @code{MySQL} software is released under the
@code{GNU General Public License} (@code{GPL}),
which is probably the best known @code{Open Source} license.
The formal terms of the @code{GPL} license can be found at
@uref{http://www.fsf.org/licenses/}.
See also @uref{http://www.fsf.org/licenses/gpl-faq.html} and
@uref{http://www.gnu.org/philosophy/enforcing-gpl.html}.

Since the @code{MySQL} software is released under the @code{GPL},
it may often be used for free, but for certain uses you may want
or need to buy commercial licenses from @code{MySQL AB} at
@uref{https://order.mysql.com/}.
See @uref{http://www.mysql.com/products/licensing.html} for
more information.

Older versions of @code{MySQL} (3.22 and earlier) are subject to a
stricter license
(@uref{http://www.mysql.com/products/mypl.html}).
See the documentation of the specific version for information.

Please note that the use of the @code{MySQL} software under commercial
license, @code{GPL}, or the old @code{MySQL} license does not
automatically give you the right to use @code{MySQL AB} trademarks.
@xref{MySQL AB Logos and Trademarks}.


@menu
* Using the MySQL software under a commercial license::  Using the MySQL Software Under a Commercial License
* Using the MySQL software for free under GPL::  Using the MySQL Software for Free Under GPL
@end menu

@node Using the MySQL software under a commercial license, Using the MySQL software for free under GPL, MySQL licenses, MySQL licenses
@subsubsection Using the MySQL Software Under a Commercial License

The @code{GPL} license is contagious in the sense that when a program
is linked to a @code{GPL} program all the source code for all the parts
of the resulting product must also be released under the @code{GPL}.
If you do not follow this @code{GPL} requirement, you break the license 
terms and forfeit your right to use the @code{GPL} program altogether. 
You also risk damages.

You need a commercial license:

@itemize @bullet
@item
When you link a program with any @code{GPL} code from the @code{MySQL}
software and don't want the resulting product to be licensed under @code{GPL}, 
perhaps because you want to build a commercial product or keep the added
non-@code{GPL} code closed source for other reasons. When purchasing
commercial licenses, you are not using the @code{MySQL} software under
@code{GPL} even though it's the same code.

@item
When you distribute a non-@code{GPL} application that @strong{only} works with the
@code{MySQL} software and ship it with the @code{MySQL} software. This type
of solution is considered to be linking even if it's done over a network.

@item
When you distribute copies of the @code{MySQL} software without providing
the source code as required under the @code{GPL} license.

@item
When you want to support the further development of the @code{MySQL}
database even if you don't formally need a commercial license.
Purchasing support directly from @code{MySQL AB} is another good way
of contributing to the development of the @code{MySQL} software, with
immediate advantages for you.
@xref{Support}.
@end itemize

If you require a license, you will need one for each installation of the
@code{MySQL} software. This covers any number of CPUs on a machine, and there
is no artificial limit on the number of clients that connect to the server
in any way.

For commercial licenses, please visit our website at
@uref{http://www.mysql.com/products/licensing.html}.
For support contracts, see @uref{http://www.mysql.com/support/}.
If you have special needs or you have restricted access to the Internet,
please contact our sales staff via email at @email{sales@@mysql.com}.


@node Using the MySQL software for free under GPL,  , Using the MySQL software under a commercial license, MySQL licenses
@subsubsection Using the MySQL Software for Free Under GPL

@cindex licensing, free
@cindex free licensing

You can use the @code{MySQL} software for free under the @code{GPL} if
you adhere to the conditions of the @code{GPL}.
For additional details, including answers to common questions about the @code{GPL},
see the generic FAQ from the Free Software Foundation at
@uref{http://www.fsf.org/licenses/gpl-faq.html}. 
Common uses of the @code{GPL} include:

@itemize @bullet
@item
When you distribute both your own application and the @code{MySQL}
source code under the @code{GPL} with your product.

@item
When you distribute the @code{MySQL} source code bundled with other
programs that are not linked to or dependent on the @code{MySQL} system
for their functionality even if you sell the distribution commercially.
This is called mere aggregation in the @code{GPL} license.

@item
When you are not distributing @strong{any} part of the @code{MySQL}
system, you can use it for free.

@item
@cindex ISP services
@cindex services, ISP
@cindex services, web
@cindex Internet Service Providers
When you are an Internet Service Provider (ISP), offering web hosting
with @code{MySQL} servers for your customers.
We encourage people to use ISPs that have MySQL support,
as this will give them the confidence that their ISP will, in fact, 
have the resources to solve any problems they may experience with 
the @code{MySQL} installation. Even if an ISP does not have
a commercial license for @code{MySQL Server}, their customers 
should at least be given read access to the source of the @code{MySQL}
installation so that the customers can verify that it is correctly patched.

@item
@cindex web server, running
@cindex running a web server
When you use the @code{MySQL} database software in conjunction with a
web server, you do not need a commercial license (so long as it is not
a product you distribute). This is true even if you run a commercial
web server that uses @code{MySQL Server}, because you are not
distributing any part of the @code{MySQL} system. However, in this
case we would like you to purchase @code{MySQL} support because the
@code{MySQL} software is helping your enterprise.
@end itemize

If your use of @code{MySQL} database software does not require a commercial
license, we encourage you to purchase support from @code{MySQL AB} anyway.
This way you contribute toward @code{MySQL} development and also gain
immediate advantages for yourself. @xref{Support}.

If you use the @code{MySQL} database software in a commercial context
such that you profit by its use, we ask that you further the development
of the @code{MySQL} software by purchasing some level of support.  We feel
that if the @code{MySQL} database helps your business, it is reasonable to
ask that you help @code{MySQL AB}.
(Otherwise, if you ask us support questions, you are not only using
for free something into which we've put a lot a work, you're asking
us to provide free support, too.)


@node MySQL AB Logos and Trademarks,  , MySQL licenses, Licensing and Support
@subsection MySQL AB Logos and Trademarks

@cindex logos
@cindex trademarks

Many users of the @code{MySQL} database want to display the
@code{MySQL AB} dolphin logo on their web sites, books, or
boxed products. We welcome and encourage this, although it should be
noted that the word @code{MySQL} and the @code{MySQL} dolphin logo
are trademarks of @code{MySQL AB} and may only be used as stated in
our trademark policy at
@uref{http://www.mysql.com/company/trademark.html}.

@menu
* The Original MySQL logo::     The Original MySQL Logo
* MySQL Logos that may be Used Without Written Permission::  MySQL Logos that may be Used Without Written Permission
* When need MySQL logo permission::  When You Need Written Permission to Use MySQL Logos
* MySQL AB Partnership Logos::  MySQL AB Partnership Logos
* Using MySQL word in presentations::  Using the Word @code{MySQL} in Printed Text or Presentations
* Using MySQL word in company and product names::  Using the Word @code{MySQL} in Company and Product Names
@end menu


@node The Original MySQL logo, MySQL Logos that may be Used Without Written Permission, MySQL AB Logos and Trademarks, MySQL AB Logos and Trademarks
@subsubsection The Original MySQL Logo

@c FIX: picture: MySQL logo

The @code{MySQL} dolphin logo was designed by the Finnish advertising
agency Priority in 2001.  The dolphin was chosen as a suitable symbol
for the @code{MySQL} database management system, which is like a smart,
fast, and lean animal, effortlessly navigating oceans of data. We also
happen to like dolphins.

The original @code{MySQL} logo may only be used by representatives of
@code{MySQL AB} and by those having a written agreement allowing them
to do so.


@node MySQL Logos that may be Used Without Written Permission, When need MySQL logo permission, The Original MySQL logo, MySQL AB Logos and Trademarks
@subsubsection MySQL Logos that may be Used Without Written Permission

@c FIX: pictures: powered by, works with, included - logos

We have designed a set of special @emph{Conditional Use} logos that may be
downloaded from our web site at
@uref{http://www.mysql.com/press/logos.html}
and used on third-party web sites without written permission from
@code{MySQL AB}.
The use of these logos is not entirely unrestricted but, as the name
implies, subject to our trademark policy that is also available on our
web site. You should read through the trademark policy if you plan to
use them. The requirements are basically as follows:

@itemize @bullet
@item
Use the logo you need as displayed on the @uref{http://www.mysql.com/}
site. You may scale it to fit your needs, but may not change colors or design,
or alter the graphics in any way.

@item
Make it evident that you, and not @code{MySQL AB}, are the creator and
owner of the site that displays the @code{MySQL} trademark.

@item
Don't use the trademark in a way that is detrimental to @code{MySQL AB}
or to the value of @code{MySQL AB} trademarks. We reserve the right to
revoke the right to use the @code{MySQL AB} trademark.

@item
If you use the trademark on a web site, make it clickable, leading directly
to @uref{http://www.mysql.com/}.

@item
If you use the @code{MySQL} database under @code{GPL} in an
application, your application must be @code{Open Source} and must
be able to connect to a @code{MySQL} server.
@end itemize

Contact us via email at @email{trademark@@mysql.com} to inquire about special
arrangements to fit your needs.

@node When need MySQL logo permission, MySQL AB Partnership Logos, MySQL Logos that may be Used Without Written Permission, MySQL AB Logos and Trademarks
@subsubsection When You Need Written Permission to Use MySQL Logos

You need written permission from @code{MySQL AB} before using @code{MySQL} 
logos in the following cases:

@itemize @bullet
@item
When displaying any @code{MySQL AB} logo anywhere except on your web site.

@item
When displaying any @code{MySQL AB} logo except the @emph{Conditional Use}
logos mentioned previously on web sites or elsewhere.
@end itemize

Due to legal and commercial reasons we monitor the use of MySQL
trademarks on products, books, and other items. We usually require a fee for
displaying @code{MySQL AB} logos on commercial products, since we think
it is reasonable that some of the revenue is returned to fund further
development of the @code{MySQL} database.


@node MySQL AB Partnership Logos, Using MySQL word in presentations, When need MySQL logo permission, MySQL AB Logos and Trademarks
@subsubsection MySQL AB Partnership Logos

@c FIX: pictures: partnership logos - Bertrand?

@code{MySQL} partnership logos may be used only by companies and persons
having a written partnership agreement with @code{MySQL AB}. Partnerships
include certification as a @code{MySQL} trainer or consultant.
For more information, please see @ref{Business Services Partnering,,Partnering}.


@node Using MySQL word in presentations, Using MySQL word in company and product names, MySQL AB Partnership Logos, MySQL AB Logos and Trademarks
@subsubsection Using the Word @code{MySQL} in Printed Text or Presentations

@code{MySQL AB} welcomes references to the @code{MySQL} database, but
it should be noted that the word @code{MySQL} is a trademark of @code{MySQL AB}.
Because of this, you must append the trademark symbol (@code{TM}) to
the first or most prominent use of the word @code{MySQL} in a text and,
where appropriate, state that @code{MySQL} is a trademark of
@code{MySQL AB}. For more information, please refer to our trademark policy at
@uref{http://www.mysql.com/company/trademark.html}.


@node Using MySQL word in company and product names,  , Using MySQL word in presentations, MySQL AB Logos and Trademarks
@subsubsection Using the Word @code{MySQL} in Company and Product Names

Use of the word @code{MySQL} in product or company names or in Internet
domain names is not allowed without written permission from @code{MySQL AB}.


@node Roadmap, TODO, Licensing and Support, Introduction
@section MySQL Development Roadmap

This section provides a snapshot of the MySQL development roadmap, including
major features implemented or planned for MySQL 4.0, 4.1, 5.0, and 5.1.
The following sections provide information for each release series.

The production release series is MySQL 4.0, which was declared stable
for production use as of Version 4.0.12, released in March 2003. This
means that future 4.0 development will be limited only to making bug
fixes. For the older MySQL 3.23 series, only critical bug fixes will
be made.

Active MySQL development currently is taking place in the MySQL 4.1 and
5.0 release series. This means that new features are being added to MySQL
4.1 and MySQL 5.0. Both 4.1 and 5.0 are available now in alpha status.

Before upgrading from one release series to the next, please see the notes
at @ref{Upgrade}.

Plans for some of the most requested features are summarized in the following
table.

@multitable @columnfractions .30 .60
@item @strong{Feature}                     @tab @strong{MySQL version}
@item Unions                               @tab 4.0
@item Subqueries                           @tab 4.1
@item R-trees                              @tab 4.1 (for @code{MyISAM} tables)
@item Stored procedures                    @tab 5.0
@item Views                                @tab 5.0 or 5.1
@item Cursors                              @tab 5.0
@item Foreign keys                         @tab 5.1 (already implemented in 3.23 for @code{InnoDB})
@item Triggers                             @tab 5.1
@item Full outer join                      @tab 5.1
@item Constraints                          @tab 5.1
@end multitable

@menu
* MySQL 4.0 Nutshell::          MySQL 4.0 in a Nutshell
* MySQL 4.1 Nutshell::          MySQL 4.1 in a Nutshell
* MySQL 5.0 Nutshell::          MySQL 5.0, The Next Development Release
@end menu


@node MySQL 4.0 Nutshell, MySQL 4.1 Nutshell, Roadmap, Roadmap
@subsection MySQL 4.0 in a Nutshell

Long awaited by our users, MySQL Server 4.0 is now available in production
status.

MySQL 4.0 is available for download from @uref{http://www.mysql.com/}
and from our mirrors. MySQL 4.0 has been tested by a large number of users
and is in production use at many large sites.

The major new features of MySQL Server 4.0 are geared toward our existing
business and community users, enhancing the MySQL database software
as the solution for mission-critical, heavy-load database systems.
Other new features target the users of embedded databases.


@menu
* Nutshell 4.0 features::       Features Available in MySQL 4.0
* Nutshell Embedded MySQL::     The Embedded MySQL Server
@end menu


@node Nutshell 4.0 features, Nutshell Embedded MySQL, MySQL 4.0 Nutshell, MySQL 4.0 Nutshell
@subsubsection Features Available in MySQL 4.0

@table @asis
@item Speed enhancements
@itemize @bullet
@item
MySQL 4.0 has a query cache that can give a huge speed boost to
applications with repetitive queries. @xref{Query Cache}.

@item
Version 4.0 further increases the speed of MySQL Server
in a number of areas, such as bulk @code{INSERT} statements, searching on
packed indexes, full-text searching (using @code{FULLTEXT} indexes), and
@code{COUNT(DISTINCT)}.
@end itemize

@item Embedded MySQL Server introduced
@itemize @bullet
@item
The new Embedded Server library can easily be used to create standalone and
embedded applications.  The embedded server provides an alternative to using
MySQL in a client/server environment.
@xref{Nutshell Embedded MySQL}.
@end itemize

@item InnoDB storage engine as standard
@itemize @bullet
@item
The @code{InnoDB} storage engine is now offered as a standard feature of the
@code{MySQL} server. This means full support for ACID transactions, foreign
keys with cascading @code{UPDATE} and @code{DELETE}, and row-level locking
are now standard features.
@xref{InnoDB,  , @code{InnoDB}}.
@end itemize

@item New functionality
@itemize @bullet
@item
The enhanced @code{FULLTEXT} search properties of MySQL Server 4.0 enables
@code{FULLTEXT} indexing of large text masses with both binary
and natural-language searching logic. You can customize minimal word
length and define your own stop word lists in any human language,
enabling a new set of applications to be built with MySQL Server.
@xref{Fulltext Search}.
@end itemize

@item Standards compliance, portability, and migration
@itemize @bullet
@item
Many users will also be happy to learn that MySQL Server now supports the
@code{UNION} statement, a long-awaited standard SQL feature.

@item
MySQL now runs natively on the Novell NetWare 6.0 platform.
@xref{NetWare installation}.

@item
Features to simplify migration from other database systems to MySQL
Server include @code{TRUNCATE TABLE} (as in Oracle).
@c commented out IDENTITY until someone explains what it means
@c and @code{IDENTITY}
@c as a synonym for automatically incremented keys (as in Sybase).
@end itemize

@item Internationalization
@itemize @bullet
@item
Our German, Austrian, and Swiss users will note that @code{MySQL} now
supports a new character set, @code{latin1_de}, which ensures that the 
@emph{German sorting order} sorts words with umlauts in the same order 
as do German telephone books.
@end itemize

@item Usability enhancements
In the process of implementing features for new users, we have not forgotten
requests from our loyal community of existing users.

@itemize @bullet
@item
Most @code{mysqld} parameters (startup options) can now be set without taking
down the server. This is a convenient feature for database administrators
(DBAs).
@xref{SET OPTION,  , @code{SET OPTION}}.

@item
Multiple-table @code{DELETE} and @code{UPDATE} statements have been added..

@item
On Windows, symbolic link handling at the database level is enabled by default.
On Unix, the @code{MyISAM} storage engine now supports symbolic
linking at the table level (and not just the database level as before).

@item
@code{SQL_CALC_FOUND_ROWS} and @code{FOUND_ROWS()} are new functions that make it
possible to find out the number of rows a @code{SELECT} query that includes a
@code{LIMIT} clause would have returned without that clause.
@end itemize

@end table

The news section of this manual includes a more in-depth list of features.
@xref{News-4.0.x}.


@node Nutshell Embedded MySQL,  , Nutshell 4.0 features, MySQL 4.0 Nutshell
@subsubsection The Embedded MySQL Server

The @code{libmysqld} embedded server library makes MySQL Server suitable for
a vastly expanded realm of applications. By using this library, developers can
embed MySQL Server into various applications and electronics devices, where
the end user has no knowledge of there actually being an underlying
database. Embedded MySQL Server is ideal for use behind
the scenes in Internet appliances, public kiosks, turnkey
hardware/software combination units, high performance Internet
servers, self-contained databases distributed on CD-ROM, and so on.

Many users of @code{libmysqld} will benefit from the MySQL
@emph{Dual Licensing}. For those not wishing to be bound by the @code{GPL},
the software is also made available under a commercial license.
The embedded MySQL library uses the same interface as the normal
client library, so it is convenient and easy to use.
@xref{libmysqld,  , @code{libmysqld}}.


@node MySQL 4.1 Nutshell, MySQL 5.0 Nutshell, MySQL 4.0 Nutshell, Roadmap
@subsection MySQL 4.1 in a Nutshell

MySQL Server 4.0 laid the foundation for new features implemented in MySQL
4.1, such as subqueries and Unicode support,
and for the work on stored procedures being done in version 5.0.
These features come at the top of the wish list of many of our customers.

With these additions, critics of the MySQL Database Server have to be
more imaginative than ever in pointing out deficiencies in the MySQL
database management system. Already well-known for its stability,
speed, and ease of use, MySQL Server will be able to fulfill the requirement
checklists of very demanding buyers.


@menu
* Nutshell 4.1 features::       Features Available in MySQL 4.1
* Nutshell Stepwise Rollout::   Stepwise Rollout
* Nutshell Ready for Immediate Use::  Ready for Immediate Development Use
@end menu

@node Nutshell 4.1 features, Nutshell Stepwise Rollout, MySQL 4.1 Nutshell, MySQL 4.1 Nutshell
@subsubsection Features Available in MySQL 4.1

The features listed in this section are implemented in MySQL 4.1. A few other
features are still planned for MySQL 4.1. @xref{TODO MySQL 4.1}.

Most new features being coded are or will be available in MySQL 5.0.
@xref{TODO MySQL 5.0}.

@table @asis
@item Support for subqueries and derived tables
@itemize @bullet
@item
A subquery is a @code{SELECT} statement nested within another statement.
A derived table (an unnamed view) is a subquery in the @code{FROM} clause
of another statement.
@xref{Subqueries}.
@end itemize

@item Speed enhancements
@itemize @bullet
@item
Faster binary client/server protocol with support for prepared statements
and parameter binding.
@xref{C API Prepared statements}.
@item
@code{BTREE} indexing is now supported for @code{HEAP} tables,
significantly improving response time for non-exact searches.
@end itemize

@item New functionality
@itemize @bullet
@item
@code{CREATE TABLE table_name2 LIKE table_name1} allows you to create, with
a single statement, a new table with a structure exactly like that of an
existing table.
@item
The MyISAM storage engine now supports
OpenGIS spatial types for storing geographical data.
@xref{Spatial extensions in MySQL}.
@item
Replication can be done over SSL connections.
@end itemize

@item Standards compliance, portability, and migration
@itemize @bullet
@item
The new client/server protocol adds the ability to pass multiple
warnings to the client, rather than only a single result. This
makes operations such as bulk data loading much easier to track.
@item
@code{SHOW WARNINGS} shows warnings for the last command.
@xref{SHOW WARNINGS,  , @code{SHOW WARNINGS}}.
@end itemize

@item Internationalization
@itemize @bullet
@item
To support applications that require the use of local languages,
the MySQL software now offers extensive
Unicode support through the @code{utf8} and @code{ucs2} character sets.
@item
Character sets can now be defined per column, table, and database.
This allows for a high degree of flexibility in application design,
particularly for multi-language web sites.
@item
For documentation for this improved character set support,
see @ref{Charset}.
@end itemize

@item Usability enhancements
@itemize @bullet
@item
In response to popular demand, we have added a server-based
@code{HELP} command that can be used
to get help information for SQL statements.
The advantage of having this information on the server side is that the
information is always applicable to the particular server version that you
actually are using.
Because this information is available by issuing a SQL statement, any client
can be written to access it.
For example, the @code{help} command of the @code{mysql} command-line client
has been modified to have this capability.
@item
In the new client/server protocol, multiple statements can be issued with
a single call.
@xref{C API multiple queries}.
@item
The new client/server protocol also supports returning multiple result sets.
This might occur as a result of sending multiple statements, for example.
@item
A new @code{INSERT ... ON DUPLICATE KEY UPDATE ...} syntax has been
implemented. This allows you to @code{UPDATE} an existing row if the
@code{INSERT} would have caused a duplicate in a @code{PRIMARY} or
@code{UNIQUE} key (index).
@xref{INSERT,  , @code{INSERT}}.
@item
A new aggregate function, @code{GROUP_CONCAT()}
adds the extremely useful capability of concatenating column values from
grouped rows into a single result string.
@xref{Group by functions and modifiers}.
@end itemize

@end table

The news section of this manual includes a more in-depth list of features.
@xref{News-4.1.x}.


@node Nutshell Stepwise Rollout, Nutshell Ready for Immediate Use, Nutshell 4.1 features, MySQL 4.1 Nutshell
@subsubsection Stepwise Rollout

New features are being added to MySQL 4.1. The alpha version is already
available for download. @xref{Nutshell Ready for Immediate Use}.

The set of features that are being added to version 4.1 is mostly
fixed. Additional development is already ongoing for version 5.0.
MySQL 4.1 will go through the steps of
@emph{Alpha} (during which time new features might still be added/changed),
@emph{Beta} (when we have feature freeze and only bug corrections will be done),
and @emph{Gamma} (indicating that a production release is just weeks ahead).
At the end of this process, MySQL 4.1 will become the new production release.


@node Nutshell Ready for Immediate Use,  , Nutshell Stepwise Rollout, MySQL 4.1 Nutshell
@subsubsection Ready for Immediate Development Use

MySQL 4.1 is currently in the alpha stage, and binaries are available
for download at @uref{http://www.mysql.com/downloads/mysql-4.1.html}.
All binary releases pass our extensive test suite without any errors on
the platforms on which we test.
@xref{News-4.1.x}.

For those wishing to use the most recent development source for MySQL 4.1,
we make our 4.1 BitKeeper repository publicly available.
@xref{Installing source tree}.


@node MySQL 5.0 Nutshell,  , MySQL 4.1 Nutshell, Roadmap
@subsection MySQL 5.0, The Next Development Release

New development for MySQL is focused on the 5.0 release, featuring
Stored Procedures and other new features.
@xref{TODO MySQL 5.0}.

For those wishing to take a look at the bleeding edge of MySQL
development, we make our BitKeeper repository for
MySQL version 5.0 publicly available.
@xref{Installing source tree}.
As of December 2003, binary builds of version 5.0 are also available.


@node TODO, MySQL Information Sources, Roadmap, Introduction
@section MySQL and the Future (The TODO)

@cindex ToDo list for MySQL

@menu
* TODO MySQL 4.1::              New Features Planned for 4.1
* TODO MySQL 5.0::              New Features Planned for 5.0
* TODO MySQL 5.1::              New Features Planned for 5.1
* TODO future::                 New Features Planned for the Near Future
* TODO sometime::               New Features Planned for the Mid-Term Future
* TODO unplanned::              New Features We Don't Plan to Implement
@end menu

This section summarizes the features that we plan to implement in
@code{MySQL Server}. The items are ordered by release series. Within a list,
items are shown in approximately the order they will be done.

@strong{Note:} If you are an enterprise level user with an urgent need
for a particular feature, please contact @email{sales@@mysql.com} to
discuss sponsoring options. Targeted financing by sponsor companies
allows us to allocate additional resources for specific purposes.
One example of a feature sponsored in the past is replication.


@node TODO MySQL 4.1, TODO MySQL 5.0, TODO, TODO
@subsection New Features Planned for 4.1

The features below are not yet implemented in MySQL 4.1, but are planned
for implementation before MySQL 4.1 moves into its beta phase.
For a list what is already done in MySQL 4.1, see @ref{Nutshell 4.1 features}.

@itemize @bullet
@item
Stable OpenSSL support (MySQL 4.0 supports rudimentary, not 100% tested,
support for OpenSSL).
@item
More testing of prepared statements.
@item
More testing of multiple character sets for one table.
@end itemize


@node TODO MySQL 5.0, TODO MySQL 5.1, TODO MySQL 4.1, TODO
@subsection New Features Planned for 5.0

The following features are planned for inclusion into MySQL 5.0.
Some of the features such as stored procedures are complete and are
included in MySQL 5.0 alpha, which is available now.  Others such
as cursors are only partially available. Expect these and other
features to mature and be fully supported in upcoming releases.

Note that because we have many developers that are working on different
projects, there will also be many additional features. There is also a
small chance that some of these features will be added to MySQL 4.1.
For a list what is already done in MySQL 4.1, see @ref{Nutshell 4.1 features}.

For those wishing to take a look at the bleeding edge of MySQL
development, we make our BitKeeper repository for
MySQL version 5.0 publicly available.
@xref{Installing source tree}.
As of December 2003, binary builds of version 5.0 are also available.

@table @asis
@item Stored Procedures
@itemize @bullet
@item
Stored procedures are currently implemented, based on the SQL:2003
standard.
@xref{Stored Procedures}.

We will also implement a framework to hook in external languages,
and (where possible) compatibility with, for example, PL/SQL and T-SQL.
@end itemize

@item New functionality
@itemize @bullet
@item
Elementary cursor support.
@xref{Cursors}.
@item
The ability to specify explicitly for @code{MyISAM} tables that an index
should be created as an @code{RTREE} index.  (In MySQL 4.1, @code{RTREE} indexes
are used internally for geometrical data that use GIS datatypes, but cannot be
created on request.)
@item
Dynamic length rows for @code{HEAP} tables.
@end itemize

@item Standards compliance, portability and migration
@itemize @bullet
@item
Add true @code{VARCHAR} support (column lengths longer than 255, and
no stripping of trailing whitespace).
(There is already support for this in the @code{MyISAM} storage engine,
but it is not yet available at the user level.)
@end itemize

@item Speed enhancements
@itemize @bullet
@item
@code{SHOW COLUMNS FROM table_name} (used by @code{mysql} client to allow
expansions of column names) should not open the table, only the
definition file. This will require less memory and be much faster.
@item
Allow @code{DELETE} on @code{MyISAM} tables to use the record cache.
To do this, we need to update the threads record cache when we update
the @file{.MYD} file.
@item
Better support for @code{MEMORY} (@code{HEAP}) tables:
@itemize @bullet
@item
Dynamic length rows.
@item
Faster row handling (less copying).
@end itemize
@end itemize

@item Usability enhancements
@itemize @bullet
@item
Resolving the issue of @code{RENAME TABLE} on a table used in an active
@code{MERGE} table possibly corrupting the table.
@end itemize

@end table

The news section of this manual includes a more in-depth list of features.
@xref{News-5.0.x}.


@node TODO MySQL 5.1, TODO future, TODO MySQL 5.0, TODO
@subsection New Features Planned for 5.1

@table @asis
@item New functionality
@itemize @bullet
@item
@code{FOREIGN KEY} support for all table types, not just @code{InnoDB}.
@item
Column-level constraints.
@item
Fail-safe replication.
@item
Online backup with very low performance penalty.  The online backup will
make it easy to add a new replication slave without taking down the
master.
@end itemize

@c @item Standards compliance, portability and migration
@c @itemize @bullet
@c @end itemize

@item Speed enhancements
@itemize @bullet
@item
New text based table definition file format (@file{.frm} files) and a
table cache for table definitions.  This will enable us to do faster
queries of table structures and do more efficient foreign key support.
@item
Optimize the @code{BIT} type to take 1 bit. (@code{BIT} now takes 1 byte;
it is treated as a synonym for @code{TINYINT}.)
@end itemize

@c @item Internationalzsation
@c @itemize @bullet
@c @end itemize

@item Usability enhancements
@itemize @bullet
@item
Add options to the client/server protocol to get progress notes
for long running commands.
@item
Implement @code{RENAME DATABASE}. To make this safe for all storage engines,
it should work as follows:
@itemize @bullet
@item
Create the new database.
@item
For every table do a rename of the table to another database, as
we do with the @code{RENAME} command.
@item
Drop the old database.
@end itemize
@item
New internal file interface change.  This will make all file handling much
more general and make it easier to add extensions like RAID.
@end itemize

@end table


@node TODO future, TODO sometime, TODO MySQL 5.1, TODO
@subsection New Features Planned for the Near Future

@table @asis
@item New functionality
@itemize @bullet
@item
Oracle-like @code{CONNECT BY PRIOR ...} to search tree-like (hierarchical)
structures.
@item
Add all missing SQL-92 and ODBC 3.0 types.
@item
Add @code{SUM(DISTINCT)}.
@item
@code{INSERT SQL_CONCURRENT} and @code{mysqld --concurrent-insert} to do
a concurrent insert at the end of a table if the table is read-locked.
@item
Allow variables to be updated in @code{UPDATE} statements. For example:
@code{UPDATE TABLE foo SET @@a=a+b,a=@@a, b=@@a+c}.
@item
Change when user variables are updated so that one can use them with
@code{GROUP BY}, as in the following example:
@code{SELECT id, @@a:=COUNT(*), SUM(sum_col)/@@a FROM table_name GROUP BY id}.
@item
Add an @code{IMAGE} option to @code{LOAD DATA INFILE} to not update
@code{TIMESTAMP} and @code{AUTO_INCREMENT} fields.
@item
Add @code{LOAD DATA INFILE ... UPDATE} syntax that works like this:
@itemize @bullet
@item
For tables with primary keys, if an input record contains a primary key
value, existing rows matching that primary key value are updated from the
remainder of the input columns. However, columns corresponding to columns
that are @strong{missing} from the input record are not touched.
@item
For tables with primary keys, if an input record does not contain the primary
key value or is missing some part of the key, the record is treated as
@code{LOAD DATA INFILE ... REPLACE INTO}.
@end itemize
@item
Make @code{LOAD DATA INFILE} understand syntax like:
@example
LOAD DATA INFILE 'file_name.txt' INTO TABLE tbl_name
     TEXT_FIELDS (text_field1, text_field2, text_field3)
     SET table_field1=CONCAT(text_field1, text_field2),
         table_field3=23
     IGNORE text_field3
@end example
This can be used to skip over extra columns in the text file,
or update columns based on expressions of the read data.
@item
New functions for working with @code{SET} type columns:
@itemize @bullet
@item @code{ADD_TO_SET(value,set)}
@item @code{REMOVE_FROM_SET(value,set)}
@end itemize
@item
If you abort @code{mysql} in the middle of a query, you should open
another connection and kill the old running query.
Alternatively, an attempt should be made to detect this in the server.
@item
Add a storage engine interface for table information so that you can use it as a system
table. This would be a bit slow if you requested information about all tables,
but very flexible.  @code{SHOW INFO FROM tbl_name} for basic table information
should be implemented.
@item
Allow @code{SELECT a FROM table_name1 LEFT JOIN table_name2 USING (a)}; in this
case @code{a} is assumed to come from the @code{table_name1} table.
@item
@code{DELETE} and @code{REPLACE} options to the @code{UPDATE} statement
(this will delete rows when one gets a duplicate key error while updating).
@item
Change the format of @code{DATETIME} to store fractions of seconds.
@item
Make it possible to use the new GNU @code{regexp} library instead of the current
one (the new library should be much faster than the current one).
@end itemize

@item Standards compliance, portability and migration
@itemize @bullet
@item
Don't add automatic @code{DEFAULT} values to columns.  Produce an error for
any @code{INSERT} statement that is missing a value for a column that has no
@code{DEFAULT}.
@item
Add @code{ANY()}, @code{EVERY()}, and @code{SOME()} group functions. In
standard SQL, these work only on boolean columns, but we can extend these to
work on any columns or expressions by treating 0 values as FALSE and non-zero
values as TRUE.
@item
Fix the type of @code{MAX(column)} to be the same as the column type:
@example
mysql> CREATE TABLE t1 (a DATE);
mysql> INSERT INTO t1 VALUES (NOW());
mysql> CREATE TABLE t2 SELECT MAX(a) FROM t1;
mysql> SHOW COLUMNS FROM t2;
@end example
@end itemize

@item Speed enhancements
@itemize @bullet
@item
Don't allow more than a defined number of threads to run @code{MyISAM}
recovery at the same time.
@item
Change @code{INSERT ... SELECT} to optionally use concurrent inserts.
@item
Add an option to periodically flush key pages for tables with delayed
keys if they haven't been used in a while.
@item
Allow join on key parts (optimization issue).
@item
Add a log file analyzer that can parse out information about which tables
are hit most often, how often multiple-table joins are executed, etc.  This
should help users identify areas of table design that could be optimized
to execute much more efficient queries.
@end itemize

@item Internationalization
@itemize @bullet
@end itemize

@item Usability enhancements
@itemize @bullet
@item
Return the original column types when doing
@code{SELECT MIN(column) ... GROUP BY}.
@item
Make it possible to specify @code{long_query_time} with a granularity
in microseconds.
@item
Link the @code{myisampack} code into the server so that it can perform
@code{PACK} or @code{COMPRESS} operations.
@item
Add a temporary key buffer cache during @code{INSERT/DELETE/UPDATE} so that we
can gracefully recover if the index file gets full.
@item
If you perform an @code{ALTER TABLE} on a table that is symlinked to another
disk, create temporary tables on that disk.
@item
Implement a @code{DATE/DATETIME} type that handles time zone information
properly, to make dealing with dates in different time zones easier.
@item
Fix @code{configure} so that one can compile all libraries (like @code{MyISAM})
without threads.
@item
Allow SQL variables as @code{LIMIT} arguments, for example,
@code{LIMIT @@a,@@b}.
@item
Automatic output from @code{mysql} to a web browser.
@item
@code{LOCK DATABASES} (with various options).
@item
Many more variables for @code{SHOW STATUS}.  Records reads and
updates.  Selects on a single table and selects with joins.  Mean number of
tables in select. Number of @code{ORDER BY} and @code{GROUP BY} queries.
@item
@code{mysqladmin copy database new-database}; this requires a @code{COPY}
operation to be added to @code{mysqld}.
@item
Processlist output should indicate the number of queries/threads.
@item
@code{SHOW HOSTS} for printing information about the hostname cache.
@item
Change table names from empty strings to @code{NULL} for calculated columns.
@item
Don't use @code{Item_copy_string} on numerical values to avoid
number->string->number conversion in case of:
@code{SELECT COUNT(*)*(id+0) FROM table_name GROUP BY id}
@item
Change so that @code{ALTER TABLE} doesn't abort clients
that execute @code{INSERT DELAYED}.
@item
Fix so that when columns are referenced in an @code{UPDATE} clause,
they contain the old values from before the update started.
@end itemize

@item New operating systems
@itemize @bullet
@item
Port the MySQL clients to LynxOS.
@end itemize

@end table


@node TODO sometime, TODO unplanned, TODO future, TODO
@subsection New Features Planned for the Mid-Term Future

@itemize @bullet
@item
Implement function: @code{get_changed_tables(timeout,table1,table2,...)}.
@item
Change reading through tables to use memmap when possible. Now only
compressed tables use memmap.
@item
Make the automatic timestamp code nicer.  Add timestamps to the update
log with @code{SET TIMESTAMP=#;}.
@item
Use read/write mutex in some places to get more speed.
@item
Simple views (implemented in stepwise fashion up to full functionality).
@xref{ANSI diff Views}.
@item
Automatically close some tables if a table, temporary table, or temporary file
gets error 23 (too many open files).
@item
Better constant propagation. When an occurrence of @code{col_name=n}
is found in an expression, for some constant @code{n}, replace other
occurrences of @code{col_name} within the expression with @code{n}.
Currently, this is done only for some simple cases.
@item
Change all const expressions with calculated expressions if possible.
@item
Optimize key = expression comparisons. At the moment only key = field or
key = constant comparisons are optimized.
@item
Join some of the copy functions for nicer code.
@item
Change @file{sql_yacc.yy} to an inline parser to reduce its size and get
better error messages.
@item
Change the parser to use only one rule per different number of arguments
in function.
@item
Use of full calculation names in the order part (for ACCESS97).
@item
@code{MINUS}, @code{INTERSECT}, and @code{FULL OUTER JOIN}.
(Currently @code{UNION} [in 4.0] and @code{LEFT|RIGHT OUTER JOIN} are supported.)
@item
Allow @code{SQL_OPTION MAX_SELECT_TIME=#}, for placing a time limit on a query.
@item
Allow updates to be logged to a database.
@item
Enhance @code{LIMIT} to allow retrieval of data from the end of a result set.
@item
Alarm around client connect/read/write functions.
@item
Please note the changes to @code{mysqld_safe}: according to FSSTND (which
Debian tries to follow) PID files should go into @file{/var/run/<progname>.pid}
and log files into @file{/var/log}. It would be nice if you could put the
"DATADIR" in the first declaration of "pidfile" and "log", so the
placement of these files can be changed with a single statement.
@item
Allow a client to request logging.
@item
Allow the @code{LOAD DATA INFILE} statement
to read files that have been compressed with @code{gzip}.
@item
Fix sorting and grouping of @code{BLOB} columns (partly solved now).
@item
Change to use semaphores when counting threads.  One should first implement
a semaphore library for MIT-pthreads.
@item
Add full support for @code{JOIN} with parentheses.
@item
As an alternative to the one-thread-per-connection model, manage a pool
of threads to handle queries.
@item
Allow @code{GET_LOCK()} to obtain more than one lock.  When doing this,
one must also handle the possible deadlocks this change will introduce.
@end itemize


@node TODO unplanned,  , TODO sometime, TODO
@subsection New Features We Don't Plan to Implement

We aim toward full compliance with SQL-92/SQL-99, so there are no features
we plan not to implement.


@node MySQL Information Sources, Compatibility, TODO, Introduction
@section MySQL Information Sources

@menu
* Questions::                   MySQL Mailing Lists
* IRC::                         MySQL Community Support on IRC (Internet Relay Chat)
@end menu

@node Questions, IRC, MySQL Information Sources, MySQL Information Sources
@subsection MySQL Mailing Lists

@cindex reporting, errors
@cindex errors, reporting
@cindex MySQL mailing lists

@menu
* Mailing-list::                The MySQL Mailing Lists
* Asking questions::            Asking Questions or Reporting Bugs
* Bug reports::                 How to Report Bugs or Problems
* Answering questions::         Guidelines for Answering Questions on the Mailing List
@end menu

This section introduces you to the MySQL mailing lists and provides
some guidelines as to how the lists should be used. When you subscribe to a mailing
list, you will receive all postings to the list as email messages. You can 
also to send your own questions and answers to the list.


@node Mailing-list, Asking questions, Questions, Questions
@subsubsection The MySQL Mailing Lists

@cindex mailing lists
@cindex email lists

To subscribe to or unsubscribe from any of the mailing lists described in this
section, visit @uref{http://lists.mysql.com/}.
Please @strong{do not} send messages about
subscribing or unsubscribing to any of the mailing lists, because such
messages are distributed automatically to thousands of other users.

Your local site may have many subscribers to a MySQL mailing list.
If so, the site may have a local mailing list, so that messages sent from
@code{lists.mysql.com} to your site are propagated to the local list.  In such
cases, please contact your system administrator to be added to or dropped
from the local MySQL list.

If you wish to have traffic for a mailing list go to a separate mailbox in
your mail program, set up a filter based on the message headers.  You can
use either the @code{List-ID:} or @code{Delivered-To:} headers to identify
list messages.

The MySQL mailing lists are as follows:

@table @code
@item @code{announce}
This list is for announcements of new versions of MySQL and related
programs.  This is a low-volume list to which all MySQL users should
subscribe.

@item @code{mysql}
This is the main list for general MySQL discussion.  Please note that some
topics are better discussed on the more-specialized lists.  If you post to the
wrong list, you may not get an answer.

@item @code{mysql-digest}
This is the @code{mysql} list in digest form.  Subscribing to this list means
you will get all list messages, sent as one large mail message once a day.

@item @code{bugs}
This list will be of interest to you if you want to stay informed about
issues reported since the last release of @code{MySQL} or if you want to be
actively involved in the process of bug hunting and fixing.
@xref{Bug reports}.

@item @code{bugs-digest}
This is the @code{bugs} list in digest form.

@item @code{internals}
This list is for people who work on the MySQL code.  This is also the
forum for discussions on MySQL development and post patches.

@item @code{internals-digest}
This is the @code{internals} list in digest form.

@item @code{mysqldoc}
This list is for people who work on the MySQL documentation:
people from MySQL AB, translators, and other community members.

@item @code{mysqldoc-digest}
This is the @code{mysqldoc} list in digest form.

@item @code{benchmarks}
This list is for anyone interested in performance issues. Discussions
concentrate on database performance (not limited to MySQL) but also
include broader categories such as performance of the kernel,
file system, disk system, and so on.

@item @code{benchmarks-digest}
This is the @code{benchmarks} list in digest form.

@item @code{packagers}
This list is for discussions on packaging and distributing MySQL. This is the 
forum used by distribution maintainers to exchange ideas on packaging MySQL 
and on ensuring that MySQL looks and feels as similar as possible on all 
supported platforms and operating systems.

@item @code{packagers-digest}
This is the @code{packagers} list in digest form.

@item @code{java}
This list is for discussions about the MySQL server and Java.It is mostly 
used to discuss JDBC drivers, including MySQL Connector/J.

@item @code{java-digest}
This is the @code{java} list in digest form.

@item @code{win32}
This list is for all topics concerning the MySQL software on Microsoft 
operating systems, such as Windows 9x/Me/NT/2000/XP.

@item @code{win32-digest}
This is the @code{win32} list in digest form.

@item @code{myodbc}
This list is for all topics concerning connecting to the MySQL server with ODBC.

@item @code{myodbc-digest}
This is the @code{myodbc} list in digest form.

@item @code{mysqlcc}
This list is for all topics concerning the @code{MySQL Control Center} graphical client.

@item @code{mysqlcc-digest}
This is the @code{mysqlcc} list in digest form.

@item @code{plusplus}
This list is for all topics concerning programming with the C++ API to MySQL.

@item @code{plusplus-digest}
This is the @code{plusplus} list in digest form.

@item @code{msql-mysql-modules}
This list is for all topics concerning the Perl support for MySQL with
@code{msql-mysql-modules}, which is now named @code{DBD::mysql}.

@item @code{msql-mysql-modules-digest}
This is the @code{msql-mysql-modules} list in digest form.
@end table

If you're unable to get an answer to your questions from a @code{MySQL} mailing list, one
option is to purchase support from MySQL AB. This will put you
in direct contact with MySQL developers. @xref{Support}.

The following table shows some MySQL mailing lists in languages other than
English.  These lists are not operated by MySQL AB.

@table @code

@item @email{mysql-france-subscribe@@yahoogroups.com}
A French mailing list.

@item @email{list@@tinc.net}
A Korean mailing list.
Email @code{subscribe mysql your@@email.address} to this list.

@item @email{mysql-de-request@@lists.4t2.com}
A German mailing list.
Email @code{subscribe mysql-de your@@email.address} to this list.
You can find information about this mailing list at
@uref{http://www.4t2.com/mysql/}.

@item @email{mysql-br-request@@listas.linkway.com.br}
A Portuguese mailing list.
Email @code{subscribe mysql-br your@@email.address} to this list.

@item @email{mysql-alta@@elistas.net}
A Spanish mailing list.
Email @code{subscribe mysql your@@email.address} to this list.

@end table


@node Asking questions, Bug reports, Mailing-list, Questions
@subsubsection Asking Questions or Reporting Bugs

@cindex net etiquette
@cindex mailing lists, archive location
@cindex searching, MySQL web pages

Before posting a bug report or question, please do the following:

@itemize @bullet
@item
Start by searching the MySQL online manual at
@uref{http://www.mysql.com/doc/}.
We try to keep the manual up to date by updating it frequently with
solutions to newly found problems. The change history appendix
(@uref{http://www.mysql.com/doc/en/News.html}) can be particularly
useful since it is quite possible that a newer version already
contains a solution to your problem.

@item
Search in the bugs database at @uref{http://bugs.mysql.com/} to see 
whether the bug has already been reported and fixed.

@item
Search the MySQL mailing list archives at
@uref{http://lists.mysql.com/}.
@item
You can also use @uref{http://www.mysql.com/search/} to search all the
web pages (including the manual) that are located at the MySQL AB web site.
@end itemize

If you can't find an answer in the manual or the archives, check with your
local MySQL expert.  If you still can't find an answer to your
question, please follow the guidelines on sending mail to a MySQL mailing list, 
outlined in the next section, before contacting us.
 


@node Bug reports, Answering questions, Asking questions, Questions
@subsubsection How to Report Bugs or Problems

@cindex bugs, reporting
@cindex reporting, bugs
@cindex problems, reporting
@cindex errors, reporting
@cindex @code{mysqlbug} script
@cindex creating, bug reports
@cindex scripts, @code{mysqlbug}
@cindex bugs.mysql.com
@cindex bugs database

The normal place to report bugs is @uref{http://bugs.mysql.com/}, which is the
address for our bugs database.
This database is public, and can be browsed and searched by anyone.
If you log into the system, you will also be able to enter new reports.

Writing a good bug report takes patience, but doing it right the first
time saves time both for us and for yourself.  A good bug report, containing
a full test case for the bug, makes it very likely that we will fix the bug in
the next release.  This section will help you write your report correctly
so that you don't waste your time doing things that may not help us much
or at all.

We encourage everyone to use the @code{mysqlbug} script to generate a bug
report (or a report about any problem).  @code{mysqlbug} can be
found in the @file{scripts} directory (source distribution) and in the 
@file{bin} directory under your MySQL installation directory (binary distribution). 
If you are unable to use @code{mysqlbug} (for instance, if you are running 
on Windows), it is still vital that you include all the necessary information 
noted in this section (most importantly a description of the operating system 
and the MySQL version).

The @code{mysqlbug} script helps you generate a report by determining much
of the following information automatically, but if something important is
missing, please include it with your message.  Please read this section
carefully and make sure that all the information described here is included
in your report.

Preferably, you should test the problem using the latest production or
development version of MySQL Server before posting.  Anyone should be
able to repeat the bug by just using '@code{mysql test < script}' on the
included test case or by running the shell or Perl script that is included in the
bug report.

All bugs posted in the bugs database at @uref{http://bugs.mysql.com/}
will be corrected or documented in the
next MySQL release. If only minor code changes are needed to correct a
problem, we will also post a patch that fixes the problem.

If you have found a sensitive security bug in MySQL, please send an
email to @email{security@@mysql.com}.

If you have a repeatable bug report, please report it to the bugs
database at @uref{http://bugs.mysql.com/}.  Note that even in this case
it's good to run the @code{mysqlbug} script first to find information
about your system.  Any bug that we are able to repeat has a high chance
of being fixed in the next MySQL release.

To report other problems, you can use one of the MySQL mailing lists.

Remember that it is possible for us to respond to a message containing too much
information, but not to one containing too little.  People often omit facts
because they think they know the cause of a problem and assume that some
details don't matter.  A good principle is: If you are in doubt about stating
something, state it.  It is faster and less troublesome to
write a couple more lines in your report than to wait longer for the answer
if we must ask you to provide information that was missing from the initial
report.

The most common errors made in bug reports are (a) not including the version number of
the MySQL distribution used and (b) not fully describing the platform on which the MySQL server
is installed (including the platform type and version number).  This is highly
relevant information, and in 99 cases out of 100 the bug report is useless without it.  
Very often we get questions like,
``Why doesn't this work for me?'' Then we find that the feature
requested wasn't implemented in that MySQL version, or that a bug
described in a report has already been fixed in newer MySQL
versions.  Sometimes the error is platform-dependent; in such cases, it is
next to impossible for us to fix anything without knowing the operating system and
the version number of the platform.

If you compiled MySQL from source,
remember also to provide information about your compiler, if it is related to
the problem.  Often people find bugs in compilers and think the problem is
MySQL-related.  Most compilers are under development all the time and
become better version by version.  To determine whether your
problem depends on your compiler, we need to know what compiler you use.
Note that every compiling problem should be regarded as a bug and
reported accordingly.

It is most helpful when a good description of the problem is included in the
bug report.  That is, give a good example of everything you did that led to
the problem and describe, in exact detail, the problem itself.  The best reports are
those that include a full example showing how to reproduce the bug or
problem.  @xref{Reproduceable test case}.

If a program produces an error message, it is very important to include the
message in your report.  If we try to search for something from the archives
using programs, it is better that the error message reported exactly matches
the one that the program produces.  (Even the case should be observed.)
You should never try to remember what the error message was; instead, copy
and paste the entire message into your report.

If you have a problem with Connector/ODBC (MyODBC), please try to generate a
MyODBC trace file and send it with your report.  @xref{MyODBC bug report}.

Please remember that many of the people who will read your report will
do so using an 80-column display.  When generating reports or examples
using the @code{mysql} command-line tool, you should therefore use
the @code{--vertical} option (or the @code{\G} statement terminator)
for output that would exceed the available width for such a display
(for example, with the @code{EXPLAIN SELECT} statement; see the
example later in this section).

@cindex bug reports, criteria for
Please include the following information in your report:

@itemize @bullet
@item
The version number of the MySQL distribution you are using (for
example, MySQL Version 4.0.12). You can find out which version you
are running by executing @code{mysqladmin version}.  @code{mysqladmin} can be
found in the @file{bin} directory under your MySQL installation
directory.

@item
The manufacturer and model of the machine on which you experience the 
problem.

@item
The operating system name and version.  If you work with Windows, you
can usually get the name and version number by double-clicking your
``My Computer'' icon and pulling down the ``Help/About Windows'' menu.
For most Unix-like operating systems, you can get this information by
executing the command @code{uname -a}.

@item
Sometimes the amount of memory (real and virtual) is relevant. If in doubt,
include these values.

@item
If you are using a source distribution of the MySQL software, the name and
version number of the compiler used is needed.  If you have a binary
distribution, the distribution name is needed.

@item
If the problem occurs during compilation, include the exact error
messages and also a few lines of context around the offending code in the
file where the error occurrs.

@item
If @code{mysqld} died, you should also report the query that crashed
@code{mysqld}.  You can usually find this out by running @code{mysqld} with
logging enabled.  @xref{Using log files}.

@item
If a database table is related to the problem, include the output from
@code{mysqldump --no-data db_name tbl_name1 tbl_name2 ...}.  This is very easy
to do and is a powerful way to get information about any table in a database.
The information will help us create a situation matching the one you have.

@item
For speed-related bugs or problems with @code{SELECT} statements, you
should always include the output of @code{EXPLAIN SELECT ...}, and at
least the number of rows that the @code{SELECT} statement produces.  You
should also include the output from @code{SHOW CREATE TABLE tbl_name}
for each involved table. The more information you give about your
situation, the more likely it is that someone can help you.

The following is an example of a very good bug report. It should be posted
with the @code{mysqlbug} script.  The example uses the @code{mysql}
command-line tool. Note the use of the @code{\G} statement terminator for
statements whose output width would otherwise exceed that of an 80-column
display device.

@example
mysql> SHOW VARIABLES;
mysql> SHOW COLUMNS FROM ...\G
       <output from SHOW COLUMNS>
mysql> EXPLAIN SELECT ...\G
       <output from EXPLAIN>
mysql> FLUSH STATUS;
mysql> SELECT ...;
       <A short version of the output from SELECT,
       including the time taken to run the query>
mysql> SHOW STATUS;
       <output from SHOW STATUS>
@end example

@item
If a bug or problem occurs while running @code{mysqld}, try to provide an
input script that will reproduce the anomaly.  This script should include any
necessary source files.  The more closely the script can reproduce your
situation, the better.  If you can make a reproducible test case, you should
post it on @uref{http://bugs.mysql.com/} for high-priority treatment.

If you can't provide a script, you should at least include the output
from @code{mysqladmin variables extended-status processlist} in your mail to
provide some information on how your system is performing.

@item
If you can't produce a test case with only a few rows, or if the test table
is too big to be mailed to the mailing list (more than 10 rows), you should
dump your tables using @code{mysqldump} and create a @file{README} file
that describes your problem.

Create a compressed archive of your files using
@code{tar} and @code{gzip} or @code{zip}, and use @code{ftp} to transfer the
archive to @uref{ftp://support.mysql.com/pub/mysql/secret/}.  Then enter
the problem into our bugs database at @uref{http://bugs.mysql.com/}.

@item
If you think that the MySQL server produces a strange result from a query,
include not only the result, but also your opinion of what the result
should be, and an account describing the basis for your opinion.

@item
When giving an example of the problem, it's better to use the variable names,
table names, etc., that exist in your actual situation than to come up with
new names.  The problem could be related to the name of a variable or table.
These cases are rare, perhaps, but it is better to be safe than sorry.
After all, it should be easier for you to provide an example that uses your
actual situation, and it is by all means better for us.  In case you have data
you don't want to show to others, you can use @code{ftp} to transfer it to
@uref{ftp://support.mysql.com/pub/mysql/secret/}.  If the data is really top
secret and you don't want to show it even to us, then go ahead and provide
an example using other names, but please regard this as the last choice.

@item
Include all the options given to the relevant programs, if possible.  For
example, indicate the options that you use when you start the @code{mysqld}
server as well as the options that you use to run any MySQL client programs.
The options to programs like @code{mysqld} and @code{mysql}, and to the
@code{configure} script, are often keys to answers and are very relevant.
It is never a bad idea to include them.  If you use any modules, such
as Perl or PHP, please include the version numbers of those as well.

@item
If your question is related to the privilege system, please include the
output of @code{mysqlaccess}, the output of @code{mysqladmin reload}, and all
the error messages you get when trying to connect.  When you test your
privileges, you should first run @code{mysqlaccess}.  After this, execute
@code{mysqladmin reload version} and try to connect with the program that
gives you trouble.  @code{mysqlaccess} can be found in the @file{bin}
directory under your MySQL installation directory.

@item
If you have a patch for a bug, do include it.  But don't assume the patch is
all we need, or that we will use it, if you don't provide some necessary
information such as test cases showing the bug that your patch fixes.  We
might find problems with your patch or we might not understand it at all; if
so, we can't use it.

If we can't verify exactly what the purpose of the patch is, we won't use it.
Test cases will help us here.  Show that the patch will handle all the
situations that may occur.  If we find a borderline case (even a rare one)
where the patch won't work, it may be useless.

@item
Guesses about what the bug is, why it occurs, or what it depends on
are usually wrong.  Even the MySQL team can't guess such things
without first using a debugger to determine the real cause of a bug.

@item
Indicate in your bug report that you have checked the reference manual
and mail archive so that others know you have tried to solve the
problem yourself.

@item
If you get a @code{parse error}, please check your syntax closely.  If
you can't find something wrong with it, it's extremely likely that your
current version of MySQL Server doesn't support the syntax you are
using.  If you are using the current version and the manual at
@uref{http://www.mysql.com/doc/} doesn't cover the
syntax you are using, MySQL Server doesn't support your query.  In this
case, your only options are to implement the syntax yourself or email
@email{licensing@@mysql.com} and ask for an offer to implement it.

If the manual covers the syntax you are using, but you have an older version
of MySQL Server, you should check the MySQL change history to see
when the syntax was implemented.  In this case, you have the option of
upgrading to a newer version of MySQL Server.  @xref{News}.

@item
If your problem is that your data appears corrupt or you get errors
when you access a particular table, you should first check and then try
to repair your tables with @code{CHECK TABLE} and @code{REPAIR TABLE}
or with @code{myisamchk}.
@xref{MySQL Database Administration}.

If you are running Windows, please check that @code{lower_case_table_names
is 1 or 2} with @code{SHOW VARIABLES LIKE 'lower_case_table_names'}.

@item
If you often get corrupted tables, you should try to find out when and why this
happens.  In this case, the error log in the MySQL data directory
may contain some information about what happened. (This is the file with the
@file{.err} suffix in the name.)  @xref{Error log}.  Please
include any relevant information from this file in your bug report.  Normally
@code{mysqld} should @strong{never} crash a table if nothing killed it in the
middle of an update.  If you can find the cause of @code{mysqld} dying,
it's much easier for us to provide you with a fix for the problem.
@xref{What is crashing}.

@item
If possible, download and install the most recent version of MySQL Server
and check whether it solves your problem.  All versions of
the MySQL software are thoroughly tested and should work without problems.
We believe in making everything as backward-compatible as possible,
and you should be able to switch MySQL versions without difficulty.
@xref{Which version}.
@end itemize

@cindex technical support, mailing address
@cindex support, mailing address
@cindex customer support, mailing address
@cindex mailing address, for customer support
If you are a support customer, please cross-post the bug report to
@email{mysql-support@@mysql.com} for higher-priority treatment, as well as to
the appropriate mailing list to see whether someone else has experienced (and
perhaps solved) the problem.

For information on reporting bugs in @code{MyODBC}, see @ref{ODBC Problems}.

For solutions to some common problems, see @ref{Problems}.

When answers are sent to you individually and not to the mailing list,
it is considered good etiquette to summarize the answers and send the
summary to the mailing list so that others may have the benefit of
responses you received that helped you solve your problem.


@node Answering questions,  , Bug reports, Questions
@subsubsection Guidelines for Answering Questions on the Mailing List

@cindex net etiquette
@cindex questions, answering
@cindex answering questions, etiquette
@cindex mailing lists, guidelines

If you consider your answer to have broad interest, you may want to post it
to the mailing list instead of replying directly to the individual who
asked.  Try to make your answer general enough that people other than the
original poster may benefit from it.  When you post to the list, please make
sure that your answer is not a duplication of a previous answer.

Try to summarize the essential part of the question in your reply; don't feel
obliged to quote the entire original message.

Please don't post mail messages from your browser with HTML mode turned on.
Many users don't read mail with a browser.

@node IRC,  , Questions, MySQL Information Sources
@subsection MySQL Community Support on IRC (Internet Relay Chat)

@cindex IRC
@cindex Internet Relay Chat

In addition to the various MySQL mailing lists, you can find experienced
community people on @code{IRC} (@code{Internet Relay Chat}).
These are the best networks/channels currently known to us:

@itemize @bullet
@item @strong{freenode} (see @uref{http://www.freenode.net/} for servers)
@itemize
@item @code{#mysql}
Primarily MySQL questions but other database and SQL questions welcome.
@item @code{#mysqlphp}
Questions about MySQL+PHP, a popular combination.
@item @code{#mysqlperl}
Questions about MySQL+Perl, another popular combination.
@end itemize
@item @strong{EFnet} (see @uref{http://www.efnet.org/} for servers)
@itemize
@item @code{#mysql}
MySQL questions.
@end itemize
@end itemize

If you are looking for IRC client software to connect to an IRC network,
take a look at @code{X-Chat} (@uref{http://www.xchat.org/}).
X-Chat (GPL licensed) is available for Unix as well as for Windows platforms.


@node Compatibility,  , MySQL Information Sources, Introduction
@section MySQL Standards Compliance

@cindex compatibility, with standard SQL
@cindex standards compatibility
@cindex extensions, to standard SQL
@cindex SQL-92, extensions to

This section describes how MySQL relates to the ANSI/ISO SQL standards.
MySQL Server has many extensions to the SQL standard, and here you
will find out what they are and how to use them.  You will also find
information about functionality missing from MySQL Server, and how to work
around some differences.

Our goal is to not restrict MySQL Server usability for any usage without a
very good reason for doing so.  Even if we don't have the resources to perform
 development for every possible use, we are always willing to help and offer
suggestions to people who are trying to use MySQL Server in new territories.

One of our main goals with the product is to continue to work toward
compliance with the SQL-99 standard, but without sacrificing speed or reliability.
We are not afraid to add extensions to SQL or support for non-SQL
features if this greatly increases the usability of MySQL Server for a large
segment of our user base.  (The new @code{HANDLER} interface in MySQL Server 4.0
is an example of this strategy. @xref{HANDLER, , @code{HANDLER}}.)

We will continue to support transactional and non-transactional
databases to satisfy both mission-critical 24/7 usage and
heavy web/logging usage.

MySQL Server was designed from the start to work with medium size databases
(10-100 million rows, or about 100 MB per table) on small computer
systems.  We will continue to extend MySQL Server to work even better
with terabyte-size databases, as well as to make it possible
to compile a reduced MySQL version that is more suitable for hand-held
devices and embedded usage.  The compact design of the MySQL server makes
development in both
of these directions possible without any conflicts in the source tree.

We are currently not targeting realtime support, though
you can already do a lot of things with our replication capabilities.

Database cluster support is planned to begin sometime in 2004 through
implementation of a new storage engine.

We are looking at providing XML support in the database server.

@menu
* Standards::                   What Standards MySQL Follows
* SQL mode::                    Selecting SQL Modes
* ANSI mode::                   Running MySQL in ANSI Mode
* Extensions to ANSI::          MySQL Extensions to the SQL-92 Standard
* Differences from ANSI::       MySQL Differences Compared to SQL-92
* Constraints::                 How MySQL Deals with Constraints
* Bugs::                        Known Errors and Design Deficiencies in MySQL
@end menu


@node Standards, SQL mode, Compatibility, Compatibility
@subsection What Standards MySQL Follows

Entry-level SQL-92. ODBC levels 0-3.51.

We are aiming toward supporting the full SQL-99 standard,
but without making concessions to speed and quality of the code.


@node SQL mode, ANSI mode, Standards, Compatibility
@subsection Selecting SQL Modes

The MySQL server can operate in different SQL modes, and can apply these
modes differentially for different clients. This allows applications to
tailor server operation to their own requirements.

Modes define what SQL syntax MySQL should support and what kind of
validation checks it should perform on the data.  This makes it easier
to use MySQL in a lot of different environments and to use MySQL together
with other database servers.

You can set the default SQL mode by starting @code{mysqld} with the
@code{--sql-mode="modes"} option. Beginning with MySQL 4.1, you can also
change the mode after startup time by setting the @code{sql_mode} variable
with a @code{SET [SESSION|GLOBAL] sql_mode='modes'} statement.

For more information on setting the server mode, see @ref{Server SQL mode}.


@node ANSI mode, Extensions to ANSI, SQL mode, Compatibility
@subsection Running MySQL in ANSI Mode

@cindex running, ANSI mode
@cindex ANSI mode, running

You can tell @code{mysqld} to use the ANSI mode with the @code{--ansi}
startup option. @xref{Server options}.

Running the server in ANSI mode is the same as starting it with these options:

@example
--sql-mode=REAL_AS_FLOAT,PIPES_AS_CONCAT,ANSI_QUOTES,IGNORE_SPACE,ONLY_FULL_GROUP_BY
--transaction-isolation=SERIALIZABLE
@end example

In MySQL 4.1, you can achieve the same effect with these two statements:

@example
SET GLOBAL TRANSACTION ISOLATION LEVEL SERIALIZABLE;
SET GLOBAL sql_mode =
  "REAL_AS_FLOAT,PIPES_AS_CONCAT,ANSI_QUOTES,IGNORE_SPACE,ONLY_FULL_GROUP_BY";
@end example

@xref{SQL mode}.

In MySQL 4.1.1, the @code{sql_mode} options shown can be also be set with:

@example
SET GLOBAL sql_mode="ansi";
@end example

In this case, the value of the @code{sql_mode} variable will be set to all
options that are relevant for ANSI mode. You can check the result by doing:

@example
mysql> SET GLOBAL sql_mode="ansi";
mysql> SELECT @@@@GLOBAL.sql_mode;
        -> "REAL_AS_FLOAT,PIPES_AS_CONCAT,ANSI_QUOTES,IGNORE_SPACE,ONLY_FULL_GROUP_BY,ANSI"
@end example


@node Extensions to ANSI, Differences from ANSI, ANSI mode, Compatibility
@subsection MySQL Extensions to the SQL-92 Standard

@cindex hints
MySQL Server includes some extensions that you probably will not find in
other SQL databases.  Be warned that if you use them, your code will not be
portable to other SQL servers.  In some cases, you can write code that
includes MySQL extensions, but is still portable, by using comments
of the form @code{/*! ... */}.  In this case, MySQL Server will parse and
execute the code within the comment as it would any other MySQL
statement, but other SQL servers will ignore the extensions.  For example:

@example
SELECT /*! STRAIGHT_JOIN */ col_name FROM table1,table2 WHERE ...
@end example

If you add a version number after the @code{'!'} character, the syntax within
the comment will be
executed only if the MySQL version is equal to or newer than the specified
version number:

@example
CREATE /*!32302 TEMPORARY */ TABLE t (a INT);
@end example

This means that if you have Version 3.23.02 or newer, MySQL
Server will use the @code{TEMPORARY} keyword.

The following descriptions list MySQL extensions, organized by category.

@table @asis
@item Organization of data on disk

MySQL Server maps each database to a directory under the MySQL
data directory, and tables within a database to filenames in the database
directory.
This has a few implications:

@cindex database names, case-sensitivity
@cindex table names, case-sensitivity
@cindex case-sensitivity, of database names
@cindex case-sensitivity, of table names

@itemize @bullet

@item
Database names and table names are case sensitive in MySQL Server on
operating systems that have case sensitive filenames (like most Unix
systems). @xref{Name case sensitivity}.

@item
Database, table, index, column, or alias names may begin with a digit
(but may not consist solely of digits).

@item
You can use standard system commands to back up, rename, move, delete, and copy
tables that are managed by the @code{MyISAM} or @code{ISAM} storage engines.
For example, to rename a @code{MyISQM} table, rename the @file{.MYD},
@file{.MYI}, and @file{.frm} files to which the table corresponds.
@end itemize

@item General language syntax

@itemize @bullet

@item
Strings may be enclosed by either @samp{"} or @samp{'}, not just by @samp{'}.

@item
Use of @samp{\} as an escape character in strings.

@item
In SQL statements, you can access tables from different databases
with the @code{db_name.tbl_name} syntax.  Some SQL servers provide
the same functionality but call this @code{User space}.
MySQL Server doesn't support tablespaces such as used in statements like this:
@code{CREATE TABLE ralph.my_table...IN my_tablespace}.

@end itemize

@item SQL statement syntax

@itemize @bullet

@item
The @code{ANALYZE TABLE}, @code{CHECK TABLE}, @code{OPTIMIZE TABLE}, and
@code{REPAIR TABLE} statements.

@item
The @code{CREATE DATABASE} and @code{DROP DATABASE} statements.
@xref{CREATE DATABASE, , @code{CREATE DATABASE}}.

@item
The @code{DO} statement.

@item
@code{EXPLAIN SELECT} to get a description of how tables are joined.

@item
The @code{FLUSH} and @code{RESET} statements.

@item
The @code{SET} statement. @xref{SET OPTION, , @code{SET}}.

@item
The @code{SHOW} statement.
@xref{SHOW, , @code{SHOW}}.

@cindex Oracle compatibility
@cindex compatibility, with Oracle
@item
Use of @code{LOAD DATA INFILE}. In many cases, this syntax is compatible with
Oracle's @code{LOAD DATA INFILE}. @xref{LOAD DATA, , @code{LOAD DATA}}.

@item
Use of @code{RENAME TABLE}. @xref{RENAME TABLE, , @code{RENAME TABLE}}.

@item
Use of @code{REPLACE} instead of @code{DELETE} + @code{INSERT}.
@xref{REPLACE, , @code{REPLACE}}.

@item
Use of @code{CHANGE col_name}, @code{DROP col_name}, or @code{DROP
INDEX}, @code{IGNORE} or @code{RENAME} in an @code{ALTER TABLE}
statement.
Use of multiple @code{ADD}, @code{ALTER}, @code{DROP}, or @code{CHANGE}
clauses in an @code{ALTER TABLE} statement.
@xref{ALTER TABLE, , @code{ALTER TABLE}}.

@item
Use of index names, indexes on a prefix of a field, and use of
@code{INDEX} or @code{KEY} in a @code{CREATE TABLE}
statement. @xref{CREATE TABLE, , @code{CREATE TABLE}}.

@item
Use of @code{TEMPORARY} or @code{IF NOT EXISTS} with @code{CREATE TABLE}.

@item
Use of @code{IF EXISTS} with @code{DROP TABLE}.

@item
You can drop multiple tables with a single @code{DROP TABLE} statement.

@item
The @code{ORDER BY} and @code{LIMIT} clauses of the @code{UPDATE} and
@code{DELETE} statements.

@item
@code{INSERT INTO ... SET col_name = ...} syntax.

@item
The @code{DELAYED} clause of the @code{INSERT} and @code{REPLACE}
statements.

@item
The @code{LOW_PRIORITY} clause of the @code{INSERT}, @code{REPLACE},
@code{DELETE}, and @code{UPDATE} statements.

@item
Use of @code{INTO OUTFILE} and @code{STRAIGHT_JOIN} in a @code{SELECT}
statement. @xref{SELECT, , @code{SELECT}}.

@item
The @code{SQL_SMALL_RESULT} option in a @code{SELECT} statement.

@item
You don't need to name all selected columns in the @code{GROUP BY} part.
This gives better performance for some very specific, but quite normal
queries.
@xref{Group by functions and modifiers}.

@item
You can specify @code{ASC} and @code{DESC} with @code{GROUP BY}.

@item
The ability to set variables in a statement with the @code{:=} assignment
operator:
@example
mysql> SELECT @@a:=SUM(total),@@b=COUNT(*),@@a/@@b AS avg
    -> FROM test_table;
mysql> SELECT @@t1:=(@@t2:=1)+@@t3:=4,@@t1,@@t2,@@t3;
@end example

@end itemize

@item Column types

@itemize @bullet
@item
The column types @code{MEDIUMINT}, @code{SET}, @code{ENUM}, and the
different @code{BLOB} and @code{TEXT} types.

@item
The column attributes @code{AUTO_INCREMENT}, @code{BINARY}, @code{NULL},
@code{UNSIGNED}, and @code{ZEROFILL}.
@end itemize

@item Functions and operators

@itemize @bullet

@item
To make it easier for users who come from other SQL environments,
MySQL Server supports aliases for many functions. For example, all
string functions support both standard SQL syntax and ODBC syntax.

@item
MySQL Server understands the @code{||} and @code{&&} operators to mean
logical OR and AND, as in the C programming language.  In MySQL Server,
@code{||} and @code{OR} are synonyms, as are @code{&&} and @code{AND}.
Because of this nice syntax, MySQL Server doesn't support
the standard SQL-99 @code{||} operator for string concatenation; use
@code{CONCAT()} instead. Because @code{CONCAT()} takes any number
of arguments, it's easy to convert use of the @code{||} operator to
MySQL Server.

@item
Use of @code{COUNT(DISTINCT list)} where @code{list} has more than one element.

@item
All string comparisons are case-insensitive by default, with sort
ordering determined by the current character set (ISO-8859-1 Latin1 by
default).  If you don't like this, you should declare your columns with
the @code{BINARY} attribute or use the @code{BINARY} cast, which causes
comparisons to be done according to the ASCII order used on the
MySQL server host.

@cindex PostgreSQL compatibility
@cindex compatibility, with PostgreSQL
@item
The @code{%} operator is a synonym for @code{MOD()}.  That is,
@code{N % M} is equivalent to @code{MOD(N,M)}.  @code{%} is supported
for C programmers and for compatibility with PostgreSQL.

@item
The @code{=}, @code{<>}, @code{<=} ,@code{<}, @code{>=},@code{>},
@code{<<}, @code{>>}, @code{<=>}, @code{AND}, @code{OR}, or @code{LIKE}
operators may be used in column comparisons to the left of the
@code{FROM} in @code{SELECT} statements.  For example:

@example
mysql> SELECT col1=1 AND col2=2 FROM tbl_name;
@end example

@item
The @code{LAST_INSERT_ID()} function.
@xref{Information functions}.

@item
@code{LIKE} is allowed on numeric columns.

@item
The @code{REGEXP} and @code{NOT REGEXP} extended regular expression
operators.

@item
@code{CONCAT()} or @code{CHAR()} with one argument or more than two
arguments.  (In MySQL Server, these functions can take any number of
arguments.)

@item The @code{BIT_COUNT()}, @code{CASE}, @code{ELT()},
@code{FROM_DAYS()}, @code{FORMAT()}, @code{IF()}, @code{PASSWORD()},
@code{ENCRYPT()}, @code{MD5()}, @code{ENCODE()}, @code{DECODE()},
@code{PERIOD_ADD()}, @code{PERIOD_DIFF()}, @code{TO_DAYS()}, or
@code{WEEKDAY()} functions.

@item
Use of @code{TRIM()} to trim substrings.  SQL-99 supports removal
of single characters only.

@item
The @code{GROUP BY} functions @code{STD()}, @code{BIT_OR()},
@code{BIT_AND()}, @code{BIT_XOR()}, and @code{GROUP_CONCAT()}.
@xref{Group by functions and modifiers}.
@end itemize

@end table

For a prioritized list indicating when new extensions will be added to
MySQL Server, you should consult the online MySQL TODO list at
@uref{http://www.mysql.com/doc/en/TODO.html}.
That is the latest version of the TODO list in this manual. @xref{TODO}.


@node Differences from ANSI, Constraints, Extensions to ANSI, Compatibility
@subsection MySQL Differences Compared to SQL-92

We try to make MySQL Server follow the ANSI SQL standard (SQL-92/SQL-99) and the
ODBC SQL standard, but MySQL Server performs operations differently in some
cases:

@itemize @bullet
@item
For @code{VARCHAR} columns, trailing spaces are removed when the value is
stored. @xref{Bugs}.

@item
In some cases, @code{CHAR} columns are silently converted to @code{VARCHAR}
columns when you define a table or alter its structure.
@xref{Silent column changes}.

@item
Privileges for a table are not automatically revoked when you delete a
table. You must explicitly issue a @code{REVOKE} statement to revoke
privileges for a table. @xref{GRANT, , @code{GRANT}}.
@end itemize

@menu
* ANSI diff Subqueries::        Subqueries
* ANSI diff SELECT INTO TABLE::  @code{SELECT INTO TABLE}
* ANSI diff Transactions::      Transactions and Atomic Operations
* ANSI diff Triggers::          Stored Procedures and Triggers
* ANSI diff Foreign Keys::      Foreign Keys
* ANSI diff Views::             Views
* ANSI diff comments::          @samp{--} as the Start of a Comment
@end menu


@node ANSI diff Subqueries, ANSI diff SELECT INTO TABLE, Differences from ANSI, Differences from ANSI
@subsubsection Subqueries

MySQL Version 4.1 supports subqueries and derived tables.
A subquery is a @code{SELECT} statement nested within another statement.
A derived table (an unnamed view) is a subquery in the @code{FROM} clause
of another statement.
@xref{Subqueries}.

For MySQL versions older than 4.1, most subqueries can be
rewritten using joins or other methods.
See @ref{Rewriting subqueries} for examples that show how to do this.


@node ANSI diff SELECT INTO TABLE, ANSI diff Transactions, ANSI diff Subqueries, Differences from ANSI
@subsubsection @code{SELECT INTO TABLE}

@findex SELECT INTO TABLE

MySQL Server doesn't support the Sybase SQL extension:
@code{SELECT ... INTO TABLE ...}.  Instead, MySQL Server supports the
SQL-99 syntax @code{INSERT INTO ... SELECT ...}, which is basically
the same thing. @xref{INSERT SELECT,  , @code{INSERT SELECT}}.

@example
INSERT INTO tblTemp2 (fldID)
       SELECT tblTemp1.fldOrder_ID
       FROM tblTemp1 WHERE tblTemp1.fldOrder_ID > 100;
@end example

Alternatively, you can use @code{SELECT INTO OUTFILE ...} or
@code{CREATE TABLE ... SELECT}.

From version 5.0, MySQL supports @code{SELECT ... INTO} with user
variables. The same syntax may also be used inside stored procedures using
cursors and local variables.
@xref{SELECT INTO Statement}.


@node ANSI diff Transactions, ANSI diff Triggers, ANSI diff SELECT INTO TABLE, Differences from ANSI
@subsubsection Transactions and Atomic Operations

@findex COMMIT
@findex ROLLBACK
@cindex transactions, support
@cindex transaction-safe tables
@cindex tables, updating
@cindex updating, tables
@cindex @code{InnoDB} tables
@cindex @code{BDB} tables
@cindex @code{ACID}

MySQL Server (version 3.23-max and all versions 4.0 and above) supports
transactions with the @code{InnoDB} and @code{BDB}
transactional storage engines.
@code{InnoDB} provides @emph{full} @code{ACID} compliance.
@xref{Table types}.

The other non-transactional storage engines in MySQL Server (such as
@code{MyISAM}) follow a different paradigm for data integrity called
``@code{Atomic Operations}.'' In transactional terms, @code{MyISAM}
tables effectively always operate in @code{AUTOCOMMIT=1} mode.
Atomic operations often offer comparable integrity with higher performance.

With MySQL Server supporting both paradigms, you can decide whether your
applications are best served by the speed of atomic operations or the use of
transactional features. This choice can be made on a per-table basis.

As noted, the trade off for transactional vs. non-transactional table
types lies mostly in performance. Transactional tables have significantly
higher memory and diskspace requirements, and more CPU overhead.
On the other hand, transactional table types such as @code{InnoDB} also
offer many significant features. MySQL Server's modular design allows the
concurrent use of different storage engines to suit different
requirements and deliver optimum performance in all situations.

But how does one use the features of MySQL Server to maintain rigorous
integrity even with the non-transactional @code{MyISAM} tables, and how
do these features compare with the transactional table types?

@enumerate
@item
If your applications are written in a way that is dependent on being able
to call @code{ROLLBACK} rather than
@code{COMMIT} in critical situations, transactions are more
convenient. Transactions also ensure that unfinished updates or
corrupting activities are not committed to the database; the server is
given the opportunity to do an automatic rollback and your database is
saved.

If you use non-transactional tables,
MySQL Server in almost all cases allows you to resolve potential problems
by including simple checks before updates and by running simple scripts
that check the databases for inconsistencies and automatically repair
or warn if such an inconsistency occurs. Note that just by using the
MySQL log or even adding one extra log, one can normally fix tables
perfectly with no data integrity loss.

@item
More often than not, critical transactional updates can be rewritten to be
atomic. Generally speaking, all integrity problems that transactions
solve can be done with @code{LOCK TABLES} or atomic updates, ensuring
that you never will get an automatic abort from the server, which is
a common problem with transactional database systems.

@item
Even a transactional system can lose data if the server goes down.
The difference between different systems lies in just how small the
time-lap is where they could lose data. No system is 100% secure, only
``secure enough.'' Even Oracle, reputed to be the safest of
transactional database systems, is reported to sometimes lose data in such
situations.

To be safe with MySQL Server, whether using transactional tables or not, you
only need to have backups and have binary logging turned on. With
this you can recover from any situation that you could with any
other transactional database system.  It is always good to have
backups, independent of which database system you use.
@end enumerate

The transactional paradigm has its benefits and its drawbacks. Many
users and application developers depend on the ease with which they
can code around problems where an abort appears to be, or is necessary.
However, even if you are new to the atomic operations paradigm, or more
familiar with transactions, do consider the speed benefit that
non-transactional tables can offer on the order of three to five times
the speed of the fastest and most optimally tuned transactional tables.

In situations where integrity is of highest importance, MySQL Server offers
transaction-level reliability and integrity even for non-transactional tables.
If you lock tables with @code{LOCK TABLES}, all updates will stall
until any integrity checks are made. If you obtain a @code{READ LOCAL} lock
(as opposed to a write lock) for a table that allows concurrent inserts at the
end of the table, reads are allowed, as are inserts by other clients.
The new inserted records will not be seen by the
client that has the read lock until it releases the lock.
With @code{INSERT DELAYED} you can queue inserts into a local
queue, until the locks are released, without having the client wait
for the insert to complete. @xref{INSERT DELAYED}.

``Atomic,'' in the sense that we mean it, is nothing magical. It only
means that you can be sure that while each specific update is running,
no other user can interfere with it, and there will never be an
automatic rollback (which can happen with transactional tables if you
are not very careful).  MySQL Server also guarantees that there will not be
any dirty reads.

Following are some techniques for working with non-transactional tables:

@itemize @bullet
@item
Loops that need transactions normally can be coded with the help of
@code{LOCK TABLES}, and you don't need cursors to update
records on the fly.

@item
To avoid using @code{ROLLBACK}, you can use the following strategy:

@enumerate
@item
Use @code{LOCK TABLES ...} to lock all the tables you want to access.
@item
Test the conditions that must be true before performing the update.
@item
Update if everything is okay.
@item
Use @code{UNLOCK TABLES} to release your locks.
@end enumerate

This is usually a much faster method than using transactions with
possible rollbacks, although not always. The only situation
this solution doesn't handle is when someone kills the threads in the
middle of an update. In this case, all locks will be released but some
of the updates may not have been executed.

@item
You can also use functions to update records in a single operation.
You can get a very efficient application by using the following
techniques:

@itemize @bullet
@item Modify fields relative to their current value.
@item Update only those fields that actually have changed.
@end itemize

For example, when we are doing updates to some customer information, we
update only the customer data that has changed and test only that none of
the changed data, or data that depends on the changed data, has changed
compared to the original row. The test for changed data is done with the
@code{WHERE} clause in the @code{UPDATE} statement. If the record wasn't
updated, we give the client a message: ''Some of the data you have changed
has been changed by another user.'' Then we show the old row versus the new
row in a window, so the user can decide which version of the customer record
he should use.

This gives us something that is similar to column locking but is actually
even better because we only update some of the columns, using values that
are relative to their current values.  This means that typical @code{UPDATE}
statements look something like these:

@example
UPDATE tablename SET pay_back=pay_back+125;

UPDATE customer
  SET
    customer_date='current_date',
    address='new address',
    phone='new phone',
    money_he_owes_us=money_he_owes_us-125
  WHERE
    customer_id=id AND address='old address' AND phone='old phone';
@end example

As you can see, this is very efficient and works even if another client
has changed the values in the @code{pay_back} or @code{money_he_owes_us}
columns.

@item
@findex mysql_insert_id()
@findex LAST_INSERT_ID()
In many cases, users have wanted @code{LOCK TABLES} and/or @code{ROLLBACK}
for the purpose of managing unique identifiers.  This can be handled much
more efficiently without locking or rolling back by using an
@code{AUTO_INCREMENT} column and either the SQL function
@code{LAST_INSERT_ID()} or the C API function @code{mysql_insert_id()}.
@xref{Information functions}.
@xref{mysql_insert_id, , @code{mysql_insert_id()}}.

@cindex rows, locking
@cindex locking, row-level
You can generally code around the need for row-level locking. Some situations
really do need it, and @code{InnoDB} tables support row-level locking. With
@code{MyISAM} tables, you can use a flag column in the table and do something
like the following:

@example
UPDATE tbl_name SET row_flag=1 WHERE id=ID;
@end example

MySQL returns 1 for the number of affected rows if the row was
found and @code{row_flag} wasn't already 1 in the original row.

You can think of it as though MySQL Server changed the preceding query to:

@example
UPDATE tbl_name SET row_flag=1 WHERE id=ID AND row_flag <> 1;
@end example
@end itemize


@node ANSI diff Triggers, ANSI diff Foreign Keys, ANSI diff Transactions, Differences from ANSI
@subsubsection Stored Procedures and Triggers

@cindex stored procedures and triggers, defined
@cindex procedures, stored
@cindex triggers

Stored procedures are implemented in MySQL version 5.0.
@xref{Stored Procedures}.

Triggers are scheduled for implementation in MySQL version 5.1. A trigger is
effectively a type of stored procedure, one that is invoked when a particular
event occurs.
For example, you could set up a stored procedure that is triggered
each time a record is deleted from a transactional table and that stored
procedure automatically deletes the corresponding customer from a customer
table when all their transactions are deleted.


@node ANSI diff Foreign Keys, ANSI diff Views, ANSI diff Triggers, Differences from ANSI
@subsubsection Foreign Keys

@cindex foreign keys
@cindex keys, foreign

In MySQL Server 3.23.44 and up, the @code{InnoDB} storage engine supports
checking of foreign key constraints, including @code{CASCADE}, @code{ON
DELETE}, and @code{ON UPDATE}. @xref{InnoDB foreign key constraints}.

For storage engines other than @code{InnoDB}, MySQL Server parses the
@code{FOREIGN KEY} syntax in @code{CREATE TABLE} statements, but does not
use or store it. In the future, the implementation will be
extended to store this information in the table specification file so that it
may be retrieved by @code{mysqldump} and ODBC.  At a later stage,
foreign key constraints will be implemented for @code{MyISAM} tables as well.

Foreign key enforcement offers several benefits to database developers:

@itemize @bullet
@item
Assuming proper design of the relationships, foreign key constraints
make it more difficult for a programmer to introduce an inconsistency
into the database.

@item
Centralized checking of constraints by the database server makes it
unnecessary to perform these checks on the application side. This
eliminates the possibility that different applications may not all check the
constraints in the same way.

@item
Using cascading updates and deletes can simplify the application code.

@item
Properly designed foreign key rules aid in documenting relationships
between tables.
@end itemize

Do keep in mind that these benefits come at the cost of additional overhead
for the database server to perform the necessary checks. Additional checking
by the server affects performance, which for some applications may be
sufficiently undesirable as to be avoided if possible.
(Some major commercial applications have coded the foreign-key logic at the
application level for this reason.)

MySQL gives database developers the choice of which approach to use. If you
don't need foreign keys and want to avoid the overhead associated with
enforcing referential integrity, you can choose another table type instead,
such as @code{MyISAM}. (For example, the @code{MyISAM} storage engine offers
very fast performance for applications that perform only @code{INSERT} and
@code{SELECT} operations, because the inserts can be performed concurrently
with retrievals.  @xref{Table locking}.)

If you choose not to take advantage of referential integrity checks,
keep the following considerations in mind:

@itemize @bullet
@item
In the absence of server-side foreign key relationship checking, the
application itself must handle relationship issues.  For example, it must
take care to insert rows into tables in the proper
order, and to avoid creating orphaned child records. It must also be able to
recover from errors that occur in the middle of multiple-record insert
operations.

@item
If @code{ON DELETE} is the only referential integrity capability an
application needs, note that as of MySQL Server 4.0, you can use
multiple-table @code{DELETE} statements to delete rows from many
tables with a single statement. @xref{DELETE,  , @code{DELETE}}.

@item
A workaround for the lack of @code{ON DELETE} is to add
the appropriate @code{DELETE} statement to your application when you
delete records from a table that has a foreign key. In practice, this is often
as quick as using foreign keys, and is more portable.

@end itemize

Be aware that the use of foreign keys can in some instances lead
to problems:

@itemize @bullet
@item
Foreign key support addresses many referential integrity
issues, but it is still necessary to design key relationships carefully to avoid
circular rules or incorrect combinations of cascading deletes.

@item
It is not uncommon for a DBA to create a topology of relationships that
makes it difficult to restore individual tables from a backup.
(MySQL alleviates this difficulty by allowing you to temporarily disable
foreign key checks when reloading a table that depends on other tables.
@xref{InnoDB foreign key constraints}.
As of MySQL 4.1.1,
@code{mysqldump} generates dump files that take advantage of this
capability automatically when reloaded.)
@end itemize

Note that foreign keys in SQL are used to check and enforce referential
integrity, not to join tables.  If you want to get results from multiple
tables from a @code{SELECT} statement, you do this by performing a join
between them:

@example
SELECT * FROM table1,table2 WHERE table1.id = table2.id;
@end example

@xref{JOIN, , @code{JOIN}}. @xref{example-Foreign keys}.

The @code{FOREIGN KEY} syntax without @code{ON DELETE ...} is often used
by ODBC applications to produce automatic @code{WHERE} clauses.


@node ANSI diff Views, ANSI diff comments, ANSI diff Foreign Keys, Differences from ANSI
@subsubsection Views

@cindex views

Views are currently being implemented, and will appear in the 5.0 or 5.1
version of MySQL Server.
Unnamed views (@emph{derived tables}, a subquery in the @code{FROM}
clause of a @code{SELECT}) are already implemented in version 4.1.

Historically, MySQL Server has been most used in applications and on web
systems where the application writer has full control over database
usage. Usage has shifted over time, and so we find that an
increasing number of users now regard views as an important feature.

Views are useful for allowing users to access a set of relations (tables)
as if it were a single table, and limiting their access to just that.
Views can also be used to restrict access to rows (a subset of a
particular table).
One does not require views to restrict access to columns, as MySQL Server
has a sophisticated privilege system.
@xref{Privilege system}.

Many DBMS don't allow updates to a view. Instead, you have to perform the
updates on the individual tables.
In designing an implementation of views, our goal, as much as is possible
within the confines of SQL, is full compliance with
``@strong{Codd's Rule #6}'' for relational database systems: All views
that are theoretically updatable, should in practice also be updatable.


@node ANSI diff comments,  , ANSI diff Views, Differences from ANSI
@subsubsection @samp{--} as the Start of a Comment

@cindex comments, starting
@cindex starting, comments

Some other SQL databases use @samp{--} to start comments.
MySQL Server uses @samp{#} as the start comment character. You can also use
the C comment style @code{/* this is a comment */} with MySQL Server.
@xref{Comments}.

MySQL Server Version 3.23.3 and above support the @samp{--} comment style,
provided the comment is followed by a space (or by a control character such
as a newline). The requirement for a space is to prevent problems with
automatically generated SQL queries that have used something like the following code, where we automatically insert the value of the payment for
@code{!payment!}:

@example
UPDATE tbl_name SET credit=credit-!payment!
@end example

Think about what happens if the value of @code{payment} is a negative value
such as @code{-1}:

@example
UPDATE tbl_name SET credit=credit--1
@end example

@code{credit--1} is a legal expression in SQL, but if @code{--} is interpreted
as the start of a comment, part of the expression is discarded. The result is a
statement that has a completely different meaning than intended:

@example
UPDATE tbl_name SET credit=credit
@end example

The statement produces no change in value at all!  This illustrates that
allowing comments to start with @samp{--} can have serious consequences.

Using our implementation of this method of commenting in MySQL Server
Version 3.23.3 and up, @code{credit--1} is actually safe.

Another safe feature is that the @code{mysql} command-line client
removes all lines that start with @samp{--}.


The following information is relevant only if you are running a
MySQL version earlier than 3.23.3:

If you have an SQL program in a text file that contains @samp{--}
comments, you should use the @code{replace} utility as follows to convert the
comments to use @samp{#} characters:

@example
shell> replace " --" " #" < text-file-with-funny-comments.sql \
         | mysql database
@end example

instead of the usual:

@example
shell> mysql database < text-file-with-funny-comments.sql
@end example

You can also edit the command file ``in place'' to change the @samp{--}
comments to @samp{#} comments:

@example
shell> replace " --" " #" -- text-file-with-funny-comments.sql
@end example

Change them back with this command:

@example
shell> replace " #" " --" -- text-file-with-funny-comments.sql
@end example


@node Constraints, Bugs, Differences from ANSI, Compatibility
@subsection How MySQL Deals with Constraints

@findex constraints

MySQL allows you to work with both transactional tables that allow rollback and
non-transactional tables that do not, so constraint handling is
a bit different in MySQL than in other databases.

We have to handle the case when you have updated a lot of rows in a
non-transactional table that cannot roll back when an error occurs.

The basic philosophy is to try to give an error for anything that we can
detect at compile time but try to recover from any errors we get at runtime.
We do this in most cases, but not yet for all. @xref{TODO future}.

The options MySQL has when an error occurs are to stop the statement in the
middle or to recover as well as possible from the problem and continue.

The following sections describe what happens for the different types of
constraints.

@menu
* constraint primary key::      Constraint PRIMARY KEY / UNIQUE
* constraint NOT NULL::         Constraint @code{NOT NULL} and @code{DEFAULT} values
* constraint enum::             Constraint @code{ENUM} and @code{SET}
@end menu

@node constraint primary key, constraint NOT NULL, Constraints, Constraints
@subsubsection Constraint PRIMARY KEY / UNIQUE

@cindex PRIMARY KEY, constraint
@cindex foreign key, constraint
@cindex UNIQUE, constraint

Normally you will get an error when you try to @code{INSERT} or
@code{UPDATE} a row that causes a primary key, unique key or foreign key
violation.  If you are using a transactional storage engine such as
@code{InnoDB}, MySQL will automatically roll back the transaction.  If you are
using a non-transactional storage engine, MySQL will stop at the incorrect
row and leave any remaining rows unprocessed.

To make life easier, MySQL supports an @code{IGNORE} keyword for
most commands that can cause a key violation (such as @code{INSERT IGNORE}
and @code{UPDATE IGNORE}). In this case, MySQL will ignore any key
violation and continue with processing the next row.  You can get
information about what MySQL did with the @code{mysql_info()} API function.
@xref{mysql_info,  , @code{mysql_info()}}.
In MySQL 4.1 and up, you also can use the @code{SHOW WARNINGS} statement.
@xref{SHOW WARNINGS}.

Note that for the moment only @code{InnoDB} tables support foreign keys.
@xref{InnoDB foreign key constraints}.
Foreign key support in @code{MyISAM} tables is scheduled for implementation
in MySQL 5.1.


@node constraint NOT NULL, constraint enum, constraint primary key, Constraints
@subsubsection Constraint @code{NOT NULL} and @code{DEFAULT} values

@cindex NOT NULL, constraint
@cindex default values, suppression
@cindex suppression, default values

To be able to support easy handling of non-transactional tables all
columns in MySQL have default values. 

If you insert an ``incorrect'' value in a column, such as a @code{NULL} in a
@code{NOT NULL} column or a too-large numerical value in a numerical
column, MySQL sets the column to the ``best possible value''
instead of producing an error.  For numerical values, this is either 0, the
smallest possible value or the largest possible value. For strings, this is
either the empty string or the longest possible string that can be in
the column.

This means that if you try to store @code{NULL} into a column that
doesn't take @code{NULL} values, MySQL Server instead stores 0 or @code{''}
(the empty string). This last behavior can, for single row
inserts, be changed with the @code{-DDONT_USE_DEFAULT_FIELDS} compile
option.) @xref{configure options,  , @code{configure} options}.
This causes @code{INSERT} statements to generate an error unless you
explicitly specify values for all columns that require a non-@code{NULL}
value.

The reason for the preceding rules is that we can't check these conditions
until the query has begun executing.  We can't just roll back if we
encounter a problem after updating a few rows, because the table type may
not support rollback.  The option of terminating the statement is not that
good; in this case, the update would be ``half done,'' which is probably the
worst possible scenario.  In this case it's better to ``do the best you
can'' and then continue as if nothing happened.

This means that you should generally not use MySQL to check column content.
Instead, the application should ensure that is passes only legal values to
MySQL.

In MySQL 5.0, we plan to improve this by providing warnings when automatic
column conversions occur, plus an option to let you roll back statements
that attempt to perform a disallowed column value assignment, as long as the
statement uses only transactional tables.


@node constraint enum,  , constraint NOT NULL, Constraints
@subsubsection Constraint @code{ENUM} and @code{SET}

In MySQL 4.x, @code{ENUM} is not a real constraint, but is a more efficient
way to define columns that can only contain a given set of values.
This is because of the same reasons @code{NOT NULL} is not honored.
@xref{constraint NOT NULL}.

If you insert an incorrect value into an @code{ENUM} column, it will be set to
the reserved enumeration value @code{0}, which will be displayed as an empty
string in string context. @xref{ENUM}.

If you insert an incorrect value into a @code{SET} column, the incorrect value
is ignored. For example, if the column can contain the values
@code{'a'}, @code{'b'}, and @code{'c'}, an attempt to assign @code{'a,x,b,y'}
results in a value of @code{'a,b'}.
@xref{SET}.

@node Bugs,  , Constraints, Compatibility
@subsection Known Errors and Design Deficiencies in MySQL

@cindex bugs, known
@cindex errors, known
@cindex design, issues
@cindex known errors

@menu
* Errors in 3.23::              Errors in 3.23 Fixed in a Later MySQL Version
* Errors in 4.0::               Errors in 4.0 Fixed in a Later MySQL Version
* Open bugs::                   Open Bugs / Design Deficiencies in MySQL
@end menu

@node Errors in 3.23, Errors in 4.0, Bugs, Bugs
@subsubsection Errors in 3.23 Fixed in a Later MySQL Version

The following known errors or bugs are not fixed in MySQL 3.23 because fixing
them would involve changing a lot of code that could introduce other
even worse bugs. The bugs are also classified as ``not fatal'' or
``bearable.''

@itemize @bullet
@item
You can get a deadlock if you use @code{LOCK TABLE} to lock multiple tables
and then in the same connection use @code{DROP TABLE} to drop one of
them while another thread is trying to lock it.  (To break the deadlock, you
can use @code{KILL} to terminate any of the threads involved.) This issue is
resolved in MySQL 4.0.12.
@item
@code{SELECT MAX(key_column) FROM t1,t2,t3...} where one of the tables are
empty doesn't return @code{NULL} but instead returns the maximum value for the
column.  This issue is resolved in MySQL 4.0.11.
@item
@code{DELETE FROM heap_table} without a @code{WHERE} clause doesn't work on
a locked @code{HEAP} table.
@end itemize

@node Errors in 4.0, Open bugs, Errors in 3.23, Bugs
@subsubsection Errors in 4.0 Fixed in a Later MySQL Version

The following known errors or bugs are not fixed in MySQL 4.0 because fixing
them would involve changing a lot of code that could introduce other
even worse bugs. The bugs are also classified as ``not fatal'' or
``bearable.''

@itemize @bullet
@item
In a @code{UNION}, the first @code{SELECT} determines the type,
@code{max_length} and @code{NULL} properties for the resulting
columns.  This issue is resolved in MySQL 4.1.1; the property values are based
on the rows from all @code{UNION} parts.
@end itemize

@node Open bugs,  , Errors in 4.0, Bugs
@subsubsection Open Bugs / Design Deficiencies in MySQL

The following problems are known and fixing them is a high priority:

@itemize @bullet
@item
Dropping a @code{FOREIGN KEY} constraint doesn't work in replication as the
constraint may have another name.

@item
You cannot mix @code{UNION ALL} and @code{UNION DISTINCT} in the same query.
If you use @code{ALL} for one @code{UNION}, it is used for all
of them.

@item
If one user has a long running transaction and another user drops a
table that is updated in the transaction, there is small chance that the
binary log may contain the @code{DROP TABLE} command before the table is
used in the transaction itself.  We plan to fix this in 5.0 by
having the @code{DROP TABLE} wait until the table is not used in any
transaction.

@item
When inserting a big integer value (between 2^63 and 2^64-1) into a
decimal/string column, it is inserted as a negative value because
the number is evaluated in a signed integer context. It is planned
to be fixed in 4.1.

@item
@code{FLUSH TABLES WITH READ LOCK} does not block @code{CREATE TABLE} or
@code{COMMIT}, which make cause a problem with the binary log position when
doing a full backup of tables and the binary log.

@item
@code{ANALYZE TABLE} on a @code{BDB} table may in some cases make the table
unusable until one has restarted @code{mysqld}.  If this happens, you will
see errors of the following form in the MySQL error file:

@example
001207 22:07:56  bdb:  log_flush: LSN past current end-of-log
@end example

@item
MySQL accepts parentheses in the @code{FROM} part of a @code{SELECT}
statement, but silently
ignores them.  The reason for not giving an error is that many clients
that automatically generate queries add parentheses in the @code{FROM}
part even where they are not needed.

@item
Concatenating many @code{RIGHT JOINS} or combining @code{LEFT} and
@code{RIGHT} join in the same query may not give a correct answer as
MySQL only generates @code{NULL} rows for the table preceding a @code{LEFT} or
before a @code{RIGHT} join.  This will be fixed in 5.0 at the same time
we add support for parentheses in the @code{FROM} part.

@item
Don't execute @code{ALTER TABLE} on a @code{BDB} table on which you are
running multiple-statement transactions until all those transactions complete.
(The transaction will probably be ignored.)

@item
@code{ANALYZE TABLE}, @code{OPTIMIZE TABLE}, and @code{REPAIR TABLE} may
cause problems on tables for which you are using @code{INSERT DELAYED}.

@item
Doing a @code{LOCK TABLE ...} and @code{FLUSH TABLES ...} doesn't
guarantee that there isn't a half-finished transaction in progress on the
table.

@item
@code{BDB} tables are a bit slow to open. If you have many @code{BDB} tables in a
database, it will take a long time to use the @code{mysql} client on the
database if you are not using the @code{-A} option or if you are using
@code{rehash}. This is especially notable when you have a large table
cache.

@item
Replication uses query-level logging: The master writes the executed
queries to the binary log. This is a very fast, compact, and efficient
logging method that works perfectly in most cases.
Though we have never heard of it actually occurring, it is theoretically
possible for the data on the master and slave to become different if a
query is designed in such a way that the data modification is
non-deterministic, that is, left to the will of the query optimizer. (That
generally is not a good practice anyway, even outside of replication!)
For example: 

@itemize @minus
@item
@code{CREATE ... SELECT} or
@code{INSERT ... SELECT}  statements that
insert zero or @code{NULL} values into an @code{AUTO_INCREMENT} column.
@item
@code{DELETE} if you are
deleting rows from a table which has foreign keys with @code{ON DELETE
CASCADE} properties.
@item
@code{REPLACE ... SELECT}, 
@code{INSERT IGNORE ... SELECT} if you have
duplicate key values in the inserted data.
@end itemize
@strong{IF and only if all these queries have NO @code{ORDER BY}
clause guaranteeing a deterministic order}.

Indeed, for example for @code{INSERT ... SELECT} with no @code{ORDER
BY}, the @code{SELECT} may return rows in a different order
(which will result in a row having different ranks, hence getting a
different number in the @code{auto_increment} column),
depending on the choices made by the optimizers on the master and
slave. A query will be optimized differently on the master and slave only if:

@itemize @minus
@item
The files used by the two queries are not exactly the same; for
example @code{OPTIMIZE TABLE} was run on the master tables and not on
the slave tables (to fix this, since MySQL 4.1.1, @code{OPTIMIZE}, @code{ANALYZE}
and @code{REPAIR} are written to the binary log).
@item
The table is stored in a different storage engine on the master than
on the slave. (It is possible to use different storage engines on the master
and slave. For example, you can use @code{InnoDB} on the master,
but @code{MyISAM} on the slave if the slave has less available disk
space.)
@item
MySQL buffer sizes (@code{key_buffer_size}, etc.) are different on
the master and slave. 
@item
The master and slave run different MySQL versions, and the optimizer
code is different between these versions.
@end itemize

This problem may also affect database restoration using @code{mysqlbinlog|mysql}.

The easiest way to avoid this problem in all cases is add an
@code{ORDER BY} clause to 
such non-deterministic queries to ensure that the rows are always
stored or modified in the same order. 
In future MySQL versions, we will automatically add an @code{ORDER BY}
clause when needed.

@end itemize

The following problems are known and will be fixed in due time:

@itemize @bullet

@item
Log files are based on hostnames (if you don't specify a file name with
the startup option). For now you have to use options like
@code{--log-bin=old_host_name-bin} if you change your host name to
something else. Another option is to just rename the old files to
reflect your hostname change. @xref{Server options}.

@item
@code{mysqlbinlog} will not delete temporary files left after a
@code{LOAD DATA INFILE} command. @xref{mysqlbinlog,  , @code{mysqlbinlog}}.

@item
@code{RENAME} doesn't work with @code{TEMPORARY} tables or tables used in a
@code{MERGE} table.

@item
When using the @code{RPAD()} function in a query that has to be
resolved by using a temporary table, all resulting strings will
have rightmost spaces removed. This is an example of such a query:

@example
SELECT RPAD(t1.column1, 50, ' ') AS f2, RPAD(t2.column2, 50, ' ') AS f1
FROM table1 as t1 LEFT JOIN table2 AS t2 ON t1.record=t2.joinID
ORDER BY t2.record;
@end example

The final result of this bug is that you will not be able to get spaces on
the right side of the resulting values. The problem also occurs for any other
string function that adds spaces to the right.

The reason for this is due to the fact that @code{HEAP} tables, which are used
first for temporary tables, are not capable of handling @code{VARCHAR} columns.

This behavior exists in all versions of MySQL. 
It will be fixed in one of the 4.1 series releases.

@item
Due to the way table definition files are stored, you cannot use
character 255 (@code{CHAR(255)}) in table names, column names, or enumerations.
This is scheduled to be fixed in version 5.1 when we have new table
definition format files.

@item
When using @code{SET CHARACTER SET}, you can't use translated
characters in database, table, and column names.

@item
You can't use @code{_} or @code{%} with @code{ESCAPE} in @code{LIKE
... ESCAPE}.

@item
If you have a @code{DECIMAL} column with a  number stored in different
formats (+01.00, 1.00, 01.00), @code{GROUP BY} may regard each value
as a different value.

@item
@code{DELETE FROM merge_table} used without a @code{WHERE} clause
will clear only the mapping for the table, not delete everything in the
mapped tables.

@item
You cannot build the server in another directory when using
MIT-pthreads. Because this requires changes to MIT-pthreads, we are not
likely to fix this. @xref{MIT-pthreads}.

@item
@code{BLOB} values can't ``reliably'' be used in @code{GROUP BY} or
@code{ORDER BY} or @code{DISTINCT}. Only the first @code{max_sort_length}
bytes are used when comparing @code{BLOB} values in these cases.
The default value of @code{max_sort_length} value is 1024. It can be changed
at server startup time.  A workaround for most cases is to use a substring.
For example:
@code{SELECT DISTINCT LEFT(blob,2048) FROM tbl_name}.

@item
Numeric
calculations are done with @code{BIGINT} or @code{DOUBLE} (both are
normally 64 bits long). It depends on the function which precision one
gets. The general rule is that bit functions are done with @code{BIGINT}
precision, @code{IF}, and @code{ELT()} with @code{BIGINT} or @code{DOUBLE}
precision and the rest with @code{DOUBLE} precision.  You should try to
avoid using unsigned long long values if they resolve to be bigger than
63 bits (9223372036854775807) for anything other than bit fields.
MySQL Server 4.0 has better @code{BIGINT} handling than 3.23.

@item
All string columns, except @code{BLOB} and @code{TEXT} columns, automatically
have all trailing spaces removed when retrieved. For @code{CHAR} types this
is okay. The bug is
that in MySQL Server, @code{VARCHAR} columns are treated the same way.

@item
You can only have up to 255 @code{ENUM} and @code{SET} columns in one table.

@item
In @code{MIN()}, @code{MAX()}, and other aggregate functions, MySQL
currently compares @code{ENUM} and @code{SET} columns by their string
value rather than by the string's relative position in the set.

@item
@code{mysqld_safe} redirects all messages from @code{mysqld} to the
@code{mysqld} log.  One problem with this is that if you execute
@code{mysqladmin refresh} to close and reopen the log,
@code{stdout} and @code{stderr} are still redirected to the old log.
If you use @code{--log} extensively, you should edit @code{mysqld_safe} to
log to @file{'hostname'.err} instead of @file{'hostname'.log} so you can
easily reclaim the space for the old log by deleting the old one and
executing @code{mysqladmin refresh}.

@item
In the @code{UPDATE} statement, columns are updated from left to right.  If
you refer to an updated column, you will get the updated value instead of the
original value. For example:

@example
mysql> UPDATE tbl_name SET KEY=KEY+1,KEY=KEY+1;
@end example

This will increment @code{KEY} by @code{2}, not @code{1}.

@item
You can refer to multiple temporary tables in the same query, but
you cannot refer to any given temporary table more than once.
For example, the following doesn't work:

@example
mysql> SELECT * FROM temporary_table, temporary_table AS t2;
@end example

@item
The optimizer may handle @code{DISTINCT} differently if you are using
'hidden' columns in a join or not.  In a join, hidden columns are
counted as part of the result (even if they are not shown) while in
normal queries hidden columns don't participate in the @code{DISTINCT}
comparison.  We will probably change this in the future to never compare
the hidden columns when executing @code{DISTINCT}.

An example of this is:

@example
SELECT DISTINCT mp3id FROM band_downloads
       WHERE userid = 9 ORDER BY id DESC;
@end example

and

@example
SELECT DISTINCT band_downloads.mp3id
       FROM band_downloads,band_mp3
       WHERE band_downloads.userid = 9
       AND band_mp3.id = band_downloads.mp3id
       ORDER BY band_downloads.id DESC;
@end example

In the second case you may in MySQL Server 3.23.x get two identical rows in
the result set (because the values in the hidden @code{id} column may differ).

Note that this happens only for queries where you don't have the
@code{ORDER BY} columns in the result, something that you are not allowed
to do in SQL-92.

@item
Because MySQL Server allows you to work with table types that don't
support transactions, and thus can't roll back data, some things
behave a little differently in MySQL Server than in other SQL servers.
This is just to ensure that MySQL Server never needs to do a rollback
for an SQL statement.  This may be a little awkward at times as column
values must be checked in the application, but this will actually give
you a nice speed increase as it allows MySQL Server to do some
optimizations that otherwise would be very hard to do.

If you set a column to an incorrect value, MySQL Server will, instead of
doing a rollback, store the @code{best possible value} in the column:

@itemize @minus
@item
If you try to store a value outside the range in a numerical column,
MySQL Server instead stores the smallest or largest possible value in
the column.

@item
If you try to store a string that doesn't start with a number into a
numerical column, MySQL Server stores 0.

@item
If you try to store @code{NULL} into a column that doesn't allow
@code{NULL} values, MySQL Server stores 0 or @code{''} (the empty
string) in it instead. (This behavior can, however, be changed with the
@code{-DDONT_USE_DEFAULT_FIELDS} compile option.)

@item
MySQL allows you to store some wrong date values into @code{DATE} and
@code{DATETIME} columns (like @code{'2000-02-31'} or @code{'2000-02-00'}).
The idea is that it's not the job of the SQL server to validate dates. If
MySQL can store a date value and retrieve exactly the same value, MySQL
stores it as given.  If the date is totally wrong (outside the server's
ability to store it), the special date value @code{'0000-00-00'} is stored
in the column instead.

@item
If you set an @code{ENUM} column to an unsupported value, it is set to
the error value @code{empty string}, with numeric value 0.

@item
If you set a @code{SET} column to an unsupported value, the value is ignored.

@end itemize

@item
If you execute a @code{PROCEDURE} on a query that returns an empty set,
in some cases the @code{PROCEDURE} will not transform the columns.

@item
Creation of a table of type @code{MERGE} doesn't check if the underlying
tables are of compatible types.

@item
MySQL Server can't yet handle @code{NaN}, @code{-Inf}, and @code{Inf}
values in @code{DOUBLE} columns. Using these will cause problems when trying to export
and import data. We should as an intermediate solution change @code{NaN} to
@code{NULL} (if possible) and @code{-Inf} and @code{Inf} to the
minimum respective maximum possible @code{double} value.

@item
If you use @code{ALTER TABLE} to first add a @code{UNIQUE} index to a
table used in a @code{MERGE} table and then use @code{ALTER TABLE} to
add a normal index on the @code{MERGE} table, the key order will be
different for the tables if there was an old key that was not unique in the
table. This is because @code{ALTER TABLE} puts @code{UNIQUE} indexes before
normal indexes to be able to detect duplicate keys as early as possible.
@end itemize

The following are known bugs in earlier versions of MySQL:

@itemize @bullet
@item
You can get a hung thread if you do a @code{DROP TABLE} on a table that is
one among many tables that is locked with @code{LOCK TABLES}.

@item
In the following case you can get a core dump:

@itemize @minus
@item
Delayed insert handler has pending inserts to a table.

@item
@code{LOCK table} with @code{WRITE}.

@item
@code{FLUSH TABLES}.
@end itemize

@item
Before MySQL Server Version 3.23.2 an @code{UPDATE} that updated a key with
a @code{WHERE} on the same key may have failed because the key was used to
search for records and the same row may have been found multiple times:

@example
UPDATE tbl_name SET KEY=KEY+1 WHERE KEY > 100;
@end example

A workaround is to use:

@example
mysql> UPDATE tbl_name SET KEY=KEY+1 WHERE KEY+0 > 100;
@end example

This will work because MySQL Server will not use an index on expressions in
the @code{WHERE} clause.

@item
Before MySQL Server Version 3.23, all numeric types were treated as
fixed-point fields. That means you had to specify how many decimals
a floating-point field should have. All results were returned with the
correct number of decimals.
@end itemize

For platform-specific bugs, see the sections about compiling and porting.
@xref{Installing source}.
@xref{Porting}.


@node Installing, Tutorial, Introduction, Top
@chapter Installing MySQL

@c TODO: each major section needs intro about what's in section.
@c TODO: need post-install section that is explicitly about setting the
@c initial access privileges.

@cindex installing, overview

@menu
* General Installation Issues::  General Installation Issues
* Quick Standard Installation::  Standard MySQL Installation Using a Binary Distribution
* Installing source::           MySQL Installation Using a Source Distribution
* Post-installation::           Post-installation Setup and Testing
* Upgrade::                     Upgrading/Downgrading MySQL
* Operating System Specific Notes::  Operating System Specific Notes
* Perl support::                Perl Installation Notes
@end menu

This chapter describes how to obtain and install MySQL:

@enumerate

@item
@strong{Determine whether your platform is supported.}  Please note that
not all supported systems are equally good for running MySQL on them.
On some it is much more robust and efficient than others.
See @ref{Which OS} for details.

@item
@strong{Choose a distribution to install.}  Several versions of MySQL are available,
and most are available in serveral distribution formats.  You can choose
from pre-packaged distributions containing binary (precompiled) programs or
source code.  When in doubt, use a binary distribution.  We also provide
public access to our current source tree, for those who want to see our most
recent developments and help us test new code.  To determine which version
and type of distribution you should use, see @ref{Which version}.

@item
@strong{Download the distribution that you want to install.}
For a list of sites from which you can obtain MySQL, see
@ref{Getting MySQL, , Getting MySQL}.
You can verify the integrity of the distribution using the instructions in
@ref{Verifying Package Integrity}.

@item
@strong{Install the distribution.}  For binary distributions, use the
instructions in in @ref{Installing binary}.  For source distributions,
use the instructions in @ref{Installing source}.
Additional installation procedures include the following:

@itemize @bullet
@item
For post-installation procedures, see @ref{Post-installation}.  These
procedures apply whether you install MySQL using a binary or
source distribution.

@item
If you plan to upgrade an existing version of MySQL to a newer version
rather than installing MySQL for the first time, see @ref{Upgrade} for
information about upgrade procedures and about issues that you should
consider before upgrading.

@item
If you want to run the MySQL benchmark scripts, Perl support for MySQL
must be available.
@xref{Perl support}.

@end itemize

@end enumerate

The last part of the chapter provides information on
system-specific problems you may run into.


@node General Installation Issues, Quick Standard Installation, Installing, Installing
@section General Installation Issues

@c @node Methods of Installation, , ,
@c @subsection Methods of Installation

Before installing MySQL, you should do the following:

@enumerate
@item
Determine whether or not MySQL runs on your platform.

@item
Choose a distribution to install.

@item
Download the distribution and verify its integrity.

@end enumerate

This section contains the information necessary to carry out these steps.
After doing so, you can use the instructions in later sections of the chapter
to install the distribution that you choose.

@menu
* Which OS::                    Operating Systems Supported by MySQL
* Which version::               Choosing Which MySQL Distribution to Install
* Getting MySQL::               How to Get MySQL
* Verifying Package Integrity::   Verifying Package Integrity Using MD5 Checksums or @code{GnuPG}
* Installation layouts::        Installation Layouts
@end menu



@node Which OS, Which version, General Installation Issues, General Installation Issues
@subsection Operating Systems Supported by MySQL

@cindex operating systems, supported
@cindex native thread support
@cindex thread support
@cindex process support
@cindex support, for operating systems

This section lists the operating systems on which you can expect to be able to
run MySQL.

We use GNU Autoconf, so it is possible to port MySQL to all modern systems
that have a C++ compiler and a working implementation of POSIX threads.
(Thread suport is needed for the server. To compile only the client code,
the only requirement is a C++ compiler.) We use and develop the software
ourselves primarily on Linux (SuSE and Red Hat), FreeBSD, and Sun Solaris
(Versions 8 and 9).

MySQL has been reported to compile successfully on the following
combinations of operating system and thread package.  Note that for many
operating systems, native thread support works only in the latest versions.

@itemize @bullet
@item
AIX 4.x, 5.x with native threads.  @xref{IBM-AIX}.
@item
Amiga.
@item
BSDI 2.x with the MIT-pthreads package.  @xref{BSDI}.
@item
BSDI 3.0, 3.1 and 4.x with native threads.  @xref{BSDI}.
@item
DEC Unix 4.x with native threads.  @xref{Alpha-DEC-UNIX}.
@item
FreeBSD 2.x with the MIT-pthreads package.  @xref{FreeBSD}.
@item
FreeBSD 3.x and 4.x with native threads.  @xref{FreeBSD}.
@item
FreeBSD 4.x with Linuxthreads.  @xref{FreeBSD}.
@item
HP-UX 10.20 with the DCE threads or the MIT-pthreads package.
@xref{HP-UX 10.20}.
@item
HP-UX 11.x with the native threads.  @xref{HP-UX 11.x}.
@item
Linux 2.0+ with LinuxThreads 0.7.1+ or @code{glibc} 2.0.7+.  @xref{Linux}.
@item
Mac OS X.  @xref{Mac OS X}.
@item
NetBSD 1.3/1.4 Intel and NetBSD 1.3 Alpha (Requires GNU make).  @xref{NetBSD}.
@item
Novell NetWare 6.0.  @xref{NetWare installation}.
@item
OpenBSD > 2.5 with native threads. OpenBSD < 2.5 with the
MIT-pthreads package.  @xref{OpenBSD}.
@item
OS/2 Warp 3, FixPack 29 and OS/2 Warp 4, FixPack 4.  @xref{OS/2}.
@item
SCO OpenServer with a recent port of the FSU Pthreads package. 
@xref{SCO}.
@item
SCO UnixWare 7.1.x.  @xref{SCO UnixWare}.
@item
SGI Irix 6.x with native threads.  @xref{SGI-Irix}.
@item
Solaris 2.5 and above with native threads on SPARC and x86.  @xref{Solaris}.
@item
SunOS 4.x with the MIT-pthreads package.  @xref{Solaris}.
@item
Tru64 Unix
@item
Windows 9x, Me, NT, 2000, and XP.  @xref{Windows installation}.
@end itemize

Not all platforms are equally well-suited for running
MySQL. How well a certain platform is suited for a high-load
mission-critical MySQL server is determined by the following
factors:

@itemize @bullet
@item
General stability of the thread library. A platform may have an excellent
reputation otherwise, but MySQL will be only as stable as the thread library
if that library is unstable in the code that is called by MySQL, even if
everything else is perfect.

@item
The ability of the kernel and/or thread library to take advantage of
symmetric multi-processor (SMP) systems. In other words, when a process
creates a thread, it should be possible for that thread to run on a different
CPU than the original process.

@item
The ability of the kernel and/or the thread library to run many threads which
acquire and release a mutex over a short critical region frequently without
excessive context switches. In other words, if the implementation of
@code{pthread_mutex_lock()} is too anxious to yield CPU time, this will hurt
MySQL tremendously. If this issue is not taken care of, adding extra CPUs
will actually make MySQL slower.

@item
General filesystem stability and performance.

@item
If your tables are big, the ability of the filesystem to deal with large
files at all and to deal with them efficiently.

@item
Our level of expertise here at MySQL AB with the platform. If we know
a platform well, we enable platform-specific optimizations and fixes at
compile time. We can also provide advice on configuring your system optimally
for MySQL.

@item
The amount of testing we have done internally for similar configurations.

@item
The number of users that have successfully run MySQL on that
platform in similar configurations. If this number is high, the chances of
encountering platform-specific surprises are much smaller.
@end itemize

Based on the preceding criteria, the best platforms for running
MySQL at this point are x86 with SuSE Linux 8.2, 2.4 kernel, and
ReiserFS (or any similar Linux distribution) and SPARC with Solaris
(2.7-9). FreeBSD comes third, but we really hope it will join the top
club once the thread library is improved. We also hope that at some
point we will be able to include into the top category all other platforms
on which MySQL currently compiles and runs okay, but not quite with the
same level of stability and performance.  This will require some
effort on our part in cooperation with the developers of the operating system
and library components that MySQL depends on. If you are interested in
improving one of those components, are in a position to influence its
development, and need more detailed instructions on what MySQL
needs to run better, send an email message to the MySQL internals mailing list.
@xref{Mailing-list}.

Please note that the purpose of the preceding comparison is not to say that
one operating system is better or worse than another in general. We are talking only about
choosing an OS for the specific purpose of running MySQL.  With this in
mind, the result of this comparison would be different if we considered more
factors. And in some cases, the reason one OS is better than the other could
simply be that we have put forth more effort into testing on and optimizing
for that particular platform.  We are just stating our observations to help
you decide which platform to use MySQL in your setup.


@node Which version, Getting MySQL, Which OS, General Installation Issues
@subsection Choosing Which MySQL Distribution to Install

@c TODO: We need to define what a "release" is, i.e., when we assign a new
@c version number a produce distributions that users can grab and install.
@c Also, define "release series", and "distribution" (an installable package).
@c TODO: This needs to describe the Standard/Max/Pro/Classic breakdown
@c TODO: This needs to describe distribution formats as well
@c (.tar.gz, RPM, PKG, .msi)

When preparing to install MySQL, you should decide which version
to use.  MySQL development occurs in several release series, and
you can pick the one that best fits your needs.  After deciding
which version to install, you can choose a distribution format.
Releases are available in binary or source format.


@menu
* Choosing version::            Choosing Which Version of MySQL to Install
* Choosing distribution format::  Choosing a Distribution Format
* Many versions::               How and When Updates Are Released
* Release philosophy::          Release Philosophy---No Known Bugs in Releases
* MySQL binaries::              MySQL Binaries Compiled by MySQL AB
@end menu

@cindex MySQL binary distribution
@cindex MySQL source distribution
@cindex release numbers
@cindex version, choosing
@cindex choosing, a MySQL version

@node Choosing version, Choosing distribution format, Which version, Which version
@subsubsection Choosing Which Version of MySQL to Install

The first decision to make is whether you want to use a production (stable)
release or a development release.  In the MySQL development process,
multiple release series co-exist, each at a different stage of maturity:

@itemize @bullet

@item
MySQL 5.0 is the newest development release series and is under very active
development for new features. Until recently it was available only in
preview form from the BitKeeper source repository. An early alpha release
has now been issued to allow more widespread testing.

@item
MySQL 4.1 is a development release series to which major new features have
been added. It is still at alpha status. Sources and binaries are available
for use and testing on development systems.

@item
MySQL 4.0 is the current stable/production-quality release series.
New releases are issued for bugfixes. No new features are added
that could diminish the code stability.

@item
MySQL 3.23 is the old stable/production-quality release series.
This series is retired, so new releases are issued only to fix
critical bugs.

@end itemize

We don't believe in a complete freeze, as this also leaves out bug fixes and
things that ``must be done.''  ``Somewhat frozen'' means that we may add
small things that ``almost surely will not affect anything that's already
working.'' Naturally, relevant bugfixes from an earlier series propagate to
later series.

@itemize @bullet
@item
Normally, if you are beginning to use MySQL for the first time or trying
to port it to some system for which there is no binary distribution, we
recommend going with the production release series. Currently this is MySQL
4.0.  Note that all MySQL releases, even those from development series, are
checked with the MySQL benchmarks and an extensive test suite before being
issued.

@item
If you are running an old system and want to upgrade, but
don't want to take chances with a non-seamless upgrade, you should
upgrade to the latest version in the same release series you are using (where
only the last part of the version number is newer than yours).  We have tried
to fix only fatal bugs and make small, relatively safe changes to that version.

@item
If you want to use new features not present in the production release
series, you can use a version from a development series. Note that
development releases are not as stable as production releases.

@item
If you want to use the very latest sources containing all current patches and
bugfixes, you can use one of our BitKeeper repositories.
These are not ``releases'' as such, but are available as previews of the
code on which future releases will be based.
@end itemize

@cindex naming, releases of MySQL
@cindex releases, naming scheme

The MySQL naming scheme uses release names that consist of three
numbers and a suffix, for example, @code{mysql-4.1.0-alpha}.
The numbers within the release name are is interpreted like this:

@itemize @bullet
@item
The first number (@code{4}) is the major version and also describes the
file format.  All Version 4 releases have the same file format.

@item
The second number (@code{1}) is the release level.
Taken together, the major version and release level constitute the release
series number.

@item
The third number (@code{0}) is the version number within the
release series.  This is incremented for each new release.  Usually you
want the latest version for the series you have chosen.

@end itemize

For each minor update, the last number in the version string is incremented.
When there are major new features or minor incompatibilities with previous
versions, the second number in the version string is incremented.  When the
file format changes, the first number is increased.

Release names also include a suffix to indicates the stability level of the
release.  Releases within a series progress through a set of suffixes to
indicate how the stability level improves.
The possible suffixes are:

@itemize @bullet
@item
@code{alpha} indicates that the release contains some large section of
new code that hasn't been 100% tested.  Known bugs (usually there are none)
should be documented in the News section.  @xref{News}.  There are also new
commands and extensions in most alpha releases.  Active development that
may involve major code changes can occur in an alpha release, but everything
will be tested before issuing a release.  For this reason, there should be
no known bugs in any MySQL release.

@item
@code{beta} means that all new code has been tested.  No major new
features that could cause corruption in old code are added.  There should
be no known bugs.  A version changes from alpha to beta when there
haven't been any reported fatal bugs within an alpha version for at least
a month and we have no plans to add any features that could make any old
command unreliable.

@item
@code{gamma} is a beta that has been around a while and seems to work fine.
Only minor fixes are added.  This is what many other companies call a release.

@item
If there is no suffix, it means that the version has been run for a
while at many different sites with no reports of bugs other than
platform-specific bugs.  Only critical bug fixes are applied to the
release. This is what we call a production (stable) release.
@end itemize

MySQL uses a naming scheme that is slightly different from most other products.
In general, it's relatively safe to use any version that has been out for
a couple of weeks without being replaced with a new version within the release
series.

All releases of MySQL are run through our standard tests and
benchmarks to ensure that they are relatively safe to use.  Because the
standard tests are extended over time to check for all previously found bugs,
the test suite keeps getting better.

@cindex releases, testing
@cindex testing, of MySQL releases

Note that all releases have been tested at least with:

@table @asis
@item An internal test suite
The @file{mysql-test} directory contains an extensive set of test cases.
@c TODO: remove "virtually" when you don't need Cygwin for Windows
We run these tests for virtually every server binary.
See @ref{MySQL test suite} for more information about this test suite.

@item The MySQL benchmark suite
This suite runs a range of common queries.  It is also a test to see whether the
latest batch of optimizations actually made the code faster.
@xref{MySQL Benchmarks}.

@item The @code{crash-me} test
This test tries to determine what features the database supports and what its
capabilities and limitations are.  @xref{MySQL Benchmarks}.
@end table

Another test is that we use the newest MySQL version in our internal
production environment, on at least one machine.  We have more than 100
gigabytes of data to work with.


@node Choosing distribution format, Many versions, Choosing version, Which version
@subsubsection Choosing a Distribution Format

After choosing which version of MySQL to install, you should decide
whether to use a binary distribution or a source distribution.  In
most cases you should probably use a binary distribution, if one
exists for your platform. Binary distributions are available in native format
for many platforms, such as RPM files for Linux or DMG package installers for
Mac OS X. Distributions also are available as Zip archives or compressed
@code{tar} files. 

Reasons to choose a binary distribution include the following:

@itemize @bullet
@item
Binary distributions generally are easier to install than source distributions.

@c TODO: This makes a false characterization of max vs. non-max as
@c transactional vs. non-transactional.  Replace this with descriptions
@c of Standard/Max/Pro/Classic?

@item
To satisfy different user requirements, we provide two
different binary versions: one compiled with the non-transactional storage
engines (a small, fast binary), and one configured with the most
important extended options like transaction-safe tables.  Both versions
are compiled from the same source distribution.  All native MySQL
clients can connect to both MySQL versions.

The extended MySQL binary distribution is marked with the
@code{-max} suffix and is configured with the same options as
@code{mysqld-max}. @xref{mysqld-max, , @code{mysqld-max}}.

If you want to use the @code{MySQL-Max} RPM, you must first
install the standard @code{MySQL-server} RPM.

@end itemize

Circumstances under which you probably will be better off with a source
installation include the following:

@itemize @bullet
@item
You want to install MySQL at some explicit location.  The standard
binary distributions are ``ready to run'' at any place, but you may want
to have even more flexibility to place MySQL components where you want.

@item
You want to configure @code{mysqld} with some extra features that are
not in the standard binary distributions.  Here is a list of the most
common extra options that you may want to use:

@itemize @bullet
@item @code{--with-innodb} (default for MySQL 4.0 and onwards)
@item @code{--with-berkeley-db} (not available on all platforms)
@item @code{--with-raid}
@item @code{--with-libwrap}
@item @code{--with-named-z-libs} (This is done for some of the binaries)
@item @code{--with-debug[=full]}
@end itemize

@item
You want to configure @code{mysqld} without some features that are
included in the standard binary distributions. For example,
distributions normally are compiled with support for all character
sets. If you want a smaller MySQL server, you can recompile it with support
for only the character sets you need.

@item
You have a special compiler (like @code{pgcc}) or want to use compiler
options that are better optimized for your processor.  Binary distributions
are compiled with options that should work on a variety of processors from
the same processor family.

@item
You want to use the latest sources from one of the BitKeeper
repositories to have access to all current bugfixes. For example,
if you have found a bug and reported it to the MySQL development
team, the bugfix will be committed to the source repository and you
can access it there.  The bugfix will not appear in a release until
a release actually is issued.

@item
You want to read (or modify) the C and C++ code that makes up MySQL. For
this purpose, you should get a source distribution, because the source code
is always the ultimate manual.  Source distributions also contain more tests
and examples than binary distributions.

@end itemize


@node Many versions, Release philosophy, Choosing distribution format, Which version
@subsubsection How and When Updates Are Released

@cindex releases, updating
@cindex updating, releases of MySQL

MySQL is evolving quite rapidly here at MySQL AB and we want to share
new developments with other MySQL users.  We try to make a release
when we have very useful features that others seem to have a need for.

We also try to help out users who request features that are easy to
implement.  We take note of what our licensed users want to have, and
we especially take note of what our extended email supported customers
want and try to help them out.

No one has to download a new release.  The News section will tell you if
the new release has something you really want.  @xref{News}.

We use the following policy when updating MySQL:

@itemize @bullet
@item
Releases are issued within each release series. For each release, the last
number in the version is one more than the previous release within the same
series.

@item
Production (stable) releases are meant to appear about 1-2 times a year,
but if small bugs are found, a release with only bug fixes will be issued.

@item
Working releases/bug fixes to old releases are meant to appear about
every 4-8 weeks.

@item
Binary distributions for some platforms are made by us for major releases.
Other people may make binary distributions for other systems, but probably
less frequently.

@item
We usually make fixes available as soon as we have identified and corrected
small or non-critical but annoying bugs. The fixes
are available immediately from our public BitKeeper repositories, and will
be included in the next release.

@item
If by any chance a fatal bug is found in a release, we will make a new
release as soon as possible.  We would like other companies to do this,
too.
@end itemize


@node Release philosophy, MySQL binaries, Many versions, Which version
@subsubsection Release Philosophy---No Known Bugs in Releases

We put a lot of time and effort into making our releases bug free.
To our knowledge, we have not released a single MySQL version with any
@emph{known} ``fatal'' repeatable bugs.
(A fatal bug is something that crashes MySQL under normal usage,
produces incorrect answers for normal queries, or has a security problem.)

We have documented all open problems, bugs, and issues that are
dependent on design decisions.
@xref{Bugs}.

Our aim is to fix everything that is fixable without risk of
making a stable MySQL version less stable. In certain cases, this
means we can fix an issue in the development versions, but not
in the stable (production) version. Naturally, we document such
issues so that users are aware.

Here is a description of how our build process works:
@itemize @bullet
@item
We monitor bugs from our customer support list, the bugs database at
@uref{http://bugs.mysql.com/}, and the MySQL external mailing lists.
@item
All reported bugs for live versions are entered into the bugs database.
@item
When we fix a bug, we always try to make a test case for it and
include it into our test system to ensure that the bug will never
recur without being detected. (About 90% of all fixed bugs have a test case.)
@item
We also create test cases for all new features we add to MySQL.
@item
Before we start to build a new MySQL release, we ensure that all
reported repeatable bugs for the MySQL version (3.23.x, 4.0.x, etc)
are fixed.  If something is impossible to fix (due to some internal
design decision in MySQL) we document this in the manual.
@xref{Bugs}.
@item
We do a build on all platforms for which we support binaries (15+
platforms) and run our test suite and benchmark suite on all of them.
@item
We will not publish a binary for a platform for which the test or
benchmark suite fails.  If it's a general error in the source, we fix
this and do the build plus tests on all systems again, from scratch.
@item
The build and test process takes 2-3 days).  If we receive a report regarding
a fatal bug during this process (for example, one that causes
a core dump), we fix the problem and restart the build process.
@item
After publishing the binaries on @uref{http://www.mysql.com/}, we send
out an announcement message to the @code{mysql} and @code{announce} mailing
lists.
@xref{Mailing-list}.
The announcement message contains a list
of all changes to the release and any known problems with the release.
(The ``known problems'' section in the release notes has only been needed
in a handful of releases.)
@item
To quickly give our users access to the latest MySQL features, we do
a new MySQL release every 4-8 weeks.
Source code snapshots are built daily and are available at
@uref{http://downloads.mysql.com/snapshots.php}.
@item
If we, after the release is done, get any bug reports that there was
(after all) anything critically wrong with the build on a specific
platform, we will fix this at once and build a new @code{'a'} release
for that platform. Thanks to our large user base, problems are found
quickly.
@item
Our track record for making good releases is quite good.  In the last
150 releases, we had to do a new build for less than 10 releases (in 3
of these cases, the bug was a faulty @code{glibc} library on one of our build
machines that took us a long time to track down).
@end itemize


@node MySQL binaries,  , Release philosophy, Which version
@subsubsection MySQL Binaries Compiled by MySQL AB

@cindex binary distributions

As a service, we at MySQL AB provide a set of binary distributions
of MySQL that are compiled at our site or at sites where customers
kindly have given us access to their machines. 

In addition to the binaries provided in platform-specific package formats
(see @ref{Quick Standard Installation}), we do offer binary distributions
for a number of platforms in the form of of compressed tar files
(@code{.tar.gz}).

These distributions are generated using the script
@code{Build-tools/Do-compile} which compiles the source code and creates the
binary @code{tar.gz} archive using @code{scripts/make_binary_distribution}
These binaries are configured and built with the following compilers and
options.

Binaries built on MySQL AB development systems:

@table @asis

@item Linux 2.4.xx x86 with @code{gcc} 2.95.3:
@code{CFLAGS="-O2 -mcpu=pentiumpro" CXX=gcc CXXFLAGS="-O2 -mcpu=pentiumpro -felide-constructors" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile --enable-assembler --disable-shared --with-client-ldflags=-all-static --with-mysqld-ldflags=-all-static}

@item Linux 2.4.xx Intel Itanium 2 with @code{ecc} (Intel C++ Itanium Compiler 7.0):
@code{CC=ecc CFLAGS="-O2 -tpp2 -ip -nolib_inline" CXX=ecc CXXFLAGS="-O2 -tpp2 -ip -nolib_inline" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile}

@item Linux 2.4.xx Intel Itanium with @code{ecc} (Intel C++ Itanium Compiler 7.0):
@code{CC=ecc CFLAGS=-tpp1 CXX=ecc CXXFLAGS=-tpp1 ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile}

@item Linux 2.4.xx alpha with @code{ccc} (Compaq C V6.2-505 / Compaq C++ V6.3-006):
@code{CC=ccc CFLAGS="-fast -arch generic" CXX=cxx CXXFLAGS="-fast -arch generic -noexceptions -nortti" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile --with-mysqld-ldflags=-non_shared --with-client-ldflags=-non_shared --disable-shared}

@item Linux 2.4.xx s390 with @code{gcc} 2.95.3:
@code{CFLAGS="-O2" CXX=gcc CXXFLAGS="-O2 -felide-constructors" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile --disable-shared --with-client-ldflags=-all-static --with-mysqld-ldflags=-all-static}

@item Linux 2.4.xx x86_64 (AMD64) with @code{gcc} 3.2.1:
@code{CXX=gcc ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile  --disable-shared}

@item Sun Solaris 8 x86 with @code{gcc} 3.2.3:
@code{CC=gcc CFLAGS="-O3 -fno-omit-frame-pointer" CXX=gcc CXXFLAGS="-O3 -fno-omit-frame-pointer -felide-constructors -fno-exceptions -fno-rtti" ./configure --prefix=/usr/local/mysql --localstatedir=/usr/local/mysql/data --libexecdir=/usr/local/mysql/bin --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile  --disable-shared --with-innodb}

@item Sun Solaris 8 SPARC with @code{gcc} 3.2:
@code{CC=gcc CFLAGS="-O3 -fno-omit-frame-pointer" CXX=gcc CXXFLAGS="-O3 -fno-omit-frame-pointer -felide-constructors -fno-exceptions -fno-rtti" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile --enable-assembler --with-named-z-libs=no --with-named-curses-libs=-lcurses --disable-shared}

@item Sun Solaris 8 SPARC 64-bit with @code{gcc} 3.2:
@code{CC=gcc CFLAGS="-O3 -m64 -fno-omit-frame-pointer" CXX=gcc CXXFLAGS="-O3 -m64 -fno-omit-frame-pointer -felide-constructors -fno-exceptions -fno-rtti" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile --enable-assembler --with-named-z-libs=no --with-named-curses-libs=-lcurses --disable-shared}

@item Sun Solaris 9 SPARC with @code{gcc} 2.95.3:
@code{CC=gcc CFLAGS="-O3 -fno-omit-frame-pointer" CXX=gcc CXXFLAGS="-O3 -fno-omit-frame-pointer -felide-constructors -fno-exceptions -fno-rtti" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile --enable-assembler --with-named-curses-libs=-lcurses --disable-shared}

@item Sun Solaris 9 SPARC with @code{cc-5.0} (Sun Forte 5.0):
@code{CC=cc-5.0 CXX=CC ASFLAGS="-xarch=v9" CFLAGS="-Xa -xstrconst -mt -D_FORTEC_ -xarch=v9" CXXFLAGS="-noex -mt -D_FORTEC_ -xarch=v9" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile --enable-assembler --with-named-z-libs=no --enable-thread-safe-client --disable-shared}

@item IBM AIX 4.3.2 ppc with @code{gcc} 3.2.3:
@code{CFLAGS="-O2 -mcpu=powerpc -Wa,-many " CXX=gcc CXXFLAGS="-O2 -mcpu=powerpc -Wa,-many  -felide-constructors -fno-exceptions -fno-rtti" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile --with-named-z-libs=no --disable-shared}

@item IBM AIX 4.3.3 ppc with @code{xlC_r} (IBM Visual Age C/C++ 6.0):
@code{CC=xlc_r CFLAGS="-ma -O2 -qstrict -qoptimize=2 -qmaxmem=8192" CXX=xlC_r CXXFLAGS ="-ma -O2 -qstrict -qoptimize=2 -qmaxmem=8192" ./configure --prefix=/usr/local/mysql --localstatedir=/usr/local/mysql/data --libexecdir=/usr/local/mysql/bin --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile --with-named-z-libs=no --disable-shared --with-innodb}

@item IBM AIX 5.1.0 ppc with @code{gcc} 3.3:
@code{CFLAGS="-O2 -mcpu=powerpc -Wa,-many" CXX=gcc CXXFLAGS="-O2 -mcpu=powerpc -Wa,-many  -felide-constructors -fno-exceptions -fno-rtti" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --with-server-suffix="-pro" --enable-thread-safe-client --enable-local-infile --with-named-z-libs=no --disable-shared}

@item HP-UX 10.20 pa-risc1.1 with @code{gcc} 3.1:
@code{CFLAGS="-DHPUX -I/opt/dce/include -O3 -fPIC" CXX=gcc CXXFLAGS="-DHPUX -I/opt/dce /include -felide-constructors -fno-exceptions -fno-rtti -O3 -fPIC" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile  --with-pthread --with-named-thread-libs=-ldce --with-lib-ccflags=-fPIC --disable-shared}

@item HP-UX 11.11 pa-risc2.0 64bit with @code{aCC} (HP ANSI C++ B3910B A.03.33):
@code{CC=cc CXX=aCC CFLAGS=+DD64 CXXFLAGS=+DD64 ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile --disable-shared}

@item HP-UX 11.11 pa-risc2.0 32bit with @code{aCC} (HP ANSI C++ B3910B A.03.33):
@code{CC=cc CXX=aCC CFLAGS="+DAportable" CXXFLAGS="+DAportable" ./configure --prefix=/usr/local/mysql --localstatedir=/usr/local/mysql/data --libexecdir=/usr/local/mysql/bin --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile  --disable-shared --with-innodb}

@item Apple Mac OS X 10.2 powerpc with @code{gcc} 3.1:
@code{CC=gcc CFLAGS="-O3 -fno-omit-frame-pointer" CXX=gcc CXXFLAGS="-O3 -fno-omit-frame-pointer -felide-constructors -fno-exceptions -fno-rtti" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile  --disable-shared}

@item FreeBSD 4.7 i386 with @code{gcc} 2.95.4:
@code{CFLAGS=-DHAVE_BROKEN_REALPATH ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile --enable-assembler --with-named-z-libs=not-used --disable-shared}

@item QNX Neutrino 6.2.1 i386 with @code{gcc} 2.95.3qnx-nto 20010315:
@code{CC=gcc CFLAGS="-O3 -fno-omit-frame-pointer" CXX=gcc CXXFLAGS="-O3 -fno-omit-frame-pointer -felide-constructors -fno-exceptions -fno-rtti" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile  --disable-shared}

@end table

The following binaries are built on third-party systems kindly provided to
MySQL AB by other users. Please note that these are only provided as a
courtesy. Since MySQL AB does not have full control over these systems, we
can provide only limited support for the binaries built on these systems.

@table @asis
@item SCO Unix 3.2v5.0.6 i386 with @code{gcc} 2.95.3:
@code{CFLAGS="-O3 -mpentium" LDFLAGS=-static CXX=gcc CXXFLAGS="-O3 -mpentium -felide-constructors" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile --with-named-z-libs=no --enable-thread-safe-client --disable-shared}

@item SCO OpenUnix 8.0.0 i386 with @code{CC} 3.2:
@code{CC=cc CFLAGS="-O" CXX=CC ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile --with-named-z-libs=no --enable-thread-safe-client --disable-shared}

@item Compaq Tru64 OSF/1 V5.1 732 alpha with @code{cc/cxx} (Compaq C V6.3-029i / DIGITAL C++ V6.1-027):
@code{CC="cc -pthread" CFLAGS="-O4 -ansi_alias -ansi_args -fast -inline speed -speculate all" CXX="cxx -pthread" CXXFLAGS="-O4 -ansi_alias -fast -inline speed -speculate all -noexceptions -nortti" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile --with-prefix=/usr/local/mysql --with-named-thread-libs="-lpthread -lmach -lexc -lc" --disable-shared --with-mysqld-ldflags=-all-static}

@item SGI Irix 6.5 IP32 with @code{gcc} 3.0.1:
@code{CC=gcc CFLAGS="-O3 -fno-omit-frame-pointer" CXXFLAGS="-O3 -fno-omit-frame-pointer -felide-constructors -fno-exceptions -fno-rtti" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile  --disable-shared}

@item FreeBSD/sparc64 5.0 with @code{gcc} 3.2.1:
@code{CFLAGS=-DHAVE_BROKEN_REALPATH ./configure --prefix=/usr/local/mysql --localstatedir=/usr/local/mysql/data --libexecdir=/usr/local/mysql/bin --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile --disable-shared --with-innodb}
@end table

The following compile options have been used for binary packages MySQL AB
used to provide in the past. These binaries are no longer being updated,
but the compile options are listed here for reference purposes.

@table @asis
@item Linux 2.2.xx SPARC with @code{egcs} 1.1.2:
@code{CC=gcc CFLAGS="-O3 -fno-omit-frame-pointer" CXX=gcc CXXFLAGS="-O3 -fno-omit-frame-pointer -felide-constructors -fno-exceptions -fno-rtti" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile --enable-assembler --disable-shared}

@item Linux 2.2.x with x686 with @code{gcc} 2.95.2:
@code{CFLAGS="-O3 -mpentiumpro" CXX=gcc CXXFLAGS="-O3 -mpentiumpro -felide-constructors -fno-exceptions -fno-rtti" ./configure --prefix=/usr/local/mysql --enable-assembler --with-mysqld-ldflags=-all-static --disable-shared --with-extra-charsets=complex}

@item SunOS 4.1.4 2 sun4c with @code{gcc} 2.7.2.1:
@code{CC=gcc CXX=gcc CXXFLAGS="-O3 -felide-constructors" ./configure --prefix=/usr/local/mysql --disable-shared --with-extra-charsets=complex --enable-assembler}

@item SunOS 5.5.1 (and above) sun4u with @code{egcs} 1.0.3a or 2.90.27 or @code{gcc} 2.95.2 and newer:
@code{CC=gcc CFLAGS="-O3" CXX=gcc CXXFLAGS="-O3 -felide-constructors -fno-exceptions -fno-rtti" ./configure --prefix=/usr/local/mysql --with-low-memory --with-extra-charsets=complex --enable-assembler}

@item SunOS 5.6 i86pc with @code{gcc} 2.8.1:
@code{CC=gcc CXX=gcc CXXFLAGS=-O3 ./configure --prefix=/usr/local/mysql --with-low-memory --with-extra-charsets=complex}

@item BSDI BSD/OS 3.1 i386 with @code{gcc} 2.7.2.1:
@code{CC=gcc CXX=gcc CXXFLAGS=-O ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex}

@item BSDI BSD/OS 2.1 i386 with @code{gcc} 2.7.2:
@code{CC=gcc CXX=gcc CXXFLAGS=-O3 ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex}

@item AIX 2 4 with @code{gcc} 2.7.2.2:
@code{CC=gcc CXX=gcc CXXFLAGS=-O3 ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex}
@end table

Anyone who has more optimal options for any of the preceding
configurations listed can always mail them to the MySQL internals mailing
list.
@xref{Mailing-list}.

RPM distributions prior to MySQL Version 3.22 are user-contributed.
Beginning with Version 3.22, the RPM distributions are generated by us at
MySQL AB.

If you want to compile a debug version of MySQL, you should add
@code{--with-debug} or @code{--with-debug=full} to the preceding configure lines
and remove any @code{-fomit-frame-pointer} options.

For the Windows distribution, please see @ref{Windows installation}.




@node Getting MySQL, Verifying Package Integrity, Which version, General Installation Issues
@subsection How to Get MySQL

@cindex downloading
@cindex MySQL version
@cindex version, latest
@cindex getting MySQL
@cindex mirror sites
@cindex URLs for downloading MySQL

Check the MySQL homepage (@uref{http://www.mysql.com/}) for
information about the current version and for downloading instructions.

Our main mirror is located at @uref{http://mirrors.sunsite.dk/mysql/}.

For a complete up-to-date list of MySQL web/download mirrors, see
@uref{http://www.mysql.com/downloads/mirrors.html}.
There you will also find information about becoming a MySQL mirror
site and how to report a bad or out-of-date mirror.


@node Verifying Package Integrity, Installation layouts, Getting MySQL, General Installation Issues
@subsection  Verifying Package Integrity Using MD5 Checksums or @code{GnuPG}

After you have downloaded the MySQL package that suits your needs and before
you attempt to install it, you should make sure it is intact and has not
been tampered with.

MySQL AB offers three means of integrity checking:

@itemize @bullet

@item
MD5 checksums

@item
Cryptographic signatures using @code{GnuPG}, the GNU Privacy Guard

@item
For RPM packages, the built-in RPM integrity verification mechanism

@end itemize

The following sections describe how to use these methods.

@subheading Verifying the @code{MD5 Checksum}

After you have downloaded the package, you should make sure that the MD5
checksum matches the one provided on the MySQL download pages. Each package
has an individual checksum that you can verify with the following command,
where @code{package_name} is the name of the package you downloaded:

@example
shell> md5sum package_name
@end example

Note, that not all operating systems support the @code{md5sum} command---on
some it is simply called @code{md5}, others do not ship it at all. On Linux,
it is part of the @code{GNU Text Utilities} package, which is available for
a wide range of platforms. You can download the source code from
@uref{http://www.gnu.org/software/textutils/} as well. If you have
@code{OpenSSL} installed, you can also use the command @code{openssl md5
package_name} instead. A DOS/Windows implementation of the @code{md5} command
is available from @uref{http://www.fourmilab.ch/md5/}.

Example:
@example
shell> md5sum mysql-standard-4.0.17-pc-linux-i686.tar.gz
60f5fe969d61c8f82e4f7f62657e1f06
                mysql-standard-4.0.17-pc-linux-i686.tar.gz
@end example

You should verify that the resulting checksum (the string of hexadecimal
digits) matches the one displayed on
the download page immediately below the respective package.

@subheading Signature Checking Using @code{GnuPG}

Another method of verifying the integrity and authenticity of a package
is to use cryptographic signatures. This is more reliable than using MD5
checksums, but requires more work.

Beginning with MySQL 4.0.10 (February 2003), MySQL AB started signing
downloadable packages with @code{GnuPG} (@code{GNU Privacy Guard}).
@code{GnuPG} is an Open Source alternative to the very well-known
@code{Pretty Good Privacy} (@code{PGP}) by Phil Zimmermann.
See @uref{http://www.gnupg.org/} for more information about @code{GnuPG}
and how to obtain and install it on your system. Most Linux distributions
already ship with @code{GnuPG} installed by default.  For more information
about @code{OpenPGP}, see @uref{http://www.openpgp.org/}.


To verify the signature for a specific package, you first need to obtain a
copy of MySQL AB's public GPG build key @email{build@@mysql.com}. You can
either cut and paste it directly from here, or obtain it from
@uref{http://www.keyserver.net/}.

@example
Key ID:
pub  1024D/5072E1F5 2003-02-03
     MySQL Package signing key (www.mysql.com) <build@@mysql.com>
Fingerprint: A4A9 4068 76FC BD3C 4567  70C8 8C71 8D3B 5072 E1F5

Public Key (ASCII-armored):

-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: GnuPG v1.0.6 (GNU/Linux)
Comment: For info see http://www.gnupg.org

mQGiBD4+owwRBAC14GIfUfCyEDSIePvEW3SAFUdJBtoQHH/nJKZyQT7h9bPlUWC3
RODjQReyCITRrdwyrKUGku2FmeVGwn2u2WmDMNABLnpprWPkBdCk96+OmSLN9brZ
fw2vOUgCmYv2hW0hyDHuvYlQA/BThQoADgj8AW6/0Lo7V1W9/8VuHP0gQwCgvzV3
BqOxRznNCRCRxAuAuVztHRcEAJooQK1+iSiunZMYD1WufeXfshc57S/+yeJkegNW
hxwR9pRWVArNYJdDRT+rf2RUe3vpquKNQU/hnEIUHJRQqYHo8gTxvxXNQc7fJYLV
K2HtkrPbP72vwsEKMYhhr0eKCbtLGfls9krjJ6sBgACyP/Vb7hiPwxh6rDZ7ITnE
kYpXBACmWpP8NJTkamEnPCia2ZoOHODANwpUkP43I7jsDmgtobZX9qnrAXw+uNDI
QJEXM6FSbi0LLtZciNlYsafwAPEOMDKpMqAK6IyisNtPvaLd8lH0bPAnWqcyefep
rv0sxxqUEMcM3o7wwgfN83POkDasDbs3pjwPhxvhz6//62zQJ7Q7TXlTUUwgUGFj
a2FnZSBzaWduaW5nIGtleSAod3d3Lm15c3FsLmNvbSkgPGJ1aWxkQG15c3FsLmNv
bT6IXQQTEQIAHQUCPj6jDAUJCWYBgAULBwoDBAMVAwIDFgIBAheAAAoJEIxxjTtQ
cuH1cY4AnilUwTXn8MatQOiG0a/bPxrvK/gCAJ4oinSNZRYTnblChwFaazt7PF3q
zIhMBBMRAgAMBQI+PqPRBYMJZgC7AAoJEElQ4SqycpHyJOEAn1mxHijft00bKXvu
cSo/pECUmppiAJ41M9MRVj5VcdH/KN/KjRtW6tHFPYhMBBMRAgAMBQI+QoIDBYMJ
YiKJAAoJELb1zU3GuiQ/lpEAoIhpp6BozKI8p6eaabzF5MlJH58pAKCu/ROofK8J
Eg2aLos+5zEYrB/LsrkCDQQ+PqMdEAgA7+GJfxbMdY4wslPnjH9rF4N2qfWsEN/l
xaZoJYc3a6M02WCnHl6ahT2/tBK2w1QI4YFteR47gCvtgb6O1JHffOo2HfLmRDRi
Rjd1DTCHqeyX7CHhcghj/dNRlW2Z0l5QFEcmV9U0Vhp3aFfWC4Ujfs3LU+hkAWzE
7zaD5cH9J7yv/6xuZVw411x0h4UqsTcWMu0iM1BzELqX1DY7LwoPEb/O9Rkbf4fm
Le11EzIaCa4PqARXQZc4dhSinMt6K3X4BrRsKTfozBu74F47D8Ilbf5vSYHbuE5p
/1oIDznkg/p8kW+3FxuWrycciqFTcNz215yyX39LXFnlLzKUb/F5GwADBQf+Lwqq
a8CGrRfsOAJxim63CHfty5mUc5rUSnTslGYEIOCR1BeQauyPZbPDsDD9MZ1ZaSaf
anFvwFG6Llx9xkU7tzq+vKLoWkm4u5xf3vn55VjnSd1aQ9eQnUcXiL4cnBGoTbOW
I39EcyzgslzBdC++MPjcQTcA7p6JUVsP6oAB3FQWg54tuUo0Ec8bsM8b3Ev42Lmu
QT5NdKHGwHsXTPtl0klk4bQk4OajHsiy1BMahpT27jWjJlMiJc+IWJ0mghkKHt92
6s/ymfdf5HkdQ1cyvsz5tryVI3Fx78XeSYfQvuuwqp2H139pXGEkg0n6KdUOetdZ
Whe70YGNPw1yjWJT1IhMBBgRAgAMBQI+PqMdBQkJZgGAAAoJEIxxjTtQcuH17p4A
n3r1QpVC9yhnW2cSAjq+kr72GX0eAJ4295kl6NxYEuFApmr1+0uUq/SlsQ==
=YJkx
-----END PGP PUBLIC KEY BLOCK-----
@end example

You can import this key into your public GPG keyring by using
@code{gpg --import}. See the GPG documentation for more info
on how to work with public keys.

After you have downloaded and imported the public build key,
download your desired MySQL package and the corresponding
signature, which also is available from the download page.
The signature file has the same name as the distribution file with an
@file{.asc} extension. For example:

@multitable @columnfractions .30 .60
@item Distribution file @tab @code{mysql-standard-4.0.17-pc-linux-i686.tar.gz}
@item Signature file @tab @code{mysql-standard-4.0.17-pc-linux-i686.tar.gz.asc}
@end multitable

Make sure that both files are stored in the same directory and then run
the following command to verify the signature for the distribution file:

@example
shell> gpg --verify package_name.asc
@end example

Example:

@example
shell> gpg --verify mysql-standard-4.0.17-pc-linux-i686.tar.gz.asc
gpg: Warning: using insecure memory!
gpg: Signature made Mon 03 Feb 2003 08:50:39 PM MET using DSA key ID 5072E1F5
gpg: Good signature from
     "MySQL Package signing key (www.mysql.com) <build@@mysql.com>"
@end example

The "Good signature" message indicates that everything is all right.

@subheading Signature Checking Using @code{RPM}

For RPM packages, there is no separate signature. RPM packages
actually have a built-in GPG signature and MD5 checksum. You can
verify a package by running the following command:

@example
shell> rpm --checksig package_name.rpm
@end example

Example:

@example
shell> rpm --checksig MySQL-server-4.0.10-0.i386.rpm
MySQL-server-4.0.10-0.i386.rpm: md5 gpg OK
@end example

@strong{Note:} If you are using RPM 4.1 and it complains about @code{(GPG)
NOT OK (MISSING KEYS: GPG#5072e1f5)} (even though you have imported it into
your GPG public keyring), you need to import the key into the RPM keyring
first. RPM 4.1 no longer uses your GPG keyring (and GPG itself), but
rather maintains its own keyring (because it's a system-wide application and
the GPG public keyring is a user-specific file). To import the MySQL public
key into the RPM keyring, use @code{rpm --import}. For example, if you have
the public key stored in a file named @file{mysql_pubkey.asc}, import it using
this command:

@example
shell> rpm --import mysql_pubkey.asc
@end example

If you notice that the MD5 checksum or GPG signatures
do not match, first try to download the respective package one more time,
perhaps from another mirror site. If you repeatedly cannot successfully
verify the integrity of the package, please notify us about such incidents
including the full package name and the download site you have been using
at @email{webmaster@@mysql.com} or @email{build@@mysql.com}.
Do not report downloading problems using the bug-reporting system.


@node Installation layouts,  , Verifying Package Integrity, General Installation Issues
@subsection Installation Layouts

@cindex installation layouts
@cindex layout of installation
@cindex directory structure, default
@cindex default installation location

This section describes the default layout of the directories created by
installing binary and source distributions.

On Windows, the default installation directory is @file{C:\mysql}, which has
the following subdirectories:

@multitable @columnfractions .35 .45
@item @strong{Directory} @tab @strong{Contents of directory}
@item @file{bin}         @tab Client programs and the @code{mysqld} server
@item @file{data}        @tab Log files, databases
@item @file{Docs}        @tab Documentation
@item @file{examples}    @tab Example programs and scripts
@item @file{include}     @tab Include (header) files
@item @file{lib}         @tab Libraries
@item @file{scripts}     @tab Utility scripts
@item @file{share}       @tab Error message files
@end multitable

Installations created from Linux RPM distributions result in files under
the following system directories:

@multitable @columnfractions .35 .45
@item @strong{Directory} @tab @strong{Contents of directory}
@item @file{/usr/bin}    @tab Client programs
@item @file{/usr/sbin}   @tab @code{mysqld} server
@item @file{/var/lib/mysql} @tab Log files, databases
@item @file{/usr/share/doc/packages} @tab Documentation
@item @file{include}     @tab Include (header) files
@item @file{lib}         @tab Libraries
@item @file{scripts}     @tab @code{mysql_install_db}
@item @file{/usr/share/mysql} @tab Error message and character set files
@item @file{sql-bench}   @tab Benchmarks
@end multitable

On Unix, a @code{tar} file
binary distribution is installed by unpacking it at the installation
location you choose (typically @file{/usr/local/mysql}) and creates the
following directories in that location:

@multitable @columnfractions .35 .45
@item @strong{Directory} @tab @strong{Contents of directory}
@item @file{bin}         @tab Client programs and the @code{mysqld} server
@item @file{data}        @tab Log files, databases
@item @file{docs}        @tab Documentation, ChangeLog
@item @file{include}     @tab Include (header) files
@item @file{lib}         @tab Libraries
@item @file{scripts}     @tab @code{mysql_install_db}
@item @file{share/mysql} @tab Error message files
@item @file{sql-bench}   @tab Benchmarks
@end multitable

A source distribution is installed after you configure and compile it.  By
default, the installation step installs files under @file{/usr/local}, in the
following subdirectories:

@multitable @columnfractions .35 .45
@item @strong{Directory} @tab @strong{Contents of directory}
@item @file{bin}         @tab Client programs and scripts
@item @file{include/mysql}  @tab Include (header) files
@item @file{info}        @tab Documentation in Info format
@item @file{lib/mysql}   @tab Libraries
@item @file{libexec}     @tab The @code{mysqld} server
@item @file{share/mysql} @tab Error message files
@item @file{sql-bench}   @tab Benchmarks and @code{crash-me} test
@item @file{var}         @tab Databases and log files
@end multitable

Within an installation directory, the layout of a source installation differs
from that of a binary installation in the following ways:

@itemize @bullet
@item
The @code{mysqld} server is installed in the @file{libexec}
directory rather than in the @file{bin} directory.

@item
The data directory is @file{var} rather than @file{data}.

@item
@code{mysql_install_db} is installed in the @file{bin} directory
rather than in the @file{scripts} directory.

@item
The header file and library directories are @file{include/mysql} and
@file{lib/mysql} rather than @file{include} and @file{lib}.
@end itemize

You can create your own binary installation from a compiled source
distribution by executing the @file{scripts/make_binary_distribution} script
from the top directory of the source distribution.

@node Quick Standard Installation, Installing source, General Installation Issues, Installing
@section Standard MySQL Installation Using a Binary Distribution

This section covers the installation of MySQL on platforms where we
offer packages using the native packaging format of the respective
platform. (This is also known as performing a ``binary install.'')
However, binary distributions of MySQL are available for many
other platforms as well. See @ref{Installing binary} for generic
installation instructions for these packages that apply to all platforms.

See @ref{General Installation Issues} for more information on what other binary
distributions are available and how to obtain them.

@c This node name is special
@menu
* Windows installation::        Installing MySQL on Windows
* Linux-RPM::                   Installing MySQL on Linux
* Mac OS X installation::       Installing MySQL on Mac OS X
* NetWare installation::        Installing MySQL on NetWare
* Binary notes-HP-UX::          Installing MySQL on HP-UX
* Installing binary::           Installing MySQL on Other Unix-like Systems
@end menu


@node Windows installation, Linux-RPM, Quick Standard Installation, Quick Standard Installation
@subsection Installing MySQL on Windows

@c TODO: The prompt is inconsistent in the Windows sections. Sometimes
@c begins with C:, sometimes it's shell>.

The installation process for MySQL on Windows has the following steps:

@enumerate
@item
Install the distribution.

@item
Set up an option file if necessary.

@item
Select the server you want to use.

@item
Start the server.

@item
Assign passwords to the initial MySQL accounts.

@end enumerate

MySQL for Windows is available in two distribution formats:

@itemize @bullet

@item
The binary distribution contains a setup program that installs
everything you need so that you can start the server immediately.

@item
The source distribution contains all the code and support files
for building the executables using the VC++ 6.0 compiler.

@end itemize

Generally speaking, you should use the binary distribution. It's simpler, and
you need no additional tools to get MySQL up and running.

This section describes how to install MySQL on Windows using a binary
distribution.  To install using a source distribution, see
@ref{Windows source build}.

@menu
* Windows system requirements::  Windows System Requirements
* Windows binary installation::  Installing a Windows Binary Distribution
* Windows prepare environment::  Preparing the Windows MySQL Environment
* Windows select server::       Selecting a Windows Server
* Windows server first start::  Starting the Server for the First Time
* Win95 start::                 Starting MySQL from the Windows Command Line
* NT start::                    Starting MySQL as a Windows Service
* Windows running::             Running MySQL Client Programs on Windows
* Windows vs Unix::             MySQL on Windows Compared to MySQL on Unix
@end menu

@node Windows system requirements, Windows binary installation, Windows installation, Windows installation
@subsubsection Windows System Requirements

To run MySQL on Windows, you need the following:

@itemize @bullet

@item
A 32-bit Windows operating system such as 9x, Me, NT, 2000, or XP.
The NT family (Windows NT, 2000, and XP) permits you to run the MySQL server
as a service. @xref{NT start}.

@item
TCP/IP protocol support.

@item
A copy of the MySQL binary distribution for Windows, which
can be downloaded from @uref{http://www.mysql.com/downloads/}.

Note: The distribution files are supplied with a zipped format
and we recommend the use of an adequate FTP client with resume
feature to avoid corruption of files during the download process.

@item
A @code{ZIP} program to unpack the distribution file.

@item
Enough space on the hard drive to unpack, install, and create the
databases in accordance with your requirements.

@item
If you plan to connect to the MySQL server via ODBC, you
also need the @code{MyODBC} driver. @xref{ODBC}.

@item
If you need tables with a size larger than 4 GB, install MySQL
on an NTFS or newer filesystem. Don't forget to use @code{MAX_ROWS} and
@code{AVG_ROW_LENGTH} when you create tables.
@xref{CREATE TABLE, , @code{CREATE TABLE}}.

@end itemize

@node Windows binary installation, Windows prepare environment, Windows system requirements, Windows installation
@subsubsection Installing a Windows Binary Distribution

To install MySQL on Windows using a binary distribution, follow this
procedure:

@enumerate

@item
If you are working on a Windows NT, 2000, or XP machine, make sure you have
logged in as a user with administrator privileges.

@c TODO: omit this "upgrade" stuff, defer it to the upgrading section?

@item
If you are doing an upgrade of an earlier MySQL installation,
it is necessary to stop the current server.
On Windows NT, 2000, or XP machines, if you are running the server
as a Windows service, stop it as follows from the command prompt:

@example
C:\> NET STOP MySQL
@end example

If you plan to use a different server after the upgrade (for example,
if you want to run @code{mysqld-max} rather than @code{mysqld}),
remove the existing service:

@example
C:\mysql\bin> mysqld --remove
@end example

You can reinstall the service to use the proper server after upgrading.

If you are not running the MySQL server as a service, stop it like this:

@example
C:\mysql\bin> mysqladmin -u root shutdown
@end example

@item
Exit the @code{WinMySQLAdmin} program if it is running.

@item
Unzip the distribution file to a temporary directory.

@item
Run the @code{setup.exe} program to begin the installation process.
If you want to install MySQL into a location other than the default directory
(@file{C:\mysql}), use the @code{Browse} button to specify your
preferred directory. If you do not install MySQL into the default location,
you will need to specify the location whenever you start the server. The
easiest way to do this is to use an option file, as described in
@ref{Windows prepare environment}.

@item
Finish the install process.

@end enumerate

@strong{Important note:}
Early alpha Windows distributions for MySQL 4.1 do not contain any
installer program.  A 4.1 distribution is a ZIP file that you just
unzip in the location where you want to install MySQL. For example,
to install @file{mysql-4.1.1-alpha-win.zip} as @file{C:\mysql}, unzip
the distribution file on the @code{C:} drive, then rename the resulting
@file{mysql-4.1.1-alpha} directory to @file{mysql}.

If you are upgrading to MySQL 4.1 from an earlier version, you will want to
preserve your existing @file{data} directory that contains the grant tables
in the @code{mysql} database and your own databases.  Before installing 4.1,
stop the server if it is running, and save your @file{data} directory to
another location. Then either rename the existing @file{C:\mysql} directory
or remove it.  Install 4.1 as described in the preceding paragraph, and then
replace its @file{data} directory with your old @file{data} directory.
Start the new server and update the grant tables.  This will avoid loss of
your current databases.
@xref{Upgrading-grant-tables}.


@node Windows prepare environment, Windows select server, Windows binary installation, Windows installation
@subsubsection Preparing the Windows MySQL Environment

If you need to specify startup options when you run the server,
you can indicate them on the command line or place them in an option
file. For options that will be used every time the server starts,
you will find it most convenient to use an option file to specify
your MySQL configuration. This is true particularly under the
following circumstances:

@itemize @bullet

@item
The installation or data directory locations are different from the default
locations (@file{C:\mysql} and @file{C:\mysql\data}).

@item
You need to tune the server settings.
For example, to use the @code{InnoDB} transactional tables in
MySQL version 3.23, you
must manually create two new directories to hold the @code{InnoDB}
data and log files---such as, @file{C:\ibdata} and @file{C:\iblogs}.
You will also need to add some extra lines to the option
file, as described in @ref{InnoDB start, , @code{InnoDB} start}.
(As of MySQL 4.0, InnoDB creates its datafiles and log files in the data
directory by default. This means you need not configure InnoDB explicitly.
You may still do so if you wish, and an option file will be useful in this
case, too.)

@end itemize

On Windows, the MySQL installer places the data directory directly under
the directory where you install MySQL.  If you would like to use a data
directory in a different location, you should copy the entire contents
of the @file{data} directory to the new location. For example, by default, the
installer
places MySQL in @file{C:\mysql} and the data directory in
@file{C:\mysql\data}. If you want to use a data directory of @file{E:\mydata},
you must do two things:

@itemize @bullet
@item
Move the data directory from @file{C:\mysql\data} to @file{E:\mydata}.

@item
Use a @code{--datadir} option to specify the new data directory location
each time you start the server.

@end itemize

When the MySQL server starts on Windows, it looks for options in
two files:  The @file{my.ini} file in the Windows directory, and
the @file{C:\my.cnf} file.  The Windows directory typically is
named something like @file{C:\WINDOWS} or @file{C:\WinNT}.  You
can determine its exact location from the value of the @code{WINDIR}
environment variable using the following command:

@example
C:\> echo %WINDIR%
@end example

MySQL looks for options first in the @file{my.ini} file, then in
the @file{my.cnf} file.  However, to avoid confusion, it's best if
you use only one file.  If your PC uses a boot loader where the
@code{C:} drive isn't the boot drive, your only option is to use
the @file{my.ini} file.  Whichever one you use, it must be a plain
text file.

An option file can be created and modified with any text editor,
such as the @code{Notepad} program.  For example, if MySQL is
installed at @file{D:\mysql} and the data directory is located as
@file{D:\mydata\data}, you can create the option file and set up
a @code{[mysqld]} section to specify values for the @code{basedir}
and @code{datadir} parameters:

@example
[mysqld]
# set basedir to your installation path
basedir=D:/mysql
# set datadir to the location of your data directory
datadir=D:/mydata/data
@end example

Note that Windows pathnames are specified in option files using
forward slashes rather than backslashes.  If you do use backslashes,
you must double them.

Another way to manage an option file is to use the the @code{WinMySQLAdmin}
tool. You can find @code{WinMySQLAdmin} in the @file{bin} directory
of your MySQL installation, as well as a help file containing
instructions for using it. @code{WinMySQLAdmin} has the capability
of editing your option file, but note these points:

@itemize @bullet
@item
@code{WinMySQLAdmin} uses only the @file{my.ini} file.

@item
If @code{WinMySQLAdmin} finds a @file{C:\my.cnf} file, it will in fact rename
it to @file{C:\my_cnf.bak} to disable it.

@end itemize

Now you are ready to test starting the server.


@node Windows select server, Windows server first start, Windows prepare environment, Windows installation
@subsubsection Selecting a Windows Server

Starting with MySQL 3.23.38, the Windows distribution includes
both the normal and the MySQL-Max server binaries.
Here is a list of the different MySQL servers from which you can choose:

@multitable @columnfractions .20 .80
@item @strong{Binary} @tab @strong{Description}
@item @code{mysqld} @tab Compiled with full debugging and automatic memory allocation checking, symbolic links, and @code{InnoDB} and @code{BDB} tables.
@item @code{mysqld-opt} @tab Optimized binary.  From version 4.0 on, @code{InnoDB} is enabled.  Before 4.0, this server includes no transactional table support.
@item @code{mysqld-nt} @tab Optimized binary for NT/2000/XP with support for named pipes.
@item @code{mysqld-max} @tab Optimized binary with support for symbolic links, and @code{InnoDB} and @code{BDB} tables.
@item @code{mysqld-max-nt} @tab Like @code{mysqld-max}, but compiled with support for named pipes.
@end multitable

All of the preceding binaries are optimized for modern Intel processors
but should work on any Intel i386-class or higher processor.

@cindex TCP/IP
@cindex named pipes

MySQL supports TCP/IP on all Windows platforms. The @code{mysqld-nt}
and @code{mysql-max-nt} servers support named pipes on NT, 2000, and XP.
However, the default is to use TCP/IP regardless of the platform.
(Named pipes are slower than TCP/IP in many Windows configurations.)

Named pipe use is subject to these conditions:

@itemize @bullet
@item
Starting from MySQL 3.23.50, named pipes are enabled only
if you start the server with the @code{--enable-named-pipe} option.
It is now necessary to use this option explicitly because some users have
experienced problems shutting down the MySQL server when named pipes
are used.

@item
Named pipe connections are allowed only by the
@code{mysqld-nt} or @code{mysqld-max-nt} servers, and only if the server is
run on a version of Windows that supports named pipes (NT, 2000, XP).

@item
These servers can be run on Windows 98 or Me, but only if TCP/IP is installed;
named pipe connections cannot be used.

@item
On Windows 95, these servers cannot be used.

@end itemize

@node Windows server first start, Win95 start, Windows select server, Windows installation
@subsubsection Starting the Server for the First Time

On Windows 95, 98, or Me, MySQL clients always connect to the server using
TCP/IP.  (This will allow any machine on your network to connect to your MySQL
server.)  Because of this, you must make sure that TCP/IP support is installed
on your machine before starting MySQL.  You can find TCP/IP on your
Windows CD-ROM.

Note that if you are using an old Windows 95 release (for example,
OSR2), it's likely that you have an old Winsock package;
MySQL requires Winsock 2! You can get the newest Winsock from
@uref{http://www.microsoft.com/}.  Windows 98 has the new Winsock 2
library, so it is unnecessary to update the library.

On NT-based systems such as Windows NT, 2000, or XP, clients have two
options. They can use TCP/IP, or they can use a named pipe if the server
supports named pipe connections.

@c TODO: Mention shared memory connections for 4.1.

For information about which server binary to run, see
@ref{Windows prepare environment}.

This section gives a general overview of starting the MySQL server.
The following sections provide more specific information for particular
versions of Windows.

The examples in these sections assume that MySQL is installed under the default
location of @file{C:\mysql}. Adjust the pathnames shown in the examples if you
have MySQL installed in a different location.

Testing is best done from a command prompt in a console window (a ``DOS
window''). This way you can have the server display status messages in the
window where they are easy to see.  If something is wrong with your
configuration, these messages will make it easier for you to identify
and fix any problems.

Make sure you are in the directory where the server is located, then
enter this command:

@example
C:\mysql\bin> mysqld --console
@end example

For servers that include @code{InnoDB} support,
you should see the following messages as the server starts:

@example
InnoDB: The first specified datafile c:\ibdata\ibdata1 did not exist:
InnoDB: a new database to be created!
InnoDB: Setting file c:\ibdata\ibdata1 size to 209715200
InnoDB: Database physically writes the file full: wait...
InnoDB: Log file c:\iblogs\ib_logfile0 did not exist: new to be created
InnoDB: Setting log file c:\iblogs\ib_logfile0 size to 31457280
InnoDB: Log file c:\iblogs\ib_logfile1 did not exist: new to be created
InnoDB: Setting log file c:\iblogs\ib_logfile1 size to 31457280
InnoDB: Log file c:\iblogs\ib_logfile2 did not exist: new to be created
InnoDB: Setting log file c:\iblogs\ib_logfile2 size to 31457280
InnoDB: Doublewrite buffer not found: creating new
InnoDB: Doublewrite buffer created
InnoDB: creating foreign key constraint system tables
InnoDB: foreign key constraint system tables created
011024 10:58:25  InnoDB: Started
@end example

When the server finishes its startup sequence, you should see something
like this, which indicates that the server is ready to service client
connections:

@example
mysqld: ready for connections
Version: '4.0.14-log'  socket: ''  port: 3306
@end example

The server will continue to write to the console any further diagnostic
output it produces.  You can open a new console window in which to run
client programs.

If you omit the @code{--console} option, the server writes diagnostic output
to the error log in the data directory. The error log is the file with the
@file{.err} extension.

The accounts that are listed in the MySQL grant tables initially have no
passwords.  After starting the server, you should set up passwords for
them using the instructions in @ref{Post-installation}.


@node Win95 start, NT start, Windows server first start, Windows installation
@subsubsection Starting MySQL from the Windows Command Line

The MySQL server can be started manually from the command line.
This can be done on any version of Windows.

To start the @code{mysqld} server from the command line, you should
start a console window (a ``DOS'' window) and enter this command:

@example
shell> C:\mysql\bin\mysqld
@end example

On non-NT versions of Windows, this will start @code{mysqld} in the
background. That is, after the server starts, you should see another
command prompt. If you start the server this way on Windows NT, 2000, or XP,
the server will run in the foreground and no command prompt will appear
until the server exits.  Because of this, you should open another console
window to run client programs while the server is running.

You can stop the MySQL server by executing this command:

@example
shell> C:\mysql\bin\mysqladmin -u root shutdown
@end example

This invokes the MySQL administrative utility @code{mysqladmin} to
connect to the server and tell it to shut down. The command connects
as @code{root}, which is the default administrative account in the
MySQL grant system. Please note that users in the MySQL grant system
are wholly independent from any login users under Windows.

If @code{mysqld} doesn't start, check the error log to see whether the
server wrote any messages there to indicate the cause of the problem.
The error log is located in the @file{C:\mysql\data} directory. It is
the file with a suffix of @file{.err}. You can also try to start the
server as @code{mysqld --console}; in this case, you may get some useful
information on the screen that may help solve the problem.

The last option is to start @code{mysqld} with
@code{--standalone --debug}.
In this case @code{mysqld} will write a log file
@file{C:\mysqld.trace} that should contain the reason why
@code{mysqld} doesn't start. @xref{Making trace files}.

Use @code{mysqld --help} to display all the options that
@code{mysqld} understands!


@node NT start, Windows running, Win95 start, Windows installation
@subsubsection Starting MySQL as a Windows Service

On the NT family (Windows NT, 2000, or XP), the recommended way to run MySQL
is to install it as a Windows service. Then Windows starts and stops the MySQL
server automatically when Windows starts and stops. A server installed as a
service can also be controlled from the command line using @code{NET}
commands, or with the graphical @code{Services} utility.

The @code{Services} utility (the Windows
@code{Service Control Manager}) can be found in the Windows
@code{Control Panel} (under @code{Administrative Tools}
on Windows 2000). It is advisable to close the @code{Services} utility
while performing server installation or removal operations from this command
line.  This prevents some odd errors.

To get MySQL to work with TCP/IP on Windows NT 4, you must install
service pack 3 (or newer)!

Before installing MySQL as a Windows service, you should first stop
the current server if it is running by using the following command:

@example
shell> C:\mysql\bin\mysqladmin -u root shutdown
@end example

This invokes the MySQL administrative utility @code{mysqladmin} to
connect to the server and tell it to shut down. The command connects
as @code{root}, which is the default administrative account in the
MySQL grant system. Please note that users in the MySQL grant system
are wholly independent from any login users under Windows.

Now install the server as a service:

@example
shell> mysqld --install
@end example

If you have problems installing @code{mysqld} as a
service using just the server name, try installing it using its full pathname:

@example
shell> C:\mysql\bin\mysqld --install
@end example

@c I commented this out because no instructions were given how to "fix"
@c the path. -- PD
@c If that doesn't work, you can get @code{mysqld} to
@c start properly by fixing the path in the registry!

As of MySQL 4.0.2, you can specify a specific service name after the
@code{--install} option.  As of MySQL 4.0.3, you can in addition specify a
@code{--defaults-file} option after the service name to indicate where the
server should obtain options when it starts. The rules that determine the
service name and option files the server uses are as follows:

@itemize @bullet

@item
If you specify no service name, the server uses the default service name of
@code{MySQL} and the server reads options from the @code{[mysqld]} group in
the standard option files.

@item
@c TODO change this back after bug gets fixed
@c If you specify a service name different than @code{MySQL} after the
If you specify a service name after the
@code{--install} option, the server ignores the @code{[mysqld]} option
group and instead reads options from the group that has the same name as the
service. The server reads options from the standard option files.

@c TODO preceding item is different for 4.0.17 on? ([mysqld] group is
@c read by all servers, even if installed with a non-default service name?)

@item
If you specify a @code{--defaults-file} option after the service name,
the server ignores the standard option files and reads options only from the
@code{[mysqld]} group of the named file.

@end itemize

@strong{Note:} Prior to MySQL 4.0.17, a server installed as a Windows
service has problems starting if its pathname or the service name contains
spaces. For this reason, avoid installing MySQL in a directory such as
@file{C:\Program Files} or using a service name containing spaces.

In the usual case that you install the server with @code{--install}
but no service name, the server is installed with a service
name of @code{MySQL}.

As a more complex example, consider the following command (which should be
entered on a single line):

@example
shell> C:\mysql\bin\mysqld --install mysql
           --defaults-file=C:\my-opts.cnf
@end example

Here, a service name is given after the @code{--install} option. If no
@code{--defaults-file} option had been given, this command would have the
effect of causing the server to read the @code{[mysql]} group from the
standard option files. (This would be a bad idea, because that option group
is for use by the @code{mysql} client program.) However, because the
@code{--defaults-file} option is present, the server reads options only from
the named file, and only from the @code{[mysqld]} option group.

You can also specify options as ``@code{Start parameters}'' in the
Windows @code{Services} utility before you start the MySQL service.

Once a MySQL server is installed as a service, Windows will start
the service automatically whenever Windows starts.  The service also
can be started immediately from the @code{Services} utility, or by
using the command @code{NET START MySQL}.  The @code{NET} command
is not case sensitive.

Please note that when run as a service, @code{mysqld} has no access
to a console window, so no messages can be seen there.  If
@code{mysqld} doesn't start, check the error log to see whether the
server wrote any messages there to indicate the cause of the problem.
The error log is located in the @file{C:\mysql\data} directory. It
is the file with a suffix of @file{.err}.

When @code{mysqld} is running as a service, it can be stopped by
using the @code{Services} utility, the command @code{NET STOP
MySQL}, or the command @code{mysqladmin shutdown}. If the service
is running when Windows shuts down, Windows will stop the server
automatically.

From MySQL version 3.23.44, you have the choice of installing the
server as a @code{Manual} service if you don't wish the service to
be started automatically during the boot process. To do this, use
the @code{--install-manual} option rather than the @code{--install}
option:

@example
shell> C:\mysql\bin\mysqld --install-manual
@end example

To remove a server that is installed as a service, first stop it if it is
running. Then use the @code{--remove} option to remove it:

@example
shell> mysqld --remove
@end example

For MySQL versions older than 3.23.49, one problem with automatic
MySQL service shutdown is that Windows waited only for a few
seconds for the shutdown to complete, then killed the database
server process if the time limit was exceeded. This had the potential
to cause problems.  (For example, the @code{InnoDB} storage engine
had to perform crash recovery at the next startup.) Starting from
MySQL version 3.23.49, Windows waits longer for the MySQL server
shutdown to complete. If you notice this still is not enough for
your installation, it is safest not to run the MySQL server as a
service. Instead, start it from the command-line prompt, and stop
it with @code{mysqladmin shutdown}.

This change to tell Windows to wait longer when stopping the MySQL server
works for Windows 2000 and XP. It does not work for Windows NT, where Windows
waits only 20 seconds for a service to shut down, and after that kills the
service process. You can increase this default by opening the Registry
Editor @file{\winnt\system32\regedt32.exe} and editing the value of
@code{WaitToKillServiceTimeout} at
@code{HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control}
in the Registry tree. Specify the new larger value in milliseconds.
For example, the value 120000 tells Windows NT to wait up to 120 seconds.

If you don't want to start @code{mysqld} as a service, you can
start it from the command line the same way as for versions of
Windows that are not based on NT.  For instructions, see @ref{Win95
start}.

@node Windows running, Windows vs Unix, NT start, Windows installation
@subsubsection Running MySQL Client Programs on Windows

@cindex TCP/IP
@cindex named pipes

You can test whether the MySQL server is working by executing any of the
following commands:

@example
C:\> C:\mysql\bin\mysqlshow
C:\> C:\mysql\bin\mysqlshow -u root mysql
C:\> C:\mysql\bin\mysqladmin version status proc
C:\> C:\mysql\bin\mysql test
@end example

If @code{mysqld} is slow to respond to TCP/IP connections from client programs
on Windows 9x/Me, there is
probably a problem with your DNS.  In this case, start @code{mysqld} with the
@code{--skip-name-resolve} option and use only @code{localhost} and IP
numbers in the @code{Host} column of the MySQL grant tables.

You can force a MySQL client to use a named pipe connection rather than TCP/IP
 by specifying the
@code{--pipe} option or by specifying @code{.} (period) as the host
name.  Use the @code{--socket} option to specify the name of the
pipe.  In MySQL 4.1, you should use the @code{--protocol=PIPE}
option.

There are two versions of the MySQL command-line tool:
@multitable @columnfractions .20 .80
@item @strong{Binary} @tab @strong{Description}
@item @code{mysql} @tab Compiled on native Windows, offering limited text editing capabilities.
@item @code{mysqlc} @tab Compiled with the Cygnus GNU compiler and libraries, which offers @code{readline} editing.
@end multitable

If you want to use @code{mysqlc}, you must have a copy of the
@file{cygwinb19.dll} library installed somewhere that @code{mysqlc}
can find it. Current distributions of MySQL include this library
in the same directory as @code{mysqlc} (the @file{bin} directory
under the base directory of your MySQL installation). If your
distribution does not have the @code{cygwinb19.dll} library in the
@file{bin} directory, look for it in the @code{lib} directory and
copy it to your Windows system directory
(@file{\Windows\system} or similar place).

@c TODO: check if it needs to be in the *system* directory, or if it can
@c be in the Windows directory.


@node Windows vs Unix,  , Windows running, Windows installation
@subsubsection MySQL on Windows Compared to MySQL on Unix

@cindex Windows, versus Unix
@cindex operating systems, Windows versus Unix

MySQL for Windows has by now proven itself to be very stable. The Windows
version of MySQL has the same features as the corresponding Unix version,
with the following exceptions:

@table @strong
@item Windows 95 and threads
Windows 95 leaks about 200 bytes of main memory for each thread creation.
Each connection in MySQL creates a new thread, so you shouldn't
run @code{mysqld} for an extended time on Windows 95 if your server handles
many connections!  Other versions of Windows don't suffer from this bug.

@item Concurrent reads
MySQL depends on the @code{pread()} and @code{pwrite()} calls to be
able to mix @code{INSERT} and @code{SELECT}.  Currently we use mutexes
to emulate @code{pread()}/@code{pwrite()}.  We will, in the long run,
replace the file level interface with a virtual interface so that we can
use the @code{readfile()}/@code{writefile()} interface on NT/2000/XP to
get more speed.
The current implementation limits the number of open files MySQL
can use to 1024, which means that you will not be able to run as many
concurrent threads on NT/2000/XP as on Unix.

@item Blocking read
MySQL uses a blocking read for each connection, which
has the following implications:

@itemize @bullet
@item
A connection will not be disconnected automatically after 8 hours, as happens
with the Unix version of MySQL.

@item
If a connection hangs, it's impossible to break it without killing
MySQL.

@item
@code{mysqladmin kill} will not work on a sleeping connection.

@item
@code{mysqladmin shutdown} can't abort as long as there are sleeping
connections.
@end itemize

We plan to fix this problem when our Windows developers have figured out a
nice workaround.

@item @code{DROP DATABASE}
You can't drop a database that is in use by some thread.

@item Killing MySQL from the task manager
You can't kill MySQL from the task manager or with the shutdown
utility in Windows 95.  You must take it down with @code{mysqladmin shutdown}.

@item Case-insensitive names
Filenames are not case sensitive on Windows, so MySQL database and table names
are also not case sensitive on Windows.  The only
restriction is that database and table names must be specified using the same
case throughout a given statement.  @xref{Name case sensitivity}.

@item The @samp{\} pathname separator character
Pathname components in Windows 95 are separated by the @samp{\} character,
which is also the escape character in MySQL.  If you are using @code{LOAD
DATA INFILE} or @code{SELECT ... INTO OUTFILE},
use Unix style filenames with @samp{/} characters:

@example
mysql> LOAD DATA INFILE "C:/tmp/skr.txt" INTO TABLE skr;
mysql> SELECT * INTO OUTFILE 'C:/tmp/skr.txt' FROM skr;
@end example

Alternatively, you must double the @samp{\} character:

@example
mysql> LOAD DATA INFILE "C:\\tmp\\skr.txt" INTO TABLE skr;
mysql> SELECT * INTO OUTFILE 'C:\\tmp\\skr.txt' FROM skr;
@end example

@item Problems with pipes.
Pipes doesn't work reliably in the Windows command-line prompt.  If the
pipe includes the character @code{^Z} / @code{CHAR(24)}, Windows will think it
has encountered end-of-file and abort the program.

This is mainly a problem when you try to apply a binary log as follows:

@example
mysqlbinlog binary-log-name | mysql --user=root
@end example

If you get a problem applying the log and suspect it's because of an @code{^Z}
/ @code{CHAR(24)} character you can use the following workaround:

@example
mysqlbinlog binary-log-file --result-file=/tmp/bin.sql
mysql --user=root --execute "source /tmp/bin.sql"
@end example

The latter command also can be used to reliably read in any SQL file
that may contain binary data.

@item @code{Can't open named pipe} error
If you use a MySQL Version 3.22 server on NT with the newest MySQL client
programs, you will get the following error:

@example
error 2017: can't open named pipe to host: . pipe...
@end example

@tindex .my.cnf file
This is because the release version of MySQL uses named pipes on NT
by default.  You can avoid this error by using the @code{--host=localhost}
option to the new MySQL clients or create an option file
@file{C:\my.cnf} that contains the following information:

@example
[client]
host = localhost
@end example

Starting from 3.23.50, named pipes are enabled only if @code{mysqld-nt} or
@code{mysqld-max-nt} is started with @code{--enable-named-pipe}.

@item @code{Access denied for user} error
If you attempt to run a MySQL client program to connect to a server
running on the same machine, but get the error @code{Access denied
for user: 'some-user@@unknown' to database 'mysql'}, this means
that MySQL can't resolve your hostname properly.

To fix this, you should create a file @file{\windows\hosts} with the
following information:

@example
127.0.0.1       localhost
@end example

@item @code{ALTER TABLE}
While you are executing an @code{ALTER TABLE} statement, the table is locked
from being used by other threads.  This has to do with the fact that on Windows,
you can't delete a file that is in use by another threads.  In the future,
we may find some way to work around this problem.

@item @code{DROP TABLE}
@code{DROP TABLE} on a table that is in use by a @code{MERGE} table will
not work on Windows because the @code{MERGE} handler does the table mapping
hidden from the upper layer of MySQL.  Because Windows doesn't allow you
to drop files that are open, you first must flush all @code{MERGE}
tables (with @code{FLUSH TABLES}) or drop the @code{MERGE} table before
dropping the table.  We will fix this at the same time we introduce
views.
@item @code{DATA DIRECTORY} and @code{INDEX DIRECTORY}
The @code{DATA DIRECTORY} and @code{INDEX DIRECTORY} options for
@code{CREATE TABLE} are ignored on Windows, because Windows doesn't support
symbolic links.  These options also are ignored on systems that have a
non-functional @code{realpath()} call.
@end table

Here are some open issues for anyone who might want to help us improve MySQL
on Windows:

@cindex Windows, open issues

@itemize @bullet
@c PD: Commented this one out as obsolete until I hear otherwise
@c @item
@c Make a single-user @code{MYSQL.DLL} server.  This should include everything in
@c a standard MySQL server, except thread creation.  This will make
@c MySQL much easier to use in applications that don't need a true
@c client/server and don't need to access the server from other hosts.

@item
Add some nice start and shutdown icons to the MySQL installation.

@item
It would be really nice to be able to kill @code{mysqld} from the task manager.
For the moment, you must use @code{mysqladmin shutdown}.

@item
Port @code{readline} to Windows for use in the @code{mysql} command-line tool.

@item
GUI versions of the standard MySQL clients (@code{mysql},
@code{mysqlshow}, @code{mysqladmin}, and @code{mysqldump}) would be nice.

@item
It would be nice if the socket read and write functions in @file{net.c} were
interruptible. This would make it possible to kill open threads with
@code{mysqladmin kill} on Windows.

@item
Add macros to use the faster thread-safe increment/decrement methods
provided by Windows.
@end itemize


@node Linux-RPM, Mac OS X installation, Windows installation, Quick Standard Installation
@subsection Installing MySQL on Linux

@cindex RPM file
@cindex RPM Package Manager
@cindex installing, Linux RPM packages

The recommended way to install MySQL on Linux is by using the RPM
packages. The MySQL RPMs are currently built on a SuSE Linux 7.3
system but should work on most versions of Linux that support @code{rpm}
and use @code{glibc}.

If you have problems with an RPM file (for example, if you receive the error
``@code{Sorry, the host 'xxxx' could not be looked up}''), see
@ref{Binary notes-Linux}.

In most cases, you only need to install the @code{MySQL-server} and
@code{MySQL-client} packages to get a functional MySQL installation. The
other packages are not required for a standard installation.
If you want to run a MySQL-Max server that has additional capabilities,
you should install the @code{MySQL-Max} RPM. However, you should do so only
@emph{ after} installing the @code{MySQL-server} RPM.
@xref{mysqld-max, , @code{mysqld-max}}.

If you get a dependency failure when trying to install the MySQL 4.0
packages (for example, ``@code{error: removing these packages would break dependencies:
libmysqlclient.so.10 is needed by ...}''), you should also install
the package @code{MySQL-shared-compat}, which includes both the
shared libraries for backward compatibility (@code{libmysqlclient.so.12}
for MySQL 4.0 and @code{libmysqlclient.so.10} for MySQL 3.23).

Many Linux distributions still ship with MySQL 3.23 and they usually link
applications dynamically to save disk space. If these shared libraries are
in a separate package (for example, @code{MySQL-shared}), it is
sufficient to simply leave this package installed and just upgrade
the MySQL server and client packages (which are statically linked
and do not depend on the shared libraries). For distributions that
include the shared libraries in the same package as the MySQL server
(for example, Red Hat Linux), you could either install our 3.23
@code{MySQL-shared} RPM, or use the @code{MySQL-shared-compat} package instead.

The following RPM packages are available:

@itemize @bullet
@item @code{MySQL-server-VERSION.i386.rpm}

The MySQL server.  You will need this unless you only want to
connect to a MySQL server running on another machine. Please note:
Server RPM files were called @code{MySQL-VERSION.i386.rpm} before
MySQL 4.0.10. That is, they did not have @code{-server} in the name.

@item @code{MySQL-Max-VERSION.i386.rpm}

The MySQL-Max server. This server has additional capabilities that the
one provided in the @code{MySQL-server} RPM does not.  You must install the
@code{MySQL-server} RPM first, because the @code{MySQL-Max} RPM depends on it.

@item @code{MySQL-client-VERSION.i386.rpm}

The standard MySQL client programs. You probably always want to
install this package.

@item @code{MySQL-bench-VERSION.i386.rpm}

Tests and benchmarks. Requires Perl and the @code{DBD::mysql} module.

@item @code{MySQL-devel-VERSION.i386.rpm}

The libraries and include files that are needed if you want to compile other
MySQL clients, such as the Perl modules.

@item @code{MySQL-shared-VERSION.i386.rpm}

This package contains the shared libraries (@code{libmysqlclient.so*})
that certain languages and applications need to dynamically load and
use MySQL.

@item @code{MySQL-shared-compat-VERSION.i386.rpm}

This package includes the shared libraries for both MySQL 3.23 and
MySQL 4.0. Install this package instead of @code{MySQL-shared}, if you
have applications installed that are dynamically linked against MySQL
3.23 but you want to upgrade to MySQL 4.0 without breaking the library
dependencies. This package is available since MySQL 4.0.13.

@item @code{MySQL-embedded-VERSION.i386.rpm}

The embedded MySQL server library (from MySQL 4.0).

@item @code{MySQL-VERSION.src.rpm}

This contains the source code for all of the previous packages. It can also
be used to rebuild the RPMs on other architectures (for example, Alpha or SPARC).
@end itemize

To see all files in an RPM package (for example, a @code{MySQL-server}
RPM), run:

@example
shell> rpm -qpl MySQL-server-VERSION.i386.rpm
@end example

To perform a standard minimal installation, run:

@example
shell> rpm -i MySQL-server-VERSION.i386.rpm
shell> rpm -i MySQL-client-VERSION.i386.rpm
@end example

To install just the client package, run:

@example
shell> rpm -i MySQL-client-VERSION.i386.rpm
@end example

RPM provides a feature to verify the integrity and authenticity of packages
before installing them. If you would like to learn more about this feature
please see @ref{Verifying Package Integrity}.

The server RPM places data under the @file{/var/lib/mysql} directory. The
RPM also creates the appropriate entries in @file{/etc/init.d/} to start the
server automatically at boot time. (This means that if you have performed a
previous installation and have made changes to its startup script, you may
want to make a copy of the script so you don't lose it when you install a
newer RPM.) See @ref{Automatic start} for more information on how MySQL can be
started automatically on system startup.

If you want to install the MySQL RPM on older Linux distributions that do
not support initialization scripts in @file{/etc/init.d} (directly
or via a symlink), you should create a symbolic link that points
to the location where your initialization scripts actually are
installed. For example, if that location is @file{/etc/rc.d/init.d},
use these commands before installing the RPM to create @file{/etc/init.d}
as a symbolic link that points there:

@example
shell> cd /etc; ln -s rc.d/init.d .
@end example

However, all current major Linux distributions should already support the
new directory layout that uses @file{/etc/init.d}, because it is
required for LSB (Linux Standard Base) compliance.

If the RPM files that you install include @code{MySQL-server}, the
@code{mysqld} server should be up and running after installation.
You should now be able to start using MySQL.
@xref{Post-installation}.

If something goes wrong, you can find more information in the binary
installation chapter. @xref{Installing binary}.


@node Mac OS X installation, NetWare installation, Linux-RPM, Quick Standard Installation
@subsection Installing MySQL on Mac OS X

@cindex Mac OS X, installation
@cindex installing, Mac OS X PKG packages

Beginning with MySQL 4.0.11, you can install MySQL on Mac OS X 10.2
(``Jaguar'') using a Mac OS X binary package in @code{PKG} format instead of the
binary tarball distribution. Please note that older versions of Mac OS X
(for example, 10.1.x) are not supported by this package.

The package is located inside a disk image (@code{.dmg}) file, that you
first need to mount by double-clicking its icon in the Finder. It should
then mount the image and display its contents.

@strong{NOTE}: Before proceeding with the installation, be sure to
shut down all running MySQL server instances by either
using the MySQL Manager Application (on Mac OS X Server) or via
@code{mysqladmin shutdown} on the command line.

To actually install the MySQL PKG file, double click on the package icon. This
launches the Mac OS X Package Installer, which will guide you through
the installation of MySQL.

Due to a bug in the Mac OS X package installer, you may sometimes see the
error message @code{You cannot install this software on this disk. (null)}
in the destination disk selection dialogue. If this error occurs, simply
click the @code{Go Back} button once to return to the previous screen. Then
click @code{Continue} to advance to the destination disk selection again,
and you should be able to choose the destination disk correctly. We have
reported this bug to Apple and they are investigating this problem.

The Mac OS X PKG of MySQL will install itself into
@file{/usr/local/mysql-<version>} and will also install a symbolic link
@file{/usr/local/mysql}, pointing to the new location. If a directory named
@file{/usr/local/mysql} already exists, it will be renamed to
@file{/usr/local/mysql.bak} first. Additionally, it will install the
grant tables in the @code{mysql} database by executing @code{mysql_install_db}
after the installation.

The installation layout is similar to the one of the binary distribution;
all MySQL binaries are located in the directory @file{/usr/local/mysql/bin}.
The MySQL socket file is created as @file{/tmp/mysql.sock} by default.
@xref{Installation layouts}.

MySQL installation requires a Mac OS X user account named @code{mysql}
(a user account with this name should exist by default
on Mac OS X 10.2 and up).

If you are running Mac OS X Server, you already have a version of MySQL
installed.  The versions of MySQL that ship with Mac OS X Server versions are
shown in the following table:

@multitable @columnfractions .30 .30
@item @strong{Mac OS X Server Version} @tab @strong{MySQL Version}
@item 10.2-10.2.2   @tab 3.23.51
@item 10.2.3-10.2.6 @tab 3.23.53
@item 10.3          @tab 4.0.14
@item 10.3.2        @tab 4.0.16
@end multitable

This manual section covers the installation of the official MySQL Mac OS X
PKG only.  Make sure to read Apple's help about installing MySQL (Run the
``Help View'' application, select ``Mac OS X Server'' help, and do a search for
``MySQL'' and read the item entitled ``Installing MySQL'').

@c This instance of safe_mysqld should be left unchanged
Especially note that for pre-installed versions of MySQL on Mac OS X Server,
you should start @code{mysqld} with @code{safe_mysqld} instead of
@code{mysqld_safe} if the MySQL is older than version 4.0.

If you previously used Marc Liyanage's MySQL packages for Mac OS X from
@uref{http://www.entropy.ch}, you can simply follow the update instructions
for packages using the binary installation layout as given on his pages.

If you are upgrading from Marc's 3.23.xx versions or from the Mac OS X
Server version of MySQL to the official MySQL PKG, you also need to convert
the existing MySQL privilege tables to the current format, because
some new security privileges have been added.
@xref{Upgrading-grant-tables}.

If you would like to automatically start up MySQL during system bootup, you
also need to install the MySQL Startup Item. Starting with MySQL 4.0.15, it
is part of the Mac OS X installation disk images as a separate installation
package. Simply double-click the @code{MySQLStartupItem.pkg} icon and follow
the instructions to install it.

Note that the Startup Item need be installed only once! There is no need to
install it each time you upgrade the MySQL package later.

The Startup Item will be installed into @file{/Library/StartupItems/MySQL}.
It adds a variable @code{MYSQLCOM=-YES-} to the system configuration file
@file{/etc/hostconfig}. If you would like to disable the automatic startup
of MySQL, simply change this variable to @code{MYSQLCOM=-NO-}.

On Mac OS X Server, the default MySQL installation uses the variable
@code{MYSQL} in @file{/etc/hostconfig}.  The MySQL AB Startup Item installer
disables this variable by setting it to @code{MYSQL=-NO-}. This avoids
boot time conflicts with the @code{MYSQLCOM} variable used by the MySQL AB
Startup Item.  However, it does not shut down an already running MySQL server.

After the installation, you can start up MySQL by running the following
commands in a terminal window. Please note that you must have
administrator privileges to perform this task.

If you have installed the Startup Item:

@example
shell> sudo /Library/StartupItems/MySQL/MySQL start
(Enter your password, if necessary)
(Press Control-D or enter "exit" to exit the shell)
@end example

If you don't use the Startup Item, enter the following command sequence:

@example
shell> cd /usr/local/mysql
shell> sudo ./bin/mysqld_safe
(Enter your password, if necessary)
(Press Control-Z)
shell> bg
(Press Control-D or enter "exit" to exit the shell)
@end example

You should now be able to connect to the MySQL server, for example, by running
@file{/usr/local/mysql/bin/mysql}.

If you are installing MySQL for the first time, @strong{please remember to set a
password for the MySQL @code{root} user!}

This is done with the following two commands:

@example
/usr/local/mysql/bin/mysqladmin -u root password <password>
/usr/local/mysql/bin/mysqladmin -u root -h `hostname` password <password>
@end example

Please make sure that the @code{hostname} command in the second line
is enclosed by @strong{backtick} characters (@code{`}), so the shell can
replace it with the output of the command (which is the hostname of your
system)!

You might want to also add aliases to your shell's resource file to
access @code{mysql} and @code{mysqladmin} from the command line. The syntax
for @code{tcsh} is:

@example
alias mysql /usr/local/mysql/bin/mysql
alias mysqladmin /usr/local/mysql/bin/mysqladmin
@end example

For @code{bash}, use:

@example
alias mysql=/usr/local/mysql/bin/mysql
alias mysqladmin=/usr/local/mysql/bin/mysqladmin
@end example

Even better,
add @code{/usr/local/mysql/bin} to
your @code{PATH} environment variable. For example, add the following
line to your @file{$HOME/.tcshrc} file if your shell is @code{tcsh}:

@example
setenv PATH $@{PATH@}:/usr/local/mysql/bin
@end example

If no @file{.tcshrc} file exists in your home directory, create it with a text
editor.

If you are upgrading an existing installation,
please note that installing a new MySQL PKG does not remove the directory
of an older installation. Unfortunately, the Mac OS X Installer does not yet
offer the functionality required to properly upgrade previously installed
packages.

To use your existing databases with the new installation, you'll need to copy
the contents of the old data directory to the new data directory. Make sure
neither the old server nor the new one is running when you do this.
After you have copied over the MySQL database files from the
previous installation and have successfully started the new server, you should
consider removing the old installation files to save disk space.
Additionally, you should also remove older versions of the Package Receipt
directories located in @file{/Library/Receipts/mysql-<version>.pkg}.

@node NetWare installation, Binary notes-HP-UX, Mac OS X installation, Quick Standard Installation
@subsection Installing MySQL on NetWare

@cindex Novell NetWare
@cindex NetWare

Porting @code{MySQL} to @code{NetWare} was an effort spearheaded by
@code{Novell}. Novell customers will be pleased to note that NetWare 6.5
will ship with bundled MySQL binaries, complete with an automatic
commercial use license for all servers running that version of NetWare.

As of version 4.0.11, the MySQL server is available for Novell NetWare in
binary package form.  MySQL for NetWare is compiled using a combination
of @code{Metrowerks CodeWarrior for NetWare} and special cross-compilation
versions of the GNU autotools.

In order to host MySQL, the NetWare server must meet these requirements:

@itemize @bullet
@item
NetWare version 6.5, or NetWare 6.0 with Support Pack 3 installed (You can
obtain this at @uref{http://support.novell.com/filefinder/13659/index.html}).
The system must meet Novell's minimum requirements to run the respective
version of NetWare.
@item
MySQL data, as well as the binaries themselves, must be installed on an
NSS volume; traditional volumes are not supported.
@end itemize

The binary package for NetWare can be obtained at
@uref{http://www.mysql.com/downloads/}.

To install MySQL for NetWare, use the following procedure:

@enumerate
@item
If you are upgrading from a prior installation, stop the MySQL server.
This is done from the server console, using the following command:

@example
SERVER:  mysqladmin -u root shutdown
@end example

@item
Log on to the target server from a client machine with access to the
location where you will install MySQL.

@item
Extract the binary package zip file onto the server. Be sure to allow
the paths in the zip file to be used. It is safe to simply extract the
file to @file{SYS:\}.

If you are upgrading from a prior installation, you may need to copy the
data directory (for example, @file{SYS:MYSQL\DATA}) now, as well as @file{my.cnf}
if you have customized it. You can then delete the old copy of MySQL.

@item
You may wish to rename the directory to something more consistent and easy
to use. We recommend using @file{SYS:MYSQL}; examples in the manual will
use this to refer to the installation directory in general.
@item
At the server console, add a search path for the directory containing the
MySQL NLMs. For example:

@example
SERVER:  SEARCH ADD SYS:MYSQL\BIN
@end example

@item
Install the initial database, if needed, by executing @code{mysql_install_db}
at the server console.

@item
Start the MySQL server using @code{mysqld_safe} at the server console.

@item
To finish the installation, you should also add the following commands to
@code{autoexec.ncf}. For example, if your MySQL installation is in
@file{SYS:MYSQL} and you want MySQL to start automatically, you could
add these lines:

@example
#Starts the MySQL 4.0.x database server
SEARCH ADD SYS:MYSQL\BIN
MYSQLD_SAFE
@end example

If you are running MySQL on NetWare 6.0, we strongly suggest that you use the
@code{--skip-external-locking} option on the command line:

@example
#Starts the MySQL 4.0.x database server
SEARCH ADD SYS:MYSQL\BIN
MYSQLD_SAFE --skip-external-locking
@end example

It will also be neccesary to use @code{CHECK TABLE} and @code{REPAIR
TABLE} instead of @code{myisamchk}, because @code{myisamchk} makes use
of external locking.  External locking is known to have problems on
NetWare 6.0; the problem has been eliminated in NetWare 6.5.

@end enumerate

If there was an existing installation of MySQL on the server, be sure
to check for existing MySQL startup commands in @code{autoexec.ncf},
and edit or delete them as necessary.


@node Binary notes-HP-UX, Installing binary, NetWare installation, Quick Standard Installation
@subsection Installing MySQL on HP-UX

@cindex HP-UX, binary distribution
@cindex binary distributions, on HP-UX

Binary distributions of MySQL for HP-UX are distributed as HP depot files or
as @code{tar} files.  To use the depot file you must be running at least
HP-UX 10.x to have access to HP's software depot tools.  To install the
HP-UX @code{tar.gz} distribution, you must have a copy of GNU @code{tar}.

The HP version of MySQL was compiled on an HP 9000/8xx server
under HP-UX 10.20, and uses MIT-pthreads.  It is known to work well under
this configuration.  MySQL Version 3.22.26 and newer can also be
built with HP's native thread package.

Other configurations that may work:

@itemize @bullet
@item
HP 9000/7xx running HP-UX 10.20+
@item
HP 9000/8xx running HP-UX 10.30
@end itemize

The following configurations almost definitely won't work:

@itemize @bullet
@item
HP 9000/7xx or 8xx running HP-UX 10.x where x < 2
@item
HP 9000/7xx or 8xx running HP-UX 9.x
@end itemize

To install the distribution, use one of the commands here, where
@code{/path/to/depot} is the full pathname of the depot file:

@itemize @bullet
@item
To install everything, including the server, client and development tools:

@example
shell> /usr/sbin/swinstall -s /path/to/depot mysql.full
@end example

@item
To install only the server:

@example
shell> /usr/sbin/swinstall -s /path/to/depot mysql.server
@end example

@item
To install only the client package:

@example
shell> /usr/sbin/swinstall -s /path/to/depot mysql.client
@end example

@item
To install only the development tools:

@example
shell> /usr/sbin/swinstall -s /path/to/depot mysql.developer
@end example
@end itemize

The depot places binaries and libraries in @file{/opt/mysql} and data in
@file{/var/opt/mysql}. The depot also creates the appropriate entries in
@file{/etc/init.d} and @file{/etc/rc2.d} to start the server automatically
at boot time.  Obviously, this entails being @code{root} to install.


@node Installing binary,  , Binary notes-HP-UX, Quick Standard Installation
@subsection Installing MySQL on Other Unix-like Systems

@cindex installing, binary distribution
@cindex binary distributions, installing

This section covers the installation of MySQL binary distributions that are
provided for various platforms in the form of @code{tar} files (files with a
@code{.tar.gz} extension).
See @ref{MySQL binaries} for a detailed list.

In addition to these generic packages, we also offer binaries in
platform-specific package formats for selected platforms.
See @ref{Quick Standard Installation} for more information on how to install
these.

You need the following tools to install a MySQL @code{tar} file binary
distribution:

@itemize @bullet
@item
GNU @code{gunzip} to uncompress the distribution.

@item
A reasonable @code{tar} to unpack the distribution. GNU @code{tar} is known
to work. Some operating systems come with a pre-installed version of
@code{tar} that is known to have problems.  For example, Sun @code{tar} and
Mac OS X @code{tar} are known to have problems with long filenames.  In such
cases, you should install GNU @code{tar} first.  On Mac OS X, you can use
the pre-installed @code{gnutar} program.
@end itemize

@c texi2html fails to split chapters if I use strong for all of this.
If you run into problems, @strong{please always use @code{mysqlbug}} when
posting questions to a MySQL mailing list.  Even if the problem
isn't a bug, @code{mysqlbug} gathers system information that will help others
solve your problem.  By not using @code{mysqlbug}, you lessen the likelihood
of getting a solution to your problem.  You will find @code{mysqlbug} in the
@file{bin} directory after you unpack the distribution.  @xref{Bug reports}.

@cindex commands, for binary distribution
The basic commands you must execute to install and use a MySQL
binary distribution are:

@example
shell> groupadd mysql
shell> useradd -g mysql mysql
shell> cd /usr/local
shell> gunzip < /path/to/mysql-VERSION-OS.tar.gz | tar xvf -
shell> ln -s full-path-to-mysql-VERSION-OS mysql
shell> cd mysql
shell> scripts/mysql_install_db
shell> chown -R root  .
shell> chown -R mysql data
shell> chgrp -R mysql .
shell> bin/mysqld_safe --user=mysql &
@end example

For versions of MySQL older than 4.0, substitute @code{bin/safe_mysqld}
for @code{bin/mysqld_safe} in the final command.

A more detailed description follows.

To install a binary distribution, follow these steps, then proceed
to @ref{Post-installation}, for post-installation setup and testing:

@enumerate

@item
Add a user and group for @code{mysqld} to run as:

@example
shell> groupadd mysql
shell> useradd -g mysql mysql
@end example

These commands add the @code{mysql} group and the @code{mysql} user.  The
syntax for @code{useradd} and @code{groupadd} may differ slightly on different
versions of Unix.  They may also be called @code{adduser} and @code{addgroup}.
You may wish to call the user and group something else instead of @code{mysql}.

@item
Pick the directory under which you want to unpack the distribution, and move
into it. In the following example, we unpack the distribution under
@file{/usr/local} (The following instructions, therefore, assume you have
permission to create files and directories in @file{/usr/local}.
If that directory is protected, you will need to perform the installation as
@code{root}.)

@item
Obtain a distribution file from one of the sites listed in
@ref{Getting MySQL, , Getting MySQL}.

MySQL @code{tar} file binary distributions
have names like @file{mysql-VERSION-OS.tar.gz}, where
@code{VERSION} is a number (for example, @code{4.0.17}), and @code{OS}
indicates the type of operating system for which the distribution is intended
(for example, @code{pc-linux-gnu-i586}).
For a given release, binary distributions for all platforms
are built from the same MySQL source distribution.

@item
Change into the intended installation directory:

@example
shell> cd /usr/local
@end example

@item
Unpack the distribution, which will create the installation directory.
Then create a symbolic link to that directory:

@example
shell> gunzip < /path/to/mysql-VERSION-OS.tar.gz | tar xvf -
shell> ln -s full-path-to-mysql-VERSION-OS mysql
@end example

The @code{tar} command creates a directory named @file{mysql-VERSION-OS}.  The
@code{ln} command makes a symbolic link to that directory.  This lets you refer
more easily to the installation directory as @file{/usr/local/mysql}.

With GNU @code{tar}, no separate invocation of @code{gunzip} is necessary.
You can replace the first line with the following
alternative command to uncompress and extract the distribution:

@example
shell> tar zxvf /path/to/mysql-VERSION-OS.tar.gz
@end example

@item
Change into the installation directory:

@example
shell> cd mysql
@end example

You will find several files and subdirectories in the @code{mysql} directory.
The most important for installation purposes are the @file{bin} and
@file{scripts} subdirectories.

@table @file
@item bin
@tindex PATH environment variable
@tindex environment variable, PATH
This directory contains client programs and the server.
You should add the full pathname of this directory to your
@code{PATH} environment variable so that your shell finds the MySQL
programs properly. @xref{Environment variables}.

@item scripts
This directory contains the @code{mysql_install_db} script used to initialize
the @code{mysql} database containing the grant tables that store the server
access permissions.
@end table

@item
If you haven't installed MySQL before, you must create the MySQL grant tables:

@example
shell> scripts/mysql_install_db
@end example

Note that for MySQL versions older than Version 3.22.10,
@code{mysql_install_db} left the server running after creating the grant
tables.  This is no longer true; you will need to restart the server after
performing the remaining steps in this procedure.

@item
Change ownership of program binaries to @code{root} and ownership of the data
directory to the user that you will run @code{mysqld} as.  Assuming that you
are located in the installation directory (@file{/usr/local/mysql}), the
commands look like this:

@example
shell> chown -R root  .
shell> chown -R mysql data
shell> chgrp -R mysql .
@end example

The first command changes the @code{owner} attribute of the files to the
@code{root} user. The second changes the @code{owner} attribute of the
data directory to the @code{mysql} user. The third changes the
@code{group} attribute to the @code{mysql} group.

@item
If you would like MySQL to start automatically when you boot your
machine, you can copy @code{support-files/mysql.server} to the location where
your system has its startup files.  More information can be found in the
@code{support-files/mysql.server} script itself and in
@ref{Automatic start}.

@item
@cindex adding, new users
@cindex new users, adding
@cindex users, adding
You can set up new accounts using the @code{bin/mysql_setpermission} script if
you install the @code{DBI} and @code{DBD::mysql} Perl modules.
For instructions, see @ref{Perl support}.

@item
If you would like to use @code{mysqlaccess} and have the MySQL
distribution in some non-standard place, you must change the location where
@code{mysqlaccess} expects to find the @code{mysql} client.  Edit the
@file{bin/mysqlaccess} script at approximately line 18.  Search for a line
that looks like this:

@example
$MYSQL     = '/usr/local/bin/mysql';    # path to mysql executable
@end example

Change the path to reflect the location where @code{mysql} actually is
stored on your system.  If you do not do this, you will get a @code{Broken
pipe} error when you run @code{mysqlaccess}.

@end enumerate

After everything has been unpacked and installed, you should
test your distribution.

You can start the MySQL server with the following command:

@example
shell> bin/mysqld_safe --user=mysql &
@end example

For versions of MySQL older than 4.0, substitute @code{bin/safe_mysqld}
for @code{bin/mysqld_safe} in the command.

Now proceed to @ref{mysqld_safe, , @code{mysqld_safe}}, and
@ref{Post-installation}.


@node Installing source, Post-installation, Quick Standard Installation, Installing
@section MySQL Installation Using a Source Distribution

@cindex installing, source distribution
@cindex source distribution, installing
@cindex installation overview

@c TODO: Needs intro to mention both Unix and Windows, and how to proceed.
@c Need better outline here. Most of the Unix sections should go under
@c a @subsection and be demoted to @subsubsection.

Before you proceed with the source installation, check first to see whether our
binary is available for your platform and whether it will work for you. We
put a lot of effort into making sure that our binaries are built with the
best possible options.

You need the following tools to build and install MySQL from source:

@itemize @bullet
@item
GNU @code{gunzip} to uncompress the distribution.

@item
A reasonable @code{tar} to unpack the distribution. GNU @code{tar} is
known to work. Some @code{tar} implementations that come pre-installed
with the operating system (for example, Sun @code{tar}) is known to have
problems with long file names). In that case, you should install
GNU @code{tar} first.

@item
A working ANSI C++ compiler.  @code{gcc} 2.95.2 or later, @code{egcs} 1.0.2 or later or @code{egcs 2.91.66}, SGI C++, and SunPro C++ are some of the
compilers that are known to work.  @code{libg++} is not needed when
using @code{gcc}.  @code{gcc} 2.7.x has a bug that makes it impossible
to compile some perfectly legal C++ files, such as
@file{sql/sql_base.cc}.  If you only have @code{gcc} 2.7.x, you must
upgrade your @code{gcc} to be able to compile MySQL. @code{gcc}
2.8.1 is also known to have problems on some platforms, so it should be
avoided if a new compiler exists for the platform.

@code{gcc} 2.95.2 or later is recommended when compiling MySQL
Version 3.23.x.

@item
A good @code{make} program.  GNU @code{make} is always recommended and is
sometimes required.  If you have problems, we recommend trying GNU
@code{make} 3.75 or newer.
@end itemize

If you are using a recent version of @code{gcc}, recent enough to understand the
@code{-fno-exceptions} option, it is @strong{very important} that you use
it. Otherwise, you may compile a binary that crashes randomly. We also
recommend that you use @code{-felide-constructors} and @code{-fno-rtti} along
with @code{-fno-exceptions}. When in doubt, do the following:

@example

CFLAGS="-O3" CXX=gcc CXXFLAGS="-O3 -felide-constructors \
       -fno-exceptions -fno-rtti" ./configure \
       --prefix=/usr/local/mysql --enable-assembler \
       --with-mysqld-ldflags=-all-static

@end example

On most systems this will give you a fast and stable binary.

@c texi2html fails to split chapters if I use strong for all of this.
If you run into problems, @strong{please always use @code{mysqlbug}} when
posting questions to a MySQL mailing list.  Even if the problem
isn't a bug, @code{mysqlbug} gathers system information that will help others
solve your problem.  By not using @code{mysqlbug}, you lessen the likelihood
of getting a solution to your problem.  You will find @code{mysqlbug} in the
@file{scripts} directory after you unpack the distribution.
@xref{Bug reports}.

@menu
* Quick install::               Quick Source Installation Overview
* configure options::           Typical @code{configure} Options
* Installing source tree::      Installing from the Development Source Tree
* Compilation problems::        Dealing With Problems Compiling MySQL
* MIT-pthreads::                MIT-pthreads Notes
* Windows source build::        Installing MySQL from Source on Windows
* Windows client compiling::    Compiling MySQL Clients on Windows
@end menu


@node Quick install, configure options, Installing source, Installing source
@subsection Quick Source Installation Overview

The basic commands you must execute to install a MySQL source
distribution are:

@example
shell> groupadd mysql
shell> useradd -g mysql mysql
shell> gunzip < mysql-VERSION.tar.gz | tar -xvf -
shell> cd mysql-VERSION
shell> ./configure --prefix=/usr/local/mysql
shell> make
shell> make install
shell> cp support-files/my-medium.cnf /etc/my.cnf
shell> cd /usr/local/mysql
shell> bin/mysql_install_db
shell> chown -R root  .
shell> chown -R mysql var
shell> chgrp -R mysql .
shell> bin/mysqld_safe --user=mysql &
@end example

For versions of MySQL older than 4.0, substitute @code{bin/safe_mysqld}
for @code{bin/mysqld_safe} in the final command.

If you start from a source RPM, do the following:

@example
shell> rpm --rebuild --clean MySQL-VERSION.src.rpm
@end example

This will make a binary RPM that you can install.

A more detailed description follows.

To install a source distribution, follow these steps, then proceed
to @ref{Post-installation}, for post-installation initialization and testing:

@enumerate

@item
Add a user and group for @code{mysqld} to run as:

@example
shell> groupadd mysql
shell> useradd -g mysql mysql
@end example

These commands add the @code{mysql} group and the @code{mysql} user.  The
syntax for @code{useradd} and @code{groupadd} may differ slightly on different
versions of Unix.  They may also be called @code{adduser} and @code{addgroup}.
You may wish to call the user and group something else instead of @code{mysql}.

@item
Pick the directory under which you want to unpack the distribution, and move
into it.

@item
Obtain a distribution file from one of the sites listed in
@ref{Getting MySQL, , Getting MySQL}.
MySQL source distributions are provided as compressed @code{tar}
archives and have names like @file{mysql-VERSION.tar.gz}, where
@code{VERSION} is a number like @code{@value{mysqlversion}}.

@item
Unpack the distribution into the current directory:
@example
shell> gunzip < /path/to/mysql-VERSION.tar.gz | tar xvf -
@end example

This command creates a directory named @file{mysql-VERSION}.

With GNU @code{tar}, no separate invocation of @code{gunzip} is necessary.
You can use the following alternative command to uncompress and extract
the distribution:

@example
shell> tar zxvf /path/to/mysql-VERSION-OS.tar.gz
@end example

@item
Change into the top-level directory of the unpacked distribution:

@example
shell> cd mysql-VERSION
@end example

Note that currently you must configure and build MySQL from
this top-level directory.  You cannot build it in a different
directory.

@item
Configure the release and compile everything:

@example
shell> ./configure --prefix=/usr/local/mysql
shell> make
@end example

When you run @code{configure}, you might want to specify some options.
Run @code{./configure --help} for a list of options.
@ref{configure options, , @code{configure} options}, discusses some of the
more useful options.

If @code{configure} fails and you are going to send mail to a MySQL mailing
list to ask for assistance, please include any
lines from @file{config.log} that you think can help solve the problem.  Also
include the last couple of lines of output from @code{configure}.
Post the bug report using the @code{mysqlbug}
script.  @xref{Bug reports}.

If the compile fails, see @ref{Compilation problems}, for help with
a number of common problems.

@item
Install the distribution:

@example
shell> make install
@end example

If you want to set up an option file, use one of those present in the
@file{support-files} directory as template. For example:

@example
shell> cp support-files/my-medium.cnf /etc/my.cnf
@end example

You might need to run these commands as @code{root}.

If you want to configure support for @code{InnoDB} tables, you should edit the
@code{/etc/my.cnf} file, remove the @code{#} character before the
option lines that start with @code{innodb_...}, and modify the option values
to be what you want.
@xref{Option files}, and @ref{InnoDB start}.

@item
Change location into the installation directory:

@example
shell> cd /usr/local/mysql
@end example

@item
If you haven't installed MySQL before, you must create the MySQL grant tables:

@example
shell> bin/mysql_install_db
@end example

Note that for MySQL versions older than Version 3.22.10,
@code{mysql_install_db} left the server running after creating the grant
tables.  This is no longer true; you will need to restart the server after
performing the remaining steps in this procedure.

@item
Change ownership of binaries to @code{root} and ownership of the data
directory to the user that you will run @code{mysqld} as.  Assuming that you
are located in the installation directory (@file{/usr/local/mysql}), the
commands look like this:

@example
shell> chown -R root  .
shell> chown -R mysql var
shell> chgrp -R mysql .
@end example

The first command changes the @code{owner} attribute of the files to the
@code{root} user. The second changes the @code{owner} attribute of the
data directory to the @code{mysql} user. The third changes the
@code{group} attribute to the @code{mysql} group.

@item
If you would like MySQL to start automatically when you boot your
machine, you can copy @code{support-files/mysql.server} to the location where
your system has its startup files.  More information can be found in the
@code{support-files/mysql.server} script itself and in
@ref{Automatic start}.

@item
@cindex adding, new users
@cindex new users, adding
@cindex users, adding
You can set up new accounts using the @code{bin/mysql_setpermission} script if
you install the @code{DBI} and @code{DBD::mysql} Perl modules.
For instructions, see @ref{Perl support}.

@end enumerate

After everything has been installed, you should initialize and test your
distribution using this command:

@example
shell> /usr/local/mysql/bin/mysqld_safe --user=mysql &
@end example

For versions of MySQL older than 4.0, substitute @code{bin/safe_mysqld}
for @code{bin/mysqld_safe} in the command.

If that command fails immediately and prints @code{mysqld ended}, you can
find some information in the file @file{mysql-data-directory/'hostname'.err}.
The likely reason is that you already have another @code{mysqld} server
running.  @xref{Multiple servers}.

Now proceed to @ref{Post-installation}.


@node configure options, Installing source tree, Quick install, Installing source
@subsection Typical @code{configure} Options

@findex without-server option
@cindex @code{configure} script
@cindex options, configure
@cindex configuration options
@cindex log files
@cindex files, log

The @code{configure} script gives you a great deal of control over how
you configure a MySQL source distribution.  Typically you do this
using options on the @code{configure} command-line.  You can also affect
@code{configure} using certain environment variables.  @xref{Environment
variables}.  For a list of options supported by @code{configure}, run
this command:

@example
shell> ./configure --help
@end example

Some of the more commonly used @code{configure} options are described here:

@itemize @bullet
@item
To compile just the MySQL client libraries and client programs and
not the server, use the @code{--without-server} option:

@example
shell> ./configure --without-server
@end example

@c FIX incorrect..

If you don't have a C++ compiler, @code{mysql} will not compile (it is the
one client program that requires C++).  In this case,
you can remove the code in @code{configure} that tests for the C++ compiler
and then run @code{./configure} with the @code{--without-server} option. The
compile step will still try to build @code{mysql}, but you can ignore any
warnings about @file{mysql.cc}.  (If @code{make} stops, try @code{make -k}
to tell it to continue with the rest of the build even if errors occur.)

@item
If you want to get an embedded MySQL library (@code{libmysqld.a}) you should
use the @code{--with-embedded-server} option.

@item
If you don't want your log files and database directories located under
@file{/usr/local/var}, use a @code{configure} command, something like one
of these:

@example
shell> ./configure --prefix=/usr/local/mysql
shell> ./configure --prefix=/usr/local \
           --localstatedir=/usr/local/mysql/data
@end example

The first command changes the installation prefix so that everything is
installed under @file{/usr/local/mysql} rather than the default of
@file{/usr/local}.  The second command preserves the default installation
prefix, but overrides the default location for database directories
(normally @file{/usr/local/var}) and changes it to
@code{/usr/local/mysql/data}.  After you have compiled MySQL, you can
change these options with option files. @xref{Option files}.

@cindex changing socket location
@cindex socket location, changing
@cindex mysql.sock, changing location of
@item
If you are using Unix and you want the MySQL socket located somewhere
other than the default location (normally in the directory @file{/tmp} or
@file{/var/run}) use a @code{configure} command like this:

@example
shell> ./configure \
           --with-unix-socket-path=/usr/local/mysql/tmp/mysql.sock
@end example

Note that the given file must be an absolute pathname.
You can also later change the location of @file{mysql.sock} by using a MySQL
option file. @xref{Problems with mysql.sock,  , Problems with @file{mysql.sock}}.

@cindex compiling, statically
@cindex statically, compiling
@item
If you want to compile statically linked programs (for example, to make a
binary distribution, to get more speed, or to work around problems with some
Red Hat Linux distributions), run @code{configure} like this:

@example
shell> ./configure --with-client-ldflags=-all-static \
           --with-mysqld-ldflags=-all-static
@end example



@tindex @code{CC} environment variable
@tindex environment variable, @code{CC}
@tindex @code{CXX} environment variable
@tindex environment variable, @code{CXX}
@cindex @code{gcc}
@cindex C++ compiler, @code{gcc}
@cindex compiler, C++ @code{gcc}
@item
If you are using @code{gcc} and don't have @code{libg++} or @code{libstdc++}
installed, you can tell @code{configure} to use @code{gcc} as your C++
compiler:

@example
shell> CC=gcc CXX=gcc ./configure
@end example

When you use @code{gcc} as your C++ compiler, it will not attempt to link in
@code{libg++} or @code{libstdc++}.  This may be a good idea to do even if you
have the above libraries installed, as some versions of these libraries have
caused strange problems for MySQL users in the past.

The following list indicates some compilers and environment variable settings
that are commonly used with each one.

@tindex CC environment variable
@tindex environment variable, CC
@tindex CXX environment variable
@tindex environment variable, CXX
@tindex CFLAGS environment variable
@tindex environment variable, CFLAGS
@tindex CXXFLAGS environment variable
@tindex environment variable, CXXFLAGS

@table @asis
@item
@item @code{gcc} 2.7.2:
@code{CC=gcc CXX=gcc CXXFLAGS="-O3 -felide-constructors"}
@item @code{egcs} 1.0.3a:
@code{CC=gcc CXX=gcc CXXFLAGS="-O3 -felide-constructors \
-fno-exceptions -fno-rtti"}
@item @code{gcc} 2.95.2:
@code{CFLAGS="-O3 -mpentiumpro" CXX=gcc CXXFLAGS="-O3 -mpentiumpro \
-felide-constructors -fno-exceptions -fno-rtti"}
@item @code{pgcc} 2.90.29 or newer:
@code{CFLAGS="-O3 -mpentiumpro -mstack-align-double" CXX=gcc \
CXXFLAGS="-O3 -mpentiumpro -mstack-align-double \
-felide-constructors -fno-exceptions -fno-rtti"}
@end table

In most cases you can get a reasonably optimal MySQL binary by using the
options from the preceding list and adding the following options to the
@code{configure} line:

@example
--prefix=/usr/local/mysql --enable-assembler \
--with-mysqld-ldflags=-all-static
@end example

The full @code{configure} line would, in other words, be something like the
following for all recent @code{gcc} versions:

@example
CFLAGS="-O3 -mpentiumpro" CXX=gcc CXXFLAGS="-O3 -mpentiumpro \
-felide-constructors -fno-exceptions -fno-rtti" ./configure \
--prefix=/usr/local/mysql --enable-assembler \
--with-mysqld-ldflags=-all-static
@end example

The binaries we provide on the MySQL web site at
@uref{http://www.mysql.com/} are all compiled with full optimization and
should be perfect for most users.  @xref{MySQL binaries}.  There are some
configuration setings you can tweak to make an even faster binary, but this
is only for advanced users.  @xref{Compile and link options}.

If the build fails and produces errors about your compiler or linker not
being able to create the shared library @file{libmysqlclient.so.#} (@samp{#}
is a version number), you can work around this problem by giving the
@code{--disable-shared} option to @code{configure}.  In this case,
@code{configure} will not build a shared @file{libmysqlclient.so.#} library.

@cindex default values, suppression
@cindex suppression, default values
@item
You can configure MySQL not to use @code{DEFAULT} column values for
non-@code{NULL} columns (that is, columns that are not allowed to be
@code{NULL}). @xref{constraint NOT NULL}.

@tindex CXXFLAGS environment variable
@tindex environment variable, CXXFLAGS
@tindex DONT_USE_DEFAULT_FIELDS compiler flag
@tindex compiler flag, DONT_USE_DEFAULT_FIELDS
@example
shell> CXXFLAGS=-DDONT_USE_DEFAULT_FIELDS ./configure
@end example

The effect of this flag is to cause any @code{INSERT} statement to fail unless
it provides explicit values for all columns that require a non-@code{NULL}
value.

@cindex character sets
@findex configure option, --with-charset
@findex configure option, --with-extra-charsets
@item
By default, MySQL uses the ISO-8859-1 (Latin1) character set. To
change the default set, use the @code{--with-charset} option:
@example
shell> ./configure --with-charset=CHARSET
@end example
@code{CHARSET} may be one of @code{big5}, @code{cp1251}, @code{cp1257},
@code{czech}, @code{danish}, @code{dec8}, @code{dos}, @code{euc_kr},
@code{gb2312}, @code{gbk}, @code{german1}, @code{hebrew}, @code{hp8},
@code{hungarian}, @code{koi8_ru}, @code{koi8_ukr}, @code{latin1},
@code{latin2}, @code{sjis}, @code{swe7}, @code{tis620}, @code{ujis},
@code{usa7}, or @code{win1251ukr}.
@xref{Character sets}.

If you want to convert characters between the server and the client,
you should take a look at the @code{SET CHARACTER SET} command.
@xref{SET OPTION, , @code{SET}}.

@cindex @code{myisamchk}
@strong{Warning:} If you change character sets after having created any
tables, you will have to run @code{myisamchk -r -q --set-character-set=charset}
on every table. Your
indexes may be sorted incorrectly otherwise.  (This can happen if you
install MySQL, create some tables, then reconfigure
MySQL to use a different character set and reinstall it.)

With the @code{configure} option @code{--with-extra-charsets=LIST}, you can
define which additional character sets should be compiled into the server.
@code{LIST} is either a list of character sets separated with spaces,
@code{complex} to include all characters that can't be dynamically loaded,
or @code{all} to include all character sets into the binaries.

@item
To configure MySQL with debugging code, use the @code{--with-debug}
option:
@example
shell> ./configure --with-debug
@end example
This causes a safe memory allocator to be included that can find some errors
and that provides output about what is happening.
@xref{Debugging server}.

@item
If your client programs are using threads, you also must compile a
thread-safe version of the MySQL client library with the
@code{--enable-thread-safe-client} configure options. This will create a
@code{libmysqlclient_r} library with which you should link your threaded
applications.  @xref{Threaded clients}.

@item
Options that pertain to particular systems can be found in the
system-specific section of this manual.
@xref{Operating System Specific Notes}.
@end itemize


@node Installing source tree, Compilation problems, configure options, Installing source
@subsection Installing from the Development Source Tree

@cindex development source tree
@cindex BitKeeper tree
@cindex CVS tree

@strong{Caution}: You should read this section only if you are interested
in helping us test our new code. If you just want to get MySQL up
and running on your system, you should use a standard release distribution
(either a binary or source distribution will do).

To obtain our most recent development source tree, use these instructions:

@enumerate
@item
Download @code{BitKeeper} from
@uref{http://www.bitmover.com/cgi-bin/download.cgi}.  You will need
@code{Bitkeeper} 3.0 or newer to access our repository.

@item
Follow the instructions to install it.

@item
After @code{BitKeeper} is installed, first go to the directory you
want to work from, and then use one of the following commands to clone
the MySQL version branch of your choice:

To clone the old 3.23 branch, use this command:

@example
shell> bk clone bk://mysql.bkbits.net/mysql-3.23 mysql-3.23
@end example

To clone the 4.0 stable (production) branch, use this command:

@example
shell> bk clone bk://mysql.bkbits.net/mysql-4.0 mysql-4.0
@end example

To clone the 4.1 alpha branch, use this command:

@example
shell> bk clone bk://mysql.bkbits.net/mysql-4.1 mysql-4.1
@end example

To clone the 5.0 development branch, use this command:

@example
shell> bk clone bk://mysql.bkbits.net/mysql-5.0 mysql-5.0
@end example

In the preceding examples the source tree will be set up in the
@file{mysql-3.23/}, @file{mysql-4.0/}, @file{mysql-4.1/}, or @file{mysql-5.0/}
subdirectory of your current directory.

If you are behind a firewall and can only initiate HTTP connections,
you can also use @code{BitKeeper} via HTTP.

If you are required to use a proxy server, set the environment
variable @code{http_proxy} to point to your proxy:

@example
shell> export http_proxy="http://your.proxy.server:8080/"
@end example

Now, simply replace the @code{bk://} with @code{http://} when doing
a clone. Example:

@example
shell> bk clone http://mysql.bkbits.net/mysql-4.1 mysql-4.1
@end example

The initial download of the source tree may take a while, depending on the
speed of your connection---please be patient.

@item
You will need GNU @code{make}, @code{autoconf} 2.53 (or newer),
@code{automake} 1.5, @code{libtool} 1.4, and @code{m4} to run the next
set of commands. Even though many operating systems already come with their
own implementation of @code{make}, chances are high that the compilation
will fail with strange error messages. Therefore, it is highly recommended
that you use GNU @code{make} (sometimes named @code{gmake}) instead.

Fortunately, a large number of operating systems already ship with the GNU
toolchain preinstalled or supply installable packages of these. In any case,
they can also be downloaded from the following locations:

@itemize @bullet
@item
@url{http://www.gnu.org/software/autoconf/}
@item
@url{http://www.gnu.org/software/automake/}
@item
@url{http://www.gnu.org/software/libtool/}
@item
@url{http://www.gnu.org/software/make/}
@end itemize

If you are trying to configure MySQL 4.1 or later, you will also need GNU
@code{bison} 1.75 or later.  Older versions of @code{bison} may report this
error:

@example
sql_yacc.yy:#####: fatal error: maximum table size (32767) exceeded
@end example

Note: The maximum table size is not actually exceeded,
the error is caused by bugs in older versions of @code{bison}.

Versions of MySQL before version 4.1 may also compile with other
@code{yacc} implementations (for example, BSD @code{yacc} 91.7.30). For later
versions, GNU @code{bison} is required.

The following example shows the typical commands required to configure a
source tree. The first @code{cd} command changes location into the top-level
directory of the tree; replace @file{mysql-4.0} with the appropriate directory
name.

@example
shell> cd mysql-4.0
shell> bk -r edit
shell> aclocal; autoheader; autoconf; automake
shell> (cd innobase; aclocal; autoheader; autoconf; automake)
shell> (cd bdb/dist; sh s_all)
shell> ./configure  # Add your favorite options here
make
@end example

The command lines that change directory into the @file{innobase} and
@file{bdb/dist} directories are used to configure the @code{InnoDB} and
Berkeley DB (@code{BDB}) storage engines.  You can omit these command lines if
you to not require @code{InnoDB} or @code{BDB} support.

If you get some strange error during this stage, check that you really
have @code{libtool} installed.

A collection of our standard configuration scripts is located in the
@file{BUILD/} subdirectory.  You may find it more convenient to use the
@file{BUILD/compile-pentium-debug} script than the preceding set of
shell commands.. To compile on a different architecture,
modify the script by removing flags that are Pentium-specific.

@item
When the build is done, run @code{make install}.  Be careful with this
on a production machine; the command may overwrite your live release
installation.  If you have another installation of MySQL, we
recommend that you run @code{./configure} with different values for the
@code{--prefix}, @code{--with-tcp-port}, and @code{--unix-socket-path} options
than those used for your production server.

@item
Play hard with your new installation and try to make the new features
crash.  Start by running @code{make test}.  @xref{MySQL test suite}.

@item
If you have gotten to the @code{make} stage and the distribution does
not compile, please report it in our bugs database at
@uref{http://bugs.mysql.com/}.  If you
have installed the latest versions of the required GNU tools, and they
crash trying to process our configuration files, please report that also.
However, if you execute @code{aclocal} and get a @code{command not found}
error or a similar problem, do not report it.  Instead, make sure all
the necessary tools are installed and that your @code{PATH} variable is
set correctly so that your shell can find them.

@item
After the initial @code{bk clone} operation to obtain the source tree, you
should run @code{bk pull} periodically to get updates.

@item
You can examine the change history for the tree with all the diffs by using
@code{bk revtool}.  If you see some funny diffs or code that you have a
question about, do not hesitate to send email to the MySQL internals mailing
list.
@xref{Mailing-list}.
Also, if you think you have a better idea
on how to do something, send an email message to the same address with a patch.
@code{bk diffs} will produce a patch for you after you have made changes
to the source. If you do not have the time to code your idea, just send
a description.

@item
@code{BitKeeper} has a nice help utility that you can access via
@code{bk helptool}.

@item
Please note that any commits (@code{bk ci} or @code{bk citool}) will
trigger the posting of a message with the changeset to our internals
mailing list, as well as the usual openlogging.org submission with
just the changeset comments.
Generally, you wouldn't need to use commit (since the public tree will
not allow @code{bk push}), but rather use the @code{bk diffs} method
described previously.

@end enumerate

You can also browse changesets, comments, and source code online. For example,
to browse this information for MySQL 4.1, go to
@uref{http://mysql.bkbits.net:8080/mysql-4.1}.

The manual is in a separate tree which can be cloned with:

@example
shell> bk clone bk://mysql.bkbits.net/mysqldoc mysqldoc
@end example

There are also public BitKeeper trees for MySQL Control Center and
Connector/ODBC. They can be cloned respectively as follows.

To clone MySQL Control center, use this command:

@example
shell> bk clone http://mysql.bkbits.net/mysqlcc mysqlcc
@end example

To clone Connector/ODBC, use this command:

@example
shell> bk clone http://mysql.bkbits.net/myodbc3 myodbc3
@end example


@node Compilation problems, MIT-pthreads, Installing source tree, Installing source
@subsection Dealing With Problems Compiling MySQL

@cindex compiling, problems
@cindex problems, compiling
@cindex reconfiguring
@cindex @code{config.cache} file
@cindex files, @code{config.cache}

All MySQL programs compile cleanly for us with no warnings on
Solaris or Linux using @code{gcc}.  On other systems, warnings may occur due to
differences in system include files.  See @ref{MIT-pthreads} for warnings
that may occur when using MIT-pthreads.  For other problems, check
the following list.

The solution to many problems involves reconfiguring.  If you do need to
reconfigure, take note of the following:

@cindex running @code{configure} after prior invocation
@cindex @code{configure}, running after prior invocation
@cindex reconfiguring
@cindex config.cache
@itemize @bullet
@item
If @code{configure} is run after it already has been run, it may use
information that was gathered during its previous invocation.  This
information is stored in @file{config.cache}.  When @code{configure} starts
up, it looks for that file and reads its contents if it exists, on the
assumption that the information is still correct.  That assumption is invalid
when you reconfigure.

@item
Each time you run @code{configure}, you must run @code{make} again
to recompile.  However, you may want to remove old object files from previous
builds first because they were compiled using different configuration options.
@end itemize

To prevent old configuration information or object files from being used,
run these commands before re-running @code{configure}:

@example
shell> rm config.cache
shell> make clean
@end example

Alternatively, you can run @code{make distclean}.

The following list describes some of the problems when compiling MySQL
that have been found to occur most often:

@itemize @bullet
@item
@cindex @code{cc1plus} problems
@cindex @code{fatal signal 11}
@cindex @code{sql_yacc.cc} problems
@cindex internal compiler errors
@cindex virtual memory, problems while compiling
@cindex configure option, --with-low-memory
If you get errors when compiling @file{sql_yacc.cc}, such as the ones shown
here, you have probably run out of memory or swap space:

@example
Internal compiler error: program cc1plus got fatal signal 11
@end example
or:
@example
Out of virtual memory
@end example
or:
@example
Virtual memory exhausted
@end example

The problem is that @code{gcc} requires huge amounts of memory to compile
@file{sql_yacc.cc} with inline functions.  Try running @code{configure} with
the @code{--with-low-memory} option:

@example
shell> ./configure --with-low-memory
@end example

This option causes @code{-fno-inline} to be added to the compile line if you
are using @code{gcc} and @code{-O0} if you are using something else.  You
should try the @code{--with-low-memory} option even if you have so much
memory and swap space that you think you can't possibly have run out.  This
problem has been observed to occur even on systems with generous hardware
configurations, and the @code{--with-low-memory} option usually fixes it.

@item
By default, @code{configure} picks @code{c++} as the compiler name and
GNU @code{c++} links with @code{-lg++}.  If you are using @code{gcc},
that behavior can cause problems during configuration such as this:

@cindex C++ compiler cannot create executables
@example
configure: error: installation or configuration problem:
C++ compiler cannot create executables.
@end example

@tindex CXX environment variable
@tindex Environment variable, CXX
You might also observe problems during compilation related to
@code{g++}, @code{libg++}, or @code{libstdc++}.

One cause of these problems is that you may not have @code{g++}, or you may
have @code{g++} but not @code{libg++}, or @code{libstdc++}.  Take a look at
the @file{config.log} file.  It should contain the exact reason why your C++
compiler didn't work.  To work around these problems, you can use @code{gcc}
as your C++ compiler.  Try setting the environment variable @code{CXX} to
@code{"gcc -O3"}.  For example:

@tindex CXX environment variable
@tindex Environment variables, CXX
@example
shell> CXX="gcc -O3" ./configure
@end example

This works because @code{gcc} compiles C++ sources as well as @code{g++}
does, but does not link in @code{libg++} or @code{libstdc++} by default.

Another way to fix these problems is to install @code{g++},
@code{libg++}, and @code{libstdc++}.  We would however like to recommend
you to not use @code{libg++} or @code{libstdc++} with MySQL as this will
only increase the binary size of mysqld without giving you any benefits.
Some versions of these libraries have also caused strange problems for
MySQL users in the past.

@cindex RAID, compile errors
@cindex @code{--with-raid} link errors
Using @code{gcc} as the C++ compiler is also required, if you want to
compile MySQL with RAID functionality (see @ref{CREATE TABLE} for more info
on RAID table type) and you are using GNU @code{gcc} version 3 and above. If
you get errors like the ones below during the linking stage when you
configure MySQL to compile with the option @code{--with-raid}, try to use
@code{gcc} as your C++ compiler by defining the above mentioned environment
variable @code{CXX}:

@example
gcc -O3 -DDBUG_OFF -rdynamic -o isamchk isamchk.o sort.o  libnisam.a
../mysys/libmysys.a ../dbug/libdbug.a ../strings/libmystrings.a
 -lpthread -lz -lcrypt -lnsl -lm -lpthread
../mysys/libmysys.a(raid.o)(.text+0x79): In function
`my_raid_create':: undefined reference to `operator new(unsigned)'
../mysys/libmysys.a(raid.o)(.text+0xdd): In function
`my_raid_create':: undefined reference to `operator delete(void*)'
../mysys/libmysys.a(raid.o)(.text+0x129): In function
`my_raid_open':: undefined reference to `operator new(unsigned)'
../mysys/libmysys.a(raid.o)(.text+0x189): In function
`my_raid_open':: undefined reference to `operator delete(void*)'
../mysys/libmysys.a(raid.o)(.text+0x64b): In function
`my_raid_close':: undefined reference to `operator delete(void*)'
collect2: ld returned 1 exit status
@end example

@item
If your compile fails with errors, such as any of the following,
you must upgrade your version of @code{make} to GNU @code{make}:

@example
making all in mit-pthreads
make: Fatal error in reader: Makefile, line 18:
Badly formed macro assignment
@end example
or:
@example
make: file `Makefile' line 18: Must be a separator (:
@end example
or:
@example
pthread.h: No such file or directory
@end example

@cindex Solaris troubleshooting
@cindex FreeBSD troubleshooting
@cindex troubleshooting, Solaris
@cindex troubleshooting, FreeBSD
Solaris and FreeBSD are known to have troublesome @code{make} programs.

GNU @code{make} Version 3.75 is known to work.

@tindex CC environment variable
@tindex environment variable, CC
@tindex CXX environment variable
@tindex environment variable, CXX
@tindex CFLAGS environment variable
@tindex environment variable, CFLAGS
@tindex CXXFLAGS environment variable
@tindex environment variable, CXXFLAGS
@item
If you want to define flags to be used by your C or C++ compilers, do so by
adding the flags to the @code{CFLAGS} and @code{CXXFLAGS} environment
variables.  You can also specify the compiler names this way using @code{CC}
and @code{CXX}.  For example:

@example
shell> CC=gcc
shell> CFLAGS=-O3
shell> CXX=gcc
shell> CXXFLAGS=-O3
shell> export CC CFLAGS CXX CXXFLAGS
@end example

See @ref{MySQL binaries}, for a list of flag definitions that have been found
to be useful on various systems.

@item
If you get an error message like this,
you need to upgrade your @code{gcc} compiler:

@example
client/libmysql.c:273: parse error before `__attribute__'
@end example

@code{gcc} 2.8.1 is known to work, but we recommend using @code{gcc} 2.95.2 or
@code{egcs} 1.0.3a instead.

@item
If you get errors such as those shown here when compiling @code{mysqld},
@code{configure} didn't correctly detect the type of the last argument to
@code{accept()}, @code{getsockname()}, or @code{getpeername()}:

@example
cxx: Error: mysqld.cc, line 645: In this statement, the referenced
     type of the pointer value ''length'' is ''unsigned long'',
     which is not compatible with ''int''.
new_sock = accept(sock, (struct sockaddr *)&cAddr, &length);
@end example

To fix this, edit the @file{config.h} file (which is generated by
@code{configure}).  Look for these lines:

@example
/* Define as the base type of the last arg to accept */
#define SOCKET_SIZE_TYPE XXX
@end example

Change @code{XXX} to @code{size_t} or @code{int}, depending on your
operating system.  (Note that you will have to do this each time you run
@code{configure} because @code{configure} regenerates @file{config.h}.)

@item
The @file{sql_yacc.cc} file is generated from @file{sql_yacc.yy}.  Normally
the build process doesn't need to create @file{sql_yacc.cc}, because
MySQL comes with an already generated copy.  However, if you do need
to re-create it, you might encounter this error:

@example
"sql_yacc.yy", line xxx fatal: default action causes potential...
@end example

This is a sign that your version of @code{yacc} is deficient.
You probably need to install @code{bison} (the GNU version of @code{yacc})
and use that instead.

@item
On Debian Linux 3.0, you need to install @code{gawk} instead of the default
@code{mawk}, if you want to compile MySQL 4.1 or higher with Berkeley DB
support.

@item
If you need to debug @code{mysqld} or a MySQL client, run
@code{configure} with the @code{--with-debug} option, then recompile and
link your clients with the new client library.  @xref{Debugging client}.

@item
If you get a compilation error on Linux (e.g. SuSE Linux 8.1 or Red Hat
Linux 7.3) similar to the following one:

@example
libmysql.c:1329: warning: passing arg 5 of `gethostbyname_r' from
incompatible pointer type
libmysql.c:1329: too few arguments to function `gethostbyname_r'
libmysql.c:1329: warning: assignment makes pointer from integer
without a cast
make[2]: *** [libmysql.lo] Error 1
@end example

By default, the @code{configure} script attempts to determine the correct
number of arguments by using @code{g++} the GNU C++ compiler. This test
yields wrong results, if @code{g++} is not installed. There are two ways
to work around this problem:

@itemize @bullet
@item
Make sure that the GNU C++ @code{g++} is installed. On some Linux
distributions, the required package is called @code{gpp}, on others it
is named @code{gcc-c++}.
@item
Use @code{gcc} as your C++ compiler by setting the @code{CXX} environment
variable to @code{gcc}:
@example
export CXX="gcc"
@end example
@end itemize

Please note that you need to run @code{configure} again afterwards.

@end itemize


@node MIT-pthreads, Windows source build, Compilation problems, Installing source
@subsection MIT-pthreads Notes

@cindex MIT-pthreads
@cindex thread support, non-native

This section describes some of the issues involved in using MIT-pthreads.

Note that on Linux you should @strong{not} use MIT-pthreads but use the
installed LinuxThreads implementation instead.
@xref{Linux}.

If your system does not provide native thread support, you will need to
build MySQL using the MIT-pthreads package.  This includes
older FreeBSD systems, SunOS 4.x, Solaris 2.4 and earlier, and some others.
@xref{Which OS}.

Note that, beginning with MySQL 4.0.2, MIT-pthreads are no longer part of
the source distribution. If you require this package, you need to download
it separately from
@url{http://www.mysql.com/Downloads/Contrib/pthreads-1_60_beta6-mysql.tar.gz}

After downloading, extract this source archive into the top level of the
MySQL source directory. It will create a new subdirectory
@code{mit-pthreads}.

@itemize @bullet
@item
On most systems, you can force MIT-pthreads to be used by running
@code{configure} with the @code{--with-mit-threads} option:

@example
shell> ./configure --with-mit-threads
@end example

Building in a non-source directory is not supported when using
MIT-pthreads because we want to minimise our changes to this code.

@item
The checks that determine whether to use MIT-pthreads occur only
during the part of the configuration process that deals with the server
code.  If you have configured the distribution using @code{--without-server}
to build only the client code, clients will not know whether
MIT-pthreads is being used and will use Unix socket connections by default.
Because Unix socket files do not work under MIT-pthreads on some platforms, this
means you will need to use @code{-h} or @code{--host} when you run client
programs.

@item
When MySQL is compiled using MIT-pthreads, system locking is
disabled by default for performance reasons.  You can tell the server to use
system locking with the @code{--external-locking} option.  This is only
needed if you want to be able to run two MySQL servers against the same
datafiles (not recommended).

@item
Sometimes the pthread @code{bind()} command fails to bind to a socket without
any error message (at least on Solaris).  The result is that all connections
to the server fail.  For example:

@example
shell> mysqladmin version
mysqladmin: connect to server at '' failed;
error: 'Can't connect to mysql server on localhost (146)'
@end example

The solution to this is to kill the @code{mysqld} server and restart it.
This has only happened to us when we have forced down the server and done
a restart immediately.

@item
With MIT-pthreads, the @code{sleep()} system call isn't interruptible with
@code{SIGINT} (break).  This is only noticeable when you run
@code{mysqladmin --sleep}.  You must wait for the @code{sleep()} call to
terminate before the interrupt is served and the process stops.

@item
When linking, you may receive warning messages like these (at least on
Solaris); they can be ignored:

@example
ld: warning: symbol `_iob' has differing sizes:
    (file /my/local/pthreads/lib/libpthread.a(findfp.o) value=0x4;
file /usr/lib/libc.so value=0x140);
    /my/local/pthreads/lib/libpthread.a(findfp.o) definition taken
ld: warning: symbol `__iob' has differing sizes:
    (file /my/local/pthreads/lib/libpthread.a(findfp.o) value=0x4;
file /usr/lib/libc.so value=0x140);
    /my/local/pthreads/lib/libpthread.a(findfp.o) definition taken
@end example

@item
Some other warnings also can be ignored:

@example
implicit declaration of function `int strtoll(...)'
implicit declaration of function `int strtoul(...)'
@end example

@item
We haven't gotten @code{readline} to work with MIT-pthreads.  (This isn't
needed, but may be interesting for someone.)
@end itemize


@node Windows source build, Windows client compiling, MIT-pthreads, Installing source
@subsection Installing MySQL from Source on Windows

These instructions describe how to build MySQL binaries from source
for versions 4.1 and above on Windows. Instructions are provided
for building binaries from a standard source distribution or from
the BitKeeper tree that contains the latest development source.

@strong{Note:}
The instructions in this document are strictly for users who want
to test MySQL on Windows from the latest source distribution or
from the BitKeeper tree.  For production use, MySQL AB does not
advise using a MySQL server built by yourself from source.  Normally,
it is best to use precompiled binary distributions of MySQL that
are built specifically for optimal performance on Windows by MySQL
AB.  Instructions for installing a binary distributions are available
at @ref{Windows installation}.

To build MySQL on Windows from source, you need the following
compiler and resources available on your Windows system:

@itemize @bullet
@item
VC++ 6.0 compiler (updated with 4 or 5 SP and pre-processor package).
The pre-processor package is necessary for the macro assembler.
More details at:
@uref{http://msdn.microsoft.com/vstudio/downloads/updates/sp/vs6/sp5/faq.aspx}.

@item
Approximately 45 MB disk space.

@item
64 MB RAM.

@end itemize

You'll also need a MySQL source distribution for Windows.  There
are two ways you can get a source distribution for MySQL version
4.1 and above:

@enumerate
@item
Obtain a source distribution packaged by MySQL AB for the particular
version of MySQL in which you are interested.  Prepackaged source
distributions are available for released versions of MySQL and can
be obtained from @uref{http://www.mysql.com/downloads/}.

@item
You can package a source distribution yourself from the latest
BitKeeper developer source tree. If you plan to do this, you must
create the package on a Unix system and then transfer it to your
Windows system.  (The reason for this is that some of the configuration
and build steps require tools that work only on Unix.)  The BitKeeper
approach thus requires:

@itemize @bullet
@item
A system running Unix, or a Unix-like system such as Linux.

@item
BitKeeper 3.0 installed on that system. You can obtain
BitKeeper from @uref{http://www.bitkeeper.com/}.

@end itemize

@end enumerate

If you are using a Windows source distribution, you can go directly to
@ref{Windows VC++ Build}. To build from the BitKeeper tree, proceed to
@ref{Windows BitKeeper Build}.

If you find something not working as expected, or you have
suggestions about ways to improve the current build process
on Windows, please send a message to the @code{win32} mailing list.
@xref{Mailing-list}.

@menu
* Windows VC++ Build::          Building MySQL Using VC++
* Windows BitKeeper Build::     Creating a Windows Source Package from the Latest Development Source
@end menu


@node Windows VC++ Build, Windows BitKeeper Build, Windows source build, Windows source build
@subsubsection Building MySQL Using VC++

@strong{Note:}
MySQL 4.1 and above VC++ workspace files are compatible with
Microsoft Visual Studio 6.0 and above(7.0/.NET) editions and tested
by MySQL AB staff before each release.

Follow this procedure to build MySQL:

@enumerate
@item
Create a work directory (for example, @file{workdir}).
@item
Unpack the source distribution in the aforementioned directory using
@code{WinZip} or other Windows tools that can read @file{.zip} files.
@item
Start the VC++ 6.0 compiler.
@item
In the @code{File} menu, select @code{Open Workspace}.
@item
Open the @file{mysql.dsw} workspace you find in the work directory.
@item
From the @code{Build} menu,
select the @code{Set Active Configuration} menu.
@item
Click over the screen selecting @code{mysqld - Win32 Debug}
and click OK.
@item
Press @code{F7} to begin the build of the debug server, libraries, and
some client applications.
@c @item
@c When the compilation finishes, copy the libraries and the executables
@c to a separate directory.
@item
Compile the release versions that you want, in the same way.
@item
Debug versions of the programs and libraries are placed in the
@file{client_debug} and @file{lib_debug} directories.
Release versions of the programs and libraries are placed in the
@file{client_release} and @file{lib_release} directories.
Note that if you want to build both debug and release versions,
you can select the ``build all'' option from the @code{Build} menu.
@item
Test the server.  The server built using the preceding instructions
will expect that the MySQL base directory and data directory are
@file{C:\mysql} and @file{C:\mysql\data} by default. If you want
to test your server using the source tree root directory and its
data directory as the base directory and data directory, you will
need to tell the server their pathnames. You can either do this on
the command line with the @code{--basedir} and @code{--datadir}
options, or place appropriate options in an option file (@file{C:\my.cnf}
or the @file{my.ini} file in your Windows directory). If you have
an existing data directory elsewhere that you want to use, you can
specify its pathname instead.
@item
Start your server from the @file{client_release} or @file{client_debug}
directory, depending on which server you want to use. The
general server startup instructions are at @ref{Windows installation}.
You'll need to to adapt the instructions appropriately if you
want to use a different base directory or data directory.
@item
When the server is running in standalone fashion or as a service
based on your configuration, try to connect to it from the @code{mysql}
interactive command line utility that exists in your @file{client_release}
or @file{client_debug} directory.

@end enumerate

When you are satisifed that the programs you have built are working
correctly, stop the server. Then install MySQL as follows:

@enumerate
@item
Create the directories where you want to install MySQL.  For example,
to install into
@file{C:\mysql}, use these commands:

@example
C:
mkdir \mysql
mkdir \mysql\bin
mkdir \mysql\data
mkdir \mysql\share
mkdir \mysql\scripts
@end example

If you want to compile other clients and link them to MySQL, you should
also create several additional directories:

@example
mkdir \mysql\include
mkdir \mysql\lib
mkdir \mysql\lib\debug
mkdir \mysql\lib\opt
@end example

If you want to benchmark MySQL, create this directory:

@example
mkdir \mysql\sql-bench
@end example

Benchmarking requires Perl support.

@item
From the @file{workdir} directory, copy into the @code{C:\mysql} directory the
following directories:

@example
copy client_release\*.exe C:\mysql\bin
copy client_debug\mysqld.exe C:\mysql\bin\mysqld-debug.exe
xcopy scripts\*.* C:\mysql\scripts /E
xcopy share\*.* C:\mysql\share /E
@end example

If you want to compile other clients and link them to MySQL, you should
also copy several libraries and header files:

@example
copy lib_debug\mysqlclient.lib C:\mysql\lib\debug
copy lib_debug\libmysql.* C:\mysql\lib\debug
copy lib_debug\zlib.* C:\mysql\lib\debug
copy lib_release\mysqlclient.lib C:\mysql\lib\opt
copy lib_release\libmysql.* C:\mysql\lib\opt
copy lib_release\zlib.* C:\mysql\lib\opt
copy include\*.h C:\mysql\include
copy libmysql\libmysql.def C:\mysql\include
@end example

If you want to benchmark MySQL, you should also do this:

@example
xcopy sql-bench\*.* C:\mysql\bench /E
@end example

@end enumerate

Set up and start the server in the same way as for the binary
Windows distribution.
@xref{Windows installation}.


@node Windows BitKeeper Build,  , Windows VC++ Build, Windows source build
@subsubsection Creating a Windows Source Package from the Latest Development Source


To create a Windows source package from the current
BitKeeper source tree, use the following instructions. Please
note that this procedure must be performed on a system
running a Unix or Unix-like operating system.  (The procedure
is known to work well on Linux, for example.)

@enumerate
@item
Clone the BitKeeper source tree for MySQL (version 4.1 or above,
as desired).  For more information how to clone the source tree,
see the instructions at @ref{Installing source tree}.

@item
Configure and build the distribution so that you have a server
binary to work with.  One way to do this is to run the following
command in the top-level directory of your source tree:

@example
shell> ./BUILD/compile-pentium-max
@end example

@item
After making sure that the build process completed successfully,
run the following utility script from top-level directory of your
source tree:

@example
shell> ./scripts/make_win_src_distribution
@end example

This script creates a Windows source package, to be used on your
Windows system.  You can supply different options to the script
based on your needs. It accepts the following options:

@example
--debug   Print information about script operations, do not create package
--tmp     Specify the temporary location
--suffix  Suffix name for the package
--dirname Directory name to copy files (intermediate)
--silent  Do not print verbose list of files processed
--tar     Create tar.gz package instead of .zip package
--help    Show this help message
@end example

By default, @code{make_win_src_distribution} creates a zipped
archive with the name @file{mysql-VERSION-win-src.zip}, where
@code{VERSION} represents the version of your MySQL source tree.
 
@item
Copy or upload to your Windows machine the Windows source package
that you have just created. To compile it, use the instructions in
@ref{Windows VC++ Build}.

@end enumerate


@node Windows client compiling,  , Windows source build, Installing source
@subsection Compiling MySQL Clients on Windows

@cindex compiling, on Windows
@cindex Windows, compiling on

In your source files, you should include @file{my_global.h} before
@file{mysql.h}:

@example
#include <my_global.h>
#include <mysql.h>
@end example

@file{my_global.h} includes any other files needed for Windows compatibility
(such as @file{windows.h}) if you compile your program on Windows.

You can either link your code with the dynamic @file{libmysql.lib} library,
which is just a wrapper to load in @file{libmysql.dll} on demand, or link
with the static @file{mysqlclient.lib} library.

Note that because the MySQL client libraries are compiled as threaded
libraries, you should also compile your code to be multi-threaded!


@node Post-installation, Upgrade, Installing source, Installing
@section Post-installation Setup and Testing

@cindex post-installation, setup and testing
@cindex testing, post-installation
@cindex setup, post-installation

There are some issues you should address after installing MySQL.
For example, on Unix, you should create the MySQL grant tables.
On all platforms, an important security concern is that the initial 
accounts in the grant tables have no passwords.
You should assign passwords to prevent unauthorized access to the
MySQL server.

The following sections describe post-installation procedures for Windows
systems and for Unix systems.

@menu
* Windows post-installation::   Windows Post-installation Procedures
* Unix post-installation::      Unix Post-installation Procedures
@end menu

@node Windows post-installation, Unix post-installation, Post-installation, Post-installation
@subsection Windows Post-installation Procedures

On Windows, the grant tables do not have to be created. MySQL Windows
distributions include the grant tables already set up in the
@code{mysql} database under the @file{data} directory.  However, you
should assign passwords to the accounts.

The default privileges on Windows give all local users full privileges
to all databases without specifying a password.  To make MySQL
more secure, you should set a password for all users and remove the row in
the @code{mysql.user} table that has @code{Host='localhost'} and
@code{User=''}.

You should also add a password for the @code{root} user. The following
example starts by removing the anonymous user that has all privileges,
then sets a @code{root} user password:

@example
C:\> C:\mysql\bin\mysql mysql
mysql> DELETE FROM user WHERE Host='localhost' AND User='';
mysql> FLUSH PRIVILEGES;
mysql> QUIT
C:\> C:\mysql\bin\mysqladmin -u root password your_password
@end example

After you've set the password, if you want to shut down the @code{mysqld}
server, you can do so using this command:

@example
C:\> mysqladmin --user=root --password=your_password shutdown
@end example

If you are using a server from a @emph{very} old version of MySQL,
the @code{mysqladmin} command to set the
password will fail with an error:  @code{parse error near 'SET
password'}.  The solution to this problem is to upgrade to a newer
version of MySQL.

With the current MySQL versions you can easily add new users
and change privileges with @code{GRANT} and @code{REVOKE} commands.
@xref{GRANT, , @code{GRANT}}.


@node Unix post-installation,  , Windows post-installation, Post-installation
@subsection Unix Post-installation Procedures

@menu
* mysql_install_db::            Problems Running @code{mysql_install_db}
* Automatic start::             Starting and Stopping MySQL Automatically
* Starting server::             Starting and Troubleshooting the MySQL Server
@end menu

After you install MySQL on Unix,
you need to initialize the grant tables, start the server,
and make sure that the server works okay.  You may also wish to arrange
for the server to be started and stopped automatically when your system
starts and stops.

Normally you install the grant tables and start the server like this
for installation from a source distribution:
@cindex starting, the server
@cindex server, starting

@example
shell> cd mysql_installation_directory
shell> bin/mysql_install_db
shell> bin/mysqld_safe --user=mysql &
@end example

For a binary distribution (not RPM or PKG packages), do this:

@example
shell> cd mysql_installation_directory
shell> scripts/mysql_install_db
shell> bin/mysqld_safe --user=mysql &
@end example

The @code{mysql_install_db} script creates the @code{mysql} database
that holds all database privileges, and the @code{test} database that
you can use to test MySQL. The script also creates privilege table entries
for @code{root} accounts and anonymous-user accounts.
The entries are created without passwords.  The @code{mysqld_safe} script
starts the @code{mysqld} server.  (For versions of MySQL older than 4.0,
use @code{safe_mysqld} rather than @code{mysqld_safe}.)

@code{mysql_install_db} will not overwrite any old privilege tables, so
it should be safe to run in any circumstances.  If you don't want to
have the @code{test} database you can remove it with @code{mysqladmin -u
root drop test} after starting the server.

Testing is most easily done from the top-level directory of the MySQL
distribution.  For a binary distribution, this is your installation directory
(typically something like @file{/usr/local/mysql}).  For a source
distribution, this is the main directory of your MySQL source tree.
@cindex testing, the server

In the commands shown in this section and in the following
subsections, @code{BINDIR} is the path to the location in which programs
like @code{mysqladmin} and @code{mysqld_safe} are installed.  For a
binary distribution, this is the @file{bin} directory within the
distribution.  For a source distribution, @code{BINDIR} is probably
@file{/usr/local/bin}, unless you specified an installation directory
other than @file{/usr/local} when you ran @code{configure}.
@code{EXECDIR} is the location in which the @code{mysqld} server is
installed.  For a binary distribution, this is the same as
@code{BINDIR}.  For a source distribution, @code{EXECDIR} is probably
@file{/usr/local/libexec}.

Testing is described in detail:
@cindex testing, installation

@enumerate
@item
If necessary, start the @code{mysqld} server and set up the initial
MySQL grant tables containing the privileges that determine how
users are allowed to connect to the server.  This is normally done with the
@code{mysql_install_db} script:

@example
shell> scripts/mysql_install_db
@end example

Typically, @code{mysql_install_db} needs to be run only the first time you
install MySQL.  Therefore, if you are upgrading an existing
installation, you can skip this step.  (However, @code{mysql_install_db} is
quite safe to use and will not update any tables that already exist, so if
you are unsure of what to do, you can always run @code{mysql_install_db}.)

@code{mysql_install_db} creates six tables (@code{user}, @code{db},
@code{host}, @code{tables_priv}, @code{columns_priv}, and @code{func}) in the
@code{mysql} database.  A description of the initial privileges is given in
@ref{Default privileges}.  Briefly, these privileges allow the MySQL
@code{root} user to do anything, and allow anybody to create or use databases
with a name of @code{test} or starting with @code{test_}.

If you don't set up the grant tables, the following error will appear in the
log file when you start the server:

@tindex host.frm, problems finding
@example
mysqld: Can't find file: 'host.frm'
@end example

This may also happen with a binary MySQL distribution if you
don't start MySQL by executing exactly @code{./bin/mysqld_safe}.
@xref{mysqld_safe, , @code{mysqld_safe}}.

You might need to run @code{mysql_install_db} as @code{root}.  However,
if you prefer, you can run the MySQL server as an unprivileged
(non-@code{root}) user, provided that the user can read and write files in
the database directory.  Instructions for running MySQL as an
unprivileged user are given in @ref{Changing MySQL user, , Changing
MySQL user}.

If you have problems with @code{mysql_install_db}, see
@ref{mysql_install_db, , @code{mysql_install_db}}.

There are some alternatives to running the @code{mysql_install_db}
script as it is provided in the MySQL distribution:

@itemize @bullet
@item
You may want to edit @code{mysql_install_db} before running it, to change
the initial privileges that are installed into the grant tables.  This is
useful if you want to install MySQL on a lot of machines with the
same privileges.  In this case you probably should need only to add a few
extra @code{INSERT} statements to the @code{mysql.user} and @code{mysql.db}
tables.

@item
If you want to change the contents of the grant tables after installing them,
you can run @code{mysql_install_db}, then use @code{mysql -u root mysql} to
connect to the grant tables as the MySQL @code{root} user and issue
SQL statements to modify the grant tables directly.

@item
It is possible to re-create the grant tables completely after they have
already been created.  You might want to do this if you've already installed
the tables but then want to re-create them after editing
@code{mysql_install_db}.
@end itemize

For more information about these alternatives, see @ref{Default privileges}.

@item
Start the MySQL server like this:

@example
shell> cd mysql_installation_directory
shell> bin/mysqld_safe &
@end example

For versions of MySQL older than 4.0, substitute @code{bin/safe_mysqld}
for @code{bin/mysqld_safe} in the final command.

If you have problems starting the server, see @ref{Starting server}.

@item
Use @code{mysqladmin} to verify that the server is running.  The following
commands provide a simple test to check that the server is up and responding
to connections:

@example
shell> BINDIR/mysqladmin version
shell> BINDIR/mysqladmin variables
@end example

The output from @code{mysqladmin version} varies slightly depending on your
platform and version of MySQL, but should be similar to that shown here:

@example
shell> BINDIR/mysqladmin version
mysqladmin  Ver 8.40 Distrib 4.0.18, for linux on i586
Copyright (C) 2000 MySQL AB & MySQL Finland AB & TCX DataKonsult AB
This software comes with ABSOLUTELY NO WARRANTY. This is free software,
and you are welcome to modify and redistribute it under the GPL license


Server version          4.0.18-log
Protocol version        10
Connection              Localhost via Unix socket
TCP port                3306
UNIX socket             /tmp/mysql.sock
Uptime:                 16 sec

Threads: 1  Questions: 9  Slow queries: 0
Opens: 7  Flush tables: 2  Open tables: 0
Queries per second avg: 0.000
Memory in use: 132K  Max memory used: 16773K
@end example

To see what else you can do with @code{mysqladmin},
invoke it with the @code{--help} option.

@item
Verify that you can shut down the server:
@cindex server, shutdown
@cindex shutting down, the server

@example
shell> BINDIR/mysqladmin -u root shutdown
@end example

@item
Verify that you can restart the server.  Do this using @code{mysqld_safe} or
by invoking @code{mysqld} directly.  For example:

@cindex server, restart
@cindex restarting, the server

@example
shell> BINDIR/mysqld_safe --log &
@end example

If @code{mysqld_safe} fails, try running it from the MySQL
installation directory (if you are not already there).  If that doesn't work,
see @ref{Starting server}.

@item
Run some simple tests to verify that the server is working.
The output should be similar to what is shown here:

@example
shell> BINDIR/mysqlshow
+-----------+
| Databases |
+-----------+
| mysql     |
+-----------+

shell> BINDIR/mysqlshow mysql
Database: mysql
+--------------+
|    Tables    |
+--------------+
| columns_priv |
| db           |
| func         |
| host         |
| tables_priv  |
| user         |
+--------------+

shell> BINDIR/mysql -e "SELECT host,db,user FROM db" mysql
+------+--------+------+
| host | db     | user |
+------+--------+------+
| %    | test   |      |
| %    | test_% |      |
+------+--------+------+
@end example

There is also a benchmark suite in the @file{sql-bench} directory (under the
MySQL installation directory) that you can use to compare how
MySQL performs on different platforms. The benchmark suite is written in
Perl. It uses the Perl DBI module to provide a database-independent interface
to the various databases. The following additional Perl modules are required
to run the benchmark suite:

@example
DBI
DBD::mysql
Data::Dumper
Data::ShowTable
@end example

These modules can be obtained from CPAN @uref{http://www.cpan.org/}.
@xref{Perl installation}.

The @file{sql-bench/Results} directory contains the results from many runs
against different databases and platforms.  To run all tests, execute these
commands:

@example
shell> cd sql-bench
shell> run-all-tests
@end example

If you don't have the @file{sql-bench} directory, you probably installed MySQL
using RPM files other than the source RPM.  (The source RPM includes the
@file{sql-bench} benchmark directory.)  In this case, you must first install
the benchmark suite before you can use it.  Beginning with MySQL Version 3.22,
there are separate benchmark RPM files named
@file{mysql-bench-VERSION-i386.rpm} that contain benchmark code and data.

If you have a source distribution, there are also tests in its @file{tests}
subdirectory that you can run. For example, to run @file{auto_increment.tst},
do this:

@example
shell> BINDIR/mysql -vvf test < ./tests/auto_increment.tst
@end example

The expected result of the test can be found in the
@file{./tests/auto_increment.res} file.
@end enumerate


@node mysql_install_db, Automatic start, Unix post-installation, Unix post-installation
@subsubsection Problems Running @code{mysql_install_db}
@cindex @code{mysql_install_db} script
@cindex scripts, @code{mysql_install_db}

The purpose of the @code{mysql_install_db} script is to generate new MySQL
privilege tables.  It will not overwrite existing MySQL privilege tables,
and it will not affect any other data.

If you want to re-create your privilege tables, you should take down
the @code{mysqld} server, if it's running, and then do something like:

@example
mv mysql-data-directory/mysql mysql-data-directory/mysql-old
mysql_install_db
@end example

This section lists problems you might encounter when you run
@code{mysql_install_db}:

@table @strong
@item @code{mysql_install_db} doesn't install the grant tables

You may find that @code{mysql_install_db} fails to install the grant
tables and terminates after displaying the following messages:

@example
Starting mysqld daemon with databases from XXXXXX
mysqld ended
@end example

In this case, you should examine the log file very carefully.  The log
should be located in the directory @file{XXXXXX} named by the error message,
and should indicate why @code{mysqld} didn't start.  If you don't understand
what happened, include the log when you post a bug report.
@xref{Bug reports}.

@item There is already a @code{mysqld} process running

In this case, you probably don't have to run @code{mysql_install_db} at
all.  You have to run @code{mysql_install_db} only once, when you install
MySQL the first time.

@item Installing a second @code{mysqld} server doesn't work when one server is running

This can happen when you already have an existing MySQL
installation, but want to put a new installation in a different location (for
example, for testing, or perhaps you simply want to run two installations at
the same time).  Generally the problem that occurs when you try to run the
second server is that it tries to use the same socket and port as the old one.
In this case you will get the error message: @code{Can't start server: Bind on
TCP/IP port: Address already in use} or @code{Can't start server: Bind on
unix socket...}. @xref{Multiple servers}.

@item You don't have write access to @file{/tmp}
@cindex write access, tmp
@cindex temporary file, write access
@cindex files, @code{tmp}

If you don't have write access to create a socket file at the default place
(in @file{/tmp}) or permission to create temporary files in @file{/tmp,}
you will get an error when running @code{mysql_install_db} or when
starting or using @code{mysqld}.

You can specify a different socket and temporary directory as follows:

@tindex TMPDIR environment variable
@tindex MYSQL_UNIX_PORT environment variable
@tindex Environment variable, TMPDIR
@tindex Environment variable, MYSQL_UNIX_PORT
@example
shell> TMPDIR=/some_tmp_dir/
shell> MYSQL_UNIX_PORT=/some_tmp_dir/mysqld.sock
shell> export TMPDIR MYSQL_UNIX_PORT
@end example

See @ref{Problems with mysql.sock,  , Problems with @file{mysql.sock}}.

@file{some_tmp_dir} should be the path to some directory for which you
have write permission. @xref{Environment variables}.

After this, you should be able to run @code{mysql_install_db} and start
the server with these commands:

@example
shell> scripts/mysql_install_db
shell> BINDIR/mysqld_safe &
@end example

@item @code{mysqld} crashes immediately

If you are running Red Hat Version 5.0 with a version of @code{glibc} older than
2.0.7-5, you should make sure you have installed all @code{glibc} patches.
There is a lot of information about this in the MySQL mail
archives.  Links to the mail archives are available online at
@uref{http://lists.mysql.com/}.
Also, see @ref{Linux}.

You can also start @code{mysqld} manually using the @code{--skip-grant-tables}
option and add the privilege information yourself using @code{mysql}:

@example
shell> BINDIR/mysqld_safe --skip-grant-tables &
shell> BINDIR/mysql -u root mysql
@end example

From @code{mysql}, manually execute the SQL commands in
@code{mysql_install_db}.  Make sure you run @code{mysqladmin
flush-privileges} or @code{mysqladmin reload} afterward to tell the server to
reload the grant tables.
@end table


@node Automatic start, Starting server, mysql_install_db, Unix post-installation
@subsubsection Starting and Stopping MySQL Automatically

@cindex starting, the server automatically
@cindex stopping, the server
@cindex server, starting and stopping

Generally, you start the @code{mysqld} server in one of these ways:

@itemize @bullet

@item
By invoking @code{mysqld} directly. This works on any platform.

@item
By running the MySQL server as a Windows service.
This can be done on Windows NT, 2000, and XP.
For instructions, see @ref{NT start}.

@item
By invoking @code{mysql.server}.  This script is used primarily at
system startup and shutdown on systems that use System V-style run
directories. It is described more fully later in this section.

@item
By invoking @code{mysqld_safe}, which tries to determine the proper options
for @code{mysqld} and then runs it with those options.  This script is
used on systems based on BSD Unix. It also is invoked by @code{mysql.server}.
@xref{mysqld_safe, , @code{mysqld_safe}}.
@end itemize

The @code{mysql.server} and @code{mysqld_safe} scripts can be used to start
the server automatically at system startup time. @code{mysql.server} can also
be used to stop the server.

The @code{mysql.server} script can be used to start or stop the server
by invoking it with @code{start} or @code{stop} arguments:

@example
shell> mysql.server start
shell> mysql.server stop
@end example

@code{mysql.server} can be found in the @file{share/mysql} directory
under the MySQL installation directory or in the @file{support-files}
directory of the MySQL source tree.

Note that if you use the Linux RPM package
(@code{MySQL-server-VERSION.rpm}), the @code{mysql.server} script has
already been installed as @file{/etc/init.d/mysql}. You don't have to
install it manually. See @ref{Linux-RPM} for more information on the
Linux RPM packages.

On Mac OS X, you can install a separate MySQL Startup Item package to
enable the automatic startup of MySQL on system bootup.
See @ref{Mac OS X installation} for details.

Before @code{mysql.server} starts the server, it changes the directory to
the MySQL installation directory, then invokes @code{mysqld_safe}.
You might need to edit @code{mysql.server} if you have a binary distribution
that you've installed in a non-standard location.  Modify it to @code{cd}
into the proper directory before it runs @code{mysqld_safe}. If you want the
server to run as some specific user, add an appropriate @code{user} line
to the @file{/etc/my.cnf} file, as shown later in this section.

@code{mysql.server stop} brings down the server by sending a signal to it.
You can also stop the server manually by executing
@code{mysqladmin shutdown}.

You need to add these start and stop commands to the appropriate places
in your @file{/etc/rc*} files when you want to start up MySQL automatically
on your server.

On most current Linux distributions, it is sufficient to copy the file
@code{mysql.server} into the @file{/etc/init.d} directory (or
@file{/etc/rc.d/init.d} on older Red Hat systems). Afterwards, run the
following command to enable the startup of MySQL on system bootup:

@example
shell> chkconfig --add mysql.server
@end example

On FreeBSD startup scripts generally should go in
@file{/usr/local/etc/rc.d/}. The @code{rc(8)} manual page also states that
scripts in this directory are only executed, if their basename matches the
shell globbing pattern @code{*.sh}. Any other files or directories present
within the directory are silently ignored. In other words, on FreeBSD you
should install the file @file{mysql.server} as
@file{/usr/local/etc/rc.d/mysql.server.sh} to enable automatic startup.

As an alternative to the above, some operating systems also use
@file{/etc/rc.local} or @file{/etc/init.d/boot.local} to start additional
services on bootup. To start up MySQL using this method, you could append
something like the following to it:

@example
/bin/sh -c 'cd /usr/local/mysql; ./bin/mysqld_safe --user=mysql &'
@end example

@cindex changing socket location
You can also add options for @code{mysql.server} in a global
@file{/etc/my.cnf} file.  A typical @file{/etc/my.cnf} file might look like
this:

@example
[mysqld]
datadir=/usr/local/mysql/var
socket=/var/tmp/mysql.sock
port=3306
user=mysql

[mysql.server]
basedir=/usr/local/mysql
@end example

The @code{mysql.server} script understands the following options:
@code{datadir}, @code{basedir}, and @code{pid-file}.

The following table shows which option groups each startup script
reads from option files:

@multitable @columnfractions .15 .85
@item @strong{Script} @tab @strong{Option groups}
@item @code{mysqld} @tab @code{[mysqld]}, @code{[server]} and @code{[mysqld-major-version]}
@item @code{mysql.server} @tab @code{[mysql.server]}, @code{[mysqld]}, and @code{[server]}
@item @code{mysqld_safe} @tab @code{[mysqld]}, @code{[server]}, and @code{[mysqld_safe]}
@end multitable

For backward compatibility, @code{mysql.server} also reads the
@code{[mysql_server]} group and @code{mysqld_safe} also reads the
@code{[safe_mysqld]} group. However, you should update your option
files to use the @code{[mysql.server]} and @code{[mysqld_safe]} groups instead.

@xref{Option files}.


@node Starting server,  , Automatic start, Unix post-installation
@subsubsection Starting and Troubleshooting the MySQL Server
@cindex server, starting problems
@cindex problems, starting the server

If you are going to use storage engines that support transactional tables
(@code{InnoDB}, @code{BDB}),
you should first create a @file{my.cnf} file and set startup options
for the engines you plan to use. @xref{Table types}.

When the @code{mysqld} server starts, it changes location to the
data directory.  This is where it expects to write log files and the pid
(process ID) file, and where it expects to find databases.

The data directory location is hardwired in when the distribution is
compiled.  However, if @code{mysqld} expects to find the data directory
somewhere other than where it really is on your system, it will not work
properly.  If you have problems with incorrect paths, you can find out
what options @code{mysqld} allows and what the default path settings are by
invoking @code{mysqld} with the @code{--help} option.  You can override the
defaults by specifying the correct pathnames as command-line arguments to
@code{mysqld}.  (These options can be used with @code{mysqld_safe} as well.)

Normally you should need to tell @code{mysqld} only the base directory under
which MySQL is installed.  You can do this with the @code{--basedir}
option.  You can also use @code{--help} to check the effect of changing path
options (note that @code{--help} @strong{must} be the final option of the
@code{mysqld} command).  For example:

@example
shell> EXECDIR/mysqld --basedir=/usr/local --help
@end example

Once you determine the path settings you want, start the server without
the @code{--help} option.

Whichever method you use to start the server, if it fails to start up
correctly, check the log file to see if you can find out why.  Log files
are located in the data directory (typically
@file{/usr/local/mysql/data} for a binary distribution,
@file{/usr/local/var} for a source distribution, and
@file{\mysql\data\mysql.err} on Windows).  Look in the data directory for
files with names of the form @file{host_name.err} and
@file{host_name.log} where @code{host_name} is the name of your server
host.  Then check the last few lines of these files:

@example
shell> tail host_name.err
shell> tail host_name.log
@end example

Look for something like the following in the log file:
@example
000729 14:50:10  bdb:  Recovery function for LSN 1 27595 failed
000729 14:50:10  bdb:  warning: ./test/t1.db: No such file or directory
000729 14:50:10  Can't init databases
@end example

This means that you didn't start @code{mysqld} with @code{--bdb-no-recover}
and Berkeley DB found something wrong with its log files when it
tried to recover your databases.  To be able to continue, you should
move away the old Berkeley DB log file from the database directory to
some other place, where you can later examine it.  The log files are
named @file{log.0000000001}, where the number will increase over time.

If you are running @code{mysqld} with @code{BDB} table support and @code{mysqld} core
dumps at start this could be because of some problems with the @code{BDB}
recovery log.  In this case you can try starting @code{mysqld} with
@code{--bdb-no-recover}.  If this helps, then you should remove all
@file{log.*} files from the data directory and try starting @code{mysqld}
again.

If you get the following error, it means that some other program (or another
@code{mysqld} server) is already using the TCP/IP port or socket
@code{mysqld} is trying to use:

@example
Can't start server: Bind on TCP/IP port: Address already in use
@end example
or:
@example
Can't start server: Bind on unix socket...
@end example

Use @code{ps} to make sure that you don't have another @code{mysqld} server
running.  If you can't find another server running, you can try to execute
the command @code{telnet your-host-name tcp-ip-port-number} and press
Enter a couple of times.  If you don't get an error message like
@code{telnet: Unable to connect to remote host: Connection refused},
something is using the TCP/IP port @code{mysqld} is trying to use.
See @ref{mysql_install_db} and @ref{Multiple servers}.

If @code{mysqld} is currently running, you can find out what path settings
it is using by executing this command:

@example
shell> mysqladmin variables
@end example

or:

@example
shell> mysqladmin -h 'your-host-name' variables
@end example

If you get @code{Errcode 13}, which means @code{Permission denied}, when
starting @code{mysqld} this means that you didn't have the right to
read/create files in the MySQL database or log directory. In this case
you should either start @code{mysqld} as the @code{root} user or change the
permissions for the involved files and directories so that you have the
right to use them.

If @code{mysqld_safe} starts the server but you can't connect to it,
you should make sure you have an entry in @file{/etc/hosts} that looks like
this:

@example
127.0.0.1       localhost
@end example

This problem occurs only on systems that don't have a working thread
library and for which MySQL must be configured to use MIT-pthreads.

If you can't get @code{mysqld} to start you can try to make a trace file
to find the problem. @xref{Making trace files}.

If you are using @code{InnoDB} tables, refer to the @code{InnoDB}-specific startup
options.  @xref{InnoDB start}.

If you are using @code{BDB} (Berkeley DB) tables, you should familiarise
yourself with the different @code{BDB}-specific startup options.
@xref{BDB start}.


@node Upgrade, Operating System Specific Notes, Post-installation, Installing
@section Upgrading/Downgrading MySQL

@cindex upgrading
@cindex downgrading

As a general rule, we recommend that when upgrading from one release series to
another, you should go to the next series rather than skipping a series. For
example, if you currently are running MySQL 3.23 and wish to upgrade to a
newer series, upgrade to MySQL 4.0 rather than to 4.1 or 5.0.

Before you do an upgrade, you should back up your old databases.

You can always move the MySQL format files and datafiles between different
versions on the same architecture as long as you have the same base
version of MySQL. The current base version is 4. If you change the
character set when running MySQL,
you must run @code{myisamchk -r -q --set-character-set=charset} on all
tables.  Otherwise, your indexes may not be ordered correctly, because
changing the character set may also change the sort order.

If you are cautious about using new versions, you can always rename your old
@code{mysqld} to something like @code{mysqld-old-version-number}.
If your new @code{mysqld} then does something unexpected, you can simply
shut it down and restart with your old @code{mysqld}.

If, after an upgrade, you experience problems with recompiled client programs,
such as @code{Commands out of sync} or unexpected core dumps, you probably have
used an old header or library file when compiling your programs.  In this
case you should check the date for your @file{mysql.h} file and
@file{libmysqlclient.a} library to verify that they are from the new
MySQL distribution.  If not, please recompile your programs.

If problems occur, such as that the new @code{mysqld} server doesn't want to
start or that you can't connect without a password, check that you don't
have some old @file{my.cnf} file from your old installation.  You can
check this with: @code{program-name --print-defaults}.  If this outputs
anything other than the program name, you have an active @file{my.cnf}
file that affects server operation.

It is a good idea to rebuild and reinstall the Perl @code{DBD::mysql}
module whenever you install a new release of MySQL. The same applies to other
MySQL interfaces as well, such as the Python @code{MySQLdb} module.

@menu
* Upgrading-from-4.1::          Upgrading from Version 4.1 to 5.0
* Upgrading-from-4.0::          Upgrading from Version 4.0 to 4.1
* Upgrading-from-3.23::         Upgrading from Version 3.23 to 4.0
* Upgrading-from-3.22::         Upgrading from Version 3.22 to 3.23
* Upgrading-from-3.21::         Upgrading from Version 3.21 to 3.22
* Upgrading-from-3.20::         Upgrading from Version 3.20 to 3.21
* Windows upgrading::           Upgrading MySQL under Windows
* Upgrading-grant-tables::      Upgrading the Grant Tables
* Upgrading-to-arch::           Copying MySQL Databases to Another Machine
@end menu


@node Upgrading-from-4.1, Upgrading-from-4.0, Upgrade, Upgrade
@subsection Upgrading from Version 4.1 to 5.0

@cindex compatibility, between MySQL versions
@cindex upgrading, to 5.0

In general, you should do the following when upgrading to MySQL 5.0 from an
earlier version:

@itemize @bullet

@item
Read the 5.0 news items to see what significant new features you can use in
5.0.
@xref{News-5.0.x}.

@item
If you are running MySQL Server on Windows, please also see
@ref{Windows upgrading}.

@item
If you are using replication, please also see @ref{Replication Upgrade}
for information on upgrading your replication setup.

@item
MySQL 5.0 adds support for stored procedures. This support requires the
@code{proc} table in the @code{mysql} database.
To create this file you should run the @code{mysql_fix_privilege_tables} script.
This is described in @ref{Upgrading-grant-tables}.

@end itemize


@node Upgrading-from-4.0, Upgrading-from-3.23, Upgrading-from-4.1, Upgrade
@subsection Upgrading from Version 4.0 to 4.1

@cindex compatibility, between MySQL versions
@cindex upgrading, 4.0 to 4.1

Several visible behaviors have changed between MySQL 4.0 and MySQL 4.1 to fix
some critical bugs and make MySQL more compatible with the ANSI SQL
standard. These changes may affect your applications.

Some of the 4.1 behaviors can be tested in 4.0 before performing
a full upgrade to 4.1. We have added to later MySQL 4.0 releases
(from 4.0.12 on) a @code{--new} startup option for @code{mysqld}.

This option gives you the 4.1 behavior for the most critical changes.
You can also enable these behaviors for a given client connection with
the @code{SET @@@@new=1} command, or turn them off if they are on with
@code{SET @@@@new=0}.

@c TODO: preceding para means there is a global/session variable named "new"
@c that should be listed under system variables.

If you believe that some of the 4.1 changes will affect you,
we recommend that before upgrading to 4.1, you download
the latest MySQL 4.0 version and run it with the @code{--new} option by
adding the following to your config file:

@example
[mysqld-4.0]
new
@end example

That way you can test the new behaviors in 4.0 to make sure that your
applications work with them. This will help you have a smooth painless
transition when you perform a full upgrade to 4.1 later.  Doing it the
above way will ensure that you don't accidently later run the 4.1
version with the @code{--new} option.

The following list describes changes that may affect applications and that
you should watch out for when upgrading to version 4.1:

@itemize @bullet

@item
@code{TIMESTAMP} is now returned as a string in @code{'YYYY-MM-DD HH:MM:SS'}
format.  (The @code{--new} option can be used from 4.0.12 on to
make a 4.0 server behave as 4.1 in this respect.)  If you want to have
the value returned as a number (like Version 4.0 does) you should add +0 to
@code{TIMESTAMP} columns when you retrieve them:

@example
mysql> SELECT ts_col + 0 FROM tbl_name;
@end example

Display widths for @code{TIMESTAMP} columns are no longer supported.
For example, if you declare a column as @code{TIMESTAMP(10)}, the @code{(10)}
is ignored.

These changes were necessary for SQL standards compliance. In a future
version, a further change will be made (backward compatible with this
change), allowing the timestamp length to indicate the desired number of
digits for fractions of a second.

@item
Binary values such as @code{0xFFDF} now are assumed to be strings instead of
numbers.  This fixes some problems with character sets where it's
convenient to input a string as a binary value.  With this change,
you should use @code{CAST()} if you want to compare binary values
numerically as integers:

@example
mysql> SELECT CAST(0xFEFF AS UNSIGNED INTEGER) < CAST(0xFF AS UNSIGNED INTEGER);
        -> 0
@end example

If you don't use @code{CAST()}, a lexical string comparison will be done:

@example
mysql> SELECT 0xFEFF < 0xFF;
        -> 1
@end example

Using binary items in a numeric context or comparing them using the
@code{=} operator should work as before.  (The @code{--new} option can
be used from 4.0.13 on to make a 4.0 server behave as 4.1 in this respect.)

@item
For functions that produce a @code{DATE}, @code{DATETIME}, or @code{TIME}
value, the result returned to the client now is fixed up to have a temporal
type. For example, in MySQL 4.1, you get this result:

@example
mysql> SELECT CAST("2001-1-1" as DATETIME);
    -> '2001-01-01 00:00:00'
@end example

In MySQL 4.0, the result is different:

@example
mysql> SELECT CAST("2001-1-1" as DATETIME);
    -> '2001-01-01'
@end example

@item
@code{DEFAULT} values no longer can be specified for @code{AUTO_INCREMENT}
columns. (In 4.0, a @code{DEFAULT} value is silently ignored; in 4.1,
an error occurs).

@item
@code{LIMIT} no longer accept negative arguments.
Use 18446744073709551615 instead of -1.

@item
@code{SERIALIZE} is no longer a valid mode value for the @code{sql_mode}
variable.  You should use @code{SET TRANSACTION ISOLATION LEVEL SERIALIZABLE}
instead. @code{SERIALIZE} is no longer valid for the @code{--sql-mode} option
for @code{mysqld}, either. Use @code{--transaction-isolation=SERIALIZABLE}
instead.

@item
All tables and string columns now have a character set.
@xref{Charset}.
Character set information is displayed by
@code{SHOW CREATE TABLE} and @code{mysqldump}.
(MySQL versions 4.0.6 and above can read the new dump files; older
versions cannot.)

@item
The table definition format used in @file{.frm} files
has changed slightly in 4.1.  MySQL 4.0 versions from 4.0.11 on can
read the new @file{.frm} format directly, but older versions cannot.
If you need to move tables from 4.1 to a version earlier than 4.0.11, you
should use @code{mysqldump}.
@xref{mysqldump, , @code{mysqldump}}.

@item
If you are running multiple servers on the same Windows machine, you should
use a different @code{--shared_memory_base_name} option on all machines.

@item
The interface to aggregated UDF functions has changed a bit. You must now
declare a @code{xxx_clear()} function for each aggregate function @code{XXX()}.

@end itemize

In general, upgrading to 4.1 from an earlier MySQL version involves the
following steps:

@itemize @bullet
@item
Check the changes listed earlier in this section to see whether there are any
that may affect your applications.

@item
Read the 4.1 news items to see what significant new features you can use in 4.1.
@xref{News-4.1.x}.

@item
If you are running MySQL Server on Windows, please also see
@ref{Windows upgrading}.

@strong{Important note:}
Early alpha Windows distributions for MySQL 4.1 do not contain any
installer program.  See @ref{Windows binary installation} for instructions on
how to install such a distribution.

@item
If you are using replication, please also see @ref{Replication Upgrade}
for information on upgrading your replication setup.

@item
After upgrading,
update the grant tables to generate the new longer @code{Password}
column that is needed for secure handling of passwords.  The
procedure uses @code{mysql_fix_privilege_tables} and is described
in @ref{Upgrading-grant-tables}.

@end itemize

The password hashing mechanism has changed in 4.1 to provide better
security, but this may cause compatibility problems if you still have
clients that use the client library from 4.0 or earlier.  (It is very likely that you will
have 4.0 clients in situations where clients connect from remote hosts
that have not yet upgraded to 4.1).  The following list indicates some
possible upgrade strategies.  They represent various tradeoffs between
the goal of compatibility with old clients and the goal of security.

@itemize @bullet

@item
Don't upgrade to 4.1. No behavior will change, but you cannot
use any of the new features provided by the 4.1 client/server protocol,
either.  (MySQL 4.1 has an extended client/server protocol that offers
such features as prepared statements and multiple result sets.)
@xref{C API Prepared statements}.

@item
Upgrade to 4.1 and run the @code{mysql_fix_privilege_tables} script
to widen the @code{Password} column in the @code{user} table so
that it can hold long password hashes.  But run the server with the
@code{--old-passwords} option to provide backward compatibility that
allows pre-4.1 clients to continue to connect to their short-hash
accounts.
Eventually, when all your clients are upgraded to 4.1, you can stop using the
@code{--old-passwords} server option. You can also change the passwords for
your MySQL accounts to use the new more secure format.

@item
Upgrade to 4.1 and run the @code{mysql_fix_privilege_tables} script to widen the
@code{Password} column in the @code{user} table.  If you know that all clients
also have been upgraded to 4.1, don't run the server with the
@code{--old-passwords} option.  Instead, change the passwords on all existing
accounts so that they have the new format.  A pure-4.1 installation
is the most secure.

@end itemize

Further background on password hashing with respect to client authentication
and password-changing operations may be found in @ref{Password hashing}.


@node Upgrading-from-3.23, Upgrading-from-3.22, Upgrading-from-4.0, Upgrade
@subsection Upgrading from Version 3.23 to 4.0

@cindex compatibility, between MySQL versions
@cindex upgrading, 3.23 to 4.0

In general, you should do the following when upgrading to MySQL 4.0 from an
earlier version:

@itemize @bullet

@item
After upgrading,
update the grant tables to add new privileges and features.  The
procedure uses the @code{mysql_fix_privilege_tables} script and is described
in @ref{Upgrading-grant-tables}.

@item
Edit any MySQL startup scripts or configure files to not use any of the
deprecated options described later in this section.

@item
Convert your old @code{ISAM} files to @code{MyISAM} files with the
@code{mysql_convert_table_format database} script. (This is a Perl script;
it requires that DBI be installed.) To convert the tables in a given database,
use this command:

@example
shell> mysql_convert_table_format database db_name
@end example

Note that this should only be used if all tables in the given database
are @code{ISAM} or @code{MyISAM} tables. To avoid converting tables
of other types to @code{MyISAM}, you can explicitly list the names
of your @code{ISAM} tables after the database name on the command
line.  You can also issue a @code{ALTER TABLE table_name TYPE=MyISAM}
statement for each @code{ISAM} table to convert it to @code{MyISAM}.

To find out the table type for a given table, use this statement:

@example
mysql> SHOW TABLE STATUS LIKE 'tbl_name';
@end example

@item
Ensure that you don't have any MySQL clients that use shared libraries
(like the Perl @code{DBD::mysql} module). If you do, you should recompile
them, because the data structures used in @file{libmysqlclient.so} have changed.
The same applies to other MySQL interfaces as well, such as the Python
@code{MySQLdb} module.

@item
If you are running MySQL Server on Windows, please also see
@ref{Windows upgrading}.

@item
If you are using replication, please also see @ref{Replication Upgrade}
for information on upgrading your replication setup.

@end itemize

MySQL 4.0 will work even if you don't do the above, but you will not be
able to use the new security privileges that MySQL 4.0 and you may run
into problems when upgrading later to MySQL 4.1 or newer.  The @code{ISAM} file
format still works in MySQL 4.0 but it's deprecated and will be disabled
(not compiled in by default) in MySQL 4.1. @code{MyISAM} tables should be
used instead.

Old clients should work with a Version 4.0 server without any problems.

Even if you do the above, you can still downgrade to MySQL 3.23.52
or newer if you run into problems with the MySQL 4.0 series.  In
this case, you must use @code{mysqldump} to dump any tables that
use full-text indexes and reload the dump file into the 3.23 server.
This is necessary because 4.0 uses a new format for full-text
indexing.

The following is a more complete list that tells what you must watch out
for when upgrading to version 4.0:

@itemize @bullet

@item
MySQL 4.0 has a lot of new privileges in the @code{mysql.user} table.
@xref{GRANT, , @code{GRANT}}.

To get these new privileges to work, you must update the grant tables.
The procedure is described in @ref{Upgrading-grant-tables}.
Until you do this, all
users have the @code{SHOW DATABASES}, @code{CREATE TEMPORARY TABLES},
and @code{LOCK TABLES} privileges. @code{SUPER} and @code{EXECUTE}
privileges take their value from @code{PROCESS}.
@code{REPLICATION SLAVE} and @code{REPLICATION CLIENT} take their
values from @code{FILE}.

If you have any scripts that create new users, you may want to change
them to use the new privileges.  If you are not using @code{GRANT}
commands in the scripts, this is a good time to change your scripts to use
@code{GRANT} instead of modifying the grant tables directly..

From version 4.0.2 on, the option @code{--safe-show-database} is deprecated
(and no longer does anything). @xref{Privileges options}.

If you get @code{Access denied} errors for new users in version 4.0.2 and up, you
should check if you need some of the new grants that you didn't need
before.  In particular, you will need @code{REPLICATION SLAVE}
(instead of @code{FILE}) for new slaves.

@item
@file{safe_mysqld} is renamed to @file{mysqld_safe}.  For backward
compatibility, binary distributions will for some time include
@code{safe_mysqld} as a symlink to @code{mysqld_safe}.

@item
InnoDB support is now included by default in binary distributions.
If you build MySQL from source, InnoDB is configured in by default.
If you do not use InnoDB and want to save memory when running a server
that has InnoDB support enabled, use the @code{--skip-innodb} server
startup option. To compile MySQL without InnoDB support, run @code{configure}
with the @code{--without-innodb} option.

@item
The startup parameters @code{myisam_max_extra_sort_file_size} and
@code{myisam_max_extra_sort_file_size} are now given in bytes
(they were given in megabytes before 4.0.3).

@item
External system locking of @code{MyISAM}/@code{ISAM} files is now
turned off by default.  Your can turn this on by doing
@code{--external-locking}. (However, this is never needed for most users.)

@item
The following startup variables/options have been renamed:

@multitable @columnfractions .50 .50
@item @strong{Old Name} @tab @strong{New Name}
@item @code{myisam_bulk_insert_tree_size} @tab @code{bulk_insert_buffer_size}
@item @code{query_cache_startup_type} @tab @code{query_cache_type}
@item @code{record_buffer} @tab @code{read_buffer_size}
@item @code{record_rnd_buffer} @tab @code{read_rnd_buffer_size}
@item @code{sort_buffer} @tab @code{sort_buffer_size}
@item @code{warnings} @tab @code{log-warnings}
@item @code{--err-log} @tab @code{--log-error} (for @code{mysqld_safe})
@end multitable

The startup options @code{record_buffer}, @code{sort_buffer} and
@code{warnings} will still work in MySQL 4.0 but are deprecated.

@item
The following SQL variables have changed name.

@c arjen note: New table, not yet measured for O'Reilly/DocBook.
@multitable @columnfractions .50 .50
@item @strong{Old Name} @tab @strong{New Name}
@item @code{SQL_BIG_TABLES} @tab @code{BIG_TABLES}
@item @code{SQL_LOW_PRIORITY_UPDATES} @tab @code{LOW_PRIORITY_UPDATES}
@item @code{SQL_MAX_JOIN_SIZE} @tab @code{MAX_JOIN_SIZE}
@item @code{SQL_QUERY_CACHE_TYPE} @tab @code{QUERY_CACHE_TYPE}
@end multitable
The old names still work in MySQL 4.0 but are deprecated.

@item
You have to use @code{SET GLOBAL SQL_SLAVE_SKIP_COUNTER=#} instead of
@code{SET SQL_SLAVE_SKIP_COUNTER=#}.

@item
The @code{mysqld} startup options @code{--skip-locking} and
@code{--enable-locking} were renamed to @code{--skip-external-locking}
and @code{--external-locking}.

@item
@code{SHOW MASTER STATUS} now returns an empty set if binary logging is not
enabled.

@item
@code{SHOW SLAVE STATUS} now returns an empty set if slave is not initialized.

@item
@code{mysqld} now has the option @code{--temp-pool} enabled by default as this
gives better performance with some operating systems (most notably Linux).

@item
@code{DOUBLE} and @code{FLOAT} columns now honor the
@code{UNSIGNED} flag on storage (before, @code{UNSIGNED} was ignored for
these columns).

@item
@code{ORDER BY col_name DESC} sorts @code{NULL} values last, as of
MySQL 4.0.11. In 3.23 and in earlier 4.0 versions, this was not
always consistent.

@item
@code{SHOW INDEX} has two more columns (@code{Null} and @code{Index_type})
than it had in 3.23.

@item
@code{CHECK}, @code{LOCALTIME} and @code{LOCALTIMESTAMP}
are now reserved words.

@item
The result of all bitwise operators (@code{|}, @code{&}, @code{<<},
@code{>>}, and @code{~})) is now unsigned.  This may cause problems if you
are using them in a context where you want a signed result.
@xref{Cast Functions}.

@item
@strong{Note:} when you use subtraction between integer values where
one is of type @code{UNSIGNED}, the result will be unsigned.  In other
words, before upgrading to MySQL 4.0, you should check your application
for cases where you are subtracting a value from an unsigned entity and
want a negative answer or subtracting an unsigned value from an
integer column. You can disable this behavior by using the
@code{--sql-mode=NO_UNSIGNED_SUBTRACTION} option when starting
@code{mysqld}.  @xref{Cast Functions}.

@item
To use @code{MATCH ... AGAINST (... IN BOOLEAN MODE)} with your tables,
you need to rebuild them with @code{REPAIR TABLE table_name USE_FRM}.

@item
@code{LOCATE()} and @code{INSTR()} are case-sensitive if one of the
arguments is a binary string. Otherwise they are case-insensitive.

@item
@code{STRCMP()} now uses the current character set when performing comparisons.
This makes the default comparison behavior case insensitive unless
one or both of the operands are binary strings.

@item
@code{HEX(string)} now returns the characters in @code{string} converted to
hexadecimal.  If you want to convert a number to hexadecimal, you should
ensure that you call @code{HEX()} with a numeric argument.

@item
In 3.23, @code{INSERT INTO ... SELECT} always had @code{IGNORE} enabled.
In 4.0.1, MySQL will stop (and possibly roll back) by default in case of
an error unless you specify @code{IGNORE}.

@item
The old C API functions @code{mysql_drop_db()}, @code{mysql_create_db()}, and
@code{mysql_connect()} are no longer supported unless you compile
MySQL with @code{CFLAGS=-DUSE_OLD_FUNCTIONS}.  However, it is preferable
to change client programs to use the new 4.0 API instead.

@item
In the @code{MYSQL_FIELD} structure, @code{length} and @code{max_length} have
changed from @code{unsigned int} to @code{unsigned long}. This should not
cause any problems, except that they may generate warning messages when
used as arguments in the @code{printf()} class of functions.

@item
You should use @code{TRUNCATE TABLE} when you want to delete all rows
from a table and you don't need to obtain a count of the number of rows that
were deleted.  (@code{DELETE FROM table_name} returns a row count in 4.0,
and @code{TRUNCATE TABLE} is faster.)

@item
You will get an error if you have an active @code{LOCK TABLES} or
transaction when trying to execute @code{TRUNCATE TABLE} or @code{DROP
DATABASE}.

@item
You should use integers to store values in @code{BIGINT} columns (instead
of using strings, as you did in MySQL 3.23).  Using strings will still
work, but using integers is more efficient.

@item
The format of @code{SHOW OPEN TABLES} has changed.

@item
Multi-threaded clients should use @code{mysql_thread_init()} and
@code{mysql_thread_end()}. @xref{Threaded clients}.

@item
If you want to recompile the Perl @code{DBD::mysql} module, use a recent
version.  Version 2.9003 is recommended. Versions older than 1.2218 should
not be used because they use the deprecated @code{mysql_drop_db()} call.

@item
@code{RAND(seed)} returns a different random number series in 4.0 than in
3.23; this was done to further differentiate @code{RAND(seed)} and
@code{RAND(seed+1)}.

@item
The default type returned by @code{IFNULL(A,B)} is now set to be the
more 'general' of the types of @code{A} and @code{B}. (The general-to-specific
order is string, @code{REAL} or @code{INTEGER}).

@end itemize


@node Upgrading-from-3.22, Upgrading-from-3.21, Upgrading-from-3.23, Upgrade
@subsection Upgrading from Version 3.22 to 3.23

@cindex compatibility, between MySQL versions
@cindex upgrading, 3.22 to 3.23

MySQL Version 3.23 supports tables of the new @code{MyISAM} type and
the old @code{ISAM} type.  You don't have to convert your old tables to
use these with Version 3.23.  By default, all new tables will be created with
type @code{MyISAM} (unless you start @code{mysqld} with the
@code{--default-table-type=isam} option). You can convert an @code{ISAM}
table to @code{MyISAM} format with @code{ALTER TABLE table_name TYPE=MyISAM}
or the Perl script @code{mysql_convert_table_format}.

Version 3.22 and 3.21 clients will work without any problems with a Version
3.23 server.

The following list tells what you have to watch out for when upgrading to
Version 3.23:

@itemize @bullet
@item
All tables that use the @code{tis620} character set must be fixed
with @code{myisamchk -r} or @code{REPAIR TABLE}.

@item
If you do a @code{DROP DATABASE} on a symbolically linked database, both the
link and the original database are deleted.  (This didn't happen in 3.22
because @code{configure} didn't detect the availability of the
@code{readlink()} system call.)

@item
@code{OPTIMIZE TABLE} now works only for @code{MyISAM} tables.
For other table types, you can use @code{ALTER TABLE} to optimize the table.
During @code{OPTIMIZE TABLE}, the table is now locked to prevent it from being
used by other threads.

@item
The MySQL client @code{mysql} is now by default started with the
option @code{--no-named-commands (-g)}. This option can be disabled with
@code{--enable-named-commands (-G)}. This may cause incompatibility problems in
some cases---for example, in SQL scripts that use named commands without a
semicolon.  Long format commands still work from the first line.

@item
Date functions that work on parts of dates (like @code{MONTH()}) will now
return 0 for @code{0000-00-00} dates. (In MySQL 3.22, these functions returned
@code{NULL}.)

@item
If you are using the @code{german} character sort order for @code{ISAM}
tables, you must repair them with @code{isamchk -r}, because we have made
some changes in the sort order.

@item
The default return type of @code{IF()} now depends on both arguments
and not only the first argument.

@item
@code{AUTO_INCREMENT} columns should not be used to store negative
numbers. The reason for this is that negative numbers caused problems
when wrapping from -1 to 0.  You should not store 0 in @code{AUTO_INCREMENT}
columns, either; @code{CHECK TABLE} will complain about 0 values because
they may change if you dump and restore the table.  @code{AUTO_INCREMENT}
for @code{MyISAM} tables is now handled at a lower level and is much
faster than before. In addition, for @code{MyISAM} tables, old numbers
are no longer reused, even if you delete rows from the table.

@item
@code{CASE}, @code{DELAYED}, @code{ELSE}, @code{END}, @code{FULLTEXT},
@code{INNER}, @code{RIGHT}, @code{THEN}, and @code{WHEN} are now reserved words.

@item
@code{FLOAT(X)} is now a true floating-point type and not a value with a
fixed number of decimals.

@item
When declaring columns using a @code{DECIMAL(length,dec)} type, the
@code{length} argument no longer includes a place for the sign or the
decimal point.

@item
A @code{TIME} string must now be of one of the following formats:
@code{[[[DAYS] [H]H:]MM:]SS[.fraction]} or
@code{[[[[[H]H]H]H]MM]SS[.fraction]}.

@item
@code{LIKE} now compares strings using the same character comparison rules
as for the @code{=} operator.  If you require the old behavior, you can
compile MySQL with the @code{CXXFLAGS=-DLIKE_CMP_TOUPPER} flag.

@item
@code{REGEXP} is now case-insensitive if neither of the strings are binary
strings.

@item
When you check or repair @code{MyISAM} (@file{.MYI}) tables, you should use
the @code{CHECK TABLE} statement or the @code{myisamchk} command. For
@code{ISAM} (@file{.ISM}) tables, use the @code{isamchk} command.

@item
If you want your @code{mysqldump} files to be compatible between
MySQL Version 3.22 and Version 3.23, you should not use the
@code{--opt} or @code{--all} option to @code{mysqldump}.

@item
Check all your calls to @code{DATE_FORMAT()} to make sure there is a
@samp{%} before each format character.
(MySQL Version 3.22 and later already allowed this syntax.)

@item
@code{mysql_fetch_fields_direct()} is now a function (it used to be a macro) and
it returns a pointer to a @code{MYSQL_FIELD} instead of a
@code{MYSQL_FIELD}.

@item
@code{mysql_num_fields()} can no longer be used on a @code{MYSQL*} object (it's
now a function that takes a @code{MYSQL_RES*} value as an argument). With a
@code{MYSQL*} object, you should now use @code{mysql_field_count()} instead.

@item
In MySQL Version 3.22, the output of @code{SELECT DISTINCT ...} was
almost always sorted.  In Version 3.23, you must use @code{GROUP BY} or
@code{ORDER BY} to obtain sorted output.

@item
@code{SUM()} now returns @code{NULL} instead of 0 if
there are no matching rows. This is required by SQL-99.

@item
An @code{AND} or @code{OR} with @code{NULL} values will now return
@code{NULL} instead of 0. This mostly affects queries that use @code{NOT}
on an @code{AND/OR} expression as @code{NOT NULL} = @code{NULL}.

@item
@code{LPAD()} and @code{RPAD()} now shorten the result string if it's longer
than the length argument.
@end itemize


@node Upgrading-from-3.21, Upgrading-from-3.20, Upgrading-from-3.22, Upgrade
@subsection Upgrading from Version 3.21 to 3.22

@cindex compatibility, between MySQL versions
@cindex upgrading, 3.21 to 3.22

Nothing that affects compatibility has changed between versions 3.21 and 3.22.
The only pitfall is that new tables that are created with @code{DATE} type
columns will use the new way to store the date. You can't access these new
columns from an old version of @code{mysqld}.

After installing MySQL Version 3.22, you should start the new server
and then run the @code{mysql_fix_privilege_tables} script. This will add the
new privileges that you need to use the @code{GRANT} command.  If you forget
this, you will get @code{Access denied} when you try to use @code{ALTER
TABLE}, @code{CREATE INDEX}, or @code{DROP INDEX}. The procedure for updating
the grant tables is described in @ref{Upgrading-grant-tables}.

The C API interface to @code{mysql_real_connect()} has changed.  If you have
an old client program that calls this function, you must place a @code{0} for
the new @code{db} argument (or recode the client to send the @code{db}
element for faster connections).  You must also call @code{mysql_init()}
before calling @code{mysql_real_connect()}.  This change was done to allow
the new @code{mysql_options()} function to save options in the @code{MYSQL}
handler structure.

The @code{mysqld} variable @code{key_buffer} has been renamed to
@code{key_buffer_size}, but you can still use the old name in your
startup files.


@node Upgrading-from-3.20, Windows upgrading, Upgrading-from-3.21, Upgrade
@subsection Upgrading from Version 3.20 to 3.21

@cindex upgrading, 3.20 to 3.21

If you are running a version older than Version 3.20.28 and want to
switch to Version 3.21, you need to do the following:

You can start the @code{mysqld} Version 3.21 server with the
@code{--old-protocol} option to use it with clients from a Version 3.20
distribution.  In this case, the new client function @code{mysql_errno()}
will not return any server error, only @code{CR_UNKNOWN_ERROR} (but it
works for client errors), and the server uses the old pre-3.21 @code{password()}
checking rather than the new method.

If you are @strong{not} using the @code{--old-protocol} option to
@code{mysqld}, you will need to make the following changes:

@itemize @bullet

@item
All client code must be recompiled. If you are using ODBC, you must get
the new @code{MyODBC} 2.x driver.

@item
The script @code{scripts/add_long_password} must be run to convert the
@code{Password} field in the @code{mysql.user} table to @code{CHAR(16)}.

@item
All passwords must be reassigned in the @code{mysql.user} table (to get 62-bit
rather than 31-bit passwords).

@item
The table format hasn't changed, so you don't have to convert any tables.

@end itemize

MySQL Version 3.20.28 and above can handle the new @code{user} table
format without affecting clients. If you have a MySQL version earlier
than Version 3.20.28, passwords will no longer work with it if you convert the
@code{user} table. So to be safe, you should first upgrade to at least Version
3.20.28 and then upgrade to Version 3.21.

@cindex Protocol mismatch
The new client code works with a 3.20.x @code{mysqld} server, so
if you experience problems with 3.21.x, you can use the old 3.20.x server
without having to recompile the clients again.

If you are not using the @code{--old-protocol} option to @code{mysqld},
old clients will be unable to connect and will issue the following error
message:

@example
ERROR: Protocol mismatch. Server Version = 10 Client Version = 9
@end example

The Perl DBI interface also supports the old
@code{mysqlperl} interface.  The only change you have to make if you use
@code{mysqlperl} is to change the arguments to the @code{connect()} function.
The new arguments are: @code{host}, @code{database}, @code{user},
and @code{password} (note that the @code{user} and @code{password} arguments
have changed places).

The following changes may affect queries in old applications:

@itemize @bullet

@item
@code{HAVING} must now be specified before any @code{ORDER BY} clause.

@item
The parameters to @code{LOCATE()} have been swapped.

@item
There are some new reserved words. The most notable are @code{DATE},
@code{TIME}, and @code{TIMESTAMP}.

@end itemize


@node Windows upgrading, Upgrading-grant-tables, Upgrading-from-3.20, Upgrade
@subsection Upgrading MySQL under Windows

@cindex Windows, upgrading

When upgrading MySQL under Windows, please follow these steps:

@enumerate

@item
Download the latest Windows distribution of MySQL.

@item
Choose a time of day with low usage, where a maintenance break is
acceptable.

@item
Alert the users that still are active about the maintenance break.

@item
Stop the running MySQL Server (for example, with @code{NET STOP MySQL} or with
the @code{Services} utility if you
are running MySQL as a service, or with @code{mysqladmin shutdown} otherwise).

@item
Exit the @code{WinMySQLAdmin} program if it is running.

@item
Run the installation script of the Windows distribution, by
clicking the "Install" button in WinZip and following the installation
steps of the script.

@strong{Important note:}
Early alpha Windows distributions for MySQL 4.1 do not contain any
installer program.  See @ref{Windows binary installation} for instructions on
how to install such a distribution.

@item
You may either overwrite your old MySQL installation (usually located at
@file{C:\mysql}), or install it into a different directory, such as
@code{C:\mysql4}. Overwriting the old installation is recommended.

@item
Restart the server (for example, with @code{NET START MySQL} if you run MySQL
as a service, or by invoking @code{mysqld} directly otherwise).

@item
Update the grant tables. The procedure is described in
@ref{Upgrading-grant-tables}.

@end enumerate

Possible error situations:
@example
A system error has occurred.
System error 1067 has occurred.
The process terminated unexpectedly.
@end example

This error means that your @file{my.cnf} file (by default
@file{C:\my.cnf}) contains an option that cannot be recognized by
MySQL. You can verify that this is the case by trying to restart MySQL
with the @file{my.cnf} file renamed, for example, to @file{my_cnf.old} to
prevent the server from using it.  Once you have verified it, you need to
identify which option is the culprit. Create a new @file{my.cnf} file and
move parts of the old file to it (restarting the server after you move
each part) until you determine which option causes server startup to fail.


@node Upgrading-grant-tables, Upgrading-to-arch, Windows upgrading, Upgrade
@subsection Upgrading the Grant Tables

@cindex upgrading, grant tables
@cindex grant tables, upgrading

Some releases introduce changes to the structure of the grant tables
(the tables in the @code{mysql} database)
to add new  privileges or features. To make sure that your grant tables
are current when you update to a new version of MySQL, you should update
your grant tables as well.

On Unix or Unix-like systems, update the grant tables by running the
@code{mysql_fix_privilege_tables} script:

@example
shell> mysql_fix_privilege_tables
@end example

You must run this script while the server is running. It attempts to
connect to the server running on the local host as @code{root}.
If your @code{root} account requires a password, indicate the password
on the command line.  For MySQL 4.1 and up, specify the password like this:

@example
shell> mysql_fix_privilege_tables --password=root_password
@end example

Prior to MySQL 4.1, specify the password like this:

@example
shell> mysql_fix_privilege_tables root_password
@end example

The @code{mysql_fix_privilege_tables} script performs any actions
necessary to convert your grant tables to the current format. You
may see some @code{Duplicate column name} warnings as it runs; they
can be ignored.

After running the script, stop the server and restart it.

On Windows systems, there isn't an easy way to update the grant tables
until MySQL 4.0.15.  From version 4.0.15 on, MySQL distributions include a
@code{mysql_fix_privilege_tables.sql} SQL script that you can run using
the @code{mysql} client.  If your MySQL installation is located at
@file{C:\mysql}, the commands look like this: 

@example
C:\mysql\bin> mysql -u root -p mysql

mysql> SOURCE C:\mysql\scripts\mysql_fix_privilege_tables.sql
@end example

If your installation is located in some other directory, adjust the
pathnames appropriately.

The @code{mysql} command will prompt you for the @code{root} password; enter it
when prompted.

As with the Unix procedure, you may see some @code{Duplicate column name}
warnings as @code{mysql} processes the statements in the
@code{mysql_fix_privilege_tables.sql} script; they can be ignored.

After running the script, stop the server and restart it.


@node Upgrading-to-arch,  , Upgrading-grant-tables, Upgrade
@subsection Copying MySQL Databases to Another Machine

@cindex upgrading, different architecture
@cindex copying databases
@cindex databases, copying

If you are using MySQL Version 3.23 or later, you can copy the @file{.frm},
@file{.MYI}, and @file{.MYD} files for @code{MyISAM} tables between different
architectures that support the same floating-point format.  (MySQL takes care
of any byte-swapping issues.)
@xref{MyISAM, , @code{MyISAM} Tables}.

The MySQL @code{ISAM} data and index files (@file{.ISD} and @file{*.ISM},
respectively) are architecture-dependent and in some cases operating
system-dependent.  If you want to move your applications to another
machine that has a different architecture or operating system than your
current machine, you should not try to move a database by simply copying
the files to the other machine. Use @code{mysqldump} instead.

By default, @code{mysqldump} will create a file containing SQL statements.
You can then transfer the file to the other machine and feed it as input
to the @code{mysql} client.

Try @code{mysqldump --help} to see what options are available.
If you are moving the data to a newer version of MySQL, you should use
@code{mysqldump --opt} to take advantage of any optimizations that result
in a dump file that is smaller and can be processed faster.

The easiest (although not the fastest) way to move a database between two
machines is to run the following commands on the machine on which the
database is located:

@example
shell> mysqladmin -h 'other hostname' create db_name
shell> mysqldump --opt db_name \
        | mysql -h 'other hostname' db_name
@end example

@c TODO: next example not only changes copy direction (from local->remote
@c to remote->local), it adds --compress.  But --compress is a separate
@c thing and can be used no matter the copy direction.  Split into two
@c examples.

If you want to copy a database from a remote machine over a slow network,
you can use:

@example
shell> mysqladmin create db_name
shell> mysqldump -h 'other hostname' --opt --compress db_name \
        | mysql db_name
@end example

You can also store the result in a file, then transfer the file to the
target machine and load the file into the database there.  For example,
you can dump a database to a file on the source machine like this:

@example
shell> mysqldump --quick db_name | gzip > db_name.contents.gz
@end example

(The file created in this example is compressed.) Transfer the file
containing the database contents to the target machine and run these commands
there:

@example
shell> mysqladmin create db_name
shell> gunzip < db_name.contents.gz | mysql db_name
@end example

@cindex @code{mysqldump}
@cindex @code{mysqlimport}
You can also use @code{mysqldump} and @code{mysqlimport} to transfer
the database.
For big tables, this is much faster than simply using @code{mysqldump}.
In the following commands, @code{DUMPDIR} represents the full pathname
of the directory you use to store the output from @code{mysqldump}.

First, create the directory for the output files and dump the database:

@example
shell> mkdir DUMPDIR
shell> mysqldump --tab=DUMPDIR db_name
@end example

Then transfer the files in the @code{DUMPDIR} directory to some corresponding
directory on the target machine and load the files into MySQL
there:

@example
shell> mysqladmin create db_name           # create database
shell> cat DUMPDIR/*.sql | mysql db_name   # create tables in database
shell> mysqlimport db_name DUMPDIR/*.txt   # load data into tables
@end example

Also, don't forget to copy the @code{mysql} database because that's where the
grant tables (@code{user}, @code{db}, @code{host}) are stored.  You may have
to run commands as the MySQL @code{root} user on the new machine
until you have the @code{mysql} database in place.

After you import the @code{mysql} database on the new machine, execute
@code{mysqladmin flush-privileges} so that the server reloads the grant table
information.


@node Operating System Specific Notes, Perl support, Upgrade, Installing
@section Operating System Specific Notes

@menu
* Linux::                       Linux Notes
* Mac OS X::                    Mac OS X Notes
* Solaris::                     Solaris Notes
* BSD Notes::                   BSD Notes
* Other Unix Notes::            Other Unix Notes
* OS/2::                        OS/2 Notes
* BeOS::                        BeOS Notes
@end menu


@node Linux, Mac OS X, Operating System Specific Notes, Operating System Specific Notes
@subsection Linux Notes

This section discusses issues that have been found to occur on Linux.
The first few subsections describe general operating sytem-related issues,
problems that can occur when using binary or source distributions, and
post-installation issues. The remaining subsections discuss problems that occur
with Linux on specific platforms.

Note that most of these problems occur on older versions of Linux. If you are
running a recent version, you likely will see none of them.

@menu
* Linux-OS::                    Linux Operating System Notes
* Binary notes-Linux::          Linux Binary Distribution Notes
* Source notes-Linux::          Linux Source Distribution Notes
* Linux-post-install::          Linux Post-installation Notes
* Linux-x86::                   Linux x86 Notes
* Linux-SPARC::                 Linux SPARC Notes
* Linux-Alpha::                 Linux Alpha Notes
* Linux-PowerPC::               Linux PowerPC Notes
* Linux-MIPS::                  Linux MIPS Notes
* Linux-IA-64::                 Linux IA-64 Notes
@end menu


@node Linux-OS, Binary notes-Linux, Linux, Linux
@subsubsection Linux Operating System Notes

MySQL needs at least Linux Version 2.0.

@strong{Warning:}
We have seen some strange problems with Linux 2.2.14 and MySQL on SMP
systems.  We also have reports from some MySQL users that they have
encountered serious stability problems using MySQL with kernel 2.2.14.
If you are using this kernel, you should upgrade to 2.2.19 (or newer) or to
a 2.4 kernel.  If you have a multiple-CPU box, then you should seriously
consider using 2.4 as this will give you a significant speed boost.
Your system also will be more stable.

@c TODO: this isn't really an "issue"; put in a FAQ somewhere:
@c "Why do I always see at least three mysqld processes on Linux?"

When using LinuxThreads you will see a minimum of three @code{mysqld} processes
running.  These are in fact threads.  There will be one thread for the
LinuxThreads manager, one thread to handle connections, and one thread
to handle alarms and signals.


@node Binary notes-Linux, Source notes-Linux, Linux-OS, Linux
@subsubsection Linux Binary Distribution Notes

@cindex binary distributions, on Linux
@cindex Linux, binary distribution

The Linux-Intel binary and RPM releases of MySQL are configured
for the highest possible speed.  We are always trying to use the fastest
stable compiler available.

The binary release is linked with @code{-static}, which means you do not
normally need to worry about which version of the system libraries you
have. You need not install LinuxThreads, either.  A program linked with
@code{-static} is slightly larger than a dynamically linked program,
but also slightly faster (3-5%).  However, one problem with a statically
linked program is that you can't use user-defined functions (UDFs).
If you are going to write or use UDFs (this is something for C or C++
programmers only), you must compile MySQL yourself using dynamic linking.

A known issue with binary distributions is that on older Linux
systems that use @code{libc} (such as Red Hat 4.x or Slackware), you will get
some non-fatal problems with hostname resolution. If your system uses
@code{libc} rather than @code{glibc2},
you probably will encounter some difficulties with hostname resolution and
@code{getpwnam()}. This happens because @code{glibc}
unfortunately depends on some external libraries to implement hostname
resolution and @code{getpwent()}, even when compiled with @code{-static}).
These problems manifest themselves in two ways:

@itemize @bullet
@item
You probably will see  the following error message when you run
@code{mysql_install_db}:

@example
Sorry, the host 'xxxx' could not be looked up
@end example

You can deal with this by executing
@code{mysql_install_db --force}, which will not execute the
@code{resolveip} test in @code{mysql_install_db}.  The downside is that
you can't use hostnames in the grant tables: Except for @code{localhost},
you must use IP numbers instead.  If you are using an old version of MySQL
that doesn't support @code{--force}, you must manually remove the
@code{resolveip} test in @code{mysql_install} using an editor.

@item
You also may see
the following error when you try to run @code{mysqld} with the @code{--user}
option:

@example
getpwnam: No such file or directory
@end example

To work around this, start
@code{mysqld} with @code{su} rather than by specifying the @code{--user}
option. This causes the system itself to change the user ID of the
@code{mysqld} process so that @code{mysqld} need not do so.

@end itemize

Another solution, which solves both problems, is to not use a binary
distribution.  Get a MySQL source distribution (an RPM or the @code{tar.gz}
distribution) and install that instead.

On some Linux 2.2 versions, you may get the error @code{Resource
temporarily unavailable} when clients make a lot of new connections to
a @code{mysqld} server over TCP/IP.  The problem is that Linux has a
delay between the time that you close a TCP/IP socket and the time that
the system actually frees it.  There is only room for a finite number
of TCP/IP slots, so you will encounter the resource-unavailable error if
clients attempt too many new TCP/IP connections during a short time. For
example, you may see the error when you run the MySQL @file{test-connect}
benchmark over TCP/IP.

We have inquired about this problem a few times on different Linux mailing
lists but have never been able to find a suitable resolution.  The only
known ``fix'' is for the clients to use persistent connections, or,
if you are running the database server and clients on the same machine,
to use Unix socket file connections rather than TCP/IP connections.


@node Source notes-Linux, Linux-post-install, Binary notes-Linux, Linux
@subsubsection Linux Source Distribution Notes

@cindex source distributions, on Linux
@cindex Linux, source distribution

The following notes regarding @code{glibc} apply only to the situation
when you build MySQL
yourself. If you are running Linux on an x86 machine, in most cases it is
much better for you to just use our binary. We link our binaries against
the best patched version of @code{glibc} we can come up with and with the
best compiler options, in an attempt to make it suitable for a high-load
server.  For a typical user, even for setups with a lot of concurrent
connections or tables exceeding the 2G limit, our binary is
the best choice in most cases.  After reading the following text, if you
are in doubt about what to do, try our binary first to see whether it meets
your needs.  If you discover that our binary is not good enough, then
you may want to try your own build.  In that case, we would appreciate
a note about it, so we can build a better binary next time.

MySQL uses LinuxThreads on Linux.  If you are using an old
Linux version that doesn't have @code{glibc2}, you must install
LinuxThreads before trying to compile MySQL.   You can get
LinuxThreads at @uref{http://www.mysql.com/downloads/os-linux.html}.

Note that @code{glibc} versions before and including Version 2.1.1 have
a fatal bug in @code{pthread_mutex_timedwait()} handling, which is used
when you issue @code{INSERT DELAYED} statements.  We recommend that you not use
@code{INSERT DELAYED} before upgrading @code{glibc}.

Note that Linux kernel and the LinuxThread library can by default
only have 1024 threads.  If you plan to have more than 1000 concurrent
connections, you will need to make some changes to LinuxThreads:

@itemize @bullet
@item
Increase @code{PTHREAD_THREADS_MAX} in
@file{sysdeps/unix/sysv/linux/bits/local_lim.h} to 4096 and decrease
@code{STACK_SIZE} in @file{linuxthreads/internals.h} to 256 KB. The
paths are relative to the root of @code{glibc}. (Note that MySQL will
not be stable with around 600-1000 connections if @code{STACK_SIZE}
is the default of 2 MB.)

@item
Recompile LinuxThreads to produce a new @file{libpthread.a} library,
and relink MySQL against it.

@end itemize

The page @uref{http://www.volano.com/linuxnotes.html} contains additional
information about circumventing thread limits in LinuxThreads.

There is another issue that greatly hurts MySQL performance, especially on
SMP systems.  The mutex implementation in LinuxThreads in @code{glibc}
2.1 is very bad for programs with many threads that hold the mutex
only for a short time.  This produces a paradoxical result: If you link
MySQL against an unmodified LinuxThreads, removing processors from an
SMP actually improves MySQL performance in many cases.  We have made a
patch available for @code{glibc} 2.1.3 to correct this behavior
(@uref{http://www.mysql.com/Downloads/Linux/linuxthreads-2.1-patch}).

With @code{glibc} 2.2.2,
MySQL version 3.23.36 will use the adaptive mutex, which is much
better than even the patched one in @code{glibc} 2.1.3. Be warned, however,
that under some conditions, the current mutex code in @code{glibc} 2.2.2
overspins, which hurts MySQL performance. The likelihood that this condition
will occur can be reduced by renicing the @code{mysqld} process to the highest
priority. We have also been able to correct the overspin behavior with
a patch, available at
@uref{http://www.mysql.com/Downloads/Linux/linuxthreads-2.2.2.patch}.
It combines the correction of overspin, maximum number of
threads, and stack spacing all in one. You will need to apply it in the
@code{linuxthreads} directory with
@code{patch -p0 </tmp/linuxthreads-2.2.2.patch}.
We hope it will be included in
some form in future releases of @code{glibc} 2.2. In any case, if
you link against @code{glibc} 2.2.2, you still need to correct
@code{STACK_SIZE} and @code{PTHREAD_THREADS_MAX}. We hope that the defaults
will be corrected to some more acceptable values for high-load
MySQL setup in the future, so that the commands needed to produce
your own build can be reduced to @code{./configure; make; make install}.

We recommend that you use the above patches to build a special static
version of @code{libpthread.a} and use it only for statically linking
against MySQL. We know that the patches are safe for MySQL
and significantly improve its performance, but we cannot say anything
about other applications. If you link other applications that require
LinuxThreads against the
patched static version of the library, or build a patched shared version and
install it on your system, you are doing it at your own risk.

If you experience any strange problems during the installation of
MySQL, or with some common utilities hanging, it is very likely that
they are either library or compiler related. If this is the case, using our
binary will resolve them.

If you link your own MySQL client programs, you may see the following error at
runtime:

@example
ld.so.1: fatal: libmysqlclient.so.#:
open failed: No such file or directory
@end example

This problem can be avoided by one of the following methods:

@itemize @bullet
@item
Link clients with the @code{-Wl,r/full-path-to-libmysqlclient.so}
flag rather than with @code{-Lpath}).

@item
Copy @code{libmysqclient.so} to @file{/usr/lib}.

@tindex LD_RUN_PATH environment variable
@tindex environment variable, LD_RUN_PATH
@item
Add the pathname of the directory where @file{libmysqlclient.so} is located
to the @code{LD_RUN_PATH} environment variable before running your client.
@end itemize

If you are using the Fujitsu compiler (@code{fcc/FCC}), you will have
some problems compiling MySQL because the Linux header files are very
@code{gcc} oriented.
The following @code{configure} line should work with @code{fcc/FCC}:

@example
CC=fcc CFLAGS="-O -K fast -K lib -K omitfp -Kpreex -D_GNU_SOURCE \
    -DCONST=const -DNO_STRTOLL_PROTO" \
CXX=FCC CXXFLAGS="-O -K fast -K lib \
    -K omitfp -K preex --no_exceptions --no_rtti -D_GNU_SOURCE \
    -DCONST=const -Dalloca=__builtin_alloca -DNO_STRTOLL_PROTO \
    '-D_EXTERN_INLINE=static __inline'" \
./configure \
    --prefix=/usr/local/mysql --enable-assembler \
    --with-mysqld-ldflags=-all-static --disable-shared \
    --with-low-memory
@end example


@node Linux-post-install, Linux-x86, Source notes-Linux, Linux
@subsubsection Linux Post-installation Notes

@code{mysql.server} can be found in the @file{share/mysql} directory
under the MySQL installation directory or in the
@file{support-files} directory of the MySQL source tree.
You can install it as @file{/etc/init.d/mysql} for automatic MySQL startup and
shutdown.
@xref{Automatic start}.

If MySQL can't open enough files or connections, it may be that
you haven't configured Linux to handle enough files.

In Linux 2.2 and onward, you can check the number of allocated
file handles as follows:

@example
shell> cat /proc/sys/fs/file-max
shell> cat /proc/sys/fs/dquot-max
shell> cat /proc/sys/fs/super-max
@end example

If you have more than 16 MB of memory, you should add something like the
following to your init scripts (for example, @file{/etc/init.d/boot.local} on SuSE Linux):

@example
echo 65536 > /proc/sys/fs/file-max
echo 8192 > /proc/sys/fs/dquot-max
echo 1024 > /proc/sys/fs/super-max
@end example

You can also run the @code{echo} commands from the command line as @code{root},
but these settings will be lost the next time your computer reboots.

Alternatively, you can set these parameters on bootup by using the
@code{sysctl} tool, which is used by many Linux distributions (SuSE has
added it as well, beginning with SuSE Linux 8.0). Just put the following
values into a file named @file{/etc/sysctl.conf}:

@example
# Increase some values for MySQL
fs.file-max = 65536
fs.dquot-max = 8192
fs.super-max = 1024
@end example

You should also add the following to @file{/etc/my.cnf}:

@example
[mysqld_safe]
open-files-limit=8192
@end example

This should allow the server a limit of 8192 for the combined number of
connections and open files.

The @code{STACK_SIZE} constant in LinuxThreads controls the spacing of thread
stacks in the address space.  It needs to be large enough so that there will
be plenty of room for the stack of each individual thread, but small enough
to keep the stack of some threads from running into the global @code{mysqld}
data.  Unfortunately, as we have experimentally discovered, the Linux
implementation of @code{mmap()} will successfully unmap an already mapped
region if you ask it to map out an address already in use, zeroing out the data
on the entire page, instead of returning an error.  So, the safety of
@code{mysqld} or any other threaded application depends on ``gentlemanly''
behavior of the code that creates threads.  The user must take measures to
make sure the number of running threads at any time is sufficiently low for
thread stacks to stay away from the global heap.  With @code{mysqld}, you
should enforce this behavior by setting a reasonable value for
the @code{max_connections} variable.

If you build MySQL yourself, you can patch LinuxThreads for better stack use.
@xref{Source notes-Linux}.
If you do not want to patch
LinuxThreads, you should set @code{max_connections} to a value no higher
than 500.  It should be even less if you have a large key buffer,  large
heap tables, or some other things that make @code{mysqld} allocate a lot
of memory, or if you are running a 2.2 kernel with a 2G patch. If you are
using our binary or RPM version 3.23.25 or later, you can safely set
@code{max_connections} at 1500, assuming no large key buffer or heap tables
with lots of data.  The more you reduce @code{STACK_SIZE} in LinuxThreads
the more threads you can safely create.  We recommend values between
128K and 256K.

If you use a lot of concurrent connections, you may suffer from a ``feature''
in the 2.2 kernel that attempts to prevent fork bomb attacks by penalizing
a process for forking or cloning a child.  This causes MySQL
not to scale well as you increase the number of concurrent clients.  On
single-CPU systems, we have seen this manifested as very slow thread
creation: It may take a long time to connect to MySQL
(as long as 1 minute), and it may take just as long to shut it down.  On
multiple-CPU systems, we have observed a gradual drop in query speed as
the number of clients increases.  In the process of trying to find a
solution, we have received a kernel patch from one of our users who
claimed it made a lot of difference for his site.  The patch is available at
@uref{http://www.mysql.com/Downloads/Patches/linux-fork.patch}. We have
now done rather extensive testing of this patch on both development and
production systems.  It has significantly
improved MySQL performance without causing any problems and we now
recommend it to our users who still run high-load servers on
2.2 kernels.

This issue has been fixed in the 2.4 kernel, so if you are not satisfied
with the current performance of your system, rather than patching
your 2.2 kernel, it might be easier to upgrade to 2.4. On SMP systems,
upgrading also will give you a nice SMP boost in addition to fixing the
fairness bug.

We have tested MySQL on the 2.4 kernel on a 2-CPU machine and found MySQL
scales @strong{much} better. There was virtually no slowdown on query
throughput all the way up to 1000 clients, and the MySQL scaling factor
(computed as the ratio of maximum throughput to the throughput for one
client) was 180%.  We have observed similar results on a 4-CPU system:
Virtually no slowdown as the number of clients was increased up to 1000,
and a 300% scaling factor. Based on these results, for a high-load SMP
server using a 2.2 kernel, we definitely recommend upgrading to the 2.4
kernel at this point.

We have discovered that it is essential to run @code{mysqld} process
with the highest possible priority on the 2.4 kernel to achieve maximum
performance.  This can be done by adding a @code{renice -20 $$} command
to @code{mysqld_safe}. In our testing on a 4-CPU machine, increasing
the priority gave 60% throughput increase with 400 clients.

We are currently also trying to collect more information on how well
MySQL performs on 2.4 kernel on 4-way and 8-way systems. If you have
access such a system and have done some benchmarks, please send an email
message to @email{benchmarks@@mysql.com} with the results. We will review
them for inclusion in the manual.

If you see a dead @code{mysqld} server process with @code{ps}, this usually
means that you have found a bug in MySQL or you have a corrupted
table. @xref{Crashing}.

To get a core dump on Linux if @code{mysqld} dies with a @code{SIGSEGV} signal,
you can start @code{mysqld} with the @code{--core-file} option.  Note
that you also probably need to raise the @code{core file size} by adding
@code{ulimit -c 1000000} to @code{mysqld_safe} or starting
@code{mysqld_safe} with @code{--core-file-size=1000000}.
@xref{mysqld_safe, , @code{mysqld_safe}}.


@node Linux-x86, Linux-SPARC, Linux-post-install, Linux
@subsubsection Linux x86 Notes

MySQL requires @code{libc} Version 5.4.12 or newer. It's known to
work with @code{libc} 5.4.46.  @code{glibc} Version 2.0.6 and later should
also work. There have been some problems with the @code{glibc} RPMs from
Red Hat, so if you have problems, check whether there are any updates.
The @code{glibc} 2.0.7-19 and 2.0.7-29 RPMs are known to work.

If you are using Red Hat 8.0 or a new @code{glibc} 2.2.x library, you may see
@code{mysqld} die in @code{gethostbyaddr()}. This happens because the new
@code{glibc} library requires a stack size greater than 128K for this call.
To fix the problem, start @code{mysqld} with the @code{--thread-stack=192K}
option.  (Use @code{-O thread_stack=192K} before MySQL 4.)
This stack size is now the default on MySQL 4.0.10 and above, so you should
not see the problem.

If you are using @code{gcc} 3.0 and above to compile MySQL, you must install
the @code{libstdc++v3} library before compiling MySQL; if you don't do
this, you will get an error about a missing @code{__cxa_pure_virtual}
symbol during linking.

On some older Linux distributions, @code{configure} may produce an error
like this:

@example
Syntax error in sched.h. Change _P to __P in the
/usr/include/sched.h file.
See the Installation chapter in the Reference Manual.
@end example

Just do what the error message says. Add an extra underscore to the
@code{_P} macro name that has only one underscore, then try again.

You may get some warnings when compiling. Those shown here can be ignored:

@example
mysqld.cc -o objs-thread/mysqld.o
mysqld.cc: In function `void init_signals()':
mysqld.cc:315: warning: assignment of negative value `-1' to
`long unsigned int'
mysqld.cc: In function `void * signal_hand(void *)':
mysqld.cc:346: warning: assignment of negative value `-1' to
`long unsigned int'
@end example

If @code{mysqld} always dumps core when it starts, the problem may be that
you have an old @file{/lib/libc.a}.  Try renaming it, then remove
@file{sql/mysqld} and do a new @code{make install} and try again.  This
problem has been reported on some Slackware installations.

If you get the following error when linking @code{mysqld},
it means that your @file{libg++.a} is not installed correctly:

@example
/usr/lib/libc.a(putc.o): In function `_IO_putc':
putc.o(.text+0x0): multiple definition of `_IO_putc'
@end example

You can avoid using @file{libg++.a} by running @code{configure} like this:

@example
shell> CXX=gcc ./configure
@end example

@node Linux-SPARC, Linux-Alpha, Linux-x86, Linux
@subsubsection Linux SPARC Notes

In some implementations, @code{readdir_r()} is broken.  The symptom is
that the @code{SHOW DATABASES} statement always returns an empty set.
This can be fixed by removing @code{HAVE_READDIR_R} from @file{config.h}
after configuring and before compiling.

@c this patch is no longer available, and this is an ancient version of
@c Linux for the Sparc

@c Some problems will require patching your Linux installation.  The patch can
@c be found at
@c @uref{http://www.mysql.com/Downloads/patches/Linux-sparc-2.0.30.diff}.
@c This patch is against the Linux distribution @file{sparclinux-2.0.30.tar.gz}
@c that is available at @code{vger.rutgers.edu} (a version of Linux that was
@c never merged with the official 2.0.30).  You must also install LinuxThreads
@c Version 0.6 or newer.


@node Linux-Alpha, Linux-PowerPC, Linux-SPARC, Linux
@subsubsection Linux Alpha Notes

MySQL Version 3.23.12 is the first MySQL version that is
tested on Linux-Alpha.  If you plan to use MySQL on Linux-Alpha,
you should ensure that you have this version or newer.

We have tested MySQL on Alpha with our benchmarks and test suite,
and it appears to work nicely. 

We currently build the MySQL binary packages on SuSE Linux 7.0 for AXP,
kernel 2.4.4-SMP, Compaq C compiler (V6.2-505) and Compaq C++ compiler
(V6.3-006) on a Compaq DS20 machine with an Alpha EV6 processor.

You can find the above compilers at
@uref{http://www.support.compaq.com/alpha-tools/}.  By using these compilers
rather than @code{gcc}, we get about 9-14% better MySQL performance.

Note that until MySQL version 3.23.52 and 4.0.2, we optimized the binary for
the current CPU only (by using the @code{-fast} compile option). This means
that for older versions, you can use our Alpha binaries only if you have an
Alpha EV6 processor.

For all following releases, we added the @code{-arch generic} flag
to our compile options, which makes sure the binary runs on all Alpha
processors. We also compile statically to avoid library problems.
The @code{configure} command looks like this:

@example
CC=ccc CFLAGS="-fast -arch generic" CXX=cxx \
CXXFLAGS="-fast -arch generic -noexceptions -nortti" \
./configure --prefix=/usr/local/mysql --disable-shared \
    --with-extra-charsets=complex --enable-thread-safe-client \
    --with-mysqld-ldflags=-non_shared --with-client-ldflags=-non_shared
@end example

If you want to use @code{egcs}, the following @code{configure} line worked
for us:

@example
CFLAGS="-O3 -fomit-frame-pointer" CXX=gcc \
CXXFLAGS="-O3 -fomit-frame-pointer -felide-constructors \
    -fno-exceptions -fno-rtti" \
./configure --prefix=/usr/local/mysql --disable-shared
@end example

Some known problems when running MySQL on Linux-Alpha:

@itemize @bullet
@item
Debugging threaded applications like MySQL will not work with
@code{gdb 4.18}.  You should use @code{gdb} 5.1 instead!

@item
If you try linking @code{mysqld} statically when using @code{gcc}, the
resulting image will dump core at startup time.  In other words, @strong{don't}
use @code{--with-mysqld-ldflags=-all-static} with @code{gcc}.
@end itemize


@node Linux-PowerPC, Linux-MIPS, Linux-Alpha, Linux
@subsubsection Linux PowerPC Notes

MySQL should work on MkLinux with the newest @code{glibc} package
(tested with @code{glibc} 2.0.7).


@node Linux-MIPS, Linux-IA-64, Linux-PowerPC, Linux
@subsubsection Linux MIPS Notes

To get MySQL to work on Qube2 (Linux Mips), you need the
newest @code{glibc} libraries. @code{glibc-2.0.7-29C2} is known to
work.  You must also use the @code{egcs} C++ compiler
(@code{egcs-1.0.2-9}, @code{gcc 2.95.2} or newer).


@node Linux-IA-64,  , Linux-MIPS, Linux
@subsubsection Linux IA-64 Notes

To get MySQL to compile on Linux IA-64, we use the following @code{configure}
command for building with @code{gcc} 2.96:

@example
CC=gcc \
CFLAGS="-O3 -fno-omit-frame-pointer" \
CXX=gcc \
CXXFLAGS="-O3 -fno-omit-frame-pointer -felide-constructors \
    -fno-exceptions -fno-rtti" \
./configure --prefix=/usr/local/mysql \
    "--with-comment=Official MySQL binary" \
    --with-extra-charsets=complex
@end example

On IA-64, the MySQL client binaries use shared libraries. This means
that if you install our binary distribution at a location other than
@file{/usr/local/mysql}, you need to add the path of the directory
where you have @file{libmysqlclient.so} installed either to the
@file{/etc/ld.so.conf} file or to the value of your @code{LD_LIBRARY_PATH}
environment variable.

@xref{Link errors}.


@node Mac OS X, Solaris, Linux, Operating System Specific Notes
@subsection Mac OS X Notes

On Mac OS X, @code{tar} cannot handle long filenames. If you need to unpack a
@file{.tar.gz} distribution, use @code{gnutar} instead.

@menu
* Mac OS X 10.x::               Mac OS X 10.x (Darwin)
* Mac OS X Server::             Mac OS X Server 1.2 (Rhapsody)
@end menu


@node Mac OS X 10.x, Mac OS X Server, Mac OS X, Mac OS X
@subsubsection Mac OS X 10.x (Darwin)

MySQL should work without any problems on Mac OS X 10.x 
(Darwin).

Our binary for Mac OS X is compiled on Darwin 6.3 with the following
@code{configure} line:

@example
CC=gcc CFLAGS="-O3 -fno-omit-frame-pointer" CXX=gcc \
CXXFLAGS="-O3 -fno-omit-frame-pointer -felide-constructors \
    -fno-exceptions -fno-rtti" \
./configure --prefix=/usr/local/mysql \
    --with-extra-charsets=complex --enable-thread-safe-client \
    --enable-local-infile --disable-shared
@end example

@xref{Mac OS X installation}.

@node Mac OS X Server,  , Mac OS X 10.x, Mac OS X
@subsubsection Mac OS X Server 1.2 (Rhapsody)

For current versions of Mac OS X Server, no operating system changes are
necessary before compiling MySQL.  Compiling for the Server platform is
the same as for the client version of Mac OS X. (However, note that MySQL
comes preinstalled on Mac OS X Server, so you need not build it yourself.)

For older versions (Mac OS X Server 1.2, a.k.a. Rhapsody), you must
first install a pthread package before trying to configure MySQL.


@xref{Mac OS X installation}.


@node Solaris, BSD Notes, Mac OS X, Operating System Specific Notes
@subsection Solaris Notes

@cindex Solaris installation problems
@cindex problems, installing on Solaris
@cindex tar, problems on Solaris
@cindex errors, directory checksum
@cindex checksum errors

On Solaris, you may run into trouble even before you get the MySQL
distribution unpacked!  Solaris @code{tar} can't handle long file names, so
you may see an error like this when you unpack MySQL:

@example
x mysql-3.22.12-beta/bench/Results/ATIS-mysql_odbc-NT_4.0-cmp-db2,\
informix,ms-sql,mysql,oracle,solid,sybase, 0 bytes, 0 tape blocks
tar: directory checksum error
@end example

In this case, you must use GNU @code{tar} (@code{gtar}) to unpack the
distribution.  You can find a precompiled copy for Solaris at
@uref{http://www.mysql.com/downloads/os-solaris.html}.

Sun native threads only work on Solaris 2.5 and higher.  For Version 2.4 and
earlier, MySQL will automatically use MIT-pthreads.
@xref{MIT-pthreads}.

If you get the following error from @code{configure},
it means that you have something wrong with your compiler installation:

@example
checking for restartable system calls... configure: error can not
run test programs while cross compiling
@end example

In this case you should upgrade your compiler to a newer version.  You may
also be able to solve this problem by inserting the following row into the
@file{config.cache} file:

@example
ac_cv_sys_restartable_syscalls=$@{ac_cv_sys_restartable_syscalls='no'@}
@end example

If you are using Solaris on a SPARC, the recommended compiler is
@code{gcc} 2.95.2 or 3.2. You can find this at @uref{http://gcc.gnu.org/}.
Note that @code{egcs} 1.1.1 and @code{gcc} 2.8.1 don't work reliably on
SPARC!

The recommended @code{configure} line when using @code{gcc} 2.95.2 is:

@example
CC=gcc CFLAGS="-O3" \
CXX=gcc CXXFLAGS="-O3 -felide-constructors -fno-exceptions -fno-rtti" \
./configure --prefix=/usr/local/mysql --with-low-memory \
--enable-assembler
@end example

If you have an UltraSPARC system, you can get 4% better performance by adding
@code{-mcpu=v8 -Wa,-xarch=v8plusa} to the @code{CFLAGS} and @code{CXXFLAGS}
environment variables.

If you have Sun's Forte 5.0 (or newer) compiler, you can
run @code{configure} like this:

@example
CC=cc CFLAGS="-Xa -fast -native -xstrconst -mt" \
CXX=CC CXXFLAGS="-noex -mt" \
./configure --prefix=/usr/local/mysql --enable-assembler
@end example

To create a 64-bit binary with Sun's Forte compiler, use the
following configuration options:

@example
CC=cc CFLAGS="-Xa -fast -native -xstrconst -mt -xarch=v9" \
CXX=CC CXXFLAGS="-noex -mt -xarch=v9" ASFLAGS="-xarch=v9" \
./configure --prefix=/usr/local/mysql --enable-assembler
@end example

To create a 64bit Solaris binary using @code{gcc}, add @code{-m64} to
@code{CFLAGS} and @code{CXXFLAGS}. Note that this works only with MySQL
4.0 and up - MySQL 3.23 does not include the required modifications to
support this.

In the MySQL benchmarks, we got a 4% speedup on an UltraSPARC when using
Forte 5.0 in 32-bit mode compared to using @code{gcc} 3.2 with @code{-mcpu} flags.

If you create a 64-bit @code{mysqld} binary, it is 4% slower than the 32-bit
binary, but can handle more threads and memory.

If you get a problem with @code{fdatasync} or @code{sched_yield},
you can fix this by adding @code{LIBS=-lrt} to the configure line

For older compilers than WorkShop 5.3,
you may have to edit the @code{configure} script to change this line:

@example
#if !defined(__STDC__) || __STDC__ != 1
@end example

To this:

@example
#if !defined(__STDC__)
@end example

If you turn on @code{__STDC__} with the @code{-Xc} option, the Sun compiler
can't compile with the Solaris @file{pthread.h} header file.  This is a Sun
bug (broken compiler or broken include file).

If @code{mysqld} issues the following error message when you run it, you have
tried to compile MySQL with the Sun compiler without enabling the
multi-thread option (@code{-mt}):

@example
libc internal error: _rmutex_unlock: rmutex not held
@end example

Add @code{-mt} to @code{CFLAGS} and @code{CXXFLAGS} and recompile.

If you are using the SFW version of @code{gcc} (which comes with Solaris 8),
you must add @file{/opt/sfw/lib} to the environment variable
@code{LD_LIBRARY_PATH} before running @code{configure}.

If you are using the @code{gcc} available from @code{sunfreeware.com}, you may
have many problems.  To avoid this, you should recompile @code{gcc} and GNU
@code{binutils} on the machine where you will be running them.

If you get the following error when compiling MySQL with @code{gcc},
it means that your @code{gcc} is not configured for your version of Solaris:

@example
shell> gcc -O3 -g -O2 -DDBUG_OFF  -o thr_alarm ...
./thr_alarm.c: In function `signal_hand':
./thr_alarm.c:556: too many arguments to function `sigwait'
@end example

The proper thing to do in this case is to get the newest version of
@code{gcc} and compile it with your current @code{gcc} compiler!  At
least for Solaris 2.5, almost all binary versions of @code{gcc} have
old, unusable include files that will break all programs that use
threads, and possibly other programs!

Solaris doesn't provide static versions of all system libraries
(@code{libpthreads} and @code{libdl}), so you can't compile MySQL
with @code{--static}.  If you try to do so, you will get one of the following
errors:

@example
ld: fatal: library -ldl: not found
undefined reference to `dlopen'
cannot find -lrt
@end example

If you link your own MySQL client programs, you may see the following error at
runtime:

@example
ld.so.1: fatal: libmysqlclient.so.#:
open failed: No such file or directory
@end example

This problem can be avoided by one of the following methods:

@itemize @bullet
@item
Link clients with the @code{-Wl,r/full-path-to-libmysqlclient.so}
flag rather than with @code{-Lpath}).

@item
Copy @code{libmysqclient.so} to @file{/usr/lib}.

@tindex LD_RUN_PATH environment variable
@tindex environment variable, LD_RUN_PATH
@item
Add the pathname of the directory where @file{libmysqlclient.so} is located
to the @code{LD_RUN_PATH} environment variable before running your client.
@end itemize

If you have problems with @code{configure} trying to link with @code{-lz} when
you don't have @code{zlib} installed, you have two options:

@itemize @bullet
@item
If you want to be able to use the compressed communication protocol,
you need to get and install @code{zlib} from @code{ftp.gnu.org}.

@item
Run @code{configure} with the @code{--with-named-z-libs=no} option when
building MySQL.
@end itemize

If you are using @code{gcc} and have problems with loading user-defined
functions (UDFs) into MySQL, try adding @code{-lgcc} to the link line
for the UDF.

If you would like MySQL to start automatically, you can copy
@file{support-files/mysql.server} to @file{/etc/init.d} and create a
symbolic link to it named @file{/etc/rc3.d/S99mysql.server}.

If too many processes try to connect very rapidly to @code{mysqld}, you will
see this error in the MySQL log:

@example
Error in accept: Protocol error
@end example

You might try starting the server with the @code{--back_log=50}
option as a workaround for this.  (Use @code{-O back_log=50} before MySQL 4.)

Solaris doesn't support core files for @code{setuid()} applications, so
you can't get a core file from @code{mysqld} if you are using the
@code{--user} option.

@menu
* Solaris 2.7::                 Solaris 2.7/2.8 Notes
* Solaris x86::                 Solaris x86 Notes
@end menu


@node Solaris 2.7, Solaris x86, Solaris, Solaris
@subsubsection Solaris 2.7/2.8 Notes

You can normally use a Solaris 2.6 binary on Solaris 2.7 and 2.8.  Most
of the Solaris 2.6 issues also apply for Solaris 2.7 and 2.8.

MySQL Version 3.23.4 and above should be able to detect new versions of
Solaris automatically and enable workarounds for the following problems!

Solaris 2.7 / 2.8 has some bugs in the include files.  You may see the
following error when you use @code{gcc}:

@example
/usr/include/widec.h:42: warning: `getwc' redefined
/usr/include/wchar.h:326: warning: this is the location of the previous
definition
@end example

If this occurs, you can fix the problem by copying
@code{/usr/include/widec.h} to
@code{.../lib/gcc-lib/os/gcc-version/include} and changing line 41 from this:

@example
#if     !defined(lint) && !defined(__lint)
@end example

To this:

@example
#if     !defined(lint) && !defined(__lint) && !defined(getwc)
@end example

Alternatively, you can edit @file{/usr/include/widec.h} directly.  Either
way, after you make the fix, you should remove @file{config.cache} and run
@code{configure} again!

If you get the following errors when you run @code{make}, it's because
@code{configure} didn't detect the @file{curses.h} file (probably
because of the error in @file{/usr/include/widec.h}):

@example
In file included from mysql.cc:50:
/usr/include/term.h:1060: syntax error before `,'
/usr/include/term.h:1081: syntax error before `;'
@end example

The solution to this is to do one of the following:

@itemize @bullet
@item
Configure with @code{CFLAGS=-DHAVE_CURSES_H CXXFLAGS=-DHAVE_CURSES_H ./configure}.

@item
Edit @file{/usr/include/widec.h} as indicated above and re-run @code{configure}.

@item
Remove the @code{#define HAVE_TERM} line from the @file{config.h} file and
run @code{make} again.
@end itemize

If your linker can't find @code{-lz} when linking
client programs, the problem is probably that your @file{libz.so} file is
installed in @file{/usr/local/lib}.  You can fix this by one of the
following methods:

@itemize @bullet
@item
Add @file{/usr/local/lib} to @code{LD_LIBRARY_PATH}.

@item
Add a link to @file{libz.so} from @file{/lib}.

@item
If you are using Solaris 8, you can install the optional @code{zlib} from your
Solaris 8 CD distribution.

@item
Run @code{configure} with the @code{--with-named-z-libs=no} option when
building MySQL.
@end itemize


@node Solaris x86,  , Solaris 2.7, Solaris
@subsubsection Solaris x86 Notes

On Solaris 8 on x86, @code{mysqld} will dump core if you remove the
debug symbols using @code{strip}.

If you are using @code{gcc} or @code{egcs} on Solaris x86 and you
experience problems with core dumps under load, you should use the
following @code{configure} command:

@example
CC=gcc CFLAGS="-O3 -fomit-frame-pointer -DHAVE_CURSES_H" \
CXX=gcc \
CXXFLAGS="-O3 -fomit-frame-pointer -felide-constructors \
    -fno-exceptions -fno-rtti -DHAVE_CURSES_H" \
./configure --prefix=/usr/local/mysql
@end example

This will avoid problems with the @code{libstdc++} library and with C++
exceptions.

If this doesn't help, you should compile a debug version and run
it with a trace file or under @code{gdb}.
@xref{Using gdb on mysqld,  , Using @code{gdb} on @code{mysqld}}.


@node BSD Notes, Other Unix Notes, Solaris, Operating System Specific Notes
@subsection BSD Notes

This section provides information about using MySQL on BSD variants.

@menu
* FreeBSD::                     FreeBSD Notes
* NetBSD::                      NetBSD Notes
* OpenBSD::                     OpenBSD 2.5 Notes
* OpenBSD 2.8::                 OpenBSD 2.8 Notes
* BSDI::                        BSD/OS Version 2.x Notes
* BSDI3::                       BSD/OS Version 3.x Notes
* BSDI4::                       BSD/OS Version 4.x Notes
@end menu


@node FreeBSD, NetBSD, BSD Notes, BSD Notes
@subsubsection FreeBSD Notes

FreeBSD 4.x or newer is recommended for running MySQL, because the thread
package is much more integrated.
To get a secure and stable system, you should use only FreeBSD kernels
that are marked @code{-RELEASE}.

The easiest (and preferred) way to install MySQL is to use the
@code{mysql-server} and @code{mysql-client} ports available at
@uref{http://www.freebsd.org/}.
Using these ports gives you the following benefits:

@itemize @bullet
@item
A working MySQL with all optimizations enabled that are known to work on your
version of FreeBSD.

@item
Automatic configuration and build.

@item
Startup scripts installed in @file{/usr/local/etc/rc.d}.

@item
The ability to use @code{pkg_info -L} to see which files are installed.

@item
The ability to use @code{pkg_delete} to remove MySQL if you no longer want it
on your machine.
@end itemize

It is recommended you use MIT-pthreads on FreeBSD 2.x, and native threads on
Versions 3 and up. It is possible to run with native threads on some late
2.2.x versions but you may encounter problems shutting down @code{mysqld}.

Unfortunately, certain function calls on FreeBSD are not yet fully thread-safe.
Most notably, this includes the @code{gethostbyname()} function, which is
used by MySQL to convert hostnames into IP addresses. Under certain
circumstances, the @code{mysqld} process will suddenly cause 100%
CPU load and will be unresponsive. If you encounter this problem, try to start
up MySQL using the @code{--skip-name-resolve} option.

Alternatively, you can link MySQL on FreeBSD 4.x against the LinuxThreads
library, which avoids a few of the problems that the native FreeBSD thread
implementation has. For a very good comparison of LinuxThreads vs. native
threads, see Jeremy Zawodny's article @cite{FreeBSD or Linux for your
MySQL Server?} at
@uref{http://jeremy.zawodny.com/blog/archives/000697.html}.

A known problem when using LinuxThreads on FreeBSD is that
@code{wait_timeout} is not working (probably a signal handling problem in
FreeBSD/LinuxThreads).  This is supposed to be fixed in FreeBSD 5.0.
The symptom is that persistent connections can hang for a very long
time without getting closed down.

The MySQL build process require GNU make (@code{gmake}) to work.  If
GNU @code{make} is not available, you must install it first before compiling
MySQL.

The recommended way to compile and install MySQL on FreeBSD with
@code{gcc} (2.95.2 and up) is:

@example
shell> CC=gcc CFLAGS="-O2 -fno-strength-reduce" \
           CXX=gcc CXXFLAGS="-O2 -fno-rtti -fno-exceptions \
           -felide-constructors -fno-strength-reduce" \
           ./configure --prefix=/usr/local/mysql --enable-assembler
shell> gmake
shell> gmake install
shell> cd /usr/local/mysql
shell> bin/mysql_install_db
shell> bin/mysqld_safe &
@end example

If you notice that @code{configure} will use MIT-pthreads, you should read
the MIT-pthreads notes.  @xref{MIT-pthreads}.

If you get an error from @code{make install} that it can't find
@file{/usr/include/pthreads}, @code{configure} didn't detect that you need
MIT-pthreads. To fix this problem, remove @file{config.cache}, then re-run
@code{configure} with the @code{--with-mit-threads} option.

@c TODO: This is not really FreeBSD-specific. Move to general
@c troublshooting section.

Be sure your name resolver setup is correct.  Otherwise, you may
experience resolver delays or failures when connecting to @code{mysqld}.
Also make sure that the @code{localhost} entry in the @file{/etc/hosts} file is
correct.  The file should start with a line similar to this:

@example
127.0.0.1       localhost localhost.your.domain
@end example

FreeBSD is known to have a very low default file handle limit.
@xref{Not enough file handles}.  Start the server by using the
@code{--open-files-limit} option for @code{mysqld_safe}, or raise
the limits for the @code{mysqld} user in @file{/etc/login.conf} and
rebuild it with @code{cap_mkdb /etc/login.conf}.  Also be sure you set
the appropriate class for this user in the password file if you are not
using the default (use @code{chpass mysqld-user-name}).
@xref{mysqld_safe,  , @code{mysqld_safe}}.

If you have a lot of memory, you should consider rebuilding
the kernel to allow MySQL to use more than 512M of RAM.
Take a look at @code{option MAXDSIZ} in the LINT config
file for more information.

If you get problems with the current date in MySQL, setting the
@code{TZ} variable will probably help.  @xref{Environment variables}.


@node NetBSD, OpenBSD, FreeBSD, BSD Notes
@subsubsection NetBSD Notes

To compile on NetBSD you need GNU @code{make}. Otherwise, the build process will
fail when @code{make} tries to run @code{lint} on C++ files.


@node OpenBSD, OpenBSD 2.8, NetBSD, BSD Notes
@subsubsection OpenBSD 2.5 Notes

On OpenBSD Version 2.5, you can compile MySQL with native threads
with the following options:

@example
CFLAGS=-pthread CXXFLAGS=-pthread ./configure --with-mit-threads=no
@end example


@node OpenBSD 2.8, BSDI, OpenBSD, BSD Notes
@subsubsection OpenBSD 2.8 Notes

Our users have reported that OpenBSD 2.8 has a threading bug which causes
problems with MySQL.  The OpenBSD Developers have fixed the problem,
but as of January 25th, 2001, it's only available in the ``-current'' branch.
The symptoms of this threading bug are: slow response, high load, high CPU
usage, and crashes.

If you get an error like @code{Error in accept:: Bad file descriptor} or
error 9 when trying to open tables or directories, the problem is probably
that you haven't allocated enough file descriptors for MySQL.

In this case, try starting @code{mysqld_safe} as @code{root} with the following
options:

@example
shell> mysqld_safe --user=mysql --open-files-limit=2048 &
@end example

@node BSDI, BSDI3, OpenBSD 2.8, BSD Notes
@subsubsection BSD/OS Version 2.x Notes

If you get the following error when compiling MySQL, your
@code{ulimit} value for virtual memory is too low:

@example
item_func.h: In method `Item_func_ge::Item_func_ge(const Item_func_ge &)':
item_func.h:28: virtual memory exhausted
make[2]: *** [item_func.o] Error 1
@end example

Try using @code{ulimit -v 80000} and run @code{make} again.  If this
doesn't work and you are using @code{bash}, try switching to @code{csh}
or @code{sh}; some BSDI users have reported problems with @code{bash}
and @code{ulimit}.

If you are using @code{gcc}, you may also use have to use the
@code{--with-low-memory} flag for @code{configure} to be able to compile
@file{sql_yacc.cc}.

If you get problems with the current date in MySQL, setting the
@code{TZ} variable will probably help.  @xref{Environment variables}.


@node BSDI3, BSDI4, BSDI, BSD Notes
@subsubsection BSD/OS Version 3.x Notes

Upgrade to BSD/OS Version 3.1.  If that is not possible, install
BSDIpatch M300-038.

Use the following command when configuring MySQL:

@example
shell> env CXX=shlicc++ CC=shlicc2 \
       ./configure \
           --prefix=/usr/local/mysql \
           --localstatedir=/var/mysql \
           --without-perl \
           --with-unix-socket-path=/var/mysql/mysql.sock
@end example

The following is also known to work:

@example
shell> env CC=gcc CXX=gcc CXXFLAGS=-O3 \
       ./configure \
           --prefix=/usr/local/mysql \
           --with-unix-socket-path=/var/mysql/mysql.sock
@end example

You can change the directory locations if you wish, or just use the
defaults by not specifying any locations.

If you have problems with performance under heavy load, try using the
@code{--skip-thread-priority} option to @code{mysqld}!  This will run
all threads with the same priority; on BSDI Version 3.1, this gives better
performance (at least until BSDI fixes their thread scheduler).

If you get the error @code{virtual memory exhausted} while compiling,
you should try using @code{ulimit -v 80000} and run @code{make} again.
If this doesn't work and you are using @code{bash}, try switching to
@code{csh} or @code{sh}; some BSDI users have reported problems with
@code{bash} and @code{ulimit}.


@node BSDI4,  , BSDI3, BSD Notes
@subsubsection BSD/OS Version 4.x Notes

BSDI Version 4.x has some thread-related bugs.  If you want to use
MySQL on this, you should install all thread-related patches.  At
least M400-023 should be installed.

On some BSDI Version 4.x systems, you may get problems with shared libraries.
The symptom is that you can't execute any client programs, for example,
@code{mysqladmin}.  In this case you need to reconfigure not to use
shared libraries with the @code{--disable-shared} option to configure.

Some customers have had problems on BSDI 4.0.1 that the @code{mysqld}
binary after a while can't open tables.  This is because some
library/system related bug causes @code{mysqld} to change current
directory without asking for this!

The fix is to either upgrade MySQL to at least version 3.23.34 or, after
running @code{configure},
remove the line @code{#define HAVE_REALPATH} from @code{config.h}
before running make.

Note that the above means that you can't symbolic link a database directories
to another database directory or symbolic link a table to another database
on BSDI!  (Making a symbolic link to another disk is okay).


@node Other Unix Notes, OS/2, BSD Notes, Operating System Specific Notes
@subsection Other Unix Notes

@menu
* HP-UX 10.20::                 HP-UX Version 10.20 Notes
* HP-UX 11.x::                  HP-UX Version 11.x Notes
* IBM-AIX::                     IBM-AIX notes
* SunOS::                       SunOS 4 Notes
* Alpha-DEC-UNIX::              Alpha-DEC-UNIX Notes (Tru64)
* Alpha-DEC-OSF1::              Alpha-DEC-OSF/1 Notes
* SGI-Irix::                    SGI Irix Notes
* SCO::                         SCO Notes
* SCO UnixWare::                SCO UnixWare Version 7.1.x Notes
@end menu

@c TODO: perhaps subsume the next two nodes under an HP-UX @subsection
@c (like the Mac OS X notes @subsubsections), and move it to before
@c "Other Unix Notes".

@node HP-UX 10.20, HP-UX 11.x, Other Unix Notes, Other Unix Notes
@subsubsection HP-UX Version 10.20 Notes

There are a couple of small problems when compiling MySQL on
HP-UX.  We recommend that you use @code{gcc} instead of the HP-UX native
compiler, because @code{gcc} produces better code!

We recommend using @code{gcc} 2.95 on HP-UX.  Don't use high optimization
flags (like @code{-O6}) as they may not be safe on HP-UX.

The following @code{configure} line should work with @code{gcc} 2.95:

@example
CFLAGS="-I/opt/dce/include -fpic" \
CXXFLAGS="-I/opt/dce/include -felide-constructors -fno-exceptions \
-fno-rtti" \
CXX=gcc \
./configure --with-pthread \
    --with-named-thread-libs='-ldce' \
    --prefix=/usr/local/mysql --disable-shared
@end example

The following @code{configure} line should work with @code{gcc} 3.1:

@example
CFLAGS="-DHPUX -I/opt/dce/include -O3 -fPIC" CXX=gcc \
CXXFLAGS="-DHPUX -I/opt/dce/include -felide-constructors \
    -fno-exceptions -fno-rtti -O3 -fPIC" \
./configure --prefix=/usr/local/mysql \
    --with-extra-charsets=complex --enable-thread-safe-client \
    --enable-local-infile  --with-pthread \
    --with-named-thread-libs=-ldce --with-lib-ccflags=-fPIC
    --disable-shared
@end example

@node HP-UX 11.x, IBM-AIX, HP-UX 10.20, Other Unix Notes
@subsubsection HP-UX Version 11.x Notes

For HP-UX Version 11.x, we recommend MySQL Version 3.23.15 or later.

Because of some critical bugs in the standard HP-UX libraries, you should
install the following patches before trying to run MySQL on HP-UX 11.0:

@example
PHKL_22840 Streams cumulative
PHNE_22397 ARPA cumulative
@end example

This will solve the problem of getting @code{EWOULDBLOCK} from @code{recv()}
and @code{EBADF} from @code{accept()} in threaded applications.

If you are using @code{gcc} 2.95.1 on an unpatched HP-UX 11.x system,
you will get the error:

@example
In file included from /usr/include/unistd.h:11,
                 from ../include/global.h:125,
                 from mysql_priv.h:15,
                 from item.cc:19:
/usr/include/sys/unistd.h:184: declaration of C function ...
/usr/include/sys/pthread.h:440: previous declaration ...
In file included from item.h:306,
                 from mysql_priv.h:158,
                 from item.cc:19:
@end example

The problem is that HP-UX doesn't define @code{pthreads_atfork()} consistently.
It has conflicting prototypes in
@file{/usr/include/sys/unistd.h}:184 and
@file{/usr/include/sys/pthread.h}:440 (details below).

One solution is to copy @file{/usr/include/sys/unistd.h} into
@file{mysql/include} and edit @file{unistd.h} and change it to match
the definition in @file{pthread.h}.  Here's the diff:

@example
183,184c183,184
<      extern int pthread_atfork(void (*prepare)(), void (*parent)(),
<                                                void (*child)());
---
>      extern int pthread_atfork(void (*prepare)(void), void (*parent)(void),
>                                                void (*child)(void));
@end example

After this, the following @code{configure} line should work:

@example
CFLAGS="-fomit-frame-pointer -O3 -fpic" CXX=gcc \
CXXFLAGS="-felide-constructors -fno-exceptions -fno-rtti -O3" \
./configure --prefix=/usr/local/mysql --disable-shared
@end example

If you are using MySQL 4.0.5 with the HP-UX compiler, you can use the following
command (which has been tested with @code{cc} B.11.11.04):

@example
CC=cc CXX=aCC CFLAGS=+DD64 CXXFLAGS=+DD64 ./configure \
    --with-extra-character-set=complex
@end example

You can ignore any errors of the following type:

@example
aCC: warning 901: unknown option: `-3': use +help for online
documentation
@end example

If you get the following error from @code{configure},
check that you don't have the path to the K&R compiler before the path
to the HP-UX C and C++ compiler:

@example
checking for cc option to accept ANSI C... no
configure: error: MySQL requires a ANSI C compiler (and a C++ compiler).
Try gcc. See the Installation chapter in the Reference Manual.
@end example

Another reason for not being able to compile is that you didn't define
the @code{+DD64} flags above.

Another possibility for HP-UX 11 is to use MySQL binaries for HP-UX 10.20.
We have received reports from some users that these binaries work fine on
HP-UX 11.00. If you encounter problems, be sure to check your HP-UX patch
level.

@node IBM-AIX, SunOS, HP-UX 11.x, Other Unix Notes
@subsubsection IBM-AIX notes

@cindex problems, installing on IBM-AIX

Automatic detection of @code{xlC} is missing from Autoconf, so a number of
variables need to be set before running @code{configure}. The following
example uses the IBM compiler:

@example
export CC="xlc_r -ma -O3 -qstrict -qoptimize=3 -qmaxmem=8192 "
export CXX="xlC_r -ma -O3 -qstrict -qoptimize=3 -qmaxmem=8192"
export CFLAGS="-I /usr/local/include"
export LDFLAGS="-L /usr/local/lib"
export CPPFLAGS=$CFLAGS
export CXXFLAGS=$CFLAGS

./configure --prefix=/usr/local \
                --localstatedir=/var/mysql \
                --sysconfdir=/etc/mysql \
                --sbindir='/usr/local/bin' \
                --libexecdir='/usr/local/bin' \
                --enable-thread-safe-client \
                --enable-large-files
@end example

Above are the options used to compile the MySQL distribution that
can be found at @uref{http://www-frec.bull.com/}.

If you change the @code{-O3} to @code{-O2} in the preceding @code{configure}
line, you must also remove the @code{-qstrict} option (this is a limitation in
the IBM C compiler).

If you are using @code{gcc} or @code{egcs} to compile MySQL, you
@strong{must} use the @code{-fno-exceptions} flag, because the exception
handling in @code{gcc}/@code{egcs} is not thread-safe!  (This is tested with
@code{egcs} 1.1.)  There are also some known problems with IBM's assembler
that may cause it to generate bad code when used with @code{gcc}.

We recommend the following @code{configure} line with @code{egcs} and
@code{gcc 2.95} on AIX:

@example
CC="gcc -pipe -mcpu=power -Wa,-many" \
CXX="gcc -pipe -mcpu=power -Wa,-many" \
CXXFLAGS="-felide-constructors -fno-exceptions -fno-rtti" \
./configure --prefix=/usr/local/mysql --with-low-memory
@end example

The @code{-Wa,-many} is necessary for the compile to be successful.  IBM is
aware of this problem but is in to hurry to fix it because of the workaround
available.  We don't know if the @code{-fno-exceptions} is required with
@code{gcc 2.95}, but as MySQL doesn't use exceptions and the above
option generates faster code, we recommend that you should always use this
option with @code{egcs / gcc}.

If you get a problem with assembler code, try changing the @code{-mcpu=xxx}
option to match your CPU. Typically @code{power2}, @code{power}, or
@code{powerpc} may need to be used.  Alternatively, you might need to use
@code{604} or @code{604e}. We are not positive but suspect that
@code{power} would likely be safe most of the time, even on
a power2 machine.

If you don't know what your CPU is, execute a @code{uname -m} command.  It
will produce a string that looks like @code{000514676700}, with a format of
@code{xxyyyyyymmss} where @code{xx} and @code{ss} are always @code{00},
@code{yyyyyy} is a unique system ID and @code{mm} is the ID of the CPU Planar.
A chart of these values can be found at
@uref{http://publib.boulder.ibm.com/doc_link/en_US/a_doc_lib/cmds/aixcmds5/uname.htm}.
This will give you a machine type and a machine model you can use to
determine what type of CPU you have.

If you have problems with signals (MySQL dies unexpectedly
under high load) you may have found an OS bug with threads and
signals.  In this case you can tell MySQL not to use signals by
configuring with:

@example
shell> CFLAGS=-DDONT_USE_THR_ALARM CXX=gcc \
       CXXFLAGS="-felide-constructors -fno-exceptions -fno-rtti \
       -DDONT_USE_THR_ALARM" \
       ./configure --prefix=/usr/local/mysql --with-debug \
           --with-low-memory
@end example

This doesn't affect the performance of MySQL, but has the side
effect that you can't kill clients that are ``sleeping'' on a connection with
@code{mysqladmin kill} or @code{mysqladmin shutdown}.  Instead, the client
will die when it issues its next command.

On some versions of AIX, linking with @code{libbind.a} makes
@code{getservbyname} core dump.  This is an AIX bug and should be reported
to IBM.

For AIX 4.2.1 and @code{gcc}, you have to make the following changes.

After configuring, edit @file{config.h} and @file{include/my_config.h}
and change the line that says this:

@example
#define HAVE_SNPRINTF 1
@end example

to this:

@example
#undef HAVE_SNPRINTF
@end example

And finally, in @file{mysqld.cc} you need to add a prototype for initgoups.

@example
#ifdef _AIX41
extern "C" int initgroups(const char *,int);
#endif
@end example

If you need to allocate a lot of memory to the @code{mysqld} process, it's not
enough to just use @code{ulimit -d unlimited}. You may also have to modify
@code{mysqld_safe} to add a line something like this:

@example
export LDR_CNTRL='MAXDATA=0x80000000'
@end example

You can find more about using a lot of memory at:
@uref{http://publib16.boulder.ibm.com/pseries/en_US/aixprggd/genprogc/lrg_prg_support.htm}.

@node SunOS, Alpha-DEC-UNIX, IBM-AIX, Other Unix Notes
@subsubsection SunOS 4 Notes

On SunOS 4, MIT-pthreads is needed to compile MySQL. This in turn
means you will need GNU @code{make}.

Some SunOS 4 systems have problems with dynamic libraries and @code{libtool}.
You can use the following @code{configure} line to avoid this problem:

@example
shell> ./configure --disable-shared --with-mysqld-ldflags=-all-static
@end example

When compiling @code{readline}, you may get warnings about duplicate defines.
These may be ignored.

When compiling @code{mysqld}, there will be some @code{implicit declaration
of function} warnings. These may be ignored.


@node Alpha-DEC-UNIX, Alpha-DEC-OSF1, SunOS, Other Unix Notes
@subsubsection Alpha-DEC-UNIX Notes (Tru64)

If you are using @code{egcs} 1.1.2 on Digital Unix, you should upgrade to
@code{gcc} 2.95.2, because @code{egcs} on DEC has some serious bugs!

When compiling threaded programs under Digital Unix, the documentation
recommends using the @code{-pthread} option for @code{cc} and @code{cxx} and
the @code{-lmach -lexc} libraries (in addition to @code{-lpthread}).  You
should run @code{configure} something like this:

@example
CC="cc -pthread" CXX="cxx -pthread -O" \
./configure --with-named-thread-libs="-lpthread -lmach -lexc -lc"
@end example

When compiling @code{mysqld}, you may see a couple of warnings like this:

@example
mysqld.cc: In function void handle_connections()':
mysqld.cc:626: passing long unsigned int *' as argument 3 of
accept(int,sockadddr *, int *)'
@end example

You can safely ignore these warnings.  They occur because @code{configure}
can detect only errors, not warnings.

If you start the server directly from the command-line, you may have problems
with it dying when you log out.  (When you log out, your outstanding processes
receive a @code{SIGHUP} signal.)  If so, try starting the server like this:

@example
shell> nohup mysqld [options] &
@end example

@code{nohup} causes the command following it to ignore any @code{SIGHUP}
signal sent from the terminal.  Alternatively, start the server by running
@code{mysqld_safe}, which invokes @code{mysqld} using @code{nohup} for you.
@xref{mysqld_safe, , @code{mysqld_safe}}.

If you get a problem when compiling @file{mysys/get_opt.c}, just remove the
@code{#define _NO_PROTO} line from the start of that file!

If you are using Compaq's CC compiler, the following @code{configure} line
should work:

@example
CC="cc -pthread"
CFLAGS="-O4 -ansi_alias -ansi_args -fast -inline speed all -arch host"
CXX="cxx -pthread"
CXXFLAGS="-O4 -ansi_alias -ansi_args -fast -inline speed all \
    -arch host -noexceptions -nortti"
export CC CFLAGS CXX CXXFLAGS
./configure \
    --prefix=/usr/local/mysql \
    --with-low-memory \
    --enable-large-files \
    --enable-shared=yes \
    --with-named-thread-libs="-lpthread -lmach -lexc -lc"
gnumake
@end example

If you get a problem with @code{libtool}, when compiling with shared libraries
as above, when linking @code{mysql}, you should be able to get around
this by issuing:

@example
cd mysql
/bin/sh ../libtool --mode=link cxx -pthread  -O3 -DDBUG_OFF \
    -O4 -ansi_alias -ansi_args -fast -inline speed \
    -speculate all \ -arch host  -DUNDEF_HAVE_GETHOSTBYNAME_R \
    -o mysql  mysql.o readline.o sql_string.o completion_hash.o \
    ../readline/libreadline.a -lcurses \
    ../libmysql/.libs/libmysqlclient.so  -lm
cd ..
gnumake
gnumake install
scripts/mysql_install_db
@end example


@node Alpha-DEC-OSF1, SGI-Irix, Alpha-DEC-UNIX, Other Unix Notes
@subsubsection Alpha-DEC-OSF/1 Notes

If you have problems compiling and have DEC @code{CC} and @code{gcc}
installed, try running @code{configure} like this:

@example
CC=cc CFLAGS=-O CXX=gcc CXXFLAGS=-O3 \
./configure --prefix=/usr/local/mysql
@end example

If you get problems with the @file{c_asm.h} file, you can create and use
a 'dummy' @file{c_asm.h} file with:

@example
touch include/c_asm.h
CC=gcc CFLAGS=-I./include \
CXX=gcc CXXFLAGS=-O3 \
./configure --prefix=/usr/local/mysql
@end example

Note that the following problems with the @code{ld} program can be fixed
by downloading the latest DEC (Compaq) patch kit from:
@uref{http://ftp.support.compaq.com/public/unix/}.

On OSF/1 V4.0D and compiler "DEC C V5.6-071 on Digital Unix V4.0 (Rev. 878)"
the compiler had some strange behavior (undefined @code{asm} symbols).
@code{/bin/ld} also appears to be broken (problems with @code{_exit
undefined} errors occurring while linking @code{mysqld}).  On this system, we
have managed to compile MySQL with the following @code{configure}
line, after replacing @code{/bin/ld} with the version from OSF 4.0C:

@example
CC=gcc CXX=gcc CXXFLAGS=-O3 ./configure --prefix=/usr/local/mysql
@end example

With the Digital compiler "C++ V6.1-029", the following should work:

@example
CC=cc -pthread
CFLAGS=-O4 -ansi_alias -ansi_args -fast -inline speed -speculate all \
       -arch host
CXX=cxx -pthread
CXXFLAGS=-O4 -ansi_alias -ansi_args -fast -inline speed -speculate all \
          -arch host -noexceptions -nortti
export CC CFLAGS CXX CXXFLAGS
./configure --prefix=/usr/mysql/mysql --with-mysqld-ldflags=-all-static \
            --disable-shared --with-named-thread-libs="-lmach -lexc -lc"
@end example

In some versions of OSF/1, the @code{alloca()} function is broken. Fix
this by removing the line in @file{config.h} that defines @code{'HAVE_ALLOCA'}.

The @code{alloca()} function also may have an incorrect prototype in
@code{/usr/include/alloca.h}.  This warning resulting from this can be ignored.

@code{configure} will use the following thread libraries automatically:
@code{--with-named-thread-libs="-lpthread -lmach -lexc -lc"}.

When using @code{gcc}, you can also try running @code{configure} like this:

@example
shell> CFLAGS=-D_PTHREAD_USE_D4 CXX=gcc CXXFLAGS=-O3 ./configure ...
@end example

If you have problems with signals (MySQL dies unexpectedly
under high load), you may have found an OS bug with threads and
signals. In this case you can tell MySQL not to use signals by
configuring with:

@example
shell> CFLAGS=-DDONT_USE_THR_ALARM \
       CXXFLAGS=-DDONT_USE_THR_ALARM \
       ./configure ...
@end example

This doesn't affect the performance of MySQL, but has the side
effect that you can't kill clients that are ``sleeping'' on a connection with
@code{mysqladmin kill} or @code{mysqladmin shutdown}.  Instead, the client
will die when it issues its next command.

With @code{gcc} 2.95.2, you will probably run into the following compile error:

@example
sql_acl.cc:1456: Internal compiler error in `scan_region', at except.c:2566
Please submit a full bug report.
@end example

To fix this you should change to the @code{sql} directory and do a ``cut
and paste'' of the last @code{gcc} line, but change @code{-O3} to
@code{-O0} (or add @code{-O0} immediately after @code{gcc} if you don't
have any @code{-O} option on your compile line).  After this is done you
can just change back to the top-level directly and run @code{make}
again.


@node SGI-Irix, SCO, Alpha-DEC-OSF1, Other Unix Notes
@subsubsection SGI Irix Notes

If you are using Irix Version 6.5.3 or newer @code{mysqld} will be able to
create threads only if you run it as a user with @code{CAP_SCHED_MGT}
privileges (like @code{root}) or give the @code{mysqld} server this privilege
with the following shell command:

@example
shell> chcap "CAP_SCHED_MGT+epi" /opt/mysql/libexec/mysqld
@end example

You may have to undefine some symbols in @file{config.h} after running
@code{configure} and before compiling.

In some Irix implementations, the @code{alloca()} function is broken.  If the
@code{mysqld} server dies on some @code{SELECT} statements, remove the lines
from @file{config.h} that define @code{HAVE_ALLOC} and @code{HAVE_ALLOCA_H}.
If @code{mysqladmin create} doesn't work, remove the line from @file{config.h}
that defines @code{HAVE_READDIR_R}.  You may have to remove the
@code{HAVE_TERM_H} line as well.

SGI recommends that you install all of the patches on this page as a set:
@uref{http://support.sgi.com/surfzone/patches/patchset/6.2_indigo.rps.html}

At the very minimum, you should install the latest kernel rollup, the
latest @code{rld} rollup, and the latest @code{libc} rollup.

You definitely need all the POSIX patches on this page, for pthreads support:

@uref{http://support.sgi.com/surfzone/patches/patchset/6.2_posix.rps.html}

If you get the something like the following error when compiling
@file{mysql.cc}:

@example
"/usr/include/curses.h", line 82: error(1084): invalid combination of type
@end example

Type the following in the top-level directory of your MySQL source
tree:

@example
shell> extra/replace bool curses_bool < /usr/include/curses.h \
           > include/curses.h
shell> make
@end example

There have also been reports of scheduling problems.  If only one thread is
running, performance is slow.  Avoid this by starting another client.  This may
lead to a 2-to-10-fold increase in execution speed thereafter for the other
thread.  This is a poorly understood problem with Irix threads; you may have
to improvise to find solutions until this can be fixed.

If you are compiling with @code{gcc}, you can use the following
@code{configure} command:

@example
CC=gcc CXX=gcc CXXFLAGS=-O3 \
./configure --prefix=/usr/local/mysql --enable-thread-safe-client \
    --with-named-thread-libs=-lpthread
@end example

On Irix 6.5.11 with native Irix C and C++ compilers ver. 7.3.1.2, the
following is reported to work

@example
CC=cc CXX=CC CFLAGS='-O3 -n32 -TARG:platform=IP22 -I/usr/local/include \
-L/usr/local/lib' CXXFLAGS='-O3 -n32 -TARG:platform=IP22 \
-I/usr/local/include -L/usr/local/lib' \
./configure --prefix=/usr/local/mysql --with-innodb --with-berkeley-db \
    --with-libwrap=/usr/local \
    --with-named-curses-libs=/usr/local/lib/libncurses.a
@end example


@node SCO, SCO UnixWare, SGI-Irix, Other Unix Notes
@subsubsection SCO Notes

The current port is tested only on ``sco3.2v5.0.5'', ``sco3.2v5.0.6'' 
and ``sco3.2v5.0.7'' systems.  There has also been a lot of progress on a
port to ``sco 3.2v4.2''.

For the moment the recommended compiler on OpenServer is @code{gcc} 2.95.2.
With this you should be able to compile MySQL with just:

@example
CC=gcc CXX=gcc ./configure ... (options)
@end example

@enumerate
@item
For OpenServer 5.0.x you need to use gcc-2.95.2p1 or newer from the
Skunkware.  @uref{http://www.sco.com/skunkware/} and choose browser
OpenServer packages or by ftp to ftp2.caldera.com in the
@file{pub/skunkware/osr5/devtools/gcc} directory.

@item
You need the port of GCC 2.5.x for this product and the Development
system.  They are required on this version of SCO Unix.  You cannot
just use the GCC Dev system.

@item
You should get the FSU Pthreads package and install it first.  
This can be found at
@uref{http://moss.csc.ncsu.edu/~mueller/ftp/pub/PART/pthreads.tar.gz}.
You can also get a precompiled package from
@uref{http://www.mysql.com/Downloads/SCO/FSU-threads-3.5c.tar.gz}.

@item
FSU Pthreads can be compiled with SCO Unix 4.2 with tcpip.  Or
OpenServer 3.0 or Open Desktop 3.0 (OS 3.0 ODT 3.0), with the SCO 
Development System installed using a good port of GCC 2.5.x ODT or OS
3.0 you will need a good port of GCC 2.5.x There are a lot of problems
without a good port.  The port for this product requires the SCO Unix
Development system.  Without it, you are missing the libraries and the
linker that is needed.

@item
To build FSU Pthreads on your system, do the following:

@enumerate
@item
Run @code{./configure} in the @file{threads/src} directory and select
the SCO OpenServer option. This command copies @file{Makefile.SCO5} to
@file{Makefile}.

@item
Run @code{make}.

@item
To install in the default @file{/usr/include} directory, login as root,
then @code{cd} to the @file{thread/src} directory, and run @code{make
install}.
@end enumerate

@item
Remember to use GNU @code{make} when making MySQL.

@item
If you don't start @code{mysqld_safe} as @code{root}, you probably will get only the
default 110 open files per process.  @code{mysqld} will write a note about this
in the log file.

@item
With SCO 3.2V5.0.5, you should use FSU Pthreads version 3.5c or newer.
You should also use @code{gcc} 2.95.2 or newer!

The following @code{configure} command should work:

@example
shell> ./configure --prefix=/usr/local/mysql --disable-shared
@end example

@item
With SCO 3.2V4.2, you should use FSU Pthreads version 3.5c or newer.
The following @code{configure} command should work:

@example
shell> CFLAGS="-D_XOPEN_XPG4" CXX=gcc CXXFLAGS="-D_XOPEN_XPG4" \
       ./configure \
           --prefix=/usr/local/mysql \
           --with-named-thread-libs="-lgthreads -lsocket -lgen -lgthreads" \
           --with-named-curses-libs="-lcurses"
@end example

You may get some problems with some include files. In this case, you can
find new SCO-specific include files at
@uref{http://www.mysql.com/Downloads/SCO/SCO-3.2v4.2-includes.tar.gz}.
You should unpack this file in the @file{include} directory of your
MySQL source tree.
@end enumerate

SCO development notes:

@itemize @bullet
@item
MySQL should automatically detect FSU Pthreads and link @code{mysqld}
with @code{-lgthreads -lsocket -lgthreads}.

@item
The SCO development libraries are re-entrant in FSU Pthreads.
SCO claims that its libraries' functions are re-entrant, so they must
be re-entrant with FSU Pthreads.  FSU Pthreads on OpenServer tries to use
the SCO scheme to make re-entrant libraries.

@item
FSU Pthreads (at least the version at @uref{http://www.mysql.com/}) comes
linked with GNU @code{malloc}.  If you encounter problems with memory usage,
make sure that @file{gmalloc.o} is included in @file{libgthreads.a} and
@file{libgthreads.so}.

@item
In FSU Pthreads, the following system calls are pthreads-aware: @code{read()},
@code{write()}, @code{getmsg()}, @code{connect()}, @code{accept()},
@code{select()}, and @code{wait()}.

@item
The CSSA-2001-SCO.35.2 (the patch is listed in custom as
erg711905-dscr_remap security patch (version 2.0.0) breaks FSU threads and
makes @code{mysqld} unstable.  You have to remove this one if you want to run
@code{mysqld} on an OpenServer 5.0.6 machine.

@item
SCO provides Operating Systems Patches at
@uref{ftp://ftp.sco.com/pub/openserver5} for OpenServer 5.0.x 

@item
SCO provides security fixes and @code{libsocket.so.2} at
@uref{ftp://ftp.sco.com/pub/security/OpenServer} and
@uref{ftp://ftp.sco.com/pub/security/sse} for OpenServer 5.0.x

@item
pre-OSR506 security fixes. Also, the @code{telnetd} fix at
@uref{ftp://stage.caldera.com/pub/security/openserver/} or
@uref{ftp://stage.caldera.com/pub/security/openserver/CSSA-2001-SCO.10/}
as both @code{libsocket.so.2} and @code{libresolv.so.1} with instructions for
installing on pre-OSR506 systems.

It's probably a good idea to install the above patches before trying to
compile/use MySQL.
@end itemize


@node SCO UnixWare,  , SCO, Other Unix Notes
@subsubsection SCO UnixWare Version 7.1.x Notes

On UnixWare 7.1.0, you must use a version of MySQL at least as recent as
3.22.13 to get fixes for some portability and OS problems.

We have been able to compile MySQL with the following @code{configure}
command on UnixWare Version 7.1.x:

@example
CC=cc CXX=CC ./configure --prefix=/usr/local/mysql
@end example

If you want to use @code{gcc}, you must use @code{gcc} 2.95.2 or newer.
  
@example
CC=gcc CXX=g++ ./configure --prefix=/usr/local/mysql
@end example
  
@enumerate
@item
SCO provides Operating Systems Patches at
@uref{ftp://ftp.sco.com/pub/unixware7} for UnixWare 7.1.1 and 7.1.3 
and at
@uref{ftp://ftp.sco.com/pub/openunix8} for OpenUNIX 8.0.0.
  
@item
SCO provides information about Security Fixes at
@uref{ftp://ftp.sco.com/pub/security/OpenUNIX} for OpenUNIX
and at
@uref{ftp://ftp.sco.com/pub/security/UnixWare} for UnixWare.
@end enumerate


@node OS/2, BeOS, Other Unix Notes, Operating System Specific Notes
@subsection OS/2 Notes

MySQL uses quite a few open files. Because of this, you should add
something like the following to your @file{CONFIG.SYS} file:

@example
SET EMXOPT=-c -n -h1024
@end example

If you don't do this, you will probably run into the following error:

@example
File 'xxxx' not found (Errcode: 24)
@end example

When using MySQL with OS/2 Warp 3, FixPack 29 or above is
required.  With OS/2 Warp 4, FixPack 4 or above is required. This is a
requirement of the Pthreads library.  MySQL must be installed
on a partition with a type that supports long filenames, such as HPFS, FAT32,
etc.

The @file{INSTALL.CMD} script must be run from OS/2's own @file{CMD.EXE}
and may not work with replacement shells such as @file{4OS2.EXE}.

The @file{scripts/mysql-install-db} script has been renamed.  It is now called
@file{install.cmd} and is a REXX script, which will set up the default
MySQL security settings and create the WorkPlace Shell icons
for MySQL.

Dynamic module support is compiled in but not fully tested. Dynamic
modules should be compiled using the Pthreads run-time library.

@example
gcc -Zdll -Zmt -Zcrtdll=pthrdrtl -I../include -I../regex -I.. \
    -o example udf_example.cc -L../lib -lmysqlclient udf_example.def
mv example.dll example.udf
@end example

@strong{Note:} Due to limitations in OS/2, UDF module name stems must not
exceed 8 characters. Modules are stored in the @file{/mysql2/udf}
directory; the @code{safe-mysqld.cmd} script will put this directory in
the @code{BEGINLIBPATH} environment variable. When using UDF modules,
specified extensions are ignored---it is assumed to be @file{.udf}.
For example, in Unix, the shared module might be named @file{example.so}
and you would load a function from it like this:

@example
mysql> CREATE FUNCTION metaphon RETURNS STRING SONAME "example.so";
@end example

In OS/2, the module would be named @file{example.udf}, but you would not
specify the module extension:

@example
mysql> CREATE FUNCTION metaphon RETURNS STRING SONAME "example";
@end example


@node BeOS,  , OS/2, Operating System Specific Notes
@subsection BeOS Notes

We have in the past talked with some BeOS developers that have said that
MySQL is 80% ported to BeOS, but we haven't heard from them
in a while.


@node Perl support,  , Operating System Specific Notes, Installing
@section Perl Installation Notes

@cindex Perl, installing
@cindex installing, Perl

Perl support for MySQL is provided by means of the @code{DBI}/@code{DBD}
client interface. The interface requires Perl Version 5.6.0 or later.
It @strong{will not work} if you have an older version of Perl.

If you want to use transactions with Perl DBI, you need to have
@code{DBD::mysql} version 1.2216 or newer. Version 2.9003 or newer
is recommended.

As of Version 3.22.8, Perl support is no longer included with
MySQL distributions. You can obtain the necessary modules from
@uref{http://search.cpan.org} for Unix, or using the ActiveState @code{ppm}
program on Windows. The following sections describe how to do this.

Perl support for MySQL must be installed if you want to run the MySQL
benchmark scripts.
@xref{MySQL Benchmarks}.

@menu
* Perl installation::           Installing Perl on Unix
* ActiveState Perl::            Installing ActiveState Perl on Windows
* Perl support problems::       Problems Using the Perl @code{DBI}/@code{DBD} Interface
@end menu


@node Perl installation, ActiveState Perl, Perl support, Perl support
@subsection Installing Perl on Unix

MySQL Perl support requires that you've installed MySQL client programming
support (libraries and header files).  Most installation methods install
the necesssary files. However, if you installed MySQL from RPM files
on Linux, be sure that you've installed the developer RPM.  The client
programs are in the client RPM, but client programming support is in
the developer RPM.

If you want to install Perl support, the files you will need can
be obtained from the CPAN (Comprehensive Perl Archive Network) at
@uref{http://search.cpan.org}.

The easiest way to install Perl modules on Unix is to use the @code{CPAN}
module. For example:

@example
shell> perl -MCPAN -e shell
cpan> install DBI
cpan> install DBD::mysql
@end example

The @code{DBD::mysql} installation runs a number of tests.
These tests require being able to connect to the local MySQL server
as the anonymous user with no password. If you have removed anonymous
accounts or assigned them passwords, the tests fail. You can use @code{force
install DBD::mysql} to ignore the failed tests.

@code{DBI} requires the @code{Data::Dumper} module. It may already be
installed; if not, you should install it before installing @code{DBI}.

It is also possible to download the module distributions in the form of
compressed @code{tar} archives and build the modules manually. For example,
to unpack and build a DBI distribution, use a procedure such as this:

@enumerate
@item
Unpack the distribution into the current directory:
@example
shell> gunzip < DBI-VERSION.tar.gz | tar xvf -
@end example
This command creates a directory named @file{DBI-VERSION}.

@item
Change into the top-level directory of the unpacked distribution:
@example
shell> cd DBI-VERSION
@end example

@item
Build the distribution and compile everything:
@example
shell> perl Makefile.PL
shell> make
shell> make test
shell> make install
@end example
@end enumerate

The @code{make test} command is important because it verifies that the
module is working.  Note that when you run that command during the
@code{DBD::mysql} installation to exercise the interface code, the
MySQL server must be running or the test will fail.

It is a good idea to rebuild and reinstall the @code{DBD::mysql}
distribution whenever you install a new release of MySQL,
particularly if you notice symptoms such as that all your @code{DBI} scripts
fail after you upgrade MySQL.

If you don't have access rights to install Perl modules in the system directory
or if you want to install local Perl modules, the following reference may be
useful:

@example
@uref{http://servers.digitaldaze.com/extensions/perl/modules.html#modules}
@end example

Look under the heading
@code{Installing New Modules that Require Locally Installed Modules}.


@node ActiveState Perl, Perl support problems, Perl installation, Perl support
@subsection Installing ActiveState Perl on Windows

@cindex installing, Perl on Windows
@cindex Perl, installing on Windows
@cindex ActiveState Perl

On Windows, you should do the following to install the MySQL
@code{DBD} module with ActiveState Perl:

@itemize @bullet
@item
Get ActiveState Perl from
@uref{http://www.activestate.com/Products/ActivePerl/}
and install it.

@item
Open a console window (a ``DOS window'').

@item
If required, set the @code{HTTP_proxy} variable. For example, you might try:

@example
set HTTP_proxy=my.proxy.com:3128
@end example

@item
Start the PPM program:

@example
C:\> c:\perl\bin\ppm.pl
@end example

@item
If you have not already done so, install @code{DBI}:

@example
ppm> install DBI
@end example

@item
If this succeeds, run the following command:

@example
install \
ftp://ftp.de.uu.net/pub/CPAN/authors/id/JWIED/DBD-mysql-1.2212.x86.ppd
@end example
@end itemize

The above should work at least with ActiveState Perl Version 5.6.

If you can't get the above to work, you should instead install the
@code{MyODBC} driver and connect to the MySQL server through
ODBC:

@example
use DBI;
$dbh= DBI->connect("DBI:ODBC:$dsn",$user,$password) ||
  die "Got error $DBI::errstr when connecting to $dsn\n";
@end example


@node Perl support problems,  , ActiveState Perl, Perl support
@subsection Problems Using the Perl @code{DBI}/@code{DBD} Interface

@cindex problems, installing Perl
@cindex Perl DBI/DBD, installation problems

If Perl reports that it can't find the @file{../mysql/mysql.so} module,
then the problem is probably that Perl can't locate the shared library
@file{libmysqlclient.so}.

You should be able to fix this by one of the following methods:

@itemize @bullet
@item
Compile the @code{DBD::mysql} distribution with @code{perl
Makefile.PL -static -config} rather than @code{perl Makefile.PL}.

@item
Copy @file{libmysqlclient.so} to the directory where your other shared
libraries are located (probably @file{/usr/lib} or @file{/lib}).

@item
Modify the @code{-L} options used to compile @code{DBD::mysql} to reflect
the actual location of @file{libmysqlclient.so}.

@item
On Linux you can add the pathname of the directory where
@file{libmysqlclient.so} is located to the @file{/etc/ld.so.conf} file.

@tindex LD_RUN_PATH environment variable
@tindex Environment variable, LD_RUN_PATH
@tindex LD_LIBRARY_PATH environment variable
@tindex Environment variable, LD_LIBRARY_PATH
@item
Add the pathname of the directory where @file{libmysqlclient.so} is located
to the @code{LD_RUN_PATH} environment variable. Some systems use
@code{LD_LIBRARY_PATH} instead.
@end itemize

Note that you may also need to modify the @code{-L} options if there are
other libraries that the linker fails to find. For example, if the linker
cannot find @code{libc} because it is in @file{/lib} and the link command
specifies @code{-L/usr/lib}, change the @code{-L} option to @code{-L/lib}
or add @code{-L/lib} to the existing link command.

If you get the following errors from @code{DBD::mysql},
you are probably using @code{gcc} (or using an old binary compiled with
@code{gcc}):

@example
/usr/bin/perl: can't resolve symbol '__moddi3'
/usr/bin/perl: can't resolve symbol '__divdi3'
@end example

Add @code{-L/usr/lib/gcc-lib/... -lgcc} to the link command when the
@file{mysql.so} library gets built (check the output from @code{make} for
@file{mysql.so} when you compile the Perl client).  The @code{-L} option
should specify the pathname of the directory where @file{libgcc.a} is located
on your system.

Another cause of this problem may be that Perl and MySQL aren't both
compiled with @code{gcc}.  In this case, you can solve the mismatch by
compiling both with @code{gcc}.

You may see the following error from @code{DBD::mysql}
when you run the tests:

@example
t/00base............install_driver(mysql) failed:
Can't load '../blib/arch/auto/DBD/mysql/mysql.so' for module DBD::mysql:
../blib/arch/auto/DBD/mysql/mysql.so: undefined symbol:
uncompress at /usr/lib/perl5/5.00503/i586-linux/DynaLoader.pm line 169.
@end example

This means that you need to include the @code{-lz} compression library on the
link line. That can be done by changing the following line in the file
@file{lib/DBD/mysql/Install.pm}:

@example
$sysliblist .= " -lm";
@end example

Change that line to:

@example
$sysliblist .= " -lm -lz";
@end example

After this, you @strong{must} run @code{make realclean} and then
proceed with the installation from the beginning.

If you want to install DBI on SCO, you have to edit the
@file{Makefile} in DBI-xxx and each subdirectory.

Note that the following assumes @code{gcc} 2.95.2 or newer:

@example
OLD:                                  NEW:
CC = cc                               CC = gcc
CCCDLFLAGS = -KPIC -W1,-Bexport       CCCDLFLAGS = -fpic
CCDLFLAGS = -wl,-Bexport              CCDLFLAGS =

LD = ld                               LD = gcc -G -fpic
LDDLFLAGS = -G -L/usr/local/lib       LDDLFLAGS = -L/usr/local/lib
LDFLAGS = -belf -L/usr/local/lib      LDFLAGS = -L/usr/local/lib

LD = ld                               LD = gcc -G -fpic
OPTIMISE = -Od                        OPTIMISE = -O1

OLD:
CCCFLAGS = -belf -dy -w0 -U M_XENIX -DPERL_SCO5 -I/usr/local/include

NEW:
CCFLAGS = -U M_XENIX -DPERL_SCO5 -I/usr/local/include
@end example

This is because the Perl dynaloader will not load the @code{DBI} modules
if they were compiled with @code{icc} or @code{cc}.

If you want to use the Perl module on a system that doesn't support
dynamic linking (like SCO) you can generate a static version of
Perl that includes @code{DBI} and @code{DBD::mysql}.  The way this works
is that you generate a version of Perl with the @code{DBI} code linked
in and install it on top of your current Perl.  Then you use that to
build a version of Perl that additionally has the @code{DBD} code linked
in, and install that.

On SCO, you must have the following environment variables set:

@example
shell> LD_LIBRARY_PATH=/lib:/usr/lib:/usr/local/lib:/usr/progressive/lib
or:
shell> LD_LIBRARY_PATH=/usr/lib:/lib:/usr/local/lib:/usr/ccs/lib:\
/usr/progressive/lib:/usr/skunk/lib
shell> LIBPATH=/usr/lib:/lib:/usr/local/lib:/usr/ccs/lib:\
/usr/progressive/lib:/usr/skunk/lib
shell> MANPATH=scohelp:/usr/man:/usr/local1/man:/usr/local/man:\
/usr/skunk/man:
@end example

First, create a Perl that includes a statically linked @code{DBI} module by
running these commands in the directory where your @code{DBI} distribution is
located:

@example
shell> perl Makefile.PL -static -config
shell> make
shell> make install
shell> make perl
@end example

Then you must install the new Perl. The output of @code{make perl} will
indicate the exact @code{make} command you will need to execute to perform
the installation.  On SCO, this is
@code{make -f Makefile.aperl inst_perl MAP_TARGET=perl}.

Next, use the just-created Perl to create another Perl that also includes a
statically linked @code{DBD::mysql} by running these commands in the
directory where your @code{DBD::mysql} distribution is located:

@example
shell> perl Makefile.PL -static -config
shell> make
shell> make install
shell> make perl
@end example

Finally, you should install this new Perl.  Again, the output of @code{make
perl} indicates the command to use.




@node Tutorial, Using MySQL Programs, Installing, Top
@chapter MySQL Tutorial

@cindex tutorial
@cindex terminal monitor, defined
@cindex monitor, terminal
@cindex options, provided by MySQL

@menu
* Connecting-disconnecting::    Connecting to and Disconnecting from the Server
* Entering queries::            Entering Queries
* Database use::                Creating and Using a Database
* Getting information::         Getting Information About Databases and Tables
* Batch mode::                  Using @code{mysql} in Batch Mode
* Examples::                    Examples of Common Queries
* Twin::                        Queries from the Twin Project
* Apache::                      Using MySQL with Apache
@end menu

This chapter provides a tutorial introduction to MySQL by showing
how to use the @code{mysql} client program to create and use a simple
database.  @code{mysql} (sometimes referred to as the ``terminal monitor'' or
just ``monitor'') is an interactive program that allows you to connect to a
MySQL server, run queries, and view the results.  @code{mysql} may
also be used in batch mode: you place your queries in a file beforehand, then
tell @code{mysql} to execute the contents of the file.  Both ways of using
@code{mysql} are covered here.

To see a list of options provided by @code{mysql}, invoke it with
the @code{--help} option:

@example
shell> mysql --help
@end example

This chapter assumes that @code{mysql} is installed on your machine and that
a MySQL server is available to which you can connect.  If this is
not true, contact your MySQL administrator.  (If @strong{you} are the
administrator, you will need to consult other sections of this manual.)

This chapter describes the entire process of setting up and using a
database.  If you are interested only in accessing an already-existing
database, you may want to skip over the sections that describe how to
create the database and the tables it contains.

Because this chapter is tutorial in nature, many details are necessarily
omitted.  Consult the relevant sections of the manual for more
information on the topics covered here.


@node Connecting-disconnecting, Entering queries, Tutorial, Tutorial
@section Connecting to and Disconnecting from the Server

@cindex connecting, to the server
@cindex disconnecting, from the server
@cindex server, connecting
@cindex server, disconnecting

To connect to the server, you'll usually need to provide a MySQL
username when you invoke @code{mysql} and, most likely, a password.  If the
server runs on a machine other than the one where you log in, you'll also
need to specify a hostname.  Contact your administrator to find out what
connection parameters you should use to connect (that is, what host, username,
and password to use).  Once you know the proper parameters, you should be
able to connect like this:

@example
shell> mysql -h host -u user -p
Enter password: ********
@end example

@code{host} and @code{user} represent the hostname where your MySQL server is
running and the username of your MySQL account.  Substitute appropriate values
for your setup.
The @code{********} represents your password; enter it when @code{mysql}
displays the @code{Enter password:} prompt.

If that works, you should see some introductory information followed by a
@code{mysql>} prompt:


@example
shell> mysql -h host -u user -p
Enter password: ********
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 25338 to server version: 4.0.14-log

Type 'help;' or '\h' for help. Type '\c' to clear the buffer.

mysql>
@end example

The prompt tells you that @code{mysql} is ready for you to enter commands.

Some MySQL installations allow users to connect as the anonymous
(unnamed) user to the server running on the local host.  If this is the case
on your machine, you should be able to connect to that server by invoking
@code{mysql} without any options:

@example
shell> mysql
@end example

After you have connected successfully, you can disconnect any time by typing
@code{QUIT} (or @code{\q}) at the @code{mysql>} prompt:

@example
mysql> QUIT
Bye
@end example

On Unix, you can also disconnect by pressing Control-D.

Most examples in the following sections assume you are connected to the
server.  They indicate this by the @code{mysql>} prompt.


@node Entering queries, Database use, Connecting-disconnecting, Tutorial
@section Entering Queries

@cindex running, queries
@cindex queries, entering
@cindex entering, queries

Make sure you are connected to the server, as discussed in the previous
section.  Doing so will not in itself select any database to work with, but
that's okay.  At this point, it's more important to find out a little about
how to issue queries than to jump right in creating tables, loading data
into them, and retrieving data from them.  This section describes the basic
principles of entering commands, using several queries you can try out to
familiarise yourself with how @code{mysql} works.

Here's a simple command that asks the server to tell you its version number
and the current date.  Type it in as shown here following the @code{mysql>}
prompt and press Enter:

@example
mysql> SELECT VERSION(), CURRENT_DATE;
+--------------+--------------+
| VERSION()    | CURRENT_DATE |
+--------------+--------------+
| 3.22.20a-log | 1999-03-19   |
+--------------+--------------+
1 row in set (0.01 sec)
mysql>
@end example

This query illustrates several things about @code{mysql}:

@itemize @bullet
@item
A command normally consists of an SQL statement followed by a semicolon.
(There are some exceptions where a semicolon may be omitted.  @code{QUIT},
mentioned earlier, is one of them.  We'll get to others later.)

@item
When you issue a command, @code{mysql} sends it to the server for execution
and displays the results, then prints another @code{mysql>} prompt to indicate
that it is ready for another command.

@item
@code{mysql} displays query output in tabular form (rows and columns).  The
first row contains labels for the columns.  The rows following are the query
results.  Normally, column labels are the names of the columns you fetch from
database tables.  If you're retrieving the value of an expression rather than
a table column (as in the example just shown), @code{mysql} labels the column
using the expression itself.

@item
@code{mysql} shows how many rows were returned and how long the query took
to execute, which gives you a rough idea of server performance.  These values
are imprecise because they represent wall clock time (not CPU or machine
time), and because they are affected by factors such as server load and
network latency.  (For brevity, the ``rows in set'' line is not shown in
the remaining examples in this chapter.)
@end itemize

Keywords may be entered in any lettercase.  The following queries are
equivalent:

@example
mysql> SELECT VERSION(), CURRENT_DATE;
mysql> select version(), current_date;
mysql> SeLeCt vErSiOn(), current_DATE;
@end example

Here's another query.  It demonstrates that you can use @code{mysql} as a
simple calculator:

@example
mysql> SELECT SIN(PI()/4), (4+1)*5;
+-------------+---------+
| SIN(PI()/4) | (4+1)*5 |
+-------------+---------+
|    0.707107 |      25 |
+-------------+---------+
@end example

The queries shown thus far have been relatively short, single-line
statements.  You can even enter multiple statements on a single line.
Just end each one with a semicolon:

@example
mysql> SELECT VERSION(); SELECT NOW();
+--------------+
| VERSION()    |
+--------------+
| 3.22.20a-log |
+--------------+

+---------------------+
| NOW()               |
+---------------------+
| 1999-03-19 00:15:33 |
+---------------------+
@end example

A command need not be given all on a single line, so lengthy commands that
require several lines are not a problem.  @code{mysql} determines where your
statement ends by looking for the terminating semicolon, not by looking for
the end of the input line.  (In other words, @code{mysql}
accepts free-format input:  it collects input lines but does not execute them
until it sees the semicolon.)

Here's a simple multiple-line statement:

@example
mysql> SELECT
    -> USER()
    -> ,
    -> CURRENT_DATE;
+--------------------+--------------+
| USER()             | CURRENT_DATE |
+--------------------+--------------+
| joesmith@@localhost | 1999-03-18   |
+--------------------+--------------+
@end example

In this example, notice how the prompt changes from @code{mysql>} to
@code{->} after you enter the first line of a multiple-line query.  This is
how @code{mysql} indicates that it hasn't seen a complete statement and is
waiting for the rest.  The prompt is your friend, because it provides
valuable feedback.  If you use that feedback, you will always be aware of
what @code{mysql} is waiting for.

If you decide you don't want to execute a command that you are in the
process of entering, cancel it by typing @code{\c}:

@example
mysql> SELECT
    -> USER()
    -> \c
mysql>
@end example

Here, too, notice the prompt.  It switches back to @code{mysql>} after you
type @code{\c}, providing feedback to indicate that @code{mysql} is ready
for a new command.

The following table shows each of the prompts you may see and summarizes what
they mean about the state that @code{mysql} is in:

@cindex prompts, meanings
@multitable @columnfractions .10 .80
@item @strong{Prompt} @tab @strong{Meaning}
@item @code{mysql>} @tab Ready for new command.
@item @code{@ @ @ @ ->} @tab Waiting for next line of multiple-line command.
@item @code{@ @ @ @ '>} @tab Waiting for next line, collecting a string that begins with a single quote (@samp{'}).
@item @code{@ @ @ @ ">} @tab Waiting for next line, collecting a string that begins with a double quote (@samp{"}).
@item @code{@ @ @ @ `>} @tab Waiting for next line, collecting an identifier that begins with a backtick (@samp{`}).
@end multitable

Multiple-line statements commonly occur by accident when you intend to
issue a command on a single line, but forget the terminating semicolon.  In
this case, @code{mysql} waits for more input:

@example
mysql> SELECT USER()
    ->
@end example

If this happens to you (you think you've entered a statement but the only
response is a @code{->} prompt), most likely @code{mysql} is waiting for the
semicolon.  If you don't notice what the prompt is telling you, you might sit
there for a while before realising what you need to do.  Enter a semicolon to
complete the statement, and @code{mysql} will execute it:

@example
mysql> SELECT USER()
    -> ;
+--------------------+
| USER()             |
+--------------------+
| joesmith@@localhost |
+--------------------+
@end example

The @code{'>} and @code{">} prompts occur during string collection.
In MySQL, you can write strings surrounded by either @samp{'}
or @samp{"} characters (for example, @code{'hello'} or @code{"goodbye"}),
and @code{mysql} lets you enter strings that span multiple lines.  When you
see a @code{'>} or @code{">} prompt, it means that you've entered a line
containing a string that begins with a @samp{'} or @samp{"} quote character,
but have not yet entered the matching quote that terminates the string.
That's fine if you really are entering a multiple-line string, but how likely
is that?  Not very.  More often, the @code{'>} and @code{">} prompts indicate
that you've inadvertantly left out a quote character.  For example:

@example
mysql> SELECT * FROM my_table WHERE name = "Smith AND age < 30;
    ">
@end example

If you enter this @code{SELECT} statement, then press Enter and wait for the
result, nothing will happen.  Instead of wondering why this
query takes so long, notice the clue provided by the @code{">} prompt.  It
tells you that @code{mysql} expects to see the rest of an unterminated
string.  (Do you see the error in the statement?  The string @code{"Smith} is
missing the second quote.)

At this point, what do you do?  The simplest thing is to cancel the command.
However, you cannot just type @code{\c} in this case, because @code{mysql}
interprets it as part of the string that it is collecting!  Instead, enter
the closing quote character (so @code{mysql} knows you've finished the
string), then type @code{\c}:

@example
mysql> SELECT * FROM my_table WHERE name = "Smith AND age < 30;
    "> "\c
mysql>
@end example

The prompt changes back to @code{mysql>}, indicating that @code{mysql}
is ready for a new command.

The @code{`>} prompt is similar to th @code{'>} and @code{">} prompts,
but indicates that you have begun but not completed a backtick-quoted
identifier.

It's important to know what the @code{'>}, @code{">}, and @code{`>} prompts signify,
because if you mistakenly enter an unterminated string, any further lines you
type will appear to be ignored by @code{mysql}---including a line
containing @code{QUIT}!  This can be quite confusing, especially if you
don't know that you need to supply the terminating quote before you can
cancel the current command.


@node Database use, Getting information, Entering queries, Tutorial
@section Creating and Using a Database

@cindex databases, creating
@cindex databases, using
@cindex creating, databases

@menu
* Creating database::           Creating and Selecting a Database
* Creating tables::             Creating a Table
* Loading tables::              Loading Data into a Table
* Retrieving data::             Retrieving Information from a Table
@end menu

Now that you know how to enter commands, it's time to access a database.

Suppose you have several pets in your home (your menagerie) and you'd
like to keep track of various types of information about them.  You can do so
by creating tables to hold your data and loading them with the desired
information.  Then you can answer different sorts of questions about your
animals by retrieving data from the tables.  This section shows you how to:

@itemize @bullet
@item
Create a database
@item
Create a table
@item
Load data into the table
@item
Retrieve data from the table in various ways
@item
Use multiple tables
@end itemize

The menagerie database will be simple (deliberately), but it is not difficult
to think of real-world situations in which a similar type of database might
be used.  For example, a database like this could be used by a farmer to keep
track of livestock, or by a veterinarian to keep track of patient records.
A menagerie distribution containing some of the queries and sample data used
in the following sections can be obtained from the MySQL web site.
It's available in either compressed @code{tar} format
(@uref{http://www.mysql.com/Downloads/Contrib/Examples/menagerie.tar.gz})
or Zip format
(@uref{http://www.mysql.com/Downloads/Contrib/Examples/menagerie.zip}).

Use the @code{SHOW} statement to find out what databases currently exist
on the server:

@example
mysql> SHOW DATABASES;
+----------+
| Database |
+----------+
| mysql    |
| test     |
| tmp      |
+----------+
@end example

The list of databases is probably different on your machine, but the
@code{mysql} and @code{test} databases are likely to be among them.  The
@code{mysql} database is required because it describes user access
privileges.  The @code{test} database is often provided as a workspace for
users to try things out.

Note that you may not see all databases if you don't have the
@code{SHOW DATABASES} privilege. @xref{GRANT, , @code{GRANT}}.

If the @code{test} database exists, try to access it:

@example
mysql> USE test
Database changed
@end example

Note that @code{USE}, like @code{QUIT}, does not require a semicolon.  (You
can terminate such statements with a semicolon if you like; it does no harm.)
The @code{USE} statement is special in another way, too:  it must be given on
a single line.

You can use the @code{test} database (if you have access to it) for the
examples that follow, but anything you create in that database can be
removed by anyone else with access to it.  For this reason, you should
probably ask your MySQL administrator for permission to use a
database of your own.  Suppose you want to call yours @code{menagerie}.  The
administrator needs to execute a command like this:

@example
mysql> GRANT ALL ON menagerie.* TO 'your_mysql_name'@@'your_client_host';
@end example

where @code{your_mysql_name} is the MySQL username assigned to
you and @code{your_client_host} is the host from which you connect to the
server.


@node Creating database, Creating tables, Database use, Database use
@subsection Creating and Selecting a Database

@cindex selecting, databases
@cindex databases, selecting

If the administrator creates your database for you when setting up your
permissions, you can begin using it.  Otherwise, you need to create it
yourself:

@example
mysql> CREATE DATABASE menagerie;
@end example

Under Unix, database names are case-sensitive (unlike SQL keywords), so you
must always refer to your database as @code{menagerie}, not as
@code{Menagerie}, @code{MENAGERIE}, or some other variant.  This is also true
for table names.  (Under Windows, this restriction does not apply, although
you must refer to databases and tables using the same lettercase throughout a
given query.)

Creating a database does not select it for use; you must do that explicitly.
To make @code{menagerie} the current database, use this command:

@example
mysql> USE menagerie
Database changed
@end example

Your database needs to be created only once, but you must select it for use
each time you begin a @code{mysql} session.  You can do this by issuing a
@code{USE} statement as shown in the example.  Alternatively, you can select the
database on the command-line when you invoke @code{mysql}.  Just specify its
name after any connection parameters that you might need to provide.  For
example:

@example
shell> mysql -h host -u user -p menagerie
Enter password: ********
@end example

Note that @code{menagerie} is not your password on the command just shown.
If you want to supply your password on the command-line after the @code{-p}
option, you must do so with no intervening space (for example, as
@code{-pmypassword}, not as @code{-p mypassword}).  However, putting your
password on the command-line is not recommended, because doing so exposes it
to snooping by other users logged in on your machine.


@node Creating tables, Loading tables, Creating database, Database use
@subsection Creating a Table

@cindex tables, creating
@cindex creating, tables

Creating the database is the easy part, but at this point it's empty, as
@code{SHOW TABLES} will tell you:

@example
mysql> SHOW TABLES;
Empty set (0.00 sec)
@end example

The harder part is deciding what the structure of your database should be:
what tables you will need and what columns will be in each of them.

You'll want a table that contains a record for each of your pets.  This can
be called the @code{pet} table, and it should contain, as a bare minimum,
each animal's name.  Because the name by itself is not very interesting, the
table should contain other information.  For example, if more than one person
in your family keeps pets, you might want to list each animal's owner.  You
might also want to record some basic descriptive information such as species
and sex.

How about age?  That might be of interest, but it's not a good thing to store
in a database.  Age changes as time passes, which means you'd have to update
your records often.  Instead, it's better to store a fixed value such as
date of birth.  Then, whenever you need age, you can calculate it as the
difference between the current date and the birth date.  MySQL
provides functions for doing date arithmetic, so this is not difficult.
Storing birth date rather than age has other advantages, too:

@itemize @bullet
@item
You can use the database for tasks such as generating reminders for upcoming
pet birthdays.  (If you think this type of query is somewhat silly, note that
it is the same question you might ask in the context of a business database
to identify clients to whom you'll soon need to send out birthday greetings,
for that computer-assisted personal touch.)

@item
You can calculate age in relation to dates other than the current date.  For
example, if you store death date in the database, you can easily calculate
how old a pet was when it died.
@end itemize

You can probably think of other types of information that would be useful in
the @code{pet} table, but the ones identified so far are sufficient for now:
name, owner, species, sex, birth, and death.

Use a @code{CREATE TABLE} statement to specify the layout of your table:

@example
mysql> CREATE TABLE pet (name VARCHAR(20), owner VARCHAR(20),
    -> species VARCHAR(20), sex CHAR(1), birth DATE, death DATE);
@end example

@code{VARCHAR} is a good choice for the @code{name}, @code{owner}, and
@code{species} columns because the column values will vary in length.  The
lengths of those columns need not all be the same, and need not be
@code{20}.  You can pick any length from @code{1} to @code{255}, whatever
seems most reasonable to you.  (If you make a poor choice and it turns
out later that you need a longer field, MySQL provides an
@code{ALTER TABLE} statement.)

Several types of values can be chosen to represent sex in animal records,
such as @code{"m"}
and @code{"f"}, or perhaps @code{"male"} and @code{"female"}.  It's simplest
to use the single characters @code{"m"} and @code{"f"}.

The use of the @code{DATE} datatype for the @code{birth} and @code{death}
columns is a fairly obvious choice.

Now that you have created a table, @code{SHOW TABLES} should produce some
output:

@example
mysql> SHOW TABLES;
+---------------------+
| Tables in menagerie |
+---------------------+
| pet                 |
+---------------------+
@end example

To verify that your table was created the way you expected, use
a @code{DESCRIBE} statement:

@example
mysql> DESCRIBE pet;
+---------+-------------+------+-----+---------+-------+
| Field   | Type        | Null | Key | Default | Extra |
+---------+-------------+------+-----+---------+-------+
| name    | varchar(20) | YES  |     | NULL    |       |
| owner   | varchar(20) | YES  |     | NULL    |       |
| species | varchar(20) | YES  |     | NULL    |       |
| sex     | char(1)     | YES  |     | NULL    |       |
| birth   | date        | YES  |     | NULL    |       |
| death   | date        | YES  |     | NULL    |       |
+---------+-------------+------+-----+---------+-------+
@end example

You can use @code{DESCRIBE} any time, for example, if you forget the names of
the columns in your table or what types they have.


@node Loading tables, Retrieving data, Creating tables, Database use
@subsection Loading Data into a Table

@cindex loading, tables
@cindex tables, loading data
@cindex data, loading into tables

After creating your table, you need to populate it.  The @code{LOAD DATA} and
@code{INSERT} statements are useful for this.

Suppose your pet records can be described as shown here.
(Observe that MySQL expects dates in @code{'YYYY-MM-DD'} format;
this may be different from what you are used to.)

@multitable @columnfractions .10 .10 .10 .05 .20 .20
@item @strong{name} @tab @strong{owner} @tab @strong{species} @tab @strong{sex} @tab @strong{birth} @tab @strong{death}
@item Fluffy @tab Harold @tab cat @tab f @tab 1993-02-04 @tab
@item Claws @tab Gwen @tab cat @tab m @tab 1994-03-17 @tab
@item Buffy @tab Harold @tab dog @tab f @tab 1989-05-13 @tab
@item Fang @tab Benny @tab dog @tab m @tab 1990-08-27 @tab
@item Bowser @tab Diane @tab dog @tab m @tab 1979-08-31 @tab 1995-07-29
@item Chirpy @tab Gwen @tab bird @tab f @tab 1998-09-11 @tab
@item Whistler @tab Gwen @tab bird @tab @tab 1997-12-09 @tab
@item Slim @tab Benny @tab snake @tab m @tab 1996-04-29 @tab
@end multitable

Because you are beginning with an empty table, an easy way to populate it is to
create a text file containing a row for each of your animals, then load the
contents of the file into the table with a single statement.

You could create a text file @file{pet.txt} containing one record per line,
with values separated by tabs, and given in the order in which the columns
were listed in the @code{CREATE TABLE} statement.  For missing values (such
as unknown sexes or death dates for animals that are still living), you can
use @code{NULL} values.  To represent these in your text file, use
@code{\N} (backslash, capital-N).  For example, the record for Whistler the
bird would look like
this (where the whitespace between values is a single tab character):

@multitable @columnfractions .10 .10 .10 .05 .20 .20
@item @strong{name} @tab @strong{owner} @tab @strong{species} @tab @strong{sex} @tab @strong{birth} @tab @strong{death}
@item @code{Whistler} @tab @code{Gwen} @tab @code{bird} @tab @code{\N} @tab @code{1997-12-09} @tab @code{\N}
@end multitable

To load the text file @file{pet.txt} into the @code{pet} table, use this
command:

@example
mysql> LOAD DATA LOCAL INFILE "pet.txt" INTO TABLE pet;
@end example

Note that if you created the file on Windows with an editor that uses
@code{\r\n} as a line terminator, you should use:

@example
mysql> LOAD DATA LOCAL INFILE "pet.txt" INTO TABLE pet
    -> LINES TERMINATED BY '\r\n';
@end example

You can specify the column value separator and end of line marker explicitly
in the @code{LOAD DATA} statement if you wish, but the defaults are tab and
linefeed.  These are sufficient for the statement to read the file
@file{pet.txt} properly.

If the statement fails, it is likely that your MySQL installation does not
have local file capability enabled by default.  See
@ref{LOAD DATA LOCAL, , @code{LOAD DATA LOCAL}} for information on how to
change this.

When you want to add new records one at a time, the @code{INSERT} statement
is useful.  In its simplest form, you supply values for each column, in the
order in which the columns were listed in the @code{CREATE TABLE} statement.
Suppose Diane gets a new hamster named Puffball.  You could add a new record
using an @code{INSERT} statement like this:

@example
mysql> INSERT INTO pet
    -> VALUES ('Puffball','Diane','hamster','f','1999-03-30',NULL);
@end example

Note that string and date values are specified as quoted strings here.  Also,
with @code{INSERT}, you can insert @code{NULL} directly to represent a
missing value.  You do not use @code{\N} like you do with @code{LOAD DATA}.

From this example, you should be able to see that there would be a lot more
typing involved to load
your records initially using several @code{INSERT} statements rather
than a single @code{LOAD DATA} statement.


@node Retrieving data,  , Loading tables, Database use
@subsection Retrieving Information from a Table

@cindex data, retrieving
@cindex tables, retrieving data
@cindex retrieving, data from tables
@cindex unloading, tables

@menu
* Selecting all::               Selecting All Data
* Selecting rows::              Selecting Particular Rows
* Selecting columns::           Selecting Particular Columns
* Sorting rows::                Sorting Rows
* Date calculations::           Date Calculations
* Working with NULL::           Working with @code{NULL} Values
* Pattern matching::            Pattern Matching
* Counting rows::               Counting Rows
* Multiple tables::             Using More Than one Table
@end menu

The @code{SELECT} statement is used to pull information from a table.
The general form of the statement is:

@example
SELECT what_to_select
FROM which_table
WHERE conditions_to_satisfy;
@end example

@code{what_to_select} indicates what you want to see.  This can be a list of
columns, or @code{*} to indicate ``all columns.'' @code{which_table}
indicates the table from which you want to retrieve data.  The @code{WHERE}
clause is optional.  If it's present, @code{conditions_to_satisfy} specifies
conditions that rows must satisfy to qualify for retrieval.


@node Selecting all, Selecting rows, Retrieving data, Retrieving data
@subsubsection Selecting All Data

The simplest form of @code{SELECT} retrieves everything from a table:

@example
mysql> SELECT * FROM pet;
+----------+--------+---------+------+------------+------------+
| name     | owner  | species | sex  | birth      | death      |
+----------+--------+---------+------+------------+------------+
| Fluffy   | Harold | cat     | f    | 1993-02-04 | NULL       |
| Claws    | Gwen   | cat     | m    | 1994-03-17 | NULL       |
| Buffy    | Harold | dog     | f    | 1989-05-13 | NULL       |
| Fang     | Benny  | dog     | m    | 1990-08-27 | NULL       |
| Bowser   | Diane  | dog     | m    | 1979-08-31 | 1995-07-29 |
| Chirpy   | Gwen   | bird    | f    | 1998-09-11 | NULL       |
| Whistler | Gwen   | bird    | NULL | 1997-12-09 | NULL       |
| Slim     | Benny  | snake   | m    | 1996-04-29 | NULL       |
| Puffball | Diane  | hamster | f    | 1999-03-30 | NULL       |
+----------+--------+---------+------+------------+------------+
@end example

This form of @code{SELECT} is useful if you want to review your entire table,
for instance, after you've just loaded it with your initial dataset.  For
example, you may happen to think that the birth date for Bowser doesn't seem
quite right.  Consulting your original pedigree
papers, you find that the correct birth year should be 1989, not 1979.

There are least a couple of ways to fix this:

@itemize @bullet
@item
Edit the file @file{pet.txt} to correct the error, then empty the table
and reload it using @code{DELETE} and @code{LOAD DATA}:

@example
@c I cannot determine what purpose messing with AUTOCOMMIT has in a simple
@c tutorial example like this; I've commented it out -- pd
@c mysql> SET AUTOCOMMIT=1;  # Used for quick re-create of the table
mysql> DELETE FROM pet;
mysql> LOAD DATA LOCAL INFILE "pet.txt" INTO TABLE pet;
@end example

However, if you do this, you must also re-enter the record for Puffball.

@item
Fix only the erroneous record with an @code{UPDATE} statement:

@example
mysql> UPDATE pet SET birth = "1989-08-31" WHERE name = "Bowser";
@end example

The @code{UPDATE} changes only the record in question and does not require you
to reload the table.
@end itemize


@node Selecting rows, Selecting columns, Selecting all, Retrieving data
@subsubsection Selecting Particular Rows

@cindex rows, selecting
@cindex tables, selecting rows

As shown in the preceding section, it is easy to retrieve an entire table.
Just omit the @code{WHERE} clause from the @code{SELECT} statement.
But typically you don't want
to see the entire table, particularly when it becomes large.  Instead,
you're usually more interested in answering a particular question, in which
case you specify some constraints on the information you want.  Let's look at
some selection queries in terms of questions about your pets that they
answer.

You can select only particular rows from your table.  For example, if you want
to verify the change that you made to Bowser's birth date, select Bowser's
record like this:

@example
mysql> SELECT * FROM pet WHERE name = "Bowser";
+--------+-------+---------+------+------------+------------+
| name   | owner | species | sex  | birth      | death      |
+--------+-------+---------+------+------------+------------+
| Bowser | Diane | dog     | m    | 1989-08-31 | 1995-07-29 |
+--------+-------+---------+------+------------+------------+
@end example

The output confirms that the year is correctly recorded now as 1989, not 1979.

String comparisons normally are case-insensitive, so you can specify the
name as @code{"bowser"}, @code{"BOWSER"}, etc.  The query result will be
the same.

You can specify conditions on any column, not just @code{name}.  For example,
if you want to know which animals were born after 1998, test the @code{birth}
column:

@example
mysql> SELECT * FROM pet WHERE birth >= "1998-1-1";
+----------+-------+---------+------+------------+-------+
| name     | owner | species | sex  | birth      | death |
+----------+-------+---------+------+------------+-------+
| Chirpy   | Gwen  | bird    | f    | 1998-09-11 | NULL  |
| Puffball | Diane | hamster | f    | 1999-03-30 | NULL  |
+----------+-------+---------+------+------------+-------+
@end example

You can combine conditions, for example, to locate female dogs:

@example
mysql> SELECT * FROM pet WHERE species = "dog" AND sex = "f";
+-------+--------+---------+------+------------+-------+
| name  | owner  | species | sex  | birth      | death |
+-------+--------+---------+------+------------+-------+
| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |
+-------+--------+---------+------+------------+-------+
@end example

The preceding query uses the @code{AND} logical operator.  There is also an
@code{OR} operator:

@example
mysql> SELECT * FROM pet WHERE species = "snake" OR species = "bird";
+----------+-------+---------+------+------------+-------+
| name     | owner | species | sex  | birth      | death |
+----------+-------+---------+------+------------+-------+
| Chirpy   | Gwen  | bird    | f    | 1998-09-11 | NULL  |
| Whistler | Gwen  | bird    | NULL | 1997-12-09 | NULL  |
| Slim     | Benny | snake   | m    | 1996-04-29 | NULL  |
+----------+-------+---------+------+------------+-------+
@end example

@code{AND} and @code{OR} may be intermixed, though @code{AND} has higher
precedence than @code{OR}.  If you use both operators, it's a good idea
to use parentheses to indicate explicitly how conditions should be grouped:

@example
mysql> SELECT * FROM pet WHERE (species = "cat" AND sex = "m")
    -> OR (species = "dog" AND sex = "f");
+-------+--------+---------+------+------------+-------+
| name  | owner  | species | sex  | birth      | death |
+-------+--------+---------+------+------------+-------+
| Claws | Gwen   | cat     | m    | 1994-03-17 | NULL  |
| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |
+-------+--------+---------+------+------------+-------+
@end example


@node Selecting columns, Sorting rows, Selecting rows, Retrieving data
@subsubsection Selecting Particular Columns

@cindex columns, selecting
@cindex tables, selecting columns

If you don't want to see entire rows from your table, just name the columns
in which you're interested, separated by commas.  For example, if you want to
know when your animals were born, select the @code{name} and @code{birth}
columns:

@example
mysql> SELECT name, birth FROM pet;
+----------+------------+
| name     | birth      |
+----------+------------+
| Fluffy   | 1993-02-04 |
| Claws    | 1994-03-17 |
| Buffy    | 1989-05-13 |
| Fang     | 1990-08-27 |
| Bowser   | 1989-08-31 |
| Chirpy   | 1998-09-11 |
| Whistler | 1997-12-09 |
| Slim     | 1996-04-29 |
| Puffball | 1999-03-30 |
+----------+------------+
@end example

To find out who owns pets, use this query:

@example
mysql> SELECT owner FROM pet;
+--------+
| owner  |
+--------+
| Harold |
| Gwen   |
| Harold |
| Benny  |
| Diane  |
| Gwen   |
| Gwen   |
| Benny  |
| Diane  |
+--------+
@end example

@findex DISTINCT
However, notice that the query simply retrieves the @code{owner} field from
each record, and some of them appear more than once.  To minimise the output,
retrieve each unique output record just once by adding the keyword
@code{DISTINCT}:

@example
mysql> SELECT DISTINCT owner FROM pet;
+--------+
| owner  |
+--------+
| Benny  |
| Diane  |
| Gwen   |
| Harold |
+--------+
@end example

You can use a @code{WHERE} clause to combine row selection with column
selection.  For example, to get birth dates for dogs and cats only,
use this query:

@example
mysql> SELECT name, species, birth FROM pet
    -> WHERE species = "dog" OR species = "cat";
+--------+---------+------------+
| name   | species | birth      |
+--------+---------+------------+
| Fluffy | cat     | 1993-02-04 |
| Claws  | cat     | 1994-03-17 |
| Buffy  | dog     | 1989-05-13 |
| Fang   | dog     | 1990-08-27 |
| Bowser | dog     | 1989-08-31 |
+--------+---------+------------+
@end example


@node Sorting rows, Date calculations, Selecting columns, Retrieving data
@subsubsection Sorting Rows

@cindex rows, sorting
@cindex sorting, table rows
@cindex sorting, data
@cindex tables, sorting rows

You may have noticed in the preceding examples that the result rows are
displayed in no particular order.  It's often easier to examine
query output when the rows are sorted in some meaningful way.  To sort a
result, use an @code{ORDER BY} clause.

Here are animal birthdays, sorted by date:

@example
mysql> SELECT name, birth FROM pet ORDER BY birth;
+----------+------------+
| name     | birth      |
+----------+------------+
| Buffy    | 1989-05-13 |
| Bowser   | 1989-08-31 |
| Fang     | 1990-08-27 |
| Fluffy   | 1993-02-04 |
| Claws    | 1994-03-17 |
| Slim     | 1996-04-29 |
| Whistler | 1997-12-09 |
| Chirpy   | 1998-09-11 |
| Puffball | 1999-03-30 |
+----------+------------+
@end example

On character type columns, sorting---like all other comparison
operations---is normally performed in a case-insensitive fashion.
This means that the order will be undefined for columns that are identical
except for their case. You can force a case-sensitive sort for a column
by using the @code{BINARY} cast: @code{ORDER BY BINARY col_name}.

The default sort order is ascending, with smallest values first.
To sort in reverse (descending) order, add the @code{DESC} keyword to the
name of the column you are sorting by:

@example
mysql> SELECT name, birth FROM pet ORDER BY birth DESC;
+----------+------------+
| name     | birth      |
+----------+------------+
| Puffball | 1999-03-30 |
| Chirpy   | 1998-09-11 |
| Whistler | 1997-12-09 |
| Slim     | 1996-04-29 |
| Claws    | 1994-03-17 |
| Fluffy   | 1993-02-04 |
| Fang     | 1990-08-27 |
| Bowser   | 1989-08-31 |
| Buffy    | 1989-05-13 |
+----------+------------+
@end example

You can sort on multiple columns, and you can sort columns in different
directions.  For example, to sort by type of
animal in ascending order, then by birth date within animal type in descending
order (youngest animals first), use the following query:

@example
mysql> SELECT name, species, birth FROM pet ORDER BY species, birth DESC;
+----------+---------+------------+
| name     | species | birth      |
+----------+---------+------------+
| Chirpy   | bird    | 1998-09-11 |
| Whistler | bird    | 1997-12-09 |
| Claws    | cat     | 1994-03-17 |
| Fluffy   | cat     | 1993-02-04 |
| Fang     | dog     | 1990-08-27 |
| Bowser   | dog     | 1989-08-31 |
| Buffy    | dog     | 1989-05-13 |
| Puffball | hamster | 1999-03-30 |
| Slim     | snake   | 1996-04-29 |
+----------+---------+------------+
@end example

Note that the @code{DESC} keyword applies only to the column name immediately
preceding it (@code{birth}); it does not affect the @code{species} column sort
order.


@node Date calculations, Working with NULL, Sorting rows, Retrieving data
@subsubsection Date Calculations

@cindex date calculations
@cindex calculating, dates
@cindex extracting, dates
@cindex age, calculating

MySQL provides several functions that you can use to perform
calculations on dates, for example, to calculate ages or extract
parts of dates.

To determine how many years old each of your pets is, compute the
difference in the year part of the current date and the birth date, then
subtract one if the current date occurs earlier in the calendar year than
the birth date.  The following query shows, for each pet, the birth date,
the current date, and the age in years.

@example
mysql> SELECT name, birth, CURDATE(),
    -> (YEAR(CURDATE())-YEAR(birth))
    -> - (RIGHT(CURDATE(),5)<RIGHT(birth,5))
    -> AS age
    -> FROM pet;
+----------+------------+------------+------+
| name     | birth      | CURDATE()  | age  |
+----------+------------+------------+------+
| Fluffy   | 1993-02-04 | 2003-08-19 |   10 |
| Claws    | 1994-03-17 | 2003-08-19 |    9 |
| Buffy    | 1989-05-13 | 2003-08-19 |   14 |
| Fang     | 1990-08-27 | 2003-08-19 |   12 |
| Bowser   | 1989-08-31 | 2003-08-19 |   13 |
| Chirpy   | 1998-09-11 | 2003-08-19 |    4 |
| Whistler | 1997-12-09 | 2003-08-19 |    5 |
| Slim     | 1996-04-29 | 2003-08-19 |    7 |
| Puffball | 1999-03-30 | 2003-08-19 |    4 |
+----------+------------+------------+------+
@end example

Here, @code{YEAR()} pulls out the year part of a date and @code{RIGHT()}
pulls off the rightmost five characters that represent the @code{MM-DD}
(calendar year) part of the date.  The part of the expression that
compares the @code{MM-DD} values evaluates to 1 or 0, which adjusts the
year difference down a year if @code{CURDATE()} occurs earlier in
the year than @code{birth}.  The full expression is somewhat ungainly,
so an alias (@code{age}) is used to make the output column label more
meaningful.

The query works, but the result could be scanned more easily if the rows
were presented in some order.  This can be done by adding an @code{ORDER
BY name} clause to sort the output by name:

@example
mysql> SELECT name, birth, CURDATE(),
    -> (YEAR(CURDATE())-YEAR(birth))
    -> - (RIGHT(CURDATE(),5)<RIGHT(birth,5))
    -> AS age
    -> FROM pet ORDER BY name;
+----------+------------+------------+------+
| name     | birth      | CURDATE()  | age  |
+----------+------------+------------+------+
| Bowser   | 1989-08-31 | 2003-08-19 |   13 |
| Buffy    | 1989-05-13 | 2003-08-19 |   14 |
| Chirpy   | 1998-09-11 | 2003-08-19 |    4 |
| Claws    | 1994-03-17 | 2003-08-19 |    9 |
| Fang     | 1990-08-27 | 2003-08-19 |   12 |
| Fluffy   | 1993-02-04 | 2003-08-19 |   10 |
| Puffball | 1999-03-30 | 2003-08-19 |    4 |
| Slim     | 1996-04-29 | 2003-08-19 |    7 |
| Whistler | 1997-12-09 | 2003-08-19 |    5 |
+----------+------------+------------+------+
@end example

To sort the output by @code{age} rather than @code{name}, just use a
different @code{ORDER BY} clause:

@example
mysql> SELECT name, birth, CURDATE(),
    -> (YEAR(CURDATE())-YEAR(birth))
    -> - (RIGHT(CURDATE(),5)<RIGHT(birth,5))
    -> AS age
    -> FROM pet ORDER BY age;
+----------+------------+------------+------+
| name     | birth      | CURDATE()  | age  |
+----------+------------+------------+------+
| Chirpy   | 1998-09-11 | 2003-08-19 |    4 |
| Puffball | 1999-03-30 | 2003-08-19 |    4 |
| Whistler | 1997-12-09 | 2003-08-19 |    5 |
| Slim     | 1996-04-29 | 2003-08-19 |    7 |
| Claws    | 1994-03-17 | 2003-08-19 |    9 |
| Fluffy   | 1993-02-04 | 2003-08-19 |   10 |
| Fang     | 1990-08-27 | 2003-08-19 |   12 |
| Bowser   | 1989-08-31 | 2003-08-19 |   13 |
| Buffy    | 1989-05-13 | 2003-08-19 |   14 |
+----------+------------+------------+------+
@end example

A similar query can be used to determine age at death for animals that have
died.  You determine which animals these are by checking whether the
@code{death} value is @code{NULL}.  Then, for those with non-@code{NULL}
values, compute the difference between the @code{death} and @code{birth}
values:

@example
mysql> SELECT name, birth, death,
    -> (YEAR(death)-YEAR(birth)) - (RIGHT(death,5)<RIGHT(birth,5))
    -> AS age
    -> FROM pet WHERE death IS NOT NULL ORDER BY age;
+--------+------------+------------+------+
| name   | birth      | death      | age  |
+--------+------------+------------+------+
| Bowser | 1989-08-31 | 1995-07-29 |    5 |
+--------+------------+------------+------+
@end example

The query uses @code{death IS NOT NULL} rather than @code{death <> NULL}
because @code{NULL} is a special value that cannot be compared using the usual
comparison operators.  This is discussed later.
@xref{Working with NULL,  , Working with @code{NULL}}.

What if you want to know which animals have birthdays next month?  For this
type of calculation, year and day are irrelevant; you simply want to extract
the month part of the @code{birth} column.  MySQL provides several
date-part extraction functions, such as @code{YEAR()}, @code{MONTH()}, and
@code{DAYOFMONTH()}.  @code{MONTH()} is the appropriate function here.  To
see how it works, run a simple query that displays the value of both
@code{birth} and @code{MONTH(birth)}:

@example
mysql> SELECT name, birth, MONTH(birth) FROM pet;
+----------+------------+--------------+
| name     | birth      | MONTH(birth) |
+----------+------------+--------------+
| Fluffy   | 1993-02-04 |            2 |
| Claws    | 1994-03-17 |            3 |
| Buffy    | 1989-05-13 |            5 |
| Fang     | 1990-08-27 |            8 |
| Bowser   | 1989-08-31 |            8 |
| Chirpy   | 1998-09-11 |            9 |
| Whistler | 1997-12-09 |           12 |
| Slim     | 1996-04-29 |            4 |
| Puffball | 1999-03-30 |            3 |
+----------+------------+--------------+
@end example

Finding animals with birthdays in the upcoming month is easy, too.  Suppose
the current month is April.  Then the month value is @code{4} and you look
for animals born in May (month @code{5}) like this:

@example
mysql> SELECT name, birth FROM pet WHERE MONTH(birth) = 5;
+-------+------------+
| name  | birth      |
+-------+------------+
| Buffy | 1989-05-13 |
+-------+------------+
@end example

There is a small complication if the current month is December.
You don't just add one to the month number (@code{12}) and look for animals
born in month @code{13}, because there is no such month.  Instead, you look for
animals born in January (month @code{1}).

You can even write the query so that it works no matter what the current
month is.  That way you don't have to use a particular month number
in the query.  @code{DATE_ADD()} allows you to add a time interval to a
given date.  If you add a month to the value of @code{CURDATE()}, then extract
the month part with @code{MONTH()}, the result produces the month in which to
look for birthdays:

@example
mysql> SELECT name, birth FROM pet
    -> WHERE MONTH(birth) = MONTH(DATE_ADD(CURDATE(), INTERVAL 1 MONTH));
@end example

A different way to accomplish the same task is to add @code{1} to get the
next month after the current one (after using the modulo function (@code{MOD})
to wrap around the month value to @code{0} if it is currently
@code{12}):

@example
mysql> SELECT name, birth FROM pet
    -> WHERE MONTH(birth) = MOD(MONTH(CURDATE()), 12) + 1;
@end example

Note that @code{MONTH} returns a number between @code{1} and @code{12}. And
@code{MOD(something,12)} returns a number between @code{0} and @code{11}. So the
addition has to be after the @code{MOD()}, otherwise we would go from
November (@code{11}) to January (@code{1}).


@node Working with NULL, Pattern matching, Date calculations, Retrieving data
@subsubsection Working with @code{NULL} Values

@findex NULL
@cindex NULL value

The @code{NULL} value can be surprising until you get used to it.
Conceptually, @code{NULL} means missing value or unknown value and it
is treated somewhat differently than other values.  To test for @code{NULL},
you cannot use the arithmetic comparison operators such as @code{=}, @code{<},
or @code{<>}.  To demonstrate this for yourself, try the following query:

@example
mysql> SELECT 1 = NULL, 1 <> NULL, 1 < NULL, 1 > NULL;
+----------+-----------+----------+----------+
| 1 = NULL | 1 <> NULL | 1 < NULL | 1 > NULL |
+----------+-----------+----------+----------+
|     NULL |      NULL |     NULL |     NULL |
+----------+-----------+----------+----------+
@end example

Clearly you get no meaningful results from these comparisons.  Use
the @code{IS NULL} and @code{IS NOT NULL} operators instead:

@example
mysql> SELECT 1 IS NULL, 1 IS NOT NULL;
+-----------+---------------+
| 1 IS NULL | 1 IS NOT NULL |
+-----------+---------------+
|         0 |             1 |
+-----------+---------------+
@end example

Note that in MySQL, @code{0} or @code{NULL} means false and anything else means
true. The default truth value from a boolean operation is @code{1}.

This special treatment of @code{NULL} is why, in the previous section, it
was necessary to determine which animals are no longer alive using
@code{death IS NOT NULL} instead of @code{death <> NULL}.

Two @code{NULL} values are regarded as equal in a @code{GROUP BY}.

When doing an @code{ORDER BY}, @code{NULL} values are presented first if you
do @code{ORDER BY ... ASC} and last if you do @code{ORDER BY ... DESC}.

Note that MySQL 4.0.2 to 4.0.10 incorrectly always sorts @code{NULL} values
first regardless of the sort direction.


@node Pattern matching, Counting rows, Working with NULL, Retrieving data
@subsubsection Pattern Matching

@cindex pattern matching
@cindex matching, patterns
@cindex expressions, extended

MySQL provides standard SQL pattern matching as well as a form of
pattern matching based on extended regular expressions similar to those used
by Unix utilities such as @code{vi}, @code{grep}, and @code{sed}.

SQL pattern matching allows you to use @samp{_} to match any single
character and @samp{%} to match an arbitrary number of characters (including
zero characters).  In MySQL, SQL patterns are case-insensitive by
default.  Some examples are shown here.  Note that you do not use @code{=}
or @code{<>} when you use SQL patterns; use the @code{LIKE} or @code{NOT
LIKE} comparison operators instead.

To find names beginning with @samp{b}:

@example
mysql> SELECT * FROM pet WHERE name LIKE "b%";
+--------+--------+---------+------+------------+------------+
| name   | owner  | species | sex  | birth      | death      |
+--------+--------+---------+------+------------+------------+
| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL       |
| Bowser | Diane  | dog     | m    | 1989-08-31 | 1995-07-29 |
+--------+--------+---------+------+------------+------------+
@end example

To find names ending with @samp{fy}:

@example
mysql> SELECT * FROM pet WHERE name LIKE "%fy";
+--------+--------+---------+------+------------+-------+
| name   | owner  | species | sex  | birth      | death |
+--------+--------+---------+------+------------+-------+
| Fluffy | Harold | cat     | f    | 1993-02-04 | NULL  |
| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL  |
+--------+--------+---------+------+------------+-------+
@end example

To find names containing a @samp{w}:

@example
mysql> SELECT * FROM pet WHERE name LIKE "%w%";
+----------+-------+---------+------+------------+------------+
| name     | owner | species | sex  | birth      | death      |
+----------+-------+---------+------+------------+------------+
| Claws    | Gwen  | cat     | m    | 1994-03-17 | NULL       |
| Bowser   | Diane | dog     | m    | 1989-08-31 | 1995-07-29 |
| Whistler | Gwen  | bird    | NULL | 1997-12-09 | NULL       |
+----------+-------+---------+------+------------+------------+
@end example

To find names containing exactly five characters, use fives instances of
the @samp{_} pattern character:

@example
mysql> SELECT * FROM pet WHERE name LIKE "_____";
+-------+--------+---------+------+------------+-------+
| name  | owner  | species | sex  | birth      | death |
+-------+--------+---------+------+------------+-------+
| Claws | Gwen   | cat     | m    | 1994-03-17 | NULL  |
| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |
+-------+--------+---------+------+------------+-------+
@end example

The other type of pattern matching provided by MySQL uses extended
regular expressions.  When you test for a match for this type of pattern, use
the @code{REGEXP} and @code{NOT REGEXP} operators (or @code{RLIKE} and
@code{NOT RLIKE}, which are synonyms).

Some characteristics of extended regular expressions are:

@itemize @bullet
@item
@samp{.} matches any single character.

@item
A character class @samp{[...]} matches any character within the brackets.
For example, @samp{[abc]} matches @samp{a}, @samp{b}, or @samp{c}.  To name a
range of characters, use a dash.  @samp{[a-z]} matches any letter,
whereas @samp{[0-9]} matches any digit.

@item
@samp{*} matches zero or more instances of the thing preceding it.  For
example, @samp{x*} matches any number of @samp{x} characters,
@samp{[0-9]*} matches any number of digits, and @samp{.*} matches any
number of anything.

@item
A @code{REGEXP} pattern match succeed if
the pattern matches anywhere in the value being tested.
(This differs from a @code{LIKE} pattern match, which succeeds only if the
pattern matches the entire value.)

@item
To anchor a pattern so that it must match the beginning or end of the value
being tested, use @samp{^} at the beginning or @samp{$} at the end of the
pattern.
@end itemize

To demonstrate how extended regular expressions work, the @code{LIKE} queries
shown previously are rewritten here to use @code{REGEXP}.

To find names beginning with @samp{b}, use @samp{^} to match the beginning of
the name:

@example
mysql> SELECT * FROM pet WHERE name REGEXP "^b";
+--------+--------+---------+------+------------+------------+
| name   | owner  | species | sex  | birth      | death      |
+--------+--------+---------+------+------------+------------+
| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL       |
| Bowser | Diane  | dog     | m    | 1989-08-31 | 1995-07-29 |
+--------+--------+---------+------+------------+------------+
@end example

Prior to MySQL Version 3.23.4, @code{REGEXP} is case-sensitive,
and the previous query will return no rows. In this case, to match either
lowercase or uppercase @samp{b}, use this query instead:

@example
mysql> SELECT * FROM pet WHERE name REGEXP "^[bB]";
@end example

From MySQL 3.23.4 on, if you really want to force a @code{REGEXP} comparison to
be case-sensitive, use the @code{BINARY} keyword to make one of the
strings a binary string. This query will match only lowercase @samp{b}
at the beginning of a name:

@example
mysql> SELECT * FROM pet WHERE name REGEXP BINARY "^b";
@end example

To find names ending with @samp{fy}, use @samp{$} to match the end of the
name:

@example
mysql> SELECT * FROM pet WHERE name REGEXP "fy$";
+--------+--------+---------+------+------------+-------+
| name   | owner  | species | sex  | birth      | death |
+--------+--------+---------+------+------------+-------+
| Fluffy | Harold | cat     | f    | 1993-02-04 | NULL  |
| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL  |
+--------+--------+---------+------+------------+-------+
@end example

To find names containing a @samp{w}, use this query:

@example
mysql> SELECT * FROM pet WHERE name REGEXP "w";
+----------+-------+---------+------+------------+------------+
| name     | owner | species | sex  | birth      | death      |
+----------+-------+---------+------+------------+------------+
| Claws    | Gwen  | cat     | m    | 1994-03-17 | NULL       |
| Bowser   | Diane | dog     | m    | 1989-08-31 | 1995-07-29 |
| Whistler | Gwen  | bird    | NULL | 1997-12-09 | NULL       |
+----------+-------+---------+------+------------+------------+
@end example

Because a regular expression pattern matches if it occurs anywhere in the
value, it is not necessary in the previous query to put a wildcard on either
side of the pattern to get it to match the entire value like it would be if
you used an SQL pattern.

To find names containing exactly five characters, use @samp{^} and @samp{$}
to match the beginning and end of the name, and five instances of @samp{.}
in between:

@example
mysql> SELECT * FROM pet WHERE name REGEXP "^.....$";
+-------+--------+---------+------+------------+-------+
| name  | owner  | species | sex  | birth      | death |
+-------+--------+---------+------+------------+-------+
| Claws | Gwen   | cat     | m    | 1994-03-17 | NULL  |
| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |
+-------+--------+---------+------+------------+-------+
@end example

You could also write the previous query using the @samp{@{n@}}
``repeat-@code{n}-times'' operator:

@example
mysql> SELECT * FROM pet WHERE name REGEXP "^.@{5@}$";
+-------+--------+---------+------+------------+-------+
| name  | owner  | species | sex  | birth      | death |
+-------+--------+---------+------+------------+-------+
| Claws | Gwen   | cat     | m    | 1994-03-17 | NULL  |
| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |
+-------+--------+---------+------+------------+-------+
@end example


@node Counting rows, Multiple tables, Pattern matching, Retrieving data
@subsubsection Counting Rows

@cindex rows, counting
@cindex tables, counting rows
@cindex counting, table rows

Databases are often used to answer the question, ``How often does a certain
type of data occur in a table?''  For example, you might want to know how
many pets you have, or how many pets each owner has, or you might want to
perform various kinds of census operations on your animals.

Counting the total number of animals you have is the same question as ``How
many rows are in the @code{pet} table?'' because there is one record per pet.
@code{COUNT(*)} counts the number of rows, so
the query to count your animals looks like this:

@example
mysql> SELECT COUNT(*) FROM pet;
+----------+
| COUNT(*) |
+----------+
|        9 |
+----------+
@end example

Earlier, you retrieved the names of the people who owned pets.  You can
use @code{COUNT()} if you want to find out how many pets each owner has:

@example
mysql> SELECT owner, COUNT(*) FROM pet GROUP BY owner;
+--------+----------+
| owner  | COUNT(*) |
+--------+----------+
| Benny  |        2 |
| Diane  |        2 |
| Gwen   |        3 |
| Harold |        2 |
+--------+----------+
@end example

Note the use of @code{GROUP BY} to group together all records for each
@code{owner}.  Without it, all you get is an error message:

@example
mysql> SELECT owner, COUNT(*) FROM pet;
ERROR 1140: Mixing of GROUP columns (MIN(),MAX(),COUNT()...)
with no GROUP columns is illegal if there is no GROUP BY clause
@end example

@code{COUNT()} and @code{GROUP BY} are useful for characterising your
data in various ways.  The following examples show different ways to
perform animal census operations.

Number of animals per species:

@example
mysql> SELECT species, COUNT(*) FROM pet GROUP BY species;
+---------+----------+
| species | COUNT(*) |
+---------+----------+
| bird    |        2 |
| cat     |        2 |
| dog     |        3 |
| hamster |        1 |
| snake   |        1 |
+---------+----------+
@end example

Number of animals per sex:

@example
mysql> SELECT sex, COUNT(*) FROM pet GROUP BY sex;
+------+----------+
| sex  | COUNT(*) |
+------+----------+
| NULL |        1 |
| f    |        4 |
| m    |        4 |
+------+----------+
@end example

(In this output, @code{NULL} indicates that the sex is unknown.)

Number of animals per combination of species and sex:

@example
mysql> SELECT species, sex, COUNT(*) FROM pet GROUP BY species, sex;
+---------+------+----------+
| species | sex  | COUNT(*) |
+---------+------+----------+
| bird    | NULL |        1 |
| bird    | f    |        1 |
| cat     | f    |        1 |
| cat     | m    |        1 |
| dog     | f    |        1 |
| dog     | m    |        2 |
| hamster | f    |        1 |
| snake   | m    |        1 |
+---------+------+----------+
@end example

You need not retrieve an entire table when you use @code{COUNT()}.  For
example, the previous query, when performed just on dogs and cats, looks like
this:

@example
mysql> SELECT species, sex, COUNT(*) FROM pet
    -> WHERE species = "dog" OR species = "cat"
    -> GROUP BY species, sex;
+---------+------+----------+
| species | sex  | COUNT(*) |
+---------+------+----------+
| cat     | f    |        1 |
| cat     | m    |        1 |
| dog     | f    |        1 |
| dog     | m    |        2 |
+---------+------+----------+
@end example

Or, if you wanted the number of animals per sex only for known-sex animals:

@example
mysql> SELECT species, sex, COUNT(*) FROM pet
    -> WHERE sex IS NOT NULL
    -> GROUP BY species, sex;
+---------+------+----------+
| species | sex  | COUNT(*) |
+---------+------+----------+
| bird    | f    |        1 |
| cat     | f    |        1 |
| cat     | m    |        1 |
| dog     | f    |        1 |
| dog     | m    |        2 |
| hamster | f    |        1 |
| snake   | m    |        1 |
+---------+------+----------+
@end example


@node Multiple tables,  , Counting rows, Retrieving data
@subsubsection Using More Than one Table

@cindex tables, multiple

The @code{pet} table keeps track of which pets you have.  If you want to
record other information about them, such as events in their lives like
visits to the vet or when litters are born, you need another table.  What
should this table look like? It needs:

@itemize @bullet
@item
To contain the pet name so you know which animal each event pertains
to.

@item
A date so you know when the event occurred.

@item
A field to describe the event.

@item
An event type field, if you want to be able to categorise events.
@end itemize

Given these considerations, the @code{CREATE TABLE} statement for the
@code{event} table might look like this:

@example
mysql> CREATE TABLE event (name VARCHAR(20), date DATE,
    -> type VARCHAR(15), remark VARCHAR(255));
@end example

As with the @code{pet} table, it's easiest to load the initial records
by creating a tab-delimited text file containing the information:

@multitable @columnfractions .15 .15 .15 .35
@item @strong{name} @tab @strong{date} @tab @strong{type} @tab @strong{remark}
@item Fluffy @tab 1995-05-15 @tab litter @tab 4 kittens, 3 female, 1 male
@item Buffy @tab 1993-06-23 @tab litter @tab 5 puppies, 2 female, 3 male
@item Buffy @tab 1994-06-19 @tab litter @tab 3 puppies, 3 female
@item Chirpy @tab 1999-03-21 @tab vet @tab needed beak straightened
@item Slim @tab 1997-08-03 @tab vet @tab broken rib
@item Bowser @tab 1991-10-12 @tab kennel @tab
@item Fang @tab 1991-10-12 @tab kennel @tab
@item Fang @tab 1998-08-28 @tab birthday @tab Gave him a new chew toy
@item Claws @tab 1998-03-17 @tab birthday @tab Gave him a new flea collar
@item Whistler @tab 1998-12-09 @tab birthday @tab First birthday
@end multitable

Load the records like this:

@example
mysql> LOAD DATA LOCAL INFILE "event.txt" INTO TABLE event;
@end example

Based on what you've learned from the queries you've run on the @code{pet}
table, you should be able to perform retrievals on the records in the
@code{event} table; the principles are the same.  But when is the
@code{event} table by itself insufficient to answer questions you might ask?

Suppose you want to find out the ages at which each pet had its
litters. We saw earlier how to calculate ages from two dates.
The litter date of the mother is in the
@code{event} table, but to calculate her age on that date you need her
birth date, which is stored in the @code{pet} table.
This means the query requires both tables:

@example
mysql> SELECT pet.name,
    -> (YEAR(date)-YEAR(birth)) - (RIGHT(date,5)<RIGHT(birth,5)) AS age,
    -> remark
    -> FROM pet, event
    -> WHERE pet.name = event.name AND type = "litter";
+--------+------+-----------------------------+
| name   | age  | remark                      |
+--------+------+-----------------------------+
| Fluffy |    2 | 4 kittens, 3 female, 1 male |
| Buffy  |    4 | 5 puppies, 2 female, 3 male |
| Buffy  |    5 | 3 puppies, 3 female         |
+--------+------+-----------------------------+
@end example

There are several things to note about this query:

@itemize @bullet
@item
The @code{FROM} clause lists two tables because the query needs to pull
information from both of them.

@item
When combining (joining) information from multiple tables, you need to
specify how records in one table can be matched to records in the other.
This is easy because they both have a @code{name} column.  The query uses
@code{WHERE} clause to match up records in the two tables based on the
@code{name} values.

@item
Because the @code{name} column occurs in both tables, you must be specific
about which table you mean when referring to the column.  This is done
by prepending the table name to the column name.
@end itemize

You need not have two different tables to perform a join.  Sometimes it is
useful to join a table to itself, if you want to compare records in a table
to other records in that same table.  For example, to find breeding pairs
among your pets, you can join the @code{pet} table with itself to produce
candidate pairs of males and females of like species:

@example
mysql> SELECT p1.name, p1.sex, p2.name, p2.sex, p1.species
    -> FROM pet AS p1, pet AS p2
    -> WHERE p1.species = p2.species AND p1.sex = "f" AND p2.sex = "m";
+--------+------+--------+------+---------+
| name   | sex  | name   | sex  | species |
+--------+------+--------+------+---------+
| Fluffy | f    | Claws  | m    | cat     |
| Buffy  | f    | Fang   | m    | dog     |
| Buffy  | f    | Bowser | m    | dog     |
+--------+------+--------+------+---------+
@end example

In this query, we specify aliases for the table name in order
to refer to the columns and keep straight which instance of the table
each column reference is associated with.


@node Getting information, Batch mode, Database use, Tutorial
@section Getting Information About Databases and Tables

@cindex databases, information about
@cindex tables, information about
@findex DESCRIBE

What if you forget the name of a database or table, or what the structure of
a given table is (for example, what its columns are called)?  MySQL
addresses this problem through several statements that provide information
about the databases and tables it supports.

You have already seen @code{SHOW DATABASES}, which lists the databases
managed by the server.  To find out which database is currently selected,
use the @code{DATABASE()} function:

@example
mysql> SELECT DATABASE();
+------------+
| DATABASE() |
+------------+
| menagerie  |
+------------+
@end example

If you haven't selected any database yet, the result is @code{NULL}
(or the empty string before MySQL 4.1.1).

To find out what tables the current database contains (for example, when
you're not sure about the name of a table), use this command:

@example
mysql> SHOW TABLES;
+---------------------+
| Tables in menagerie |
+---------------------+
| event               |
| pet                 |
+---------------------+
@end example

If you want to find out about the structure of a table, the @code{DESCRIBE}
command is useful; it displays information about each of a table's columns:

@example
mysql> DESCRIBE pet;
+---------+-------------+------+-----+---------+-------+
| Field   | Type        | Null | Key | Default | Extra |
+---------+-------------+------+-----+---------+-------+
| name    | varchar(20) | YES  |     | NULL    |       |
| owner   | varchar(20) | YES  |     | NULL    |       |
| species | varchar(20) | YES  |     | NULL    |       |
| sex     | char(1)     | YES  |     | NULL    |       |
| birth   | date        | YES  |     | NULL    |       |
| death   | date        | YES  |     | NULL    |       |
+---------+-------------+------+-----+---------+-------+
@end example

@code{Field} indicates the column name, @code{Type} is the datatype for
the column, @code{NULL} indicates whether the column can contain
@code{NULL} values, @code{Key} indicates whether the column is
indexed, and @code{Default} specifies the column's default value.

If you have indexes on a table,
@code{SHOW INDEX FROM tbl_name} produces information about them.


@node Batch mode, Examples, Getting information, Tutorial
@section Using @code{mysql} in Batch Mode

@cindex modes, batch
@cindex batch mode
@cindex running, batch mode
@cindex script files
@cindex files, script

In the previous sections, you used @code{mysql} interactively to enter
queries and view the results.  You can also run @code{mysql} in batch
mode.  To do this, put the commands you want to run in a file, then
tell @code{mysql} to read its input from the file:

@example
shell> mysql < batch-file
@end example

If you are running @code{mysql} under Windows and have some special
characters in the file that cause problems, you can do this:

@example
dos> mysql -e "source batch-file"
@end example

If you need to specify connection parameters on the command line, the
command might look like this:

@example
shell> mysql -h host -u user -p < batch-file
Enter password: ********
@end example

When you use @code{mysql} this way, you are creating a script file, then
executing the script.

If you want the script to continue even if some of the statements in it
produce errors, you should
use the @code{--force} command-line option.

Why use a script?  Here are a few reasons:

@itemize @bullet
@item
If you run a query repeatedly (say, every day or every week), making it a
script allows you to avoid retyping it each time you execute it.

@item
You can generate new queries from existing ones that are similar by copying
and editing script files.

@item
Batch mode can also be useful while you're developing a query, particularly
for multiple-line commands or multiple-statement sequences of commands.  If
you make a mistake, you don't have to retype everything.  Just edit your
script to correct the error, then tell @code{mysql} to execute it again.

@item
If you have a query that produces a lot of output, you can run the output
through a pager rather than watching it scroll off the top of your screen:

@example
shell> mysql < batch-file | more
@end example

@item
You can catch the output in a file for further processing:

@example
shell> mysql < batch-file > mysql.out
@end example

@item
You can distribute your script to other people so they can run the commands,
too.

@item
Some situations do not allow for interactive use, for example, when you run
a query from a @code{cron} job.  In this case, you must use batch mode.
@end itemize

The default output format is different (more concise) when you run
@code{mysql} in batch mode than when you use it interactively.  For
example, the output of @code{SELECT DISTINCT species FROM pet} looks like
this when @code{mysql} is run interactively:

@example
+---------+
| species |
+---------+
| bird    |
| cat     |
| dog     |
| hamster |
| snake   |
+---------+
@end example

In batch mode, the output looks like this instead:

@example
species
bird
cat
dog
hamster
snake
@end example

If you want to get the interactive output format in batch mode, use
@code{mysql -t}.  To echo to the output the commands that are executed, use
@code{mysql -vvv}.

You can also use scripts from the @code{mysql} prompt by
using the @code{source} command:

@example
mysql> source filename;
@end example


@node Examples, Twin, Batch mode, Tutorial
@section Examples of Common Queries

@cindex queries, examples
@cindex examples, queries

Here are examples of how to solve some common problems with
MySQL.

Some of the examples use the table @code{shop} to hold the price of each
article (item number) for certain traders (dealers).  Supposing that each
trader has a single fixed price per article, then (@code{article},
@code{dealer}) is a primary key for the records.

Start the command-line tool @code{mysql} and select a database:

@example
shell> mysql your-database-name
@end example

(In most MySQL installations, you can use the database name @code{test}).

You can create and populate the example table with these statements:

@example
mysql> CREATE TABLE shop (
    -> article INT(4) UNSIGNED ZEROFILL DEFAULT '0000' NOT NULL,
    -> dealer  CHAR(20)                 DEFAULT ''     NOT NULL,
    -> price   DOUBLE(16,2)             DEFAULT '0.00' NOT NULL,
    -> PRIMARY KEY(article, dealer));
mysql> INSERT INTO shop VALUES
    -> (1,'A',3.45),(1,'B',3.99),(2,'A',10.99),(3,'B',1.45),(3,'C',1.69),
    -> (3,'D',1.25),(4,'D',19.95);
@end example

After issuing the statements, the table should have the following contents:

@example
mysql> SELECT * FROM shop;
+---------+--------+-------+
| article | dealer | price |
+---------+--------+-------+
|    0001 | A      |  3.45 |
|    0001 | B      |  3.99 |
|    0002 | A      | 10.99 |
|    0003 | B      |  1.45 |
|    0003 | C      |  1.69 |
|    0003 | D      |  1.25 |
|    0004 | D      | 19.95 |
+---------+--------+-------+
@end example

@menu
* example-Maximum-column::      The Maximum Value for a Column
* example-Maximum-row::         The Row Holding the Maximum of a Certain Column
* example-Maximum-column-group::  Maximum of Column per Group
* example-Maximum-column-group-row::  The Rows Holding the Group-wise Maximum of a Certain Field
* example-user-variables::      Using User Variables
* example-Foreign keys::        Using Foreign Keys
* Searching on two keys::       Searching on Two Keys
* Calculating days::            Calculating Visits Per Day
* example-AUTO_INCREMENT::      Using @code{AUTO_INCREMENT}
@end menu


@node example-Maximum-column, example-Maximum-row, Examples, Examples
@subsection The Maximum Value for a Column

``What's the highest item number?''

@example
SELECT MAX(article) AS article FROM shop;

+---------+
| article |
+---------+
|       4 |
+---------+
@end example


@node example-Maximum-row, example-Maximum-column-group, example-Maximum-column, Examples
@subsection The Row Holding the Maximum of a Certain Column

``Find number, dealer, and price of the most expensive article.''

In SQL-99 (and MySQL Version 4.1) this is easily done with a subquery:

@example
SELECT article, dealer, price
FROM   shop
WHERE  price=(SELECT MAX(price) FROM shop);
@end example

In MySQL versions prior to 4.1, just do it in two steps:

@enumerate
@item
Get the maximum price value from the table with a @code{SELECT} statement.
@example
mysql> SELECT MAX(price) FROM shop;
+------------+
| MAX(price) |
+------------+
|      19.95 |
+------------+
@end example
@item
Using the value 19.95 shown by the previous query to be the maximum
article price, write a query to locate and display the corresponding record:
@example
mysql> SELECT article, dealer, price
    -> FROM   shop
    -> WHERE  price=19.95;
+---------+--------+-------+
| article | dealer | price |
+---------+--------+-------+
|    0004 | D      | 19.95 |
+---------+--------+-------+
@end example
@end enumerate

Another solution is to sort all rows descending by price and only
get the first row using the MySQL-specific @code{LIMIT} clause:

@example
SELECT article, dealer, price
FROM   shop
ORDER BY price DESC
LIMIT 1;
@end example

@strong{NOTE}:  If there were several most expensive articles, each with a
price of 19.95, the @code{LIMIT} solution would show only one of them!


@node example-Maximum-column-group, example-Maximum-column-group-row, example-Maximum-row, Examples
@subsection Maximum of Column per Group

``What's the highest price per article?''

@example
SELECT article, MAX(price) AS price
FROM   shop
GROUP BY article

+---------+-------+
| article | price |
+---------+-------+
|    0001 |  3.99 |
|    0002 | 10.99 |
|    0003 |  1.69 |
|    0004 | 19.95 |
+---------+-------+
@end example


@node example-Maximum-column-group-row, example-user-variables, example-Maximum-column-group, Examples
@subsection The Rows Holding the Group-wise Maximum of a Certain Field

``For each article, find the dealer or dealers with the most expensive price.''

In SQL-99 (and MySQL Version 4.1 or greater), the problem can be solved
with a subquery like this:

@example
SELECT article, dealer, price
FROM   shop s1
WHERE  price=(SELECT MAX(s2.price)
              FROM shop s2
              WHERE s1.article = s2.article);
@end example

In MySQL versions prior to 4.1, it's best do it in several steps:

@enumerate
@item
Get the list of (article,maxprice) pairs.
@item
For each article, get the corresponding rows that have the stored maximum
price.
@end enumerate

This can easily be done with a temporary table and a join:

@example
CREATE TEMPORARY TABLE tmp (
        article INT(4) UNSIGNED ZEROFILL DEFAULT '0000' NOT NULL,
        price   DOUBLE(16,2)             DEFAULT '0.00' NOT NULL);

LOCK TABLES shop READ;

INSERT INTO tmp SELECT article, MAX(price) FROM shop GROUP BY article;

SELECT shop.article, dealer, shop.price FROM shop, tmp
WHERE shop.article=tmp.article AND shop.price=tmp.price;

UNLOCK TABLES;

DROP TABLE tmp;
@end example

If you don't use a @code{TEMPORARY} table, you must also lock the @code{tmp}
table.

``Can it be done with a single query?''

Yes, but only by using a quite inefficient trick called the
``MAX-CONCAT trick'':

@example
SELECT article,
       SUBSTRING( MAX( CONCAT(LPAD(price,6,'0'),dealer) ), 7) AS dealer,
  0.00+LEFT(      MAX( CONCAT(LPAD(price,6,'0'),dealer) ), 6) AS price
FROM   shop
GROUP BY article;

+---------+--------+-------+
| article | dealer | price |
+---------+--------+-------+
|    0001 | B      |  3.99 |
|    0002 | A      | 10.99 |
|    0003 | C      |  1.69 |
|    0004 | D      | 19.95 |
+---------+--------+-------+
@end example

The last example can be made a bit more efficient by doing the
splitting of the concatenated column in the client.


@node example-user-variables, example-Foreign keys, example-Maximum-column-group-row, Examples
@subsection Using User Variables

You can use MySQL user variables to remember results without
having to store them in temporary variables in the client.
@xref{Variables}.

For example, to find the articles with the highest and lowest price you
can do this:

@example
mysql> SELECT @@min_price:=MIN(price),@@max_price:=MAX(price) FROM shop;
mysql> SELECT * FROM shop WHERE price=@@min_price OR price=@@max_price;
+---------+--------+-------+
| article | dealer | price |
+---------+--------+-------+
|    0003 | D      |  1.25 |
|    0004 | D      | 19.95 |
+---------+--------+-------+
@end example


@node example-Foreign keys, Searching on two keys, example-user-variables, Examples
@subsection Using Foreign Keys

@cindex foreign keys
@cindex keys, foreign

In MySQL 3.23.44 and up, @code{InnoDB} tables support checking of
foreign key constraints. @xref{InnoDB, , @code{InnoDB}}.
See also @ref{ANSI diff Foreign Keys}.

You don't actually need foreign keys to join two tables.
For table types other than @code{InnoDB}),
the only things MySQL currently doesn't do are 1)
@code{CHECK} to make sure that the keys you use
really exist in the table or tables you're referencing and 2)
automatically delete rows from a table with a foreign key
definition. Using your keys to join tables will work just fine:

@example
CREATE TABLE person (
    id SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,
    name CHAR(60) NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE shirt (
    id SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,
    style ENUM('t-shirt', 'polo', 'dress') NOT NULL,
    color ENUM('red', 'blue', 'orange', 'white', 'black') NOT NULL,
    owner SMALLINT UNSIGNED NOT NULL REFERENCES person(id),
    PRIMARY KEY (id)
);


INSERT INTO person VALUES (NULL, 'Antonio Paz');

INSERT INTO shirt VALUES
(NULL, 'polo', 'blue', LAST_INSERT_ID()),
(NULL, 'dress', 'white', LAST_INSERT_ID()),
(NULL, 't-shirt', 'blue', LAST_INSERT_ID());


INSERT INTO person VALUES (NULL, 'Lilliana Angelovska');

INSERT INTO shirt VALUES
(NULL, 'dress', 'orange', LAST_INSERT_ID()),
(NULL, 'polo', 'red', LAST_INSERT_ID()),
(NULL, 'dress', 'blue', LAST_INSERT_ID()),
(NULL, 't-shirt', 'white', LAST_INSERT_ID());


SELECT * FROM person;
+----+---------------------+
| id | name                |
+----+---------------------+
|  1 | Antonio Paz         |
|  2 | Lilliana Angelovska |
+----+---------------------+

SELECT * FROM shirt;
+----+---------+--------+-------+
| id | style   | color  | owner |
+----+---------+--------+-------+
|  1 | polo    | blue   |     1 |
|  2 | dress   | white  |     1 |
|  3 | t-shirt | blue   |     1 |
|  4 | dress   | orange |     2 |
|  5 | polo    | red    |     2 |
|  6 | dress   | blue   |     2 |
|  7 | t-shirt | white  |     2 |
+----+---------+--------+-------+


SELECT s.* FROM person p, shirt s
 WHERE p.name LIKE 'Lilliana%'
   AND s.owner = p.id
   AND s.color <> 'white';

+----+-------+--------+-------+
| id | style | color  | owner |
+----+-------+--------+-------+
|  4 | dress | orange |     2 |
|  5 | polo  | red    |     2 |
|  6 | dress | blue   |     2 |
+----+-------+--------+-------+
@end example


@node Searching on two keys, Calculating days, example-Foreign keys, Examples
@subsection Searching on Two Keys

@findex UNION
@cindex searching, two keys
@cindex keys, searching on two

MySQL doesn't yet optimize when you search on two different
keys combined with @code{OR} (searching on one key with different @code{OR}
parts is optimized quite well):

@example
SELECT field1_index, field2_index FROM test_table
WHERE field1_index = '1' OR  field2_index = '1'
@end example

The reason is that we haven't yet had time to come up with an efficient
way to handle this in the general case. (The @code{AND} handling is,
in comparison, now completely general and works very well.)

In MySQL 4.0 and up, you can solve this problem efficiently by using a
@code{UNION} that combines the output of two separate @code{SELECT}
statements.
@xref{UNION}.
Each @code{SELECT} searches only one key and can be optimized:

@example
SELECT field1_index, field2_index FROM test_table WHERE field1_index = '1'
UNION
SELECT field1_index, field2_index FROM test_table WHERE field2_index = '1';
@end example

Prior to MySQL 4.0, you can achieve the same effect by using a
@code{TEMPORARY} table and separate @code{SELECT} statements.
This type of optimization is also very good if
you are using very complicated queries where the SQL server does the
optimizations in the wrong order.

@example
CREATE TEMPORARY TABLE tmp
SELECT field1_index, field2_index FROM test_table WHERE field1_index = '1';
INSERT INTO tmp
SELECT field1_index, field2_index FROM test_table WHERE field2_index = '1';
SELECT * from tmp;
DROP TABLE tmp;
@end example

The above way to solve this query is in effect a @code{UNION} of two queries.

@node Calculating days, example-AUTO_INCREMENT, Searching on two keys, Examples
@subsection Calculating Visits Per Day

@findex BIT_OR
@findex BIT_COUNT
@findex <<
@cindex bit_functions, example

The following example shows how you can use the bit group functions
to calculate the number of days per month a user has visited a web page.

@example
CREATE TABLE t1 (year YEAR(4), month INT(2) UNSIGNED ZEROFILL,
             day INT(2) UNSIGNED ZEROFILL);
INSERT INTO t1 VALUES(2000,1,1),(2000,1,20),(2000,1,30),(2000,2,2),
            (2000,2,23),(2000,2,23);
@end example

The example table contains year-month-day values representing visits by users
to the page. To determine how many different days in each month these visits
occur, use this query:

@example
SELECT year,month,BIT_COUNT(BIT_OR(1<<day)) AS days FROM t1
       GROUP BY year,month;
@end example

Which returns:

@example
+------+-------+------+
| year | month | days |
+------+-------+------+
| 2000 |    01 |    3 |
| 2000 |    02 |    2 |
+------+-------+------+
@end example

The query calculates how many different days appear in the table for each
year/month combination, with automatic removal of duplicate entries.


@node example-AUTO_INCREMENT,  , Calculating days, Examples
@subsection Using @code{AUTO_INCREMENT}

@c help_category Column Types

@cindex AUTO_INCREMENT
@c description_for_help_topic AUTO_INCREMENT   SERIAL DEFAULT VALUE
The @code{AUTO_INCREMENT} attribute can be used to generate a unique
identity for new rows:
@c end_description_for_help_topic

@c example_for_help_topic AUTO_INCREMENT
@example
CREATE TABLE animals (
             id MEDIUMINT NOT NULL AUTO_INCREMENT,
             name CHAR(30) NOT NULL,
             PRIMARY KEY (id)
             );
INSERT INTO animals (name) VALUES ("dog"),("cat"),("penguin"),
                                  ("lax"),("whale"),("ostrich");
SELECT * FROM animals;
@end example

Which returns:

@example
+----+---------+
| id | name    |
+----+---------+
|  1 | dog     |
|  2 | cat     |
|  3 | penguin |
|  4 | lax     |
|  5 | whale   |
|  6 | ostrich |
+----+---------+
@end example

You can retrieve the most recent @code{AUTO_INCREMENT} value with the
@code{LAST_INSERT_ID()} SQL function or the @code{mysql_insert_id()} C API
function.
Note: For a multiple-row insert,
@code{LAST_INSERT_ID()}/@code{mysql_insert_id()} will actually return the
@code{AUTO_INCREMENT} key from the @strong{first} of the inserted rows.
This allows multiple-row inserts to be reproduced correctly on other servers
in a replication setup.

For @code{MyISAM} and @code{BDB} tables you can specify @code{AUTO_INCREMENT}
on a secondary column in a multiple-column index.  In this case, the generated
value for the @code{AUTO_INCREMENT} column is calculated as
@code{MAX(auto_increment_column)+1) WHERE prefix=given-prefix}.  This is
useful when you want to put data into ordered groups.

@example
CREATE TABLE animals (
             grp ENUM('fish','mammal','bird') NOT NULL,
             id MEDIUMINT NOT NULL AUTO_INCREMENT,
             name CHAR(30) NOT NULL,
             PRIMARY KEY (grp,id)
             );
INSERT INTO animals (grp,name) VALUES("mammal","dog"),("mammal","cat"),
                  ("bird","penguin"),("fish","lax"),("mammal","whale"),
                  ("bird","ostrich");
SELECT * FROM animals ORDER BY grp,id;
@end example

Which returns:

@example
+--------+----+---------+
| grp    | id | name    |
+--------+----+---------+
| fish   |  1 | lax     |
| mammal |  1 | dog     |
| mammal |  2 | cat     |
| mammal |  3 | whale   |
| bird   |  1 | penguin |
| bird   |  2 | ostrich |
+--------+----+---------+
@end example

Note that in this case (when the @code{AUTO_INCREMENT} column is part of a
multiple-column index), @code{AUTO_INCREMENT} values will be reused if you
delete the row with the biggest @code{AUTO_INCREMENT} value in any group.
This happens even for @code{MyISAM} tables, for which @code{AUTO_INCREMENT}
values normally are not reused.)

@node Twin, Apache, Examples, Tutorial
@section Queries from the Twin Project

@cindex Twin Studies, queries
@cindex queries, Twin Studies project

At Analytikerna and Lentus, we have been doing the systems and field work
for a big research project. This project is a collaboration between the
Institute of Environmental Medicine at Karolinska Institutet Stockholm
and the Section on Clinical Research in Aging and Psychology at the
University of Southern California.

The project involves a screening part where all twins in Sweden older
than 65 years are interviewed by telephone. Twins who meet certain
criteria are passed on to the next stage. In this latter stage, twins who
want to participate are visited by a doctor/nurse team. Some of the
examinations include physical and neuropsychological examination,
laboratory testing, neuroimaging, psychological status assessment, and family
history collection. In addition, data are collected on medical and
environmental risk factors.

More information about Twin studies can be found at:
@uref{http://www.mep.ki.se/twinreg/index_en.html}

The latter part of the project is administered with a web interface
written using Perl and MySQL.

Each night all data from the interviews is moved into a MySQL
database.

@menu
* Twin pool::                   Find All Non-distributed Twins
* Twin event::                  Show a Table of Twin Pair Status
@end menu


@node Twin pool, Twin event, Twin, Twin
@subsection Find All Non-distributed Twins

The following query is used to determine who goes into the second part of the
project:

@example
SELECT
        CONCAT(p1.id, p1.tvab) + 0 AS tvid,
        CONCAT(p1.christian_name, " ", p1.surname) AS Name,
        p1.postal_code AS Code,
        p1.city AS City,
        pg.abrev AS Area,
        IF(td.participation = "Aborted", "A", " ") AS A,
        p1.dead AS dead1,
        l.event AS event1,
        td.suspect AS tsuspect1,
        id.suspect AS isuspect1,
        td.severe AS tsevere1,
        id.severe AS isevere1,
        p2.dead AS dead2,
        l2.event AS event2,
        h2.nurse AS nurse2,
        h2.doctor AS doctor2,
        td2.suspect AS tsuspect2,
        id2.suspect AS isuspect2,
        td2.severe AS tsevere2,
        id2.severe AS isevere2,
        l.finish_date
FROM
        twin_project AS tp
        /* For Twin 1 */
        LEFT JOIN twin_data AS td ON tp.id = td.id
                  AND tp.tvab = td.tvab
        LEFT JOIN informant_data AS id ON tp.id = id.id
                  AND tp.tvab = id.tvab
        LEFT JOIN harmony AS h ON tp.id = h.id
                  AND tp.tvab = h.tvab
        LEFT JOIN lentus AS l ON tp.id = l.id
                  AND tp.tvab = l.tvab
        /* For Twin 2 */
        LEFT JOIN twin_data AS td2 ON p2.id = td2.id
                  AND p2.tvab = td2.tvab
        LEFT JOIN informant_data AS id2 ON p2.id = id2.id
                  AND p2.tvab = id2.tvab
        LEFT JOIN harmony AS h2 ON p2.id = h2.id
                  AND p2.tvab = h2.tvab
        LEFT JOIN lentus AS l2 ON p2.id = l2.id
                  AND p2.tvab = l2.tvab,
        person_data AS p1,
        person_data AS p2,
        postal_groups AS pg
WHERE
        /* p1 gets main twin and p2 gets his/her twin. */
        /* ptvab is a field inverted from tvab */
        p1.id = tp.id AND p1.tvab = tp.tvab AND
        p2.id = p1.id AND p2.ptvab = p1.tvab AND
        /* Just the sceening survey */
        tp.survey_no = 5 AND
        /* Skip if partner died before 65 but allow emigration (dead=9) */
        (p2.dead = 0 OR p2.dead = 9 OR
         (p2.dead = 1 AND
          (p2.death_date = 0 OR
           (((TO_DAYS(p2.death_date) - TO_DAYS(p2.birthday)) / 365)
            >= 65))))
        AND
        (
        /* Twin is suspect */
        (td.future_contact = 'Yes' AND td.suspect = 2) OR
        /* Twin is suspect - Informant is Blessed */
        (td.future_contact = 'Yes' AND td.suspect = 1
                                   AND id.suspect = 1) OR
        /* No twin - Informant is Blessed */
        (ISNULL(td.suspect) AND id.suspect = 1
                            AND id.future_contact = 'Yes') OR
        /* Twin broken off - Informant is Blessed */
        (td.participation = 'Aborted'
         AND id.suspect = 1 AND id.future_contact = 'Yes') OR
        /* Twin broken off - No inform - Have partner */
        (td.participation = 'Aborted' AND ISNULL(id.suspect)
                                      AND p2.dead = 0))
        AND
        l.event = 'Finished'
        /* Get at area code */
        AND SUBSTRING(p1.postal_code, 1, 2) = pg.code
        /* Not already distributed */
        AND (h.nurse IS NULL OR h.nurse=00 OR h.doctor=00)
        /* Has not refused or been aborted */
        AND NOT (h.status = 'Refused' OR h.status = 'Aborted'
        OR h.status = 'Died' OR h.status = 'Other')
ORDER BY
        tvid;
@end example

Some explanations:
@table @asis
@item @code{CONCAT(p1.id, p1.tvab) + 0 AS tvid}
We want to sort on the concatenated @code{id} and @code{tvab} in
numerical order. Adding @code{0} to the result causes MySQL to
treat the result as a number.
@item column @code{id}
This identifies a pair of twins. It is a key in all tables.
@item column @code{tvab}
This identifies a twin in a pair. It has a value of @code{1} or @code{2}.
@item column @code{ptvab}
This is an inverse of @code{tvab}. When @code{tvab} is @code{1} this is
@code{2}, and vice versa. It exists to save typing and to make it easier for
MySQL to optimize the query.
@end table

This query demonstrates, among other things, how to do lookups on a
table from the same table with a join (@code{p1} and @code{p2}). In the example, this
is used to check whether a twin's partner died before the age of 65. If so,
the row is not returned.

All of the above exist in all tables with twin-related information. We
have a key on both @code{id,tvab} (all tables), and @code{id,ptvab}
(@code{person_data}) to make queries faster.

On our production machine (A 200MHz UltraSPARC), this query returns
about 150-200 rows and takes less than one second.

The current number of records in the tables used above:
@multitable @columnfractions .25 .10
@item @strong{Table}            @tab @strong{Rows}
@item @code{person_data}        @tab 71074
@item @code{lentus}             @tab 5291
@item @code{twin_project}       @tab 5286
@item @code{twin_data}          @tab 2012
@item @code{informant_data}     @tab 663
@item @code{harmony}            @tab 381
@item @code{postal_groups}      @tab 100
@end multitable


@node Twin event,  , Twin pool, Twin
@subsection Show a Table of Twin Pair Status

Each interview ends with a status code called @code{event}. The query
shown here is used to display a table over all twin pairs combined by
event. This indicates in how many pairs both twins are finished, in how many
pairs one twin is finished and the other refused, and so on.

@example
SELECT
        t1.event,
        t2.event,
        COUNT(*)
FROM
        lentus AS t1,
        lentus AS t2,
        twin_project AS tp
WHERE
        /* We are looking at one pair at a time */
        t1.id = tp.id
        AND t1.tvab=tp.tvab
        AND t1.id = t2.id
        /* Just the sceening survey */
        AND tp.survey_no = 5
        /* This makes each pair only appear once */
        AND t1.tvab='1' AND t2.tvab='2'
GROUP BY
        t1.event, t2.event;

@end example


@node Apache,  , Twin, Tutorial
@section Using MySQL with Apache

@cindex Apache

There are programs that let you authenticate your users from a MySQL
database and also let you write your log files into a MySQL table.

You can change the Apache logging format to be easily readable by
MySQL by putting the following into the Apache configuration file:

@example
LogFormat \
        "\"%h\",%@{%Y%m%d%H%M%S@}t,%>s,\"%b\",\"%@{Content-Type@}o\",  \
        \"%U\",\"%@{Referer@}i\",\"%@{User-Agent@}i\""
@end example

To load a log file in that format into MySQL, you can use a statement
something like this:

@example
LOAD DATA INFILE '/local/access_log' INTO TABLE table_name
FIELDS TERMINATED BY ',' OPTIONALLY ENCLOSED BY '"' ESCAPED BY '\\'
@end example

The named table should be created to have columns that correspond to those
that the @code{LogFormat} line writes to the log file.


@node Using MySQL Programs, MySQL Database Administration, Tutorial, Top
@chapter Using MySQL Programs

This chapter provides a brief overview of the programs provided by MySQL AB
and discusses how to specify options when you run these programs.
Most programs have options that are specific to their own operation, but the
syntax for specifying options is similar for all of them. Later chapters
provide more detailed descriptions of individual programs, including which
options they recognize.

@menu
* Program Overview::            Overview of MySQL Programs
* Invoking Programs::           Invoking MySQL Programs
* Program Options::             Specifying Program Options
@end menu

@node Program Overview, Invoking Programs, Using MySQL Programs, Using MySQL Programs
@section Overview of MySQL Programs

@c TODO: maybe mention (or xfer) third-party programs

MySQL AB provides several types of programs:

@table @asis

@item The MYSQL server and server startup scripts:

@itemize @bullet
@item
@code{mysqld} is the MySQL server
@item
@code{mysqld_safe}, @code{mysql.server}, and @code{mysqld_multi} are server
startup scripts
@item
@code{mysql_install_db} initializes the data directory and the initial
databases
@end itemize

@item Client programs that access the server:

@itemize @bullet
@item
@code{mysql} is a command-line client for executing SQL statements interactively
or in batch mode
@item
@code{mysqlcc} (MySQL Control Center) is an interactive graphical tool for
executing SQL statements and administration
@item
@code{mysqladmin} is an administrative client
@item
@code{mysqlcheck} performs table maintenance operations
@item
@code{mysqldump} and @code{mysqlhotcopy} make database backups
@item
@code{mysqlimport} imports data files
@item
@code{mysqlshow} displays information about databases and tables
@end itemize

@item Utility programs that operate independently of the server:

@itemize @bullet
@item
@code{myisamchk} performs table maintenance operations
@item
@code{myisampack} produces compressed, read-only tables
@item
@code{mysqlbinlog} is a tool for processing binary log files
@item
@code{mysql_config} shows command-line options for compiling MySQL programs
@item
@code{perror} displays error code meanings
@end itemize

@c TODO: this table is missing some programs (e.g., replace).
@c TODO: not all programs named here have their own entries in the following
@c chapters (e.g., mysql_install_db)

@end table

More information on running the server may be found in
@ref{Database Administration}.
Client and utility programs are described in more detail in
@ref{Client-Side Scripts}.

Most MySQL distribution formats include all of these programs, except for
those programs that are platform-specific. (For example, the server startup
scripts are not used on Windows.) The exception is that RPM distributions are
more specialized. There is one RPM for the server, another for the client
programs, and so forth. If you appear to be missing one or more programs,
see @ref{Installing} for information on distributions and what they contain.
It may be that you need to install something else.

@node Invoking Programs, Program Options, Program Overview, Using MySQL Programs
@section Invoking MySQL Programs

To invoke a MySQL program at the command line (that is, from your shell or
command prompt), enter the program name followed by any options or other
arguments needed to instruct the program what you want it to do. The following
commands show some sample program invocations. ``@code{shell>}'' represents
your command prompt; it is not part of what you type.

@example
shell> mysql test
shell> mysqldump --quote-names personnel
shell> mysqladmin extended-status variables
shell> mysqlshow --help
@end example

Arguments that begin with a dash are option arguments. They typically specify
the type of connection a program should make to the server or affect its
operational mode. Options have a syntax that is described in
@ref{Program Options}.

Non-option arguments (arguments with no leading dash) provide additional
information to the program. For example, the @code{mysql} program interprets
the first non-option argument as a database name, so the command
@code{mysql test} indicates that you want to use the @code{test} database.

Later sections that describe individual programs indicate which options a
program understands and describe the meaning of any additional non-option
arguments.

Some options are common to a number of programs. The most common of these are
the @code{--host}, @code{--user}, and @code{--password} options that specify
connection parameters. They indicate the host where the MySQL server is
running, and the username and password of your MySQL account. All MySQL client
programs understand these options; they allow you to specify which server to
connect to and the account to use on that server.

@cindex PATH environment variable
@cindex environment varible, PATH

Note that you may find it necessary to invoke MySQL programs using the
pathname to the @file{bin} directory in which they are installed. This is
likely to be the case if you get a ``program not found'' error whenever
you attempt to run a MySQL program from any directory other than the
@file{bin} directory.  To make it more convenient to use MySQL, you
can add the pathname of the @file{bin} directory to your @code{PATH}
environment variable setting. Then to run a program you need only type
its name, not its entire pathname.

Consult the documentation for your command interpreter for instructions on
setting your @code{PATH}; the syntax for setting environment variables is
interpreter-specific.


@node Program Options,  , Invoking Programs, Using MySQL Programs
@section Specifying Program Options

You can provide options for MySQL programs in several ways:

@itemize @bullet

@item
On the command line following the program name. This is most common for
options that apply to a specific invocation of the program.

@item
In an option file that the program reads when it starts. This is common for
options that you want the program to use each time it runs.

@item
In environment variables. These are useful for options that you want to apply
each time the program runs, though in practice option files are used more
commonly for this purpose.
(@ref{Multiple Unix servers} discusses one situation in which environment
variables can be very helpful. It describes a handy technique that uses such
variables to specify the TCP/IP port and Unix socket file for both
the server and client programs.)

@end itemize

MySQL programs determine which options are given by examining environment
variables first, then option files, then the command line.
If an option is specified multiple times, the last occurrence takes
precedence.
This means that environment variables have the lowest precedence and
command-line options the highest.

You can take advantage of the way that MySQL programs process options by
specifying the default value for a program's options in an option file. Then
you need not type them each time you run the program, but can override the
defaults if necessary by using command-line options.

@menu
* Command-line options::        Using Options on the Command Line
* Option files::                Using Option Files
* Environment variable options::  Using Environment Variables to Specify Options
* Program variables::           Using Options to Set Program Variables
@end menu

@node Command-line options, Option files, Program Options, Program Options
@subsection Using Options on the Command Line

Program options specified on the command line follow these rules:

@itemize @bullet

@item
Options are given after the command name.

@item
An option argument begins with one dash or two dashes, depending on whether
it has a short name or a long name. Many options have both forms.
For example, @code{-?} and @code{--help} are the short and long forms
of the option that instructs a MySQL program to display a help message.

@item
Option names are case sensitive.  @code{-v} and @code{-V} are both legal and
have different meanings. (They are the corresponding short forms of the
@code{--verbose} and @code{--version} options.)

@item
Some options take a value following the option name.
For example, @code{-h localhost} or @code{--host=localhost} indicate
the MySQL server host to a client program.  The option value
tells the program the name of the host where the MySQL server is running.

@item
For a long option that takes a value, separate the option name and the value by an @samp{=} sign.
For a short option that takes a value, the option value can immediately follow the option letter,
or there can be a space between.
(@code{-hlocalhost} and @code{-h localhost} are equivalent.)
An exception to this rule is the option for specifying your MySQL password.
This option can be given in long form as @code{--password=pass_val} or as
@code{--password}. In the latter case (with no password value given), the
program will prompt you for the password.
The password option also may be given in short form as @code{-ppass_val} or as
@code{-p}. However, for the short form, if the password value is given, it
must follow the option letter @emph{with no intervening space}. The reason for
this is that if a space follows the option letter, the program has no way to
tell whether a following argument is supposed to be the password value or some
other kind of argument.  Consequently, the following two commands have two
completely different meanings:

@example
shell> mysql -ptest
shell> mysql -p test
@end example

The first command instructs @code{mysql} to use a password value of
@code{test}, but specifies no default database.
The second instructs @code{mysql} to prompt for the password value
and to use @code{test} as the default database.

@end itemize

MySQL 4.0 introduced some additional flexibility in the way you specify
options. These changes were made in MySQL 4.0.2. Some of them relate to the way
you specify options that have ``enabled'' and ``disabled'' states, and to the
use of options that may be present in one version of MySQL but not another.
Those capabilities are discussed here.
Another change pertains to the way you use options to set program variables.
@ref{Program variables} discusses that topic further.

@c TODO: also: can specify unambigious prefix of option -- hm, but that's
@c not 4.0.2 (?), so it should be mentioned earlier.

Some options control behavior that can be turned on or off. For example,
the @code{mysql} client supports a @code{--column-names} option that
determines whether or not to display a row of column names at the beginning
of query results. By default, this option is enabled. However, you may
want to disable it in some instances, such as when sending the output
of @code{mysql} into another program that expects to see only data and
not an initial header line.

To disable column names, you can specify the option using any of these forms:

@example
--disable-column-names
--skip-column-names
--column-names=0
@end example

The @code{--disable} and @code{--skip} prefixes and the @code{=0} suffix
all have the same effect of turning the option off.

The ``enabled'' form of the option may be specified as:

@example
--column-names
--enable-column-names
--column-names=1
@end example

Another change to option processing introduced in MySQL 4.0 is that you
can use the @code{--loose} prefix for command-line options. If an option
is prefixed by @code{--loose}, the program will not exit with
an error if it does not recognize the option, but instead will issue
only a warning:

@example
shell> mysql --loose-no-such-option
mysql: WARNING: unknown option '--no-such-option'
@end example

The @code{--loose} prefix can be useful when you run programs from
multiple installations of MySQL on the same machine, at least if all the
versions are as recent as 4.0.2.  This prefix is particularly useful when you
list options in an option file.  An option that may not be recognized by all
versions of a program can be given using the @code{--loose}
prefix (or @code{loose} in an option file). Versions of the program that do
not recognize the option will issue a warning and ignore it. Note that this
strategy works only if all versions involved are 4.0.2 or later, because
earlier versions know nothing of the @code{--loose} convention.


@node Option files, Environment variable options, Command-line options, Program Options
@subsection Using Option Files

@cindex default options
@cindex option files
@cindex creating, default startup options
@cindex startup options, default

MySQL programs can read startup options from option
files (also sometimes called configuration files).
Option files provide a convenient way to specify commonly used options so they
need not be entered on the command line each time you run a program.
Option file capability is available from MySQL 3.22 on.

The following programs support option files:  @code{mysql},
@code{mysqladmin}, @code{mysqld}, @code{mysqld_safe}, @code{mysql.server},
@code{mysqldump}, @code{mysqlimport}, @code{mysqlshow}, @code{mysqlcheck},
@code{mysqlhotcopy},
@code{myisamchk}, and @code{myisampack}.

On Windows, MySQL programs read startup options from the following files:

@multitable @columnfractions .30 .70
@item @strong{Filename} @tab @strong{Purpose}
@item @code{windows-dir\my.ini} @tab Global options
@item @code{C:\my.cnf} @tab Global options
@end multitable

@code{windows-dir} represents the location of your Windows directory.
This is commonly @file{C:\Windows} or @file{C:\WinNT}. Check the value of the
@code{WINDIR} environment vairable to see where this directory is located on
your system.

On Unix, MySQL programs read startup options from the following files:

@tindex .my.cnf file
@multitable @columnfractions .30 .70
@item @strong{Filename} @tab @strong{Purpose}
@item @code{/etc/my.cnf} @tab Global options
@item @code{DATADIR/my.cnf} @tab Server-specific options
@item @code{defaults-extra-file} @tab The file specified with @code{--defaults-extra-file=path}, if any
@item @code{~/.my.cnf} @tab User-specific options
@end multitable

@code{DATADIR} represents the location of the MySQL data directory. Typically
this is @file{/usr/local/mysql/data} for a binary installation or
@file{/usr/local/var} for a source installation.  Note that this is the data
directory location that was specified at configuration time, not the
one specified with @code{--datadir} when @code{mysqld} starts!
Use of @code{--datadir} at runtime has no effect on where the server
looks for option files, because it looks for them before processing any
command-line arguments.

MySQL looks for option files in the order listed above and reads any that
exist.
If multiple option files exist, an option specified in a file read later takes
precedence over the same option specified in a file read earlier.

Any long option that may be given on the command-line when running a
MySQL program can be given in an option file as well.  To get the list
of available options for a program, run it with the @code{--help} option.

The syntax for
specifying options in an option file is similar to command-line syntax, except
that you omit the leading two dashes. For example, @code{--quick} or
@code{--host=localhost} on the command line are specified as @code{quick} or
@code{host=localhost} in an option file.
To specify an option of the form @code{--loose-opt_name}
in an option file, write it as @code{loose-opt_name}.

Empty lines in option files are ignored. Non-empty lines can take any
of the following forms:

@table @code
@item #comment
@itemx ;comment
Comment lines start with @samp{#} or @samp{;}. As of MySQL 4.0.14, 
a @samp{#}-comment can start in the middle of a line as well.

@item [group]
@code{group} is the name of the program or group for which you want to set
options.  After a group line, any @code{option} or @code{set-variable} lines
apply to the named group until the end of the option file or another group
line is given.

@item opt_name
This is equivalent to @code{--opt_name} on the command-line.

@item opt_name=value
This is equivalent to @code{--opt_name=value} on the command-line.
In an option file, you can have spaces around the @samp{=} character,
something that is not true on the command line.
As of
MySQL 4.0.16, you can quote the value with double quotes or single quotes.
This is useful if the value contains a comment character or whitespace.

@item set-variable = var_name=value
Set the program variable @code{var_name} to the given value.
This is equivalent to @code{--set-variable=var_name=value} on the
command-line.
Spaces are allowed around the first @samp{=} character but not around
the second.
This syntax is deprecated as of MySQL 4.0.
See @ref{Program variables} for more information on setting program variables.
@end table

Note that for options and values, all leading and trailing blanks are
automatically deleted.  You may use the escape sequences @samp{\b},
@samp{\t}, @samp{\n}, @samp{\r}, @samp{\\}, and @samp{\s} in option values
to represent the backspace, tab, newline, carriage return, and space characters.

On Windows, if an option value represents a pathname, you should specify the
value using @samp{/} rather than @samp{\} as the pathname separator. If you
use @samp{\}, you must double it as @samp{\\},
because @samp{\} is the escape character in MySQL.

If an option group name is the same as a program name, options in the group
apply specifically to that program.

The @code{[client]} option group is read by all client programs
(but not by @code{mysqld}). This allows you to specify options that apply to
every client. For example, @code{[client]} is the perfect group to use
to specify the password that you use to connect to the server.  (But make
sure the option file is readable and writable only by yourself, so that other
people cannot find out your password.) Be sure not
to put an option in the @code{[client]} group unless it is recognized by
@emph{all} client programs.

As of MySQL 4.0.14,
if you want to create options that should only be read by one specific
@code{mysqld} server release series, you can do this with @code{[mysqld-4.0]},
@code{[mysqld-4.1]}, and so forth:

@example
[mysqld-4.0]
new
@end example

The above @code{new} option will be used only with MySQL server versions 4.0.x.

Here is a typical global option file:

@example
[client]
port=3306
socket=/tmp/mysql.sock

[mysqld]
port=3306
socket=/tmp/mysql.sock
key_buffer_size=16M
max_allowed_packet=1M

[mysqldump]
quick
@end example

Here is a typical user option file:

@example
[client]
# The following password will be sent to all standard MySQL clients
password="my_password"

[mysql]
no-auto-rehash
set-variable = connect_timeout=2

[mysqlhotcopy]
interactive-timeout

@end example

@tindex .my.cnf file
If you have a source distribution, you will find sample option
files named @file{my-xxxx.cnf} in the @file{support-files} directory.
If you have a binary distribution, look in the @file{support-files}
directory under your MySQL installation directory (typically @file{C:\mysql}
on Windows or @file{/usr/local/mysql} on Unix).  Currently
there are sample option files for small, medium, large, and very
large systems. To experiment with one of these files, copy it to
@file{C:\my.cnf} on Windows or to @file{.my.cnf} in your home directory on
Unix.

All MySQL programs that support option files support the
following command-line options:

@table @code

@item --no-defaults
Don't read any option files.

@item --print-defaults
Print the program name and all options that it will get from option files.

@item --defaults-file=path_name
Use only the given option file. @code{path_name} is the full pathname
to the file.

@item --defaults-extra-file=path_name
Read this option file after the global option file but before the user
option file. @code{path_name} is the full pathname to the file.

@end table

Note that to work properly, each of these options must immediately
follow the command name on the command line, with the exception
that @code{--print-defaults} may be used immediately after
@code{--defaults-file} or @code{--defaults-extra-file}.

@c TODO: next few paragraphs probably should go into API chapter.

In shell scripts, you can use the @code{my_print_defaults} program to parse the
option files. The following example shows the output that
@code{my_print_defaults} might produce when asked to show the options found in
the @code{[client]} and @code{[mysql]} groups:

@example

shell> my_print_defaults client mysql
--port=3306
--socket=/tmp/mysql.sock
--no-auto-rehash
@end example

Note for developers:  Option file handling is implemented in the C client
library simply by
processing all matching options (that is, options in the appropriate group)
before any command-line arguments. This works nicely for programs that use
the last instance of an option that is specified multiple times. If you have
a C or C++ program that handles multiply specified options this way but doesn't
read option files, you need add only two lines to give it that capability.
Check the source code of any of the standard MySQL clients to see
how to do this.

Several other language interfaces to MySQL are based on the C client library,
and some of them provide a way to access option file contents. These include
Perl and Python. See the documentation for your preferred interface for
details.


@node Environment variable options, Program variables, Option files, Program Options
@subsection Using Environment Variables to Specify Options

@cindex environment variables

To specify an option using an environment variable, set the variable using the
syntax appropriate for your comment processor. For example, on Windows or
NetWare,
you can set the @code{USER} variable to specify your MySQL account name.
To do so, use this syntax:

@example
SET USER=your_name
@end example

The syntax on Unix depends on your shell. Suppose you want to specify the
TCP/IP port number using the @code{MYSQL_TCP_PORT} variable. The syntax for
Bourne shell and variants (@code{sh}, @code{bash}, @code{zsh}, etc.) is:

@example
MYSQL_TCP_PORT=3306
@end example

For @code{csh} and @code{tcsh}, use this syntax:

@example
setenv MYSQL_TCP_PORT 3306
@end example

The commands to set environment variables can be executed at your command
prompt to take effect immediately. These settings persist until you log out.
To have the settings take effect each time you log in,
place the appropriate command or commands in a startup file that your
command interpreter reads each time it starts. Typical startup files are
@file{AUTOEXEC.BAT} for Windows, @file{.bash_profile} for @code{bash}, or
@file{.tcshrc} for @code{tcsh}. Consult the documentation for your command
interpreter for specific details.

@ref{Environment variables} lists all environment variables that affect MySQL
program operation.


@node Program variables,  , Environment variable options, Program Options
@subsection Using Options to Set Program Variables

@cindex program variables, setting
@cindex setting program variables

@c TODO: now that we have this information written out explicitly in an
@c xref-able section, find the multiple places where set-variable is
@c explained, delete the redundant explanations, and point them here.

@c TODO: check if program variables can be set by unique prefix.

Many MySQL programs have internal variables that can be set at runtime.
As of MySQL 4.0.2, program
variables are set the same way as any other long option that takes a value.
For example, @code{mysql} has a @code{max_allowed_packet} variable that
controls the maximum size of its communication buffer.
To set the @code{max_allowed_packet} variable for @code{mysql} to a value of 64
MB, use either of the following commands:

@example
shell> mysql --max_allowed_packet=6710740
shell> mysql --max_allowed_packet=64M
@end example

The first command specifies the value in bytes. The second specifies the value
in megabytes. Variable values can have a suffix of @code{K}, @code{M}, or
@code{G} (either uppercase or lowercase) to indicate units of kilobytes,
megabytes, or gigabytes.

In an option file, the variable setting is given without the leading dashes:

@example
[mysql]
max_allowed_packet=6710740
@end example

Or:

@example
[mysql]
max_allowed_packet=64M
@end example

If you like, underscores in a variable name can be specified as dashes.

Prior to MySQL 4.0.2, program variable names are not recognized as option
names.
Instead, use the @code{--set-variable} option to assign a value to a variable:

@example
shell> mysql --set-variable=max_allowed_packet=6710740
shell> mysql --set-variable=max_allowed_packet=64M
@end example

In an option file, omit the leading dashes:

@example
[mysql]
set-variable = max_allowed_packet=6710740
@end example

Or:

@example
[mysql]
set-variable = max_allowed_packet=64M
@end example

With @code{--set-variable}, underscores in variable names may not be given as
dashes for versions of MySQL older than 4.0.2.

The @code{--set-variable} option is still recognized in MySQL 4.0.2 and up,
but is deprecated.


@node MySQL Database Administration, Replication, Using MySQL Programs, Top
@chapter Database Administration

This chapter covers topics that deal with administering a MySQL installation,
such as configuring the server, managing user accounts, and performing backups.

@menu
* Server-Side Scripts::         The MySQL Server and Server Startup Scripts
* Configuring MySQL::           Configuring MySQL
* Security::                    General Security Issues
* Privilege system::            The MySQL Access Privilege System
* User Account Management::     MySQL User Account Management
* Disaster Prevention::         Disaster Prevention and Recovery
* Localisation::                MySQL Localization and International Usage
* Log Files::                   The MySQL Log Files
* Multiple servers::            Running Multiple MySQL Servers on the Same Machine
@end menu


@node Server-Side Scripts, Configuring MySQL, MySQL Database Administration, MySQL Database Administration
@section The MySQL Server and Server Startup Scripts

The MySQL server, @code{mysqld}, is the main program that does most of the
work in a MySQL installation. The server is accompanied by several related
scripts that perform setup operations when you install MySQL or that are
helper programs to assist you in starting and stopping the server.

@menu
* Server-Side Overview::        Overview of the Server-Side Scripts and Utilities
* mysqld-max::                  @code{mysqld-max}, An Extended @code{mysqld} Server
* mysqld_safe::                 @code{mysqld_safe}, The Wrapper Around @code{mysqld}
* mysql.server::                @code{mysql.server}, A Server Startup Script for Run Directories
* mysqld_multi::                @code{mysqld_multi}, A Program for Managing Multiple MySQL Servers
@end menu


@node Server-Side Overview, mysqld-max, Server-Side Scripts, Server-Side Scripts
@subsection Overview of the Server-Side Scripts and Utilities

@cindex programs, list of

All MySQL programs take many different options. However, every
MySQL program provides a @code{--help} option that you can use
to get a description of the program's options. For example, try
@code{mysqld --help}.

You can override default options for all standard programs by specifying
options on the command line or in an option file.
@ref{Program Options}.

The following list briefly describes the server-related MySQL programs:

@c TODO: indicate where these are discussed

@table @code

@cindex @code{mysqld}
@item mysqld
The SQL daemon (that is, the MySQL server). To use client programs, this
program must be running, because clients gain access to databases by
connecting the the server.

@cindex @code{mysqld-max}
@item mysqld-max
A version of the server that includes additional features.

@cindex @code{mysqld_safe}
@item mysqld_safe
A server startup script.
@code{mysqld_safe} attempts to start @code{mysqld-max} if it exists, and
@code{mysqld} otherwise.

@cindex @code{mysql.server}
@item mysql.server
A server startup script.
This script is used on systems that use run directories containing scripts
that start system services for particular run levels. It invokes
@code{mysqld_safe} to start the MySQL server.

@cindex @code{mysqld_multi}
@item mysqld_multi
A server startup script that can start or stop multiple servers installed
on the system.

@cindex @code{mysql_install_db}
@item mysql_install_db
This script creates the MySQL grant tables with default privileges. It is
usually executed only once, when first installing MySQL on a system.

@cindex @code{mysql_fix_privilege_tables}
@item mysql_fix_privilege_tables
This script is used after an upgrade install operation, to update the grant
tables with any changes that were made in newer versions of MySQL.

@end table

There are several other programs that also are run on the server host:

@c TODO: indicate where these are discussed

@table @code

@cindex @code{myisamchk}
@item myisamchk
A utility to describe, check, optimize, and repair MySQL tables.
@code{myisamchk} is described in
@ref{Table maintenance}.

@cindex @code{make_binary_distribution}
@item make_binary_distribution
This program makes a binary release of a compiled MySQL. This could be sent
by FTP to @file{/pub/mysql/Incoming} on @code{support.mysql.com} for the
convenience of other MySQL users.

@cindex @code{mysqlbug}
@item mysqlbug
The MySQL bug reporting script.  It can be be used to
send a bug report to the MySQL list. (You can also visit
@url{http://bugs.mysql.com/} to file a bug report online.)

@end table


@node mysqld-max, mysqld_safe, Server-Side Overview, Server-Side Scripts
@subsection @code{mysqld-max}, An Extended @code{mysqld} Server

@cindex @code{mysqld-max}

A MySQL-Max server is a version of the @code{mysqld} MySQL server that is
configured to include additional features.

You can find the MySQL-Max binaries at
@uref{http://www.mysql.com/downloads/mysql-max-4.0.html}.

The MySQL binary distributions Windows include both the
standard server (named @code{mysqld.exe}) and the MySQL-Max server (named
@code{mysqld-max.exe}).  @uref{http://www.mysql.com/downloads/mysql-4.0.html}.
@xref{Windows installation}.

If you install MySQL on Linux using RPM distributions, install the
@code{MySQL-server} RPM first, and then the @code{MySQL-Max} RPM.  The
latter presupposes that you have already installed the regular server RPM.
This process installs a standard server named @code{mysqld} and a MySQL-Max
server named @code{mysqld-max}.

All other MySQL-Max distributions contain a single server that is named
@code{mysqld} but that has the additional features.

MySQL-Max servers are built by using the following @code{configure} options:

@multitable @columnfractions .35 .65
@item @strong{Option}           @tab @strong{Comment}
@item @code{--with-server-suffix=-max} @tab Add a @code{-max} suffix to the @code{mysqld} version string
@item @code{--with-innodb}       @tab Support for @code{InnoDB} tables (MySQL 3.23 only)
@item @code{--with-bdb}          @tab Support for Berkeley DB (@code{BDB}) tables
@item @code{CFLAGS=-DUSE_SYMDIR} @tab Symbolic link support for Windows
@end multitable

MySQL-Max binary distributions are a convenience for those who wish to install
precompiled programs. If you build MySQL using a source distribution, you can
build your own Max-like server by enabling the same features at configuration
time that the MySQL-Max binary distributions are built with.

MySQL-Max servers always include the @code{InnoDB} storage engine.
The @code{--with-innodb} option for enabling @code{InnoDB} support
is needed only in MySQL 3.23. (In MySQL 4 and up, @code{InnoDB} is included by
default.  so you do not need a MySQL-Max server to obtain
@code{InnoDB} support.)

MySQL-Max servers include the BerkeleyDB (@code{BDB}) storage engine
whenever possible, but not all platforms support @code{BDB}.  The following
table shows which platforms allow MySQL-Max binaries to include @code{BDB}:

@multitable @columnfractions .30 .10
@item @strong{System}    @tab @code{BDB}
@item Windows/NT         @tab Y
@item AIX 4.3            @tab N
@item HP-UX 11.0         @tab N
@item Linux-Alpha        @tab N
@item Linux-Intel        @tab Y
@item Linux-IA-64        @tab N
@item Solaris-Intel      @tab N
@item Solaris-SPARC      @tab Y
@item SCO OSR5           @tab Y
@item UnixWare           @tab Y
@item Mac OS X           @tab N
@end multitable

As of Version 3.23, all MySQL servers support @code{MyISAM} tables, because
@code{MyISAM} is the default storage engine. To find out which storage engines
your server supports, issue the following statement:

@example
mysql> SHOW VARIABLES LIKE "have_%";
+------------------+----------+
| Variable_name    | Value    |
+------------------+----------+
| have_bdb         | NO       |
| have_crypt       | YES      |
| have_innodb      | YES      |
| have_isam        | NO       |
| have_raid        | NO       |
| have_symlink     | DISABLED |
| have_openssl     | NO       |
| have_query_cache | YES      |
+------------------+----------+
@end example

The values in the second column indicate the server's level of support for
each feature:

@multitable @columnfractions .15 .85
@item @strong{Value}  @tab @strong{Meaning}
@item @code{YES}      @tab The feature is supported and is active.
@item @code{NO}       @tab The feature is not supported.
@item @code{DISABLED} @tab The feature is supported but has been disabled.
@end multitable

A value of @code{NO} means that the server was compiled without support
for the feature, so it cannot be activated at runtime.

A value of @code{DISABLED} occurs either because the server was
started with an option that disables the feature, or because not
all options required to enable it were given. In the latter case, the
@code{hostname.err} file should contain a reason indicating why the option
is disabled.

One situation in which you might see @code{DISABLED} occurs with MySQL 3.23
when the @code{InnoDB} storage engine is compiled in. In MySQL 3.23, you
must supply at least the @code{innodb_data_file_path} option at runtime to
set up the @code{InnoDB} tablespace. Without the options, @code{InnoDB}
disables itself.
@xref{InnoDB in MySQL 3.23}.
(You can specify configuration options for the @code{BDB} storage engine, too,
but @code{BDB} will not disable itself without them.
@xref{BDB start}.)

You may also see @code{DISABLED} for the @code{InnoDB}, @code{BDB}, or
@code{ISAM} storage engines if the server was compiled to support them, but
was started with the @code{--skip-innodb}, @code{--skip-bdb}, or
@code{--skip-isam} options at runtime.


@node mysqld_safe, mysql.server, mysqld-max, Server-Side Scripts
@subsection @code{mysqld_safe}, The Wrapper Around @code{mysqld}

@cindex tools, mysqld_safe
@cindex tools, safe_mysqld
@cindex scripts
@cindex @code{mysqld_safe}
@cindex @code{safe_mysqld}

@code{mysqld_safe} is the recommended way to start a @code{mysqld}
server on Unix.  @code{mysqld_safe} adds some safety features such as
restarting the server when an error occurs and logging run-time
information to a log file.

@strong{Note:}
Before MySQL 4.0, @code{mysqld_safe} is named @code{safe_mysqld}.
To preserve backward compatibility, MySQL binary distributions for
some time will include @code{safe_mysqld} as a symbolic link to
@code{mysqld_safe}.

If you don't use @code{--mysqld=#} or @code{--mysqld-version=#}
@code{mysqld_safe} will use an executable named @code{mysqld-max} if it
exists. If not, @code{mysqld_safe} will start @code{mysqld}.

On Linux, the @code{MySQL-Max} RPM uses this @code{mysqld_safe}
feature. (It just installs the @code{mysqld-max} executable, so
@code{mysqld_safe} automatically uses this executable when
@code{mysqld_safe} is restarted.)

The preference of @code{mysqld_safe} for @code{mysqld-max} over
@code{mysqld} makes it very easy to test a new @code{mysqld} binary in an
existing installation.  Just run @code{configure} with the options you
want and then install the new @code{mysqld} binary as @code{mysqld-max}
in the same directory where your existing @code{mysqld} binary is located.

On the other hand, this behavior means that if you install a MySQL-Max
distribution that includes a server named @code{mysqld-max}, then upgrade
later to a non-Max version of MySQL, @code{mysqld_safe} will still
attempt to run the old @code{mysqld-max} server.  If you perform such an
upgrade, manually remove the old @code{mysqld-max} server to ensure that
@code{mysqld_safe} runs the new @code{mysqld} server.

Normally, you should never edit the @code{mysqld_safe} script.  Instead,
put the options to @code{mysqld_safe} in the @code{[mysqld_safe]} section
in a @file{my.cnf} option file.  @xref{Option files}.  @code{mysqld_safe}
reads all options from the @code{[mysqld]}, @code{[server]} and
@code{[mysqld_safe]} sections from the option files.  (For backward
compatibility, it also reads the @code{[safe_mysqld]} sections, though you
should rename such sections to @code{[mysqld_safe]} once you begin using
MySQL 4.0 or later.)

Note that all options specified to @code{mysqld_safe} on the command-line
are passed to @code{mysqld}.  If you wants to use any options for
@code{mysqld_safe} that @code{mysqld} doesn't support, you must specify
them in the option file.

Many of the options to @code{mysqld_safe} are the same as the options to
@code{mysqld}. @xref{Server options}.

@code{mysqld_safe} supports the following options:

@table @code
@item --basedir=path
The path to the installation directory.
@item --core-file-size=#
The size of the core file @code{mysqld} should be able to create. Passed
to @code{ulimit -c}.
@item --datadir=path
The path to the data directory.
@item --defaults-extra-file=path
The name of an option file to be read in addition to the usual option files.
@item --defaults-file=path
The name of an option file to be read instead of the usual option files.
@item --err-log=path
Old form of the @code{--log-error} option, to be used before MySQL 4.0.
@item --log-error=path
Write the error log to the above file. @xref{Error log}.
@item --ledir=path
The path to the directory containing the @code{mysqld} program.
Use this option to explicitly indicate the location of the server.
@item --log=path
@item --mysqld=prog_name
The name of the server program (in the @code{ledir} directory) that you
want to start.
@item --mysqld-version=suffix
Similar to @code{--mysqld=} but here you only give the suffix for the
server program name. The base name is assumed to be @code{mysqld}.
For example, if you use @code{--mysqld-version=max}, @code{mysqld_safe}
will start the @code{mysqld-max} program in the @code{ledir} directory.
If the argument to @code{--mysqld-version} is empty, @code{mysqld}
in the @code{ledir} directory is used.
@item --nice=#
Use the @code{nice} program to set the server's scheduling priority to the
given value.  This option was added in MySQL 4.0.14.
@item --no-defaults
Do not read any option files.
@item --open-files-limit=#
The number of files @code{mysqld} should be able to open. Passed to
@code{ulimit -n}. Note that you need to start @code{mysqld_safe} as
@code{root} for this to work properly!
@item --pid-file=path
The path to the process ID file.
@item --port=#
The TCP/IP port number.
@item --socket=path
The Unix socket file path.
@item --timezone=#
Set the time zone (the @code{TZ}) variable to the value of this parameter.
@item --user=#
@end table

The @code{mysqld_safe} script is written so that it normally is able to start
a server that was installed from either a source or a binary distribution of
MySQL, even those these normally install the server in slightly different
locations.
@xref{Installation layouts}.
@code{mysqld_safe} expects one of the following conditions to be true:

@itemize @bullet
@item
The server and databases can be found relative to the directory from which
@code{mysqld_safe} is invoked.  @code{mysqld_safe} looks under its working
directory for @file{bin} and @file{data} directories (for binary
distributions) or for @file{libexec} and @file{var} directories (for source
distributions).  This condition should be met if you execute
@code{mysqld_safe} from your MySQL installation directory (for
example, @file{/usr/local/mysql} for a binary distribution).

@item
If the server and databases cannot be found relative to the working
directory, @code{mysqld_safe} attempts to locate them by absolute pathnames.
Typical locations are @file{/usr/local/libexec} and @file{/usr/local/var}.
The actual locations are determined from the values configured into the
distribution at the time it was built.  They should be correct if MySQL
is installed in the location specified at configuration time.  @end itemize

Because @code{mysqld_safe} will try to find the server and databases relative
to its own working directory, you can install a binary distribution of
MySQL anywhere, as long as you start @code{mysqld_safe} from the
MySQL installation directory:

@example
shell> cd mysql_installation_directory
shell> bin/mysqld_safe &
@end example

If @code{mysqld_safe} fails, even when invoked from the MySQL
installation directory, you can specify the @code{--ledir} and
@code{--datadir} options to indicate the directories in which the server and
databases are located on your system.

In rare cases, it may be necessary to edit @code{mysqld_safe} to get it to
start the server properly. If you do this, note that if you upgrade MySQL in
the future, your modified version of @code{mysqld_safe} will be overwritten,
so you should make a copy of your edited version that you can reinstall.


@node mysql.server, mysqld_multi, mysqld_safe, Server-Side Scripts
@subsection @code{mysql.server}, A Server Startup Script for Run Directories

MySQL distributions on Unix include a script named @code{mysql.server}.
It can be used on systems such as Linux and Solaris that use System V-style
run directories to start and stop system services.

On Linux systems, the server RPM distribution installs @code{mysql.server}
in @file{/etc/init.d} automatically under the name @code{mysql}.

If you install MySQL on Linux using another distribution format,
or on a System V-style system, you can install the script manually by
copying it to the @file{/etc/init.d} directory with the name @code{mysql}.
Make sure the script is executable. (Use @code{chmod +x mysql}.)

The commands needed to activate the script depend on your operating system.
On Linux, you can use @code{chkconfig}:

@example
shell> chkconfig --add mysql
@end example

For other systems, consult your operating system documentation to see how
to install startup scripts.


@node mysqld_multi,  , mysql.server, Server-Side Scripts
@subsection @code{mysqld_multi}, A Program for Managing Multiple MySQL Servers

@cindex tools, mysqld_multi
@cindex scripts
@cindex multi mysqld
@cindex @code{mysqld_multi}

@code{mysqld_multi} is meant for managing several @code{mysqld}
processes that listen for connections on different Unix socket files and
TCP/IP ports.  It can start or stop servers, or report their current status.

The program searches for groups named @code{[mysqld#]} in
@file{my.cnf} (or in the file named by the @code{--config-file=...} option on
the command line).
@code{#} can be any positive integer.  This number
is referred to in the following discussion as the option group number,
or GNR.  Group numbers distinquish option groups from one another and are
used as arguments to @code{mysqld_multi} to specify which servers you want
to start, stop, or obtain the status of.  Options listed in these groups
are the same as you would use in the usual @code{[mysqld]}
group used for starting @code{mysqld}.  (See, for example, @ref{Automatic
start}.) However, when using multiple servers it is necessary that each one
use its own value for options such as the Unix socket file and TCP/IP port
number. For more information on which options should be specified in a
multiple-server environment, see @ref{Multiple servers}.

To invoke @code{mysqld_multi}, use the following syntax:

@example
shell> mysqld_multi [OPTIONS] @{start|stop|report@} [GNR[,GNR]...]
@end example

@code{start}, @code{stop}, and @code{report} indicate the operation you want
to perform. You can perform the operation on a single server or multiple
servers, depending on the GNR list that follows the option name.
If there is no list, @code{mysqld_multi} performs the operation for all
servers in the option file.

Each GNR value represents an option group number or range of group numbers.
The value should be the number at the end of the group name in the
option file.  For example, the GNR for a group named @code{[mysqld17]}
is @code{17}.  To specify a range of numbers, separate the first and last
numbers by a dash.  The GNR value 10-13 represents groups @code{[mysqld10]}
through @code{[mysqld13]}.  Multiple groups or group ranges can be specified
on the command line, separated by commas.  There must be no whitespace
characters (spaces or tabs) in the GNR list. (Anything after a whitespace
character is ignored.)

This command starts a single server using option group @code{[mysqld17]}:

@example
shell> mysqld_multi start 17
@end example

This command stops serveral servers, using option groups @code{[mysql8]}
and @code{[mysqld10]} through @code{[mysqld13]}:

@example
shell> mysqld_multi start 8,10-13
@end example

For an example of how you might set up an option file, use this command:

@example
shell> mysqld_multi --example
@end example

@code{mysqld_multi} supports the following options:

@table @code
@cindex config-file option
@item --config-file=...
Specify the name of an alternative option file. This affects where
@code{mysqld_multi} looks for @code{[mysqld#]} option groups.  It does not
affect where @code{mysqld_multi} reads its own options, which are always
taken from the @code{[mysqld_multi]} group in the usual @file{my.cnf} file.
Without this option, all options are read from the usual @file{my.cnf} file.
@cindex example option
@item --example
Display an example option file.
@cindex help option
@item --help
Print this help message and exit.
@cindex log option
@item --log=...
Specify the name of the log file. If the file exists, log output is appended
to it.
@cindex mysqladmin option
@item --mysqladmin=...
The @code{mysqladmin} binary to be used to stop servers.
@cindex mysqld option
@item --mysqld=...
The @code{mysqld} binary to be used. Note that you can specify
@code{mysqld_safe} as the value for this option also. The options are passed
to @code{mysqld}. Just make sure you have the directory where @code{mysqld} is
located in your @code{PATH}
environment variable setting or fix @code{mysqld_safe}.
@cindex no-log option
@item --no-log
Print log information to stdout rather than to the log file. By default,
output goes to the log file.
@cindex password option
@item --password=...
The password of the MySQL account to use when invoking @code{mysqladmin}.
@cindex tcp-ip option
@item --tcp-ip
Connect to each MySQL server via the TCP/IP port instead of the Unix socket
file.  (If a socket file is missing, the server may still be running,
but accessible only via the TCP/IP port.)  By default, connections are
made using the Unix socket file.  This option affects @code{stop} and
@code{report} operations.
@cindex user option
@item --user=...
The username of the MySQL account to use when invoking @code{mysqladmin}.
@cindex version option
@item --version
Print the version number and exit.
@end table

Some notes about @code{mysqld_multi}:

@itemize @bullet
@item
Make sure that the MySQL user who is stopping the
@code{mysqld} services (using the @code{mysqladmin} program) has the same
password and username for all the data directories accessed (to the
@code{mysql} database). And make sure that the user has the @code{SHUTDOWN}
privilege! If you have many data directories and many different @code{mysql}
databases with different passwords for the MySQL @code{root} user,
you may want to create a common @code{multi_admin} user for each using the
same password (see below). Example how to do it:
@example
shell> mysql -u root -S /tmp/mysql.sock -proot_password -e
"GRANT SHUTDOWN ON *.* TO multi_admin@@localhost IDENTIFIED BY 'multipass'"
@end example
@xref{Privileges}.
You will have to do the above for each @code{mysqld} running in each
data directory, that you have (just change the socket, @code{-S=...}).
@item
@code{pid-file} is very important, if you are using @code{mysqld_safe}
to start @code{mysqld} (for example, @code{--mysqld=mysqld_safe}) Every
@code{mysqld} should have its own @code{pid-file}. The advantage
using @code{mysqld_safe} instead of @code{mysqld} directly here is,
that @code{mysqld_safe} ``guards'' every @code{mysqld} process and will
restart it, if a @code{mysqld} process terminates due to a signal
sent using @code{kill -9}, or for other reasons such as a segmentation
fault. Please note that the
@code{mysqld_safe} script may require that you start it from a certain
place. This means that you may have to @code{cd} to a certain directory,
before you start the @code{mysqld_multi}. If you have problems starting,
please see the @code{mysqld_safe} script. Check especially the lines:

@example
--------------------------------------------------------------------------
MY_PWD=`pwd`
# Check if we are starting this relative (for the binary release)
if test -d $MY_PWD/data/mysql -a -f ./share/mysql/english/errmsg.sys -a \
 -x ./bin/mysqld
--------------------------------------------------------------------------
@end example

@xref{mysqld_safe, , @code{mysqld_safe}}.
The above test should be successful, or you may encounter problems.
@item
Beware of the dangers of using multiple @code{mysqld} servers with the same data
directory.  Use separate data directories, unless you @strong{know} what
you are doing!
@xref{Multiple servers}.
@item
The Unix socket file and the TCP/IP port must be different for every
@code{mysqld}.
@item
You may want to use option @code{--user} for @code{mysqld}, but in order to
do this you need to run the @code{mysqld_multi} script as the Unix @code{root}
user. Having the option in the config file doesn't matter; you will
just get a warning, if you are not the superuser and the @code{mysqlds}
are started under @strong{your} Unix account. @strong{Important}: Make
sure that the @code{pid-file} and the data directory are
read+write(+execute for the latter one) accessible for @strong{that}
Unix user, who the specific @code{mysqld} process is started
as. @strong{Do not} use the Unix root account for this, unless you
@strong{know} what you are doing!
@item
@strong{Most important}: Before using @code{mysqld_multi} be sure that you
understand the meanings of
the options that are passed to the @code{mysqld} servers and @strong{why} you
would want to have separate @code{mysqld} processes. Starting multiple
servers with the same data directory @strong{will not} give you extra
performance in a threaded system!
@xref{Multiple servers}.
@end itemize

The following example shows how you might set up an option file for use with
@code{mysqld_multi}.
The first and fifth @code{[mysqld#]} group were intentionally left out from
the example.  You may have ``gaps'' in the option file. This gives you
more flexibility.  The order in which the @code{mysqld} programs are started or
stopped depends on the order in which they appear in the option file.

@example
# This file should probably be in your home dir (~/.my.cnf)
# or /etc/my.cnf
# Version 2.1 by Jani Tolonen

[mysqld_multi]
mysqld     = /usr/local/bin/mysqld_safe
mysqladmin = /usr/local/bin/mysqladmin
user       = multi_admin
password   = multipass

[mysqld2]
socket     = /tmp/mysql.sock2
port       = 3307
pid-file   = /usr/local/mysql/var2/hostname.pid2
datadir    = /usr/local/mysql/var2
language   = /usr/local/share/mysql/english
user       = john

[mysqld3]
socket     = /tmp/mysql.sock3
port       = 3308
pid-file   = /usr/local/mysql/var3/hostname.pid3
datadir    = /usr/local/mysql/var3
language   = /usr/local/share/mysql/swedish
user       = monty

[mysqld4]
socket     = /tmp/mysql.sock4
port       = 3309
pid-file   = /usr/local/mysql/var4/hostname.pid4
datadir    = /usr/local/mysql/var4
language   = /usr/local/share/mysql/estonia
user       = tonu

[mysqld6]
socket     = /tmp/mysql.sock6
port       = 3311
pid-file   = /usr/local/mysql/var6/hostname.pid6
datadir    = /usr/local/mysql/var6
language   = /usr/local/share/mysql/japanese
user       = jani
@end example

@xref{Option files}.


@node Configuring MySQL, Security, Server-Side Scripts, MySQL Database Administration
@section Configuring MySQL

This section discusses MySQL server configuration topics:

@itemize @bullet
@item
Startup options that the server supports.
@item
How to set the server SQL mode.
@end itemize


@menu
* Server options::              @code{mysqld} Command-line Options
* Server SQL mode::             The Server SQL Mode
@end menu


@node Server options, Server SQL mode, Configuring MySQL, Configuring MySQL
@subsection @code{mysqld} Command-line Options

@findex command-line options
@cindex options, command-line
@cindex mysqld options

When you start the @code{mysqld} server, you specify program options
using any of the methods described in @ref{Program Options}. The most
common methods are to provide options in an option file or on the command
line. However, in most cases it is desirable to make sure the server uses
the same options each time it runs. The best way to ensure this is to
specify server options in an option file.
@xref{Option files}.

@code{mysqld} reads options from the @code{[mysqld]} and @code{[server]}
groups.  @code{mysqld_safe} reads options from the @code{[mysqld]},
@code{[server]}, @code{[mysqld_safe]} and @code{[safe_mysqld]}
groups.  @code{mysql.server} reads options from the @code{[mysqld]}
and @code{[mysql.server]} groups.  An embedded MySQL server usually reads
options from the @code{[server]}, @code{[embedded]} and @code{[xxxxx_SERVER]}
groups, where @code{xxxxx} is the name of the application into which the
server is embedded.

@code{mysqld} accepts many command-line options.
For a list, execute @code{mysqld --help}. Before MySQL 4.1.1, @code{--help}
prints the full help message. As of 4.1.1, it prints a brief message; to see
the full list, use @code{mysqld --help --verbose}.

The following list shows some of the most common server options.
Options used for replication are listed in a separate section, see
@ref{Replication Options}.

@table @code
@item --ansi
Use SQL-99 syntax instead of MySQL syntax.  @xref{ANSI mode}.
For more precise control over the server SQL mode, use the @code{--sql-mode}
option instead.

@item --basedir=path, -b path
The path to the installation directory. All paths are usually resolved
relative to this.

@item --big-tables
Allow large result sets by saving all temporary sets on file.  This option
prevents most ``table full'' errors, but also slows down queries for which
in-memory tables would suffice.  Since Version 3.23.2, MySQL is able to
handle large result sets automatically by using memory for small temporary
tables and switching to disk tables where necessary.

@item --bind-address=IP
The IP address to bind to.

@item --console
Write the error log messages to stderr/stdout even if @code{--log-error}
is specified.  On Windows, @code{mysqld} will not close the console screen if
this option is used.

@item --character-sets-dir=path
The directory where character sets are installed.  @xref{Character sets}.

@item --chroot=path
Put the @code{mysqld} server in a closed environment during startup by using the
@code{chroot()} system call. This is a recommended security measure as of
MySQL 4.0. (MySQL 3.23 is not able to provide a @code{chroot()} jail that is
100% closed.)  Note that use of this option somewhat limits @code{LOAD
DATA INFILE} and @code{SELECT ... INTO OUTFILE}.

@item --core-file
Write a core file if @code{mysqld} dies.  For some systems, you must also
specify the @code{--core-file-size} option to @code{mysqld_safe}.
@xref{mysqld_safe,  , @code{mysqld_safe}}.
Note that on some systems, such as Solaris, you will
not get a core file if you are also using the @code{--user} option.

@item --datadir=path, -h path
The path to the data directory.

@item --debug[=...]
If MySQL is configured with @code{--with-debug}, you can use this
option to get a trace file of what @code{mysqld} is doing.
@xref{Making trace files}.

@item --default-character-set=charset
Set the default character set.  @xref{Character sets}.

@item --default-table-type=type
Set the default table type for tables.  @xref{Table types}.

@item --delay-key-write[= OFF | ON | ALL]
How the @code{DELAYED KEYS} option should be used.
Delayed key writing causes key buffers not to be flushed between writes for
@code{MyISAM} tables.
@code{OFF} disables delayed key writes.
@code{ON} enables delayed key writes for those tables that were created with
the @code{DELAYED KEYS} option.
@code{ALL} delays key writes for all @code{MyISAM} tables.
Available as of MySQL 4.0.3.
@xref{Server parameters}.

@item --delay-key-write-for-all-tables
Old form of @code{--delay-key-write=ALL} for use prior to MySQL 4.0.3.
As of 4.0.3, use @code{--delay-key-write} instead.

@item --des-key-file=filename
Read the default keys used by @code{DES_ENCRYPT()} and @code{DES_DECRYPT()}
from this file.

@item --enable-external-locking
Enable system locking.  Note that if you use this option on a system on
which @code{lockd} does not fully work (as on Linux), you will easily get
@code{mysqld} to deadlock.
This option used to be named @code{--enable-locking}.

@item --enable-named-pipe
Enable support for named pipes.
This option applies only on Windows NT, 2000, and XP systems, and may be used
only with the @code{mysqld-nt} and @code{mysqld-max-nt} servers that support
named pipe connections.

@item --exit-info, -T
This is a bit mask of different flags you can use for debugging the
@code{mysqld} server. Do not use this option unless you know
exactly what it does!

@item --flush
Flush all changes to disk after each SQL statement.  Normally MySQL
only does a write of all changes to disk after each SQL statement and lets
the operating system handle the syncing to disk.
@xref{Crashing}.

@item --help, -?
Display a short help message and exit.
Prior to MySQL 4.1.1, @code{--help} displays the full help message.
As of 4.1.1, it displays an abbreviated message only.  Use both the
@code{--verbose} and @code{--help} options to see the full message.

@item --init-file=file
Read SQL statements from this file at startup.

@item --language=lang_name, -L lang_name
Client error messages in given language.  @code{lang_name} may be given as the
language name or as the full pathname to the directory where the language
files are installed.
@xref{Languages}.

@item --log[=file], -l [file]
Log connections and queries to this file. @xref{Query log}. If you don't
specify a file name, MySQL will use @code{hostname.log} as filename.

@item --log-bin=[file]
Log all queries that change data to this file. Used for backup and
replication.  @xref{Binary log}.  If you don't specify a file name,
MySQL will use @code{hostname-bin} as filename.

@item --log-bin-index[=file]
The index file for binary log file names. @xref{Binary log}.
If you don't specify file name, MySQL will use @code{hostname-bin.index} as
filename.

@item --log-error[=file]
Log errors and startup messages to this file. @xref{Error log}.
If you don't specify file name, MySQL will use @code{hostname.err} as filename.

@item --log-isam[=file]
Log all @code{ISAM}/@code{MyISAM} changes to this file (used only when
debugging @code{ISAM}/@code{MyISAM}).

@c UPDATE START
@item --log-long-format
Log some extra information to the log files (update log, binary update log,
and slow queries log, whatever log has been activated). For example, 
username and timestamp are logged for queries. If you are using 
@code{--log-slow-queries} and @code{--log-long-format}, then
queries that are not using indexes also are logged to the slow query log.
Note that @code{--log-long-format} is deprecated as of MySQL version
4.1, when @code{--log-short-format} was introduced (the long log format
is the default setting since version 4.1). Also note that starting with 
MySQL 4.1 the @code{--log-queries-not-using-indexes} option is available 
for the purpose of logging queries that do not use indexes to the slow 
queries log.
@c UPDATE STOP

@c INSERT START
@item --log-queries-not-using-indexes
If you are using this option with @code{--log-slow-queries}, then also 
queries that are not using indexes are logged to the slow query log. This 
option is available as of MySQL 4.1. @xref{Slow query log}.

@item --log-short-format
Log less information to the log files (update log, binary update log, 
and slow queries log, whatever log has been activated). For example, 
username and timestamp are not logged for queries. This options was 
introduced in MySQL 4.1.
@c INSERT STOP

@c UPDATE START
@item --log-slow-queries[=file]
Log all queries that have taken more than @code{long_query_time} seconds 
to execute to file. Note that the default for the amount of information 
logged has changed in MySQL 4.1. See the @code{--log-long-format} and 
@code{--log-long-format} options for details. @xref{Slow query log}.
@c UPDATE STOP

@item --log-update[=file]
Log updates to @code{file.#} where @code{#} is a unique number if not
given. @xref{Update log}. The update log is deprecated and is
removed in MySQL 5.0.0; you should use the binary log instead
(@code{--log-bin}). @xref{Binary log}. Starting from version 5.0.0,
using @code{--log-update} will just turn on the binlog instead
(@pxref{News-5.0.0}).

@item --log-warnings, -W
Print out warnings like @code{Aborted connection...} to the
@file{.err} file. Enabling this option is recommended, for example, if you
use replication (you will get more information about what is happening,
such as messages about network failures and reconnections). @xref{Communication errors}.

This option used to be called @code{--warnings}.

@item --low-priority-updates
Table-modifying operations (@code{INSERT}/@code{DELETE}/@code{UPDATE})
will have lower priority than selects.  It can also be done via
@code{@{INSERT | REPLACE | UPDATE | DELETE@} LOW_PRIORITY ...} to lower
the priority of only one query, or by
@code{SET LOW_PRIORITY_UPDATES=1} to change the priority in one
thread.  @xref{Table locking}.

@item --memlock
Lock the @code{mysqld} process in memory.  This works on systems such as
Solaris that support the @code{mlockall()} system call.  This
may help if you have a problem where the operating system is causing
@code{mysqld} to swap on disk.
Note that use of this option requires that you run the server as @code{root},
which is normally not a good idea for security reasons.

@item --myisam-recover [=option[,option...]]]
Set the @code{MyISAM} storage engine recovery mode.
The option value is any combination of the values
of @code{DEFAULT}, @code{BACKUP}, @code{FORCE} or @code{QUICK}.
If you specify multiple values, seprate them by commas.
You can also use a value of @code{""} to disable this
option. If this option is used, @code{mysqld} will on open check if the
table is marked as crashed or if the table wasn't closed properly.
(The last option works only if you are running with
@code{--skip-external-locking}.)  If this is the case @code{mysqld} will run
check on the table. If the table was corrupted, @code{mysqld} will
attempt to repair it.

The following options affects how the repair works.

@multitable @columnfractions .15 .7
@item @strong{Option} @tab @strong{Description}
@item @code{DEFAULT} @tab The same as not giving any option to
                    @code{--myisam-recover}.
@item @code{BACKUP} @tab If the data table was changed during recover, save a
                    backup of the @file{table_name.MYD} datafile as
                    @file{table_name-datetime.BAK}.
@item @code{FORCE}  @tab Run recover even if we will lose more than one row
                    from the @file{.MYD} file.
@item @code{QUICK}  @tab Don't check the rows in the table if there aren't any
                    delete blocks.
@end multitable

Before a table is automatically repaired, MySQL will add a note
about this in the error log.  If you want to be able to recover from most
problems without user intervention, you should use the options
@code{BACKUP,FORCE}.  This will force a repair of a table even if some rows
would be deleted, but it will keep the old datafile as a backup so that
you can later examine what happened.

@item --new
From version 4.0.12, the @code{--new} option can be used to make the server
behave as 4.1 in certain respects, easing a 4.0 to 4.1 upgrade:
@itemize @bullet
@item
@code{TIMESTAMP} is returned as a string with the format
@code{'YYYY-MM-DD HH:MM:SS'}.
@xref{Column types}.
@end itemize

This option can be used to help you see how your applications will behave in
MySQL 4.1, without actually upgrading to 4.1.

@item --pid-file=path
The path to pid file used by @code{mysqld_safe}.

@item --port=num, -P num
The port number to listen for TCP/IP connections.

@item --old-protocol, -o
Use the 3.20 protocol for compatibility with some very old clients.
@xref{Upgrading-from-3.20}.

@item --one-thread
Only use one thread (for debugging under Linux).
This option is available only if the server is built with debugging enabled.
@xref{Debugging server}.

@item --open-files-limit=
To change the number of file descriptors available to @code{mysqld}.
If this is not set or set to 0, then @code{mysqld} will use this value
to reserve file descriptors to use with @code{setrlimit()}.  If this
value is 0 then @code{mysqld} will reserve @code{max_connections*5} or
@code{max_connections + table_cache*2} (whichever is larger) number of
files.  You should try increasing this if @code{mysqld} gives you the
error 'Too many open files'.

@item --set-variable=name=value, -O value
Assign a value to a system variable.  Use @code{--help} to list the
variables.  You can find a full description for all variables in the
@code{SHOW VARIABLES} section in this manual.  @xref{SHOW VARIABLES,  ,
@code{SHOW VARIABLES}}.  The section on tuning server parameters includes
information on how to optimize them.  @xref{Server parameters}.

Please note that @code{--set-variable=name=value} and @code{-O name=value}
syntax is deprecated as of MySQL 4.0.2.  In 4.0.2, you can set variables
directly using @code{--variable-name=value} syntax, and @code{--set-variable}
is no longer needed.

If you want to restrict the maximum value a startup option can be set to
with @code{SET}, you can define this by using the
@code{--maximum-variable-name} command line option.
@xref{SET OPTION,  , @code{SET OPTION}}.

Note that when setting a variable to a value, MySQL may automatically
correct it to stay within a given range, or adjust the value to the
closest allowable value if only certain values are allowed.

@item --safe-mode
Skip some optimize stages.

@item --safe-show-database
With this option, the @code{SHOW DATABASES} statement returns only those
databases for which the user has some kind of privilege.
From version 4.0.2 this option is deprecated and doesn't do anything
(the option is enabled by default) as we now have the
@code{SHOW DATABASES} privilege. @xref{GRANT,  , @code{GRANT}}.

@item --safe-user-create
If this is enabled, a user can't create new users with the @code{GRANT}
statement, if the user doesn't have @code{INSERT} privilege to the
@code{mysql.user} table or any column in this table.

@item --skip-bdb
Disable the @code{BDB} storage engine. This saves memory and may speed
up some operations.
Do not use this operation if you require @code{BDB} tables.

@item --skip-concurrent-insert
Turn off the ability to select and insert at the same time on @code{MyISAM}
tables. (This is only to be used if you think you have found a bug in this
feature.)

@item --skip-delay-key-write
Ignore the @code{DELAY_KEY_WRITE} option for all tables.
As of MySQL 4.0.3, you should use @code{--delay-key-write=OFF} instead.
@xref{Server parameters}.

@item --skip-external-locking
Don't use system locking.  To use @code{isamchk} or @code{myisamchk} you must
shut down the server.  @xref{Stability}.  Note that in MySQL Version
3.23, you can use @code{CHECK TABLE} and @code{REPAIR TABLE} to check and repair@code{MyISAM} tables.
This option used to be named @code{--skip-locking}.

@item --skip-grant-tables
This option causes the server not to use the privilege system at all.  This
gives everyone @strong{full access} to all databases!  (You can tell a running
server to start using the grant tables again by executing a @code{mysqladmin
flush-privileges} or @code{mysqladmin reload} command, or by issuing a
@code{FLUSH PRIVILEGES} statement.)

@item --skip-host-cache
Do not use the internal hostname cache for faster name-IP resolution. Instead,
query the DNS server every time a client connects.  @xref{DNS}.

@item --skip-innodb
Disable the @code{InnoDB} storage engine.  This saves memory and disk
space and may speed up some operations.
Do not use this operation if you require @code{InnoDB} tables.

@item --skip-isam
Disable the @code{ISAM} storage engine.  As of MySQL 4.1, @code{ISAM} is
disabled by default, so this option applies only if the server was configured
with support for @code{ISAM}.
This option was added in MySQL 4.1.1.

@item --skip-name-resolve
Do not resolve hostnames when checking client connections. Use only IP
numbers. If you use this option, all @code{Host} column values in the
grant tables must be IP numbers or @code{localhost}.  @xref{DNS}.

@item --skip-networking
Don't listen for TCP/IP connections at all.  All interaction with
@code{mysqld} must be made via named pipes (on Windows) or Unix socket files
(on Unix).  This option is highly recommended for systems where only local
clients are allowed.  @xref{DNS}.

@item --skip-new
Don't use new, possibly wrong routines.

@item --skip-symlink
This is the old form of @code{--skip-symbolic-links}, for use before MySQL
4.0.13.

@item --symbolic-links, --skip-symbolic-links
Enable or disable symbolic link support. This option has different effects on
Windows and Unix:

@itemize @bullet
@item
On Windows, enabling symbolic links allows you to establish a symbolic
link to a database directory by creating a
@code{directory.sym} file that contains the path to the real directory.
@xref{Windows symbolic links}.

@item
On Unix, enabling symbolic links means that you can link a
@code{MyISAM} index file or datafile to another directory with
the @code{INDEX DIRECTORY} or @code{DATA DIRECTORY} options of the
@code{CREATE TABLE} statement.  If you delete or rename the table,
the files that its symbolic links point to also are deleted or
renamed. @xref{CREATE TABLE,  , @code{CREATE TABLE}}.
@end itemize

This option was added in MySQL 4.0.13.

@item --skip-safemalloc
If MySQL is configured with @code{--with-debug=full}, all MySQL programs
checks for memory overruns during each memory allocation and memory
freeing operation.  This checking is very slow, so for the server you
can avoid it when you don't need it by using the @code{--skip-safemalloc}
option.

@item --skip-show-database
Don't allow the @code{SHOW DATABASES} statement, unless the user has the
@code{SHOW DATABASES} privilege.

@item --skip-stack-trace
Don't write stack traces.  This option is useful when you are running
@code{mysqld} under a debugger. On some systems, you also must use
this option to get a core file. @xref{Debugging server}.

@item --skip-thread-priority
Disable using thread priorities for faster response time.

@item --socket=path
@c Put the Unix description first, because the option name relates directly
@c to the Unix meaning. Putting the Windows meaning first makes this more
@c confusing.
On Unix, this option specifies the Unix socket file to
use for local connections. The default value is @file{/tmp/mysql.sock}.
On Windows, the option specifies the pipe name to use for local connections
that use a named pipe. The default value is @code{MySQL}.

@c TODO: some of these option values currently are unimplemented.
@c Need to say which ones.

@item --sql-mode=value[,value[,value...]]
Set the SQL mode for MySQL. @xref{SQL mode}. This option was added in 3.23.41.

@item --temp-pool
This option causes most temporary files created by the
server to use a small set of names, rather than a unique name for
each new file. This works around a problem in the Linux kernel
dealing with creating many
new files with different names. With the old behavior, Linux seems to
``leak'' memory, as it's being allocated to the directory entry cache
rather than to the disk cache.

@item --transaction-isolation=level
Sets the default transaction isolation level, which may be
@code{READ-UNCOMMITTED},
@code{READ-COMMITTED},
@code{REPEATABLE-READ}, or
@code{SERIALIZABLE}.
@xref{SET TRANSACTION, , @code{SET TRANSACTION}}.

@item --tmpdir=path, -t path
The path of the directory to use for creating temporary files. It may be
useful if your default @code{/tmp} directory resides on a partition that
is too small to hold temporary tables.  Starting from MySQL 4.1, this
option accepts several paths that are used in round-robin fashion. Paths
should be separated by colon characters (@samp{:}) on Unix and semicolon
characters (@samp{;}) on Windows.  It is possible to set @code{tmpdir}
to point to a memory-based filesystem, except if the MySQL server is a
slave replication server. If it is a slave, some of its temporary files
are needed to survive a machine's reboot.  (For example, to replicate
temporary tables or @code{LOAD DATA INFILE} statements).  In this case,
a memory-based @code{tmpdir} that is cleared when the machine reboots is
not suitable; a disk-based @code{tmpdir} is necessary.

@item --user=@{user_name | user_id@}, -u @{user_name | user_id@}
Run the @code{mysqld} server as the user having the name @code{user_name} or
the numeric user ID @code{user_id}.
(``User'' in this context refers to a system login account, not a MySQL user
listed in the grant tables.)

This option is @strong{mandatory} when starting @code{mysqld} as @code{root}.
The server will change its user ID during its startup sequence, causing it
to run as that particular user rather than as @code{root}.
@xref{Security guidelines}.

Starting from MySQL 3.23.56 and 4.0.12:
To avoid a possible security hole where a user adds a @code{--user=root}
option to some @file{my.cnf} file (thus causing the server to run as
@code{root}), @code{mysqld} uses only the first
@code{--user} option specified and produces a warning if there are multiple
@code{--user} options. Options in @file{/etc/my.cnf} and
@file{datadir/my.cnf} are processed before
command-line options, so it is recommended that you
put a @code{--user} option in @file{/etc/my.cnf} and specify a value other than
@code{root}. The option in @file{/etc/my.cnf} will be found before any other
@code{--user} options, which ensures that the server runs as a user other
than @code{root}, and that a warning results if any other @code{--user} option
is found.

@item --version, -V
Display version information and exit.
@end table

You can change the values of most system variables for a running server with the
@code{SET} statement. @xref{SET OPTION, , @code{SET OPTION}}.

@node Server SQL mode,  , Server options, Configuring MySQL
@subsection The Server SQL Mode

The MySQL server can operate in different SQL modes, and (as of MySQL 4.1)
can apply these
modes differentially for different clients. This allows applications to
tailor server operation to their own requirements.

Modes define what SQL syntax MySQL should support and what kind of data
validation checks it should perform.  This makes it easier
to use MySQL in different environments and to use MySQL together
with other database servers.

You can set the default SQL mode by starting @code{mysqld} with the
@code{--sql-mode="modes"} option. Beginning with MySQL 4.1, you can also
change the mode after startup time by setting the @code{sql_mode} variable
with a @code{SET [SESSION|GLOBAL] sql_mode='modes'} statement.
Setting the @code{GLOBAL} variable affects the operation of all clients that
connect from that time on. Setting the @code{SESSION} variable affects only
the current client.
@code{modes} is a list of different modes separated by comma (@samp{,})
characters.
You can retrieve the current mode by issuing a @code{SELECT @@@@sql_mode}
statement. The default value is empty (no modes set).

The value also can be empty
(@code{--sql-mode=""}) if you want to reset it.

The following table lists the supported modes. The @strong{Version} column
indicates when each mode value was implemented.

@multitable @columnfractions .20 .10 .70
@item @strong{Value} @tab @strong{Version} @tab @strong{Meaning}
@item @code{ANSI_QUOTES} @tab 4.0.0 @tab Treat @samp{"} as an identifier quote character (like the MySQL Server @samp{`} quote character) and not as a string quote character. You can still use @samp{`} to quote identifers in ANSI mode. With @code{ANSI_QUOTES} enabled, you cannot use double quotes to quote a literal string, because it will be intepreted as an identifier.
@item @code{IGNORE_SPACE} @tab 4.0.0 @tab Allow spaces between a function name and the @samp{(} character.  This forces all function names to be treated as reserved words. As a result, if you want to access any database, table, or column name that is a reserved word, you must quote it.  For example, because there is a @code{USER()} function, the name of the @code{user} table in the @code{mysql} database and the @code{User} column in that table become reserved, so you must quote them:
@example
SELECT "User" FROM mysql."user";
@end example
@item @code{NO_AUTO_VALUE_ON_ZERO} @tab 4.1.1 @tab
@code{NO_AUTO_VALUE_ON_ZERO} affects handling of @code{AUTO_INCREMENT}
columns. Normally, you generate the next sequence number for the column by
inserting either @code{NULL} or @code{0} into it. @code{NO_AUTO_VALUE_ON_ZERO}
suppresses this behavior for @code{0} so that only @code{NULL} generates
the next sequence number. This mode can be useful if @code{0} has been
stored in a table's @code{AUTO_INCREMENT} column. (This is not a recommended
practice,
by the way.)  For example, if you dump the table with @code{mysqldump} and
then reload it, normally MySQL will generate new sequence numbers when it
encounters the @code{0} values, resulting in a table with different contents
than the one that was dumped. Enabling @code{NO_AUTO_VALUE_ON_ZERO} before
reloading the dump file solves this problem. (As of MySQL 4.1.1,
@code{mysqldump} automatically includes statements in the dump output to enable
@code{NO_AUTO_VALUE_ON_ZERO}.)
@item @code{NO_DIR_IN_CREATE} @tab 4.0.15 @tab When creating a table, ignore all @code{INDEX DIRECTORY} and @code{DATA DIRECTORY} directives. This option is useful on slave replication servers.
@item @code{NO_FIELD_OPTIONS} @tab 4.1.1 @tab Don't print MySQL field-specific options in the output of @code{SHOW CREATE TABLE}. This mode is used by @code{mysqldump} in portability mode.
@item @code{NO_KEY_OPTIONS} @tab 4.1.1 @tab Don't print MySQL index-specific options in the output of @code{SHOW CREATE TABLE}. This mode is used by @code{mysqldump} in portability mode.
@item @code{NO_TABLE_OPTIONS} @tab 4.1.1 @tab Don't print MySQL table-specific options (such as @code{ENGINE}) in the output of @code{SHOW CREATE TABLE}. This mode is used by @code{mysqldump} in portability mode.
@item @code{NO_UNSIGNED_SUBTRACTION} @tab 4.0.2 @tab In subtraction operations, don't mark the result as @code{UNSIGNED} if one of the operands is unsigned. Note that this makes @code{UNSIGNED BIGINT} not 100% usable in all contexts. @xref{Cast Functions}.
@item @code{ONLY_FULL_GROUP_BY} @tab 4.0.0 @tab Don't allow queries which in the @code{GROUP BY} part refers to a not selected column.
@item @code{PIPES_AS_CONCAT} @tab 4.0.0 @tab Treat @code{||} as a string concatenation operator (same as @code{CONCAT()}) rather than as a synonym for @code{OR}.
@item @code{REAL_AS_FLOAT} @tab 4.0.0 @tab Treat @code{REAL} as a synonym for @code{FLOAT} rather than as a synonym for @code{DOUBLE}.
@end multitable


The following special modes are provided as shorthand for combinations of
mode values from the preceding table:

@multitable @columnfractions .20 .10 .70
@item @strong{Value} @tab @code{Version} @tab @strong{Meaning}
@item @code{ANSI} @tab 4.1.1 @tab @code{REAL_AS_FLOAT,PIPES_AS_CONCAT,ANSI_QUOTES,IGNORE_SPACE,ONLY_FULL_GROUP_BY}. @xref{ANSI mode}.
@item @code{DB2} @tab 4.1.1 @tab @code{PIPES_AS_CONCAT,ANSI_QUOTES,IGNORE_SPACE,NO_KEY_OPTIONS,NO_TABLE_OPTIONS,NO_FIELD_OPTIONS}
@item @code{DB2} @tab 4.1.1 @tab @code{PIPES_AS_CONCAT,ANSI_QUOTES,IGNORE_SPACE,NO_KEY_OPTIONS,NO_TABLE_OPTIONS,NO_FIELD_OPTIONS}
@item @code{MAXDB} @tab 4.1.1 @tab @code{PIPES_AS_CONCAT,ANSI_QUOTES,IGNORE_SPACE,NO_KEY_OPTIONS,NO_TABLE_OPTIONS,NO_FIELD_OPTIONS}
@item @code{MSSQL} @tab 4.1.1 @tab @code{PIPES_AS_CONCAT,ANSI_QUOTES,IGNORE_SPACE,NO_KEY_OPTIONS,NO_TABLE_OPTIONS,NO_FIELD_OPTIONS}
@item @code{MYSQL323} @tab 4.1.1 @tab @code{NO_FIELD_OPTIONS}
@item @code{MYSQL40} @tab 4.1.1 @tab @code{NO_FIELD_OPTIONS}
@item @code{ORACLE} @tab 4.1.1 @tab @code{PIPES_AS_CONCAT,ANSI_QUOTES,IGNORE_SPACE,NO_KEY_OPTIONS,NO_TABLE_OPTIONS,NO_FIELD_OPTIONS}
@item @code{POSTGRESQL} @tab 4.1.1 @tab @code{PIPES_AS_CONCAT,ANSI_QUOTES,IGNORE_SPACE,NO_KEY_OPTIONS,NO_TABLE_OPTIONS,NO_FIELD_OPTIONS}
@end multitable


@node Security, Privilege system, Configuring MySQL, MySQL Database Administration
@section General Security Issues

@cindex system, security

This section describes some general security issues to be aware of and what
you can do to make your MySQL installation more secure against attack or
misuse. For information specifically about the access control system that
MySQL uses for setting up user accounts and checking database access, see
@ref{Privilege system}.

@menu
* Security guidelines::         General Security Guidelines
* Security against attack::     Making MySQL Secure Against Attackers
* Privileges options::          Startup Options for @code{mysqld} Concerning Security
* LOAD DATA LOCAL::             Security Issues with @code{LOAD DATA LOCAL}
@end menu


@node Security guidelines, Security against attack, Security, Security
@subsection General Security Guidelines

Anyone using MySQL on a computer connected to the Internet
should read this section to avoid the most common security mistakes.

In discussing security, we emphasize the necessity of fully protecting the
entire server host (not just the MySQL server) against all types
of applicable attacks: eavesdropping, altering, playback, and denial of
service. We do not cover all aspects of availability and fault tolerance
here.

MySQL uses security based on Access Control Lists (ACLs) for all
connections, queries, and other operations that users may attempt to
perform. There is also some support for SSL-encrypted connections
between MySQL clients and servers. Many of the concepts
discussed here are not specific to MySQL at all; the same
general ideas apply to almost all applications.

When running MySQL, follow these guidelines whenever possible:

@itemize @bullet
@item
@strong{Do not ever give anyone (except MySQL @code{root} accounts) access to the
@code{user} table in the @code{mysql} database!}  This is critical.
@strong{The encrypted password is the real password in MySQL.}
Anyone who knows the password which is listed in the @code{user} table
and has access to the host listed for the account @strong{can easily log
in as that user}.

@item
Learn the MySQL access privilege system. The @code{GRANT} and
@code{REVOKE} statements are used for controlling access to MySQL. Do
not grant any more privileges than necessary. Never grant privileges to all
hosts.

Checklist:
@itemize @minus
@item
Try @code{mysql -u root}. If you are able to connect successfully to the
server without being asked for a password, you have problems. Anyone
can connect to your MySQL server as the MySQL
@code{root} user with full privileges!
Review the MySQL installation instructions, paying particular
attention to the item about setting a @code{root} password.
@item
Use the @code{SHOW GRANTS} statement and check to see who has access to
what.  Then use the @code{REVOKE} statement to remove those privileges that
are not necessary.
@end itemize

@item
Do not store any plain-text passwords in your database. If your
computer becomes compromised, the intruder can take the full list of
passwords and use them. Instead, use @code{MD5()}, @code{SHA1()} or
some other one-way hashing function.
@item
Do not choose passwords from dictionaries. There are special programs to
break them. Even passwords like ``xfish98'' are very bad.  Much better is
``duag98'' which contains the same word ``fish'' but typed one key to the
left on a standard QWERTY keyboard. Another method is to use ``Mhall'' which
is taken from the first characters of each word in the sentence ``Mary had
a little lamb.'' This is easy to remember and type, but difficult to guess
for someone who does not know it.
@item
Invest in a firewall. This protects you from at least 50% of all types of
exploits in any software. Put MySQL behind the firewall or in
a demilitarized zone (DMZ).

Checklist:
@itemize @minus
@item
Try to scan your ports from the Internet using a tool such as
@code{nmap}. MySQL uses port 3306 by default. This port should
not be accessible from untrusted hosts. Another simple way to check whether
or not your MySQL port is open is to try the following command
from some remote machine, where @code{server_host} is the host where
your MySQL server runs:

@example
shell> telnet server_host 3306
@end example

If you get a connection and some garbage characters, the port is
open, and should be closed on your firewall or router, unless you really
have a good reason to keep it open. If @code{telnet} just hangs or the
connection is refused, everything is OK; the port is blocked.
@end itemize

@item
Do not trust any data entered by users of your applications. They can try to trick your
code by entering special or escaped character sequences in web forms,
URLs, or whatever application you have built. Be sure that your
application remains secure if a user enters something like ``@code{; DROP
DATABASE mysql;}''. This is an extreme example, but large security leaks
and data loss may occur as a result of hackers using similar techniques,
if you do not prepare for them.

A common mistake is to protect only string data values.  Remember to check
numeric data as well.  If an application generates a query such as
@code{SELECT * FROM table WHERE ID=234} when a user enters the value
@code{234}, the user can enter the value @code{234 OR 1=1} to cause the
application to generate the query @code{SELECT * FROM table WHERE ID=234 OR
1=1}.  As a result, the server retrieves every record in the table.  This
exposes every record and causes excessive server load.  The simplest way to
protect from this type of attack is to use apostrophes around the numeric
constants: @code{SELECT * FROM table WHERE ID='234'}. If the user enters
extra information, it all becomes part of the string. In numeric context,
MySQL automatically converts this string to a number and strips any trailing
non-numeric characters from it.

Sometimes people think that if a database contains only publicly available
data, it need not be protected. This is incorrect.  Even if it is allowable
to display any record in the database, you should still protect against
denial of service attacks (for example, those that are based on the
technique in the preceding paragraph that causes the server to waste
resources). Otherwise, your server becomes unresponsive to legitimate users.

Checklist:
@itemize @minus
@item
Try to enter @samp{'} and @samp{"} in all your web forms. If you get any kind
of MySQL error, investigate the problem right away.
@item
Try to modify any dynamic URLs by adding @code{%22} (@samp{"}), @code{%23}
(@samp{#}), and @code{%27} (@samp{'}) in the URL.
@item
Try to modify datatypes in dynamic URLs from numeric ones to character
ones containing characters from previous examples. Your application
should be safe against this and similar attacks.
@item
Try to enter characters, spaces, and special symbols rather than numbers in
numeric fields. Your application should remove them before passing them to
MySQL or else generate an error. Passing
unchecked values to MySQL is very dangerous!
@item
Check data sizes before passing them to MySQL.
@item
Consider having your application connect to the database using a
different username than the one you use for administrative purposes. Do
not give your applications any access privileges they do not need.
@end itemize
@item
Many application programming interfaces provide the means of escaping special
characters in data values. Properly used, this prevents application users from
entering values that cause the application to generate statements that have a
different effect than you intend:
@itemize @minus
@item
Users of PHP:
Use the @code{mysql_escape_string()} function, which
is based on the function of the same name in the MySQL C API.
Prior to PHP 4.0.3, use  @code{addslashes()} instead.
@item
Users of MySQL C API:
Use the @code{mysql_real_escape_string()} API call.
@item
Users of MySQL++:
Use the @code{escape} and @code{quote} modifiers for query streams.
@item
Users of Perl DBI:
Use the @code{quote()} method or use placeholders.
@item
Users of Java JDBC:
Use a @code{PreparedStatement} object and placeholders.
@end itemize

Other programming interfaces may have similar capabilities.

@item
Do not transmit plain (unencrypted) data over the Internet. This information is
accessible to everyone who has the time and ability to intercept it and use
it for their own purposes. Instead, use an encrypted protocol such as SSL or
SSH. MySQL supports internal SSL connections as of Version 4.0.0.
SSH port-forwarding can be used to create an encrypted (and compressed)
tunnel for the communication.
@item
Learn to use the @code{tcpdump} and @code{strings} utilities. For most cases,
you can check whether MySQL data streams are unencrypted
by issuing a command like the following:

@example
shell> tcpdump -l -i eth0 -w - src or dst port 3306 | strings
@end example

(This works under Linux and should work with small modifications under other
systems.)  Warning: If you do not see plaintext data, this doesn't always
mean that the information actually is encrypted. If you need high security,
you should consult with a security expert.
@end itemize


@node Security against attack, Privileges options, Security guidelines, Security
@subsection Making MySQL Secure Against Attackers

@cindex attackers, security against
@cindex security, against attackers

When you connect to a MySQL server, you should use a password.  The password
is not transmitted in clear text over the connection. Password handling during
the client connection sequence was upgraded in MySQL 4.1.1 to be very secure.
If you are using an older version of MySQL, or are still using pre-4.1.1-style
passwords, the encryption
algorithm is less strong and with some effort a clever attacker that can
sniff the traffic between the client and the server can crack the password.
(See @ref{Password hashing} for a discussion of the different password handling
methods.)
If the connection between the client and the server goes through an
untrusted network, you should use an SSH tunnel to encrypt the communication.

All other information is transferred as text that can be read by anyone who
is able to watch the connection.  If you are concerned about this, you can
use the compressed protocol (in MySQL Version 3.22 and above) to make
traffic much more difficult to decipher.  To make the connection even more
secure, you should use SSH to get an encrypted TCP/IP connection between a
MySQL server and a MySQL client.  You can find an @code{Open Source} SSH
client at @uref{http://www.openssh.org/}, and a commercial SSH client at
@uref{http://www.ssh.com/}.

If you are using MySQL 4.0 or newer, you can also use internal OpenSSL support.
@xref{Secure connections}.

To make a MySQL system secure, you should strongly consider the
following suggestions:

@itemize @bullet
@item
Use passwords for all MySQL users. A client program does not necessarily
know the identify of the person running it. It is common for client/server
applications that the user may specify any username to the client program.
For example, anyone can use the @code{mysql} program to connect as any other
person simply by invoking it as @code{mysql -u other_user db_name} if
@code{other_user} has no password. If all users have a password,
connecting using another user's account becomes much more difficult.

To change the password for a user, use the @code{SET PASSWORD} statement.
It is also possible to update the @code{user} table in the @code{mysql}
database directly.  For example, to change the password of all MySQL accounts
that have a username of @code{root}, do this:

@example
shell> mysql -u root mysql
mysql> UPDATE user SET Password=PASSWORD('new_password')
    -> WHERE user='root';
mysql> FLUSH PRIVILEGES;
@end example

@item
Don't run the MySQL server as the Unix @code{root} user.  This is
very dangerous, because any user with the @code{FILE} privilege will be able
to create files as @code{root} (for example, @code{~root/.bashrc}). To
prevent this, @code{mysqld} refuses to run as @code{root} unless that
is specified explicitly using a @code{--user=root} option.

@code{mysqld} can be run as an ordinary unprivileged user instead.
You can also create a separate Unix account named @code{mysql} to make
everything even more secure (use the account only for administering MySQL).
To start @code{mysqld} as another Unix user, add a @code{user}
option that specifies the username to the @code{[mysqld]} group of the
@file{/etc/my.cnf} option file or the @file{my.cnf} option file in the
server's data directory. For example:

@example
[mysqld]
user=mysql
@end example

This causes the server to start as the designated user whether you
start it manually or by using @code{mysqld_safe} or @code{mysql.server}.
For more details, see @ref{Changing MySQL user}.

Note that running @code{mysql} as a Unix user other than @code{root} does not
mean that you need to change the @code{root} username in the @code{user}
table. Usernames for MySQL accounts have nothing to do with usernames for Unix
accounts.

@item
Don't allow the use of symlinks to tables. (This can be disabled with the
@code{--skip-symlink} option.) This is especially important if you run
@code{mysqld} as @code{root}, because anyone that has write access to the
server's data directory could then delete any file in the system!
@xref{Symbolic links to tables}.

@item
Make sure that the only Unix user with read or write privileges in the
database directories is the user that @code{mysqld} runs as.

@item
Don't grant the @code{PROCESS} privilege to non-administrative users.
The output of @code{mysqladmin processlist} shows the text of the currently
executing queries, so any user who is allowed to execute that command
might be able to see if another user issues an @code{UPDATE user SET
password=PASSWORD('not_secure')} query.

@code{mysqld} reserves an extra connection for users who have the
@code{PROCESS} privilege, so that a MySQL @code{root} user can log
in and check server activity even if all normal connections are in use.

@item
Don't grant the @code{SUPER} privilege to non-administrative users.
It can be used to terminate client connections, change server operation by
changing the value of system variables, and control replication servers.

@item
Don't grant the @code{FILE} privilege to non-administrative users.
Any user that has this privilege can write a file anywhere in the
filesystem with the privileges of the @code{mysqld} daemon!  To make
this a bit safer, files generated with @code{SELECT ... INTO OUTFILE}
will not overwrite existing files and are writable by everyone.

@tindex @file{/etc/passwd}

The @code{FILE} privilege may also be used to read any file that is
world-readable or accessible to the Unix user that the server runs as.
With this privilege, you can read any file into a database table.
This could be abused, for example, by using @code{LOAD DATA} to load
@file{/etc/passwd} into a table, which then can be displayed with
@code{SELECT}.

@item
If you don't trust your DNS, you should use IP numbers rather than
hostnames in the grant tables. In any case, you should be very careful
about creating grant table entries using hostname values that contain
wildcards!

@item
If you want to restrict the number of connections allowed to a single account,
you can do so by setting the @code{max_user_connections} variable in
@code{mysqld}.
The @code{GRANT} statement also supports resource control options for limiting
the extent of server use allowed to an account.
@end itemize


@node Privileges options, LOAD DATA LOCAL, Security against attack, Security
@subsection Startup Options for @code{mysqld} Concerning Security

@c TODO: There may be overlap between this and the section that has
@c the general server option list...

The following @code{mysqld} options affect security:

@table @code
@item --local-infile[=@{0|1@}]
If you start the server with @code{--local-infile=0}, clients cannot use
@code{LOCAL} in @code{LOAD DATA} statements.
@xref{LOAD DATA LOCAL,  , @code{LOAD DATA LOCAL}}.

@item --safe-show-database
With this option, the @code{SHOW DATABASES} statement displays the names
of only those databases for which the user has some kind of privilege.
As of version 4.0.2, this option is deprecated and doesn't do anything
(it is enabled by default), because there is now a @code{SHOW DATABASES}
privilege that can be used to control access to database
names on a per-account basis. @xref{GRANT,  , @code{GRANT}}.

@item --safe-user-create
If this is enabled, a user cannot create new users with the @code{GRANT}
statement unless the user has the @code{INSERT} privilege for the
@code{mysql.user} table.  If you want a user to have the ability to create
new users with those privileges that the user has right to grant, you should
grant the user the following privilege:

@example
mysql> GRANT INSERT(user) ON mysql.user TO 'user'@@'hostname';
@end example

This will ensure that the user can't change any privilege columns directly,
but has to use the @code{GRANT} statement to give privileges to other users.

@item --skip-grant-tables
This option causes the server not to use the privilege system at all. This
gives everyone @strong{full access} to all databases!  (You can tell a running
server to start using the grant tables again by executing a @code{mysqladmin
flush-privileges} or @code{mysqladmin reload} command, or by issuing a
@code{FLUSH PRIVILEGES} statement.)

@item --skip-name-resolve
Hostnames are not resolved.  All @code{Host} column values in the grant
tables must be IP numbers or @code{localhost}.

@item --skip-networking
Don't allow TCP/IP connections over the network.  All connections to
@code{mysqld} must be made via Unix socket files.
This option is unsuitable when using a MySQL version prior to 3.23.27 with
the MIT-pthreads package, because Unix socket files were not supported by
MIT-pthreads at that time.

@item --skip-show-database
Don't allow the @code{SHOW DATABASES} statement, unless the user has the
@code{SHOW DATABASES} privilege. As of version 4.0.2, you should no longer
need this option. Access now can be granted to specific accounts with the
@code{SHOW DATABASES} privilege.

@end table

@node LOAD DATA LOCAL,  , Privileges options, Security
@subsection Security Issues with @code{LOAD DATA LOCAL}

The @code{LOAD DATA} statement can load a file that is located on the
server host, or, when the @code{LOCAL} keyword is specified, a file that
is located on the client host.

There are two possible problems with supporting the @code{LOCAL} version of
@code{LOAD DATA} statements:

@itemize @bullet
@item
The reading of the file is initiated from the server, so one could
theoretically create a patched MySQL server that could tell the client program
to read any file on
the client machine that the current user has read access to, when
the client issues a query against the table.

@item
In a web environment where the clients are connecting from a web
server, a user could use @code{LOAD DATA LOCAL} to read any files
that the web server process has read access to (assuming a user could
run any command against the SQL server). In this environment, the client with
respect to the MySQL server actually is the web server, not the program being
run by the user connecting to the web server.

@end itemize

To deal with these potential security issues, we changed how @code{LOAD DATA
LOCAL} is handled as of MySQL 3.23.49 and MySQL 4.0.2 (4.0.13 on Windows):

@itemize @bullet

@item
By default, all MySQL clients and libraries in binary distributions are
compiled with the @code{--enable-local-infile} option, to be compatible
with MySQL 3.23.48 and before.

@item
If you build MySQL from source but don't use the @code{--enable-local-infile}
option to @code{configure}, @code{LOAD DATA LOCAL} cannot be used
by any client unless it is written explicitly to invoke
@code{mysql_options(... MYSQL_OPT_LOCAL_INFILE, 0)}.
@xref{mysql_options, , @code{mysql_options()}}.

@item
You can disable all @code{LOAD DATA LOCAL} commands from the server side
by starting @code{mysqld} with @code{--local-infile=0}.

@item
For the @code{mysql} command-line client, @code{LOAD DATA LOCAL} can be
enabled by specifying the @code{--local-infile[=1]} option, or disabled with
the @code{--local-infile=0} option.  Similarly, for @code{mysqlimport},
the @code{--local} or @code{-L} option enable local datafile loading. In
any case, successful use of a local loading operation requires that the
server is enabled to allow it.

@item
If @code{LOAD DATA LOCAL INFILE} is disabled, either in the server or
the client, a client that attempts to issue such a statement receives the
following error message:

@example
ERROR 1148: The used command is not allowed with this MySQL version
@end example

@end itemize


@node Privilege system, User Account Management, Security, MySQL Database Administration
@section The MySQL Access Privilege System

@cindex access privileges
@cindex privileges, access
@cindex security system
@cindex ACLs

MySQL has an advanced but non-standard security/privilege
system.  This section describes how it works.

@menu
* What Privileges::             What the Privilege System Does
* Privileges::                  How the Privilege System Works
* Privileges provided::         Privileges Provided by MySQL
* Connecting::                  Connecting to the MySQL Server
* Connection access::           Access Control, Stage 1: Connection Verification
* Request access::              Access Control, Stage 2: Request Verification
* Password hashing::            Password Hashing in MySQL 4.1
* Access denied::               Causes of @code{Access denied} Errors
@end menu

@node What Privileges, Privileges, Privilege system, Privilege system
@subsection What the Privilege System Does

@cindex system, privilege
@cindex privilege system
@cindex passwords, security

The primary function of the MySQL privilege system is to
authenticate a user connecting from a given host, and to associate that user
with privileges on a database such as
@code{SELECT}, @code{INSERT}, @code{UPDATE} and @code{DELETE}.

Additional functionality includes the ability to have an anonymous user and
to grant privileges for MySQL-specific functions such as @code{LOAD
DATA INFILE} and administrative operations.


@node Privileges, Privileges provided, What Privileges, Privilege system
@subsection How the Privilege System Works

@cindex privilege system, described

The MySQL privilege system ensures that all users may perform only the
operations allowed to them.  As a user, when you connect to a
MySQL server, your identity is determined by @strong{the host from
which you connect} and @strong{the username you specify}.  The system grants
privileges according to your identity and @strong{what you want to do}.

MySQL considers both your hostname and username in identifying you
because there is little reason to assume that a given username belongs to
the same person everywhere on the Internet.  For example, the user
@code{joe} who connects from @code{office.com} need not be the same
person as the user @code{joe} who connects from @code{elsewhere.com}.
MySQL handles this by allowing you to distinguish users on different
hosts that happen to have the same name:  you can grant @code{joe} one set
of privileges for connections from @code{office.com}, and a different set
of privileges for connections from @code{elsewhere.com}.

MySQL access control involves two stages:

@itemize @bullet
@item
Stage 1: The server checks whether you are even allowed to connect.

@item
Stage 2: Assuming you can connect, the server checks each request you issue
to see whether you have sufficient privileges to perform it.  For
example, if you try to select rows from a table in a database or drop a table
from the database, the server makes sure you have the @code{SELECT}
privilege for the table or the @code{DROP} privilege for the database.
@end itemize

Note that if your privileges are changed (either by yourself or someone else)
while you are connected, those changes will not necessarily take
effect with your next query or queries. See @ref{Privilege changes} for
details.

The server uses the @code{user}, @code{db}, and @code{host} tables in the
@code{mysql} database at both stages of access control.  The columns in these
grant tables are shown here:

@c arjen 2003-03-28 These column fractions probably need updating (with the new privs since 4.0.2)
@multitable @columnfractions .20 .20 .20 .20
@item @strong{Table name}
       @tab @strong{user}                @tab @strong{db}                   @tab @strong{host}

@item @strong{Scope columns}
       @tab @code{Host}                  @tab @code{Host}                  @tab @code{Host}
@item  @tab @code{User}                  @tab @code{Db}                    @tab @code{Db}
@item  @tab @code{Password}              @tab @code{User}                  @tab

@item @strong{Privilege columns}
       @tab @code{Select_priv}           @tab @code{Select_priv}           @tab @code{Select_priv}
@item  @tab @code{Insert_priv}           @tab @code{Insert_priv}           @tab @code{Insert_priv}
@item  @tab @code{Update_priv}           @tab @code{Update_priv}           @tab @code{Update_priv}
@item  @tab @code{Delete_priv}           @tab @code{Delete_priv}           @tab @code{Delete_priv}
@item  @tab @code{Index_priv}            @tab @code{Index_priv}            @tab @code{Index_priv}
@item  @tab @code{Alter_priv}            @tab @code{Alter_priv}            @tab @code{Alter_priv}
@item  @tab @code{Create_priv}           @tab @code{Create_priv}           @tab @code{Create_priv}
@item  @tab @code{Drop_priv}             @tab @code{Drop_priv}             @tab @code{Drop_priv}
@item  @tab @code{Grant_priv}            @tab @code{Grant_priv}            @tab @code{Grant_priv}

@item  @tab @code{References_priv}       @tab @code{References_priv}       @tab @code{References_priv}
@item  @tab @code{Reload_priv}           @tab                              @tab
@item  @tab @code{Shutdown_priv}         @tab                              @tab
@item  @tab @code{Process_priv}          @tab                              @tab
@item  @tab @code{File_priv}             @tab                              @tab

@item  @tab @code{Show_db_priv}          @tab                              @tab
@item  @tab @code{Super_priv}            @tab                              @tab
@item  @tab @code{Create_tmp_table_priv} @tab @code{Create_tmp_table_priv} @tab @code{Create_tmp_table_priv}
@item  @tab @code{Lock_tables_priv}      @tab @code{Lock_tables_priv}      @tab @code{Lock_tables_priv}
@item  @tab @code{Execute_priv}          @tab                              @tab
@item  @tab @code{Repl_slave_priv}       @tab                              @tab
@item  @tab @code{Repl_client_priv}      @tab                              @tab

@item  @tab @code{ssl_type}              @tab                              @tab
@item  @tab @code{ssl_cypher}            @tab                              @tab
@item  @tab @code{x509_issuer}           @tab                              @tab
@item  @tab @code{x509_cubject}          @tab                              @tab

@item  @tab @code{max_questions}         @tab                              @tab
@item  @tab @code{max_updates}           @tab                              @tab
@item  @tab @code{max_connections}       @tab                              @tab
@end multitable

During the second stage of access control (request verification), the server
may, if the request involves tables, additionally consult the
@code{tables_priv} and @code{columns_priv} tables that provide finer control
at the table and column levels.  The columns in these
tables are shown here:

@multitable @columnfractions .20 .20 .20
@item @strong{Table name}       @tab @strong{tables_priv} @tab @strong{columns_priv}

@item @strong{Scope columns}    @tab @code{Host}          @tab @code{Host}
@item                           @tab @code{Db}            @tab @code{Db}
@item                           @tab @code{User}          @tab @code{User}
@item                           @tab @code{Table_name}    @tab @code{Table_name}
@item                           @tab                      @tab @code{Column_name}

@item @strong{Privilege columns} @tab @code{Table_priv}    @tab @code{Column_priv}
@item                           @tab @code{Column_priv}   @tab

@item @strong{Other columns}    @tab @code{Timestamp}     @tab @code{Timestamp}
@item                           @tab @code{Grantor}       @tab
@end multitable

Each grant table contains scope columns and privilege columns.

Scope columns determine the scope of each entry (row) in the tables, that is, the
context in which the entry applies.  For example, a @code{user} table entry
with @code{Host} and @code{User} values of @code{'thomas.loc.gov'} and
@code{'bob'} would be used for authenticating connections made to the server
from the host @code{thomas.loc.gov} by a client that specifies a username of
@code{bob}.  Similarly, a @code{db}
table entry with @code{Host}, @code{User}, and @code{Db} column values of
@code{'thomas.loc.gov'}, @code{'bob'} and @code{'reports'} would be used when
@code{bob} connects from the host @code{thomas.loc.gov} to access the
@code{reports} database.  The @code{tables_priv} and @code{columns_priv}
tables contain scope columns indicating tables or table/column combinations
to which each entry applies.

@cindex case-sensitivity, in access checking
For access-checking purposes, comparisons of @code{Host} values are
case-insensitive.  @code{User}, @code{Password}, @code{Db}, and
@code{Table_name} values are case-sensitive.
@code{Column_name} values are case-insensitive in MySQL Version
3.22.12 or later.

Privilege columns indicate the privileges granted by a table entry, that is,
what operations can be performed.  The server combines the information in the
various grant tables to form a complete description of a user's privileges.
The rules used to do this are described in @ref{Request access}.

Scope columns contain strings. They are declared as shown here; the default value for
each is the empty string:

@multitable @columnfractions .20 .15
@item @strong{Column name} @tab @strong{Type}
@item @code{Host}         @tab @code{CHAR(60)}
@item @code{User}         @tab @code{CHAR(16)}
@item @code{Password}     @tab @code{CHAR(16)}
@item @code{Db}           @tab @code{CHAR(64)}
@item @code{Table_name}   @tab @code{CHAR(60)}
@item @code{Column_name}  @tab @code{CHAR(60)}
@end multitable

Before MySQL 3.23, the @code{Db} column was @code{CHAR(32)} in some tables
and @code{CHAR(60)} in others.

In the @code{user}, @code{db} and @code{host} tables, each privilege
is listed in a separate column. Each privilege column is declared as
@code{ENUM('N','Y')} and can have a value of @code{'N'} or @code{'Y'};
the default value is @code{'N'}.

In the @code{tables_priv} and @code{columns_priv} tables, the privilege
columns are declared as @code{SET} columns. Values in these columns can
contain any combination of the privileges controlled by the table:

@multitable @columnfractions .15 .15 .55
@item @strong{Table name}
 @tab @strong{Column name}
 @tab @strong{Possible set elements}
@item @code{tables_priv}
 @tab @code{Table_priv}
 @tab @code{'Select', 'Insert', 'Update', 'Delete', 'Create', 'Drop', 'Grant', 'References', 'Index', 'Alter'}
@item @code{tables_priv}
 @tab @code{Column_priv}
 @tab @code{'Select', 'Insert', 'Update', 'References'}
@item @code{columns_priv}
 @tab @code{Column_priv}
 @tab @code{'Select', 'Insert', 'Update', 'References'}
@end multitable

Briefly, the server uses the grant tables like this:

@itemize @bullet
@item
The @code{user} table scope columns determine whether to allow or reject
incoming connections.  For allowed connections, any privileges granted in
the @code{user} table indicate the user's global (superuser) privileges.
These privileges apply to @strong{all} databases on the server.

@item
The @code{db} and @code{host} tables are used together:

@itemize @minus
@item
The @code{db} table scope columns determine which users can access which
databases from which hosts.  The privilege columns determine which operations
are allowed.

@item
The @code{host} table is used as an extension of the @code{db} table when you
want a given @code{db} table entry to apply to several hosts.  For example,
if you want a user to be able to use a database from several hosts in
your network, leave the @code{Host} value empty in the user's @code{db} table
entry, then populate the @code{host} table with an entry for each of those
hosts.  This mechanism is described more detail in @ref{Request access}.
Note that the @code{host} table is not affected by the @code{GRANT} and
@code{REVOKE} statements. Most MySQL installations need not use this table at
all.
@end itemize

@item
The @code{tables_priv} and @code{columns_priv} tables are similar to
the @code{db} table, but are more fine-grained: they apply at the
table and column levels rather than at the database level.
@end itemize

Administrative privileges (such as @code{RELOAD} or @code{SHUTDOWN})
are specified only in the @code{user} table.  This is because
administrative operations are operations on the server itself and are not
database-specific, so there is no reason to list these privileges in the
other grant tables.  In fact, to determine whether you can perform an
administrative operation, the server need consult only the @code{user} table.

The @code{FILE} privilege also is specified only in the @code{user} table.
It is not an administrative privilege as such, but your ability to read or
write files on the server host is independent of the database you are
accessing.

The @code{mysqld} server reads the contents of the grant tables once, when it
starts.  Changes to the grant tables take effect as indicated in
@ref{Privilege changes}.

When you modify the contents of the grant tables, it is a good idea to make
sure that your changes set up privileges the way you want.  For help in
diagnosing problems, see @ref{Access denied}.  For advice on general
security issues, see @ref{Security}.

A useful
diagnostic tool is the @code{mysqlaccess} script, which Yves Carlier has
provided for the MySQL distribution.  Invoke @code{mysqlaccess} with
the @code{--help} option to find out how it works.
Note that @code{mysqlaccess} checks access using only the @code{user},
@code{db} and @code{host} tables.  It does not check table or column
privileges in the @code{tables_priv} or @code{columns_priv} tables.


@node Privileges provided, Connecting, Privileges, Privilege system
@subsection Privileges Provided by MySQL

@cindex privilege information, location

Information about user privileges is stored in the @code{user}, @code{db},
@code{host}, @code{tables_priv}, and @code{columns_priv} tables in the
@code{mysql} database (that is, in the database named @code{mysql}).  The
MySQL server reads the contents of these tables when it starts
and under the circumstances indicated in @ref{Privilege changes}.

The names used in this manual to refer to the privileges provided by
MySQL version 4.0.2 are shown here, along with the table column name
associated with each privilege in the grant tables and the context in
which the privilege applies. Further information about the meaning of
each privilege may be found at @ref{GRANT, , @code{GRANT}}.

@c TODO: problably should have that information here as well.

@c FIX agl 2002-06-13 Long items added, will need to re-measure colwidths!
@multitable @columnfractions .15 .20 .35
@item @strong{Privilege}             @tab @strong{Column}              @tab @strong{Context}
@item @code{ALTER}                   @tab @code{Alter_priv}            @tab tables
@item @code{DELETE}                  @tab @code{Delete_priv}           @tab tables
@item @code{INDEX}                   @tab @code{Index_priv}            @tab tables
@item @code{INSERT}                  @tab @code{Insert_priv}           @tab tables
@item @code{SELECT}                  @tab @code{Select_priv}           @tab tables
@item @code{UPDATE}                  @tab @code{Update_priv}           @tab tables
@item @code{CREATE}                  @tab @code{Create_priv}           @tab databases, tables, or indexes
@item @code{DROP}                    @tab @code{Drop_priv}             @tab databases or tables
@item @code{GRANT}                   @tab @code{Grant_priv}            @tab databases or tables
@item @code{REFERENCES}              @tab @code{References_priv}       @tab databases or tables
@item @code{CREATE TEMPORARY TABLES} @tab @code{Create_tmp_table_priv} @tab server administration
@item @code{EXECUTE}                 @tab @code{Execute_priv}          @tab server administration
@item @code{FILE}                    @tab @code{File_priv}             @tab file access on server
@item @code{LOCK TABLES}             @tab @code{Lock_tables_priv}      @tab server administration
@item @code{PROCESS}                 @tab @code{Process_priv}          @tab server administration
@item @code{RELOAD}                  @tab @code{Reload_priv}           @tab server administration
@item @code{REPLICATION CLIENT}      @tab @code{Repl_client_priv}      @tab server administration
@item @code{REPLICATION SLAVE}       @tab @code{Repl_slave_priv}       @tab server administration
@item @code{SHOW DATABASES}          @tab @code{Show_db_priv}          @tab server administration
@item @code{SHUTDOWN}                @tab @code{Shutdown_priv}         @tab server administration
@item @code{SUPER}                   @tab @code{Super_priv}            @tab server administration
@end multitable

The @code{SELECT}, @code{INSERT}, @code{UPDATE}, and @code{DELETE}
privileges allow you to perform operations on rows in existing tables in
a database.

@code{SELECT} statements require the @code{SELECT} privilege only if they
actually retrieve rows from a table.  Some @code{SELECT} statements do not
access tables, so they can be executed even without permission for any of
the databases on the server.  For example, you can use the @code{mysql}
client as a simple calculator:

@example
mysql> SELECT 1+1;
mysql> SELECT PI()*2;
@end example

The @code{INDEX} privilege allows you to create or drop (remove) indexes.

The @code{ALTER} privilege allows you to use @code{ALTER TABLE}.

The @code{CREATE} and @code{DROP} privileges allow you to create new
databases and tables, or to drop (remove) existing databases and tables.

Note that if you grant the @code{DROP} privilege for the @code{mysql}
database to a user, that user can drop the database in which the
MySQL access privileges are stored!

The @code{GRANT} privilege allows you to give to other users those
privileges you yourself possess.

The @code{FILE} privilege gives you permission to read and write files on
the server using the @code{LOAD DATA INFILE} and @code{SELECT ... INTO
OUTFILE} statements.  Any user to whom this privilege is granted can read
any world-readable file accessable by the MySQL server and create a new
world-readable file in any directory where the MySQL server can write.
The user can also read any file in the current database directory.
However, the user cannot change any existing file.

The remaining privileges are used for administrative operations. Many of
them can be performed by using using the @code{mysqladmin} program or by
issuing SQL statements.  The following table shows which @code{mysqladmin}
commands each administrative privilege allows you to execute:

@multitable @columnfractions .15 .75
@item @strong{Privilege}  @tab @strong{Commands permitted to privilege holders}
@item @code{RELOAD}       @tab @code{refresh}, @code{reload}, @code{flush-hosts}, @code{flush-logs}, @code{flush-privileges}, @code{flush-status}, @code{flush-threads}, and @code{flush-tables}
@item @code{SHUTDOWN}     @tab @code{shutdown}
@item @code{PROCESS}      @tab @code{processlist}
@item @code{SUPER}        @tab @code{kill}
@end multitable

The @code{reload} command tells the server to re-read the grant tables.  The
@code{refresh} command flushes all tables and opens and closes the log
files.  @code{flush-privileges} is a synonym for @code{reload}.  The other
@code{flush-*} commands perform functions similar to @code{refresh} but are
more limited in scope, and may be preferable in some instances.  For example,
if you want to flush just the log files, @code{flush-logs} is a better choice
than @code{refresh}.

The @code{shutdown} command shuts down the server. This command can be issued
only from @code{mysqladmin}. There is no corresponding SQL statement.

The @code{processlist} command displays information about the threads
executing within the server (that is, about the statements that other
clients are executing).  The @code{kill} command kills server threads.
You can always display or kill your own threads, but you need the
@code{PROCESS} privilege to display threads initiated by other users and
and the @code{SUPER} privilege to kill them.
@xref{KILL,  , @code{KILL}}.

It is a good idea in general to grant privileges only to those users who need
them, but you should exercise particular caution in granting administrative
privileges:

@itemize @bullet
@item
The @code{GRANT} privilege allows users to give their privileges to
other users.  Two users with different privileges and with the @code{GRANT}
privilege are able to combine privileges.

@item
The @code{ALTER} privilege may be used to subvert the privilege system
by renaming tables.

@item
The @code{FILE} privilege can be abused to read into a database table
any world-readable file on the server host or any file in the server's data
directory. The contents of that table can then be accessed
using @code{SELECT}.

@item
The @code{SHUTDOWN} privilege can be abused to deny service to other
users entirely by terminating the server.

@item
The @code{PROCESS} privilege can be used to view the plain text of
currently executing queries, including queries that set or change passwords.

@item
The @code{SUPER} privilege can be used to terminate other clients or change
how the server operates.

@item
Privileges granted for the @code{mysql} database itself can be used to
change passwords and other access privilege information.  (Passwords are
stored encrypted, so a malicious user cannot simply read them to know the
plain text password.)  If they can access the @code{mysql.user} password
column, they can use it to log into the MySQL server for the given user.
(With sufficient privileges, the same user can replace a password with a
different one.)
@end itemize

There are some things that you cannot do with the MySQL
privilege system:

@itemize @bullet
@item
You cannot explicitly specify that a given user should be denied access.
That is, you cannot explicitly match a user and then refuse the connection.

@item
You cannot specify that a user has privileges to create or drop tables
in a database but not to create or drop the database itself.
@end itemize


@node Connecting, Connection access, Privileges provided, Privilege system
@subsection Connecting to the MySQL Server

@cindex connecting, to the server
@cindex default hostname
@cindex hostname, default
@cindex server, connecting

MySQL client programs generally require that you specify connection
parameters when you want to access a MySQL server: the host you want
to connect to, your username, and your password.  For example, the
@code{mysql} client can be started like this, where optional arguments are
indicated by @samp{[} and @samp{]}:

@example
shell> mysql [-h host_name] [-u user_name] [-pyour_pass]
@end example

Alternate forms of the @code{-h}, @code{-u}, and @code{-p} options are
@code{--host=host_name}, @code{--user=user_name}, and
@code{--password=your_pass}.  Note that there is @emph{no space} between
@code{-p} or @code{--password=} and the password following it.

@strong{Note:} Specifying a password on the command line is not secure!
Any user on your system may then find out your password by typing a command
like: @code{ps auxww}.  @xref{Option files}.

@code{mysql} uses default values for connection parameters that are not given
on the command line:

@itemize @bullet
@item
The default hostname is @code{localhost}.

@item
The default username is your Unix login name.

@item
No password is supplied if @code{-p} is missing.
@end itemize

Thus, for a Unix user @code{joe}, the following commands are equivalent:

@example
shell> mysql -h localhost -u joe
shell> mysql -h localhost
shell> mysql -u joe
shell> mysql
@end example

Other MySQL clients behave similarly.

On Unix systems, you can specify different default values to be used when you
make a connection, so that you need not enter them on the command-line each
time you invoke a client program.  This can be done in a couple of ways:

@itemize @bullet
@item
@tindex .my.cnf file
You can specify connection parameters in the @code{[client]} section of the
@file{.my.cnf} option file in your home directory.  The relevant
section of the file might look like this:

@example
[client]
host=host_name
user=user_name
password=your_pass
@end example

@xref{Option files}.

@item
@tindex @code{MYSQL_HOST} environment variable
@tindex environment variable, @code{MYSQL_HOST}
@tindex @code{MYSQL_PWD} environment variable
@tindex environment variable, @code{MYSQL_PWD}
@tindex @code{USER} environment variable
@tindex environment variable, @code{USER}
You can specify connection parameters using environment variables.  The
host can be specified for @code{mysql} using @code{MYSQL_HOST}.  The
MySQL username can be specified using @code{USER} (this is for
Windows and NetWare only).  The password can be specified using @code{MYSQL_PWD}
(but this is insecure; see the next section).  @xref{Environment variables}.
@end itemize


@node Connection access, Request access, Connecting, Privilege system
@subsection Access Control, Stage 1: Connection Verification

@cindex access control
@cindex control access
@cindex connecting, verification
@cindex testing, connection to the server

When you attempt to connect to a MySQL server, the server accepts or
rejects the connection based on your identity and whether you can
verify your identity by supplying the correct password.  If not, the server
denies access to you completely.  Otherwise, the server accepts the
connection, then enters Stage 2 and waits for requests.

Your identity is based on two pieces of information:

@itemize @bullet
@item
The host from which you connect

@item
Your MySQL username
@end itemize

Identity checking is performed using the three @code{user} table scope columns
(@code{Host}, @code{User}, and @code{Password}).  The server accepts the
connection only if a @code{user} table entry matches your hostname and user
name, and you supply the correct password.

Values in the @code{user} table scope columns may be specified as follows:

@itemize @bullet
@item
A @code{Host} value may be a hostname or an IP number, or @code{'localhost'}
to indicate the local host.

@item
@cindex wildcards, in @code{mysql.user} table
You can use the wildcard characters @samp{%} and @samp{_} in the @code{Host}
column.

@item
A @code{Host} value of @code{'%'} matches any hostname.

@item
A blank @code{Host} value means that the privilege should be anded
with the entry in the @code{host} table that matches the given hostname.
You can find more information about this in the next chapter.

@cindex netmask notation, in @code{mysql.user} table
@item
As of MySQL Version 3.23, for @code{Host} values specified as
IP numbers, you can specify a netmask indicating how many address bits to
use for the network number. For example:

@example
mysql> GRANT ALL PRIVILEGES ON db.*
    -> TO david@@'192.58.197.0/255.255.255.0';
@end example

This will allow everyone to connect from an IP where the following is true:

@example
user_ip & netmask = host_ip.
@end example

In the above example all IP:s in the interval 192.58.197.0 -
192.58.197.255 can connect to the MySQL server.

@item
@cindex anonymous user
Wildcard characters are not allowed in the @code{User} column, but you can
specify a blank value, which matches any name.  If the @code{user} table
entry that matches an incoming connection has a blank username, the user is
considered to be the anonymous user (the user with no name), rather than the
name that the client actually specified.  This means that a blank username
is used for all further access checking for the duration of the connection
(that is, during Stage 2).

@item
The @code{Password} column can be blank.  This does not mean that any password
matches, it means the user must connect without specifying a password.
@end itemize

@findex PASSWORD()
Non-blank @code{Password} values represent encrypted passwords.
MySQL does not store passwords in plaintext form for anyone to
see.  Rather, the password supplied by a user who is attempting to
connect is encrypted (using the @code{PASSWORD()} function). The
encrypted password is then used when the client/server is checking if
the password is correct. (This is done without the encrypted password
ever traveling over the connection.)  Note that from MySQL's
point of view the encrypted password is the REAL password, so you should
not give anyone access to it!  In particular, don't give normal users
read access to the tables in the @code{mysql} database!
From version 4.1, MySQL employs a different password and login mechanism
that is secure even if TCP/IP packets are sniffed and/or the mysql database
is captured.

The examples here show how various combinations of @code{Host} and
@code{User} values in @code{user} table entries apply to incoming
connections:

@multitable @columnfractions .35 .15 .50
@item @code{Host} @strong{value} @tab @code{User} @strong{value} @tab @strong{Connections matched by entry}
@item @code{'thomas.loc.gov'} @tab @code{'fred'} @tab @code{fred}, connecting from @code{thomas.loc.gov}
@item @code{'thomas.loc.gov'} @tab @code{''} @tab Any user, connecting from @code{thomas.loc.gov}
@item  @code{'%'} @tab @code{'fred'} @tab @code{fred}, connecting from any host
@item @code{'%'} @tab  @code{''} @tab Any user, connecting from any host
@item @code{'%.loc.gov'} @tab @code{'fred'} @tab @code{fred}, connecting from any host in the @code{loc.gov} domain
@item @code{'x.y.%'} @tab @code{'fred'} @tab @code{fred}, connecting from @code{x.y.net}, @code{x.y.com},@code{x.y.edu}, etc. (this is probably not useful)
@item @code{'144.155.166.177'} @tab @code{'fred'} @tab @code{fred}, connecting from the host with IP address @code{144.155.166.177}
@item @code{'144.155.166.%'} @tab @code{'fred'} @tab @code{fred}, connecting from any host in the @code{144.155.166} class C subnet
@item @code{'144.155.166.0/255.255.255.0'} @tab @code{'fred'} @tab Same as previous example
@end multitable

Because you can use IP wildcard values in the @code{Host} column (for example,
@code{'144.155.166.%'} to match every host on a subnet), there is the
possibility that someone might try to exploit this capability by naming a
host @code{144.155.166.somewhere.com}.  To foil such attempts, MySQL
disallows matching on hostnames that start with digits and a dot. Thus, if
you have a host named something like @code{1.2.foo.com}, its name will never
match the @code{Host} column of the grant tables.  Only an IP number can
match an IP wildcard value.

An incoming connection may be matched by more than one entry in the
@code{user} table.  For example, a connection from @code{thomas.loc.gov} by
@code{fred} would be matched by several of the entries shown in the preceding
table.  How
does the server choose which entry to use if more than one matches?  The
server resolves this question by sorting the @code{user} table after reading
it at startup time, then looking through the entries in sorted order when a
user attempts to connect.  The first matching entry is the one that is used.

@code{user} table sorting works as follows.  Suppose the @code{user} table
looks like this:

@example
+-----------+----------+-
| Host      | User     | ...
+-----------+----------+-
| %         | root     | ...
| %         | jeffrey  | ...
| localhost | root     | ...
| localhost |          | ...
+-----------+----------+-
@end example

When the server reads in the table, it orders the entries with the
most-specific @code{Host} values first (@code{'%'} in the @code{Host} column
means ``any host'' and is least specific).  Entries with the same @code{Host}
value are ordered with the most-specific @code{User} values first (a blank
@code{User} value means ``any user'' and is least specific).  The resulting
sorted @code{user} table looks like this:

@example
+-----------+----------+-
| Host      | User     | ...
+-----------+----------+-
| localhost | root     | ...
| localhost |          | ...
| %         | jeffrey  | ...
| %         | root     | ...
+-----------+----------+-
@end example

@cindex grant tables, sorting
@cindex sorting, grant tables
@cindex @code{user} table, sorting
When a connection is attempted, the server looks through the sorted entries
and uses the first match found.  For a connection from @code{localhost} by
@code{jeffrey}, the entries with @code{'localhost'} in the @code{Host} column
match first.  Of those, the entry with the blank username matches both the
connecting hostname and username.  (The @code{'%'/'jeffrey'} entry would
have matched, too, but it is not the first match in the table.)

Here is another example.  Suppose the @code{user} table looks like this:

@example
+----------------+----------+-
| Host           | User     | ...
+----------------+----------+-
| %              | jeffrey  | ...
| thomas.loc.gov |          | ...
+----------------+----------+-
@end example

The sorted table looks like this:

@example
+----------------+----------+-
| Host           | User     | ...
+----------------+----------+-
| thomas.loc.gov |          | ...
| %              | jeffrey  | ...
+----------------+----------+-
@end example

A connection from @code{thomas.loc.gov} by @code{jeffrey} is matched by the
first entry, whereas a connection from @code{whitehouse.gov} by
@code{jeffrey} is matched by the second.

A common misconception is to think that for a given username, all entries
that explicitly name that user will be used first when the server attempts to
find a match for the connection.  This is simply not true.  The previous
example illustrates this, where a connection from @code{thomas.loc.gov} by
@code{jeffrey} is first matched not by the entry containing @code{'jeffrey'}
as the @code{User} column value, but by the entry with no username!

If you have problems connecting to the server, print out the @code{user}
table and sort it by hand to see where the first match is being made.
If connection was successful, but your privileges are not what you
expected you may use @code{CURRENT_USER()} function (new in version
4.0.6) to see what user/host combination your connection actually
matched. @xref{Miscellaneous functions, ,@code{CURRENT_USER()}}.

@node Request access, Password hashing, Connection access, Privilege system
@subsection Access Control, Stage 2: Request Verification

Once you establish a connection, the server enters Stage 2.  For each request
that comes in on the connection, the server checks whether you have
sufficient privileges to perform it, based on the type of operation you wish
to perform.  This is where the privilege columns in the grant tables come into
play.  These privileges can come from any of the @code{user}, @code{db},
@code{host}, @code{tables_priv}, or @code{columns_priv} tables.  The grant
tables are manipulated with @code{GRANT} and @code{REVOKE} commands.
@xref{GRANT, , @code{GRANT}}.  (You may find it helpful to refer to
@ref{Privileges}, which lists the columns present in each of the grant
tables.)

The @code{user} table grants privileges that are assigned to you on a global
basis and that apply no matter what the current database is.  For example, if
the @code{user} table grants you the @code{DELETE} privilege, you can
delete rows from any database on the server host!  In other words,
@code{user} table privileges are superuser privileges.  It is wise to grant
privileges in the @code{user} table only to superusers such as server or
database administrators.  For other users, you should leave the privileges
in the @code{user} table set to @code{'N'} and grant privileges on a
database-specific basis only, using the @code{db} and @code{host} tables.

@cindex anonymous user
@cindex wildcards, in @code{mysql.db} table
@cindex wildcards, in @code{mysql.host} table
The @code{db} and @code{host} tables grant database-specific privileges.
Values in the scope columns may be specified as follows:

@itemize @bullet
@item
The wildcard characters @samp{%} and @samp{_} can be used in the @code{Host}
and @code{Db} columns of either table. If you wish to use for instance a
@samp{_} character as part of a database name, specify it as @samp{\_} in
the @code{GRANT} command.

@item
A @code{'%'} @code{Host} value in the @code{db} table means ``any host.'' A
blank @code{Host} value in the @code{db} table means ``consult the
@code{host} table for further information.''

@item
A @code{'%'} or blank @code{Host} value in the @code{host} table means ``any
host.''

@item
A @code{'%'} or blank @code{Db} value in either table means ``any database.''

@item
A blank @code{User} value in either table matches the anonymous user.
@end itemize

@cindex grant tables, sorting
@cindex sorting, grant tables
@cindex @code{db} table, sorting
@cindex @code{host} table, sorting
The @code{db} and @code{host} tables are read in and sorted when the server
starts (at the same time that it reads the @code{user} table).  The
@code{db} table is sorted on the @code{Host}, @code{Db}, and @code{User} scope
columns, and the @code{host} table is sorted on the @code{Host} and @code{Db}
scope columns.  As with the @code{user} table, sorting puts the most-specific
values first and least-specific values last, and when the server looks for
matching entries, it uses the first match that it finds.


@cindex wildcards, in @code{mysql.tables_priv} table
@cindex wildcards, in @code{mysql.columns_priv} table
The @code{tables_priv} and @code{columns_priv} tables grant table- and
column-specific privileges.  Values in the scope columns may be specified as
follows:

@itemize @bullet
@item
The wildcard characters @samp{%} and @samp{_}
can be used in the @code{Host} column of either table.

@item
A @code{'%'} or blank @code{Host} value in either table means ``any host.''

@item
The @code{Db}, @code{Table_name} and @code{Column_name} columns cannot contain
wildcards or be blank in either table.
@end itemize

The @code{tables_priv} and @code{columns_priv} tables are sorted on
the @code{Host}, @code{Db}, and @code{User} columns.  This is similar to
@code{db} table sorting, although the sorting is simpler because
only the @code{Host} column may contain wildcards.

The request verification process is described here.  (If you are familiar
with the access-checking source code, you will notice that the description
here differs slightly from the algorithm used in the code.  The description
is equivalent to what the code actually does; it differs only to make the
explanation simpler.)

For administrative requests (@code{SHUTDOWN}, @code{RELOAD}, etc.), the
server checks only the @code{user} table entry, because that is the only table
that specifies administrative privileges.  Access is granted if the entry
allows the requested operation and denied otherwise.  For example, if you
want to execute @code{mysqladmin shutdown} but your @code{user} table entry
doesn't grant the @code{SHUTDOWN} privilege to you, access is denied
without even checking the @code{db} or @code{host} tables.  (They
contain no @code{Shutdown_priv} column, so there is no need to do so.)

For database-related requests (@code{INSERT}, @code{UPDATE}, etc.), the
server first checks the user's global (superuser) privileges by looking in
the @code{user} table entry.  If the entry allows the requested operation,
access is granted.  If the global privileges in the @code{user} table are
insufficient, the server determines the user's database-specific privileges
by checking the @code{db} and @code{host} tables:

@enumerate
@item
The server looks in the @code{db} table for a match on the @code{Host},
@code{Db}, and @code{User} columns.  The @code{Host} and @code{User} columns are
matched to the connecting user's hostname and MySQL username.  The
@code{Db} column is matched to the database the user wants to access.  If
there is no entry for the @code{Host} and @code{User}, access is denied.

@item
If there is a matching @code{db} table entry and its @code{Host} column is
not blank, that entry defines the user's database-specific privileges.

@item
If the matching @code{db} table entry's @code{Host} column is blank, it
signifies that the @code{host} table enumerates which hosts should be allowed
access to the database.  In this case, a further lookup is done in the
@code{host} table to find a match on the @code{Host} and @code{Db} columns.
If no @code{host} table entry matches, access is denied.  If there is a
match, the user's database-specific privileges are computed as the
intersection (@strong{not} the union!) of the privileges in the @code{db} and
@code{host} table entries, that is, the privileges that are @code{'Y'} in both
entries.  (This way you can grant general privileges in the @code{db} table
entry and then selectively restrict them on a host-by-host basis using the
@code{host} table entries.)
@end enumerate

After determining the database-specific privileges granted by the @code{db}
and @code{host} table entries, the server adds them to the global privileges
granted by the @code{user} table.  If the result allows the requested
operation, access is granted.  Otherwise, the server checks the user's
table and column privileges in the @code{tables_priv} and @code{columns_priv}
tables and adds those to the user's privileges.  Access is allowed or denied
based on the result.

Expressed in boolean terms, the preceding description of how a user's
privileges are calculated may be summarized like this:

@example
global privileges
OR (database privileges AND host privileges)
OR table privileges
OR column privileges
@end example

It may not be apparent why, if the global @code{user} entry privileges are
initially found to be insufficient for the requested operation, the server
adds those privileges to the database-, table-, and column-specific privileges
later. The reason is that a request might require more than one type of
privilege.  For example, if you execute an @code{INSERT ...  SELECT}
statement, you need both @code{INSERT} and @code{SELECT} privileges.
Your privileges might be such that the @code{user} table entry grants one
privilege and the @code{db} table entry grants the other.  In this case, you
have the necessary privileges to perform the request, but the server cannot
tell that from either table by itself; the privileges granted by the entries
in both tables must be combined.

@cindex @code{host} table
@cindex tables, @code{host}

The @code{host} table can be used to maintain a list of secure servers.

At TcX, the @code{host} table contains a list of all machines on the local
network. These are granted all privileges.

You can also use the @code{host} table to indicate hosts that are @strong{not}
secure.  Suppose you have a machine @code{public.your.domain} that is located
in a public area that you do not consider secure.  You can allow access to
all hosts on your network except that machine by using @code{host} table
entries
like this:

@example
+--------------------+----+-
| Host               | Db | ...
+--------------------+----+-
| public.your.domain | %  | ... (all privileges set to 'N')
| %.your.domain      | %  | ... (all privileges set to 'Y')
+--------------------+----+-
@end example

@cindex privilege, changes
@cindex changes to privileges
@cindex tables, grant
@cindex grant tables

Naturally, you should always test your entries in the grant tables (for
example, using @code{mysqlaccess}) to make sure your access privileges are
actually set up the way you think they are.


@node Password hashing, Access denied, Request access, Privilege system
@subsection Password Hashing in MySQL 4.1

MySQL user accounts are listed in the @code{user} table of the @code{mysql}
database. Each MySQL account is assigned a password, although
what is stored in the @code{Password} column of the @code{user} table is not the
plaintext version of the password, but a hash value computed from
it.  Password hash values are computed by the @code{PASSWORD()} function.

MySQL uses passwords in two phases of client/server communication:

@itemize @bullet

@item
First, when a client attempts to connect to the server, there is an
initial authentication step in which the client must present a password
that matches the hash value stored in the user table for the account
that the client wants to use.

@item
Second, after the client connects, it may set or change the password
hashes for accounts listed in the user table (if it has sufficient
privileges). The client may do this by using the PASSWORD() function to
generate a password hash, or by using the GRANT or SET PASSWORD
statements.

@end itemize

In other words, the server @emph{uses} hash values during authentication when
a client first attempts to connect. The server @emph{generates} hash values
if a connected client invokes the @code{PASSWORD()} function or uses a
@code{GRANT}
or @code{SET PASSWORD} statement to set or change a password.

The password hashing mechanism was updated in MySQL 4.1 to provide
better security and to reduce the risk of passwords being stolen.
However, this new mechanism is understood only by the 4.1 server and
4.1 clients, which can result in some compatibility problems.
A 4.1 client can connect to a pre-4.1 server, because the client
understands both the old and new password hashing mechanisms. However,
a pre-4.1 client that attempts to connect to a 4.1 server may run into
difficulties.  For example, a 4.0 @code{mysql} client that attempts to connect
to a 4.1 server may fail with the following error message:

@example
shell> mysql
Client does not support authentication protocol requested
by server; consider upgrading MySQL client
@end example

The following discussion describes the differences between the old and
new password mechanisms, and what you should do if you upgrade your
server to 4.1 but need to maintain backward compatibility with pre-4.1
clients.

@strong{Note:} This discussion contrasts 4.1 behavior with pre-4.1 behavior,
but the 4.1 behavior described here actually begins with 4.1.1. MySQL
4.1.0 is an ``odd'' release because it has a slightly different mechanism
than that implemented in 4.1.1 and up.  Differences between 4.1.0 and
more recent versions are described later.

Prior to MySQL 4.1, password hashes computed by the @code{PASSWORD()} function
are 16 bytes long.  Such hashes look like this:

@example
mysql> SELECT PASSWORD('mypass');
+--------------------+
| PASSWORD('mypass') |
+--------------------+
| 6f8c114b58f2ce9e   |
+--------------------+
@end example

The @code{Password} column of the @code{user} table (in which these hashes are stored)
also is 16 bytes long before MySQL 4.1.

As of MySQL 4.1, the @code{PASSWORD()} function has been modified to produce
a longer 41-byte hash value:

@example
mysql> SELECT PASSWORD('mypass');
+-----------------------------------------------+
| PASSWORD('mypass')                            |
+-----------------------------------------------+
| *43c8aa34cdc98eddd3de1fe9a9c2c2a9f92bb2098d75 |
+-----------------------------------------------+
@end example

Accordingly, the @code{Password} column in the @code{user} table also must be 41
bytes long to store these values:

@itemize @bullet
@item
If you perform a new installation of MySQL 4.1, the @code{Password} column
will be made 41 bytes long automatically.

@item
If you upgrade an older installation to 4.1, you should run the
@code{mysql_fix_privilege_tables} script to update the length of the
@code{Password}
column from 16 to 41 bytes. (The script does not change existing
password values, which remain 16 bytes long.)

@end itemize

A widened @code{Password} column can store password hashes in both the old and
new formats. The format of any given password hash value can be
determined two ways:

@itemize @bullet
@item
The obvious difference is the length (16 bytes versus 41 bytes)

@item
A second difference is that password hashes in the new format always
begin with a @samp{*} character, whereas passwords in the old format never do

@end itemize

The longer password hash format has better cryptographic properties, and
client authentication based on long hashes is more secure than that
based on the older short hashes.

The differences between short and long password hashes are relevant
both for how the server uses passwords during authentication and for
how it generates password hashes for connected clients that perform
password-changing operations.

The way in which the server uses password hashes during authentication
is affected by the width of the Password column:

@itemize @bullet

@item
If the column is narrow, only short-hash authentication is used.

@item
If the column is wide, it can hold either short or long hashes, and
the server can use either format:

@itemize @bullet

@item
Pre-4.1 clients can connect, though because they know only about
the old hashing mechanism, they can authenticate only for accounts that
have short hashes.

@item
4.1 clients can authenticate for accounts that have short or long hashes.

@end itemize

@end itemize

For short-hash accounts, the authentication process is actually a bit
more secure for 4.1 clients than for older clients.  In terms of security,
the gradient from least to most secure is:

@itemize @bullet

@item
Pre-4.1 client authenticating for account with short password hash

@item
4.1 client authenticating for account with short password hash

@item
4.1 client authenticating for account with long password hash

@end itemize

The way in which the server generates password hashes for connected
clients is affected by the width of the @code{Password} column and by the
@code{--old-passwords} option.  A 4.1 server generates long hashes only if certain
conditions are met:
The @code{Password} column must be wide enough to hold long
values and the @code{--old-passwords} option must not be given.
These conditions apply as follows:

@itemize @bullet

@item
The @code{Password} column must be wide enough to hold long hashes (41 bytes).
If the column has not been updated and still has the pre-4.1 width
(16 bytes), the server notices that long hashes cannot fit into it and
generates only short hashes when a client performs password-changing
operations using @code{PASSWORD()}, @code{GRANT}, or @code{SET PASSWORD}.
(This behavior
occurs if you have upgraded to 4.1 but have not run the
@code{mysql_fix_privilege_tables} script to widen the @code{Password} column.)

@item
If the @code{Password} column is wide, it can store either short or long
password hashes. In this case, @code{PASSWORD()}, @code{GRANT}, and @code{SET PASSWORD}
will generate long hashes unless the server was started with the
@code{--old-passwords} option. This option forces the server to generate
short passsword hashes instead.

@end itemize

The purpose of the @code{--old-passwords} option is to allow you to maintain
backward compatibility with pre-4.1 clients under circumstances where
the server would otherwise generate long password hashes. It doesn't
affect authentication (4.1 clients can still use accounts that have
long password hashes), but it does prevent creation of a long
password hash in the @code{user} table as the result of a password-changing
operation. Were that to occur, the account no longer could be used
by pre-4.1 clients. Without the @code{--old-passwords} option, the following
scenario is possible:

@itemize @bullet

@item
An old client connects to an account that has a short password hash.

@item
The client changes the account's password. Without @code{--old-passwords},
this results in the account having a long password hash.

@item
The next time the old client attempts to connect to the account, it
cannot, because the account now requires the new hashing mechanism
during authentication. (Once an account has a long password hash in
the user table, only 4.1 clients can authenticate for it, because
pre-4.1 clients do not understand long hashes.)

@end itemize

This scenario illustrates that it is dangerous to run a 4.1 server
without using the @code{--old-passwords} option if you must support older pre-4.1
clients. By running the server with @code{--old-passwords}, password-changing
operations will not generate long password hashes and thus do not cause
accounts to become inaccessible to older clients. (Those clients cannot
inadvertently lock themselves out by changing their password and ending
up with a long password hash.)

The downside of the @code{--old-passwords} option is that any passwords you
create or change will use short hashes, even for 4.1 clients. Thus, you
lose the additional security provided by long password hashes. If you want
to create an account that has a long hash (for example, for use by 4.1
clients), you must do so while running the server without
@code{--old-passwords}.

The following scenarios are possible for running a 4.1 server:

Scenario 1) Narrow @code{Password} column in user table

@itemize @bullet

@item
Only short hashes can be stored in the @code{Password} column.

@item
The server uses only short hashes during client authentication.

@item
For connected clients, password hash-generating operations
involving @code{PASSWORD()}, @code{GRANT}, or @code{SET PASSWORD} use short hashes
exclusively.  Any change to an account's password results in
that account having a short password hash.

@item
The @code{--old-passwords} option can be used but is superfluous because
with a narrow @code{Password} column, the server will be generating short
password hashes anyway.

@end itemize

Scenario 2) Long @code{Password} column; server not started with
@code{--old-passwords} option

@itemize @bullet

@item
Short or long hashes can be stored in the @code{Password} column.

@item
4.1 clients can authenticate for accounts that have short or long
hashes.

@item
Pre-4.1 clients can authenticate only for accounts that have short
hashes.

@item
For connected clients, password hash-generating operations
involving @code{PASSWORD()}, @code{GRANT}, or @code{SET PASSWORD} use long hashes
exclusively.  Any change to an account's password results in that
account having a long password hash.

@item
@code{OLD_PASSWORD()} may be used to explicitly generate a short hash. For
example, to assign an account a short password, use @code{UPDATE} as follows:

@example
mysql> UPDATE user SET Password = OLD_PASSWORD('mypass')
    -> WHERE Host = 'some_host' AND User = 'some_user';
mysql> FLUSH PRIVILEGES;
@end example

@c TODO: add example showing how to use OLD_PASSWORD() with SET PASSWORD,
@c when that works.

@end itemize

As indicated earlier, a danger in this scenario is that it is
possible for accounts that have a short password hash to become
inaccessible to pre-4.1 clients. Any change to such an account's
password made via @code{GRANT}, @code{SET PASSWORD}, or @code{PASSWORD()} results in
the account being given a long password hash, and from that point
on, no pre-4.1 client can authenticate to that account until the
client upgrades to 4.1.

Scenario 3) Long @code{Password} column; server started with
@code{--old-passwords} option

@itemize @bullet

@item
Short or long hashes can be stored in the @code{Password} column.

@item
4.1 clients can authenticate for accounts that have short or long
hashes (but note that it is possible to create long hashes only when
the server is started without @code{--old-passwords}).

@item
Pre-4.1 clients can authenticate only for accounts that have short
hashes.

@item
For connected clients, password hash-generating operations
involving @code{PASSWORD()}, @code{GRANT}, or @code{SET PASSWORD} use short hashes
exclusively.  Any change to an account's password results in that
account having a short password hash.

@end itemize

In this scenario, you cannot create accounts that have long password
hashes, because @code{--old-passwords} prevents generation of long hashes.  Also,
if you create an account with a long hash before using the
@code{--old-passwords}
option, changing the account's password while @code{--old-passwords} is in
effect results in the account being given a short password, causing it
to lose the security benefits of a longer hash.

The disadvantages for these scenarios may be summarized as follows:

Scenario 1) You cannot take advantage of longer hashes that provide more
secure authentication.

Scenario 2) Accounts with short hashes become inaccessible to pre-4.1
clients if you change their passwords without explicitly using
@code{OLD_PASSWORD()}.

Scenario 3) @code{--old-passwords} prevents accounts with short hashes from
becoming inaccessible, but password-changing operations cause accounts
with long hashes to revert to short hashes, and you cannot change them
back to long hashes while @code{--old-passwords} is in effect.


@subheading Implications of Password Hashing Changes for Application Programs

An upgrade to MySQL 4.1 can cause a compatibility issue for
applications that use @code{PASSWORD()} to generate passwords for their own
purposes. (Applications really should not do this, because @code{PASSWORD()}
should be used only to manage passwords for MySQL accounts. But some
applications use @code{PASSWORD()} for their own purposes anyway.)  If you upgrade to
4.1 and run the server under conditions where it generates long password
hashes, an application that uses @code{PASSWORD()} for its own passwords will
break.  The recommended course of action is to modify the application to
use another function such as @code{SHA1()} or @code{MD5()} to produce hashed values.
If that is not possible, you can use the @code{OLD_PASSWORD()} function, which
is provided to generate short hashes in the old format. (But note that
@code{OLD_PASSWORD()} may one day no longer be supported.)

If the server is running under circumstances where it generates short hashes,
@code{OLD_PASSWORD()} is available but is equivalent to @code{PASSWORD()}.

Password hashing in MySQL 4.1.0 differs from hashing in 4.1.1 and up.
The 4.1.0 differences are:

@itemize @bullet

@item
Password hashes are 45 bytes long rather than 41 bytes.

@item
The @code{PASSWORD()} function is non-repeatable.  That is, with a given
argument @code{X}, successive calls to @code{PASSWORD(X)} generate different
results.

@end itemize


@node Access denied,  , Password hashing, Privilege system
@subsection Causes of @code{Access denied} Errors

If you encounter @code{Access denied} errors when you try to connect to the
MySQL server, the following list indicates some courses of
action you can take to correct the problem:

@itemize @bullet
@item
After installing MySQL, did you run the @code{mysql_install_db}
script to set up the initial grant table contents?  If not, do so.
@xref{Default privileges}.  Test the initial privileges by executing
this command:

@example
shell> mysql -u root test
@end example

The server should let you connect without error.  You should also make sure
you have a file @file{user.MYD} in the MySQL database directory.
Ordinarily, this is @file{PATH/var/mysql/user.MYD}, where @code{PATH} is the
pathname to the MySQL installation root.

@item
After a fresh installation, you should connect to the server and set up
your users and their access permissions:

@example
shell> mysql -u root mysql
@end example

The server should let you connect because the MySQL @code{root} user
has no password initially.  That is also a security risk, so setting the
@code{root} password is something you should do while you're setting up
your other MySQL users.

If you try to connect as @code{root} and get this error:

@example
Access denied for user: '@@unknown' to database mysql
@end example

this means that you don't have an entry in the @code{user} table with a
@code{User} column value of @code{'root'} and that @code{mysqld} cannot
resolve the hostname for your client.  In this case, you must restart the
server with the @code{--skip-grant-tables} option and edit your
@file{/etc/hosts} or @file{\windows\hosts} file to add an entry for your
host.

@item
If you get an error like the following:

@example
shell> mysqladmin -u root -pxxxx ver
Access denied for user: 'root@@localhost' (Using password: YES)
@end example

It means that you are using an incorrect password. @xref{Passwords}.

If you have forgot the root password, you can restart @code{mysqld} with
@code{--skip-grant-tables} to change the password.
@xref{Resetting permissions}.

If you get the above error even if you haven't specified a password,
this means that you have an incorrect password in some @code{my.ini}
file. @xref{Option files}.  You can avoid using option files with the @code{--no-defaults} option, as follows:

@example
shell> mysqladmin --no-defaults -u root ver
@end example

@item
@cindex @code{mysql_fix_privilege_tables}
If you updated an existing MySQL installation from a version earlier
than Version 3.22.11 to Version 3.22.11 or later, did you run the
@code{mysql_fix_privilege_tables} script?  If not, do so.  The structure of
the grant tables changed with MySQL Version 3.22.11 when the
@code{GRANT} statement became functional.
@xref{Upgrading-grant-tables}.

@item
If your privileges seem to have changed in the middle of a session, it may be
that a superuser has changed them.  Reloading the grant tables affects new
client connections, but it also affects existing connections as indicated in
@ref{Privilege changes}.

@item
If you can't get your password to work, remember that you must use
the @code{PASSWORD()} function if you set the password with the
@code{INSERT}, @code{UPDATE}, or @code{SET PASSWORD} statements.  The
@code{PASSWORD()} function is unnecessary if you specify the password using
the @code{GRANT ... IDENTIFIED BY} statement or the @code{mysqladmin
password} command.
@xref{Passwords}.

@item
@code{localhost} is a synonym for your local hostname, and is also the
default host to which clients try to connect if you specify no host
explicitly.  However, connections to @code{localhost} do not work if you are
using a MySQL version prior to 3.23.27 that uses MIT-pthreads
(@code{localhost} connections are made using Unix socket files, which were not
supported by MIT-pthreads at that time).  To avoid this problem on such
systems, you should use the @code{--host} option to name
the server host explicitly.  This will make a TCP/IP connection to the
@code{mysqld} server.  In this case, you must have your real hostname in
@code{user} table entries on the server host.  (This is true even if you are
running a client program on the same host as the server.)

@item
If you get an @code{Access denied} error when trying to connect to the
database with @code{mysql -u user_name db_name}, you may have a problem
with the @code{user} table. Check this by executing @code{mysql -u root
mysql} and issuing this SQL statement:

@example
mysql> SELECT * FROM user;
@end example

The result should include an entry with the @code{Host} and @code{User}
columns matching your computer's hostname and your MySQL username.

@item
The @code{Access denied} error message will tell you who you are trying
to log in as, the host from which you are trying to connect, and whether
or not you were using a password. Normally, you should have one entry in
the @code{user} table that exactly matches the hostname and username
that were given in the error message. For example if you get an error
message that contains @code{Using password: NO}, this means that you
tried to log in without an password.

@item
If you get the following error when you try to connect from a different host
than the one on which the MySQL server is running, then there is no
row in the @code{user} table that matches that host:

@example
Host ... is not allowed to connect to this MySQL server
@end example

You can fix this by using the command-line tool @code{mysql} (on the
server host!) to add a row to the @code{user}, @code{db}, or @code{host}
table for the user/hostname combination from which you are trying to
connect and then execute @code{mysqladmin flush-privileges}.  If you are
not running MySQL Version 3.22 and you don't know the IP number or
hostname of the machine from which you are connecting, you should put an
entry with @code{'%'} as the @code{Host} column value in the @code{user}
table and restart @code{mysqld} with the @code{--log} option on the
server machine.  After trying to connect from the client machine, the
information in the MySQL log will indicate how you really did
connect.  (Then replace the @code{'%'} in the @code{user} table entry
with the actual hostname that shows up in the log.  Otherwise, you'll
have a system that is insecure.)

Another reason for this error on Linux is that you are using a binary
MySQL version that is compiled with a different glibc version
than the one you are using.  In this case you should either upgrade your
OS/glibc or download the source MySQL version and compile this
yourself.  A source RPM is normally trivial to compile and install, so
this isn't a big problem.

@item
If you get an error message where the hostname is not shown or where the
hostname is an IP, even if you try to connect with a hostname:

@example
shell> mysqladmin -u root -pxxxx -h some-hostname ver
Access denied for user: 'root@@' (Using password: YES)
@end example

This means that MySQL got some error when trying to resolve the
IP to a hostname.  In this case you can execute @code{mysqladmin
flush-hosts} to reset the internal DNS cache. @xref{DNS}.

Some permanent solutions are:

@itemize @minus
@item
Try to find out what is wrong with your DNS server and fix this.

@item
Specify IPs instead of hostnames in the MySQL privilege tables.

@item
Start @code{mysqld} with @code{--skip-name-resolve}.

@item
Start @code{mysqld} with @code{--skip-host-cache}.

@item
Connect to @code{localhost} if you are running the server and the client
on the same machine.

@item
Put the client machine names in @code{/etc/hosts}.
@end itemize

@item
If @code{mysql -u root test} works but @code{mysql -h your_hostname -u root
test} results in @code{Access denied}, then you may not have the correct name
for your host in the @code{user} table.  A common problem here is that the
@code{Host} value in the user table entry specifies an unqualified hostname,
but your system's name resolution routines return a fully qualified domain
name (or vice-versa).  For example, if you have an entry with host
@code{'tcx'} in the @code{user} table, but your DNS tells MySQL that
your hostname is @code{'tcx.subnet.se'}, the entry will not work. Try adding
an entry to the @code{user} table that contains the IP number of your host as
the @code{Host} column value.  (Alternatively, you could add an entry to the
@code{user} table with a @code{Host} value that contains a wildcard---for
example, @code{'tcx.%'}.  However, use of hostnames ending with @samp{%} is
@strong{insecure} and is @strong{not} recommended!)

@item
If @code{mysql -u user_name test} works but @code{mysql -u user_name
other_db_name} doesn't work, you don't have an entry for @code{other_db_name}
listed in the @code{db} table.

@item
If @code{mysql -u user_name db_name} works when executed on the server
machine, but @code{mysql -h host_name -u user_name db_name} doesn't work when
executed on another client machine, you don't have the client machine listed
in the @code{user} table or the @code{db} table.

@item
If you can't figure out why you get @code{Access denied}, remove from the
@code{user} table all entries that have @code{Host} values containing
wildcards (entries that contain @samp{%} or @samp{_}).  A very common error
is to insert a new entry with @code{Host}=@code{'%'} and
@code{User}=@code{'some user'}, thinking that this will allow you to specify
@code{localhost} to connect from the same machine.  The reason that this
doesn't work is that the default privileges include an entry with
@code{Host}=@code{'localhost'} and @code{User}=@code{''}.  Because that entry
has a @code{Host} value @code{'localhost'} that is more specific than
@code{'%'}, it is used in preference to the new entry when connecting from
@code{localhost}!  The correct procedure is to insert a second entry with
@code{Host}=@code{'localhost'} and @code{User}=@code{'some_user'}, or to
remove the entry with @code{Host}=@code{'localhost'} and
@code{User}=@code{''}.

@item
If you get the following error, you may have a problem with the @code{db} or
@code{host} table:

@example
Access to database denied
@end example

If the entry selected from the @code{db} table has an empty value in the
@code{Host} column, make sure there are one or more corresponding entries in
the @code{host} table specifying which hosts the @code{db} table entry
applies to.

If you get the error when using the SQL commands @code{SELECT ...
INTO OUTFILE} or @code{LOAD DATA INFILE}, your entry in the @code{user} table
probably doesn't have the @code{FILE} privilege enabled.

@item
@cindex option files
@cindex configuration files
@cindex environment variables
@tindex .my.cnf file
Remember that client programs will use connection parameters specified
in configuration files or environment variables.  @xref{Environment
variables}.  If a client seems to be sending the wrong default
connection parameters when you don't specify them on the command-line,
check your environment and the @file{.my.cnf} file in your home
directory.  You might also check the system-wide MySQL
configuration files, though it is far less likely that client connection
parameters will be specified there. If you get
@code{Access denied} when you run a client without any options, make
sure you haven't specified an old password in any of your option files!
@xref{Option files}.

@item
If you make changes to the grant tables directly (using an @code{INSERT} or
@code{UPDATE} statement) and your changes seem to be ignored, remember
that you must issue a @code{FLUSH PRIVILEGES} statement or execute a
@code{mysqladmin flush-privileges} command to cause the server to re-read
the privilege tables. Otherwise, your changes have no effect until the
next time the server is restarted.  Remember that after you set the
@code{root} password with an @code{UPDATE} command, you won't need to
specify it until after you flush the privileges, because the server
won't know you've changed the password yet!

@item
If you have access problems with a Perl, PHP, Python, or ODBC program, try to
connect to the server with @code{mysql -u user_name db_name} or @code{mysql
-u user_name -pyour_pass db_name}.  If you are able to connect using the
@code{mysql} client, there is a problem with your program and not with the
access privileges.  (Note that there is no space between @code{-p} and the
password; you can also use the @code{--password=your_pass} syntax to specify
the password. If you use the @code{-p} option alone, MySQL will
prompt you for the password.)

@item
For testing, start the @code{mysqld} daemon with the
@code{--skip-grant-tables} option.  Then you can change the MySQL
grant tables and use the @code{mysqlaccess} script to check whether
your modifications have the desired effect.  When you are satisfied with your
changes, execute @code{mysqladmin flush-privileges} to tell the @code{mysqld}
server to start using the new grant tables.  @strong{Note:} Reloading the
grant tables overrides the @code{--skip-grant-tables} option.  This allows
you to tell the server to begin using the grant tables again without bringing
it down and restarting it.

@item
If everything else fails, start the @code{mysqld} daemon with a debugging
option (for example, @code{--debug=d,general,query}). This will print host and
user information about attempted connections, as well as information about
each command issued. @xref{Making trace files}.

@item
If you have any other problems with the MySQL grant tables and
feel you must post the problem to the mailing list, always provide a
dump of the MySQL grant tables. You can dump the tables with
the @code{mysqldump mysql} command. As always, post your problem using
the @code{mysqlbug} script.  @xref{Bug reports}.  In some cases you may need
to restart @code{mysqld} with @code{--skip-grant-tables} to run
@code{mysqldump}.
@end itemize


@node User Account Management, Disaster Prevention, Privilege system, MySQL Database Administration
@section MySQL User Account Management

@c FIX: add section intro

@menu
* User names::                  MySQL Usernames and Passwords
* Privilege changes::           When Privilege Changes Take Effect
* Default privileges::          Setting Up the Initial MySQL Privileges
* Adding users::                Adding New Users to MySQL
* Drop user::                   Deleting Users from MySQL
* User resources::              Limiting user resources
* Passwords::                   Setting Up Passwords
* Password security::           Keeping Your Password Secure
* Secure connections::          Using Secure Connections
@end menu

@node User names, Privilege changes, User Account Management, User Account Management
@subsection MySQL Usernames and Passwords

@cindex usernames, and passwords
@cindex passwords, for users

There are several distinctions between the way usernames and passwords are
used by MySQL and the way they are used by Unix or Windows:

@itemize @bullet
@item
Usernames, as used by MySQL for authentication purposes, have
nothing to do with Unix usernames (login names) or Windows usernames.  Most
MySQL clients by default try to log in using the current Unix user
name as the MySQL username, but that is for convenience only.
Client programs allow a different name to be specified with the @code{-u} or
@code{--user} options. This means that you can't make a database secure in
any way unless all MySQL usernames have passwords.  Anyone may
attempt to connect to the server using any name, and they will succeed if
they specify any name that doesn't have a password.

@item
MySQL usernames can be up to 16 characters long; Unix usernames
typically are limited to 8 characters.

@item
MySQL passwords have nothing to do with Unix passwords.  There is no
necessary connection between the password you use to log in to a Unix machine
and the password you use to access a database on that machine.

@item
MySQL encrypts passwords using a different algorithm than the
one used during the Unix login process.  See the descriptions of the
@code{PASSWORD()} and @code{ENCRYPT()} functions in @ref{Encryption
functions}.  Note that even if the password is stored 'scrambled', and
knowing your 'scrambled' password is enough to be able to connect to
the MySQL server!
From version 4.1, MySQL employs a different password and login mechanism
that is secure even if TCP/IP packets are sniffed and/or the mysql
database is captured.
@end itemize

MySQL users and their privileges are normally created with the
@code{GRANT} command. @xref{GRANT}.

When you login to a MySQL server with a command-line client you
should specify the password with @code{--password=your-password}.
@xref{Connecting}.

@example
mysql --user=monty --password=guess database_name
@end example

If you want the client to prompt for a password, you should use
@code{--password} without any argument

@example
mysql --user=monty --password database_name
@end example

or the short form:

@example
mysql -u monty -p database_name
@end example

Note that in the last example the password is @strong{not} 'database_name'.

If you want to use the @code{-p} option to supply a password you should do so
like this:

@example
mysql -u monty -pguess database_name
@end example

On some systems, the library call that MySQL uses to prompt for a
password will automatically cut the password to 8 characters. Internally
MySQL doesn't have any limit for the length of the password.


@node Privilege changes, Default privileges, User names, User Account Management
@subsection When Privilege Changes Take Effect

When @code{mysqld} starts, all grant table contents are read into memory and
become effective at that point.

Modifications to the grant tables that you perform using @code{GRANT},
@code{REVOKE}, or @code{SET PASSWORD} are noticed by the server immediately.

If you modify the grant tables manually (using @code{INSERT}, @code{UPDATE},
etc.), you should execute a @code{FLUSH PRIVILEGES} statement or run
@code{mysqladmin flush-privileges} or @code{mysqladmin reload} to tell the
server to reload the grant tables. Otherwise, your changes will have @emph{no
effect} until you restart the server. If you change the grant tables manually
but forget to reload the privileges, you will be wondering why your changes
don't seem to make any difference!

When the server notices that the grant tables have been changed,
existing client connections are affected as follows:

@itemize @bullet
@item
Table and column privilege changes take effect with the client's next
request.

@item
Database privilege changes take effect at the next @code{USE db_name}
command.

@item
Global privilege changes and password changes take effect the next time
the client connects.
@end itemize


@node Default privileges, Adding users, Privilege changes, User Account Management
@subsection Setting Up the Initial MySQL Privileges

@cindex privileges, default
@cindex default, privileges
@cindex root password
@cindex superuser
@cindex users, root
@cindex anonymous user
@cindex password, root user

After installing MySQL, you set up the initial access privileges by
running @code{scripts/mysql_install_db}.
@xref{Quick install}.
The @code{mysql_install_db} script starts the @code{mysqld}
server, then initializes the grant tables to contain the following set
of privileges:

@itemize @bullet
@item
The MySQL @code{root} user is created as a superuser who can do
anything.  Connections must be made from the local host.

@strong{Note:}
The initial @code{root} password is empty, so anyone can connect as @code{root}
@emph{without a password} and be granted all privileges.

@item
@cindex anonymous user
An anonymous user is created that can do anything with databases that have a
name of @code{'test'} or starting with @code{'test_'}.  Connections must be
made from the local host.  This means any local user can connect without a
password and be treated as the anonymous user.

@item
Other privileges are denied.  For example, normal users can't use
@code{mysqladmin shutdown} or @code{mysqladmin processlist}.
@end itemize

@strong{Note:} The default privileges are different for Windows.
@xref{Windows running}.

Because your installation is initially wide open, one of the first things you
should do is specify a password for the MySQL
@code{root} user.  You can do this as follows (note that you specify the
password using the @code{PASSWORD()} function):

@example
shell> mysql -u root mysql
mysql> SET PASSWORD FOR root@@localhost=PASSWORD('new_password');
@end example

Replace @code{'new_password'} with the password that you want to use.

If you know what you are doing, you can also directly manipulate the
privilege tables:

@example
shell> mysql -u root mysql
mysql> UPDATE user SET Password=PASSWORD('new_password')
    ->     WHERE user='root';
mysql> FLUSH PRIVILEGES;
@end example

Another way to set the password is by using the @code{mysqladmin} command:

@example
shell> mysqladmin -u root password new_password
@end example

Only users with write/update access to the @code{mysql} database can change the
password for other users.  All normal users (not anonymous ones) can only
change their own password with either of the above commands or with
@code{SET PASSWORD=PASSWORD('new_password')}.

Note that if you update the password in the @code{user} table directly using
@code{UPDATE}, you must tell the server to re-read the grant tables (with
@code{FLUSH PRIVILEGES}), because the change will go unnoticed otherwise.

Once the @code{root} password has been set, thereafter you must supply that
password when you connect to the server as @code{root}.

You may wish to leave the @code{root} password blank so that you don't need
to specify it while you perform additional setup or testing. However, be sure
to set it before using your installation for any real production work.

See the @code{scripts/mysql_install_db} script to see how it sets up
the default privileges.  You can use this as a basis to see how to
add other users.

If you want the initial privileges to be different from those just described
above, you can modify @code{mysql_install_db} before you run it.

@cindex grant tables, re-creating
@cindex re-creating, grant tables
To re-create the grant tables completely, remove all the @file{.frm},
@file{.MYI}, and @file{.MYD} files in the directory containing the
@code{mysql} database.  (This is the directory named @file{mysql} under
the database directory, which is listed when you run @code{mysqld
--help}.) Then run the @code{mysql_install_db} script, possibly after
editing it first to have the privileges you want.

@strong{Note:} For MySQL versions older than Version 3.22.10,
you should not delete the @file{.frm} files.  If you accidentally do this,
you should copy them back from your MySQL distribution before
running @code{mysql_install_db}.


@node Adding users, Drop user, Default privileges, User Account Management
@subsection Adding New Users to MySQL

@findex GRANT statement
@findex statements, GRANT

@cindex privileges, adding
@cindex adding, new user privileges
@cindex user privileges, adding

You can add users two different ways: by using @code{GRANT} statements
or by manipulating the MySQL grant tables directly.  The
preferred method is to use @code{GRANT} statements, because they are
more concise and less error-prone. @xref{GRANT}.

There are also several contributed programs (such as @code{phpMyAdmin})
that can be used to create and administer users.

The following examples show how to use the @code{mysql} client to set up new
users.  These examples assume that privileges are set up according to the
defaults described in the previous section.  This means that to make changes,
you must be on the same machine where @code{mysqld} is running, you must
connect as the MySQL @code{root} user, and the @code{root} user must
have the @code{INSERT} privilege for the @code{mysql} database and the
@code{RELOAD} administrative privilege.  Also, if you have changed the
@code{root} user password, you must specify it for the @code{mysql} commands here.

First, use the @code{mysql} program to connect to the server as the
MySQL @code{root} user:

@example
shell> mysql --user=root mysql
@end example

Then you can add new users by issuing @code{GRANT} statements:

@example
mysql> GRANT ALL PRIVILEGES ON *.* TO monty@@localhost
    ->     IDENTIFIED BY 'some_pass' WITH GRANT OPTION;
mysql> GRANT ALL PRIVILEGES ON *.* TO monty@@'%'
    ->     IDENTIFIED BY 'some_pass' WITH GRANT OPTION;
mysql> GRANT RELOAD,PROCESS ON *.* TO admin@@localhost;
mysql> GRANT USAGE ON *.* TO dummy@@localhost;
@end example

These @code{GRANT} statements set up three new users:

@table @code
@item monty
A full superuser who can connect to the server from anywhere, but who must
use a password @code{'some_pass'} to do so.  Note that we must issue
@code{GRANT} statements for both @code{monty@@localhost} and
@code{monty@@"%"}.  If we don't add the entry with @code{localhost}, the
anonymous user entry for @code{localhost} that is created by
@code{mysql_install_db} takes precedence when we connect from the local
host, because it has a more specific @code{Host} column value and thus comes
earlier in the @code{user} table sort order.

@item admin
A user who can connect from @code{localhost} without a password and who is
granted the @code{RELOAD} and @code{PROCESS} administrative privileges.
This allows the user to execute the @code{mysqladmin reload},
@code{mysqladmin refresh}, and @code{mysqladmin flush-*} commands, as well as
@code{mysqladmin processlist} .  No database-level privileges are granted.
(They can be granted later by issuing additional @code{GRANT} statements.)

@item dummy
A user who can connect without a password, but only from the local host.
No privileges are granted---the @code{USAGE} privilege type allows you
to create a user with no privileges. It has the effect of setting all
the global privileges to @code{'N'}.  It is assumed that you will grant
specific privileges to the account later.
@end table

@findex INSERT statement, grant privileges
@findex statements, INSERT
You can also add the same user access information directly by issuing
@code{INSERT} statements and then telling the server to reload the grant
tables:

@example
shell> mysql --user=root mysql
mysql> INSERT INTO user VALUES('localhost','monty',PASSWORD('some_pass'),
    ->          'Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y');
mysql> INSERT INTO user VALUES('%','monty',PASSWORD('some_pass'),
    ->          'Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y');
mysql> INSERT INTO user SET Host='localhost',User='admin',
    ->           Reload_priv='Y', Process_priv='Y';
mysql> INSERT INTO user (Host,User,Password)
    ->                  VALUES('localhost','dummy','');
mysql> FLUSH PRIVILEGES;
@end example

Depending on your MySQL version, you may have to use a different number
of @code{'Y'} values above. (Versions prior to Version 3.22.11 have
fewer privilege columns, and versions from 4.0.2 on have more.)  For the
@code{admin} user, the more readable extended @code{INSERT} syntax using
@code{SET} that is available starting with Version 3.22.11 is used.

Note that to set up a superuser, you need only create a @code{user} table
entry with the privilege columns set to @code{'Y'}.  No @code{db} or
@code{host} table entries are necessary.

In the last @code{INSERT} statement (for the @code{dummy} user), only the
@code{Host}, @code{User}, and @code{Password} columns in the @code{user}
table record are assigned values. None of the privilege columns are set
explicitly, so MySQL assigns them all the default value of @code{'N'}.
This is the same thing that @code{GRANT USAGE} does.

The following example adds a user @code{custom} who can
access the @code{bankaccount} database only from the local host,
the @code{expenses} database only from the host @code{whitehouse.gov}, and
the @code{customer} database only from the host @code{server.domain}.  He wants
to use the password @code{obscure} from all three hosts.

To set up this user's privileges using @code{GRANT} statements, run these
commands:

@example
shell> mysql --user=root mysql
mysql> GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP
    ->     ON bankaccount.*
    ->     TO custom@@localhost
    ->     IDENTIFIED BY 'obscure';
mysql> GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP
    ->     ON expenses.*
    ->     TO custom@@'whitehouse.gov'
    ->     IDENTIFIED BY 'obscure';
mysql> GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP
    ->     ON customer.*
    ->     TO custom@@'server.domain'
    ->     IDENTIFIED BY 'obscure';
@end example

To set up the user's privileges by modifying the grant tables directly,
run these commands (note the @code{FLUSH PRIVILEGES} at the end):

@example
shell> mysql --user=root mysql
mysql> INSERT INTO user (Host,User,Password)
    -> VALUES('localhost','custom',PASSWORD('obscure'));
mysql> INSERT INTO user (Host,User,Password)
    -> VALUES('whitehouse.gov','custom',PASSWORD('obscure'));
mysql> INSERT INTO user (Host,User,Password)
    -> VALUES('server.domain','custom',PASSWORD('obscure'));
mysql> INSERT INTO db
    -> (Host,Db,User,Select_priv,Insert_priv,Update_priv,Delete_priv,
    ->  Create_priv,Drop_priv)
    -> VALUES
    -> ('localhost','bankaccount','custom','Y','Y','Y','Y','Y','Y');
mysql> INSERT INTO db
    -> (Host,Db,User,Select_priv,Insert_priv,Update_priv,Delete_priv,
    ->  Create_priv,Drop_priv)
    -> VALUES
    -> ('whitehouse.gov','expenses','custom','Y','Y','Y','Y','Y','Y');
mysql> INSERT INTO db
    -> (Host,Db,User,Select_priv,Insert_priv,Update_priv,Delete_priv,
    ->  Create_priv,Drop_priv)
    -> VALUES('server.domain','customer','custom','Y','Y','Y','Y','Y','Y');
mysql> FLUSH PRIVILEGES;
@end example

As in the preceding example that used @code{INSERT} statements, you may need
to use a different number of @code{'Y'} values, depending on your version of
MySQL.

The first three @code{INSERT} statements add @code{user} table entries that
allow user @code{custom} to connect from the various hosts with the given
password, but grant no permissions (all privileges are set to the
default value of @code{'N'}).  The next three @code{INSERT} statements add
@code{db} table entries that grant privileges to @code{custom} for the
@code{bankaccount}, @code{expenses}, and @code{customer} databases, but only
when accessed from the proper hosts.  As usual, after you modify the grant
tables directly , you must tell the server to reload them (with
@code{FLUSH PRIVILEGES}) so that the privilege changes take effect.

If you want to give a specific user access from any machine in a given
domain (for example, @code{mydomain.com}), you can issue a @code{GRANT}
statement like the following:

@example
mysql> GRANT ...
    ->     ON *.*
    ->     TO myusername@@'%.mydomain.com'
    ->     IDENTIFIED BY 'mypassword';
@end example

To do the same thing by modifying the grant tables directly, do this:

@example
mysql> INSERT INTO user VALUES ('%.mydomain.com', 'myusername',
    ->             PASSWORD('mypassword'),...);
mysql> FLUSH PRIVILEGES;
@end example


@node Drop user, User resources, Adding users, User Account Management
@subsection Deleting Users from MySQL

@findex DROP USER

@cindex privileges, deleting
@cindex privileges, dropping
@cindex dropping, user
@cindex user privileges, dropping
@cindex deleting, user
@cindex user privileges, deleting
@cindex deleting, users
@cindex users, deleting

@example
DROP USER user_name
@end example

This command was added to MySQL 4.1.1.

It deletes a user that doesn't have any privileges.

To delete a user from MySQL, you should use the following procedure,
performing the steps in the order shown:

@enumerate
@item
Check which privileges the user has with @code{SHOW PRIVILEGES}.
@xref{SHOW PRIVILEGES}.
@item
Delete all privileges from the user with @code{REVOKE}. @xref{GRANT}.
@item
Delete the user with @code{DROP USER}.
@end enumerate

If you are using and older MySQL version you should first revoke the
privileges and then delete the user with:

@example
DELETE FROM mysql.user WHERE user='username' and host='hostname';
FLUSH PRIVILEGES;
@end example


@node User resources, Passwords, Drop user, User Account Management
@subsection Limiting user resources

Starting from MySQL 4.0.2 one can limit certain resources per user.

So far, the only available method of limiting usage of MySQL
server resources has been setting the @code{max_user_connections}
startup variable to a non-zero value. But this method is strictly
global and does not allow for management of individual users, which
could be of particular interest to Internet Service Providers.

Therefore, management of three resources is introduced on the
individual user level:

@itemize @bullet
@item Number of all queries per hour:
All commands that could be run by a user.
@item Number of all updates per hour:
Any command that changes any table or database.
@item Number of connections made per hour:
New connections opened per hour.
@end itemize

A user in the aforementioned context is a single entry in the
@code{user} table, which is uniquely identified by its @code{user}
and @code{host} columns.

All users are by default not limited in using the above resources,
unless the limits are granted to them. These limits can be granted
@strong{only} via global @code{GRANT (*.*)}, using this syntax:

@example
GRANT ... WITH MAX_QUERIES_PER_HOUR N1
               MAX_UPDATES_PER_HOUR N2
               MAX_CONNECTIONS_PER_HOUR N3;
@end example

One can specify any combination of the above resources.
@code{N1}, @code{N2}, and @code{N3} are integers and represent counts per hour.

If a user reaches the limit on number of connections within one hour, no
further connections will be accepted until that hour is up. Similarly,
if the user reaches the limit on number of queries or updates, further
queries or updates will be rejected until the hour is up. In all cases,
an appropriate error message shall be issued.

Current usage values for a particular user can be flushed (set to zero)
by issuing a @code{GRANT} statement with any of the above clauses,
including a @code{GRANT} statement with the current values.

Also, current values for all users will be flushed if privileges are
reloaded (in the server or using @code{mysqladmin reload})
or if the @code{FLUSH USER_RESOURCES} command is issued.

The feature is enabled as soon as a single user is granted with any
of the limiting @code{GRANT} clauses.

As a prerequisite for enabling this feature, the @code{user} table in
the @code{mysql} database must contain the additional columns, as
defined in the table creation scripts @code{mysql_install_db} and
@code{mysql_install_db.sh} in @file{scripts} subdirectory.

@node Passwords, Password security, User resources, User Account Management
@subsection Setting Up Passwords

@findex PASSWORD()
@findex SET PASSWORD statement

@cindex passwords, setting
@cindex setting, passwords

In most cases you should use @code{GRANT} to set up your users/passwords,
so the following only applies for advanced users. @xref{GRANT, , @code{GRANT}}.

The examples in the preceding sections illustrate an important principle:
when you store a non-empty password using @code{INSERT} or @code{UPDATE}
statements, you must use the @code{PASSWORD()} function to encrypt it.  This
is because the @code{user} table stores passwords in encrypted form, not as
plaintext.  If you forget that fact, you are likely to attempt to set
passwords like this:

@example
shell> mysql -u root mysql
mysql> INSERT INTO user (Host,User,Password)
    -> VALUES('%','jeffrey','biscuit');
mysql> FLUSH PRIVILEGES;
@end example

The result is that the plaintext value @code{'biscuit'} is stored as the
password in the @code{user} table.  When the user @code{jeffrey} attempts to
connect to the server using this password, the @code{mysql} client encrypts
it with @code{PASSWORD()}, generates an authentication vector
based on @strong{encrypted} password and a random number,
obtained from server, and sends the result to the server.
The server uses the @code{password} value in the @code{user} table
(that is @strong{not encrypted} value @code{'biscuit'})
to perform the same calculations, and compares results.
The comparison fails and the server rejects the
connection:

@example
shell> mysql -u jeffrey -pbiscuit test
Access denied
@end example

Passwords must be encrypted when they are inserted in the @code{user}
table, so the @code{INSERT} statement should have been specified like this
instead:

@example
mysql> INSERT INTO user (Host,User,Password)
    -> VALUES('%','jeffrey',PASSWORD('biscuit'));
@end example

You must also use the @code{PASSWORD()} function when you use @code{SET
PASSWORD} statements:

@example
mysql> SET PASSWORD FOR jeffrey@@"%" = PASSWORD('biscuit');
@end example

If you set passwords using the @code{GRANT ... IDENTIFIED BY} statement
or the @code{mysqladmin password} command, the @code{PASSWORD()} function
is unnecessary.  They both take care of encrypting the password for you,
so you would specify a password of @code{'biscuit'} like this:

@example
mysql> GRANT USAGE ON *.* TO jeffrey@@"%" IDENTIFIED BY 'biscuit';
@end example

or:

@example
shell> mysqladmin -u jeffrey password biscuit
@end example

@strong{Note:} @code{PASSWORD()} is different from Unix password encryption.
@xref{User names}.


@node Password security, Secure connections, Passwords, User Account Management
@subsection Keeping Your Password Secure

It is inadvisable to specify your password in a way that exposes it to
discovery by other users.  The methods you can use to specify your password
when you run client programs are listed here, along with an assessment of
the risks of each method:

@itemize @bullet
@item
Never give a normal user access to the @code{mysql.user} table. Knowing
the encrypted password for a user makes it possible to log in as this
user.  The passwords are only scrambled so that one shouldn't be able to
see the real password you used (if you happen to use a similar password
with your other applications).

@item
Use a @code{-pyour_pass} or @code{--password=your_pass} option on the command
line.  This is convenient but insecure, because your password becomes visible
to system status programs (such as @code{ps}) that may be invoked by other
users to display command-lines.  (MySQL clients typically overwrite
the command-line argument with zeroes during their initialization sequence,
but there is still a brief interval during which the value is visible.)

@item
Use a @code{-p} or @code{--password} option (with no @code{your_pass} value
specified).  In this case, the client program solicits the password from
the terminal:
@findex -p option
@findex -password option

@example
shell> mysql -u user_name -p
Enter password: ********
@end example

The @samp{*} characters represent your password.

It is more secure to enter your password this way than to specify it on the
command-line because it is not visible to other users.  However, this method
of entering a password is suitable only for programs that you run
interactively.  If you want to invoke a client from a script that runs
non-interactively, there is no opportunity to enter the password from the
terminal. On some systems, you may even find that the first line of your
script is read and interpreted (incorrectly) as your password!

@item
@tindex .my.cnf file
Store your password in a configuration file.  For example, you can list your
password in the @code{[client]} section of the @file{.my.cnf} file in your
home directory:

@example
[client]
password=your_pass
@end example

If you store your password in @file{.my.cnf}, the file should not be group or
world-readable or -writable.  Make sure the file's access mode is @code{400}
or @code{600}.

@xref{Option files}.
@item
You can store your password in the @code{MYSQL_PWD} environment variable, but
this method must be considered extremely insecure and should not be used.
Some versions of @code{ps} include an option to display the environment of
running processes; your password will be in plain sight for all to see if
you set @code{MYSQL_PWD}.  Even on systems without such a version of
@code{ps}, it is unwise to assume there is no other method to observe process
environments. @xref{Environment variables}.
@end itemize

All in all, the safest methods are to have the client program prompt for the
password or to specify the password in a properly protected @file{.my.cnf}
file.

@node Secure connections,  , Password security, User Account Management
@subsection Using Secure Connections

@cindex OpenSSL
@cindex SSL and X509 Basics

This section describes how to set up secure connections between MySQL
clients and the server using the Secure Sockets Layer (SSL) protocol.
It also decribes a way to set up SSH on Windows.

@menu
* Secure basics::               Basics
* Secure requirements::         Requirements
* Secure create certs::         Setting Up SSL Certificates for MySQL
* Secure GRANT::                SSL @code{GRANT} Options
* SSL options::                 SSL Command-line Options
* Windows and SSH::             Connecting to MySQL Remotely from Windows with SSH
@end menu

@node Secure basics, Secure requirements, Secure connections, Secure connections
@subsubsection Basics

Beginning with version 4.0.0,
MySQL has support for SSL encrypted connections. To understand how MySQL
uses SSL, it's necessary to explain some basic SSL and X509 concepts. People
who are already familiar with them can skip this part.

By default, MySQL uses unencrypted connections between the client and the
server. This means that someone could watch all your traffic and look at
the data being sent or received.  They could even change the data
while it is in transit between client and server. Sometimes you need to
move information over public networks in a secure fashion; in such cases,
using an unencrypted connection is unacceptable.

SSL is a protocol that uses different encryption algorithms to ensure
that data received over a public network can be trusted. It has
mechanisms to detect any change, loss or replay of data. SSL also
incorporates algorithms to recognize and provide identity verification
using the X509 standard.

@cindex What is encryption
Encryption is the way to make any kind of data unreadable. In fact,
today's practice requires many additional security elements from
encryption algorithms.  They should resist many kind of known attacks
like just messing with the order of encrypted messages or replaying data
twice.

@cindex What is an X509/Certificate?
X509 is a standard that makes it possible to identify someone on the
Internet.  It is most commonly used in e-commerce applications. In basic
terms, there should be some company (called a ``Certificate Authority'') that
assigns electronic certificates to anyone who needs them. Certificates
rely on asymmetric encryption algorithms that have two encryption keys
(a public key and a secret key). A certificate owner can prove his identity by
showing his certificate to other party. A certificate consists of its
owner's public key. Any data encrypted with this public key can be
decrypted only using the corresponding secret key, which is held by the owner
of the certificate.

MySQL doesn't use encrypted connections by default, because doing so
would make the client/server protocol much slower. Any kind of
additional functionality requires the computer to do additional work and
encrypting data is a CPU-intensive operation that requires time and can delay
MySQL main tasks. By default MySQL is tuned to be fast as possible.

If you need more information about SSL, X509, or encryption, you should use
your favorite Internet search engine and search for keywords in which you are
interested.

@node Secure requirements, Secure create certs, Secure basics, Secure connections
@subsubsection Requirements

To get secure connections to work with MySQL you must do the following:

@enumerate
@item
Install the OpenSSL library. We have tested MySQL with OpenSSL 0.9.6.
@uref{http://www.openssl.org/}.
@item
Configure MySQL with @code{--with-vio --with-openssl}.
@item
If you are using an old MySQL installation, you have to update your
@code{mysql.user} table with some new SSL-related columns.
This is necessary if your grant tables date from a version prior to MySQL
4.0.0.  The procedure is described in @ref{Upgrading-grant-tables}.
@item
You can check if a running @code{mysqld} server supports OpenSSL by
examining if @code{SHOW VARIABLES LIKE 'have_openssl'} returns @code{YES}.
@end enumerate


@node Secure create certs, Secure GRANT, Secure requirements, Secure connections
@subsubsection Setting Up SSL Certificates for MySQL

Here is an example for setting up SSL certificates for MySQL:

@example
DIR=`pwd`/openssl
PRIV=$DIR/private

mkdir $DIR $PRIV $DIR/newcerts
cp /usr/share/ssl/openssl.cnf $DIR
replace ./demoCA $DIR -- $DIR/openssl.cnf

# Create necessary files: $database, $serial and $new_certs_dir 
# directory (optional)

touch $DIR/index.txt
echo "01" > $DIR/serial

#
# Generation of Certificate Authority(CA)
#

openssl req -new -x509 -keyout $PRIV/cakey.pem -out $DIR/cacert.pem \
    -config $DIR/openssl.cnf

# Sample output:
# Using configuration from /home/monty/openssl/openssl.cnf
# Generating a 1024 bit RSA private key
# ................++++++
# .........++++++
# writing new private key to '/home/monty/openssl/private/cakey.pem'
# Enter PEM pass phrase:
# Verifying password - Enter PEM pass phrase:
# -----
# You are about to be asked to enter information that will be incorporated
# into your certificate request.
# What you are about to enter is what is called a Distinguished Name or a DN.
# There are quite a few fields but you can leave some blank
# For some fields there will be a default value,
# If you enter '.', the field will be left blank.
# -----
# Country Name (2 letter code) [AU]:FI
# State or Province Name (full name) [Some-State]:.
# Locality Name (eg, city) []:
# Organization Name (eg, company) [Internet Widgits Pty Ltd]:MySQL AB
# Organizational Unit Name (eg, section) []:
# Common Name (eg, YOUR name) []:MySQL admin
# Email Address []:

#
# Create server request and key
#
openssl req -new -keyout $DIR/server-key.pem -out \
    $DIR/server-req.pem -days 3600 -config $DIR/openssl.cnf

# Sample output:
# Using configuration from /home/monty/openssl/openssl.cnf
# Generating a 1024 bit RSA private key
# ..++++++
# ..........++++++
# writing new private key to '/home/monty/openssl/server-key.pem'
# Enter PEM pass phrase:
# Verifying password - Enter PEM pass phrase:
# -----
# You are about to be asked to enter information that will be incorporated
# into your certificate request.
# What you are about to enter is what is called a Distinguished Name or a DN.
# There are quite a few fields but you can leave some blank
# For some fields there will be a default value,
# If you enter '.', the field will be left blank.
# -----
# Country Name (2 letter code) [AU]:FI
# State or Province Name (full name) [Some-State]:.
# Locality Name (eg, city) []:
# Organization Name (eg, company) [Internet Widgits Pty Ltd]:MySQL AB
# Organizational Unit Name (eg, section) []:
# Common Name (eg, YOUR name) []:MySQL server
# Email Address []:
# 
# Please enter the following 'extra' attributes
# to be sent with your certificate request
# A challenge password []:
# An optional company name []:

#
# Remove the passphrase from the key (optional)
#

openssl rsa -in $DIR/server-key.pem -out $DIR/server-key.pem

#
# Sign server cert
#
openssl ca  -policy policy_anything -out $DIR/server-cert.pem \
    -config $DIR/openssl.cnf -infiles $DIR/server-req.pem

# Sample output:
# Using configuration from /home/monty/openssl/openssl.cnf
# Enter PEM pass phrase:
# Check that the request matches the signature
# Signature ok
# The Subjects Distinguished Name is as follows
# countryName           :PRINTABLE:'FI'
# organizationName      :PRINTABLE:'MySQL AB'
# commonName            :PRINTABLE:'MySQL admin'
# Certificate is to be certified until Sep 13 14:22:46 2003 GMT (365 days)
# Sign the certificate? [y/n]:y
# 
# 
# 1 out of 1 certificate requests certified, commit? [y/n]y
# Write out database with 1 new entries
# Data Base Updated

#
# Create client request and key
#
openssl req -new -keyout $DIR/client-key.pem -out \
    $DIR/client-req.pem -days 3600 -config $DIR/openssl.cnf

# Sample output:
# Using configuration from /home/monty/openssl/openssl.cnf
# Generating a 1024 bit RSA private key
# .....................................++++++
# .............................................++++++
# writing new private key to '/home/monty/openssl/client-key.pem'
# Enter PEM pass phrase:
# Verifying password - Enter PEM pass phrase:
# -----
# You are about to be asked to enter information that will be incorporated
# into your certificate request.
# What you are about to enter is what is called a Distinguished Name or a DN.
# There are quite a few fields but you can leave some blank
# For some fields there will be a default value,
# If you enter '.', the field will be left blank.
# -----
# Country Name (2 letter code) [AU]:FI
# State or Province Name (full name) [Some-State]:.
# Locality Name (eg, city) []:
# Organization Name (eg, company) [Internet Widgits Pty Ltd]:MySQL AB
# Organizational Unit Name (eg, section) []:
# Common Name (eg, YOUR name) []:MySQL user
# Email Address []:
# 
# Please enter the following 'extra' attributes
# to be sent with your certificate request
# A challenge password []:
# An optional company name []:

#
# Remove a passphrase from the key (optional)
#
openssl rsa -in $DIR/client-key.pem -out $DIR/client-key.pem

#
# Sign client cert
#

openssl ca  -policy policy_anything -out $DIR/client-cert.pem \
    -config $DIR/openssl.cnf -infiles $DIR/client-req.pem

# Sample output:
# Using configuration from /home/monty/openssl/openssl.cnf
# Enter PEM pass phrase:
# Check that the request matches the signature
# Signature ok
# The Subjects Distinguished Name is as follows
# countryName           :PRINTABLE:'FI'
# organizationName      :PRINTABLE:'MySQL AB'
# commonName            :PRINTABLE:'MySQL user'
# Certificate is to be certified until Sep 13 16:45:17 2003 GMT (365 days)
# Sign the certificate? [y/n]:y
# 
# 
# 1 out of 1 certificate requests certified, commit? [y/n]y
# Write out database with 1 new entries
# Data Base Updated

#
# Create a my.cnf file that you can use to test the certificates
#

cnf=""
cnf="$cnf [client]"
cnf="$cnf ssl-ca=$DIR/cacert.pem"
cnf="$cnf ssl-cert=$DIR/client-cert.pem"
cnf="$cnf ssl-key=$DIR/client-key.pem"
cnf="$cnf [mysqld]"
cnf="$cnf ssl-ca=$DIR/cacert.pem"
cnf="$cnf ssl-cert=$DIR/server-cert.pem"
cnf="$cnf ssl-key=$DIR/server-key.pem"
echo $cnf | replace " " '
' > $DIR/my.cnf

#
# To test MySQL

mysqld --defaults-file=$DIR/my.cnf &

mysql --defaults-file=$DIR/my.cnf
@end example

You can also test your setup by modifying the above @file{my.cnf} file
to refer to the demo certificates in the mysql-source-dist/SSL direcory.


@node Secure GRANT, SSL options, Secure create certs, Secure connections
@subsubsection SSL @code{GRANT} Options

@cindex SSL related options
@findex REQUIRE GRANT option
@findex GRANT statement

MySQL can check X509 certificate attributes in addition to the
normal username/password scheme. All the usual options are still
required (username, password, IP address mask, database/table name).

There are different possibilities to limit connections:

@itemize @bullet
@item
Without any SSL or X509 options, all kind of encrypted/unencrypted
connections are allowed if the username and password are valid.

@item
@code{REQUIRE SSL} option limits the server to allow only SSL
encrypted connections. Note that this option can be omitted
if there are any ACL records which allow non-SSL connections.

@example
mysql> GRANT ALL PRIVILEGES ON test.* TO root@@localhost
    -> IDENTIFIED BY 'goodsecret' REQUIRE SSL;
@end example

@item
@code{REQUIRE X509} means that the client should have a valid certificate
but we do not care about the exact certificate, issuer or subject.
The only restriction is that it should be possible to verify its
signature with one of the CA certificates.

@example
mysql> GRANT ALL PRIVILEGES ON test.* TO root@@localhost
    -> IDENTIFIED BY 'goodsecret' REQUIRE X509;
@end example

@item
@code{REQUIRE ISSUER 'issuer'} places a restriction on connection attempts:
The client must present a valid X509 certificate issued by CA @code{'issuer'}.
Using X509 certificates always implies encryption, so the @code{SSL} option
is unneccessary.

@example
mysql> GRANT ALL PRIVILEGES ON test.* TO root@@localhost
    -> IDENTIFIED BY 'goodsecret'
    -> REQUIRE ISSUER 'C=FI, ST=Some-State, L=Helsinki,
    '> O=MySQL Finland AB, CN=Tonu Samuel/Email=tonu@@mysql.com';
@end example

@item
@code{REQUIRE SUBJECT 'subject'} requires clients to have valid X509
certificate with subject @code{'subject'} on it. If the client presents a
certificate that is valid but has a different @code{'subject'}, the connection
is disallowed.

@example
mysql> GRANT ALL PRIVILEGES ON test.* TO root@@localhost
    -> IDENTIFIED BY 'goodsecret'
    -> REQUIRE SUBJECT 'C=EE, ST=Some-State, L=Tallinn,
    '> O=MySQL demo client certificate,
    '> CN=Tonu Samuel/Email=tonu@@mysql.com';
@end example

@item
@code{REQUIRE CIPHER 'cipher'} is needed to assure enough strong ciphers
and keylengths will be used. SSL itself can be weak if old algorithms
with short encryption keys are used. Using this option, we can ask for
some exact cipher method to allow a connection.

@example
mysql> GRANT ALL PRIVILEGES ON test.* TO root@@localhost
    -> IDENTIFIED BY 'goodsecret'
    -> REQUIRE CIPHER 'EDH-RSA-DES-CBC3-SHA';
@end example

The @code{SUBJECT}, @code{ISSUER}, and @code{CIPHER} options can be
combined in the @code{REQUIRE} clause like this:

@example
mysql> GRANT ALL PRIVILEGES ON test.* TO root@@localhost
    -> IDENTIFIED BY 'goodsecret'
    -> REQUIRE SUBJECT 'C=EE, ST=Some-State, L=Tallinn,
    '> O=MySQL demo client certificate,
    '> CN=Tonu Samuel/Email=tonu@@mysql.com'
    -> AND ISSUER 'C=FI, ST=Some-State, L=Helsinki,
    '> O=MySQL Finland AB, CN=Tonu Samuel/Email=tonu@@mysql.com'
    -> AND CIPHER 'EDH-RSA-DES-CBC3-SHA';
@end example

Starting from MySQL 4.0.4 the @code{AND} keyword is optional between
@code{REQUIRE} options.

The order of the options does not matter, but no option can be specified
twice.
@end itemize

@node SSL options, Windows and SSH, Secure GRANT, Secure connections
@subsubsection SSL Command-line Options

@cindex SSL command-line options

The following table lists options that are used for specifying the
use of SSL, certificate files, and key files.
These options are available beginning with MySQL 4.0. They may
be given on the command line or in option files.

@table @code

@item --ssl
For the server, specifies that the server allows SSL connections.
For a client program, allows the client to connect to the server using SSL.
This option itself is not sufficient to cause an SSL connection to be used.
You must also specify the
@code{--ssl-ca}, @code{--ssl-cert}, and @code{--ssl-key} options.

Note that this option doesn't @strong{require} an SSL connection.
For example, if the server or client are compiled without SSL support,
a normal unencrypted connection will be used.

The secure way to ensure that a SSL connection will be used is
to create an account on the server that includes a
@code{REQUIRE SSL} clause in the @code{GRANT} statement.
Then use this account to connect to the server, with both a server and client
that have SSL support enabled.

You can use this option to indicate that the connection should not use SSL.
Do this by specifying the option as @code{--skip-ssl} or @code{--ssl=0}.

@item --ssl-ca=file_name
The path to a file with a list of trusted SSL CAs.

@item --ssl-capath=directory_name
The path to a directory that contains trusted 
SSL CA certificates in pem format.

@item --ssl-cert=file_name
The name of the SSL certificate file to use
used for establishing a secure connection.

@item --ssl-cipher=cipher_list
A list of allowable ciphers to use for SSL encryption.
@code{cipher_list} has the same format as the @code{openssl ciphers}
command.

Example: @code{--ssl-cipher=ALL:-AES:-EXP}

@item --ssl-key=file_name
The name of the SSL key file to use
used for establishing a secure connection.

@end table


@node Windows and SSH,  , SSL options, Secure connections
@subsubsection Connecting to MySQL Remotely from Windows with SSH

@cindex SSH
@cindex connecting, remotely with SSH

Here is a note about how to connect to get a secure connection to remote
MySQL server with SSH (by David Carlson @email{dcarlson@@mplcomm.com}):

@enumerate
@item
@c URLs last verified: 2003-11-15
Install an SSH client on your Windows machine.  As a user, the best non-free
one I've found is from @code{SecureCRT} from @uref{http://www.vandyke.com/}.
Another option is @code{f-secure} from @uref{http://www.f-secure.com/}. You
can also find some free ones on @code{Google} at
@uref{http://directory.google.com/Top/Computers/Security/Products_and_Tools/Cryptography/SSH/Clients/Windows/}.

@item
Start your Windows SSH client.
Set @code{Host_Name = yourmysqlserver_URL_or_IP}.
Set @code{userid=your_userid} to log in to your server. This @code{userid}
value may not be the same as the username of your MySQL account.

@item
Set up port forwarding. Either do a remote forward (Set @code{local_port: 3306}, @code{remote_host: yourmysqlservername_or_ip}, @code{remote_port: 3306} )
or a local forward (Set @code{port: 3306},  @code{host: localhost}, @code{remote port: 3306}).

@item
Save everything, otherwise you'll have to redo it the next time.

@item
Log in to your server with the SSH session you just created.

@item
On your Windows machine, start some ODBC application (such as Access).

@item
Create a new file in Windows and link to MySQL using the ODBC
driver the same way you normally do, except type in @code{localhost}
for the MySQL host server---not @code{yourmysqlservername}.
@end enumerate

You should now have an ODBC connection to MySQL, encrypted using SSH.


@node Disaster Prevention, Localisation, User Account Management, MySQL Database Administration
@section Disaster Prevention and Recovery

@c help_category Recovery

This section discusses how to make database backups and how to perform
table maintenance.  The syntax of the SQL statements described here is
given in @ref{Database Administration}.

@c FIX: add section intro

@menu
* Backup::                      Database Backups
* Table maintenance::           Using @code{myisamchk} for Table Maintenance and Crash Recovery
* Maintenance regimen::         Setting Up a Table Maintenance Regimen
* Table-info::                  Getting Information About a Table
@end menu


@node Backup, Table maintenance, Disaster Prevention, Disaster Prevention
@subsection Database Backups

@cindex databases, backups
@cindex backups

Because MySQL tables are stored as files, it is easy to do a
backup. To get a consistent backup, do a @code{LOCK TABLES} on the
relevant tables followed by @code{FLUSH TABLES} for the tables.
@xref{LOCK TABLES, , @code{LOCK TABLES}}.
@xref{FLUSH, , @code{FLUSH}}.
You only need a read lock; this allows other threads to continue to
query the tables while you are making a copy of the files in the
database directory.  The @code{FLUSH TABLE} is needed to ensure that
the all active index pages is written to disk before you start the backup.

Starting from 3.23.56 and 4.0.12 @code{BACKUP TABLE} will not allow you
to overwrite existing files as this would be a security risk.

If you want to make an SQL level backup of a table, you can use
@code{SELECT INTO OUTFILE} or @code{BACKUP TABLE}. @xref{SELECT}.
@xref{BACKUP TABLE}.

Another way to back up a database is to use the @code{mysqldump} program or
the @code{mysqlhotcopy script}. @xref{mysqldump, , @code{mysqldump}}.
@xref{mysqlhotcopy, , @code{mysqlhotcopy}}.

@enumerate
@item
Do a full backup of your database:

@example
shell> mysqldump --tab=/path/to/some/dir --opt db_name
@end example

or:

@example
shell> mysqlhotcopy db_name /path/to/some/dir
@end example

You can also simply copy all table files (@file{*.frm}, @file{*.MYD}, and
@file{*.MYI} files) as long as the server isn't updating anything.
The script @code{mysqlhotcopy} does use this method.  (But note that these
methods
will not work if your database contains @code{InnoDB} tables.  @code{InnoDB}
does not store table contents in database directories, and @code{mysqlhotcopy}
works only for @code{MyISAM} and @code{ISAM} tables.)

@item
@cindex log files, names
Stop @code{mysqld} if it's running, then start it with the
@code{--log-bin[=file_name]} option.  @xref{Binary log}. The binary
log files provide you with the information you need to replicate
changes to the database that are made subsequent to the point at which
you executed @code{mysqldump}.
@end enumerate

If your MySQL server is a slave, whatever backup method you choose,
when you backup your slave's data, you should also backup the
@file{master.info} and @file{relay-log.info} files
which are always needed to resume replication after you restore
the slave's data. If your slave is subject to replicating @code{LOAD
DATA INFILE} commands, you should also backup the @file{SQL_LOAD-*} files
which may exist in the directory specified by the @code{--slave-load-tmpdir}
option. (This location defaults to the value of the @code{tmpdir} variable
if not specified.) The slave will need these files to resume
replication of any interrupted @code{LOAD DATA INFILE} operations. 

If you have to restore something, try to recover your tables using
@code{REPAIR TABLE} or @code{myisamchk -r} first.  That should work in
99.9% of all cases.  If @code{myisamchk} fails, try the following
procedure (this will work only if you have started MySQL with
@code{--log-bin}, see @ref{Binary log}):

@enumerate
@item
Restore the original @code{mysqldump} backup, or binary backup.
@item
Execute the following command to re-run the updates in the binary log:

@example
shell> mysqlbinlog hostname-bin.[0-9]* | mysql
@end example

In your case you may want to re-run only certain binlogs, from
certain positions (usually you want to re-run all binlogs from the
date of the restored backup, possibly excepted some wrong queries).
See @ref{mysqlbinlog} for more information on the @code{mysqlbinlog}
utility and how to use it.

If you are using the update log (which is removed in MySQL 5.0.0)
you can execute the content of the update log like this:

@example
shell> ls -1 -t -r hostname.[0-9]* | xargs cat | mysql
@end example
@end enumerate

@code{ls} is used to get all the update log files in the right order.

You can also do selective backups with @code{SELECT * INTO OUTFILE 'file_name'
FROM tbl_name} and restore with @code{LOAD DATA INFILE 'file_name' REPLACE
...} To avoid duplicate records, you need a @code{PRIMARY KEY} or a
@code{UNIQUE} key in the table. The @code{REPLACE} keyword causes old records
to be replaced with new ones when a new record duplicates an old record on
a unique key value.

If you get performance problems in making backups on your system, you can
solve this by setting up replication and do the backups on the slave
instead of on the master. @xref{Replication Intro}.

If you are using a Veritas filesystem, you can do:

@enumerate
@item
From a client (or Perl), execute: @code{FLUSH TABLES WITH READ LOCK}.

@item
From another shell, execute: @code{mount vxfs snapshot}.

@item
From the first client, execute: @code{UNLOCK TABLES}.

@item
Copy files from snapshot.

@item
Unmount snapshot.
@end enumerate

@node Table maintenance, Maintenance regimen, Backup, Disaster Prevention
@subsection Using @code{myisamchk} for Table Maintenance and Crash Recovery

Starting with MySQL Version 3.23.13, you can check MyISAM
tables with the @code{CHECK TABLE} command. @xref{CHECK TABLE}.  You can
repair tables with the @code{REPAIR TABLE} command. @xref{REPAIR TABLE}.

To check/repair MyISAM tables (@file{.MYI} and @file{.MYD}) you should
use the @code{myisamchk} utility. To check/repair ISAM tables
(@file{.ISM} and @file{.ISD}) you should use the @code{isamchk}
utility. @xref{Table types}.

In the following text we will talk about @code{myisamchk}, but everything
also applies to the old @code{isamchk}.

You can use the @code{myisamchk} utility to get information about your
database tables, check and repair them, or optimize them.  The following
sections describe how to invoke @code{myisamchk} (including a
description of its options), how to set up a table maintenance schedule,
and how to use @code{myisamchk} to perform its various functions.

You can, in most cases, also use the command @code{OPTIMIZE TABLES} to
optimize and repair tables, but this is not as fast or reliable (in case
of real fatal errors) as @code{myisamchk}.  On the other hand,
@code{OPTIMIZE TABLE} is easier to use and you don't have to worry about
flushing tables.
@xref{OPTIMIZE TABLE, , @code{OPTIMIZE TABLE}}.

Even though the repair in @code{myisamchk} is quite secure, it's always a
good idea to make a backup @emph{before} doing a repair (or anything that could
make a lot of changes to a table)

@menu
* myisamchk syntax::            @code{myisamchk} Invocation Syntax
* myisamchk general options::   General Options for @code{myisamchk}
* myisamchk check options::     Check Options for @code{myisamchk}
* myisamchk repair options::    Repair Options for myisamchk
* myisamchk other options::     Other Options for @code{myisamchk}
* myisamchk memory::            @code{myisamchk} Memory Usage
* Crash recovery::              Using @code{myisamchk} for Crash Recovery
* Check::                       How to Check Tables for Errors
* Repair::                      How to Repair Tables
* Optimisation::                Table Optimization
@end menu


@node myisamchk syntax, myisamchk general options, Table maintenance, Table maintenance
@subsubsection @code{myisamchk} Invocation Syntax

@code{myisamchk} is invoked like this:

@example
shell> myisamchk [options] tbl_name
@end example

The @code{options} specify what you want @code{myisamchk} to do.  They are
described here.  (You can also get a list of options by invoking
@code{myisamchk --help}.)  With no options, @code{myisamchk} simply checks your
table.  To get more information or to tell @code{myisamchk} to take corrective
action, specify options as described here and in the following sections.

@code{tbl_name} is the database table you want to check/repair.  If you run
@code{myisamchk} somewhere other than in the database directory, you must
specify the path to the file, because @code{myisamchk} has no idea where your
database is located.  Actually, @code{myisamchk} doesn't care whether
the files you are working on are located in a database directory; you can
copy the files that correspond to a database table into another location and
perform recovery operations on them there.

You can name several tables on the @code{myisamchk} command-line if you
wish.  You can also specify a name as an index file
name (with the @file{.MYI} suffix), which allows you to specify all
tables in a directory by using the pattern @file{*.MYI}.
For example, if you are in a database directory, you can check all the
tables in the directory like this:

@example
shell> myisamchk *.MYI
@end example

If you are not in the database directory, you can check all the tables there
by specifying the path to the directory:

@example
shell> myisamchk /path/to/database_dir/*.MYI
@end example

You can even check all tables in all databases by specifying a wildcard
with the path to the MySQL data directory:

@example
shell> myisamchk /path/to/datadir/*/*.MYI
@end example

The recommended way to quickly check all tables is:

@example
myisamchk --silent --fast /path/to/datadir/*/*.MYI
isamchk --silent /path/to/datadir/*/*.ISM
@end example

If you want to check all tables and repair all tables that are corrupted,
you can use the following line:

@example
myisamchk --silent --force --fast --update-state -O key_buffer=64M \
          -O sort_buffer=64M -O read_buffer=1M -O write_buffer=1M \
          /path/to/datadir/*/*.MYI
isamchk --silent --force -O key_buffer=64M -O sort_buffer=64M \
        -O read_buffer=1M -O write_buffer=1M /path/to/datadir/*/*.ISM
@end example

The above assumes that you have more than 64 M free.

Note that if you get an error like:

@example
myisamchk: warning: 1 clients is using or hasn't closed the table properly
@end example

This means that you are trying to check a table that has been updated by
another program (like the @code{mysqld} server) that hasn't yet closed
the file or that has died without closing the file properly.

If @code{mysqld} is running, you must force a sync/close of all
tables with @code{FLUSH TABLES} and ensure that no one is using the
tables while you are running @code{myisamchk}.  In MySQL Version 3.23
the easiest way to avoid this problem is to use @code{CHECK TABLE}
instead of @code{myisamchk} to check tables.

@node myisamchk general options, myisamchk check options, myisamchk syntax, Table maintenance
@subsubsection General Options for @code{myisamchk}

@cindex options, @code{myisamchk}
@cindex @code{myisamchk}, options

@code{myisamchk} supports the following options.

@table @code
@item -# or --debug=debug_options
Output debug log. The @code{debug_options} string often is
@code{'d:t:o,filename'}.
@item -? or --help
Display a help message and exit.
@item -O name=value, --set-variable=name=value
Set the value of a variable.
Please note that @code{--set-variable=name=value} and @code{-O name=value}
syntax is deprecated as of MySQL 4.0.  Use @code{--name=value} instead.
The possible variables and their default values
for myisamchk can be examined with @code{myisamchk --help}:
@multitable @columnfractions .20 .10
@item @strong{Variable} @tab @strong{Value}
@item key_buffer_size @tab 523264
@item read_buffer_size @tab 262136
@item write_buffer_size @tab 262136
@item sort_buffer_size @tab 2097144
@item sort_key_blocks @tab 16
@item decode_bits @tab 9
@end multitable

@code{sort_buffer_size} is used when the keys are repaired by sorting
keys, which is the normal case when you use @code{--recover}.

@code{key_buffer_size} is used when you are checking the table with
@code{--extended-check} or when the keys are repaired by inserting key
row by row in to the table (like when doing normal inserts). Repairing
through the key buffer is used in the following cases:

@itemize @bullet
@item
If you use @code{--safe-recover}.
@item
If the temporary files needed to sort the keys would be more than twice
as big as when creating the key file directly.  This is often the case
when you have big @code{CHAR}, @code{VARCHAR} or @code{TEXT} keys as the
sort needs to store the whole keys during sorting. If you have lots
of temporary space and you can force @code{myisamchk} to repair by sorting
you can use the @code{--sort-recover} option.
@end itemize

Reparing through the key buffer takes much less disk space than using
sorting, but is also much slower.

If you want a faster repair, set the above variables to about 1/4 of your
available memory.  You can set both variables to big values, as only one
of the above buffers will be used at a time.

@item -s or --silent
Silent mode.  Write output only when errors occur. You can use @code{-s}
twice (@code{-ss}) to make @code{myisamchk} very silent.
@item -v or --verbose
Verbose mode.  Print more information. This can be used with @code{-d} and
@code{-e}. Use @code{-v} multiple times (@code{-vv}, @code{-vvv}) for more
verbosity!
@item -V or --version
Print the @code{myisamchk} version and exit.
@item -w or, --wait
Instead of giving an error if the table is locked, wait until the table
is unlocked before continuing.  Note that if you are running @code{mysqld}
on the table with @code{--skip-external-locking}, the table can only be locked
by another @code{myisamchk} command.
@end table


@node myisamchk check options, myisamchk repair options, myisamchk general options, Table maintenance
@subsubsection Check Options for @code{myisamchk}

@cindex check options, myisamchk
@cindex tables, checking

@table @code
@item -c or --check
Check table for errors. This is the default operation if you are not
giving @code{myisamchk} any options that override this.

@item -e or --extend-check
Check the table very thoroughly (which is quite slow if you have many
indexes).  This option should only be used in extreme cases.  Normally,
@code{myisamchk} or @code{myisamchk --medium-check} should, in most
cases, be able to find out if there are any errors in the table.

If you are using @code{--extended-check} and have much memory, you should
increase the value of @code{key_buffer_size} a lot!

@item -F or --fast
Check only tables that haven't been closed properly.
@item -C or --check-only-changed
Check only tables that have changed since the last check.
@item -f or --force
Restart @code{myisamchk} with @code{-r} (repair) on the table, if
@code{myisamchk} finds any errors in the table.
@item -i or --information
Print informational statistics about the table that is checked.
@item -m or --medium-check
Faster than extended-check, but only finds 99.99% of all errors.
Should, however, be good enough for most cases.
@item -U or --update-state
Store in the @file{.MYI} file when the table was checked and if the table crashed.  This should be used to get full benefit of the
@code{--check-only-changed} option, but you shouldn't use this
option if the @code{mysqld} server is using the table and you are
running @code{mysqld} with @code{--skip-external-locking}.
@item -T or --read-only
Don't mark table as checked. This is useful if you use @code{myisamchk}
to check a table that is in use by some other application that doesn't
use locking (like @code{mysqld --skip-external-locking}).
@end table


@node myisamchk repair options, myisamchk other options, myisamchk check options, Table maintenance
@subsubsection Repair Options for myisamchk

@cindex repair options, myisamchk
@cindex files, repairing

The following options are used if you start @code{myisamchk} with
@code{-r} or @code{-o}:

@table @code
@item -B or --backup
Make a backup of the @file{.MYD} file as @file{filename-time.BAK}
@item --correct-checksum
Correct checksum information for table.
@item -D # or --data-file-length=#
Max length of datafile (when re-creating datafile when it's 'full').
@item -e or --extend-check
Try to recover every possible row from the datafile.
Normally this will also find a lot of garbage rows. Don't use this option
if you are not totally desperate.
@item -f or --force
Overwrite old temporary files (@file{table_name.TMD}) instead of aborting.
@item -k # or --keys-used=#
If you are using @code{ISAM}, tells the @code{ISAM} storage engine to update only the
first @code{#} indexes.  If you are using @code{MyISAM}, tells which keys
to use, where each binary bit stands for one key (first key is bit 0).
This can be used to get faster inserts!  Deactivated indexes can be
reactivated by using @code{myisamchk -r}.
@item -l or --no-symlinks
Do not follow symbolic links. Normally @code{myisamchk} repairs the
table a symlink points at.  This option doesn't exist in MySQL 4.0,
as MySQL 4.0 will not remove symlinks during repair.
@item -p or --parallel-recover
Uses the same technique as @code{-r} and @code{-n}, but creates
all the keys in parallel, in different threads.
This option was added in MySQL 4.0.2.
@strong{This is alpha code. Use at your own risk!}
@item -r or --recover
Can fix almost anything except unique keys that aren't unique
(which is an extremely unlikely error with @code{ISAM}/@code{MyISAM} tables).
If you want to recover a table, this is the option to try first. Only if
@code{myisamchk} reports that the table can't be recovered by @code{-r}, you
should then try @code{-o}.  (Note that in the unlikely case that @code{-r}
fails, the datafile is still intact.)
If you have lots of memory, you should increase the size of
@code{sort_buffer_size}!
@item  -o or --safe-recover
Uses an old recovery method (reads through all rows in order and updates
all index trees based on the found rows); this is an order of magnitude
slower than @code{-r}, but can handle a couple of very unlikely cases that
@code{-r} cannot handle.  This recovery method also uses much less disk
space than @code{-r}. Normally one should always first repair with
@code{-r}, and only if this fails use @code{-o}.

If you have lots of memory, you should increase the size of
@code{key_buffer_size}!
@item -n or --sort-recover
Force @code{myisamchk} to use sorting to resolve the keys even if the
temporary files should be very big.

@item --character-sets-dir=...
Directory where character sets are stored.
@item --set-character-set=name
Change the character set used by the index
@item -t or --tmpdir=path
Path for storing temporary files. If this is not set, @code{myisamchk} will
use the environment variable @code{TMPDIR} for this.
Starting from MySQL 4.1, @code{tmpdir} can be set to a list of paths
separated by colon @code{:} (semicolon @code{;} on Windows). They
will be used in round-robin fashion.
@item -q or --quick
Faster repair by not modifying the datafile. One can give a second
@code{-q} to force @code{myisamchk} to modify the original datafile in case
of duplicate keys
@item -u or --unpack
Unpack file packed with myisampack.
@end table


@node myisamchk other options, myisamchk memory, myisamchk repair options, Table maintenance
@subsubsection Other Options for @code{myisamchk}

Other actions that @code{myisamchk} can do, besides repair and check tables:

@table @code
@item -a or --analyze
Analyze the distribution of keys. This improves join performance by
enabling the join optimizer to better choose in which order it should
join the tables and which keys it should use:
@code{myisamchk --describe --verbose table_name'} or using @code{SHOW KEYS} in
MySQL.
@item -d or --description
Prints some information about table.
@item -A or --set-auto-increment[=value]
Force @code{AUTO_INCREMENT} to start at this or higher value. If no value is
given, then sets the next @code{AUTO_INCREMENT} value to the highest used value
for the auto key + 1.
@item -S or --sort-index
Sort the index tree blocks in high-low order.
This will optimize seeks and will make table scanning by key faster.
@item -R or --sort-records=#
Sorts records according to an index.  This makes your data much more localized
and may speed up ranged @code{SELECT} and @code{ORDER BY} operations on
this index. (It may be very slow to do a sort the first time!)
To find out a table's index numbers, use @code{SHOW INDEX}, which shows a
table's indexes in the same order that @code{myisamchk} sees them.  Indexes are
numbered beginning with 1.
@end table


@node myisamchk memory, Crash recovery, myisamchk other options, Table maintenance
@subsubsection @code{myisamchk} Memory Usage

@cindex memory usage, myisamchk

Memory allocation is important when you run @code{myisamchk}.
@code{myisamchk} uses no more memory than you specify with the @code{-O}
options.  If you are going to use @code{myisamchk} on very large files,
you should first decide how much memory you want it to use.  The default
is to use only about 3M to perform repairs.  By using larger values, you can
get @code{myisamchk} to operate faster.  For example, if you have more
than 32M RAM, you could use options such as these (in addition to any
other options you might specify):

@example
shell> myisamchk -O sort=16M -O key=16M -O read=1M -O write=1M ...
@end example

Using @code{-O sort=16M} should probably be enough for most cases.

Be aware that @code{myisamchk} uses temporary files in @code{TMPDIR}. If
@code{TMPDIR} points to a memory filesystem, you may easily get out of
memory errors. If this happens, set @code{TMPDIR} to point at some directory
with more space and restart @code{myisamchk}.

When repairing, @code{myisamchk} will also need a lot of disk space:

@itemize @bullet
@item
Double the size of the record file (the original one and a copy).  This
space is not needed if one does a repair with @code{--quick}, as in this
case only the index file will be re-created.  This space is needed on the
same disk as the original record file!
@item
Space for the new index file that replaces the old one. The old
index file is truncated at start, so one usually ignore this space.
This space is needed on the same disk as the original index file!
@item
When using @code{--recover} or @code{--sort-recover}
(but not when using @code{--safe-recover}), you will need space for a
sort buffer for:
@code{(largest_key + row_pointer_length)*number_of_rows * 2}.
You can check the length of the keys and the row_pointer_length with
@code{myisamchk -dv table}.
This space is allocated on the temporary disk (specified by @code{TMPDIR} or
@code{--tmpdir=#}).
@end itemize

If you have a problem with disk space during repair, you can try to use
@code{--safe-recover} instead of @code{--recover}.


@node Crash recovery, Check, myisamchk memory, Table maintenance
@subsubsection Using @code{myisamchk} for Crash Recovery

@cindex crash, recovery
@cindex recovery, from crash

If you run @code{mysqld} with @code{--skip-external-locking} (which is the
default on some systems, like Linux), you can't reliably use @code{myisamchk}
to check a table when @code{mysqld} is using the same table.  If you
can be sure that no one is accessing the tables through @code{mysqld}
while you run @code{myisamchk}, you only have to do @code{mysqladmin
flush-tables} before you start checking the tables.  If you can't
guarantee the above, then you must take down @code{mysqld} while you
check the tables.  If you run @code{myisamchk} while @code{mysqld} is updating
the tables, you may get a warning that a table is corrupt even if it
isn't.

If you are not using @code{--skip-external-locking}, you can use
@code{myisamchk} to check tables at any time.  While you do this, all clients
that try to update the table will wait until @code{myisamchk} is ready before
continuing.

If you use @code{myisamchk} to repair or optimize tables, you
@strong{must} always ensure that the @code{mysqld} server is not using
the table (this also applies if you are using @code{--skip-external-locking}).
If you don't take down @code{mysqld} you should at least do a
@code{mysqladmin flush-tables} before you run @code{myisamchk}.
Your tables @strong{may be corrupted} if the server and @code{myisamchk}
access the tables simultaneously.

This section describes how to check for and deal with data corruption
in MySQL databases.  If your tables get corrupted frequently you should
try to find the reason for this! @xref{Crashing}.

The @code{MyISAM} table section contains reason for why a table could be
corrupted. @xref{MyISAM table problems}.

When performing crash recovery, it is important to understand that each table
@code{tbl_name} in a database corresponds to three files in the database
directory:

@multitable @columnfractions .20 .30
@item @strong{File} @tab @strong{Purpose}
@item @file{tbl_name.frm} @tab Table definition (form) file
@item @file{tbl_name.MYD} @tab Datafile
@item @file{tbl_name.MYI} @tab Index file
@end multitable

Each of these three file types is subject to corruption in various ways, but
problems occur most often in datafiles and index files.

@code{myisamchk} works by creating a copy of the @file{.MYD} (data) file
row by row. It ends the repair stage by removing the old @file{.MYD}
file and renaming the new file to the original file name.  If you use
@code{--quick}, @code{myisamchk} does not create a temporary @file{.MYD}
file, but instead assumes that the @file{.MYD} file is correct and only
generates a new index file without touching the @file{.MYD} file. This
is safe, because @code{myisamchk} automatically detects if the
@file{.MYD} file is corrupt and aborts the repair in this case.  You can
also give two @code{--quick} options to @code{myisamchk}.  In this case,
@code{myisamchk} does not abort on some errors (like duplicate key) but
instead tries to resolve them by modifying the @file{.MYD}
file. Normally the use of two @code{--quick} options is useful only if
you have too little free disk space to perform a normal repair.  In this
case you should at least make a backup before running @code{myisamchk}.


@node Check, Repair, Crash recovery, Table maintenance
@subsubsection How to Check Tables for Errors

@cindex checking, tables for errors
@cindex tables, error checking
@cindex errors, checking tables for

To check a MyISAM table, use the following commands:

@table @code
@item myisamchk tbl_name
This finds 99.99% of all errors. What it can't find is corruption that
involves @strong{only} the datafile (which is very unusual). If you want
to check a table, you should normally run @code{myisamchk} without options or
with either the @code{-s} or @code{--silent} option.

@item myisamchk -m tbl_name
This finds 99.999% of all errors. It checks first all index entries for errors and
then it reads through all rows. It calculates a checksum for all keys in
the rows and verifies that they checksum matches the checksum for the keys
in the index tree.

@item myisamchk -e tbl_name
This does a complete and thorough check of all data (@code{-e} means
``extended check''). It does a check-read of every key for each row to verify
that they indeed point to the correct row.  This may take a long time on a
big table with many keys.  @code{myisamchk} will normally stop after the first
error it finds. If you want to obtain more information, you can add the
@code{--verbose} (@code{-v}) option.  This causes @code{myisamchk} to keep
going, up through a maximum of 20 errors.  In normal usage, a simple
@code{myisamchk} (with no arguments other than the table name) is sufficient.

@item myisamchk -e -i tbl_name
Like the previous command, but the @code{-i} option tells @code{myisamchk} to
print some informational statistics, too.
@end table


@node Repair, Optimisation, Check, Table maintenance
@subsubsection How to Repair Tables

@cindex tables, repairing
@cindex repairing, tables

In the following section we only talk about using @code{myisamchk} on
@code{MyISAM} tables (extensions @file{.MYI} and @file{.MYD}).  If you
are using @code{ISAM} tables (extensions @file{.ISM} and @file{.ISD}),
you should use @code{isamchk} instead.

Starting with MySQL Version 3.23.14, you can repair MyISAM
tables with the @code{REPAIR TABLE} command. @xref{REPAIR TABLE}.

The symptoms of a corrupted table include queries that abort unexpectedly
and observable errors such as these:

@itemize @bullet
@item
@file{tbl_name.frm} is locked against change
@item
Can't find file @file{tbl_name.MYI} (Errcode: ###)
@item
Unexpected end of file
@item
Record file is crashed
@item
Got error ### from table handler

To get more information about the error you can run @code{perror ###}. Here
is the most common errors that indicates a problem with the table:

@example
shell> perror 126 127 132 134 135 136 141 144 145
126 = Index file is crashed / Wrong file format
127 = Record-file is crashed
132 = Old database file
134 = Record was already deleted (or record file crashed)
135 = No more room in record file
136 = No more room in index file
141 = Duplicate unique key or constraint on write or update
144 = Table is crashed and last repair failed
145 = Table was marked as crashed and should be repaired
@end example

Note that error 135 (no more room in record file), is not an error that
can be fixed by a simple repair. In this case you have to do:

@example
ALTER TABLE table MAX_ROWS=xxx AVG_ROW_LENGTH=yyy;
@end example

You can also use this technique for error 136 (no more room in index file).

@end itemize

In the other cases, you must repair your tables. @code{myisamchk}
can usually detect and fix most problems that occur.

The repair process involves up to four stages, described here. Before you
begin, you should @code{cd} to the database directory and check the
permissions of the table files. Make sure they are readable by the Unix user
that @code{mysqld} runs as (and to you, because you need to access the files
you are checking).  If it turns out you need to modify files, they must also
be writable by you.

If you are using MySQL Version 3.23.16 and above, you can (and
should) use the @code{CHECK} and @code{REPAIR} commands to check and repair
@code{MyISAM} tables.  @xref{CHECK TABLE}.  @xref{REPAIR TABLE}.

The manual section about table maintenance includes the options to
@code{isamchk}/@code{myisamchk}.  @xref{Table maintenance}.

The following section is for the cases where the above command fails or
if you want to use the extended features that @code{isamchk}/@code{myisamchk} provides.

If you are going to repair a table from the command-line, you must first
take down the @code{mysqld} server. Note that when you do
@code{mysqladmin shutdown} on a remote server, the @code{mysqld} server
will still be alive for a while after @code{mysqladmin} returns, until
all queries are stopped and all keys have been flushed to disk.

@noindent
@strong{Stage 1: Checking your tables}

Run @code{myisamchk *.MYI} or @code{myisamchk -e *.MYI} if you have
more time.  Use the @code{-s} (silent) option to suppress unnecessary
information.

If the @code{mysqld} server is done you should use the --update option to tell
@code{myisamchk} to mark the table as 'checked'.

You have to repair only those tables for which @code{myisamchk} announces an
error.  For such tables, proceed to Stage 2.

If you get weird errors when checking (such as @code{out of
memory} errors), or if @code{myisamchk} crashes, go to Stage 3.

@noindent
@strong{Stage 2: Easy safe repair}

Note: If you want repairing to go much faster, you should add: @code{-O
sort_buffer=# -O key_buffer=#} (where # is about 1/4 of the available
memory) to all @code{isamchk/myisamchk} commands.

First, try @code{myisamchk -r -q tbl_name} (@code{-r -q} means ``quick
recovery mode''). This will attempt to repair the index file without
touching the datafile.  If the datafile contains everything that it
should and the delete links point at the correct locations within the
datafile, this should work, and the table is fixed. Start repairing the
next table.  Otherwise, use the following procedure:

@enumerate
@item
Make a backup of the datafile before continuing.

@item
Use @code{myisamchk -r tbl_name} (@code{-r} means ``recovery mode''). This will
remove incorrect records and deleted records from the datafile and
reconstruct the index file.

@item
If the preceding step fails, use @code{myisamchk --safe-recover tbl_name}.
Safe recovery mode uses an old recovery method that handles a few cases that
regular recovery mode doesn't (but is slower).
@end enumerate

If you get weird errors when repairing (such as @code{out of
memory} errors), or if @code{myisamchk} crashes, go to Stage 3.

@noindent
@strong{Stage 3: Difficult repair}

You should only reach this stage if the first 16K block in the index file is
destroyed or contains incorrect information, or if the index file is
missing.  In this case, it's necessary to create a new index file. Do so as
follows:

@enumerate
@item
Move the datafile to some safe place.

@item
Use the table description file to create new (empty) data and index files:

@example
shell> mysql db_name
mysql> SET AUTOCOMMIT=1;
mysql> TRUNCATE TABLE table_name;
mysql> quit
@end example

If your SQL version doesn't have @code{TRUNCATE TABLE}, use @code{DELETE FROM
table_name} instead.

@item
Copy the old datafile back onto the newly created datafile.
(Don't just move the old file back onto the new file; you want to retain
a copy in case something goes wrong.)
@end enumerate

Go back to Stage 2.  @code{myisamchk -r -q} should work now.  (This shouldn't
be an endless loop.)

As of @code{MySQL} 4.0.2 you can also use @code{REPAIR ... USE_FRM}
which performs the whole procedure automatically.

@noindent
@strong{Stage 4: Very difficult repair}

You should reach this stage only if the description file has also
crashed. That should never happen, because the description file isn't changed
after the table is created:

@enumerate
@item
Restore the description file from a backup and go back to Stage 3.  You can
also restore the index file and go back to Stage 2.  In the latter case, you
should start with @code{myisamchk -r}.

@item
If you don't have a backup but know exactly how the table was created, create
a copy of the table in another database.  Remove the new datafile, then move
the description and index files from the other database to your crashed
database.  This gives you new description and index files, but leaves
the datafile alone.  Go back to Stage 2 and attempt to reconstruct
the index file.
@end enumerate


@node Optimisation,  , Repair, Table maintenance
@subsubsection Table Optimization

@cindex tables, optimizing
@cindex optimizing, tables

To coalesce fragmented records and eliminate wasted space resulting from
deleting or updating records, run @code{myisamchk} in recovery mode:

@example
shell> myisamchk -r tbl_name
@end example

You can optimize a table in the same way using the SQL @code{OPTIMIZE TABLE}
statement.  @code{OPTIMIZE TABLE} does a repair of the table and a key
analysis, and also sorts the index tree to give faster key lookups.
There is also no possibility of unwanted interaction between a utility
and the server, because the server does all the work when you use
@code{OPTIMIZE TABLE}. @xref{OPTIMIZE TABLE}.

@code{myisamchk} also has a number of other options you can use to improve
the performance of a table:

@itemize @bullet
@item @code{-S}, @code{--sort-index}
@item @code{-R index_num}, @code{--sort-records=index_num}
@item @code{-a}, @code{--analyze}
@end itemize

For a full description of the option. @xref{myisamchk syntax}.


@node Maintenance regimen, Table-info, Table maintenance, Disaster Prevention
@subsection Setting Up a Table Maintenance Regimen

@cindex maintaining, tables
@cindex tables, maintenance regimen

Starting with MySQL Version 3.23.13, you can check MyISAM
tables with the @code{CHECK TABLE} command. @xref{CHECK TABLE}.  You can
repair tables with the @code{REPAIR TABLE} command. @xref{REPAIR TABLE}.

It is a good idea to perform table checks on a regular basis rather than
waiting for problems to occur.  For maintenance purposes, you can use
@code{myisamchk -s} to check tables.  The @code{-s} option (short for
@code{--silent}) causes @code{myisamchk} to run in silent mode, printing
messages only when errors occur.

@tindex .pid (process ID) file
It's also a good idea to check tables when the server starts.
For example, whenever the machine has done a reboot in the middle of an
update, you usually need to check all the tables that could have been
affected. (This is an ``expected crashed table''.) You could add a test to
@code{mysqld_safe} that runs @code{myisamchk} to check all tables that have
been modified during the last 24 hours if there is an old @file{.pid}
(process ID) file left after a reboot.  (The @file{.pid} file is created by
@code{mysqld} when it starts and removed when it terminates normally.  The
presence of a @file{.pid} file at system startup time indicates that
@code{mysqld} terminated abnormally.)

An even better test would be to check any table whose last-modified time
is more recent than that of the @file{.pid} file.

You should also check your tables regularly during normal system
operation.  At MySQL AB, we run a @code{cron} job to check all
our important tables once a week, using a line like this in a @file{crontab}
file:

@example
35 0 * * 0 /path/to/myisamchk --fast --silent /path/to/datadir/*/*.MYI
@end example

This prints out information about crashed tables so we can examine and repair
them when needed.

As we haven't had any unexpectedly crashed tables (tables that become
corrupted for reasons other than hardware trouble)
for a couple of years now (this is really true), once a week is
more than enough for us.

We recommend that to start with, you execute @code{myisamchk -s} each
night on all tables that have been updated during the last 24 hours,
until you come to trust MySQL as much as we do.

@cindex tables, defragment
Normally you don't need to maintain MySQL tables that much.  If
you are changing tables with dynamic size rows (tables with @code{VARCHAR},
@code{BLOB} or @code{TEXT} columns) or have tables with many deleted rows
you may want to from time to time (once a month?) defragment/reclaim space
from the tables.

You can do this by using @code{OPTIMIZE TABLE} on the tables in question or
if you can take down the @code{mysqld} server for a while do:

@example
isamchk -r --silent --sort-index -O sort_buffer_size=16M */*.ISM
myisamchk -r --silent --sort-index  -O sort_buffer_size=16M */*.MYI
@end example


@node Table-info,  , Maintenance regimen, Disaster Prevention
@subsection Getting Information About a Table

@cindex tables, information

To get a description of a table or statistics about it, use the commands shown
here. We explain some of the information in more detail later:

@itemize @bullet
@item myisamchk -d tbl_name
Runs @code{myisamchk} in ``describe mode'' to produce a description of
your table. If you start the MySQL server using the
@code{--skip-external-locking} option, @code{myisamchk} may report an error
for a table that is updated while it runs.  However, because @code{myisamchk}
doesn't change the table in describe mode, there isn't any risk of
destroying data.

@item myisamchk -d -v tbl_name
To produce more information about what @code{myisamchk} is doing, add @code{-v}
to tell it to run in verbose mode.

@item myisamchk -eis tbl_name
Shows only the most important information from a table. It is slow because it
must read the whole table.

@item myisamchk -eiv tbl_name
This is like @code{-eis}, but tells you what is being done.
@end itemize

@cindex examples, @code{myisamchk} output
@cindex @code{myisamchk}, example output
Example of @code{myisamchk -d} output:
@example
MyISAM file:     company.MYI
Record format:   Fixed length
Data records:    1403698  Deleted blocks:         0
Recordlength:    226

table description:
Key Start Len Index   Type
1   2     8   unique  double
2   15    10  multip. text packed stripped
3   219   8   multip. double
4   63    10  multip. text packed stripped
5   167   2   multip. unsigned short
6   177   4   multip. unsigned long
7   155   4   multip. text
8   138   4   multip. unsigned long
9   177   4   multip. unsigned long
    193   1           text
@end example

Example of @code{myisamchk -d -v} output:
@example
MyISAM file:         company
Record format:       Fixed length
File-version:        1
Creation time:       1999-10-30 12:12:51
Recover time:        1999-10-31 19:13:01
Status:              checked
Data records:           1403698  Deleted blocks:              0
Datafile parts:         1403698  Deleted data:                0
Datafilepointer (bytes):      3  Keyfile pointer (bytes):     3
Max datafile length: 3791650815  Max keyfile length: 4294967294
Recordlength:               226

table description:
Key Start Len Index   Type                  Rec/key     Root Blocksize
1   2     8   unique  double                      1 15845376      1024
2   15    10  multip. text packed stripped        2 25062400      1024
3   219   8   multip. double                     73 40907776      1024
4   63    10  multip. text packed stripped        5 48097280      1024
5   167   2   multip. unsigned short           4840 55200768      1024
6   177   4   multip. unsigned long            1346 65145856      1024
7   155   4   multip. text                     4995 75090944      1024
8   138   4   multip. unsigned long              87 85036032      1024
9   177   4   multip. unsigned long             178 96481280      1024
    193   1           text
@end example

Example of @code{myisamchk -eis} output:
@example
Checking MyISAM file: company
Key:  1:  Keyblocks used:  97%  Packed:    0%  Max levels:  4
Key:  2:  Keyblocks used:  98%  Packed:   50%  Max levels:  4
Key:  3:  Keyblocks used:  97%  Packed:    0%  Max levels:  4
Key:  4:  Keyblocks used:  99%  Packed:   60%  Max levels:  3
Key:  5:  Keyblocks used:  99%  Packed:    0%  Max levels:  3
Key:  6:  Keyblocks used:  99%  Packed:    0%  Max levels:  3
Key:  7:  Keyblocks used:  99%  Packed:    0%  Max levels:  3
Key:  8:  Keyblocks used:  99%  Packed:    0%  Max levels:  3
Key:  9:  Keyblocks used:  98%  Packed:    0%  Max levels:  4
Total:    Keyblocks used:  98%  Packed:   17%

Records:          1403698    M.recordlength:     226
Packed:             0%
Recordspace used:     100%   Empty space:          0%
Blocks/Record:   1.00
Record blocks:    1403698    Delete blocks:        0
Recorddata:     317235748    Deleted data:         0
Lost space:             0    Linkdata:             0

User time 1626.51, System time 232.36
Maximum resident set size 0, Integral resident set size 0
Non physical pagefaults 0, Physical pagefaults 627, Swaps 0
Blocks in 0 out 0, Messages in 0 out 0, Signals 0
Voluntary context switches 639, Involuntary context switches 28966
@end example

Example of @code{myisamchk -eiv} output:
@example
Checking MyISAM file: company
Data records: 1403698   Deleted blocks:       0
- check file-size
- check delete-chain
block_size 1024:
index  1:
index  2:
index  3:
index  4:
index  5:
index  6:
index  7:
index  8:
index  9:
No recordlinks
- check index reference
- check data record references index: 1
Key:  1:  Keyblocks used:  97%  Packed:    0%  Max levels:  4
- check data record references index: 2
Key:  2:  Keyblocks used:  98%  Packed:   50%  Max levels:  4
- check data record references index: 3
Key:  3:  Keyblocks used:  97%  Packed:    0%  Max levels:  4
- check data record references index: 4
Key:  4:  Keyblocks used:  99%  Packed:   60%  Max levels:  3
- check data record references index: 5
Key:  5:  Keyblocks used:  99%  Packed:    0%  Max levels:  3
- check data record references index: 6
Key:  6:  Keyblocks used:  99%  Packed:    0%  Max levels:  3
- check data record references index: 7
Key:  7:  Keyblocks used:  99%  Packed:    0%  Max levels:  3
- check data record references index: 8
Key:  8:  Keyblocks used:  99%  Packed:    0%  Max levels:  3
- check data record references index: 9
Key:  9:  Keyblocks used:  98%  Packed:    0%  Max levels:  4
Total:    Keyblocks used:   9%  Packed:   17%

- check records and index references
[LOTS OF ROW NUMBERS DELETED]

Records:          1403698    M.recordlength:     226   Packed:             0%
Recordspace used:     100%   Empty space:          0%  Blocks/Record:   1.00
Record blocks:    1403698    Delete blocks:        0
Recorddata:     317235748    Deleted data:         0
Lost space:             0    Linkdata:             0

User time 1639.63, System time 251.61
Maximum resident set size 0, Integral resident set size 0
Non physical pagefaults 0, Physical pagefaults 10580, Swaps 0
Blocks in 4 out 0, Messages in 0 out 0, Signals 0
Voluntary context switches 10604, Involuntary context switches 122798
@end example

Here are the sizes of the data and index files for the table used in the
preceding examples:

@example
-rw-rw-r--   1 monty    tcx     317235748 Jan 12 17:30 company.MYD
-rw-rw-r--   1 davida   tcx      96482304 Jan 12 18:35 company.MYM
@end example

Explanations for the types of information @code{myisamchk} produces are
given here.  The ``keyfile'' is the index file.  ``Record'' and ``row''
are synonymous:

@itemize @bullet
@item ISAM file
Name of the ISAM (index) file.

@item Isam-version
Version of ISAM format. Currently always 2.

@item Creation time
When the datafile was created.

@item Recover time
When the index/datafile was last reconstructed.

@item Data records
How many records are in the table.

@item Deleted blocks
How many deleted blocks still have reserved space.
You can optimize your table to minimise this space.
@xref{Optimisation}.

@item Data file: Parts
For dynamic record format, this indicates how many data blocks there are. For
an optimized table without fragmented records, this is the same as @code{Data
records}.

@item Deleted data
How many bytes of non-reclaimed deleted data there are.
You can optimize your table to minimise this space.
@xref{Optimisation}.

@item Data file pointer
The size of the datafile pointer, in bytes. It is usually 2, 3, 4, or 5
bytes. Most tables manage with 2 bytes, but this cannot be controlled
from MySQL yet. For fixed tables, this is a record address. For
dynamic tables, this is a byte address.

@item Keyfile pointer
The size of the index file pointer, in bytes. It is usually 1, 2, or 3
bytes. Most tables manage with 2 bytes, but this is calculated
automatically by MySQL. It is always a block address.

@item Max datafile length
How long the table's datafile (@file{.MYD} file) can become, in bytes.

@item Max keyfile length
How long the table's key file (@file{.MYI} file) can become, in bytes.

@item Recordlength
How much space each record takes, in bytes.

@item Record format
The format used to store table rows.
The preceding examples use @code{Fixed length}.
Other possible values are @code{Compressed} and @code{Packed}.

@item table description
A list of all keys in the table. For each key, some low-level information
is presented:

@itemize @minus
@item Key
This key's number.

@item Start
Where in the record this index part starts.

@item Len
How long this index part is. For packed numbers, this should always be
the full length of the column. For strings, it may be shorter than the full
length of the indexed column, because you can index a prefix of a string
column.

@item Index
@code{unique} or @code{multip.} (multiple). Indicates whether one value
can exist multiple times in this index.

@item Type
What data-type this index part has. This is an ISAM data-type
with the options @code{packed}, @code{stripped} or @code{empty}.

@item Root
Address of the root index block.

@item Blocksize
The size of each index block. By default this is 1024, but the value may be
changed at compile time.

@item Rec/key
This is a statistical value used by the optimizer. It tells how many
records there are per value for this key. A unique key always has a
value of 1. This may be updated after a table is loaded (or greatly
changed) with @code{myisamchk -a}. If this is not updated at all, a default
value of 30 is given.
@end itemize

@item
In the first example above, the 9th key is a multi-part key with two parts.

@item Keyblocks used
What percentage of the keyblocks are used. Because the table used in the
examples had just been reorganized with @code{myisamchk}, the values are very
high (very near the theoretical maximum).

@item Packed
MySQL tries to pack keys with a common suffix. This can only be used
for @code{CHAR}/@code{VARCHAR}/@code{DECIMAL} keys. For long strings like
names, this can significantly reduce the space used. In the third example
above, the 4th key is 10 characters long and a 60% reduction in space is
achieved.

@item Max levels
How deep the B-tree for this key is. Large tables with long keys get high
values.

@item Records
How many rows are in the table.

@item M.recordlength
The average record length. For tables with fixed-length records, this is the
exact record length.

@item Packed
MySQL strips spaces from the end of strings. The @code{Packed}
value indicates the percentage of savings achieved by doing this.

@item Recordspace used
What percentage of the datafile is used.

@item Empty space
What percentage of the datafile is unused.

@item Blocks/Record
Average number of blocks per record (that is, how many links a fragmented
record is composed of). This is always 1.0 for fixed-format tables. This
value should stay as close to 1.0 as possible. If it gets too big, you can
reorganize the table with @code{myisamchk}.
@xref{Optimisation}.

@item Recordblocks
How many blocks (links) are used. For fixed format, this is the same as the number
of records.

@item Deleteblocks
How many blocks (links) are deleted.

@item Recorddata
How many bytes in the datafile are used.

@item Deleted data
How many bytes in the datafile are deleted (unused).

@item Lost space
If a record is updated to a shorter length, some space is lost. This is
the sum of all such losses, in bytes.

@item Linkdata
When the dynamic table format is used, record fragments are linked with
pointers (4 to 7 bytes each). @code{Linkdata} is the sum of the amount of
storage used by all such pointers.
@end itemize

If a table has been compressed with @code{myisampack}, @code{myisamchk
-d} prints additional information about each table column.  See
@ref{myisampack, , @code{myisampack}}, for an example of this
information and a description of what it means.

@node Localisation, Log Files, Disaster Prevention, MySQL Database Administration
@section MySQL Localization and International Usage

@menu
* Character sets::              The Character Set Used for Data and Sorting
* Languages::                   Non-English Error Messages
* Adding character set::        Adding a New Character Set
* Character arrays::            The Character Definition Arrays
* String collating::            String Collating Support
* Multi-byte characters::       Multi-byte Character Support
* Problems with character sets::  Problems With Character Sets
@end menu


@node Character sets, Languages, Localisation, Localisation
@subsection The Character Set Used for Data and Sorting

@cindex character sets
@cindex data, character sets
@cindex sorting, character sets

By default, MySQL uses the ISO-8859-1 (Latin1) character set
with sorting according to Swedish/Finnish rules. These defaults are suitable
for the USA and most of western Europe.

All standard MySQL binaries are compiled with
@code{--with-extra-charsets=complex}.  This will add code to all
standard programs to be able to handle @code{latin1} and all multi-byte
character sets within the binary. Other character sets will be
loaded from a character-set definition file when needed.

The character set determines what characters are allowed in names and how
strings are sorted by the @code{ORDER BY} and @code{GROUP BY} clauses of
the @code{SELECT} statement.

You can change the character set with the @code{--default-character-set}
option when you start the server.  The character sets available depend
on the @code{--with-charset=charset} and @code{--with-extra-charsets=
list-of-charset | complex | all | none} options to @code{configure}, and the
character set configuration files listed in
@file{SHAREDIR/charsets/Index}.  @xref{configure options}.

If you change the character set when running MySQL (which may
also change the sort order), you must run @code{myisamchk -r -q
--set-character-set=charset} on all
tables. Otherwise, your indexes may not be ordered correctly.

When a client connects to a MySQL server, the server sends the
default character set in use to the client.  The client will switch to
use this character set for this connection.

One should use @code{mysql_real_escape_string()} when escaping strings
for an SQL query.  @code{mysql_real_escape_string()} is identical to the
old @code{mysql_escape_string()} function, except that it takes the @code{MYSQL}
connection handle as the first parameter.

If the client is compiled with different paths than where the server is
installed and the user who configured MySQL didn't include all
character sets in the MySQL binary, one must specify for
the client where it can find the additional character sets it will need
if the server runs with a different character set than the client.

One can specify this by putting in a MySQL option file:

@example
[client]
character-sets-dir=/usr/local/mysql/share/mysql/charsets
@end example

where the path points to the directory in which the dynamic MySQL character
sets are stored.

One can force the client to use specific character set by specifying:

@example
[client]
default-character-set=character-set-name
@end example

but normally this is never needed.

@menu
* German character set::        German character set
@end menu

@node German character set,  , Character sets, Character sets
@subsubsection German character set

To get German sorting order, you should start @code{mysqld} with
@code{--default-character-set=latin1_de}.  This will give you the following
characteristics.

When sorting and comparing strings, the following mapping is done on the
strings before doing the comparison:

@example
@"a  ->  ae
@"o  ->  oe
@"u  ->  ue
@ss{}  ->  ss
@end example

All accented characters, are converted to their un-accented uppercase
counterpart.  All letters are converted to uppercase.

When comparing strings with @code{LIKE} the one -> two character mapping
is not done. All letters are converted to uppercase. Accent are removed
from all letters except: @code{@"U}, @code{@"u}, @code{@"O}, @code{@"o},
@code{@"A} and @code{@"a}.


@node Languages, Adding character set, Character sets, Localisation
@subsection Non-English Error Messages

@cindex error messages, languages
@cindex messages, languages
@cindex files, error messages
@cindex language support

@code{mysqld} can issue error messages in the following languages:
Czech, Danish, Dutch, English (the default), Estonian, French, German, Greek,
Hungarian, Italian, Japanese, Korean, Norwegian, Norwegian-ny, Polish,
Portuguese, Romanian, Russian, Slovak, Spanish, and Swedish.

To start @code{mysqld} with a particular language, use either the
@code{--language=lang} or @code{-L lang} options. For example:

@example
shell> mysqld --language=swedish
@end example

or:

@example
shell> mysqld --language=/usr/local/share/swedish
@end example

Note that all language names are specified in lowercase.

The language files are located (by default) in
@file{@var{mysql_base_dir}/share/@var{LANGUAGE}/}.

To update the error message file, you should edit the @file{errmsg.txt} file
and execute the following command to generate the @file{errmsg.sys} file:

@example
shell> comp_err errmsg.txt errmsg.sys
@end example

If you upgrade to a newer version of MySQL, remember to repeat
your changes with the new @file{errmsg.txt} file.


@node Adding character set, Character arrays, Languages, Localisation
@subsection Adding a New Character Set

@cindex character sets, adding
@cindex adding, character sets

To add another character set to MySQL, use the following procedure.

Decide if the set is simple or complex.  If the character set
does not need to use special string collating routines for
sorting and does not need multi-byte character support, it is
simple.  If it needs either of those features, it is complex.

For example, @code{latin1} and @code{danish} are simple charactersets while
@code{big5} or @code{czech} are complex character sets.

In the following section, we have assumed that you name your character
set @code{MYSET}.

For a simple character set do the following:

@enumerate
@item
Add MYSET to the end of the @file{sql/share/charsets/Index} file
Assign a unique number to it.

@item
Create the file @file{sql/share/charsets/MYSET.conf}.
(You can use @file{sql/share/charsets/latin1.conf} as a base for this.)

The syntax for the file is very simple:

@itemize @bullet
@item
Comments start with a '#' character and proceed to the end of the line.
@item
Words are separated by arbitrary amounts of whitespace.
@item
When defining the character set, every word must be a number in hexadecimal
format
@item
The @code{ctype} array takes up the first 257 words. The
@code{to_lower[]}, @code{to_upper[]} and @code{sort_order[]} arrays take up
256 words each after that.
@end itemize

@xref{Character arrays}.

@item
Add the character set name to the @code{CHARSETS_AVAILABLE} and
@code{COMPILED_CHARSETS} lists in @code{configure.in}.

@item
Reconfigure, recompile, and test.

@end enumerate

For a complex character set do the following:

@enumerate
@item
Create the file @file{strings/ctype-MYSET.c} in the MySQL source
distribution.

@item
Add MYSET to the end of the @file{sql/share/charsets/Index} file.
Assign a unique number to it.

@item
Look at one of the existing @file{ctype-*.c} files to see what needs to
be defined, for example @file{strings/ctype-big5.c}. Note that the
arrays in your file must have names like @code{ctype_MYSET},
@code{to_lower_MYSET}, and so on.  This corresponds to the arrays
in the simple character set. @xref{Character arrays}.

@item
Near the top of the file, place a special comment like this:

@example
/*
 * This comment is parsed by configure to create ctype.c,
 * so don't change it unless you know what you are doing.
 *
 * .configure. number_MYSET=MYNUMBER
 * .configure. strxfrm_multiply_MYSET=N
 * .configure. mbmaxlen_MYSET=N
 */
@end example

The @code{configure} program uses this comment to include
the character set into the MySQL library automatically.

The strxfrm_multiply and mbmaxlen lines will be explained in
the following sections.  Only include these if you need the string
collating functions or the multi-byte character set functions,
respectively.

@item
You should then create some of the following functions:

@itemize @bullet
@item @code{my_strncoll_MYSET()}
@item @code{my_strcoll_MYSET()}
@item @code{my_strxfrm_MYSET()}
@item @code{my_like_range_MYSET()}
@end itemize

@xref{String collating}.

@item
Add the character set name to the @code{CHARSETS_AVAILABLE} and
@code{COMPILED_CHARSETS} lists in @code{configure.in}.

@item
Reconfigure, recompile, and test.
@end enumerate

The file @file{sql/share/charsets/README} includes some more instructions.

If you want to have the character set included in the MySQL
distribution, mail a patch to the MySQL internals mailing list.
@xref{Mailing-list}.


@node Character arrays, String collating, Adding character set, Localisation
@subsection The Character Definition Arrays

@code{to_lower[]} and @code{to_upper[]} are simple arrays that hold the
lowercase and uppercase characters corresponding to each member of the
character set.  For example:

@example
to_lower['A'] should contain 'a'
to_upper['a'] should contain 'A'
@end example

@code{sort_order[]} is a map indicating how characters should be ordered for
comparison and sorting purposes. Quite often (but not for all character sets)
this is the same as @code{to_upper[]} (which means sorting will be
case-insensitive). MySQL will sort characters based on the value of
@code{sort_order[character]}.  For more complicated sorting rules, see
the discussion of string collating below. @xref{String collating}.

@code{ctype[]} is an array of bit values, with one element for one character.
(Note that @code{to_lower[]}, @code{to_upper[]}, and @code{sort_order[]}
are indexed by character value, but @code{ctype[]} is indexed by character
value + 1.  This is an old legacy to be able to handle @code{EOF}.)

You can find the following bitmask definitions in @file{m_ctype.h}:

@example
#define _U      01      /* Uppercase */
#define _L      02      /* Lowercase */
#define _N      04      /* Numeral (digit) */
#define _S      010     /* Spacing character */
#define _P      020     /* Punctuation */
#define _C      040     /* Control character */
#define _B      0100    /* Blank */
#define _X      0200    /* heXadecimal digit */
@end example

The @code{ctype[]} entry for each character should be the union of the
applicable bitmask values that describe the character.  For example,
@code{'A'} is an uppercase character (@code{_U}) as well as a
hexadecimal digit (@code{_X}), so @code{ctype['A'+1]} should contain the
value:

@example
_U + _X = 01 + 0200 = 0201
@end example


@node String collating, Multi-byte characters, Character arrays, Localisation
@subsection String Collating Support

@cindex collating, strings
@cindex string collating

If the sorting rules for your language are too complex to be handled
with the simple @code{sort_order[]} table, you need to use the string
collating functions.

Right now the best documentation on this is the character sets that are
already implemented.  Look at the @code{big5}, @code{czech}, @code{gbk},
@code{sjis}, and @code{tis160} character sets for examples.

You must specify the @code{strxfrm_multiply_MYSET=N} value in the
special comment at the top of the file.  @code{N} should be set to
the maximum ratio the strings may grow during @code{my_strxfrm_MYSET} (it
must be a positive integer).


@node Multi-byte characters, Problems with character sets, String collating, Localisation
@subsection Multi-byte Character Support

@cindex characters, multi-byte
@cindex multi-byte characters

If your want to add support for a new character set that includes
multi-byte characters, you need to use the multi-byte character
functions.

Right now the best documentation on this is the character sets that are
already implemented.  Look at the @code{euc_kr}, @code{gb2312},
@code{gbk}, @code{sjis}, and @code{ujis} character sets for
examples. These are implemented in the @file{ctype-'charset'.c} files
in the @file{strings} directory.

You must specify the @code{mbmaxlen_MYSET=N} value in the special
comment at the top of the source file.  @code{N} should be set to the
size in bytes of the largest character in the set.

@node Problems with character sets,  , Multi-byte characters, Localisation
@subsection Problems With Character Sets

If you try to use a character set that is not compiled into your binary,
you can run into a couple of different problems:

@itemize @bullet
@item
Your program has a wrong path to where the character sets are stored.
(Default @file{/usr/local/mysql/share/mysql/charsets}).
This can be fixed by using the @code{--character-sets-dir}
option to the program in question.
@item
The character set is a multi-byte character set that can't be loaded
dynamically.  In this case you have to recompile the program with the
support for the character set.
@item
The character set is a dynamic character set, but you don't have a
configure file for it.  In this case you should install the configure
file for the character set from a new MySQL distribution.
@item
Your @file{Index} file doesn't contain the name for the character set.

@example
ERROR 1105: File '/usr/local/share/mysql/charsets/?.conf' not found
(Errcode: 2)
@end example

In this case you should either get a new @code{Index} file or add
by hand the name of any missing character sets.
@end itemize

For @code{MyISAM} tables, you can check the character set name and number for a
table with @code{myisamchk -dvv table_name}.


@node Log Files, Multiple servers, Localisation, MySQL Database Administration
@section The MySQL Log Files

@cindex Log files

MySQL has several different log files that can help you find
out what's going on inside @code{mysqld}:

@multitable @columnfractions .20 .80
@item @strong{Log file} @tab @strong{Description}
@item The error log @tab Problems encountering starting, running or stopping @code{mysqld}.
@item The isam log @tab Logs all changes to the ISAM tables. Used only for debugging the isam code.
@item The query log @tab Established connections and executed queries.
@item The update log @tab Deprecated: Stores all statements that changes data
@item The binary log @tab Stores all statements that changes something. Used also for replication
@item The slow log @tab Stores all queries that took more than @code{long_query_time} seconds to execute or didn't use indexes.
@end multitable

All logs can be found in the @code{mysqld} data directory.  You can
force @code{mysqld} to reopen the log files (or in some cases
switch to a new log) by executing @code{FLUSH LOGS}. @xref{FLUSH}.

@menu
* Error log::                   The Error Log
* Query log::                   The General Query Log
* Update log::                  The Update Log
* Binary log::                  The Binary Log
* Slow query log::              The Slow Query Log
* Log file maintenance::        Log File Maintenance
@end menu


@node Error log, Query log, Log Files, Log Files
@subsection The Error Log

The error log file contains information indicating when @code{mysqld}
was started and stopped and also any critical errors found when running.

If @code{mysqld} dies unexpectedly and @code{mysqld_safe} needs to
restart @code{mysqld}, @code{mysqld_safe} will write a @code{restarted
mysqld} row in this file.  This log also holds a warning if
@code{mysqld} notices a table that needs to be automatically checked or
repaired.

On some operating systems, the error log will contain a stack trace
for where @code{mysqld} died. This can be used to find out where
@code{mysqld} died.  @xref{Using stack trace}.

Beginning with MySQL 4.0.10 you can specify where @code{mysqld} stores the
error log file with the option @code{--log-error[=filename]}. If no file
name is given @code{mysqld} will use @code{mysql-data-dir/'hostname'.err} on
Unix and @file{\mysql\data\mysql.err} on Windows.
If you execute @code{flush logs} the old file will be prefixed with
@code{--old} and @code{mysqld} will create a new empty log file.

In older MySQL versions the error log handling was done by
@code{mysqld_safe} which redirected the error file to
@code{'hostname'.err}.  One could change this file name with the option
@code{--err-log=filename}.

If you don't specify @code{--log-error} or if you use the @code{--console}
option the errors will be written to stderr (the terminal).

On Windows, the output is always written to the @code{.err} file if
@code{--console} is not given.

@node Query log, Update log, Error log, Log Files
@subsection The General Query Log

@cindex query log
@cindex files, query log

If you want to know what happens within @code{mysqld}, you should start
it with @code{--log[=file]}.  This will log all connections and queries
to the log file (by default named @file{'hostname'.log}).  This log can
be very useful when you suspect an error in a client and want to know
exactly what @code{mysqld} thought the client sent to it.

@c Note: This instance of "safe_mysql" should not be changed to "mysqld_safe"
@c because it's a 3.23.x-specific command
Older versions of the @code{mysql.server} script (from MySQL 3.23.4 to 3.23.8)
pass @code{safe_mysqld} a @code{--log} option (enable general query log).
If you need better performance when you start using MySQL in a production
environment, you can remove the @code{--log} option from @code{mysql.server}
or change it to @code{--log-bin}. @xref{Binary log}.

The entries in this log are written as @code{mysqld} receives the questions.
This may be different from the order in which the statements are executed.
This is in contrast to the update log and the binary log which are written
after the query is executed, but before any locks are released.


@node Update log, Binary log, Query log, Log Files
@subsection The Update Log

@cindex update log
@cindex files, update log

@strong{Note:} The update log has been deprecated and replaced by the binary
log. @xref{Binary log}.  The binary log can do anything the old update log
could do, and more. @strong{The update log is removed starting from MySQL
5.0.0}.

When started with the @code{--log-update[=file_name]} option,
@code{mysqld} writes a log file containing all SQL commands that update
data. If no filename is given, it defaults to the name of the host
machine. If a filename is given, but it doesn't contain a path, the file
is written in the data directory. If @file{file_name} doesn't have an
extension, @code{mysqld} will create log file names like so:
@file{file_name.###}, where @code{###} is a number that is incremented each
time you execute @code{mysqladmin refresh}, execute @code{mysqladmin
flush-logs}, execute the @code{FLUSH LOGS} statement, or restart the server.

@strong{Note:} For the above scheme to work, you must not create
your own files with the same filename as the update log + some extensions
that may be regarded as a number, in the directory used by the update log!

If you use the @code{--log} or @code{-l} options, @code{mysqld} writes a
general log with a filename of @file{hostname.log}, and restarts and
refreshes do not cause a new log file to be generated (although it is closed
and reopened). In this case you can copy it (on Unix) by doing:

@example
mv hostname.log hostname-old.log
mysqladmin flush-logs
cp hostname-old.log to-backup-directory
rm hostname-old.log
@end example

Update logging is smart because it logs only statements that really update
data. So an @code{UPDATE} or a @code{DELETE} with a @code{WHERE} that finds no
rows is not written to the log. It even skips @code{UPDATE} statements that
set a column to the value it already has.

The update logging is done immediately after a query completes but before
any locks are released or any commit is done. This ensures that the log
will be logged in the execution order.

If you want to update a database from update log files, you could do the
following (assuming your update logs have names of the form
@file{file_name.###}):

@example
shell> ls -1 -t -r file_name.[0-9]* | xargs cat | mysql
@end example

@code{ls} is used to get all the log files in the right order.

This can be useful if you have to revert to backup files after a crash
and you want to redo the updates that occurred between the time of the backup
and the crash.


@node Binary log, Slow query log, Update log, Log Files
@subsection The Binary Log

@cindex binary log
@cindex files, binary log

The binary log has replaced the old update log. The update log is removed
starting from MySQL 5.0. The binary log contains all information that is
available in the update log in a more efficient format and in a manner
that is transactionally safe.

The binary log, like the old update log, only logs statements that really
update data. So an @code{UPDATE} or a @code{DELETE} with a @code{WHERE}
that finds no rows is not written to the log. It even skips @code{UPDATE}
statements that set a column to the value it already has.

The primary purpose of the binary log is to be able to update the database
during a restore operation as fully as possible, as the binary log would
contain all updates done after a backup was made.

The binary log is also used when you are replicating a slave from a master.
@xref{Replication}.

The binary log also contains information about how long each query took
that updated the database.  It doesn't contain queries that don't modify
any data.  If you want to log all queries (for example to find a problem
query) you should use the general query log. @xref{Query log}.

When started with the @code{--log-bin[=file_name]} option, @code{mysqld}
writes a log file containing all SQL commands that update data. If no
file name is given, it defaults to the name of the host machine followed
by @code{-bin}. If file name is given, but it doesn't contain a path, the
file is written in the data directory.

If you supply an extension to @code{--log-bin=filename.extension}, the
extension will be silenty removed.

To the binary log filename @code{mysqld} will append an extension that
is a number that is incremented each time you execute @code{mysqladmin
refresh}, execute @code{mysqladmin flush-logs}, execute the @code{FLUSH
LOGS} statement or restart the server. A new binary log will also
automatically be created when the current one's size reaches 
@code{max_binlog_size}. Note if you are using
transactions: a transaction is written in one chunk to the binary log,
hence it is never split between several binary logs. Therefore, if you
have big transactions, you may see binlogs bigger than @code{max_binlog_size}.

You can delete all binary log files with the @code{RESET MASTER}
command (@pxref{RESET, , @code{RESET}}), or only some of them with
@code{PURGE MASTER LOGS} (@pxref{Replication Master SQL}).

You can use the following options to @code{mysqld} to affect what is logged
to the binary log (please make sure to read the notes which follow
this table):

@multitable @columnfractions .38 .62
@item @strong{Option} @tab @strong{Description}

@item @code{binlog-do-db=database_name} @tab
Tells the master that it should log updates to the binary log if the
current database
(that is, the one selected by @code{USE})
database is 'database_name'. All others
databases which are not explicitly mentioned are ignored.
Note that if you use this you should ensure that you only do updates in
the current database.
(Example: @code{binlog-do-db=some_database})

Example of what does not work as you could expect it: if the server is
started with @code{binlog-do-db=sales}, and you do
@code{USE prices; UPDATE sales.january SET amount=amount+1000;},
this query will not be written into the binary log.

@item @code{binlog-ignore-db=database_name} @tab
Tells the master that updates where the current database
(that is, the one selected by @code{USE}) is
'database_name' should not be stored in the binary log.  Note that if
you use this you should ensure that you only do updates in the current
database.
(Example: @code{binlog-ignore-db=some_database})

Example of what does not work as you could expect it: if the server is
started with @code{binlog-ignore-db=sales}, and you do
@code{USE prices; UPDATE sales.january SET amount=amount+1000;},
this query will be written into the binary log.

@end multitable

The rules are evaluated in the following order, to decide if the query
should be written to the binary log or not:
@enumerate
@item
Are there @code{binlog-do-db} or @code{binlog-ignore-db} rules?
@itemize @bullet
@item No:
write the query to the binlog and exit.
@item Yes:
go to step below.
@end itemize
@item
So there are some rules (@code{binlog-do-db} or
@code{binlog-ignore-db} or both). Is there a current database (has any
database been selected by @code{USE}?)?
@itemize @bullet
@item No:
do @strong{NOT} write the query, and exit.
@item Yes:
go to step below.
@end itemize
@item
There is a current database. Are there some @code{binlog-do-db} rules?
@itemize @bullet
@item Yes:
Does the current database match any of the @code{binlog-do-db}
rules?
@itemize @bullet
@item Yes:
write the query and exit.
@item No:
do @strong{NOT} write the query, and exit.
@end itemize 
@item No:
go to step below.
@end itemize
@item
There are some @code{binlog-ignore-db} rules.
Does the current database match any of the @code{binlog-ignore-db}
rules?
@itemize @bullet
@item Yes:
do not write the query, and exit.
@item No:
write the query and exit.
@end itemize 
@end enumerate

So for example, a slave running with only @code{binlog-do-db=sales}
will not write to the binlog any query whose current database is
different from @code{sales} (in other words, @code{binlog-do-db} can
sometimes mean ``ignore other databases'').

To be able to know which different binary log files have been used,
@code{mysqld} will also create a binary log index file that
contains the name of all used binary log files. By default this has the
same name as the binary log file, with the extension @code{'.index'}.
You can change the name of the binary log index file with the
@code{--log-bin-index=[filename]} option.
You should not manually edit this file while @code{mysqld} is running;
doing this would confuse @code{mysqld}.

If you are using replication, you should not delete old binary log
files until you are sure that no slave will ever need to use them.
One way to do this is to do @code{mysqladmin flush-logs} once a day and then
remove any logs that are more than 3 days old. You can remove them
manually, or preferably using @code{PURGE MASTER LOGS}
(@pxref{Replication Master SQL}) which will also safely update the binary 
log index file for you  (and which can take a date argument since
MySQL 4.1)

A connection with the @code{SUPER} privilege can disable the binary
logging of its queries using @code{SET
SQL_LOG_BIN=0}. @xref{Replication Master SQL}.

You can examine the binary log file with the @code{mysqlbinlog} utility.
For example, you can update a MySQL server from the binary log
as follows:

@example
shell> mysqlbinlog log-file | mysql -h server_name
@end example

See @ref{mysqlbinlog} for more information on the @code{mysqlbinlog}
utility and how to use it.

If you are using @code{BEGIN [WORK]} or @code{SET AUTOCOMMIT=0}, you must
use the MySQL binary log for backups instead of the old update log,
which will is removed in MySQL 5.0.0.

The binary logging is done immediately after a query completes but before
any locks are released or any commit is done. This ensures that the log
will be logged in the execution order.

Updates to non-transactional tables are stored in the binary log
immediately after execution.  For transactional tables such as @code{BDB}
or @code{InnoDB} tables, all updates (@code{UPDATE}, @code{DELETE}
or @code{INSERT}) that change tables are cached until a @code{COMMIT}
command is sent to the server. At this point @code{mysqld} writes the whole
transaction to the binary log before the @code{COMMIT} is executed.
Every thread will, on start, allocate a buffer of @code{binlog_cache_size}
to buffer queries.  If a query is bigger than this, the thread will open
a temporary file to store the transaction.  The temporary file will
be deleted when the thread ends.

The @code{max_binlog_cache_size} (default 4G) can be used to restrict the
total size used to cache a multi-query transaction.  If a transaction is
bigger than this it will fail and roll back.

If you are using the update or binary log, concurrent inserts will
be converted to normal inserts when using @code{CREATE ... SELECT} or
@code{INSERT ... SELECT}.
This is to ensure that you can re-create an exact copy of your tables by
applying the log on a backup.

The binary log format is different in versions 3.23, 4.0, and 5.0.0.
Those format changes were required to enhance replication.
MySQL 4.1 has the same binary log format as 4.0.

@node Slow query log, Log file maintenance, Binary log, Log Files
@subsection The Slow Query Log

@cindex slow query log
@cindex files, slow query log

When started with the @code{--log-slow-queries[=file_name]} option,
@code{mysqld} writes a log file containing all SQL commands that took
more than @code{long_query_time} seconds to execute. The time to get the initial
table locks are not counted as execution time.

The slow query log is logged after the query is executed and after all
locks has been released. This may be different from the order in which
the statements are executed.

If no file name is given, it defaults to the name of the host machine
suffixed with @code{-slow.log}. If a filename is given, but doesn't
contain a path, the file is written in the data directory.

The slow query log can be used to find queries that take a long time to
execute and are thus candidates for optimization. With a large log, that
can become a difficult task. You can pipe the slow query log through the
@code{mysqldumpslow} command to get a summary of the queries which
appear in the log.

You are using @code{--log-long-format} then also queries that are not
using indexes are printed. @xref{Server options}.


@node Log file maintenance,  , Slow query log, Log Files
@subsection Log File Maintenance

@cindex files, log
@cindex maintaining, log files
@cindex log files, maintaining

The MySQL Server can create a number of different log files, which make
it easy to see what is going on. @xref{Log Files}. However, you must
clean up these files regularly, to ensure that the logs don't take up
too much disk space.

When using MySQL with log files, you will
want to remove/backup old log files from time to time and tell MySQL to start
logging to new files.  @xref{Backup}.

On a Linux (@code{Red Hat}) installation, you can use the
@code{mysql-log-rotate} script for this. If you installed MySQL
from an RPM distribution, the script should have been installed
automatically.  Note that you should be careful with this script if you are
using the binary log for replication!

On other systems you must install a short script yourself that you
start from @code{cron} to handle log files.

You can force MySQL to start using new log files by using
@code{mysqladmin flush-logs} or by using the SQL command @code{FLUSH LOGS}.
If you are using MySQL Version 3.21, you must use @code{mysqladmin refresh}.

The above command does the following:

@itemize @bullet
@item
If standard logging (@code{--log}) or slow query logging
(@code{--log-slow-queries}) is used, closes and reopens the log file
(@file{mysql.log} and @file{`hostname`-slow.log} as default).
@item
If update logging (@code{--log-update}) is used, closes the update log and
opens a new log file with a higher sequence number.
@end itemize

If you are using only an update log, you only have to flush the logs and then
move away the old update log files to a backup.
If you are using the normal logging, you can do something like:

@example
shell> cd mysql-data-directory
shell> mv mysql.log mysql.old
shell> mysqladmin flush-logs
@end example

and then take a backup and remove @file{mysql.old}.


@node Multiple servers,  , Log Files, MySQL Database Administration
@section Running Multiple MySQL Servers on the Same Machine

@cindex post-install, multiple servers
@cindex Starting many servers
@cindex multiple servers
@cindex servers, multiple
@cindex running, multiple servers

@menu
* Multiple Windows servers::    Running Multiple Servers on Windows
* Multiple Unix servers::       Running Multiple Servers on Unix
* Multiple-server clients::     Using Client Programs in a Multiple-Server Environment
@end menu

In some cases you might want to run multiple @code{mysqld} servers
on the same machine.  You might want to test a new
MySQL release while leaving your existing production setup undisturbed.
Or you may want to give different users access to different @code{mysqld}
servers that they manage themselves.  (For example, you might be an
Internet service provider that wants to provide independent MySQL
installations for different customers.)

To run multiple servers on a single machine, each server must have
unique values for several operating parameters. These can be set on the
command line or in option files.
@xref{Program Options}.

At least the following options must be different for each server:

@itemize @bullet
@item @code{--port=port_num}
@item @code{--socket=path}
@item @code{--shared-memory-base-name=name} (Windows only; new in MySQL 4.1)
@item @code{--pid-file=path} (Unix only)
@end itemize

@code{--port} controls the port number for TCP/IP connections.
@code{--socket} controls the socket file path on Unix and the name of the
named pipe on Windows. (It's necessary to specify distinct pipe names on
Windows only for those servers that support named pipe connections.)
@code{--shared-memory-base-name} designates the shared memory name used by a
Windows server to allow clients to connect via shared memory.
@code{--pid-file} indicates the name of the file in which a Unix server writes
its process ID.

If you use the following options, they must be different for each server:

@c TODO: InnoDB options needed here?

@itemize @bullet
@item @code{--log=path}
@item @code{--log-bin=path}
@item @code{--log-update=path}
@item @code{--log-error=path}
@item @code{--log-isam=path}
@item @code{--bdb-logdir=path}
@end itemize

If you want more performance, you can also specify the following options
differently for each server, to spread load between several physical disks:

@itemize @bullet
@item @code{--tmpdir=path}
@item @code{--bdb-tmpdir=path}
@end itemize

Having different temporary directories like above is also recommended
because it will be easier for you in case you want to know to which
MySQL server a certain temporary file belongs. 

Generally, each server should also use a different data directory, which is
specified using the @code{--datadir=path} option.

@strong{Warning:} Normally you should never have two servers that
update data in the same databases!  This may lead to unpleasant
surprises if your operating system doesn't support fault-free system
locking!  If (despite this warning) you run multiple servers using
the same data directory and they have logging enabled, you must
use the appropriate options to specify log file names that are
unique to each server.  Otherwise, the servers will try to log to
the same files.

This warning against sharing a data directory among servers also applies
in an NFS environment.  Allowing multiple MySQL servers to access a common
data directory over NFS is a @strong{bad idea}!

@itemize @bullet

@item
The primary problem is that NFS will become the speed bottleneck.
It is not meant for such use.

@item
Another risk with NFS is that you will have to come up with a way
to make sure that two or more servers do not interfere with each
other.  Usually NFS file locking is handled by the @code{lockd}
daemon, but at the moment there is no platform that will perform
locking 100% reliably in every situation.

@end itemize

Make it easy for yourself: Forget about sharing a data directory
among servers over NFS. A better solution is to have one computer
that contains several CPUs and use an operating system that
handles threads efficiently.

If you have multiple MySQL installations in different locations, normally
you can specify the base installation directory for each server with the
@code{--basedir=path} option to cause each server to use a different data
directory, log files, and PID file. (The defaults for all these values are
determined relative to the base directory.) In that case, the only other
options you need to specify are the @code{--socket} and @code{--port}
options.  For example, suppose you install different versions of MySQL using
@file{.tar} file binary distributions. These will install in different
locations, so you can start the server for each installation using the
command @code{./bin/mysqld_safe} under its corresponding base directory.
@code{mysqld_safe} will determine the proper
@code{--basedir} option to pass to @code{mysqld}, and you need specify
only the @code{--socket} and @code{--port} options to @code{mysqld_safe}.

As discussed in the following sections, it is possible to start additional
servers by setting environment variables or by specifying appropriate
command-line options.  However, if you need to run multiple servers on
a more permanent basis, it will be more convenient to use option files
to specify for each server those option values that must be unique to it.


@node Multiple Windows servers, Multiple Unix servers, Multiple servers, Multiple servers
@subsection Running Multiple Servers on Windows

You can run multiple servers on Windows by starting them manually from the
command line, each with appropriate operating parameters. On Windows NT-based
systems, you also have the option of installing several servers as Windows services
and running them that way. General instructions for running MySQL servers
from the command line or as services are given in @ref{Windows installation}. This section
describes how to make sure you start each server with different values for
those startup options that must be unique per server, such as the data
directory.  (These options are described in @ref{Multiple servers}.)

@menu
* Multiple Windows command-line servers::  Starting Multiple Windows Servers at the Command Line
* Multiple Windows services::   Starting Multiple Windows Servers as Services
@end menu

@node Multiple Windows command-line servers, Multiple Windows services, Multiple Windows servers, Multiple Windows servers
@subsubsection Starting Multiple Windows Servers at the Command Line

To start multiple servers manually from the command line, you can specify the appropriate options on
the command line or in an option file. It's more convenient to place the
options in an option file, but it's necessary to make sure that each server
gets its own set of options. To do this, create an option file for each
server and tell the server the filename with a @code{--defaults-file} option
when you run it.

Suppose you want to run @code{mysqld} on port 3307 with a
data directory of @file{C:\mydata1}, and @code{mysqld-max} on port 3308 with a
data directory of @file{C:\mydata2}. To accomplish this, create two option
files. For example, create one file named @file{C:\my-opts1.cnf} that looks
like this:

@example
[mysqld]
datadir = C:/mydata1
port = 3307
@end example

Create a second file named @file{C:\my-opts2.cnf} that looks like this:

@example
[mysqld]
datadir = C:/mydata2
port = 3308
@end example

Then start each server with its own option file:

@example
shell> mysqld --defaults-file=C:\my-opts1.cnf
shell> mysqld-max --defaults-file=C:\my-opts2.cnf
@end example

(On NT, the servers will start in the foreground, so you'll need to issue
those two commands in separate console windows.)

To shut down the servers, you must connect to the appropriate port number:

@example
shell> mysqladmin --port=3307 shutdown
shell> mysqladmin --port=3308 shutdown
@end example

Servers configured as just described will allow clients to connect over
TCP/IP.  If you also want to allow named pipe connections,
use the @code{mysqld-nt} or @code{mysqld-max-nt} servers and specify options
that enable the named pipe and specify its name. (Each server that supports
named pipe connections must use a unique
pipe name.)  For example, the @file{C:\my-opts1.cnf} file might be written
like this:

@example
[mysqld]
datadir = C:/mydata1
port = 3307
enable-named-pipe
socket = mypipe1
@end example

Then start the server this way:

@example
shell> mysqld-nt --defaults-file=C:\my-opts1.cnf
@end example

@file{C:\my-opts2.cnf} would be modified similarly for use by the second
server.

@node Multiple Windows services,  , Multiple Windows command-line servers, Multiple Windows servers
@subsubsection Starting Multiple Windows Servers as Services

On NT-based systems, a MySQL server can be run as a Windows service. The
procedures for installing, controlling, and removing a single MySQL service are
described in @ref{NT start}.

As of MySQL 4.0.2, you can install multiple servers as services.
In this case, you must make sure that each server uses a different
service name in addition to all the other parameters that must be unique per
server.

For the following instructions, assume that you want to run the @code{mysqld-nt}
server from two different versions of MySQL that are installed at
@file{C:\mysql-4.0.8} and @file{C:\mysql-4.0.17}, respectively. (This might be
the case if you're running 4.0.8 as your production server, but want to test
4.0.17 before upgrading to it.)

The following principles are relevant when installing a MySQL service with the
@code{--install} option:

@itemize @bullet

@item
If you specify no service name, the server uses the default service name of
@code{MySQL} and the server reads options from the @code{[mysqld]} group in
the standard option files.

@item
@c TODO change this back after bug gets fixed
@c If you specify a service name different than @code{MySQL} after the
If you specify a service name after the
@code{--install} option, the server ignores the @code{[mysqld]} option
group and instead reads options from the group that has the same name as the
service. The server reads options from the standard option files.

@item
If you specify a @code{--defaults-file} option after the service name,
the server ignores the standard option files and reads options only from the
@code{[mysqld]} group of the named file.

@end itemize

These principles also apply if you install a server using the
@code{--install-manual} option.

Based on the preceding information, you have several ways to set
up multiple services.  The following instructions describe some
examples. Before trying any of them, be sure you shut down and
remove any existing MySQL services first.

@itemize @bullet

@item
Specify the options for all services in one of the standard option files.
To do this, use a different service name for each server.
Suppose you want to run the 4.0.8 @code{mysqld-nt} using the service
name of @code{mysqld1} and the 4.0.17 @code{mysqld-nt} using the service name @code{mysqld2}.
In this case, you can use the @code{[mysqld1]} group for 4.0.8 and the
@code{[mysqld2]} group for 4.0.17.
For example, you can set up @file{C:\my.cnf} like this:

@example
# options for mysqld1 service
[mysqld1]
basedir = C:/mysql-4.0.8
port = 3307
enable-named-pipe
socket = mypipe1

# options for mysqld2 service
[mysqld2]
basedir = C:/mysql-4.0.17
port = 3308
enable-named-pipe
socket = mypipe2
@end example

Install the services as follows, using the full server pathnames to ensure
that Windows registers the correct executable program for each service:

@example
shell> C:\mysql-4.0.8\bin\mysqld-nt --install mysqld1
shell> C:\mysql-4.0.17\bin\mysqld-nt --install mysqld2
@end example

To start the services, use the services manager, or use @code{NET START}
with the appropriate service names:

@example
shell> NET START mysqld1
shell> NET START mysqld2
@end example

To stop the services, use the services manager, or use @code{NET STOP}
with the appropriate service names:

@example
shell> NET STOP mysqld1
shell> NET STOP mysqld2
@end example

Note: Before MySQL 4.0.17, only a server installed using the default service
name (@code{MySQL}) or one installed explicitly with a service name of
@code{mysqld} will read the @code{[mysqld]} group in the standard option
files. As of 4.0.17, all servers read the @code{[mysqld} group if they read
the standard option files, even if they are installed using another service
name. This allows you to use the @code{[mysqld]} group for options that should
be used by all MySQL services, and an option group named after each service
for use by the server installed with that service name.

@c The following should, I think, be uncommented when the bug is fixed? -- PD
@c (The exception is that if you use an explicit service name of @code{MySQL}
@c or any lettercase variation thereof, only the @code{[mysqld]} group is
@c read. This is because option group names are not case sensitive, and the
@c @code{[mysql]} group is to be used by the @code{mysql} client program, not
@c by any server.)

@item
Specify options for each server in separate files and use
@code{--defaults-file} when you install the services to tell each server
what file to use.  In this case, each file should list options using a
@code{[mysqld]} group.

With this approach, to specify options for the 4.0.8 @code{mysqld-nt},
create a file @file{C:\my-opts1.cnf} that looks like this:

@example
[mysqld]
basedir = C:/mysql-4.0.8
port = 3307
enable-named-pipe
socket = mypipe1
@end example

For the 4.0.17 @code{mysqld-nt}, create a file
@file{C:\my-opts2.cnf} that looks like this:

@example
[mysqld]
basedir = C:/mysql-4.0.17
port = 3308
enable-named-pipe
socket = mypipe2
@end example

Install the services as follows (enter each command on a single line):

@example
shell> C:\mysql-4.0.8\bin\mysqld-nt --install mysqld1
           --defaults-file=C:\my-opts1.cnf
shell> C:\mysql-4.0.17\bin\mysqld-nt --install mysqld2
           --defaults-file=C:\my-opts2.cnf
@end example

To use a @code{--defaults-file} option when you install a MySQL server as a
service, you must precede the option with the service name.

After installing the services, start and stop them the same way as in the
preceding example.

@end itemize

To remove multiple services, use @code{mysqld --remove} for each one,
specifying a service name following the @code{--remove} option if the
service to remove has a name different than the default.


@node Multiple Unix servers, Multiple-server clients, Multiple Windows servers, Multiple servers
@subsection Running Multiple Servers on Unix

The easiest way is to run multiple servers on Unix is to compile them
with different TCP/IP ports and socket files so that each one is listening on
different network interfaces. Also, by compiling in different base directories
for each installation, that automatically results in different compiled-in
data directory, log file, and PID file locations for each of your servers.

Assume an existing server is configured for the default port number and
socket file.  To configure a new server to have different operating
parameters, use a @code{configure} command something like this:

@example
shell> ./configure --with-tcp-port=port_number \
             --with-unix-socket-path=file_name \
             --prefix=/usr/local/mysql-4.0.17
@end example

Here @code{port_number} and @code{file_name} should be different from the
default port number and socket file pathname, and the @code{--prefix} value
should specify an installation directory different than the one under which
the existing MySQL installation is located.

If you have a MySQL server listening on a given port number, you can use the
following command to find out what operating parameters it is using
for several important configurable variables,
including the base directory and socket name:

@example
shell> mysqladmin --host=host_name --port=port_number variables
@end example

With the information displayed by that command, you can tell what option
values @strong{not} to use when configuring an additional server.

Note that if you specify ``@code{localhost}'' as a hostname, @code{mysqladmin}
will default to using a Unix socket connection rather than TCP/IP.
In MySQL 4.1, you can explicitly specify the connection protocol to use by
using the @code{--protocol=@{TCP | SOCKET | PIPE | MEMORY@}} option.

You don't have to compile a new MySQL server just to start with a
different socket file and TCP/IP port number.  It is also possible to specify
those values at runtime. One way to do so is by using command-line options:

@example
shell> /path/to/mysqld_safe --socket=file_name --port=port_number
@end example

To use another database directory for the second server, pass
a @code{--datadir=path} option to @code{mysqld_safe}.

Another way to achieve a similar effect is to use environment variables
to set the socket name and port number:

@tindex @code{MYSQL_UNIX_PORT} environment variable
@tindex @code{MYSQL_TCP_PORT} environment variable
@tindex environment variable, @code{MYSQL_UNIX_PORT}
@tindex environment variable, @code{MYSQL_TCP_PORT}
@example
shell> MYSQL_UNIX_PORT=/tmp/mysqld-new.sock
shell> MYSQL_TCP_PORT=3307
shell> export MYSQL_UNIX_PORT MYSQL_TCP_PORT
shell> scripts/mysql_install_db
shell> bin/mysqld_safe &
@end example

This is a quick way of starting a second server to use
for testing.  The nice thing about this method is that the environment
variable settings will apply to any client programs that you invoke from
the above shell. Thus, connections for those clients automatically will
be directed to the second server!

@ref{Environment variables} includes a list of other environment
variables you can use to affect @code{mysqld}.

For automatic server execution, your startup script that is executed
at boot time should execute the following command once for each
server with an appropriate option file path for each command:

@example
mysqld_safe --defaults-file=path-to-option-file
@end example

Each option file should contain option values specific to a given server.

On Unix,
the @code{mysqld_multi} script is another way to start multiple servers.
@xref{mysqld_multi, , @code{mysqld_multi}}.


@node Multiple-server clients,  , Multiple Unix servers, Multiple servers
@subsection Using Client Programs in a Multiple-Server Environment

When you want to connect with a client program to a MySQL server that is
listening to different network interfaces than those compiled into your
client, you can use one of the following methods:

@itemize @bullet
@item
Start the client with @code{--host=host_name --port=port_number} to connect
via TCP/IP to a remote host, or with @code{--host=localhost --socket=file_name}
to connect to a local host via a Unix socket or a Windows named pipe.

@item
As of MySQL 4.1, start the client with @code{--protocol=tcp} to connect
via TCP/IP, @code{--protocol=socket} to connect via a Unix socket,
@code{--protocol=pipe} to connect via a named pipe, or
@code{--protocol=memory} to connect via shared memory.  For TCP/IP
connections, you may also need to specify @code{--host} and @code{--port}
options.  For the other types of connections, you may need to specify
a @code{--socket} option to specify a socket or named pipe name, or a
@code{--shared-memory-base-name} option to specify the shared memory name.

@item
@tindex MYSQL_UNIX_PORT environment variable
@tindex MYSQL_TCP_PORT environment variable
@tindex environment variable, MYSQL_UNIX_PORT
@tindex environment variable, MYSQL_TCP_PORT
On Unix,
set the @code{MYSQL_UNIX_PORT} and @code{MYSQL_TCP_PORT} environment variables
to point to the Unix socket and TCP/IP port before you start your clients.
If you normally use a specific socket or port, you can place commands
to set these environment variables in your @file{.login} file so that they
apply each time you log in.
@xref{Environment variables}.

@item
@tindex C:\my.cnf file
@tindex .my.cnf file
Specify the default socket and TCP/IP port in the @code{[client]} group of
an option file. For example, you can use @file{C:\my.cnf} on Windows, or
the @file{.my.cnf} file in your home directory on Unix. @xref{Option files}.

@item
In a C program, you can specify the port or socket arguments in the
@code{mysql_real_connect()} call.  You can also have the program read
option files by calling @code{mysql_options()}.
@xref{C API functions}.

@item
If you are using the Perl @code{DBD::mysql} module, you can read the options
from the MySQL option files. For example:

@example
$dsn = "DBI:mysql:test;mysql_read_default_group=client;"
        . "mysql_read_default_file=/usr/local/mysql/data/my.cnf";
$dbh = DBI->connect($dsn, $user, $password);
@end example

@xref{Perl}.

@end itemize


@node Replication, MySQL Optimisation, MySQL Database Administration, Top
@chapter Replication in MySQL

@cindex replication
@cindex increasing, speed
@cindex speed, increasing
@cindex databases, replicating

@menu
* Replication Intro::           Introduction to Replication
* Replication Implementation::  Replication Implementation Overview
* Replication Implementation Details::  Replication Implementation Details
* Replication HOWTO::           How to Set Up Replication
* Replication Upgrade::         Upgrading a Replication Setup - Mixing Different MySQL Versions
* Replication Features::        Replication Features and Known Problems
* Replication Options::         Replication Startup Options
* Replication FAQ::             Replication FAQ
* Replication Problems::        Troubleshooting Replication
* Replication Bugs::            Reporting Replication Bugs
@end menu

@c Need better intro summary of what the sections here are

Replication capabilities allowing the databases on one MySQL server to be
duplicated on another were introduced in MySQL version 3.23.15.
This section describes the various replication features in MySQL.
It serves as a reference to the options available with replication.
You will be introduced to replication and learn how to implement it.
Toward that end, there are some frequently asked questions, descriptions
of problems, and how to solve them.

For a description of the syntax of replication SQL statements, see
@ref{Replication SQL}.

We suggest that you visit our website at @uref{http://www.mysql.com/}
often and read updates to this section. Replication is constantly being
improved, and we update the manual frequently with the most current
information.

@node Replication Intro, Replication Implementation, Replication, Replication
@section Introduction to Replication

Starting in Version 3.23.15, MySQL supports one-way replication
internally. One server acts as the master, while one or more other servers
act as slaves.  The master server keeps a binary log of updates
(@pxref{Binary log}).
It also maintains an index file of the binary logs to keep track of
log rotation.  Each slave, upon connecting, informs the master where it
left off since the last successfully propagated update, catches up any updates
that have occurred since then, and then blocks and waits for the master to
notify it of new updates.

A slave can also serve as a master if you set up chained replication servers.

Note that when you are using replication, all updates to the
tables that are replicated
should be performed on the master server. Otherwise, you must always be
careful to avoid conflicts between updates that users make to tables on the
master and updates that they make to tables on the slave.

One-way replication has benefits for robustness, speed, and system
administration:

@itemize @bullet

@item
Robustness is increased with a master/slave setup.
In the event of problems with the master, you can switch to the slave as a
backup.

@item
The extra speed is achieved by splitting the load for processing client
queries between the master and slave servers, resulting in better client
response time.
@code{SELECT} queries may be sent to the slave to reduce query processing
load of the master. Queries that modify data should still be sent to the
master so that the master and slave to not get out of sync.  This
load-balancing strategy is effective if non-updating queries dominate,
but that is the normal case.

@item
Another benefit of using replication is that one can get
non-disturbing backups of the system by doing a backup on a slave
instead of doing it on the master. @xref{Backup}.

@end itemize


@node Replication Implementation, Replication Implementation Details, Replication Intro, Replication
@section Replication Implementation Overview

@cindex master/slave setup

MySQL replication is based on the master server keeping track of all
changes to your database (updates, deletes, etc) in the binary
log (@pxref{Binary log}).
Each slave server receives from the master the saved queries that the master
has recorded in its binary log, so that the slave can
execute the same queries on its copy of the data.

It is @strong{very important} to realize that the binary log is simply a
record starting from a fixed point in time (the moment you enable binary
logging). Any slaves that you set up will need copies of the databases on
your master as they existed at the moment you enabled binary
logging on the master. If you start your slaves with data that is not the same
as what was on the master @strong{when the binary log was
started}, your slaves may fail.

Starting from 4.0.0, you can use @code{LOAD DATA FROM MASTER} to set up
a slave. Be aware that @code{LOAD DATA FROM MASTER} currently works only
if all the tables on the master are @code{MyISAM} type. Also, this statement
acquires a
global read lock, so no writes are possible while the tables are being
transferred from the master. When we implement lock-free hot table
backup (in MySQL 5.0), this global read lock will no longer be necessary.

Due to these limitations, we recommend that at this point  you use
@code{LOAD DATA FROM MASTER} only if the dataset on the master is relatively
small, or if a prolonged read lock on the master is acceptable. While the
actual speed of @code{LOAD DATA FROM MASTER} may vary from system to system,
a good rule of thumb for how long it is going to take is 1 second
per 1 MB of the datafile. You will get close to the estimate if both master
and slave are equivalent to 700 MHz Pentium and are connected through a
100 MBit/s network.  Note that this is only a rough estimate.

Once a slave is properly configured and running, it will simply connect
to the master and wait for updates to process. If the master goes away
or the slave loses connectivity with your master, it will keep trying to
connect periodically until it is able to reconnect and resume listening
for updates. The retry interval is controlled by the
@code{--master-connect-retry} option. The default is 60 seconds.

Each slave keeps track of where it left off. The master server has no
knowledge of how many slaves there are or which ones are up-to-date at
any given time.

@node Replication Implementation Details, Replication HOWTO, Replication Implementation, Replication
@section Replication Implementation Details

Three threads are involved in replication: one on the master and
two on the slave.  When @code{START SLAVE} is issued, the I/O thread
is created on the slave. It connects to the master and asks it to
send the queries recorded in its binlogs. Then one thread is created
on the master to send these binlogs.  This thread is identified by
@code{Binlog Dump} in @code{SHOW PROCESSLIST} output on the master.
The I/O thread reads what the master @code{Binlog Dump} thread
sends and simply copies it to some local files in the slave's data
directory called relay logs.  The last thread, the SQL thread, is
created on the slave; it reads the relay logs and executes the
queries it contains.

Note that the master has one thread for each currently connected slave server.

With @code{SHOW PROCESSLIST} you can know what is happening on the
master and on the slave as regards replication.

The following example illustrates how the three threads show up in
@code{SHOW PROCESSLIST}.  The output format is that used by @code{SHOW
PROCESSLIST} as of MySQL version 4.0.15, when the content of the
@code{State} column was changed to be more meaningful compared to
earlier versions.

On the master server, the output looks like this:

@example
mysql> SHOW PROCESSLIST\G
*************************** 1. row ***************************
     Id: 2
   User: root
   Host: localhost:32931
     db: NULL
Command: Binlog Dump
   Time: 94
  State: Has sent all binlog to slave; waiting for binlog to be updated
   Info: NULL
@end example

On the slave server, the output looks like this:

@example
mysql> SHOW PROCESSLIST\G
*************************** 1. row ***************************
     Id: 10
   User: system user
   Host:
     db: NULL
Command: Connect
   Time: 11
  State: Waiting for master to send event
   Info: NULL
*************************** 2. row ***************************
     Id: 11
   User: system user
   Host:
     db: NULL
Command: Connect
   Time: 11
  State: Has read all relay log; waiting for the slave I/O thread to update it
   Info: NULL
@end example

Here thread 2 is on the master. Thread 10 is the I/O thread on the
slave. 
Thread 11 is the SQL thread on the slave; note that the value in the
@code{Time} column can tell how late the slave is compared to the
master (@pxref{Replication FAQ}).

The following list shows
the most common states you will see in the @code{State}
column for the master's @code{Binlog Dump} thread. If you don't see this
thread on a master server, replication is not running.

@table @code

@item Sending binlog event to slave

Binlogs consist of events, where an event is usually a query plus some other
information. The thread has read an event from the binlog and is
sending it to the slave.

@item Finished reading one binlog; switching to next binlog

The thread has finished reading a binlog file and is opening
the next one to send to the slave.

@item Has sent all binlog to slave; waiting for binlog to be updated

The thread has read all binary log files and is idle. It is waiting for
new events to appear in the binary log as a result of new update queries being
executed on the master.

@item Waiting to finalize termination

A very brief state that happens as the thread is stopping.

@end table

Here are the most common states you will see in the @code{State}
column for the I/O thread of a slave server. Beginning with MySQL 4.1.1, this
state also appears in the @code{Slave_IO_State} column of @code{SHOW
SLAVE STATUS} output. This means that you can get a good view of what is
happening by using only @code{SHOW SLAVE STATUS}.

@table @code

@item Connecting to master

The thread is attempting to connect to the master.

@item Checking master version

A very brief state that happens just after the connection to the master is established.

@item Registering slave on master

A very brief state that happens just after the connection to the master is established.

@item Requesting binlog dump

A very brief state that happens just after the connection to the master is
established.
The thread sends to the master a request for the contents of its
binlogs, starting from the requested binlog filename and position.

@item Waiting to reconnect after a failed binlog dump request

If the binlog dump request failed (due to disconnection), the thread goes into
this state while it sleeps. The
thread sleeps for @code{master-connect-retry} seconds before retrying.

@item Reconnecting after a failed binlog dump request

Then the thread tries to reconnect to the master.

@item Waiting for master to send event

The thread has connected and is waiting for binlog events 
to arrive. This can last for a long time if the master is idle. If the
wait lasts for @code{slave_read_timeout} seconds, a timeout will occur.
At that point, the thread will consider the
connection to be broken and make an attempt to reconnect.

@item Queueing master event to the relay log

The thread has read an event and is copying it to the relay log so the SQL
thread can process it.

@item Waiting to reconnect after a failed master event read

An error occurred while reading (due to disconnection). The thread is sleeping
for @code{master-connect-retry} seconds before attempting to reconnect.

@item Reconnecting after a failed master event read

Then the thread tries to reconnect. When connection is established
again, the state will become @code{Waiting for master to send event}.

@item Waiting for the slave SQL thread to free enough relay log space

You are using a non-zero @code{relay_log_space_limit} value, and the relay
logs have grown so much that their combined size exceeds this value.
The I/O thread is waiting until the SQL
thread frees enough space by processing relay log contents so that it can
delete some relay log files.

@item Waiting for slave mutex on exit

A very brief state that happens as the thread is stopping.

@end table

Here are the most common states you will see in the @code{State}
column for the SQL thread of a slave server:

@table @code

@item Reading event from the relay log

The thread has read an event from the relay log so that it can process it.

@item Has read all relay log; waiting for the slave I/O thread to update it

The thread has processed all events in the relay log files and is waiting for
the I/O thread to write new events to the relay log.

@item Waiting for slave mutex on exit

A very brief state that happens as the thread is stopping.

@end table

The @code{State} column for the I/O thread may also show a query string.
This indicates that the thread has read an event from the relay log,
extracted the query from it and is executing the query.

Before MySQL 4.0.2, the slave I/O and SQL threads were combined as a single
thread, and no relay log files were used.
The advantage of using two threads is that it separates query reading and
query execution into two independent tasks, so the task of reading queries is
not slowed down if query execution is slow.
For example, if the slave server has not been running for a while, its I/O
thread can quickly fetch all the binlog contents from the master when the
slave starts,
even if the SQL thread lags far behind and may take hours to catch up.
If the slave stops before the SQL thread has executed all the fetched queries,
the I/O thread has at least fetched everything so that
a safe copy of the queries is locally stored in the slave's relay logs for
execution when next the slave starts. This allows the
binlogs to be purged on the master, because it no longer need wait for the
slave to fetch their contents.

By default, relay logs are named using filenames of the form
@file{host_name-relay-bin.nnn}, where @code{host_name} is the name of the
slave server host, and @code{nnn} is a sequence number.
Successive relay log files are created using successive sequence numbers,
beginning with @code{001}.
The slave keeps track of relay logs currently in use in an index file.
The default relay log index filename is
@file{host_name-relay-bin.index}.
By default these files are created in the slave's data directory.
The default filenames may be overridden with the @code{--relay-log} and
@code{--relay-log-index} server options.

Relay logs have the same format as binary logs, so they can be read
with @code{mysqlbinlog}.
A relay log is automatically deleted by the SQL thread as soon as it
no longer needs it (that is, as soon as it has executed all its
events). There is no command to delete relay logs, because
the SQL thread takes care of doing so. However, from MySQL 4.0.14,
@code{FLUSH LOGS} rotates relay logs, which will influence when
the SQL thread deletes them.

A new relay log is created under the following conditions:

@itemize @bullet

@item
The first time the I/O thread starts after the slave server starts.
(In MySQL 5.0, a new relay log will be created each time the I/O thread
starts, not just the first time.)

@item
A @code{FLUSH LOGS} statement is issued (4.0.14 and up only).

@item
The size of the current relay log file becomes too big. The meaning of
``too big'' is determined as follows:
@itemize @minus
@item
@code{max_relay_log_size}, if @code{max_relay_log_size} > 0
@item
@code{max_binlog_size}, if @code{max_relay_log_size} = 0
or MySQL is older than 4.0.14
@end itemize

@end itemize

A slave replication server
creates additional two small files in the data directory.
These files are named @file{master.info} and @file{relay-log.info} by default.
They contain information like that shown in the output of the @code{SHOW SLAVE
STATUS} statement (@pxref{Replication Slave SQL} for a description of this command).
As disk files they survive slave's shutdown. The next time the slave starts
up, it can read these files to know how far it has proceeded in
reading binlogs from the master and in processing its own relay logs.

The @file{master.info} file is updated by the I/O thread.
The correspondance between the lines in the file and the
columns displayed by @code{SHOW SLAVE STATUS} is as follows:

@c TODO: need to update this description for the new master.info
@c format in 4.1.1: first line indicates how many lines in file, plus
@c there are new lines for SSL options.

@multitable @columnfractions .05 .95
@item @strong{Line} @tab @strong{Description}
@item 1              @tab @code{Master_Log_File}
@item 2              @tab @code{Read_Master_Log_Pos}
@item 3              @tab @code{Master_Host}
@item 4              @tab @code{Master_User}
@item 5              @tab Password (not shown by @code{SHOW SLAVE STATUS})
@item 6              @tab @code{Master_Port}
@item 7              @tab @code{Connect_Retry}
@end multitable

The @file{relay-log.info} file is updated by the SQL thread.
The correspondance between the lines in the file and the
columns displayed by @code{SHOW SLAVE STATUS} is as follows:

@multitable @columnfractions .05 .95
@item @strong{Line} @tab @strong{Description}
@item 1              @tab @code{Relay_Log_File}
@item 2              @tab @code{Relay_Log_Pos}
@item 3              @tab @code{Relay_Master_Log_File}
@item 4              @tab @code{Exec_Master_Log_Pos}
@end multitable

@c TODO: This stuff about backups is out of place. We haven't even
@c described how to set up replication yet, much less worry about backups.

When you back up your slave's data, you should back up these 2 small files
as well, along with the relay log files. because they are needed to resume
replication after you restore the slave's data.  If you lose the relay logs
but still have the @file{relay-log.info} file, you can check it to determine
how far the SQL thread has executed in the master binlogs. Then you can use
@code{CHANGE MASTER TO} with the @code{MASTER_RELAY_LOG} and
@code{MASTER_RELAY_POS} options to tell the slave to re-read the binlogs from
that point.  This requires that the binlogs still exist on the master server.

If your slave is subject to replicating @code{LOAD
DATA INFILE} statements, you should also backup the @file{SQL_LOAD-*} files
that may exist in the directory that the slave uses for this purpose.
The slave needs these files to resume
replication of any interrupted @code{LOAD DATA INFILE} statements. 
The directory location is specified using the @code{--slave-load-tmpdir}
option.  Its default value if not specified is the value of the @code{tmpdir}
variable.

@node Replication HOWTO, Replication Upgrade, Replication Implementation Details, Replication
@section How to Set Up Replication

Here is a quick description of how to set up complete replication on
your current MySQL server. It assumes you want to replicate all
your databases and have not configured replication before. You will need
to shut down your master server briefly to complete the steps outlined
here.

The procedure is written in terms of setting up a single slave, but you can
use it to set up multiple slaves.

While this method is the most straightforward way to set up a slave,
it is not the only one. For example, if you already have a snapshot
of the master's data, and
the master already has its server ID set and binary logging enabled, you can
set up a slave without shutting down the master or even blocking updates to it.
For more details, please see @ref{Replication FAQ}.

If you want to administer a MySQL replication setup, we
suggest that you
read this entire chapter through and try all commands
mentioned in @ref{Replication Master SQL} ans @ref{Replication Slave SQL}.
You should also familiarise yourself
with replication startup options in @file{my.cnf} in
@ref{Replication Options}.

Note that this procedure and some of the replication SQL statements
in later sections refer to the @code{SUPER} privilege. Prior to MySQL
4.0.2, use the @code{PROCESS} privilege instead.

@enumerate
@item
Make sure you have a recent version of MySQL installed on the master
and and slaves, and that these versions are compatible according to the table
shown in @ref{Replication Upgrade}.

Please do not report bugs until you have verified that the problem is present
in the latest release.

@item
Set up an account on the master server that the slave server can use to
connnect. This account must be given the @code{REPLICATION SLAVE} privilege.
(If MySQL versions older than 4.0.2, give the account the @code{FILE}
privilege instead.)
If the account is only for replication
(which is recommended), you don't need to grant any additional privileges.

The hostname in the account name should be such that each of the slave servers
can use the account to connect to the master.
For example, to create a user named @code{repl} which can access your
master from any host, you might use this command:

@example
mysql> GRANT REPLICATION SLAVE ON *.* TO repl@@'%' IDENTIFIED BY '<password>';
@end example

For MySQL versions older than 4.0.2, use this command instead:

@example
mysql> GRANT FILE ON *.* TO repl@@'%' IDENTIFIED BY '<password>';
@end example

If you plan to use the @code{LOAD TABLE FROM MASTER} or @code{LOAD DATA
FROM MASTER} statements from the slave host, you will need to grant this
account additional privileges:

@itemize @bullet

@item
Grant to the account the @code{SUPER} and @code{RELOAD} global privileges.

@item
Grant the @code{SELECT} privilege for all tables that
you want to load. Any master tables from which the account cannot
@code{SELECT} will be ignored by @code{LOAD DATA FROM MASTER}.
@end itemize

@item
If you are using MyISAM tables, flush all the tables and block write queries
by executing @code{FLUSH TABLES WITH READ LOCK} command.

@example
mysql> FLUSH TABLES WITH READ LOCK;
@end example

and then take a snapshot of the data on your master server.

The easiest way to create a snapshot is to simply use an archiving program
(@code{tar} on Unix, @code{PowerArchiver}, @code{WinRAR},
@code{WinZip} or any similar software on Windows) to
produce an archive of the databases in your master's data directory. 
For example, to use @code{tar} to create an archive that includes all
databases, change location into the master server's data directory, then
execute this command:

@example
shell> tar -cvf /tmp/mysql-snapshot.tar .
@end example

If you want the archive to include only a database called @code{this_db}, use
this command instead:

@example
shell> tar -cvf /tmp/mysql-snapshot.tar ./this_db
@end example

Then copy the archive file to the @file{/tmp} directory on the slave server
host. On that machine, change location into the slave's data directory, and
unpack the archive file using this command:

@example
shell> tar -xvf /tmp/mysql-snapshot.tar
@end example

You may not want to replicate the @code{mysql} database. If not, you can
exclude it from the archive. You also need not include any log files in the
archive, or the @file{master.info} or @file{relay-log.info} files.

While the read lock placed by @code{FLUSH TABLES WITH READ LOCK} is in effect,
read the value of the current binary log name and offset on the master:

@example
mysql > SHOW MASTER STATUS;
+---------------+----------+--------------+------------------+
| File          | Position | Binlog_Do_DB | Binlog_Ignore_DB |
+---------------+----------+--------------+------------------+
| mysql-bin.003 | 73       | test,bar     | foo,manual,mysql |
+---------------+----------+--------------+------------------+
1 row in set (0.06 sec)
@end example

The @code{File} column shows the name of the log,  while @code{Position} shows
the offset. In the above example, the binary log value is
@code{mysql-bin.003} and the offset is 73. Record the values. You will need
to use them later when you are setting up the slave.

Once you have taken the snapshot and recorded the log name and offset, you can
re-enable write activity on the master:

@example
mysql> UNLOCK TABLES;
@end example

If you are using InnoDB tables, ideally you should use the InnoDB Hot Backup
tool that is available to those who purchase MySQL commercial licenses,
support, or the backup tool itself. It takes a consistent snapshot
without acquiring any locks on the master server, and records the log name and
offset corresponding to the snapshot to be later used on the slave. More
information about the tool is available at
@uref{http://www.innodb.com/order.php}.

Without the Hot Backup tool, the quickest way to take a snapshot of  InnoDB
tables is to shut down the master server and copy the InnoDB datafiles
and logs,
and the table definition files (@code{.frm}). To record the current log file
name and offset, you should do the following before you shut down the server:

@example
mysql> FLUSH TABLES WITH READ LOCK;
mysql> SHOW MASTER STATUS;
@end example

And then record the log name and the offset from the output of
@code{SHOW MASTER STATUS} as was shown earlier. Once you have recorded the
log name and the offset, shut down the server without unlocking the tables to
make sure it goes down with the snapshot corresponding to the current log file
and offset:

@example
shell> mysqladmin -uroot shutdown
@end example

An alternative for both MyISAM and InnoDB tables
is to take an SQL dump of the master instead of a binary
copy like above; for this you can use @code{mysqldump --master-data}
on your master and later run this SQL dump into your slave. However, this is
slower than doing a binary copy.

If the master has been previously running without @code{--log-bin} enabled,
the log name and position values displayed by @code{SHOW MASTER
STATUS} or @code{mysqldump} will be empty. In that case, record empty 
string ('') for the log name, and 4 for the offset.

@item
Make sure the @code{[mysqld]} section of the @file{my.cnf} file on the
master host includes a @code{log-bin} option. The section should also have a
@code{server-id=master_id} option, where @code{master_id} must be an integer
value from 1 to 2^32 - 1. For example:

@example
[mysqld]
log-bin
server-id=1
@end example

If those options are not present, add them and restart the server.


@item
Stop the server that is to be used as a slave server and add the following to
its @file{my.cnf} file:

@example
[mysqld]
server-id=slave_id
@end example

The @code{slave_id} value, like the @code{master_id} value, must
be an integer value from 1 to 2^32 - 1. In addition, it is very
important that the ID of the slave be different than the ID of the
master. For example:

@example
[mysqld]
server-id=2
@end example

If you are setting up multiple slaves, each one must have
a @code{server-id} value that differs from that of the master and
from each of the other slaves.  Think of @code{server-id} values
as something similar to IP addresses: These IDs uniquely identify
each server instance in the community of replication partners.

If you don't specify a @code{server-id} value, it will be set to 1 if
you have not defined @code{master-host}, else it will be set to 2. Note
that in the case of @code{server-id} omission, a master will refuse
connections from all slaves, and a slave will refuse to connect to a
master. Thus, omitting @code{server-id} is only good for backup with a
binary log.

@item
If you made a binary backup of the master server's data, copy it to the slave
server's data directory before starting the slave.
Make sure that the privileges on
the files and directories are correct. The user which MySQL runs
as needs to be able to read from and write to them, just as on the
master.

If you made a backup using @code{mysqldump}, start the slave first (see next
step).

@item
Start the slave server. If it has been replicating previously,
start the slave server with the @code{--skip-slave-start} option.
You also may want to start the slave server with the
@code{--log-warnings} option. That way, you will get more messages about
problems (for example, network or connection problems).

@item
If you made a backup of the master server's data using @code{mysqldump}, load
the dump file into the slave server:

@example
shell> mysql -u root -p < dump_file.sql
@end example

@item
Execute the following command on the slave, replacing the values within
@code{<>} with the actual values relevant to your system:

@example
mysql> CHANGE MASTER TO
    ->     MASTER_HOST='<master hostname>',
    ->     MASTER_USER='<replication username>',
    ->     MASTER_PASSWORD='<replication password>',
    ->     MASTER_LOG_FILE='<recorded log file name>',
    ->     MASTER_LOG_POS=<recorded log offset>;
@end example

The following table lists the maximum string length for these variables:

@multitable @columnfractions .40 .20
@item @code{MASTER_HOST}     @tab 60
@item @code{MASTER_USER}     @tab 16
@item @code{MASTER_PASSWORD} @tab 32
@item @code{MASTER_LOG_FILE} @tab 255
@end multitable

@item
Start the slave threads:

@example
mysql> START SLAVE; 
@end example

@end enumerate

After you have performed this procedure, the slave should connect to the master
and catch up on any updates that have occurred since the snapshot was taken.

If you have forgotten to set @code{server-id} for the master, slaves will
not be able to connect to it.

If you have forgotten to set @code{server-id} for the slave, you will get
the following error in its error log:

@example
Warning: one should set server_id to a non-0 value if master_host is set.
The server will not act as a slave.
@end example

You will also find error messages in the slave's error log if it
is not able to replicate for any other reason.

Once a slave is replicating, you will find in its data directory one file called
@file{master.info} and another called @file{relay-log.info}.
The slave uses these two files to keep track of how much
of the master's binary log it has processed. @strong{Do not} remove or
edit these files, unless you really know what you are doing and understand
the implications. Even in that case,
it is preferred that you use @code{CHANGE MASTER TO} command.

@strong{NOTE}: The content of @file{master.info} overrides some
options specified on the command-line or in @file{my.cnf}
See @ref{Replication Options} for more details.

Once you have a snapshot, you can use it to set up other slaves by
following the slave portion of the procedure just described. You do not need to
take another snapshot of the master.

@node Replication Upgrade, Replication Features, Replication HOWTO, Replication
@section Upgrading a Replication Setup - Mixing Different MySQL Versions

Any MySQL 4.1.x version is identical to MySQL 4.0.3 (and newer 4.0) as 
far as replication is concerned (same binary log format).
So replication between 4.0.3 (and newer 4.0) and any 4.1.x (whatever of the two
is the master or slave) is working seamlessly.

Binary log format was changed between MySQL 3.23 and MySQL 4.0, and between 
MySQL 4.0 (or 4.1, as it's the same binary log format) and MySQL 5.0. This
has consequences on how to upgrade a replication setup, which is explained below.

The following table indicates master/slave replication compatibility between
different versions of MySQL.

@c FIX arjen 2002-07-17 new table, not yet measured for XML/DocBook.
@multitable @columnfractions .10 .15 .15 .15 .15
@item                @tab                         @tab @strong{Master}         @tab @strong{Master}                    @tab @strong{Master}
@item                @tab                         @tab @strong{3.23.33 and up} @tab @strong{4.0.3 and up or any 4.1.x} @tab @strong{5.0.0}
@item @strong{Slave} @tab @strong{3.23.33 and up} @tab yes                     @tab no                                 @tab no
@item @strong{Slave} @tab @strong{4.0.3 and up}   @tab yes                     @tab yes                                @tab no
@item @strong{Slave} @tab @strong{5.0.0}          @tab yes                     @tab yes                                @tab yes
@end multitable

Versions 4.0.0, 4.0.1 and 4.0.2 were very early development versions which
should not be used anymore (their compatibility is still documented
in the manual included in these versions' distributions).

As a general rule, it's always recommended to use recent MySQL versions,
because replication capabilities are continually being improved.
We recommend using same version for both the master and the slave.

@table @strong

@item Upgrading from 3.23 to 4.0 (4.0.3 or newer) or any 4.1.x

When you upgrade a master from MySQL 3.23 to MySQL 4.0 (or
4.1), you should first ensure that all the slaves of this master are
already 4.0 or 4.1 (if that's not the case, you should first upgrade
your slaves as explained a few lines below).
Once the master is upgraded, you should not restart replication 
using old 3.23 binary logs, because this will unfortunately confuse the 
4.0 or 4.1 slave. The upgrade
can safely be done this way, assuming you have a 3.23 master to upgrade
and you have 4.0 or 4.1 slaves:

@enumerate
@item
Block all updates on the master (@code{FLUSH TABLES WITH READ LOCK}).
@item
Wait until all the slaves have caught up all changes from the master
(use @code{SHOW MASTER STATUS} on the master, and @code{SELECT
MASTER_POS_WAIT()} on the slaves). Then run @code{STOP SLAVE} on 
the slaves.
@item
Shut down MySQL on the master and upgrade the master to MySQL 4.0 or 4.1.
@item
Restart MySQL on the master. Record the name @file{<name>} of the master's
newly created binary log. You can obtain the name of the file by issuing
@code{SHOW MASTER STATUS} on the master. Then issue these commands on each
slave:
@example
mysql> CHANGE MASTER TO MASTER_LOG_FILE='<name>', MASTER_LOG_POS=4;
mysql> START SLAVE;
@end example

@end enumerate

If you also must upgrade your slaves from 3.23 to 4.0 or 4.1, 
you should first upgrade your slaves: shut down each one, upgrade it, 
and restart it. Then upgrade the master as just described.

@item Upgrading from 3.23 or 4.0 (4.0.3 or newer) or any 4.1.x to 5.0.0

First, note that MySQL 5.0.0 is alpha; even if it is supposed to work
better than older versions (easier upgrade, replication of some important 
session variables like @code{sql_mode}; see @ref{News-5.0.0}), 
it has not been tested a lot yet so,
as with any alpha release, we recommend you do not use in critical
production environment yet.

When you upgrade a master from MySQL 3.23 or 4.0 or
4.1 to 5.0.0, you should first ensure that all the slaves of this master are
already 5.0.0 (if that's not the case, you should first upgrade
your slaves as explained a few lines below).
Then just shut down your master, upgrade it to 5.0.0 and restart it.
The 5.0.0 master will be able to read the old binary logs (of before
the master upgrade) and to send them to the 5.0.0 slaves which will recognize
this old format and handle it. Binary logs created after the master upgrade
will be in 5.0.0 format and be recognized by 5.0.0 slaves too.
To upgrade the slaves, just shut them down, upgrade them to 5.0.0,
and restart them (and restart replication). The 5.0.0 slaves
will be able to read the old relay logs (of before the slave upgrade)
and execute the statements they contain. Relay logs created after
the slave upgrade will be in 5.0.0 format.
In other words, there are no measures to take when upgrading to 5.0.0,
except that slaves must be 5.0.0 to be able to upgrade the master to
5.0.0. Note that downgrading from 5.0.0 to older versions does not work
as automatically; you will have to remove any 5.0.0 binary logs or relay
logs before proceeding.

@end table

@node Replication Features, Replication Options, Replication Upgrade, Replication
@section Replication Features and Known Problems

@cindex options, replication
@cindex @file{my.cnf} file
@cindex files,@file{my.cnf}

Here is an explanation of what is supported and what is not:

@itemize @bullet
@item
Replication will be done correctly with @code{AUTO_INCREMENT},
@code{LAST_INSERT_ID()}, and @code{TIMESTAMP} values.
@item
The @code{USER()} and @code{LOAD_FILE()} functions
are replicated without changes and will thus not work reliably on the
slave. This is also true for @code{CONNECTION_ID()} in slave versions
older than 4.1.1.
The @strong{new} @code{PASSWORD()} function in MySQL 4.1, is well
replicated since 4.1.1 masters; your slaves must be 4.1.0 or above
to replicate it. If you have older slaves and need to replicate
@code{PASSWORD()} from your 4.1.x master, you must start your master
with option @code{--old-password}.
@item
The @code{SQL_MODE}, @code{UNIQUE_CHECKS}, 
@code{SQL_AUTO_IS_NULL} variables are replicated only starting from 5.0.0.
@code{SQL_SELECT_LIMIT} and @code{TABLE_TYPE} variables are not
replicated yet. @code{FOREIGN_KEY_CHECKS} is replicated since version
4.0.14.
@item
You must use the same character set (@code{--default-character-set})
on the master and the slave. Otherwise, you may get duplicate key errors on
the slave, because a key that is regarded as unique in the master character
set may not be unique in the slave character set. Character sets will
be replicated in 5.0.x.
@item
If you are using transactional tables on the master and non-transactional
tables (for the same tables) on the slave, you will get problems if
the slave is stopped in the middle of a @code{BEGIN/COMMIT} block, as
the slave will later start at the beginning of the @code{BEGIN} block.
This issue is on our TODO and will be fixed in the near future.
@item
Update queries that use user variables are badly replicated in
3.23 and 4.0. This is fixed in 4.1. Note that user variable names
are case insensitive starting from version 5.0, so you should take
this into account when setting up replication between 5.0 and a
previous version.
@item
The slave can connect to the master using SSL, if the master and slave
are both 4.1.1 or newer.
@item
If a @code{DATA DIRECTORY} or @code{INDEX DIRECTORY} clause was used in a
@code{CREATE TABLE} on master, then these clauses will be used too on
slave. Starting from MySQL 4.0.15 there is a @code{SQL_MODE} mode called
@code{NO_DIR_IN_CREATE}; if the slave server is run in this mode, it will
simply cut off the clauses before replicating the @code{CREATE TABLE} (so the
MyISAM data and index files will be created in the slave's @code{datadir}
directory).
@item
Though we have never heard of it actually occurring, it is theoretically
possible for the data on the master and slave to become different if a
query is designed in such a way that the data modification is
non-deterministic, that is, left to the will of the query optimizer (which
generally is not a good practice, even outside of replication!).
For a detailed explanation, see
@ref{Open bugs}.
@item
Before MySQL 4.1.1,
@code{FLUSH}, @code{ANALYZE}, @code{OPTIMIZE}, @code{REPAIR} commands
are not stored in the binary log and thus are
not replicated to the slaves. This is not normally a problem as
these commands don't change anything. However, it does mean that if you
update the MySQL privilege tables directly without using the
@code{GRANT} statement and you replicate the @code{mysql} privilege
database, you must do a @code{FLUSH PRIVILEGES} on your slaves to put
the new privileges into effect. Also if you use
@code{FLUSH TABLES} when renaming a @code{MyISAM} table involved in a
@code{MERGE} table, you will have to issue @code{FLUSH TABLES}
manually on the slave.
Since MySQL 4.1.1, these commands are written to the binary log
(except @code{FLUSH LOGS}, @code{FLUSH MASTER}, @code{FLUSH SLAVE},
@code{FLUSH TABLES WITH READ LOCK}) unless you specify
@code{NO_WRITE_TO_BINLOG} (or its alias @code{LOCAL}).
For a syntax example, see @ref{FLUSH, , @code{FLUSH}}.
@item
MySQL only supports one master and many slaves. Later we will
add a voting algorithm to automatically change master if something goes
wrong with the current master. We will also introduce ``agent'' processes
to help do load balancing by sending @code{SELECT} queries to different
slaves.
@item
Starting from MySQL 4.0.18, the master notifies the slave of a @code{HEAP}
table having been emptied by master's shutdown/restart by writing a
@code{DELETE FROM} to its binary log the first time it uses the table since
startup. See @ref{HEAP} for more details.
@item
Temporary tables are replicated with the exception of the case
that you shut down slave server (not just slave thread) and you have some
replicated temporary tables that are used in update statements that
have not yet been executed on the slave.  (If you shut down the slave, the
temporary tables needed by those updates no longer are available when the
slave starts again.)
To avoid this problem, do not shut down the slave while it has temporary
tables open. Instead, use this procedure:

@enumerate

@item
Issue a @code{STOP SLAVE} statement.

@item
Use @code{SHOW STATUS} to check the value of the @code{Slave_open_temp_tables}
variable.

@item
If the value is 0, issue a @code{mysqladmin shutdown} command to
shut down the slave.

@item
If the value is not 0, restart the slave threads with @code{START SLAVE}.

@item
Repeat the procedure later to see if you have better luck next time.

@end enumerate

We have plans to fix this problem in the near future.

@item
It is safe to connect servers in a circular
master/slave relationship with @code{log-slave-updates} enabled.
Note, however, that many queries will not work correctly in this kind of
setup unless your client code is written to take care of the potential
problems that can happen from updates that occur in different sequence
on different servers.

This means that you can do a setup like the following:

@example
A -> B -> C -> A
@end example

Server IDs are encoded in the binary log events.  A will know when
an event it reads had originally been created by A, so A will not
execute it and there will be no infinite loop.  But this circular
setup will work only if you only if you perform no conflicting
updates between the tables.  In other words, if you insert data in
A and C, you should never insert a row in A that may have a
conflicting key with a row insert in C.  You should also not update
the same rows on two servers if the order in which the updates are
applied matters.
@item
If a query on the slave gets an error, the slave SQL thread will
terminate, and a message will appear in the slave error log. You should
then connect to the slave manually, fix the cause of the error (for
example, non-existent table), and then run @code{START SLAVE}.
@item
If the connection to the master is lost, the slave will try to reconnect
immediately. If that fails, the slave will retry
every @code{master-connect-retry} seconds (default
60). Because of this, it is safe to shut down the master, and
then restart it after a while. The slave will also be able to deal with
network connectivity outages. However, the slave will notice the
network outage only after receiving no data from the master for
@code{slave_net_timeout} seconds. So if your outages are short, you may want
to decrease @code{slave_net_timeout}.
@xref{SHOW VARIABLES, , @code{SHOW VARIABLES}}.
@item
Shutting down the slave (cleanly) is also safe, as it keeps track of
where it left off.  Unclean shutdowns might produce problems, especially
if disk cache was not synced before the system died. Your system fault
tolerance will be greatly increased if you have a good UPS.
@item
Due to the non-transactional nature of MyISAM tables, it is possible to have
a query that will only partially update a table and return an error code. This
can happen, for example, on a multi-row insert that has one row violating a
key constraint, or if a long update query is killed after updating some of the
rows. If that happens on the master, the slave thread will exit and wait for
the DBA to decide what to do about it unless the error code is legitimate and
the query execution results in the same error code. If this error code
validation behavior is not desirable, some (or all) errors can be masked
out (ignored) with the @code{--slave-skip-errors} option.
This option is available starting with MySQL Version 3.23.47.
@item
If you update transactional tables from non-transactional tables inside a
@code{BEGIN/COMMIT} segment, updates to the binary log may be out of sync
if some thread changes the non-transactional table before the
transaction commits.  This is because the transaction is written to the
binary log only when it's commited.
@item
Before version 4.0.15, any update to a non-transactional table is
written to the binary log at once when the update is made while
transactional updates are written on @code{COMMIT} or not written at
all if you use @code{ROLLBACK}; you have to take this into account
when updating both transactional tables and non-transactional tables
in the same transaction if you are using binary logging for backups or
replication. In version 4.0.15, we changed the logging behavior
for transactions that mix updates to transactional and
non-transactional tables, which solves the problems (order of queries
is good in binlog, and all needed queries are written to the binlog
even in case of @code{ROLLBACK}). The problem which remains is when a
second connection updates the non-transactional table while the first
connection's transaction is not finished yet (wrong order can still
occur, because the second connection's update will be written
immediately after it is done).
@end itemize

The following table lists problems in MySQL 3.23 that are fixed in MySQL 4.0:

@itemize @bullet
@item
@code{LOAD DATA INFILE} is handled properly, as long as the data file
still resides on the master server at the time of update
propagation.
@item
@code{LOAD LOCAL DATA INFILE} will be skipped.
@item
In 3.23 @code{RAND()} in updates does not replicate properly.
Use @code{RAND(some_non_rand_expr)} if you are replicating updates with
@code{RAND()}. You can, for example, use @code{UNIX_TIMESTAMP()} for the
argument to @code{RAND()}. This is fixed in 4.0.
@end itemize


@node Replication Options, Replication FAQ, Replication Features, Replication
@section Replication Startup Options

@c TODO: This section says that it describes slave options, but there
@c are master options that need to be listed as well, like
@c show-slave-auth-info.

@c TODO: There really should be a separate section devoted to the use
@c and structure of master.info, and how it interacts with startup options.

On both the master and the slave you need to use the @code{server-id} option
to establish a unique replication ID for each server. You should pick a unique
integer in the
range from 1 to 2^32 - 1 for each master and slave.
Example: @code{server-id=3}

The options that you can use on the master server for controlling binary
logging are all described in @ref{Binary log}.

The following table describes the options you can use on slave servers.
You can specify them on the command line or in an option file.

@strong{NOTE}: Replication handles the following options in a special way:

@itemize
@item @code{--master-host}
@item @code{--master-user}
@item @code{--master-password}
@item @code{--master-port}
@item @code{--master-connect-retry}
@end itemize

If no @file{master.info} file exists when the slave server starts,
it uses values for those options that are specified in option files
or on the command line.  This will occur when you start the server
as a replication slave for the very first time, or you have run
@code{RESET SLAVE} and shut down and restarted the slave server.

However, if the @file{master.info} file exists when the slave server
starts, it uses the values in the file and @strong{IGNORES} any
values specified for those options in option files or on the command
line.

Suppose you specify this option in your @file{my.cnf} file:

@example
[mysqld]
master-host=this_host
@end example

The first time you start the server as a replication slave, it will
read and use that option from the @file{my.cnf} file.  The server
will then record that value in the @file{master.info} file.  The
next time you start the server, it will read the master host value
from the @file{master.info} file only.  If you modify the @file{my.cnf}
file to specify a different master host, it will have no effect.
You must use @code{CHANGE MASTER TO} instead.

As of MySQL 4.1.1, the following options also are handled specially:

@itemize
@item @code{--master-ssl}
@item @code{--master-ssl-ca}
@item @code{--master-ssl-capath}
@item @code{--master-ssl-cert}
@item @code{--master-ssl-cipher}
@item @code{--master-ssl-key}
@end itemize

The @file{master.info} file includes the values corresponding to those
options. In addition, the 4.1.1 file format includes as its first line
the number of lines in the file. If you upgrade an older server to 4.1.1,
the @file{master.info} will be upgraded to the new format automatically when
the new server starts. (If you downgrade a 4.1.1 or newer server to a version
older than 4.1.1, you should manually remove the first line before starting
the older server for the first time.)

Because the server gives an existing @file{master.info} file precedence
over the startup options just described, you might prefer not to use startup
options for these values at all, and instead specify them by using the
@code{CHANGE MASTER TO} statement.
See @ref{CHANGE MASTER TO,  , @code{CHANGE MASTER TO}}.

This example shows a more extensive use of startup options to configure a
slave server:

@example
[mysqld]
server-id=2
master-host=db-master.mycompany.com
master-port=3306
master-user=pertinax
master-password=freitag
master-connect-retry=60
report-host=db-slave.mycompany.com
@end example

The following list describes startup options for controlling replication:

@c TODO: Hmm ... this list seems to be missing the --binlog-xxx options.

@table @code

@item --log-slave-updates
Tells the slave to log the updates performed by its SQL thread to the
slave's own binary log. Off by default.
For this option to have any effect, the slave must be started with
binary logging enabled (@code{--log-bin} option).
@code{--log-slave-updates} is used when you want to chain replication servers.
For example, you might want a setup like this:

@example
A -> B -> C
@end example

That is, A serves as the master for the slave B, and B serves as the master
for the slave C. For this to work, where B is both a master and a slave,
you must start B with the @code{--log-slave-updates} option.
A and B must both be started with binary logging enabled.

@item --log-warnings
Makes the slave print more messages about what it is doing. For
example, it will warn you that it succeeded in reconnecting after a
network/connection failure, and warn you about how each slave thread started.

This option is not limited to replication use only. It produces warnings
across a spectrum of server activities.

@item --master-host=host
Specify the hostname or IP address of the master replication server.
If this option is not given, the slave
thread will not be started.  The value in @file{master.info}
takes precedence if it can be read.
Probably a better name for this options would have been something like
@code{--bootstrap-master-host}, but it is too late to change now.

@item --master-user=username
The username of the account that the slave thread uses for authentication when
connecting to the master. The account must have the
@code{REPLICATION SLAVE} privilege (prior to MySQL 4.0.2, it must have the
@code{FILE} privilege instead). If the master user
is not set, user @code{test} is assumed. The value in @file{master.info}
takes precedence if it can be read.

@item --master-password=password
The password of the account that the slave thread uses for authentication when
connecting to the master.
If not set, an empty password is assumed. The value in
@file{master.info} takes precedence if it can be read.

@item --master-port=port_number
The port the master is listening on. If not set, the compiled setting of
@code{MYSQL_PORT} is assumed. If you have not tinkered with
@code{configure} options, this should be 3306. The value in
@file{master.info} takes precedence if it can be read.

@item --master-connect-retry=seconds
The number of seconds the slave thread sleeps before retrying to
connect to the master in case the master goes down or the connection is
lost.  Default is 60. The value in @file{master.info}
takes precedence if it can be read.

@item --master-info-file=filename
Specifies the name to use for the file in which the slave records
information about the master.
The default name is @file{mysql.info} in the data directory.

@item --master-ssl
@itemx --master-ssl-ca=file_name
@itemx --master-ssl-capath=directory_name
@itemx --master-ssl-cert=file_name
@itemx --master-ssl-cipher=cipher_list
@itemx --master-ssl-key=file_name

These options are used for setting up a secure replication connection to
the master server using SSL.
Their meanings are the same as the corresponding
@code{--ssl},
@code{--ssl-ca},
@code{--ssl-capath},
@code{--ssl-cert},
@code{--ssl-cipher},
@code{--ssl-key}
options described in
@ref{SSL options}.

These options are operational as of MySQL 4.1.1.

@item --max-relay-log-size=#
To rotate the relay log automatically.
@xref{SHOW VARIABLES, , @code{SHOW VARIABLES}}.

@item --relay-log=filename
To specify the location and name that should be used for relay logs.
You can use this to have hostname-independant relay log names, or if
your relay logs tend to be big (and you don't want to decrease
@code{max_relay_log_size}) and you need to put them on some area
different from the data directory, or if you want to increase speed by
balancing load between disks.

@item --relay-log-index=filename
To specify the location and name that should be used for the relay
logs index file.

@item --relay-log-info-file=filename
To give @file{relay-log.info} another name and/or to put it in another
directory than the data directory.

@item --relay-log-purge=0|1
Disables/enables automatic purging of relay logs as soon as they are
not needed any more. This is a global variable that can be dynamically
changed with @code{SET GLOBAL RELAY_LOG_PURGE=0|1}. The default value
is 1.

This option is available as of MySQL 4.1.1.

@item --relay-log-space-limit=#
To put an upper limit on the total size of all relay logs on the
slave (a value of 0 means ``unlimited''). This is useful
if you have a small hard disk on your slave machine. When the limit is
reached, the I/O thread pauses (does not read the master's binlog)
until the SQL thread has caught up and deleted some now unused relay
logs. Note that this limit is not absolute: there are cases where the
SQL thread needs more events to be able to delete; in that case the I/O
thread will overgo the limit until deletion becomes possible. Not
doing so would cause a deadlock (which happens before MySQL 4.0.13).
Users should not set @code{--relay-log-space-limit} to less than twice
the value of @code{--max-relay-log-size} (or @code{--max-binlog-size} if
@code{--max-relay-log-size} is 0) because in that case there are
chances that when the I/O thread waits for free space because
@code{--relay-log-space-limit} is exceeded, the SQL thread has no relay
log to purge and so cannot satisfy the I/O thread, forcing the I/O
thread to temporarily ignore @code{--relay-log-space-limit}.

@item --replicate-do-table=db_name.table_name
Tells the slave thread to restrict replication to the specified table.
To specify more than one table, use the directive multiple times, once
for each table.  This will work for cross-database updates, in
contrast to @code{--replicate-do-db}. 
Please read the notes that follow this option list.

@item --replicate-ignore-table=db_name.table_name
Tells the slave thread to not replicate any command that updates the
specified table (even if any other tables may be update by the same
command). To specify more than one table to ignore, use the directive
multiple times, once for each table. This will work for cross-database
updates, in contrast to @code{--replicate-ignore-db}.
Please read the notes that follow this option list.

@item --replicate-wild-do-table=db_name.table_name
Tells the slave thread to restrict replication to queries where any of
the updated tables match the specified wildcard pattern.  To specify
more than one table, use the directive multiple times, once for each
table.  This will work for cross-database updates.
Please read the notes that follow this option list.

Example: @code{--replicate-wild-do-table=foo%.bar%} will replicate only
updates that uses a table in any databases that start with @code{foo}
and whose table names start with @code{bar}.

Note that if you do @code{--replicate-wild-do-table=foo%.%} then the rule
will be propagated to @code{CREATE DATABASE} and @code{DROP DATABASE},
that is, these two statements will be replicated if the database name
matches the database pattern (@code{foo%} here) (this magic is triggered by
@code{%} being the table pattern).

Escaping wildcard characters @code{_} and @code{%}: if you want to
replicate, for example, all tables of 
the @code{my_own%db} database (this is the exact name of the database),
but not replicate tables from the @code{my1ownAABCdb} database, you
should escape the @code{_} and @code{%}: you should use something like
this:
@code{replicate-wild-do-table=my\_own\%db}. And if you are specifying
this option from the command-line, depending on your system you may need
to escape the @code{\} (for example, with a @code{bash} shell, you
would need to type @code{--replicate-wild-do-table=my\\_own\\%db}).

@item --replicate-wild-ignore-table=db_name.table_name
Tells the slave thread to not replicate a query where any table matches the
given wildcard pattern. To specify more than one table to ignore, use
the directive multiple times, once for each table. This will work for
cross-database updates.
Please read the notes that follow this option list.

Example: @code{--replicate-wild-ignore-table=foo%.bar%} will not do updates
to tables in databases that start with @code{foo} and whose table names start
with @code{bar}.

Note that if you do @code{--replicate-wild-ignore-table=foo%.%} then the
rule will be propagated to @code{CREATE DATABASE} and @code{DROP
DATABASE}, that is, these two statements will not be replicated if the
database name matches the database pattern (@code{foo%} here) (this magic is
triggered by @code{%} being the table pattern).

Escaping wildcard characters @code{_} and @code{%}:
see notes in the description of @code{replicate-wild-do-table} just above.

@item --replicate-do-db=database_name

Tells the slave to restrict replication to commands where
the current database (that is, the one selected by @code{USE})
is @code{database_name}.
To specify more than one database, use the directive multiple
times, once for each database. Note that this will not replicate
cross-database queries such as @code{UPDATE some_db.some_table
SET foo='bar'} while having selected a different or no database. If you
need cross database updates to work, make sure you have 3.23.28 or
later, and use @code{--replicate-wild-do-table=db_name.%}.
Please read the notes that follow this option list.

Example of what does not work as you could expect it: if the slave is
started with @code{--replicate-do-db=sales}, and you do
@code{USE prices; UPDATE sales.january SET amount=amount+1000;},
this query will not be replicated.

If you need cross database updates to work, 
use @code{--replicate-wild-do-table=db_name.%} instead.

The main reason for this ``just-check-the-current-database''
behavior is that it's hard from the command
alone to know if a query should be replicated or not; for example if you
are using multiple-table-delete or multiple-table-update commands
that go across multiple databases.  It's also very fast to just check
the current database.

@item --replicate-ignore-db=database_name

Tells the slave to not replicate any command where the current
database (that is, the one selected by @code{USE})
is @code{database_name}. To specify more than one database to
ignore, use the directive multiple times, once for each database.
You should not use this directive if you are using cross table updates
and you don't want these update to be replicated.
Please read the notes that follow this option list.

Example of what does not work as you could expect it: if the slave is
started with @code{--replicate-ignore-db=sales}, and you do
@code{USE prices; UPDATE sales.january SET amount=amount+1000;},
this query will be replicated.

If you need cross database updates to work, 
use @code{--replicate-wild-ignore-table=db_name.%} instead.

@item --replicate-rewrite-db=from_name->to_name
Tells the slave to translate the current database
(that is, the one selected by @code{USE})
to @code{to_name} if it was @code{from_name} on the master.
Only statements involving tables may be affected
(@code{CREATE DATABASE}, @code{DROP DATABASE} won't),
and only if @code{from_name} was the current database on the master.
This will not work for cross-database updates.
Note that the translation is done before @code{--replicate-*}
rules are tested.

@c TODO: need to quote option value if option given on command line,
@c due to inclusion of > character?

Example: @code{replicate-rewrite-db=master_db_name->slave_db_name}

@item --report-host=host
The hostname or IP number of the slave to be reported to
the master during slave registration. Will appear in the output of
@code{SHOW SLAVE HOSTS}. Leave unset if you do not want the slave to
register itself with the master. Note that it is not sufficient for the
master to simply read the IP number of the slave from the TCP/IP socket once the slave
connects. Due to @code{NAT} and other routing issues, that IP may not be
valid for connecting to the slave from the master or other hosts.
@c For
@c the moment, this option is of no real interest; it is meant for failover
@c replication, which is not implemented yet.

This option is available as of MySQL 4.0.0.

@item --report-port=port_number
Port for connecting to slave reported to the
master during slave registration.  Set it only if the slave is listening
on a non-default port or if you have a special tunnel from the master or
other clients to the slave. If not sure, leave this option unset.
@c For the moment, this option is of no real interest; it is meant for failover
@c replication, which is not implemented yet.

This option is available as of MySQL 4.0.0.

@item --skip-slave-start
Tells the slave server not to start the slave threads on server startup. The user
can start them later with @code{START SLAVE}.

@item --slave_compressed_protocol=#
If 1, then use compression on the slave/client protocol if both
slave and master support this.

@item --slave-load-tmpdir=filename
This option is by default equal to the value of the @code{tmpdir} variable.
When the slave SQL thread replicates a @code{LOAD DATA INFILE} command, it
extracts the to-be-loaded file from the relay log into temporary files,
then loads these into the table. If the file loaded on the master was
huge, the temporary files on the slave will be huge, too; therefore you
may wish/have to tell the slave to put the temporary files on some
large disk different from @code{tmpdir}, using this option. In
that case, you may also use the @code{--relay-log} option,
as relay logs will be huge, too.
@code{--slave-load-tmpdir} should point to a disk-based filesystem; not a
memory-based one. Because the slave needs the
temporary files used to replicate @code{LOAD DATA INFILE}) to survive a
machine's reboot.

@item --slave-net-timeout=#
Number of seconds to wait for more data from the master before aborting
the read, considering the connection broken and retrying to connect. The first
retry occurs immediately after timeout. The interval between retries is
controlled by the @code{--master-connect-retry} option.

@item --slave-skip-errors= [err_code1,err_code2,... | all]

Tells the slave SQL thread to continue
replication when a query returns an error from the provided
list. Normally, replication will discontinue when an error is
encountered, giving the user a chance to resolve the inconsistency in the
data manually. Do not use this option unless you fully understand why
you are getting the errors.  If there are no bugs in your
replication setup and client programs, and no bugs in MySQL itself, you
should never get an abort with error. Indiscriminate use of this option
will result in slaves being hopelessly out of sync with the master and
you having no idea how the problem happened.

For error codes, you should use the numbers provided by the error message in
your slave error log and in the output of @code{SHOW SLAVE STATUS}. A full list
of error messages can be found in the source distribution in
@file{Docs/mysqld_error.txt}.
The server error codes also are listed at @ref{Error-returns}.

You can (but should not) also use a very non-recommended value of @code{all}
which will ignore all error messages and keep barging along regardless.
Needless to say, if you use it, we make no promises regarding your data
integrity. Please do not complain if your data on the slave is not anywhere
close to what it is on the master in this case --- you have been warned.

Examples:

@example
--slave-skip-errors=1062,1053
--slave-skip-errors=all
@end example

@end table

Some of these options, like all @code{--replicate-*} options, can only
be set at the slave server's startup, not on-the-fly. We plan to fix this.

Here is the order of evaluation of the @code{r--eplicate-*} rules, to
decide if the query is going to be executed by the slave or ignored by
it:
@enumerate
@item
Are there some @code{--replicate-do-db} or @code{--replicate-ignore-db}
rules?
@itemize @bullet
@item Yes:
test them like for @code{--binlog-do-db} and @code{--binlog-ignore-db}
(@pxref{Binary log}). What is the result of the test?
@itemize @minus
@item ignore the query:
ignore it and exit.
@item execute the query:
don't execute it immediately, defer the decision, go to step below.
@end itemize
@item No:
go to step below.
@end itemize
@item
Are there some @code{--replicate-*-table} rules?
@itemize @bullet
@item No:
execute the query and exit.
@item Yes:
go to step below. Only tables which are to be updated will be compared
to rules (@code{INSERT INTO sales SELECT * from prices}: only
@code{sales} will be compared to rules). If several tables are to be
updated (multiple-table statement),
the first matching table (matching ``do'' or ``ignore'') wins
(that is, the first table is compared to rules, then if no decision could
be taken the second table is compared to rules, etc).
@end itemize
@item
Are there some @code{--replicate-do-table} rules?
@itemize @bullet
@item Yes:
does the table match any of them?
@itemize @minus
@item Yes:
execute the query and exit.
@item No:
go to step below.
@end itemize
@item No:
go to step below.
@end itemize
@item
Are there some @code{--replicate-ignore-table} rules?
@itemize @bullet
@item Yes:
does the table match any of them?
@itemize @minus
@item Yes:
ignore the query and exit.
@item No:
go to step below.
@end itemize
@item No:
go to step below.
@end itemize
@item
Are there some @code{--replicate-wild-do-table} rules?
@itemize @bullet
@item Yes:
does the table match any of them?
@itemize @minus
@item Yes:
execute the query and exit.
@item No:
go to step below.
@end itemize
@item No:
go to step below.
@end itemize
@item
Are there some @code{--replicate-wild-ignore-table} rules?
@itemize @bullet
@item Yes:
does the table match any of them?
@itemize @minus
@item Yes:
ignore the query and exit.
@item No:
go to step below.
@end itemize
@item No:
go to step below.
@end itemize
@item
No @code{--replicate-*-table} rule was matched.
Is there another table to test against these rules?
@itemize @bullet
@item Yes:
loop.
@item No:
we have tested all tables to be updated, could not match any rule.
Are there @code{--replicate-do-table} or @code{--replicate-wild-do-table}
rules ?
@itemize @minus
@item Yes:
ignore the query and exit.
@item No:
execute the query and exit.
@end itemize
@end itemize
@end enumerate


@node Replication FAQ, Replication Problems, Replication Options, Replication
@section Replication FAQ

@strong{Q}: How do I configure a slave if the master is already running
and I do not want to stop it?

@strong{A}: There are several options. If you have taken a backup of the
master at some point and recorded the binlog name and offset ( from the
output of @code{SHOW MASTER STATUS} ) corresponding to the snapshot, do
the following:

@enumerate
@item
Make sure the slave is assigned a unique server ID.
@item
Execute the following statement on the slave, filling in appropriate values for each
parameter:

@example
mysql> CHANGE MASTER TO
    ->     MASTER_HOST='master_host-name',
    ->     MASTER_USER='master_user_name',
    ->     MASTER_PASSWORD='master_pass',
    ->     MASTER_LOG_FILE='recorded_log_name',
    ->     MASTER_LOG_POS=recorded_log_pos;
@end example

@item
Execute @code{START SLAVE} on the slave.
@end enumerate

If you do not have a backup of the master already, here is a quick way to
do it consistently:

@enumerate
@item
@code{FLUSH TABLES WITH READ LOCK}
@item
@code{gtar zcf /tmp/backup.tar.gz /var/lib/mysql} (or a variation of this)
@item
@code{SHOW MASTER STATUS} - make sure to record the output - you will need it
later
@item
@code{UNLOCK TABLES}
@end enumerate

An alternative is taking an SQL dump of the master instead of a binary
copy like above; for this you can use @code{mysqldump --master-data}
on your master and later run this SQL dump into your slave. However, this is
slower than makeing a binary copy.

No matter which of the two methods you use, afterwards follow the
instructions for the case when you have a snapshot and 
have recorded the log name and offset. You can use the same snapshot to set up
several slaves. As long as the binary logs of the master are left intact, you
can wait as long as several days or in some cases maybe a month to set up a
slave once you have the snapshot of the master. In theory the waiting gap can
be infinite. The two practical limitations is the diskspace of the master
getting filled with old logs, and the amount of time it will take the slave to
catch up.

You can also use @code{LOAD DATA FROM
MASTER}.  This is a convenient command that takes a snapshot,
restores it to the slave, and adjusts the log name and offset on the slave
all at once. In the future, @code{LOAD DATA FROM MASTER} will be the
recommended way to set up a slave.  Be warned, howerver, that the read
lock may be held for a long time if you use this command. It is not yet
implemented as efficiently as we would like to have it. If you have
large tables, the preferred method at this time is still with a local
@code{tar} snapshot after executing @code{FLUSH TABLES WITH READ LOCK}.

@strong{Q}: Does the slave need to be connected to the master all the time?

@strong{A}: No, it does not. The slave can go down or stay
disconnected for hours or even days, then reconnect and catch up on the
updates.
For example, you can set up a master/slave relationship over a dial-up link
where the link is up only sporadically and
for short periods of time. The implication of this is that at any
given time the slave is not guaranteed to be in sync with the master
unless you take some special measures. In the future, we will have the
option to block the master until at least one slave is in sync.

@strong{Q}: How do I know how late a slave is compared to the
master? In other words, how do I know the date of the last query
replicated by the slave?

@strong{A}: 
If the slave is 4.1.1 or newer, read the @code{Seconds_Behind_Master}
column in @code{SHOW SLAVE STATUS}. For older versions, the following
applies.
This is possible only if the slave SQL thread exists
(that is, if it shows up in @code{SHOW PROCESSLIST}, @pxref{Replication
Implementation Details}) 
(in MySQL 3.23: if the slave thread exists, that is, shows up in
@code{SHOW PROCESSLIST}),
and if it has executed at least one event
from the master. Indeed, when the slave SQL thread executes an event
read from the master, this thread modifies its own time to the event's
timestamp (this is why @code{TIMESTAMP} is well replicated). So in the
@code{Time} column in the output of @code{SHOW PROCESSLIST}, the
number of seconds displayed for the slave SQL thread is the number of
seconds between the timestamp of the last replicated event and the
real time of the slave machine. You can use this to determine the date
of the last replicated event. Note that if your slave has been
disconnected from the master for one hour, then reconnects,
you may immediately see @code{Time} values like 3600 for the slave SQL
thread in @code{SHOW PROCESSLIST}... This would be because the slave
is executing queries that are one hour old.

@strong{Q}: How do I force the master to block updates until the slave catches
up?

@strong{A}: Use the following procedure:

@enumerate

@item
On the master, execute these commands:

@example
mysql> FLUSH TABLES WITH READ LOCK;
mysql> SHOW MASTER STATUS;
@end example

Record the log name and the offset from the output of the @code{SHOW}
statement.

@item
On the slave, issue this command, where the replication coordinates that are
the arguments to the @code{MASTER_POS_WAIT()} function are the values recorded
in the previous step:

@example
mysql> SELECT MASTER_POS_WAIT('log_name', log_offset);
@end example

The @code{SELECT} statement will block until the slave reaches the specified
log file and offset. At that point, the slave will be in sync with the master
and the statement will return.

@item
On the master, issue the following statement to allow the master to begin
processing updates again:

@example
mysql> UNLOCK TABLES;
@end example

@end enumerate

@strong{Q}: What issues should I be aware of when setting up two-way
replication?

@strong{A}: MySQL replication currently does not support any
locking protocol between master and slave to guarantee the atomicity of
a distributed (cross-server) update. In other words, it is possible
for client A to make an update to  co-master 1, and in the meantime,
before it propagates to co-master 2, client B could make an update to
co-master 2 that will make the update of client A work differently than
it did on co-master 1. Thus, when the update of client A will make it
to co-master 2, it will produce  tables that are different than
what you have on co-master 1, even after all the updates from co-master
2 have also propagated. So you should not co-chain two servers in a
two-way replication relationship, unless you are sure that your updates
can safely happen in any order, or unless you take care of mis-ordered
updates somehow in the client code.

You must also realize that two-way replication actually does not improve
performance very much (if at all), as far as updates are concerned. Both
servers need to do the same amount of updates each, as you would have
one server do. The only difference is that there will be a little less
lock contention, because the updates originating on another server will
be serialized in one slave thread. Even so, this benefit might be
offset by network delays.

@cindex performance, improving
@cindex increasing, performance
@strong{Q}: How can I use replication to improve performance of my system?

@strong{A}: You should set up one server as the master and direct all
writes to it. Then configure as many slaves as you have the money and
rackspace for, and distribute the reads among the master and the slaves.
You can also start the slaves with @code{--skip-bdb},
@code{--low-priority-updates} and @code{--delay-key-write=ALL}
to get speed improvements for the slave.  In this case the slave will
use non-transactional @code{MyISAM} tables instead of @code{BDB} tables
to get more speed.

@strong{Q}: What should I do to prepare client code in my own applications
to use performance-enhancing replication?

@strong{A}:
If the part of your code that is responsible for database access has
been properly abstracted/modularised, converting it to run with a
replicated setup should be very smooth and easy. Just change the
implementation of your database access to send all writes the the master,
and to send reads to either the master or a slave.
If your code does not have this level of abstraction,
setting up a replicated system will give you the opportunity and motivation
to it clean up.
You should start by creating a wrapper library or module with the following
functions:

@itemize @bullet
@item
@code{safe_writer_connect()}
@item
@code{safe_reader_connect()}
@item
@code{safe_reader_query()}
@item
@code{safe_writer_query()}
@end itemize

@code{safe_} in each function name means that the function will take care
of handling all the error conditions.
You can use different names for the
functions. The important thing is to have a unified interface for connecting
for reads, connecting for writes, doing a read, and doing a write.

You should then convert your client code to use the wrapper library.
This may be a painful and scary process at first, but it will pay off in
the long run. All applications that use the approach just described will be
able to take advantage of a master/slave configuration, even one involving
multiple slaves.  The
code will be a lot easier to maintain, and adding troubleshooting
options will be trivial. You will just need to modify one or two
functions, for example, to log how long each query took, or which
query, among your many thousands, gave you an error.

If you have
written a lot of code already, you may want to automate the conversion
task by using the @code{replace} utility that comes with the
standard distribution of MySQL, or just write your own Perl script.
Hopefully, your code follows some recognizable pattern. If not, then
you are probably better off rewriting it anyway, or at least going
through and manually beating it into a pattern.


@strong{Q}: When and how much can MySQL replication improve the performance
of my system?

@strong{A}: MySQL replication is most beneficial for a system
with frequent reads and infrequent writes. In theory, by using a
single-master/multiple-slave setup, you can scale the system by adding more
slaves until you either run out of network bandwidth, or your update
load grows to the point that the master cannot handle it.

In order to determine how many slaves you can get before the added
benefits begin to level out, and how much you can improve performance
of your site, you need to know your query patterns, and empirically
 (by benchmarking) determine the relationship between the throughput
on reads (reads per second, or @code{max_reads}) and on writes
(@code{max_writes}) on a typical master and a typical slave. The
example here will show you a rather simplified calculation of what you
can get with replication for a hypothetical system.

Let's say that system load consists of 10% writes and 90% reads, and we
have determined @code{max_reads} to be 1200 - 2 * @code{max_writes}.
In other words, the system can do 1200 reads per second with no
writes, the average write is twice as slow as average read,
and the relationship is
linear. Let us suppose that the master and each slave have the same
capacity, and that we have 1 master and N slaves. Then we have for each
server (master or slave):

@code{reads = 1200 - 2 * writes} (from benchmarks)

@code{reads = 9* writes / (N + 1) } (reads split, but writes go
to all servers)

@code{9*writes/(N+1) + 2 * writes = 1200}

@code{writes = 1200/(2 + 9/(N+1)}

This analysis yields the following conclusions:

@itemize @bullet

@item
If N = 0 (which means we have no replication), our system can handle
1200/11, about 109 writes per second (which means we will have 9 times
as many reads due to the nature of our application).

@item
If N = 1, we can get up to 184 writes per second.

@item
If N = 8, we get up to 400.

@item
If N = 17, 480 writes.

@item
Eventually, as N approaches infinity (and our budget negative infinity),
we can get very close to 600 writes per second, increasing system
throughput about 5.5 times. However, with only 8 servers, we increased
it almost 4 times already.

@end itemize

Note that these computations assume infinite network bandwidth and
neglect several other factors that could turn out to be significant on
your system. In many cases, you may not be able to perform a computation
similar to the one above that will accurately predict what will happen
on your system if you add N replication slaves. However, answering the
following questions should help you decide whether and how much
replication will improve the performance of your system:

@itemize @bullet
@item
What is the read/write ratio on your system?
@item
How much more write load can one server handle if you reduce the reads?
@item
How many slaves do you have bandwidth available for on your network?
@end itemize

@strong{Q}: How can I use replication to provide redundancy/high
availability?

@strong{A}: With the currently available features, you would have to
set up a master and a slave (or several slaves), and write a script
that will monitor the
master to see whether it is up, and instruct your applications and
the slaves of the master change in case of failure. Some suggestions:

@itemize @bullet
@item
To tell a slave to change the master, use the @code{CHANGE MASTER TO} command.
@item
A good way to keep your applications informed as to the location of the
master is by having a dynamic DNS entry for the master.
With @code{bind} you can use @file{nsupdate} to dynamically update your DNS.
@item
You should run your slaves with the @code{--log-bin} option and without
@code{--log-slave-updates}. This way the slave will be ready to become a
master as soon as you issue @code{STOP SLAVE}; @code{RESET MASTER}, and
@code{CHANGE MASTER TO} on the other slaves.
For example, consider you have the following setup (``M'' means the
master, ``S'' the slaves, ``WC'' the clients that issue database
writes and reads; clients that issue only database reads are not
represented, because they need not switch):

@example
       WC   
        \  
         v
 WC----> M
       / | \  
      /  |  \     
     v   v   v
    S1   S2  S3  
@end example

S1 (like S2 and S3) is a slave running with @code{--log-bin} and
without @code{--log-slave-updates}. As the only writes executed on S1
are those replicated from M, the binary log on S1 is @strong{empty}
(remember, S1 runs without @code{--log-slave-updates}).
Then, for some reason, M becomes unavailable, and you want S1 to
become the new master (that is, direct all WC to S1, and make S2 and S3
replicate S1). 

Make sure that all slaves have processed any queries in their relay log.
On each slave, issue @code{STOP SLAVE IO_THREAD}, then check the output
of @code{SHOW PROCESSLIST} until you see @code{Has read all relay log}.
When this is true for all slaves, they can be reconfigured to the new setup.
Issue @code{STOP SLAVE} on all slaves, @code{RESET MASTER} on the slave
being promoted to master, and @code{CHANGE MASTER} on the other slaves.

No WC accesses M. Instruct all WC to direct their queries
to S1. From now on, all queries sent by WC to S1 are written to the binary log
of S1. The binary log of S1 contains exactly every writing query sent
to S1 since M died.
On S2 (and S3) do @code{STOP SLAVE}, @code{CHANGE MASTER TO
MASTER_HOST='S1'} (where @code{'S1'} is replaced by the real hostname of
S1). To @code{CHANGE MASTER}, add all information about how to connect
to S1 from S2 or S3 (user, password, port). In @code{CHANGE MASTER}, 
no need to specify
the name of S1's binary log or binary log position to read from: we
know it is the first binary log, from position 4, and these are the
defaults of @code{CHANGE MASTER}. Finally do @code{START SLAVE} on S2
and S3, and now you have this:

@example
       WC   
      /   
      |  
 WC   |  M(unavailable)
  \   | 
   \  | 
    v v
     S1<--S2  S3  
      ^       |
      +-------+
@end example

When M is up again, you just have to issue on it the same @code{CHANGE
MASTER} as the one issued on S2 and S3, so that M becomes a slave of
S1 and picks all the WC writes it has missed while it was down. Now to make
M a master again (because it is the most powerful machine, for example),
follow the preceding procedure as if S1 was unavailable and M was to be the
new master; then during the procedure don't forget to run @code{RESET
MASTER} on M before making S1, S2, S3 slaves of M, or they may pick
old WC writes from before M's unavailibility.

@end itemize

We are currently working on integrating an automatic master election
system into MySQL, but until it is ready, you will have to
create your own monitoring tools.

@node Replication Problems, Replication Bugs, Replication FAQ, Replication
@section Troubleshooting Replication

If you have followed the instructions, and your replication setup is not
working, first check the following:

@itemize @bullet
@item
@strong{Check the error log for messages}. Many users have lost time
by not doing this early enough.
@item
Is the master logging to the binary log? Check with @code{SHOW MASTER STATUS}.
If it is, @code{Position} will be non-zero. If not, verify that you have
given the master @code{log-bin} option and have set @code{server-id}.
@item
Is the slave running? Do @code{SHOW SLAVE STATUS} and check that the
@code{Slave_IO_Running} and @code{Slave_SQL_Running} values are both
@code{Yes}.
If not, verify slave options
@item
If the slave is running, did it establish a connection with the master? Do
@code{SHOW PROCESSLIST}, find the I/O and SQL threads
(@pxref{Replication Implementation Details} to see how they display),
and check their 
@code{State} column. If it says @code{Connecting to master}, verify the
privileges for the replication user on the master, master hostname, your
DNS setup, whether the master is actually running, whether it is reachable
from the slave.
@item
If the slave was running before but now has stopped, the reason usually is
that some query that succeeded on the master failed on the slave. This
should never happen if you have taken a proper snapshot of the master, and
never modify the data on the slave outside of the slave thread. If it does,
it is a bug; read below on how to report it.
@item
If a query on that succeeded on the master refuses to run on the slave, and
it does not feasible to do
a full database resync (that is, to delete the slave's database and copy a
new snapshot from the master),
try the following:
@itemize @minus
@item
First see if the slave's table was different from the
master's. Understand how it happened (it may be a bug: read the
Changelogs in the online MySQL manual as
@uref{http://www.mysql.com/documentation}
to check if this is a known bug and if it is fixed yet). 
Then make the slave's table
identical to the master's and run @code{START SLAVE}.
@item
If the above does not work or does not apply, try to understand if it would
be safe to make the update manually (if needed) and then ignore the next
query from the master.
@item
If you have decided you can skip the next query, issue the following
statements:

@example
mysql> SET GLOBAL SQL_SLAVE_SKIP_COUNTER = n;
mysql> START SLAVE;
@end example

The value of @code{n} should be 1 if the query does not use
@code{AUTO_INCREMENT} or @code{LAST_INSERT_ID()}. Otherwise, the value should
be 2.  The reason for using a value of 2 for
queries that use @code{AUTO_INCREMENT} or @code{LAST_INSERT_ID()}
is that they take two events in the binary log of the master.

@item
Make sure you are not running into an old bug by upgrading to the most recent
version.
@item
If you are sure the slave started out perfectly in sync with the master,
and no one has updated  the tables involved outside of slave thread,
report the bug.
@end itemize
@end itemize

@c TODO: make this a separate section: Reporting Replication Bugs

@node Replication Bugs,  , Replication Problems, Replication
@section Reporting Replication Bugs

When you have determined that there is no user error involved, and replication
still either does not work at all or is unstable, it is time to send
us a bug report. We need to get as much information as possible from you to be able
to track down the bug. Please do spend some time and effort preparing a good
bug report. 

If you have a repeatable way to demonstrate the bug, please
enter it into our bugs database
at @uref{http://bugs.mysql.com/}. If you have a phantom problem (one that
you cannot duplicate ``at will''), use the following procedure:

@enumerate
@item
Verify that no user error is involved. For example, if you update the
slave outside of the slave thread, the data will go out of sync, and you can
have unique key violations on updates. In this case, the slave thread will
stop and wait for you to clean up the tables manually to bring them in sync.
This is not a replication problem; it is a problem of outside interference
that causes replication to fail.
@item
Run the slave with the @code{--log-slave-updates} and @code{--log-bin}
options.
They will cause the slave to log the updates that it receives in its own
binlogs.
@item
Save all evidence before resetting the replication state. If we have no
information or only
sketchy information, it will take us longer to track down the problem. The
evidence you should collect is:
@itemize @bullet
@item
All binary logs from the master
@item
All binary logs from the slave
@item
The output of @code{SHOW MASTER STATUS} from the master at the time
you have discovered the problem
@item
The output of @code{SHOW SLAVE STATUS} from the master at the time
you have discovered the problem
@item
Error logs from the master and on the slave
@end itemize
@item
Use @code{mysqlbinlog} to examine the binary logs. The following should
be helpful
to find the trouble query, for example:
@example
mysqlbinlog -j pos_from_slave_status /path/to/log_from_slave_status | head
@end example
@end enumerate

Once you have collected the evidence for the phantom problem, try hard to
isolate it into a separate test case first. Then enter the problem into
our bugs database at @uref{http://bugs.mysql.com/} with as much
information as possible.


@node MySQL Optimisation, Client-Side Scripts, Replication, Top
@chapter MySQL Optimization

@menu
* Optimise Overview::           Optimization Overview
* Query Speed::                 Optimizing @code{SELECT} Statements and Other Queries
* Locking Issues::              Locking Issues
* Optimising Database Structure::  Optimizing Database Structure
* Optimising the Server::       Optimizing the MySQL Server
* Disk issues::                 Disk Issues
@end menu


Optimization is a complicated task because it ultimately requires
understanding of the whole system. While it may be possible to perform some
local optimizations with small knowledge of your system or application,
the more optimal you want your system to become the more you will have
to know about it.

This chapter tries to explain and give some examples of different
ways to optimize MySQL.  Remember, however, that there are
always some (increasingly harder) additional ways to make the system
even faster.


@node Optimise Overview, Query Speed, MySQL Optimisation, MySQL Optimisation
@section Optimization Overview

The most important factor in making a system fast is the basic
design. You also need to know what kinds of things your system will be
doing, and what your bottlenecks are.

The most common bottlenecks are:
@itemize @bullet
@item Disk seeks.
It takes time for the disk to find a piece of data. With modern disks in
1999, the mean time for this is usually lower than 10ms, so we can in
theory do about 100 seeks a second. This time improves slowly with new
disks and is very hard to optimize for a single table. The way to
optimize this is to spread the data on more than one disk.

@item Disk reading/writing.
When the disk is at the correct position we need to read the data. With
modern disks in 1999, one disk delivers something like 10-20 MB. This
is easier to optimize than seeks because you can read in parallel from
multiple disks.

@item CPU cycles.
When we have the data in main memory (or if it already were
there) we need to process it to get to our result. Having small
tables compared to the memory is the most common limiting
factor. But then, with small tables speed is usually not the problem.

@item Memory bandwidth.
When the CPU needs more data than can fit in the CPU cache the main
memory bandwidth becomes a bottleneck. This is an uncommon bottleneck
for most systems, but one should be aware of it.
@end itemize


@menu
* Design Limitations::          MySQL Design Limitations/Tradeoffs
* Portability::                 Portability
* Internal use::                What We Have Used MySQL For
* MySQL Benchmarks::            The MySQL Benchmark Suite
* Custom Benchmarks::           Using Your Own Benchmarks
@end menu


@node Design Limitations, Portability, Optimise Overview, Optimise Overview
@subsection MySQL Design Limitations/Tradeoffs

@cindex design, limitations
@cindex limitations, design

When using the MyISAM storage engine, MySQL uses extremely fast table
locking (multiple readers / single writers). The biggest problem with
this table type occurs when you have a mix of a steady stream of updates and
slow selects on the same table.  If this is a problem with some tables,
you can use another table type for these. @xref{Table types}.

MySQL can work with both transactional and non-transactional tables.
To be able to work smoothly with non-transactional tables (which can't
roll back if something goes wrong), MySQL has the following rules:

@cindex default values
@itemize @bullet
@item
All columns have default values.
@item
If you insert a 'wrong' value in a column like a @code{NULL} in a
@code{NOT NULL} column or a too big numerical value in a numerical
column, MySQL will instead of giving an error instead set the column to
the 'best possible value'.  For numerical values this is 0, the smallest
possible values or the largest possible value. For strings this is
either the empty string or the longest possible string that can be in
the column.
@item
All calculated expressions returns a value that can be used instead of
signaling an error condition. For example 1/0 returns @code{NULL}
@end itemize

For more information about this, see @xref{Constraints}.

The above means that one should not use MySQL to check fields content,
but one should do this in the application.

@node Portability, Internal use, Design Limitations, Optimise Overview
@subsection Portability

@cindex portability
@cindex crash-me program
@cindex programs, crash-me

Because all SQL servers implement different parts of SQL, it takes work to
write portable SQL applications. For very simple selects/inserts it is
very easy, but the more you need the harder it gets. If you want an
application that is fast with many databases it becomes even harder!

To make a complex application portable you need to choose a number of
SQL servers that it should work with.

You can use the MySQL @code{crash-me} program/web-page
@uref{http://www.mysql.com/information/crash-me.php} to find functions,
types, and limits you can use with a selection of database
servers. Crash-me now tests far from everything possible, but it
is still comprehensive with about 450 things tested.

For example, you shouldn't have column names longer than 18 characters
if you want to be able to use Informix or DB2.

Both the MySQL benchmarks and @code{crash-me} programs are very
database-independent.  By taking a look at how we have handled this, you
can get a feeling for what you have to do to write your application
database-independent.  The benchmarks themselves can be found in the
@file{sql-bench} directory in the MySQL source
distribution. They are written in Perl with DBI database interface
(which solves the access part of the problem).

See @uref{http://www.mysql.com/information/benchmarks.html} for the results
from this benchmark.

As you can see in these results, all databases have some weak points. That
is, they have different design compromises that lead to different
behavior.

If you strive for database independence, you need to get a good feeling
for each SQL server's bottlenecks. MySQL is very fast in
retrieving and updating records, but will have a problem in mixing slow
readers/writers on the same table. Oracle, on the other hand, has a big
problem when you try to access rows that you have recently updated
(until they are flushed to disk). Transaction databases in general are
not very good at generating summary tables from log tables, as in this
case row locking is almost useless.

To get your application @emph{really} database-independent, you need to define
an easy extendable interface through which you manipulate your data. As
C++ is available on most systems, it makes sense to use a C++ classes
interface to the databases.

If you use some specific feature for some database (like the
@code{REPLACE} command in MySQL), you should code a method for
the other SQL servers to implement the same feature (but slower).  With
MySQL you can use the @code{/*!  */} syntax to add
MySQL-specific keywords to a query.  The code inside
@code{/**/} will be treated as a comment (ignored) by most other SQL
servers.

If high performance is more important than exactness, as in some
web applications, it is possibile to create an application layer that
caches all results to give you even higher performance. By letting
old results 'expire' after a while, you can keep the cache reasonably
fresh.  This provides a method to handle high load spikes, in which case
you can dynamically increase the cache and set the expire timeout higher
until things get back to normal.

In this case the table creation information should contain information
of the initial size of the cache and how often the table should normally
be refreshed.


@node Internal use, MySQL Benchmarks, Portability, Optimise Overview
@subsection What We Have Used MySQL For

@cindex uses, of MySQL
@cindex customers, of MySQL

During MySQL initial development, the features of MySQL
were made to fit our largest customer. They handle data warehousing for a
couple of the biggest retailers in Sweden.

From all stores, we get weekly summaries of all bonus card transactions,
and we are expected to provide useful information for the store owners
to help them find how their advertisement campaigns are affecting their
customers.

The data is quite huge (about 7 million summary transactions per month),
and we have data for 4-10 years that we need to present to the users.
We got weekly requests from the customers that they want to get
'instant' access to new reports from this data.

We solved this by storing all information per month in compressed
'transaction' tables. We have a set of simple macros (script) that
generates summary tables grouped by different criteria (product group,
customer id, store ...) from the transactional tables.  The reports are
web pages that are dynamically generated by a small Perl script that
parses a web page, executes the SQL statements in it, and inserts the
results. We would have used PHP or mod_perl instead but they were
not available at that time.

For graphical data we wrote a simple tool in @code{C} that can produce
GIFs based on the result of an SQL query (with some processing of the
result). This is also dynamically executed from the Perl script that
parses the HTML files.

In most cases a new report can simply be done by copying an existing
script and modifying the SQL query in it.  In some cases, we will need to
add more fields to an existing summary table or generate a new one, but
this is also quite simple, as we keep all transactions tables on disk.
(Currently we have at least 50G of transactions tables and 200G of other
customer data.)

We also let our customers access the summary tables directly with ODBC
so that the advanced users can themselves experiment with the data.

We haven't had any problems handling this with quite modest Sun Ultra
SPARCstation (2x200 Mhz). We recently upgraded one of our servers to a 2
CPU 400 Mhz UltraSPARC, and we are now planning to start handling
transactions on the product level, which would mean a ten-fold increase
of data. We think we can keep up with this by just adding more disk to
our systems.

We are also experimenting with Intel-Linux to be able to get more CPU
power cheaper. Now that we have the binary portable database format (new
in Version 3.23), we will start to use this for some parts of the application.

Our initial feelings are that Linux will perform much better on
low-to-medium load and Solaris will perform better when you start to get a
high load because of extreme disk IO, but we don't yet have anything
conclusive about this. After some discussion with a Linux kernel
developer, this might be a side effect of Linux allocating so many resources
to the batch job that the interactive performance gets very low. This
makes the machine feel very slow and unresponsive while big batches are
going. Hopefully this will be better handled in future Linux Kernels.


@node MySQL Benchmarks, Custom Benchmarks, Internal use, Optimise Overview
@subsection The MySQL Benchmark Suite

@cindex benchmark suite
@cindex crash-me program

This section should contain a technical description of the MySQL
benchmark suite (and @code{crash-me}), but that description is not
written yet. Currently, you can get a good idea of the benchmark by
looking at the code and results in the @file{sql-bench} directory in any
MySQL source distribution.

This benchmark suite is meant to be a benchmark that will tell any user
what operations a given SQL implementation performs well or poorly.

Note that this benchmark is single-threaded, so it measures the minimum
time for the operations performed. We plan to add a lot of
multi-threaded tests to the benchmark suite in the future.

The following tables show some comparative benchmark results for several
database servers when accessed through ODBC on a Windows NT 4.0 machine.

@multitable @columnfractions .35 .10 .10
@item @strong{Reading 2000000 rows by index} @tab @strong{Seconds} @tab @strong{Seconds}
@item mysql             @tab 367          @tab 249
@item mysql_odbc        @tab 464          @tab
@item db2_odbc          @tab 1206         @tab
@item informix_odbc     @tab 121126       @tab
@item ms-sql_odbc       @tab 1634         @tab
@item oracle_odbc       @tab 20800        @tab
@item solid_odbc        @tab 877          @tab
@item sybase_odbc       @tab 17614        @tab
@end multitable

@multitable @columnfractions .35 .10 .10
@item @strong{Inserting 350768 rows} @tab @strong{Seconds} @tab @strong{Seconds}
@item mysql             @tab 381          @tab 206
@item mysql_odbc        @tab 619          @tab
@item db2_odbc          @tab 3460         @tab
@item informix_odbc     @tab 2692         @tab
@item ms-sql_odbc       @tab 4012         @tab
@item oracle_odbc       @tab 11291        @tab
@item solid_odbc        @tab 1801         @tab
@item sybase_odbc       @tab 4802         @tab
@end multitable

For the preceding tests, MySQL was run with an index cache size of 8M.

We have gathered some more benchmark results at
@uref{http://www.mysql.com/information/benchmarks.html}.

Note that Oracle is not included because they asked to be removed. All
Oracle benchmarks have to be passed by Oracle! We believe that makes
Oracle benchmarks @strong{very} biased because the above benchmarks are
supposed to show what a standard installation can do for a single
client.

To use the benchmark suite, the following requirements must be satisified:

@itemize @bullet
@item
The benchmark suite is provided with MySQL source distributions, so you must
have a source distribution.  You can either download a released distribution
from @uref{http://www.mysql.com/downloads/}, or use the current development
source tree (@pxref{Installing source tree}).

@item
The benchmark scripts are written in Perl and use the Perl DBI module to
access database servers, so DBI must be installed.  You will also need
the server-specific DBD drivers for each of the servers you want to test.
For example, to test MySQL, PostgreSQL, and DB2, the DBD::mysql, DBD::Pg,
and DBD::DB2 modules must be installed.

@c TODO xref to Perl install section

@end itemize

The benchmark suite is located in the @file{sql-bench} directory of MySQL
source distributions.
To run the benchmark tests, change location into that directory and execute
the @code{run-all-tests} script:

@example
shell> cd sql-bench
shell> perl run-all-tests --server=server_name
@end example

@code{server_name} is one of supported servers. You can get a list of
all options and supported servers by invoking @code{run-all-tests --help}.

@c TODO this needs a transition from run-all-tests to crash-me

@cindex crash-me
@code{crash-me} tries to determine what features a database supports and
what its capabilities and limitations are by actually running
queries. For example, it determines:

@itemize @bullet
@item
What column types are supported
@item
How many indexes are supported
@item
What functions are supported
@item
How big a query can be
@item
How big a @code{VARCHAR} column can be
@end itemize

We can find the result from @code{crash-me} on a lot of different databases at
@uref{http://www.mysql.com/information/crash-me.php}.


@node Custom Benchmarks,  , MySQL Benchmarks, Optimise Overview
@subsection Using Your Own Benchmarks

@cindex benchmarks
@cindex performance, benchmarks

You should definitely benchmark your application and database to find
out where the bottlenecks are.  By fixing it (or by replacing the
bottleneck with a ``dummy module'') you can then easily identify the next
bottleneck (and so on).  Even if the overall performance for your
application currently is acceptable, you should at least make a plan for each
bottleneck, and decide how to solve it if someday you really need the
extra performance.

For an example of portable benchmark programs, look at the MySQL
benchmark suite. @xref{MySQL Benchmarks, , MySQL Benchmarks}. You
can take any program from this suite and modify it for your needs. By doing
this, you can try different solutions to your problem and test which is really
fastest for you.

Another free benchmark suite is the @code{Open Source Database Benchmark},
available at @uref{http://osdb.sourceforge.net/}.

It is very common for a problem to occur only when the system is very
heavily loaded. We have had many customers who contact us when they
have a (tested) system in production and have encountered load problems. In
most cases, performance problems turn out to be due to issues of basic
database design (table scans are @strong{not good} at high load) or
problems with the operating system or libraries. Most of the time, these
problems would be a @strong{lot} easier to fix if the systems were not
already in production.

To avoid problems like this, you should put some effort into benchmarking
your whole application under the worst possible load!  You can use
Super Smack for this. It is available at
@uref{http://www.mysql.com/Downloads/super-smack/super-smack-1.0.tar.gz}.
As the name suggests, it can bring your system to its knees if you ask it,
so make sure to use it only on your development systems.


@node Query Speed, Locking Issues, Optimise Overview, MySQL Optimisation
@section Optimizing @code{SELECT} Statements and Other Queries

@cindex queries, speed of
@cindex permission checks, effect on speed
@cindex speed, of queries

First, one thing that affects all queries: The more complex permission
system setup you have, the more overhead you get.

If you do not have any @code{GRANT} statements done, MySQL will
optimize the permission checking somewhat. So if you have a very high
volume it may be worth the time to avoid grants. Otherwise, more
permission check results in a larger overhead.

If your problem is with some explicit MySQL function, you can
always time this in the MySQL client:

@example
mysql> SELECT BENCHMARK(1000000,1+1);
+------------------------+
| BENCHMARK(1000000,1+1) |
+------------------------+
|                      0 |
+------------------------+
1 row in set (0.32 sec)
@end example

The above shows that MySQL can execute 1,000,000 @code{+}
expressions in 0.32 seconds on a @code{PentiumII 400MHz}.

All MySQL functions should be very optimized, but there may be
some exceptions, and the @code{BENCHMARK(loop_count,expression)} is a
great tool to find out if this is a problem with your query.

@menu
* EXPLAIN::                     @code{EXPLAIN} Syntax (Get Information About a @code{SELECT})
* Estimating performance::      Estimating Query Performance
* SELECT speed::                Speed of @code{SELECT} Queries
* Where optimisations::         How MySQL Optimizes @code{WHERE} Clauses
* OR optimizations::            How MySQL Optimizes @code{OR} Clauses
* IS NULL optimisation::        How MySQL Optimizes @code{IS NULL}
* DISTINCT optimisation::       How MySQL Optimizes @code{DISTINCT}
* LEFT JOIN optimisation::      How MySQL Optimizes @code{LEFT JOIN} and @code{RIGHT JOIN}
* ORDER BY optimisation::       How MySQL Optimizes @code{ORDER BY}
* LIMIT optimisation::          How MySQL Optimizes @code{LIMIT}
* Insert speed::                Speed of @code{INSERT} Queries
* Update speed::                Speed of @code{UPDATE} Queries
* Delete speed::                Speed of @code{DELETE} Queries
* Tips::                        Other Optimization Tips
@end menu


@node EXPLAIN, Estimating performance, Query Speed, Query Speed
@subsection @code{EXPLAIN} Syntax (Get Information About a @code{SELECT})

@findex EXPLAIN
@findex SELECT, optimizing

@c help_category Data Manipulation

@c example_for_help_topic EXPLAIN
@example
    EXPLAIN tbl_name
or  EXPLAIN SELECT select_options
@end example

@c description_for_help_topic EXPLAIN  SELECT
@code{EXPLAIN tbl_name} is a synonym for @code{DESCRIBE tbl_name} or
@code{SHOW COLUMNS FROM tbl_name}.

When you precede a @code{SELECT} statement with the keyword @code{EXPLAIN},
MySQL explains how it would process the @code{SELECT}, providing
information about how tables are joined and in which order.

With the help of @code{EXPLAIN}, you can see when you must add indexes
to tables to get a faster @code{SELECT} that uses indexes to find the
records.
@c end_description_for_help_topic

You should frequently run @code{ANALYZE TABLE} to update table statistics
such as cardinality of keys which can affect the choices the optimizer
makes. @xref{ANALYZE TABLE}.

You can also see if the optimizer joins the tables in an optimal
order. To force the optimizer to use a specific join order for a
@code{SELECT} statement, add a @code{STRAIGHT_JOIN} clause.

For non-simple joins, @code{EXPLAIN} returns a row of information for each
table used in the @code{SELECT} statement. The tables are listed in the order
they would be read.  MySQL resolves all joins using a single-sweep
multi-join method. This means that MySQL reads a row from the first
table, then finds a matching row in the second table, then in the third table
and so on. When all tables are processed, it outputs the selected columns and
backtracks through the table list until a table is found for which there are
more matching rows. The next row is read from this table and the process
continues with the next table.

In MySQL version 4.1 the @code{EXPLAIN} output was changed to work better
with constructs like @code{UNION} statements, subqueries and derived tables. Most
notable is the addition of two new columns: @code{id} and @code{select_type}.

Output from @code{EXPLAIN} consists of the following columns:

@table @code
@item id
@code{SELECT} identifier, the sequential number of this @code{SELECT}
within the query.

@item select_type
Type of @code{SELECT} clause, which can be any of the following:

@table @code
@item SIMPLE
Simple @code{SELECT} (not using @code{UNION} or subqueries).

@item PRIMARY
Outermost @code{SELECT}.

@item UNION
Second and further @code{SELECT} statements in a @code{UNION}.

@item DEPENDENT UNION
Second and further @code{SELECT} statements in a @code{UNION}, dependent on outer
subquery.

@item SUBQUERY
First @code{SELECT} in subquery.

@item DEPENDENT SUBQUERY
First @code{SELECT}, dependent on outer subquery.

@item DERIVED
Derived table @code{SELECT} (subquery in @code{FROM} clause).
@end table

@item table
The table to which the row of output refers.

@item type
The join type. The different join types are listed here, ordered from
best to worst type:

@cindex system table
@cindex tables, system
@table @code
@item system
The table has only one row (= system table). This is a special case of
the @code{const} join type.

@cindex constant table
@cindex tables, constant
@item const
The table has at most one matching row, which will be read at the start
of the query. Because there is only one row, values from the column in
this row can be regarded as constants by the rest of the
optimizer. @code{const} tables are very fast as they are read only once!

@code{const} is used when you compare all parts of a
@code{PRIMARY}/@code{UNIQUE} key with constants:

@example
SELECT * FROM const_table WHERE primary_key=1;

SELECT * FROM const_table
WHERE primary_key_part1=1 AND primary_key_part2=2;
@end example

@item eq_ref
One row will be read from this table for each combination of rows from
the previous tables.  This is the best possible join type, other than the
@code{const} types.  It is used when all parts of an index are used by
the join and the index is @code{UNIQUE} or a @code{PRIMARY KEY}.

@code{eq_ref} can be used for indexed columns that is compared with the
@code{=} operator.  The compared item may be a constant or an expression
that uses columns from tables that are read before this table.

In the following examples, @code{ref_table} will be able to use @code{eq_ref}

@example
SELECT * FROM ref_table,other_table
WHERE ref_table.key_column=other_table.column;

SELECT * FROM ref_table,other_table
WHERE ref_table.key_column_part1=other_table.column
AND ref_table.key_column_part2=1;
@end example

@item ref
All rows with matching index values will be read from this table for each
combination of rows from the previous tables.  @code{ref} is used if the join
uses only a leftmost prefix of the key, or if the key is not @code{UNIQUE}
or a @code{PRIMARY KEY} (in other words, if the join cannot select a single
row based on the key value).  If the key that is used matches only a few rows,
this join type is good.

@code{ref} can be used for indexed columns that is compared with the @code{=}
operator.

In the following examples, @code{ref_table} will be able to use @code{ref}.

@example
SELECT * FROM ref_table WHERE key_column=expr;

SELECT * FROM ref_table,other_table
WHERE ref_table.key_column=other_table.column;

SELECT * FROM ref_table,other_table
WHERE ref_table.key_column_part1=other_table.column
AND ref_table.key_column_part2=1;
@end example

@item ref_or_null
Like @code{ref}, but with the addition that we will do an extra search for
rows with @code{NULL}.
@xref{IS NULL optimisation, , @code{IS NULL} optimisation}.

@example
SELECT * FROM ref_table WHERE key_column=expr OR key_column IS NULL; 
@end example

This join type optimization is new for MySQL 4.1.1 and is mostly used when
resolving subqueries.

@item unique_subquery
This type replaces @code{ref} for some @code{IN} subqueries of the following
form:
@example
value IN (SELECT primary_key FROM single_table WHERE some_exp) 
@end example
@code{unique_subquery} is just an index lookup function that replaces the
subquery completely for better efficiency.

@item index_subquery
Like @code{unique_subquery}, this type replaces @code{IN} subqueries, but
it works for non-unique indexes:
@example
value IN (SELECT key_field FROM single_table WHERE some_exp) 
@end example

@item range
Only rows that are in a given range will be retrieved, using an index to
select the rows.  The @code{key} column indicates which index is used.
The @code{key_len} contains the longest key part that was used.
The @code{ref} column will be @code{NULL} for this type.

@code{range} can be used for when an key column is compared to a
constant with @code{=}, @code{<>}, @code{>}, @code{>=}, @code{<},
@code{<=}, @code{IS NULL}, @code{<=>}, @code{BETWEEN} and @code{IN}.

@example
SELECT * FROM range_table WHERE key_column = 10;

SELECT * FROM range_table WHERE key_column BETWEEN 10 and 20;

SELECT * FROM range_table WHERE key_column IN (10,20,30);

SELECT * FROM range_table WHERE key_part1= 10 and key_part2 IN (10,20,30);
@end example

@item index
This is the same as @code{ALL}, except that only the index tree is
scanned.  This is usually faster than @code{ALL}, as the index file is usually
smaller than the datafile.

This can be used when the query only uses columns that are part of one index.

@item ALL
A full table scan will be done for each combination of rows from the
previous tables.  This is normally not good if the table is the first
table not marked @code{const}, and usually @strong{very} bad in all other
cases. You normally can avoid @code{ALL} by adding more indexes, so that
the row can be retrieved based on constant values or column values from
earlier tables.
@end table

@item possible_keys
The @code{possible_keys} column indicates which indexes MySQL
could use to find the rows in this table. Note that this column is
totally independent of the order of the tables. That means that some of
the keys in @code{possible_keys} may not be usable in practice with the
generated table order.

If this column is @code{NULL}, there are no relevant indexes. In this case,
you may be able to improve the performance of your query by examining
the @code{WHERE} clause to see whether it refers to some column or columns
that would be suitable for indexing.  If so, create an appropriate index
and check the query with @code{EXPLAIN} again.
@xref{ALTER TABLE,  , @code{ALTER TABLE}}.

To see what indexes a table has, use @code{SHOW INDEX FROM tbl_name}.

@item key
The @code{key} column indicates the key (index) that MySQL actually
decided to use. The key is @code{NULL} if no index was chosen. To force
MySQL to use an key listed in the @code{possible_keys} column, use
@code{USE KEY/IGNORE KEY} in your query.
@xref{SELECT,  , @code{SELECT}}.

Also, running @code{myisamchk --analyze} (@pxref{myisamchk syntax, ,
@code{myismchk} syntax}) or @code{ANALYZE TABLE}
(@pxref{ANALYZE TABLE, , @code{ANALYZE TABLE}}) on the table will help the
optimizer choose better indexes.

@item key_len
The @code{key_len} column indicates the length of the key that
MySQL decided to use.  The length is @code{NULL} if the
@code{key} is @code{NULL}. Note that this tells us how many parts of a
multi-part key MySQL will actually use.

@item ref
The @code{ref} column shows which columns or constants are used with the
@code{key} to select rows from the table.

@c TODO: we don't seem to explain what ref values of "const", NULL, or
@c tbl_name.col_name mean.

@item rows
The @code{rows} column indicates the number of rows MySQL
believes it must examine to execute the query.

@item Extra
This column contains additional information of how MySQL will
resolve the query. Here is an explanation of the different text
strings that can be found in this column:

@table @code
@item Distinct
MySQL will not continue searching for more rows for the current row
combination after it has found the first matching row.

@item Not exists
MySQL was able to do a @code{LEFT JOIN} optimization on the
query and will not examine more rows in this table for the previous row
combination after it finds one row that matches the @code{LEFT JOIN} criteria.

Here is an example for this:

@example
SELECT * FROM t1 LEFT JOIN t2 ON t1.id=t2.id
WHERE t2.id IS NULL;
@end example

Assume that @code{t2.id} is defined with @code{NOT NULL}.  In this case
MySQL will scan @code{t1} and look up the rows in @code{t2}
through @code{t1.id}. If MySQL finds a matching row in
@code{t2}, it knows that @code{t2.id} can never be @code{NULL}, and will
not scan through the rest of the rows in @code{t2} that has the same
@code{id}.  In other words, for each row in @code{t1}, MySQL
only needs to do a single lookup in @code{t2}, independent of how many
matching rows there are in @code{t2}.

@item @code{range checked for each record (index map: #)}
MySQL didn't find a real good index to use. It will, instead, for
each row combination in the preceding tables, do a check on which index to
use (if any), and use this index to retrieve the rows from the table.  This
isn't very fast but is faster than having to do a join without
an index.

@item Using filesort
MySQL will need to do an extra pass to find out how to retrieve
the rows in sorted order.  The sort is done by going through all rows
according to the @code{join type} and storing the sort key + pointer to
the row for all rows that match the @code{WHERE}. Then the keys are
sorted. Finally the rows are retrieved in sorted order.

@item Using index
The column information is retrieved from the table using only
information in the index tree without having to do an additional seek to
read the actual row.  This can be done when all the used columns for
the table are part of the same index.

@item Using temporary
To resolve the query MySQL will need to create a
temporary table to hold the result.  This typically happens if you do an
@code{ORDER BY} on a different column set than you did a @code{GROUP
BY} on.

@item Using where
A @code{WHERE} clause will be used to restrict which rows will be
matched against the next table or sent to the client.  If you don't have
this information and the table is of type @code{ALL} or @code{index},
you may have something wrong in your query (if you don't intend to
fetch/examine all rows from the table).
@end table

If you want to get your queries as fast as possible, you should look out for
@code{Using filesort} and @code{Using temporary}.
@end table

You can get a good indication of how good a join is by multiplying all values
in the @code{rows} column of the @code{EXPLAIN} output. This should tell you
roughly how many rows MySQL must examine to execute the query. This
number is also used when you restrict queries with the @code{max_join_size}
variable.
@xref{Server parameters}.

The following example shows how a @code{JOIN} can be optimized progressively
using the information provided by @code{EXPLAIN}.

Suppose you have the @code{SELECT} statement shown here, that you examine
using @code{EXPLAIN}:

@example
EXPLAIN SELECT tt.TicketNumber, tt.TimeIn,
            tt.ProjectReference, tt.EstimatedShipDate,
            tt.ActualShipDate, tt.ClientID,
            tt.ServiceCodes, tt.RepetitiveID,
            tt.CurrentProcess, tt.CurrentDPPerson,
            tt.RecordVolume, tt.DPPrinted, et.COUNTRY,
            et_1.COUNTRY, do.CUSTNAME
        FROM tt, et, et AS et_1, do
        WHERE tt.SubmitTime IS NULL
            AND tt.ActualPC = et.EMPLOYID
            AND tt.AssignedPC = et_1.EMPLOYID
            AND tt.ClientID = do.CUSTNMBR;
@end example

For this example, assume that:

@itemize @bullet
@item
The columns being compared have been declared as follows:

@multitable @columnfractions .10 .15 .15
@item @strong{Table} @tab @strong{Column} @tab @strong{Column type}
@item @code{tt}      @tab @code{ActualPC}      @tab @code{CHAR(10)}
@item @code{tt}      @tab @code{AssignedPC}    @tab @code{CHAR(10)}
@item @code{tt}      @tab @code{ClientID}      @tab @code{CHAR(10)}
@item @code{et}      @tab @code{EMPLOYID}      @tab @code{CHAR(15)}
@item @code{do}      @tab @code{CUSTNMBR}      @tab @code{CHAR(15)}
@end multitable

@item
The tables have the indexes shown here:

@multitable @columnfractions .10 .30
@item @strong{Table} @tab @strong{Index}
@item @code{tt}      @tab @code{ActualPC}
@item @code{tt}      @tab @code{AssignedPC}
@item @code{tt}      @tab @code{ClientID}
@item @code{et}      @tab @code{EMPLOYID} (primary key)
@item @code{do}      @tab @code{CUSTNMBR} (primary key)
@end multitable

@item
The @code{tt.ActualPC} values aren't evenly distributed.
@end itemize

Initially, before any optimizations have been performed, the @code{EXPLAIN}
statement produces the following information:

@example
table type possible_keys                key  key_len ref  rows  Extra
et    ALL  PRIMARY                      NULL NULL    NULL 74
do    ALL  PRIMARY                      NULL NULL    NULL 2135
et_1  ALL  PRIMARY                      NULL NULL    NULL 74
tt    ALL  AssignedPC,ClientID,ActualPC NULL NULL    NULL 3872
      range checked for each record (key map: 35)
@end example

Because @code{type} is @code{ALL} for each table, this output indicates that
MySQL is generating a Cartesian product of all the tables!  This will take
quite a long time, as the product of the number of rows in each table must be
examined!  For the case at hand, this is @code{74 * 2135 * 74 * 3872 =
45,268,558,720} rows.  If the tables were bigger, you can only imagine how
long it would take.

One problem here is that MySQL can't (yet) use indexes on columns
efficiently if they are declared differently.  In this context,
@code{VARCHAR} and @code{CHAR} are the same unless they are declared as
different lengths. Because @code{tt.ActualPC} is declared as @code{CHAR(10)}
and @code{et.EMPLOYID} is declared as @code{CHAR(15)}, there is a length
mismatch.

To fix this disparity between column lengths, use @code{ALTER TABLE} to
lengthen @code{ActualPC} from 10 characters to 15 characters:

@example
mysql> ALTER TABLE tt MODIFY ActualPC VARCHAR(15);
@end example

Now @code{tt.ActualPC} and @code{et.EMPLOYID} are both @code{VARCHAR(15)}.
Executing the @code{EXPLAIN} statement again produces this result:

@example
table type   possible_keys   key     key_len ref         rows    Extra
tt    ALL    AssignedPC,ClientID,ActualPC NULL NULL NULL 3872    Using where
do    ALL    PRIMARY         NULL    NULL    NULL        2135
      range checked for each record (key map: 1)
et_1  ALL    PRIMARY         NULL    NULL    NULL        74
      range checked for each record (key map: 1)
et    eq_ref PRIMARY         PRIMARY 15      tt.ActualPC 1
@end example

This is not perfect, but is much better (the product of the @code{rows}
values is now less by a factor of 74). This version is executed in a couple
of seconds.

A second alteration can be made to eliminate the column length mismatches
for the @code{tt.AssignedPC = et_1.EMPLOYID} and @code{tt.ClientID =
do.CUSTNMBR} comparisons:

@example
mysql> ALTER TABLE tt MODIFY AssignedPC VARCHAR(15),
    ->                MODIFY ClientID   VARCHAR(15);
@end example

Now @code{EXPLAIN} produces the output shown here:

@example
table type   possible_keys   key      key_len ref           rows Extra
et    ALL    PRIMARY         NULL     NULL    NULL          74
tt    ref    AssignedPC,     ActualPC 15      et.EMPLOYID   52   Using where
             ClientID,
             ActualPC
et_1  eq_ref PRIMARY         PRIMARY  15      tt.AssignedPC 1
do    eq_ref PRIMARY         PRIMARY  15      tt.ClientID   1
@end example

This is almost as good as it can get.

The remaining problem is that, by default, MySQL assumes that values
in the @code{tt.ActualPC} column are evenly distributed, and that isn't the
case for the @code{tt} table.  Fortunately, it is easy to tell MySQL
about this:

@example
shell> myisamchk --analyze PATH_TO_MYSQL_DATABASE/tt
shell> mysqladmin refresh
@end example

Now the join is perfect, and @code{EXPLAIN} produces this result:

@example
table type   possible_keys key     key_len ref           rows Extra
tt    ALL    AssignedPC    NULL    NULL    NULL          3872 Using where
             ClientID,
             ActualPC
et    eq_ref PRIMARY       PRIMARY 15      tt.ActualPC   1
et_1  eq_ref PRIMARY       PRIMARY 15      tt.AssignedPC 1
do    eq_ref PRIMARY       PRIMARY 15      tt.ClientID   1
@end example

Note that the @code{rows} column in the output from @code{EXPLAIN} is an
educated guess from the MySQL join optimizer. To optimize a
query, you should check if the numbers are even close to the truth.  If not,
you may get better performance by using @code{STRAIGHT_JOIN} in your
@code{SELECT} statement and trying to list the tables in a different order in
the @code{FROM} clause.


@node Estimating performance, SELECT speed, EXPLAIN, Query Speed
@subsection Estimating Query Performance

@cindex estimating, query performance
@cindex queries, estimating performance
@cindex performance, estimating

In most cases you can estimate the performance by counting disk seeks.
For small tables, you can usually find the row in 1 disk seek (as the
index is probably cached).  For bigger tables, you can estimate that
(using B++ tree indexes) you will need: @code{log(row_count) /
log(index_block_length / 3 * 2 / (index_length + data_pointer_length)) +
1} seeks to find a row.

In MySQL an index block is usually 1024 bytes and the data
pointer is usually 4 bytes. A 500,000 row table with an
index length of 3 (medium integer) gives you:
@code{log(500,000)/log(1024/3*2/(3+4)) + 1} = 4 seeks.

As the above index would require about 500,000 * 7 * 3/2 = 5.2M,
(assuming that the index buffers are filled to 2/3, which is typical)
you will probably have much of the index in memory and you will probably
only need 1-2 calls to read data from the OS to find the row.

For writes, however, you will need 4 seek requests (as above) to find
where to place the new index and normally 2 seeks to update the index
and write the row.

Note that the above doesn't mean that your application will slowly
degenerate by log N!  As long as everything is cached by the OS or SQL
server, things will go only marginally slower while the table gets
bigger. After the data gets too big to be cached, things will start to
go much slower until your applications is only bound by disk-seeks
(which increase by log N). To avoid this, increase the index cache as
the data grows. @xref{Server parameters}.


@node SELECT speed, Where optimisations, Estimating performance, Query Speed
@subsection Speed of @code{SELECT} Queries

@findex SELECT speed

@cindex speed, of queries

In general, when you want to make a slow @code{SELECT ... WHERE} faster, the
first thing to check is whether you can add an index. @xref{MySQL
indexes, , MySQL indexes}. All references between different tables
should usually be done with indexes. You can use the @code{EXPLAIN} command
to determine which indexes are used for a @code{SELECT}.
@xref{EXPLAIN, , @code{EXPLAIN}}.

Some general tips:

@itemize @bullet
@item
To help MySQL optimize queries better, run @code{myisamchk
--analyze} on a table after it has been loaded with relevant data. This
updates a value for each index part that indicates the average number of
rows that have the same value.  (For unique indexes, this is always 1.)
MySQL will use this to decide which index to
choose when you connect two tables with 'a non-constant expression'.
You can check the result from the @code{analyze} run by doing @code{SHOW
INDEX FROM table_name} and examining the @code{Cardinality} column.

@item
To sort an index and data according to an index, use @code{myisamchk
--sort-index --sort-records=1} (if you want to sort on index 1). If you
have a unique index from which you want to read all records in order
according to that index, this is a good way to make that faster.  Note,
however, that this sorting isn't written optimally and will take a long
time for a large table!
@end itemize


@node Where optimisations, OR optimizations, SELECT speed, Query Speed
@subsection How MySQL Optimizes @code{WHERE} Clauses

@findex WHERE

@cindex optimizations

The @code{WHERE} optimizations are put in the @code{SELECT} part here because
they are mostly used with @code{SELECT}, but the same optimizations apply for
@code{WHERE} in @code{DELETE} and @code{UPDATE} statements.

Also note that this section is incomplete. MySQL does many
optimizations, and we have not had time to document them all.

Some of the optimizations performed by MySQL are listed here:

@itemize @bullet
@item
Removal of unnecessary parentheses:
@example
   ((a AND b) AND c OR (((a AND b) AND (c AND d))))
-> (a AND b AND c) OR (a AND b AND c AND d)
@end example
@item
Constant folding:
@example
   (a<b AND b=c) AND a=5
-> b>5 AND b=c AND a=5
@end example
@item
Constant condition removal (needed because of constant folding):
@example
   (B>=5 AND B=5) OR (B=6 AND 5=5) OR (B=7 AND 5=6)
-> B=5 OR B=6
@end example
@item
Constant expressions used by indexes are evaluated only once.
@item
@code{COUNT(*)} on a single table without a @code{WHERE} is retrieved
directly from the table information for @code{MyISAM} and @code{HEAP} tables.
This is also done for any @code{NOT NULL} expression when used with only one
table.
@item
Early detection of invalid constant expressions. MySQL quickly
detects that some @code{SELECT} statements are impossible and returns no rows.
@item
@code{HAVING} is merged with @code{WHERE} if you don't use @code{GROUP BY}
or group functions (@code{COUNT()}, @code{MIN()}...).
@item
For each sub-join, a simpler @code{WHERE} is constructed to get a fast
@code{WHERE} evaluation for each sub-join and also to skip records as
soon as possible.
@cindex constant table
@cindex tables, constant
@item
All constant tables are read first, before any other tables in the query.
A constant table is:
@itemize @minus
@item
An empty table or a table with 1 row.
@item
A table that is used with a @code{WHERE} clause on a @code{UNIQUE}
index, or a @code{PRIMARY KEY}, where all index parts are used with constant
expressions and the index parts are defined as @code{NOT NULL}.
@end itemize
All the following tables are used as constant tables:
@example
mysql> SELECT * FROM t WHERE primary_key=1;
mysql> SELECT * FROM t1,t2
    ->          WHERE t1.primary_key=1 AND t2.primary_key=t1.id;
@end example

@item
The best join combination to join the tables is found by trying all
possibilities. If all columns in @code{ORDER BY} and in @code{GROUP
BY} come from the same table, then this table is preferred first when
joining.
@item
If there is an @code{ORDER BY} clause and a different @code{GROUP BY}
clause, or if the @code{ORDER BY} or @code{GROUP BY} contains columns
from tables other than the first table in the join queue, a temporary
table is created.
@item
If you use @code{SQL_SMALL_RESULT}, MySQL will use an in-memory
temporary table.
@item
Each table index is queried, and the best index that spans fewer than 30% of
the rows is used. If no such index can be found, a quick table scan is used.
@item
In some cases, MySQL can read rows from the index without even
consulting the datafile.  If all columns used from the index are numeric,
only the index tree is used to resolve the query.
@item
Before each record is output, those that do not match the @code{HAVING} clause
are skipped.
@end itemize

Some examples of queries that are very fast:

@example
mysql> SELECT COUNT(*) FROM tbl_name;
mysql> SELECT MIN(key_part1),MAX(key_part1) FROM tbl_name;
mysql> SELECT MAX(key_part2) FROM tbl_name
    ->        WHERE key_part_1=constant;
mysql> SELECT ... FROM tbl_name
    ->        ORDER BY key_part1,key_part2,... LIMIT 10;
mysql> SELECT ... FROM tbl_name
    ->        ORDER BY key_part1 DESC,key_part2 DESC,... LIMIT 10;
@end example

The following queries are resolved using only the index tree (assuming
the indexed columns are numeric):

@example
mysql> SELECT key_part1,key_part2 FROM tbl_name WHERE key_part1=val;
mysql> SELECT COUNT(*) FROM tbl_name
    ->        WHERE key_part1=val1 AND key_part2=val2;
mysql> SELECT key_part2 FROM tbl_name GROUP BY key_part1;
@end example

The following queries use indexing to retrieve the rows in sorted
order without a separate sorting pass:

@example
mysql> SELECT ... FROM tbl_name
    ->            ORDER BY key_part1,key_part2,... ;
mysql> SELECT ... FROM tbl_name
    ->            ORDER BY key_part1 DESC,key_part2 DESC,... ;
@end example


@node OR optimizations, IS NULL optimisation, Where optimisations, Query Speed
@subsection How MySQL Optimizes @code{OR} Clauses

@findex OR
@cindex OR @code{Merge Index} optimization
@cindex optimizations

The @code{Merge Index} method is used to retrieve rows with several
@code{ref}, @code{ref_or_null} or @code{range} scans and merge the
results into one.
This method is employed when the table condition is a disjunction of
conditions for which @code{ref}, @code{ref_or_null}, or @code{range}
could be used with different keys.
The @code{key} column contains a list of used indexes. @code{key_len}
contains a list of the longest key parts of the used indexes.

Example:

@example
SELECT * FROM table WHERE key1column = 10 OR key2column = 20;

SELECT * FROM table WHERE 
  (key1column = 10 OR key2column = 20) AND nonkeycolumn=30;

SELECT * FROM t1,t2 WHERE 
  (t1.key1 IN (1,2) OR t1.key2 LIKE 'value%') AND t2.key1=t1.somefield

SELECT * FROM t1,t2 WHERE 
  t1.key1=1 AND (t2.key1=t1.somefield OR t2.key2=t1.somefield2)
@end example

This ``join'' type optimization is new in MySQL 5.0.0, and represents
a significant change in behaviour with regard to indexes since the
@emph{old} rule was that the server is only ever able to use at most
one index for each referenced table.


@node IS NULL optimisation, DISTINCT optimisation, OR optimizations, Query Speed
@subsection How MySQL Optimizes @code{IS NULL}

@findex IS NULL
@findex ref_or_null

MySQL can do the same optimization on @code{column IS NULL} as it can do
with @code{column = constant_value}.  For example, MySQL can use
indexes and ranges to search for @code{NULL} with @code{IS NULL}.

@example
SELECT * FROM table_name WHERE key_col IS NULL;

SELECT * FROM table_name WHERE key_col <=> NULL;

SELECT * FROM table_name WHERE key_col=# OR key_col=# OR key_col IS NULL
@end example

If you use @code{column_name IS NULL} on a @code{NOT NULL} in a @code{WHERE}
clause on table that is not used @code{OUTER JOIN} that expression will be
optimized away.

MySQL 4.1.1 can additionally optimize the combination @code{column =
expr AND column IS NULL}, an form that is common in resolved sub
queries.  @code{EXPLAIN} will show @code{ref_or_null} when this
optimization is used.

This optimization can handle one @code{IS NULL} for any key part.

Some examples of queries that are optimized (assuming key on t2 (a,b)):

@example
SELECT * FROM t1 WHERE t1.a=expr OR t1.a IS NULL;

SELECT * FROM t1,t2 WHERE t1.a=t2.a OR t2.a IS NULL;

SELECT * FROM t1,t2 WHERE (t1.a=t2.a OR t2.a IS NULL) AND t2.b=t1.b;

SELECT * FROM t1,t2 WHERE t1.a=t2.a AND (t2.b=t1.b OR t2.b IS NULL);

SELECT * FROM t1,t2 WHERE (t1.a=t2.a AND t2.a IS NULL AND ...) OR (t1.a=t2.a AND t2.a IS NULL AND ...);
@end example

@code{ref_or_null} works by first doing a read on the reference key
and after that a separate search after rows with NULL key.

Note that the optimization can only handle one @code{IS NULL} level.

@example
SELECT * FROM t1,t2 where (t1.a=t2.a AND t2.a IS NULL) OR (t1.b=t2.b AND t2.b IS NULL);
@end example

Int the above case MySQL will only use key lookups on the part
@code{(t1.a=t2.a AND t2.a IS NULL)} and not be able to use the key part on
@code{b}.

@node DISTINCT optimisation, LEFT JOIN optimisation, IS NULL optimisation, Query Speed
@subsection How MySQL Optimizes @code{DISTINCT}

@findex DISTINCT

@cindex optimizing, DISTINCT

@code{DISTINCT} combined with @code{ORDER BY} will in many cases
need a temporary table.

Note that as @code{DISTINCT} may use @code{GROUP BY}, you should be aware of
how MySQL works with in fields in @code{ORDER BY} or @code{HAVING} that
are not part of the selected fields. @xref{GROUP-BY-hidden-fields}.

When combining @code{LIMIT row_count} with @code{DISTINCT}, MySQL will stop
as soon as it finds @code{row_count} unique rows.

If you don't use columns from all used tables, MySQL will stop
the scanning of the not used tables as soon as it has found the first match.

@example
SELECT DISTINCT t1.a FROM t1,t2 where t1.a=t2.a;
@end example

In this case, assuming @code{t1} is used before @code{t2} (check with
@code{EXPLAIN}), then MySQL will stop reading from @code{t2} (for that
particular row in @code{t1}) when the first row in @code{t2} is found.


@node LEFT JOIN optimisation, ORDER BY optimisation, DISTINCT optimisation, Query Speed
@subsection How MySQL Optimizes @code{LEFT JOIN} and @code{RIGHT JOIN}

@findex LEFT JOIN

@cindex optimizing, LEFT JOIN

@code{A LEFT JOIN B join_condition} in MySQL is implemented as follows:

@itemize @bullet
@item
The table @code{B} is set to be dependent on table @code{A} and all tables
that @code{A} is dependent on.

@item
The table @code{A} is set to be dependent on all tables (except @code{B})
that are used in the @code{LEFT JOIN} condition.

@item
The @code{LEFT JOIN} condition is used to decide how we should retrieve rows
from table B. (In other words, any condition in the @code{WHERE} clause
is not used).

@item
All standard join optimizations are done, with the exception that a table is
always read after all tables it is dependent on.  If there is a circular
dependence then MySQL will issue an error.

@item
All standard @code{WHERE} optimizations are done.

@item
If there is a row in @code{A} that matches the @code{WHERE} clause, but there
wasn't any row in @code{B} that matched the @code{ON} condition,
then an extra @code{B} row is generated with all columns set to @code{NULL}.

@item
If you use @code{LEFT JOIN} to find rows that don't exist in some
table and you have the following test: @code{column_name IS NULL} in the
@code{WHERE} part, where column_name is a column that is declared as
@code{NOT NULL}, then MySQL will stop searching after more rows
(for a particular key combination) after it has found one row that
matches the @code{LEFT JOIN} condition.
@end itemize

@code{RIGHT JOIN} is implemented analogously to @code{LEFT JOIN}.

The table read order forced by @code{LEFT JOIN} and @code{STRAIGHT JOIN}
will help the join optimizer (which calculates in which order tables
should be joined) to do its work much more quickly, as there are fewer
table permutations to check.

Note that the above means that if you do a query of type:

@example
SELECT * FROM a,b LEFT JOIN c ON (c.key=a.key) LEFT JOIN d (d.key=a.key)
         WHERE b.key=d.key
@end example

MySQL will do a full scan on @code{b} as the @code{LEFT JOIN} will force
it to be read before @code{d}.

The fix in this case is to change the query to:

@example
SELECT * FROM b,a LEFT JOIN c ON (c.key=a.key) LEFT JOIN d (d.key=a.key)
         WHERE b.key=d.key
@end example

Starting from 4.0.14, MySQL does the following @code{LEFT JOIN} optimization:

If the @code{WHERE} condition is always be false for the generated
@code{NULL} row, the @code{LEFT JOIN} is changed to a normal join.

For example, in the following query the @code{WHERE} clause would be
false if t2.column would be @code{NULL} so it's safe to convert to
a normal join.

@example
SELECT * FROM t1 LEFT t2 ON (column) WHERE t2.column2 =5;
->
SELECT * FROM t1,t2 WHERE t2.column2=5 AND t1.column=t2.column;
@end example

This can be made faster as MySQL can now use table @code{t2} before
table @code{t1} if this would result in a better query plan.  To force a
specific table order, use @code{STRAIGHT JOIN}.

@node ORDER BY optimisation, LIMIT optimisation, LEFT JOIN optimisation, Query Speed
@subsection How MySQL Optimizes @code{ORDER BY}

In some cases MySQL can uses index to satisfy an @code{ORDER BY} or
@code{GROUP BY} request without doing any extra sorting.

The index can also be used even if the @code{ORDER BY} doesn't match the
index exactly, as long as all the unused index parts and all the extra
are @code{ORDER BY} columns are constants in the @code{WHERE}
clause. The following queries will use the index to resolve the
@code{ORDER BY} / @code{GROUP BY} part:

@example
SELECT * FROM t1 ORDER BY key_part1,key_part2,...
SELECT * FROM t1 WHERE key_part1=constant ORDER BY key_part2
SELECT * FROM t1 WHERE key_part1=constant GROUP BY key_part2
SELECT * FROM t1 ORDER BY key_part1 DESC,key_part2 DESC
SELECT * FROM t1 WHERE key_part1=1 ORDER BY key_part1 DESC,key_part2 DESC
@end example

Some cases where MySQL can @strong{not} use indexes to resolve the @code{ORDER
BY}: (Note that MySQL will still use indexes to find the rows that
matches the @code{WHERE} clause):

@itemize @bullet
@item
You are doing an @code{ORDER BY} on different keys:

@code{SELECT * FROM t1 ORDER BY key1,key2}
@item
You are doing an @code{ORDER BY} using non-consecutive key parts.

@code{SELECT * FROM t1 WHERE key2=constant ORDER BY key_part2}

@item
You are mixing @code{ASC} and @code{DESC}.

@code{SELECT * FROM t1 ORDER BY key_part1 DESC,key_part2 ASC}

@item
The key used to fetch the rows are not the same one that is used to
do the @code{ORDER BY}:

@code{SELECT * FROM t1 WHERE key2=constant ORDER BY key1}

@item
You are joining many tables and the columns you are doing an @code{ORDER
BY} on are not all from the first not-@code{const} table that is used to
retrieve rows (This is the first table in the @code{EXPLAIN} output which
doesn't use a @code{const} row fetch method).

@item
You have different @code{ORDER BY} and @code{GROUP BY} expressions.

@item
The used table index is an index type that doesn't store rows in order.
(Like the @code{HASH} index in @code{HEAP} tables).
@end itemize

In the cases where MySQL have to sort the result, it uses the following
algorithm:

@itemize @bullet
@item
Read all rows according to key or by table scanning.
Rows that don't match the @code{WHERE} clause are skipped.
@item
Store the sort-key in a buffer (of size @code{sort_buffer}).
@item
When the buffer gets full, run a qsort on it and store the result
in a temporary file.  Save a pointer to the sorted block.
(In the case where all rows fits into the sort buffer, no temporary
file is created)
@item
Repeat the above until all rows have been read.
@item
Do a multi-merge of up to @code{MERGEBUFF} (7) regions to one block in
another temporary file.  Repeat until all blocks from the first file
are in the second file.
@item
Repeat the following until there is less than @code{MERGEBUFF2} (15)
blocks left.
@item
On the last multi-merge, only the pointer to the row (last part of
the sort-key) is written to a result file.
@item
Now the code in @file{sql/records.cc} will be used to read through them
in sorted order by using the row pointers in the result file.  To
optimize this, we read in a big block of row pointers, sort these and
then we read the rows in the sorted order into a row buffer
(@code{read_rnd_buffer_size}) .
@end itemize

You can with @code{EXPLAIN SELECT ... ORDER BY} check if MySQL can use
indexes to resolve the query.  If you get @code{Using filesort} in the
@code{extra} column, then MySQL can't use indexes to resolve the
@code{ORDER BY}. @xref{EXPLAIN,  , @code{EXPLAIN}}.

If you want to have a higher @code{ORDER BY} speed, you should first
see if you can get MySQL to use indexes instead of having to do an extra
sorting phase. If this is not possible, then you can do:

@itemize @bullet
@item
Increase the size of the @code{sort_buffer_size} variable.
@item
Increase the size of the @code{read_rnd_buffer_size} variable.
@item
Change @code{tmpdir} to point to a dedicated disk with lots of empty space.
If you use MySQL 4.1 or later you can spread load between
several physical disks by setting @code{tmpdir} to a list of paths
separated by colon @code{:} (semicolon @code{;} on Windows). They
will be used in round-robin fashion.
@strong{Note:} These paths should end up on different @strong{physical} disks,
not different partitions of the same disk.
@end itemize

By default, MySQL sorts all @code{GROUP BY x,y[,...]} queries as if you
specified @code{ORDER BY x,y[,...]} in the query as well. If you include the
@code{ORDER BY} clause explicitly,  MySQL optimizes it away without any speed
penalty, though the sorting still occurs.
If a query includes @code{GROUP BY} but you want to avoid the overhead
of sorting the result, you can supress sorting by specifying
@code{ORDER BY NULL}:

@example
INSERT INTO foo SELECT a,COUNT(*) FROM bar GROUP BY a ORDER BY NULL;
@end example

@node LIMIT optimisation, Insert speed, ORDER BY optimisation, Query Speed
@subsection How MySQL Optimizes @code{LIMIT}

@findex LIMIT

@cindex optimizing, LIMIT

In some cases MySQL will handle the query differently when you are
using @code{LIMIT row_count} and not using @code{HAVING}:

@itemize @bullet
@item
If you are selecting only a few rows with @code{LIMIT}, MySQL
will use indexes in some cases when it normally would prefer to do a
full table scan.
@item
If you use @code{LIMIT row_count} with @code{ORDER BY}, MySQL will end the
sorting as soon as it has found the first @code{row_count} lines instead of sorting
the whole table.
@item
When combining @code{LIMIT row_count} with @code{DISTINCT}, MySQL will stop
as soon as it finds @code{row_count} unique rows.
@item
In some cases a @code{GROUP BY} can be resolved by reading the key in order
(or do a sort on the key) and then calculate summaries until the
key value changes.  In this case @code{LIMIT row_count} will not calculate any
unnecessary @code{GROUP BY} values.
@item
As soon as MySQL has sent the first @code{#} rows to the client, it
will abort the query (if you are not using @code{SQL_CALC_FOUND_ROWS}).
@item
@code{LIMIT 0} will always quickly return an empty set.  This is useful
to check the query and to get the column types of the result columns.
@item
When the server uses temporary tables to resolve the query, the
@code{LIMIT row_count} is used to calculate how much space is required.
@end itemize


@node Insert speed, Update speed, LIMIT optimisation, Query Speed
@subsection Speed of @code{INSERT} Queries

@findex INSERT

@cindex speed, inserting
@cindex inserting, speed of

The time to insert a record consists approximately of:

@itemize @bullet
@item
Connect:                 (3)
@item
Sending query to server: (2)
@item
Parsing query:           (2)
@item
Inserting record:        (1 x size of record)
@item
Inserting indexes:       (1 x number of indexes)
@item
Close:                   (1)
@end itemize

where the numbers are somewhat proportional to the overall time. This
does not take into consideration the initial overhead to open tables
(which is done once for each concurrently running query).

The size of the table slows down the insertion of indexes by log N
(B-trees).

Some ways to speed up inserts:

@itemize @bullet
@item
If you are inserting many rows from the same client at the same time, use
multiple value lists @code{INSERT} statements. This is much faster (many times
in some cases) than using separate @code{INSERT} statements.  If you are adding
data to non-empty table, you may tune up the @code{bulk_insert_buffer_size}
variable to make it even faster.
@xref{SHOW VARIABLES, , @code{bulk_insert_buffer_size}}.
@item
If you are inserting a lot of rows from different clients, you can get
higher speed by using the @code{INSERT DELAYED} statement. @xref{INSERT,
, @code{INSERT}}.
@item
Note that with @code{MyISAM} tables you can insert rows at the same time
@code{SELECT} statements are running if there are no deleted rows in the tables.
@item
When loading a table from a text file, use @code{LOAD DATA INFILE}. This
is usually 20 times faster than using a lot of @code{INSERT} statements.
@xref{LOAD DATA, , @code{LOAD DATA}}.
@item
It is possible with some extra work to make @code{LOAD DATA INFILE} run even
faster when the table has many indexes. Use the following procedure:

@enumerate
@item
Optionally create the table with @code{CREATE TABLE}. For example, using
@code{mysql} or Perl-DBI.

@item
Execute a @code{FLUSH TABLES} statement or the shell command @code{mysqladmin
flush-tables}.

@item
Use @code{myisamchk --keys-used=0 -rq /path/to/db/tbl_name}. This will
remove all usage of all indexes from the table.

@item
Insert data into the table with @code{LOAD DATA INFILE}. This will not
update any indexes and will therefore be very fast.

@item
If you are going to only read the table in the future, run @code{myisampack}
on it to make it smaller. @xref{Compressed format}.

@item
Re-create the indexes with @code{myisamchk -r -q
/path/to/db/tbl_name}. This will create the index tree in memory before
writing it to disk, which is much faster because it avoids lots of disk
seeks. The resulting index tree is also perfectly balanced.

@item
Execute a @code{FLUSH TABLES} statement or the shell command @code{mysqladmin
flush-tables}.
@end enumerate

Note that @code{LOAD DATA INFILE} also does the above optimization if
you insert into an empty table; the main difference with the above
procedure is that you can let @code{myisamchk} allocate much more temporary
memory for the index creation that you may want MySQL to allocate for
every index recreation.

Since MySQL 4.0 you can also use
@code{ALTER TABLE tbl_name DISABLE KEYS} instead of
@code{myisamchk --keys-used=0 -rq /path/to/db/tbl_name} and
@code{ALTER TABLE tbl_name ENABLE KEYS} instead of
@code{myisamchk -r -q /path/to/db/tbl_name}. This way you can also skip
@code{FLUSH TABLES} steps.
@item
You can speed up insertions that are done using multiple statements by
locking your tables:

@example
mysql> LOCK TABLES a WRITE;
mysql> INSERT INTO a VALUES (1,23),(2,34),(4,33);
mysql> INSERT INTO a VALUES (8,26),(6,29);
mysql> UNLOCK TABLES;
@end example

The main speed difference is that the index buffer is flushed to disk only
once, after all @code{INSERT} statements have completed. Normally there would
be as many index buffer flushes as there are different @code{INSERT}
statements. Locking is not needed if you can insert all rows with a single
statement.

For transactional tables, you should use @code{BEGIN/COMMIT} instead of
@code{LOCK TABLES} to get a speedup.

Locking will also lower the total time of multi-connection tests, but the
maximum wait time for some threads will go up (because they wait for
locks).  For example:

@example
thread 1 does 1000 inserts
thread 2, 3, and 4 does 1 insert
thread 5 does 1000 inserts
@end example

If you don't use locking, 2, 3, and 4 will finish before 1 and 5. If you
use locking, 2, 3, and 4 probably will not finish before 1 or 5, but the
total time should be about 40% faster.

As @code{INSERT}, @code{UPDATE}, and @code{DELETE} operations are very
fast in MySQL, you will obtain better overall performance by
adding locks around everything that does more than about 5 inserts or
updates in a row.  If you do very many inserts in a row, you could do a
@code{LOCK TABLES} followed by an @code{UNLOCK TABLES} once in a while
(about each 1000 rows) to allow other threads access to the table. This
would still result in a nice performance gain.

@code{LOAD DATA INFILE} is much faster for loading data.
@end itemize

To get some more speed for both @code{LOAD DATA INFILE} and
@code{INSERT}, enlarge the key buffer. @xref{Server parameters}.


@node Update speed, Delete speed, Insert speed, Query Speed
@subsection Speed of @code{UPDATE} Queries

Update queries are optimized as a @code{SELECT} query with the additional
overhead of a write. The speed of the write is dependent on the size of
the data that is being updated and the number of indexes that are
updated.  Indexes that are not changed will not be updated.

Also, another way to get fast updates is to delay updates and then do
many updates in a row later. Doing many updates in a row is much quicker
than doing one at a time if you lock the table.

Note that, with dynamic record format, updating a record to
a longer total length may split the record.  So if you do this often,
it is very important to @code{OPTIMIZE TABLE} sometimes.
@xref{OPTIMIZE TABLE, , @code{OPTIMIZE TABLE}}.


@node Delete speed, Tips, Update speed, Query Speed
@subsection Speed of @code{DELETE} Queries

If you want to delete all rows in the table, you should use
@code{TRUNCATE TABLE table_name}. @xref{TRUNCATE,  , @code{TRUNCATE}}.

The time to delete a record is exactly proportional to the number of
indexes. To delete records more quickly, you can increase the size of
the index cache. @xref{Server parameters}.


@node Tips,  , Delete speed, Query Speed
@subsection Other Optimization Tips

@cindex optimization, tips
@cindex tips, optimization

Unsorted tips for faster systems:

@itemize @bullet
@item
Use persistent connections to the database to avoid the connection
overhead. If you can't use persistent connections and you are doing a
lot of new connections to the database, you may want to change the value
of the @code{thread_cache_size} variable. @xref{Server parameters}.
@item
Always check that all your queries really use the indexes you have created
in the tables. In MySQL you can do this with the @code{EXPLAIN}
command. @xref{EXPLAIN, Explain, Explain, manual}.
@item
Try to avoid complex @code{SELECT} queries on @code{MyISAM} tables that are
updated a lot. This is to avoid problems with table locking.
@item
With @code{MyISAM} tables that have no deleted rows, you can insert rows
at the same time another query is reading from it.  If this is important
for you, you should consider methods where you don't have to delete rows
or run @code{OPTIMIZE TABLE} after you have deleted a lot of rows.
@item
Use @code{ALTER TABLE ... ORDER BY expr1,expr2...} if you mostly
retrieve rows in @code{expr1,expr2...} order.  By using this option after big
changes to the table, you may be able to get higher performance.
@item
In some cases it may make sense to introduce a column that is 'hashed'
based on information from other columns. If this column is short and
reasonably unique it may be much faster than a big index on many
columns. In MySQL it's very easy to use this extra column:
@code{SELECT * FROM table_name WHERE hash=MD5(CONCAT(col1,col2))
AND col_1='constant' AND col_2='constant'}
@item
For tables that change a lot you should try to avoid all @code{VARCHAR}
or @code{BLOB} columns. You will get dynamic row length as soon as you
are using a single @code{VARCHAR} or @code{BLOB} column. @xref{Table
types}.
@item
It's not normally useful to split a table into different tables just
because the rows gets 'big'. To access a row, the biggest performance
hit is the disk seek to find the first byte of the row. After finding
the data most new disks can read the whole row fast enough for most
applications. The only cases where it really matters to split up a table is if
it's a dynamic row size table (see above) that you can change to a fixed
row size, or if you very often need to scan the table and don't need
most of the columns. @xref{Table types}.
@item
If you very often need to calculate things based on information from a
lot of rows (like counts of things), it's probably much better to
introduce a new table and update the counter in real time. An update of
type @code{UPDATE table SET count=count+1 WHERE index_column=constant}
is very fast!

This is really important when you use MySQL table types like MyISAM and
ISAM that
only have table locking (multiple readers / single writers). This will
also give better performance with most databases, as the row locking
manager in this case will have less to do.
@item
If you need to collect statistics from big log tables, use summary tables
instead of scanning the whole table. Maintaining the summaries should be
much faster than trying to do statistics 'live'. It's much faster to
regenerate new summary tables from the logs when things change
(depending on business decisions) than to have to change the running
application!
@item
If possible, one should classify reports as 'live' or 'statistical',
where data needed for statistical reports are only generated based on
summary tables that are generated from the actual data.
@item
Take advantage of the fact that columns have default values. Insert
values explicitly only when the value to be inserted differs from the
default. This reduces the parsing that MySQL need to do and
improves the insert speed.
@item
In some cases it's convenient to pack and store data into a blob. In this
case you have to add some extra code in your application to pack/unpack
things in the blob, but this may save a lot of accesses at some stage.
This is practical when you have data that doesn't conform to a static
table structure.
@item
Normally you should try to keep all data non-redundant (what
is called 3rd normal form in database theory), but you should not be
afraid of duplicating things or creating summary tables if you need these
to gain more speed.
@item
Stored procedures or UDF (user-defined functions) may be a good way to
get more performance.  In this case you should, however, always have a way
to do this some other (slower) way if you use some database that doesn't
support this.
@item
You can always gain something by caching queries/answers in your
application and trying to do many inserts/updates at the same time.  If
your database supports lock tables (like MySQL and Oracle),
this should help to ensure that the index cache is only flushed once
after all updates.
@item
Use @code{INSERT /*! DELAYED */} when you do not need to know when your
data is written. This speeds things up because many records can be written
with a single disk write.
@item
Use @code{INSERT /*! LOW_PRIORITY */} when you want your selects to be
more important.
@item
Use @code{SELECT /*! HIGH_PRIORITY */} to get selects that jump the
queue. That is, the select is done even if there is somebody waiting to
do a write.
@item
Use the multi-line @code{INSERT} statement to store many rows with one
SQL command (many SQL servers supports this).
@item
Use @code{LOAD DATA INFILE} to load bigger amounts of data. This is
faster than normal inserts and will be even faster when @code{myisamchk}
is integrated in @code{mysqld}.
@item
Use @code{AUTO_INCREMENT} columns to make unique values.
@item
Use @code{OPTIMIZE TABLE} once in a while to avoid fragmentation when
using a dynamic table format. @xref{OPTIMIZE TABLE, , @code{OPTIMIZE TABLE}}.

@item
Use @code{HEAP} tables to get more speed when possible. @xref{Table
types}.
@item
When using a normal web server setup, images should be stored as
files. That is, store only a file reference in the database.  The main
reason for this is that a normal web server is much better at caching
files than database contents. So it it's much easier to get a fast
system if you are using files.
@item
Use in memory tables for non-critical data that are accessed often (like
information about the last shown banner for users that don't have
cookies).
@item
Columns with identical information in different tables should be
declared identical and have identical names. Before Version 3.23 you
got slow joins otherwise.

Try to keep the names simple (use @code{name} instead of
@code{customer_name} in the customer table). To make your names portable
to other SQL servers you should keep them shorter than 18 characters.
@item
If you need really high speed, you should take a look at the low-level
interfaces for data storage that the different SQL servers support!  For
example, by accessing the MySQL @code{MyISAM} directly, you could
get a speed increase of 2-5 times compared to using the SQL interface.
To be able to do this the data must be on the same server as
the application, and usually it should only be accessed by one process
(because external file locking is really slow).  One could eliminate the
above problems by introducing low-level @code{MyISAM} commands in the
MySQL server (this could be one easy way to get more
performance if needed).  By carefully designing the database interface,
it should be quite easy to support this types of optimization.
@item
In many cases it's faster to access data from a database (using a live
connection) than accessing a text file, just because the database is
likely to be more compact than the text file (if you are using numerical
data), and this will involve fewer disk accesses.  You will also save
code because you don't have to parse your text files to find line and
column boundaries.
@item
You can also use replication to speed things up. @xref{Replication}.
@item
Declaring a table with @code{DELAY_KEY_WRITE=1} will make the updating of
indexes faster, as these are not logged to disk until the file is closed.
The downside is that you should run @code{myisamchk} on these tables before
you start @code{mysqld} to ensure that they are okay if something killed
@code{mysqld} in the middle.  As the key information can always be generated
from the data, you should not lose anything by using @code{DELAY_KEY_WRITE}.
@end itemize


@node Locking Issues, Optimising Database Structure, Query Speed, MySQL Optimisation
@section Locking Issues


@menu
* Internal locking::            How MySQL Locks Tables
* Table locking::               Table Locking Issues
@end menu


@node Internal locking, Table locking, Locking Issues, Locking Issues
@subsection How MySQL Locks Tables

@cindex internal locking
@cindex locking, tables
@cindex tables, locking

You can find a discussion about different locking methods in the appendix.
@xref{Locking methods}.

All locking in MySQL is deadlock-free, except for @code{InnoDB} and
@code{BDB} type tables.
This is managed by always
requesting all needed locks at once at the beginning of a query and always
locking the tables in the same order.

@code{InnoDB} type tables automatically acquire their row locks and
@code{BDB} type tables
their page locks during the processing of SQL statements, not at the start
of the transaction.

The locking method MySQL uses for @code{WRITE} locks works as follows:

@itemize @bullet
@item
If there are no locks on the table, put a write lock on it.
@item
Otherwise, put the lock request in the write lock queue.
@end itemize

The locking method MySQL uses for @code{READ} locks works as follows:

@itemize @bullet
@item
If there are no write locks on the table, put a read lock on it.
@item
Otherwise, put the lock request in the read lock queue.
@end itemize

When a lock is released, the lock is made available to the threads
in the write lock queue, then to the threads in the read lock queue.

This means that if you have many updates on a table, @code{SELECT}
statements will wait until there are no more updates.

To work around this for the case where you want to do many @code{INSERT} and
@code{SELECT} operations on a table, you can insert rows in a temporary
table and update the real table with the records from the temporary table
once in a while.

This can be done with the following code:
@example
mysql> LOCK TABLES real_table WRITE, insert_table WRITE;
mysql> INSERT INTO real_table SELECT * FROM insert_table;
mysql> TRUNCATE TABLE insert_table;
mysql> UNLOCK TABLES;
@end example

You can use the @code{LOW_PRIORITY} options with @code{INSERT},
@code{UPDATE} or @code{DELETE} or @code{HIGH_PRIORITY} with
@code{SELECT} if you want to prioritize retrieval in some specific
cases.  You can also start @code{mysqld} with @code{--low-priority-updates}
to get the same behavior.

Using @code{SQL_BUFFER_RESULT} can also help making table locks shorter.
@xref{SELECT,  , @code{SELECT}}.

You could also change the locking code in @file{mysys/thr_lock.c} to use a
single queue.  In this case, write locks and read locks would have the same
priority, which might help some applications.


@node Table locking,  , Internal locking, Locking Issues
@subsection Table Locking Issues

@cindex problems, table locking

The table locking code in MySQL is deadlock free.

MySQL uses table locking (instead of row locking or column
locking) on all table types, except @code{InnoDB} and @code{BDB} tables,
to achieve a very
high lock speed.  For large tables, table locking is much better than
row locking for most applications, but there are some pitfalls.

For @code{InnoDB} and @code{BDB} tables, MySQL only uses table
locking if you explicitly lock the table with @code{LOCK TABLES}.
For these table types we recommend you to not use
@code{LOCK TABLES} at all, because @code{InnoDB} uses automatic
row level locking and @code{BDB} uses page level locking to
ensure transaction isolation.

As of MySQL Version 3.23.7 (3.23.25 for Windows), you can insert rows into
@code{MyISAM} tables at the same time other threads are reading from the
table.  Note that currently this works only if there are no holes resulting from
deleted rows in the table at the time the insert is made. When all holes
has been filled with new data, concurrent inserts will automatically be
enabled again.

Table locking enables many threads to read from a table at the same
time, but if a thread wants to write to a table, it must first get
exclusive access.  During the update, all other threads that want to
access this particular table will wait until the update is ready.

As updates on tables normally are considered to be more important than
@code{SELECT}, all statements that update a table have higher priority
than statements that retrieve information from a table. This should
ensure that updates are not 'starved' because one issues a lot of heavy
queries against a specific table. (You can change this by using
@code{LOW_PRIORITY} with the statement that does the update or
@code{HIGH_PRIORITY} with the @code{SELECT} statement.)

Starting from MySQL Version 3.23.7 one can use the
@code{max_write_lock_count} variable to force MySQL to
temporary give all @code{SELECT} statements, that wait for a table, a
higher priority after a specific number of inserts on a table.

Table locking is, however, not very good under the following scenario:

@itemize @bullet
@item
A client issues a @code{SELECT} that takes a long time to run.
@item
Another client then issues an @code{UPDATE} on a used table. This client
will wait until the @code{SELECT} is finished.
@item
Another client issues another @code{SELECT} statement on the same table. As
@code{UPDATE} has higher priority than @code{SELECT}, this @code{SELECT}
will wait for the @code{UPDATE} to finish.  It will also wait for the first
@code{SELECT} to finish!
@item
A thread is waiting for something like @code{full disk}, in which case all
threads that wants to access the problem table will also be put in a waiting
state until more disk space is made available.
@end itemize

Some possible solutions to this problem are:

@itemize @bullet
@item
Try to get the @code{SELECT} statements to run faster. You may have to create
some summary tables to do this.

@item
Start @code{mysqld} with @code{--low-priority-updates}.  This will give
all statements that update (modify) a table lower priority than a @code{SELECT}
statement. In this case the last @code{SELECT} statement in the previous
scenario would execute before the @code{INSERT} statement.

@item
You can give a specific @code{INSERT}, @code{UPDATE}, or @code{DELETE}
statement lower priority with the @code{LOW_PRIORITY} attribute.

@item
Start @code{mysqld} with a low value for @code{max_write_lock_count} to give
@code{READ} locks after a certain number of @code{WRITE} locks.

@item
You can specify that all updates from a specific thread should be done with
low priority by using the SQL command: @code{SET LOW_PRIORITY_UPDATES=1}.
@xref{SET OPTION, , @code{SET}}.

@item
You can specify that a specific @code{SELECT} is very important with the
@code{HIGH_PRIORITY} attribute. @xref{SELECT, , @code{SELECT}}.

@item
If you have problems with @code{INSERT} combined with @code{SELECT},
switch to use the new @code{MyISAM} tables as these support concurrent
@code{SELECT} and @code{INSERT} statements.

@item
If you mainly mix @code{INSERT} and @code{SELECT} statements, the
@code{DELAYED} attribute to @code{INSERT} will probably solve your problems.
@xref{INSERT, , @code{INSERT}}.

@item
If you have problems with @code{SELECT} and @code{DELETE}, the @code{LIMIT}
option to @code{DELETE} may help. @xref{DELETE, , @code{DELETE}}.
@end itemize


@node Optimising Database Structure, Optimising the Server, Locking Issues, MySQL Optimisation
@section Optimizing Database Structure


@menu
* Design::                      Design Choices
* Data size::                   Get Your Data as Small as Possible
* MySQL indexes::               How MySQL Uses Indexes
* Indexes::                     Column Indexes
* Multiple-column indexes::     Multiple-Column Indexes
* MyISAM key cache::            The MyISAM Key Cache
* Open tables::                 How MySQL Counts Open Tables
* Table cache::                 How MySQL Opens and Closes Tables
* Creating many tables::        Drawbacks to Creating Large Numbers of Tables in the Same Database
@end menu


@node Design, Data size, Optimising Database Structure, Optimising Database Structure
@subsection Design Choices

@cindex design, choices
@cindex database design
@cindex storage of data

MySQL keeps row data and index data in separate files. Many (almost
all) other databases mix row and index data in the same file. We believe that
the MySQL choice is better for a very wide range of modern systems.

Another way to store the row data is to keep the information for each
column in a separate area (examples are SDBM and Focus). This will cause a
performance hit for every query that accesses more than one column. Because
this degenerates so quickly when more than one column is accessed,
we believe that this model is not good for general purpose databases.

The more common case is that the index and data are stored together
(as in Oracle/Sybase et al). In this case you will find the row
information at the leaf page of the index. The good thing with this
layout is that it, in many cases, depending on how well the index is
cached, saves a disk read.  The bad things with this layout are:

@itemize @bullet
@item
Table scanning is much slower because you have to read through the indexes
to get at the data.
@item
You can't use only the index table to retrieve data for a query.
@item
You lose a lot of space, as you must duplicate indexes from the nodes
(as you can't store the row in the nodes).
@item
Deletes will degenerate the table over time (as indexes in nodes are
usually not updated on delete).
@item
It's harder to cache only the index data.
@end itemize


@node Data size, MySQL indexes, Design, Optimising Database Structure
@subsection Get Your Data as Small as Possible

@cindex data, size
@cindex reducing, data size
@cindex storage space, minimising
@cindex tables, improving performance
@cindex performance, improving

One of the most basic optimization is to get your data (and indexes) to
take as little space on the disk (and in memory) as possible. This can
give huge improvements because disk reads are faster and normally less
main memory will be used. Indexing also takes less resources if
done on smaller columns.

MySQL supports a lot of different table types and row formats.
Choosing the right table format may give you a big performance gain.
@xref{Table types}.

You can get better performance on a table and minimise storage space
using the techniques listed here:

@itemize @bullet
@item
Use the most efficient (smallest) types possible. MySQL has
many specialized types that save disk space and memory.

@item
Use the smaller integer types if possible to get smaller tables. For
example, @code{MEDIUMINT} is often better than @code{INT}.

@item
Declare columns to be @code{NOT NULL} if possible. It makes everything
faster and you save one bit per column. Note that if you really need
@code{NULL} in your application you should definitely use it. Just avoid
having it on all columns by default.

@item
If you don't have any variable-length columns (@code{VARCHAR},
@code{TEXT}, or @code{BLOB} columns), a fixed-size record format is
used. This is faster but unfortunately may waste some space.
@xref{MyISAM table formats, , @code{MyISAM} table formats}.

@item
The primary index of a table should be as short as possible. This makes
identification of one row easy and efficient.

@item
For each table, you have to decide which storage/index method to
use. @xref{Table types}.

@item
Only create the indexes that you really need. Indexes are good for
retrieval but bad when you need to store things fast. If you mostly
access a table by searching on a combination of columns, make an index
on them. The first index part should be the most used column. If you are
@strong{always} using many columns, you should use the column with more duplicates
first to get better compression of the index.

@item
If it's very likely that a column has a unique prefix on the first number
of characters, it's better to only index this prefix. MySQL
supports an index on a part of a character column. Shorter indexes are
faster not only because they take less disk space but also because they
will give you more hits in the index cache and thus fewer disk
seeks. @xref{Server parameters}.

@item
In some circumstances it can be beneficial to split into two a table that is
scanned very often. This is especially true if it is a dynamic
format table and it is possible to use a smaller static format table that
can be used to find the relevant rows when scanning the table.
@end itemize


@node MySQL indexes, Indexes, Data size, Optimising Database Structure
@subsection How MySQL Uses Indexes

@cindex indexes, use of

Indexes are used to find rows with specific column values
fast. Without an index MySQL has to start with the first record
and then read through the whole table to find the relevant
rows. The bigger the table, the more this costs. If the table has an index
for the columns in question, MySQL can quickly get a position to
seek to in the middle of the datafile without having to look at all the
data. If a table has 1000 rows, this is at least 100 times faster than
reading sequentially. Note that if you need to access almost all 1000
rows, it is faster to read sequentially, because that minimises disk seeks.

All MySQL indexes (@code{PRIMARY KEY}, @code{UNIQUE}, and
@code{INDEX}) are stored in B-trees. Strings are automatically prefix-
and end-space compressed. @xref{CREATE INDEX, , @code{CREATE INDEX}}.

Indexes are used in the following ways:
@itemize @bullet
@item
To quickly find the rows that match a @code{WHERE} clause.

@item
To retrieve rows from other tables when performing joins.

@item
To find the @code{MAX()} or @code{MIN()} value for a specific indexed
column. This is optimized by a preprocessor that checks if you are
using @code{WHERE} key_part_# = constant on all key parts < N.  In this case
MySQL will do a single key lookup and replace the @code{MIN()}
expression with a constant.  If all expressions are replaced with
constants, the query will return at once:

@example
SELECT MIN(key_part2),MAX(key_part2) FROM table_name where key_part1=10
@end example

@item
To sort or group a table if the sorting or grouping is done on a leftmost
prefix of a usable key (for example, @code{ORDER BY
key_part_1,key_part_2 }). The key is read in reverse order if all key
parts are followed by @code{DESC}.  @xref{ORDER BY optimisation}.

@item
In some cases a query can be optimized to retrieve values without
consulting the datafile. If all used columns for some table are numeric
and form a leftmost prefix for some key, the values may be retrieved
from the index tree for greater speed:

@example
SELECT key_part3 FROM table_name WHERE key_part1=1
@end example

@end itemize

Suppose you issue the following @code{SELECT} statement:

@example
mysql> SELECT * FROM tbl_name WHERE col1=val1 AND col2=val2;
@end example

If a multiple-column index exists on @code{col1} and @code{col2}, the
appropriate rows can be fetched directly. If separate single-column
indexes exist on @code{col1} and @code{col2}, the optimizer tries to
find the most restrictive index by deciding which index will find fewer
rows and using that index to fetch the rows.

@cindex indexes, leftmost prefix of
@cindex leftmost prefix of indexes
If the table has a multiple-column index, any leftmost prefix of the
index can be used by the optimizer to find rows. For example, if you
have a three-column index on @code{(col1, col2, col3)}, you have indexed
search capabilities on @code{(col1)}, @code{(col1, col2)}, and
@code{(col1, col2, col3)}.

MySQL can't use a partial index if the columns don't form a
leftmost prefix of the index.  Suppose you have the @code{SELECT}
statements shown here:

@example
mysql> SELECT * FROM tbl_name WHERE col1=val1;
mysql> SELECT * FROM tbl_name WHERE col2=val2;
mysql> SELECT * FROM tbl_name WHERE col2=val2 AND col3=val3;
@end example

If an index exists on @code{(col1, col2, col3)}, only the first of the preceding
queries uses the index. The second and third queries do involve
indexed columns, but @code{(col2)} and @code{(col2, col3)} are not
leftmost prefixes of @code{(col1, col2, col3)}.

@findex LIKE, and indexes
@findex LIKE, and wildcards
@cindex indexes, and @code{LIKE}
@cindex wildcards, and @code{LIKE}
MySQL also uses indexes for @code{LIKE} comparisons if the argument
to @code{LIKE} is a constant string that doesn't start with a wildcard
character.  For example, the following @code{SELECT} statements use indexes:

@example
mysql> SELECT * FROM tbl_name WHERE key_col LIKE "Patrick%";
mysql> SELECT * FROM tbl_name WHERE key_col LIKE "Pat%_ck%";
@end example

In the first statement, only rows with @code{"Patrick" <= key_col <
"Patricl"} are considered.  In the second statement, only rows with
@code{"Pat" <= key_col < "Pau"} are considered.

The following @code{SELECT} statements will not use indexes:
@example
mysql> SELECT * FROM tbl_name WHERE key_col LIKE "%Patrick%";
mysql> SELECT * FROM tbl_name WHERE key_col LIKE other_col;
@end example

In the first statement, the @code{LIKE} value begins with a wildcard
character.  In the second statement, the @code{LIKE} value is not a
constant.

MySQL 4.0 does another optimization on @code{LIKE}.  If you use
@code{... LIKE "%string%"} and @code{string} is longer than 3 characters,
MySQL will use the @code{Turbo Boyer-Moore} algorithm to initialize the
pattern for the string and then use this pattern to perform the search
quicker.

@findex IS NULL, and indexes
@cindex indexes, and @code{IS NULL}
Searching using @code{column_name IS NULL} will use indexes if
@code{column_name} is an index.

MySQL normally uses the index that finds the smallest number of rows. An
index is used for columns that you compare with the following operators:
@code{=}, @code{>}, @code{>=}, @code{<}, @code{<=}, @code{BETWEEN}, or a
@code{LIKE} with a pattern that begins with a non-wildcard prefix like
@code{'something%'}.

Any index that doesn't span all @code{AND} levels in the @code{WHERE} clause
is not used to optimize the query. In other words:  To be able to use an
index, a prefix of the index must be used in every @code{AND} group.

The following @code{WHERE} clauses use indexes:
@example
... WHERE index_part1=1 AND index_part2=2 AND other_column=3
... WHERE index=1 OR A=10 AND index=2      /* index = 1 OR index = 2 */
... WHERE index_part1='hello' AND index_part_3=5
          /* optimized like "index_part1='hello'" */
... WHERE index1=1 AND index2=2 OR index1=3 AND index3=3;
          /* Can use index on index1 but not on index2 or index 3 */
@end example

These @code{WHERE} clauses do @strong{not} use indexes:
@example
... WHERE index_part2=1 AND index_part3=2  /* index_part_1 is not used */
... WHERE index=1 OR A=10                  /* Index is not used in
                                                        both AND parts */
... WHERE index_part1=1 OR index_part2=10  /* No index spans all rows  */
@end example

Note that sometime MySQL will not use an index, even if one
is available.  One instance of this is when
use of the index would require MySQL to access more
than 30% of the rows in the table.  (In this case a table scan is
probably much faster, as it will require many fewer seeks.)
However, if such a query uses @code{LIMIT} to only retrieve
part of the rows, MySQL will use an index anyway, as it can
much more quickly find the few rows to return in the result.

@node Indexes, Multiple-column indexes, MySQL indexes, Optimising Database Structure
@subsection Column Indexes

@cindex indexes, columns
@cindex columns, indexes
@cindex keys

All MySQL column types can be indexed.  Use of indexes on the
relevant columns is the best way to improve the performance of @code{SELECT}
operations.

The maximum number of indexes per table and the maximum index length is
defined per storage engine. @xref{Table types}. All storage engines support a
minimum of 16 indexes per table and a minimum total index length of 256 bytes.

For @code{CHAR} and @code{VARCHAR} columns, you can index a prefix of a
column.  This is much faster and requires less disk space than indexing the
whole column.  The syntax to use in the @code{CREATE TABLE} statement to
index a column prefix looks like this:

@example
INDEX index_name (col_name(length))
@end example

The example here creates an index for the first 10 characters of the
@code{name} column:

@example
mysql> CREATE TABLE test (
    ->        name CHAR(200) NOT NULL,
    ->        INDEX index_name (name(10)));
@end example

For @code{BLOB} and @code{TEXT} columns, you must index a prefix of the
column. The prefix may be up to 255 bytes long.

In MySQL Version 3.23.23 or later, you can also create special
@code{FULLTEXT} indexes. They are used for full-text search. Only the
@code{MyISAM} table type supports @code{FULLTEXT} indexes and only for
@code{CHAR}, @code{VARCHAR}, and @code{TEXT} columns.
Indexing always happens over the entire column and partial (prefix) indexing
is not supported. See @ref{Fulltext Search} for details.

@node Multiple-column indexes, MyISAM key cache, Indexes, Optimising Database Structure
@subsection Multiple-Column Indexes

@cindex multi-column indexes
@cindex indexes, multi-column
@cindex keys, multi-column

MySQL can create indexes on multiple columns.  An index may
consist of up to 15 columns. (On @code{CHAR} and @code{VARCHAR} columns you
can also use a prefix of the column as a part of an index.)

A multiple-column index can be considered a sorted array containing values
that are created by concatenating the values of the indexed columns.

MySQL uses multiple-column indexes in such a way that queries are
fast when you specify a known quantity for the first column of the index in a
@code{WHERE} clause, even if you don't specify values for the other columns.

Suppose a table has the following specification:

@example
mysql> CREATE TABLE test (
    ->       id INT NOT NULL,
    ->       last_name CHAR(30) NOT NULL,
    ->       first_name CHAR(30) NOT NULL,
    ->       PRIMARY KEY (id),
    ->       INDEX name (last_name,first_name));
@end example

Then the index @code{name} is an index over @code{last_name} and
@code{first_name}.  The index can used for queries that specify
values in a known range for @code{last_name}, or for both @code{last_name}
and @code{first_name}.
Therefore, the @code{name} index will be used in the following queries:

@example
mysql> SELECT * FROM test WHERE last_name="Widenius";

mysql> SELECT * FROM test WHERE last_name="Widenius"
    ->                    AND first_name="Michael";

mysql> SELECT * FROM test WHERE last_name="Widenius"
    ->                    AND (first_name="Michael" OR first_name="Monty");

mysql> SELECT * FROM test WHERE last_name="Widenius"
    ->                    AND first_name >="M" AND first_name < "N";
@end example

However, the @code{name} index will @strong{not} be used in the following
queries:

@example
mysql> SELECT * FROM test WHERE first_name="Michael";

mysql> SELECT * FROM test WHERE last_name="Widenius"
    ->                    OR first_name="Michael";
@end example

For more information on the manner in which MySQL uses indexes to
improve query performance, see @ref{MySQL indexes, , MySQL
indexes}.


@node MyISAM key cache, Open tables, Multiple-column indexes, Optimising Database Structure
@subsection The MyISAM Key Cache

@cindex MyISAM key cache
@cindex Key cache, MyISAM

@menu
* Shared key cache::            Shared Key Cache Access
* Multiple key caches::         Multiple Key Caches
* Midpoint insertion::          Midpoint Insertion Strategy
* Index preloading::            Index Preloading
* Key cache block size::        Key Cache Block Size
* Key cache restructuring::     Restructuring a Key Cache
@end menu

To minimize disk I/O, the MyISAM storage engine employs a strategy that
is used by many database management systems. It exploits a cache
mechanism to keep the most frequently accessed table blocks in memory:

@itemize @bullet
@item
For index blocks, a special structure called the key cache (key buffer)
is employed. The structure contains a number of block buffers where the
most-used index blocks are placed.

@item
For data blocks, MySQL uses no special cache. Instead it relies on the
native operating system filesystem cache.

@end itemize

This section first describes the basic operation of the @code{MyISAM} key
cache. Then it discusses changes made in MySQL 4.1 that improve key cache
performance and that allow you control over cache operation:

@itemize @bullet
@item
The key cache access no longer is serialized among threads. Multiple threads
can access the cache concurrently.

@item
Multiple key caches can be set up and table indexes assigned to specific
caches.

@end itemize

The key cache mechanism also is used for @code{ISAM} tables, which use
B-tree indexes. However, the significance of this fact is on the wane.
@code{ISAM} table use has been decreasing since MySQL 3.23 when
@code{MyISAM} was introduced. MySQL 4.1 carries this trend further; the
@code{ISAM} storage engine is disabled by default.

You can control the size of the key cache by means of the
@code{key_buffer_size} system variable.  If this variable is set equal
to zero, no key cache is used.  The key cache also is not used if the
@code{key_buffer_size} value is too small to allocate the minimal number
of block buffers (8).

If the key cache is not used, index files are accessed using only the
native filesystem buffering provided by the operating system.  (That is,
table index blocks are accessed using the same strategy as that employed
for table data blocks.)

An index block is a contiguous unit of access to the MyISAM index files.
Usually the size of an index block is equal to the size of nodes of the
index B-tree. (Indexes are represented on disk using a B-tree data structure.
Nodes at the bottom of the tree are leaf nodes. Nodes above the leaf nodes
are non-leaf nodes.)

All block buffers in a key cache structure are the same size. This size can
be equal to, greater than, or less than the size of a table index block.
Usually one these two values is the multiple of the other.

When data from any table index block must be accessed, the server first
checks whether it is available in some block buffer of the key cache. If
it is, the server accesses data in the key cache rather than on disk.
That is, it reads from the cache or writes into it rather than reading
from or writing to disk. Otherwise, the server chooses a cache block
buffer containing a different table index block (or blocks) and replaces
the data there by a copy of required table index block.  As soon as the
new index block is in the cache, the index data can be accessed.

If it happens that a block selected for replacement has been modified,
the block is considered ``dirty.'' In this case, before being replaced, its
contents are flushed to the table index from which it came.

Usually the server follows a LRU (Least Recently Used) strategy: When
choosing a block for replacement, it selects the least recently used index
block. To be able to make such a choice easy, the key cache module maintains
a special queue (LRU chain) of all used blocks.  When a block is accessed,
it is placed at the end of the queue.  When blocks need to be replaced,
blocks at the beginning of the queue are the least recently used and become
the first candidates for eviction.


@node Shared key cache, Multiple key caches, MyISAM key cache, MyISAM key cache
@subsubsection Shared Key Cache Access

Prior to MySQL 4.1, access to the key cache is serialized:
No two threads can access key cache buffers simultaneously.
The server processes a request for an index block only after it has
finished processing the previous request. As a result, a request for an
index block not present in any key cache buffer blocks access by other
threads while a buffer is being updated to contain the requested index block.

Starting from version 4.1.0, the server supports shared access to the key
cache:

@itemize @bullet
@item
A buffer that is not being updated can be accessed by multiple threads

@item
A buffer that is being updated causes threads that need to use it to wait
until the update is complete

@item
Multiple threads can initiate requests that result in cache block
replacements, as long as they do not interfere with each other (that is,
as long as they need different index blocks, and thus cause different
cache blocks to be replaced).

@end itemize

Shared access to the key cache allows the server to improve throughput
significantly.


@node Multiple key caches, Midpoint insertion, Shared key cache, MyISAM key cache
@subsubsection Multiple Key Caches

Shared access to the key cache improves performance but does not eliminate
contention among threads entirely. They still compete for control structures
that manage access to the key cache buffers. To reduce key cache access
contention further, MySQL 4.1.1 offers the feature of multiple key caches.
This allows you to assign different table indexes to different key caches.

When there may be multiple key caches, the server must know which cache to
use when processing queries for a given @code{MyISAM} table. By default, all
@code{MyISAM} table indexes are cached in the default key cache. To assign
table indexes to a specific key cache, use the @code{CACHE INDEX} statement.

For example, The following statement assigns indexes from the tables
@code{t1}, @code{t2}, and @code{t3} to the key cache named @code{hot_cache}:

@example
mysql> CACHE INDEX t1, t2, t3 IN hot_cache;
+---------+--------------------+----------+----------+
| Table   | Op                 | Msg_type | Msg_text |
+---------+--------------------+----------+----------+
| test.t1 | assign_to_keycache | status   | OK       |
| test.t2 | assign_to_keycache | status   | OK       |
| test.t3 | assign_to_keycache | status   | OK       |
+---------+--------------------+----------+----------+
@end example

@strong{Note:} If the server has been built with the @code{ISAM} storage
engine enabled, @code{ISAM} tables use the key cache mechanism. However,
@code{ISAM} indexes use only the default key cache and cannot be reassigned to
a different cache.

The key cache referred to in a @code{CACHE INDEX} statement can be created
by setting its size with a parameter setting statement or in the server
parameter settings. For example:

@example
mysql> SET GLOBAL keycache1.key_buffer_size=128*1024;
@end example

To destroy a key cache, set its size to zero:

@example
mysql> SET GLOBAL keycache1.key_buffer_size=0;
@end example

See @ref{Structured System Variables} for a description of the syntax used
for referring to structured key cache system variables.

By default, table indexes are assigned to the main (default) key cache
created at the server start-up. When a key cache is destroyed, all
indexes assigned to it become assigned to the default key cache again.

For a busy server, we recommend a strategy that uses three key caches:

@itemize @bullet

@item
A hot key cache that takes up another 20% the space allocated for all key
caches. This is used for tables that are heavily used for searches but that
are not updated.

@item
A cold key cache that takes up 20% of the space allocated for all key
caches.  This is used for medium-sized intensively modified tables,
such as temporary tables.

@item
A warm key cache that takes up 60% of the key cache space.  This is the
default key cache, to be used by default for all other tables.

@end itemize

One reason the use of three key caches be beneficial is that access to one
key cache structure does not block access to the others.  Queries that
access tables assigned to one cache do not compete with queries that
access tables assigned to another cache.  Performance gains occur for
other reasons as well:

@itemize @bullet

@item
The hot cache is used only for retrieval queries, so its contents are
never modified.  Consequently, whenever an index block needs to be pulled
in from disk, the contents of the cache block chosen for replacement need
not be flushed first.

@item
For an index assigned to the hot cache, if there are no queries
requiring an index scan, there is a high probability that the index
blocks corresponding to non-leaf nodes of the index B-tree will remain
in the cache.

@item
An update operation most frequently executed for temporary tables is
performed much faster when the updated node already is in the cache and need
not be read in from disk first. If the size of the indexes of the temporary
tables are comparable with the size of cold key cache, the probability is
very high that the updated node already will be in the cache.

@end itemize


@node Midpoint insertion, Index preloading, Multiple key caches, MyISAM key cache
@subsubsection Midpoint Insertion Strategy


By default, the key cache management system of MySQL 4.1 uses the LRU
strategy for choosing key cache blocks to be evicted, but it also supports a
more sophisticated method called the midpoint insertion strategy.

When using the midpoint insertion strategy, the LRU chain is divided into
two parts: A hot sub-chain and a warm sub-chain. The division point between
two parts is not fixed, but the key cache management system takes care that
the warm part is not ``too short,'' always containing at least
@code{key_cache_division_limit} percent of the key cache blocks.  The
@code{key_cache_division_limit} value is a parameter and can be set per key
cache.

When an index block is read from a table into the key cache, it is placed
at the end of the warm sub-chain. After a certain number of hits (accesses
of the block) it is promoted to the hot sub-chain.  At present, the number
of hits required to promote a block (3) is the same for all index blocks.
In the future, we will allow the hit count to depend on the B-tree level
of the node corresponding to an index block: Fewer hits will be required
for promotion of an index block if it contains a non-leaf node from the
upper levels of the index B-tree than if it contains a leaf node.

A block promoted into the hot sub-chain is placed at the end of the chain.
The block then circulates within this sub-chain. If the block stays at the
beginning of the sub-chain for a long enough time, it is demoted to the warm
chain. This time is determined by the @code{key_cache_age_threshold}
variable of the key cache.

This variable prescribes that, for a key cache containing @code{N} blocks,
the block at the beginning of the hot sub-chain not accessed within the last
@code{N*key_cache_age_threshold/100} hits is to be moved to the beginning of
the warm sub-chain. It then becomes the first candidate for eviction,
because blocks for replacement always are taken from the beginning of the
warm sub-chain.

The midpoint insertion strategy allows you to keep more valued blocks
always in the cache. If you prefer to use the plain LRU strategy, leave the
@code{key_cache_division_limit} variable set to its default value of 100.

The midpoint insertion strategy helps to improve performance when execution
of a query that requires an index scan effectively pushes out of the cache
all the index blocks corresponding to valuable high level B-tree nodes. To
avoid this, you must use a midpoint insertion strategy with the
@code{key_cache_division_limit} set to much less than 100.  Then valuable
frequently hit nodes will be preserved in the hot sub-chain during an index
scan operation as well.


@node Index preloading, Key cache block size, Midpoint insertion, MyISAM key cache
@subsubsection Index Preloading

If there are enough blocks in a key cache to hold blocks of an entire
index, or at least the blocks corresponding to its non-leaf nodes, then
it makes sense to preload the key cache with index blocks before starting
to use it. Preloading allows you to put the table index blocks into a key
cache buffer in the most efficient way: By reading the index blocks from
disk sequentially.

Without preloading, the blocks still will be placed into the key cache as
needed by queries. In this case, however, although the blocks will stay
in the cache as there are enough buffers for all of them, they will be
fetched from disk in a random order, not sequentially.

To preload an index into a cache, use the @code{LOAD INDEX INTO CACHE}
statement. For example,
the following statement preloads nodes (index blocks) of indexes of the
tables @code{t1} and @code{t2}:

@example
mysql> LOAD INDEX INTO CACHE t1, t2 IGNORE LEAVES;
+---------+--------------+----------+----------+
| Table   | Op           | Msg_type | Msg_text |
+---------+--------------+----------+----------+
| test.t1 | preload_keys | status   | OK       |
| test.t2 | preload_keys | status   | OK       |
+---------+--------------+----------+----------+
@end example

The @code{IGNORE LEAVES} modifier causes only blocks for the non-leaf
nodes of the index to be preloaded. Thus,
this statement preloads all index blocks from @code{t1}, but only
blocks for the non-leaf nodes from @code{t2}.

If an index has been assigned to a key cache using a
@code{CACHE INDEX} statement, preloading places index blocks into that cache.
Otherwise, the index is loaded into the default key cache.


@node Key cache block size, Key cache restructuring, Index preloading, MyISAM key cache
@subsubsection Key Cache Block Size

MySQL 4.1 introduces a new @code{key_cache_block_size} variable on
a per-key cache basis. This variable specifies the size of the block
buffers for a key cache.

This variable is introduced to allow tuning the performance of I/O
operations for index files.

The best performance for I/O operations is achieved when the size of
read buffers are equal to the size of the native operating system I/O
buffers. But setting the size of key nodes equal to the size of I/O buffer
does not always ensure the best overall performance. When reading the
big leaf nodes the server pulls in a lot of unnecessary data, effectively
preventing reading other leaf nodes.

Currently, you cannot control the size of the index blocks in a table.  This
size is set by the server when the @file{.MYI} index file is created,
depending on the size of the keys in the indexes present in the table
definition.  In most cases, it is set equal to the I/O buffer size. In the
future this will be changed and then @code{key_cache_block_size} variable
will be fully employed.


@node Key cache restructuring,  , Key cache block size, MyISAM key cache
@subsubsection Restructuring a Key Cache

A key cache can be restructured at any time by updating its parameter
values.  For example:

@example
mysql> SET GLOBAL cold_cache.key_buffer_size=4*1024*1024;
@end example

If you assign to either the @code{key_buffer_size} or
@code{key_cache_block_size} key cache component a value that differs from
the component's currrent value, the server destroys the cache's old
structure and creates a new one based on the new values.  If the cache
contains any dirty blocks, the server saves them to disk before destroying
and recreating the cache. Restructuring does not occur if you set other key
cache parameters.

When restructuring a key cache, the server first flushes the contents of any
dirty buffers to disk. After that, the cache contents become unavailable.
However, restructuring does not block queries that need to use indexes
assigned to the cache.  Instead, the server directly accesses the table
indexes using native filesystem caching.  Filesystem caching is not as
efficient as using a key cache, so although queries will execute, a slowdown
can be anticipated.  Once the cache has been restructured, it becomes
available again for caching indexes assigned to it. The use of filesystem
caching for the indexes ceases.


@node Open tables, Table cache, MyISAM key cache, Optimising Database Structure
@subsection How MySQL Counts Open Tables

@cindex tables, open
@cindex open tables

When you run @code{mysqladmin status}, you'll see something like this:

@example
Uptime: 426 Running threads: 1 Questions: 11082 Reloads: 1 Open tables: 12
@end example

The @code{Open tables} value of 12 can be somewhat puzzling if you have
only 6 tables.

MySQL is multi-threaded, so there may be many clients issuing queries for a
given
simultaneously. To minimise the problem with two client threads having
different states on the same file, the table is opened independently by
each concurrent thread. This takes some memory but will normally increase
performance.  With @code{ISAM} and @code{MyISAM} tables,
one extra file descriptor is required for the datafile for each client that
has the table open. With these table types, the index
file descriptor is shared between all threads.

You can read more about this topic in the next section. @xref{Table cache}.

@node Table cache, Creating many tables, Open tables, Optimising Database Structure
@subsection How MySQL Opens and Closes Tables

@findex table_cache

@cindex tables, opening
@cindex tables, closing
@cindex opening, tables
@cindex closing, tables
@cindex table cache

The @code{table_cache}, @code{max_connections}, and @code{max_tmp_tables}
server variables affect the maximum number of files the server keeps open.
If you increase one or more of these values, you may run up against
a limit imposed by your operating system on the per-process number of
open file descriptors.  You can increase the open-files limit on many
operating systems, though the method varies widely from system to system.
Consult your operating system documentation to determine whether it is
possible to increase the limit and how to do so.

@code{table_cache} is related to @code{max_connections}.  For example,
for 200 concurrent running connections, you should have a table cache size of
at least @code{200 * n}, where @code{n} is the maximum number of tables
in a join.  You also need to reserve some extra file descriptors for
temporary tables and files.

Make sure that your operating system can handle the number of open file
descriptors implied by the @code{table_cache} setting.  If
@code{table_cache} is set too high, MySQL may run out of file
descriptors and refuse connections, fail to perform queries, and be very
unreliable.  You also have to take into account that the @code{MyISAM} storage
engine needs two file descriptors for each unique open table. You can
increase the number of file descriptors available for MySQL with
the @code{--open-files-limit=#} startup option. @xref{Not enough file
handles}.

The cache of open tables will be kept at a level of @code{table_cache}
entries. The default value is 64; this can be changed with the @code{-O
table_cache=#} option to @code{mysqld}).  Note that MySQL may
temporarily open even more tables to be able to execute queries.

A not used table is closed and removed from the table cache under the
following circumstances:

@itemize @bullet
@item
When the cache is full and a thread tries to open a table that is not in
the cache.
@item
When the cache contains more than @code{table_cache} entries and
a thread is no longer using a table.
@item
When someone executes @code{mysqladmin refresh} or
@code{mysqladmin flush-tables}.
@item
When someone executes a @code{FLUSH TABLES} statement.
@end itemize

When the table cache fills up, the server uses the following procedure
to locate a cache entry to use:

@itemize @bullet
@item
Tables that are not currently in use are released, in least-recently-used
order.

@item
If the cache is full and no tables can be released, but a new table needs to
be opened, the cache is temporarily extended as necessary.

@item
If the cache is in a temporarily extended state and a table goes from in-use
to not-in-use state, the table is closed and released from the cache.
@end itemize

@c TODO: does following paragraph apply to MyISAM/ISAM only? - PD

A table is opened for each concurrent access. This means
the table needs to be opened twice
if two threads access the same table or if a thread accesses the table
twice in the same query (for example, by joining the table to itself).
The first open of any table takes two file descriptors; each additional
use of the table takes only one file descriptor.  The extra descriptor
for the first open is used for the index file; this descriptor is shared
among all threads.

If you are opening a table with the @code{HANDLER table_name OPEN}
statement, a dedicated table object is allocated for the thread.
This table object is not shared by other threads and is not closed
until the thread calls @code{HANDLER table_name CLOSE} or the thread dies.
@xref{HANDLER, , @code{HANDLER}}.  When this happens, the table is put
back in the table cache (if the cache isn't full).

You can check if your table cache is too small by checking the @code{mysqld}
variable @code{Opened_tables}.  If this is quite big, even if you
haven't done a lot of @code{FLUSH TABLES}, you should increase your table
cache size. @xref{SHOW STATUS, , @code{Opened_tables}}.


@node Creating many tables,  , Table cache, Optimising Database Structure
@subsection Drawbacks to Creating Large Numbers of Tables in the Same Database

@cindex tables, too many

If you have many files in a directory, open, close, and create operations will
be slow.  If you execute @code{SELECT} statements on many different tables,
there will be a little overhead when the table cache is full, because for
every table that has to be opened, another must be closed. You can reduce
this overhead by making the table cache larger.


@node Optimising the Server, Disk issues, Optimising Database Structure, MySQL Optimisation
@section Optimizing the MySQL Server


@menu
* System::                      System/Compile Time and Startup Parameter Tuning
* Server parameters::           Tuning Server Parameters
* Compile and link options::    How Compiling and Linking Affects the Speed of MySQL
* Memory use::                  How MySQL Uses Memory
* DNS::                         How MySQL uses DNS
* SET OPTION::                  @code{SET} Syntax
@end menu


@node System, Server parameters, Optimising the Server, Optimising the Server
@subsection System/Compile Time and Startup Parameter Tuning

@cindex compiling, optimizing
@cindex system optimization
@cindex startup parameters, tuning

We start with the system level factors, because some of these decisions must
be made very early. In other cases, a quick look at this section may
suffice because it not that important for the big gains. However, it is always
nice to have a feeling about how much one could gain by changing things
at this level.

The default operating system to use is really important!  To get the best use
of multiple-CPU machines, you should use Solaris (because its threads
implementation works
really well) or Linux (because the 2.2 kernel has really good SMP support).
Also, older Linux kernels have a 2G file-size limit by default. If you have
such a kernel and a desperate need for files larger than 2G, you
should get the LFS (large file system) patch for the ext2 filesystem.
Other filesystems such as ReiserFS and XFS do not have this 2G limitation.

Because we have not run MySQL in production on that many platforms, we
advise you to test your intended platform before choosing it, if possible.

@cindex locking
Other tips:
@itemize @bullet
@item
If you have enough RAM, you could remove all swap devices. Some
operating systems will use a swap device in some contexts even if you
have free memory.
@item
Use the @code{--skip-external-locking} MySQL option to avoid external
locking. Note that this will not impact MySQL's functionality as long as you
only run one server. Just remember to take down the server (or lock and flush
the relevant tables) before you run @code{myisamchk}. On some systems this
option is mandatory, because the external locking does not work in any case.

The @code{--skip-external-locking} option is on by default as of MySQL 4.0.
Before that, it is on by default when compiling with
MIT-pthreads, because @code{flock()} isn't fully supported by
MIT-pthreads on all platforms.  It's also on default for Linux
as Linux file locking are not yet safe.

The only case when you can't use @code{--skip-external-locking} is if you run
multiple MySQL @emph{servers} (not clients) on the same data,
or if you run @code{myisamchk} on the table without telling the server
to flush and lock the tables first.

You can still use @code{LOCK TABLES}/@code{UNLOCK TABLES} even if you
are using @code{--skip-external-locking}.
@end itemize


@node Server parameters, Compile and link options, System, Optimising the Server
@subsection Tuning Server Parameters

@cindex parameters, server
@cindex @code{mysqld} server, buffer sizes
@cindex buffer sizes, @code{mysqld} server
@cindex startup parameters

You can determine the default buffer sizes used by the @code{mysqld} server
with this command:

@example
shell> mysqld --help
@end example

@cindex @code{mysqld} options
@cindex variables, @code{mysqld}
This command produces a list of all @code{mysqld} options and configurable
variables. The output includes the default variable values and looks something
like this:

@example
back_log                 current value: 5
bdb_cache_size           current value: 1048540
binlog_cache_size        current value: 32768
connect_timeout          current value: 5
delayed_insert_timeout   current value: 300
delayed_insert_limit     current value: 100
delayed_queue_size       current value: 1000
flush_time               current value: 0
interactive_timeout      current value: 28800
join_buffer_size         current value: 131072
key_buffer_size          current value: 1048540
lower_case_table_names   current value: 0
long_query_time          current value: 10
max_allowed_packet       current value: 1048576
max_binlog_cache_size    current value: 4294967295
max_connections          current value: 100
max_connect_errors       current value: 10
max_delayed_threads      current value: 20
max_heap_table_size      current value: 16777216
max_join_size            current value: 4294967295
max_sort_length          current value: 1024
max_tmp_tables           current value: 32
max_write_lock_count     current value: 4294967295
myisam_sort_buffer_size  current value: 8388608
net_buffer_length        current value: 16384
net_retry_count          current value: 10
net_read_timeout         current value: 30
net_write_timeout        current value: 60
read_buffer_size         current value: 131072
read_rnd_buffer_size     current value: 262144
slow_launch_time         current value: 2
sort_buffer              current value: 2097116
table_cache              current value: 64
thread_concurrency       current value: 10
tmp_table_size           current value: 1048576
thread_stack             current value: 131072
wait_timeout             current value: 28800
@end example

If there is a @code{mysqld} server currently running, you can see what
values it actually is using for the variables by issuing this statement:

@example
mysql> SHOW VARIABLES;
@end example

You can also see some statistics and status indicators for a running server
by issuing this statement:

@example
mysql> SHOW STATUS;
@end example

You can find a full description for all variables in the @code{SHOW VARIABLES}
section in this manual. @xref{SHOW VARIABLES,  , @code{SHOW VARIABLES}}.
For information about status variables, see
@ref{SHOW STATUS,  , @code{SHOW STATUS}}.

Server variable and status information also can be obtained using
@code{mysqladmin}:

@example
shell> mysqladmin variables
shell> mysqladmin extended-status
@end example

MySQL uses algorithms that are very scalable, so you can usually
run with very little memory. However, if you give MySQL more
memory, normally you will also get better performance.

When tuning a MySQL server, the two most important variables to use
are @code{key_buffer_size} and @code{table_cache}.  You should first feel
confident that you have these set appropriately before trying to change
any other variables.

The following examples indicate some typical variable values for different
runtime configurations. The examples use the @code{mysqld_safe} script and
use @code{--name=value} syntax to set the variable @code{name} to the value
@code{value}.  This syntax is available as of MySQL 4.0.  For older versions
of MySQL, take the following differences into account:

@itemize @bullet
@item
Use @code{safe_mysqld} rather than @code{mysqld_safe}.

@item
Set variables using @code{--set-variable=name=value} or @code{-O name=value}
syntax.

@item
For variable names that end in @code{_size}, you may need to specify them
without @code{_size}. For example, the old name for @code{sort_buffer_size} is
@code{sort_buffer}. The old name for @code{read_buffer_size} is
@code{record_buffer}. To see which variables your version of the server
recognizes, use @code{mysqld --help}.

@end itemize


If you have at least 256M of memory and many tables and want maximum
performance with a moderate number of clients, you should use something
like this:

@example
shell> mysqld_safe --key_buffer_size=64M --table_cache=256 \
           --sort_buffer_size=4M --read_buffer_size=1M &
@end example

If you have only 128M of memory and only a few tables, but you still do a
lot of sorting, you can use something like:

@example
shell> mysqld_safe --key_buffer_size=16M --sort_buffer_size=1M
@end example

If you have little memory and lots of connections, use something like this:

@example
shell> mysqld_safe --key_buffer_size=512K --sort_buffer_size=100K \
           --read_buffer_size=100K &
@end example

Or even this:

@example
shell> mysqld_safe --key_buffer_size=512K --sort_buffer_size=16K \
           --table_cache=32 --read_buffer_size=8K -O net_buffer_length=1K &
@end example

If you are doing a @code{GROUP BY} or @code{ORDER BY} on tables that are
much larger than your available memory, you should increase the value of
@code{read_rnd_buffer_size} to speed up the reading of rows after sorting
operations.

When you have installed MySQL, the @file{support-files} directory will
contain some different @file{my.cnf} example files, @file{my-huge.cnf},
@file{my-large.cnf}, @file{my-medium.cnf}, and @file{my-small.cnf}, you can
use as a base to optimize your system.

If there are very many simultaneous connections, swapping problems
may occur unless @code{mysqld} has been configured to use very
little memory for each connection. @code{mysqld} performs better
if you have enough memory for all connections.

Note that if you specicy an option on the command line for @code{mysqld} or
@code{mysqld_safe}, it remains in effect only for that invocation of the server.
To use the option every time the server runs, put it in an option file.

To see the effects of a parameter change, do something like this:

@example
shell> mysqld --key_buffer_size=32m --help
@end example

Make sure that the @code{--help} option is last; otherwise, the effect of any
options listed after it on the command line will not be reflected in the
output.


@node Compile and link options, Memory use, Server parameters, Optimising the Server
@subsection How Compiling and Linking Affects the Speed of MySQL

@cindex linking, speed
@cindex compiling, speed
@cindex speed, compiling
@cindex speed, linking

Most of the following tests are done on Linux with the
MySQL benchmarks, but they should give some indication for
other operating systems and workloads.

You get the fastest executable when you link with @code{-static}.

On Linux, you will get the fastest code when compiling with @code{pgcc}
and @code{-O3}. To compile @file{sql_yacc.cc} with these options, you
need about 200M memory because @code{gcc/pgcc} needs a lot of memory to
make all functions inline. You should also set @code{CXX=gcc} when
configuring MySQL to avoid inclusion of the @code{libstdc++}
library (it is not needed). Note that with some versions of @code{pgcc},
the resulting code will run only on true Pentium processors, even if you
use the compiler option that you want the resulting code to be working on
all x586 type processors (like AMD).

By just using a better compiler and/or better compiler options you can
get a 10-30% speed increase in your application.  This is particularly
important if you compile the SQL server yourself!

We have tested both the Cygnus CodeFusion and Fujitsu compilers, but
when we tested them, neither was sufficiently bug free to allow
MySQL to be compiled with optimizations on.

When you compile MySQL you should only include support for the
character sets that you are going to use. (Option @code{--with-charset=xxx}.)
The standard MySQL binary distributions are compiled with support
for all character sets.

Here is a list of some measurements that we have done:
@itemize @bullet
@item
If you use @code{pgcc} and compile everything with @code{-O6}, the
@code{mysqld} server is 1% faster than with @code{gcc} 2.95.2.

@item
If you link dynamically (without @code{-static}), the result is 13%
slower on Linux.  Note that you still can use a dynamic linked
MySQL library for your client applications. It is the server that is most
critical for performance.

@item
If you strip your @code{mysqld} binary with @code{strip libexec/mysqld},
the resulting binary can be up to 4% faster.

@item
For a connection from a client to a server running on the same host,
if you connect using TCP/IP rather than a Unix socket file, performance is 7.5%
slower. (If you connect to the hostname @code{localhost},
MySQL uses a socket file by default.)

@item
For TCP/IP connections from a client to a server, connecting to a remote
server on another host will be 8-11% slower than connecting to the local
server on the same host, even for connections over 100M Ethernet.

@item
When running our benchmark tests using secure connections (all data
encrypted with internal SSL support) performance was 55% slower.

@item
If you compile with @code{--with-debug=full}, most queries will be 20% slower.
Some queries may take substantially longer (for example,
the MySQL benchmarks ran 35% slower).  If you use @code{--with-debug},
the slowdown will be only 15%.  For a @code{mysqld} version that has
been compiled with @code{--with-debug=full}, you can disable memory
checking at runtime by starting it with the @code{--skip-safemalloc}
option. The end result in this case should be close to when configuring
with @code{--with-debug}.

@item
On a Sun UltraSPARC-IIe, Forte 5.0 is 4% faster than @code{gcc} 3.2.

@item
On a Sun UltraSPARC-IIe, Forte 5.0 is 4% faster in 32-bit mode than in
64-bit mode.

@item
Compiling with @code{gcc} 2.95.2 for UltraSPARC with the option
@code{-mcpu=v8 -Wa,-xarch=v8plusa} gives 4% more performance.

@item
On Solaris 2.5.1, MIT-pthreads is 8-12% slower than Solaris native
threads on a single processor. With more load/CPUs the difference should
be larger.

@item
Running with @code{--log-bin} makes @code{mysqld} 1% slower.

@item
Compiling on Linux-x86 using @code{gcc} without frame pointers
@code{-fomit-frame-pointer} or @code{-fomit-frame-pointer -ffixed-ebp}
makes @code{mysqld} 1-4% faster.
@end itemize

The MySQL-Linux distribution provided by MySQL AB used
to be compiled with @code{pgcc}, but we had to go back to regular @code{gcc}
because of a bug in @code{pgcc} that would generate the code that does
not run on AMD. We will continue using @code{gcc} until that bug is resolved.
In the meantime, if you have a non-AMD machine, you can get a faster
binary by compiling with @code{pgcc}.  The standard MySQL
Linux binary is linked statically to make it faster and more portable.


@node Memory use, DNS, Compile and link options, Optimising the Server
@subsection How MySQL Uses Memory

@cindex memory use

The following list indicates some of the ways that the @code{mysqld} server
uses memory.  Where applicable, the name of the server variable relevant
to the memory use is given:

@itemize @bullet
@item
The key buffer (variable @code{key_buffer_size}) is shared by all
threads; other buffers used by the server are allocated as
needed. @xref{Server parameters}.

@item
Each connection uses some thread-specific space: A stack (default 64K,
variable @code{thread_stack}), a connection buffer (variable
@code{net_buffer_length}), and a result buffer (variable
@code{net_buffer_length}). The connection buffer and result buffer are
dynamically enlarged up to @code{max_allowed_packet} when needed.  When
a query is running, a copy of the current query string is also allocated.

@item
All threads share the same base memory.

@item
Only compressed @code{ISAM} and @code{MyISAM} tables are memory mapped.  This
is because the 32-bit memory space of 4 GB is not large enough for most
big tables. When systems with a 64-bit address space become more
common we may add general support for memory mapping.

@item
Each request doing a sequential scan over a table allocates a read buffer
(variable @code{read_buffer_size}).

@item
When reading rows in ``random'' order (for example, after a sort) a
random-read buffer is allocated to avoid disk seeks.
(variable @code{read_rnd_buffer_size}).

@item
All joins are done in one pass, and most joins can be done without even
using a temporary table. Most temporary tables are memory-based (@code{HEAP})
tables.  Temporary tables with a large record length (calculated as the
sum of all column lengths) or that contain @code{BLOB} columns are
stored on disk.

One problem in MySQL before Version 3.23.2 is that if an in-memory @code{HEAP}
table exceeds the size of @code{tmp_table_size}, you get the error @code{The
table tbl_name is full}. From 3.23.2 on, this is handled
automatically by changing the in-memory @code{HEAP} table to a disk-based
@code{MyISAM} table as necessary. To work around this problem, you can
increase the temporary table size by setting the @code{tmp_table_size}
option to @code{mysqld}, or by setting the SQL option
@code{BIG_TABLES} in the client program.  @xref{SET OPTION, ,
@code{SET} Syntax}. In MySQL Version 3.20, the maximum size of the
temporary table is @code{record_buffer*16}; if you are using this
version, you have to increase the value of @code{record_buffer}. You can
also start @code{mysqld} with the @code{--big-tables} option to always
store temporary tables on disk. However, this will affect the speed of
many complicated queries.

@item
Most requests that perform a sort allocate a sort buffer and 0 to 2 temporary
files depending on the result set size. @xref{Temporary files}.

@item
Almost all parsing and calculating is done in a local memory store. No
memory overhead is needed for small items and the normal slow memory
allocation and freeing is avoided. Memory is allocated only for
unexpectedly large strings; this is done with @code{malloc()} and
@code{free()}.

@item
Each index file is opened once and the datafile is opened once for each
concurrently running thread. For each concurrent thread, a table structure,
column structures for each column, and a buffer of size @code{3 * n} is
allocated (where @code{n} is the maximum row length, not counting @code{BLOB}
columns). A @code{BLOB} column uses 5 to 8 bytes plus the length of the
@code{BLOB} data. The @code{ISAM} and @code{MyISAM} storage engines use one
extra row buffer for internal usage.

@item
For each table having @code{BLOB} columns, a buffer is enlarged dynamically
to read in larger @code{BLOB} values. If you scan a table, a buffer as large
as the largest @code{BLOB} value is allocated.

@item
Handler structures for all in-use tables are saved in a cache and managed as a
FIFO. Normally the cache has 64 entries. If a table has been used by two
running threads at the same time, the cache contains two entries for the
table. @xref{Table cache}.

@item
A @code{mysqladmin flush-tables} command (or @code{FLUSH TABLES} statement)
closes all tables that are not in
use and marks all in-use tables to be closed when the currently executing
thread finishes. This will effectively free most in-use memory.
@end itemize

@code{ps} and other system status programs may report that @code{mysqld}
uses a lot of memory. This may be caused by thread-stacks on different
memory addresses. For example, the Solaris version of @code{ps} counts
the unused memory between stacks as used memory. You can verify this by
checking available swap with @code{swap -s}. We have tested
@code{mysqld} with commercial memory-leakage detectors, so there should
be no memory leaks.


@node DNS, SET OPTION, Memory use, Optimising the Server
@subsection How MySQL uses DNS

@cindex DNS
@cindex hostname caching

When a new client connects to @code{mysqld}, @code{mysqld} spawns a
new thread to handle the request.  This thread first checks if the
hostname is in the hostname cache. If not, the thread attempts to resolve the
hostname:

@itemize @bullet
@item
If the operating system supports the thread-safe @code{gethostbyaddr_r()} and
@code{gethostbyname_r()} calls, the thread uses them to perform hostname
resolution.

@item
If the operating system doesn't support the thread-safe calls, the
thread locks a mutex and calls @code{gethostbyaddr()} and
@code{gethostbyname()} instead. Note that in this case no other thread
can resolve hostnames that are not in the hostname cache until the
first thread unlocks the mutex.

@end itemize

You can disable DNS hostname lookups by starting @code{mysqld} with the
@code{--skip-name-resolve} option.  However, in this case you can use only IP
numbers in the MySQL grant tables.

If you have a very slow DNS and many hosts, you can get more performance by
either disabling DNS lookups with @code{--skip-name-resolve} or by
increasing the @code{HOST_CACHE_SIZE} define (default value: 128) and
recompiling @code{mysqld}.

You can disable the hostname cache by starting the server with the
@code{--skip-host-cache} option. To clear the hostname cache, issue a
@code{FLUSH HOSTS} statement or execute the @code{mysqladmin flush-hosts}
command.

If you want to disallow TCP/IP connections entirely, start @code{mysqld} with
the @code{--skip-networking} option.


@c TODO: rename this node, because OPTION is deprecated

@node SET OPTION,  , DNS, Optimising the Server
@subsection @code{SET} Syntax

@findex SET
@findex SET OPTION

@c help_category Data Manipulation

@c example_for_help_topic SET
@example
SET [GLOBAL | SESSION] sql_variable=expression,
    [[GLOBAL | SESSION] sql_variable=expression] ...
@end example

@c description_for_help_topic SET  GLOBAL SESSION VARIABLE
@code{SET} sets various options that affect the operation of the
server or your client.

The following examples shows the different syntaxes one can use to set
variables:

In old MySQL versions we allowed the use of the @code{SET OPTION} syntax,
but this syntax is now deprecated.

In MySQL 4.0.3 we added the @code{GLOBAL} and @code{SESSION} options
and access to most important startup variables.

@code{LOCAL} can be used as a synonym for @code{SESSION}.

If you set several variables on the same command line, the last used
@code{GLOBAL | SESSION} mode is used.
@c end_description_for_help_topic

@example
SET sort_buffer_size=10000;
SET @@@@local.sort_buffer_size=10000;
SET GLOBAL sort_buffer_size=1000000, SESSION sort_buffer_size=1000000;
SET @@@@sort_buffer_size=1000000;
SET @@@@global.sort_buffer_size=1000000, @@@@local.sort_buffer_size=1000000;
@end example

The @code{@@@@variable_name} syntax is supported to make MySQL syntax
compatible with some other databases.

The different system variables you can set are described in the system
variable section of this manual. @xref{System Variables}.

If you are using @code{SESSION} (the default), the option you set remains
in effect until the current session ends or until you set the option to
a different value. If you use @code{GLOBAL}, which requires the
@code{SUPER} privilege, the option is remembered and used for new
connections until the server restarts. If you want to make an option
permanent, you should set it in an option file.
@xref{Option files}.

To avoid incorrect usage, MySQL will produce an error if you use @code{SET
GLOBAL} with a variable that can only be used with @code{SET SESSION} or if
you are not using @code{SET GLOBAL} with a global variable.

If you want to set a @code{SESSION} variable to the @code{GLOBAL} value or a
@code{GLOBAL} value to the MySQL default value, you can set it to
@code{DEFAULT}.

@example
SET max_join_size=DEFAULT;
@end example

This is identical to:

@example
SET @@@@session.max_join_size=@@@@global.max_join_size;
@end example

If you want to restrict the maximum value to which a server variable can be set
with the @code{SET} command, you can specify this maximum by using the
@code{--maximum-variable-name} command line option. @xref{Server
options}.

You can get a list of most variables with @code{SHOW VARIABLES}.
@xref{SHOW VARIABLES,  , @code{SHOW VARIABLES}}.  You can get the value for
a specific value with the @code{@@@@[global.|local.]variable_name} syntax:
@example
SHOW VARIABLES like "max_join_size";
SHOW GLOBAL VARIABLES like "max_join_size";
SELECT @@@@max_join_size, @@@@global.max_join_size;
@end example

Here follows a description of the variables that use
a non-standard @code{SET} syntax and some of the other
variables.  The other variable definitions can be found in the system
variable section, among the startup options or in the description of
@code{SHOW VARIABLES}.
@xref{System Variables}.
@xref{Server options}.
@xref{SHOW VARIABLES,  , @code{SHOW VARIABLES}}.

@table @code

@item AUTOCOMMIT= 0 | 1
If set to @code{1}, all changes to a table will be done at once. To start
a multi-command transaction, you have to use the @code{BEGIN}
statement. @xref{COMMIT}. If set to @code{0} you have to use @code{COMMIT}
to accept that transaction or @code{ROLLBACK} to cancel it.
@xref{COMMIT}.
Note that when you change @code{AUTOCOMMIT} mode from @code{0} to @code{1},
MySQL performs an automatic @code{COMMIT} of any open transaction.

@item BIG_TABLES = 0 | 1
@cindex table is full
If set to @code{1}, all temporary tables are stored on disk rather than in
memory.  This will be a little slower, but you will not get the error
@code{The table tbl_name is full} for big @code{SELECT} operations that
require a large temporary table.  The default value for a new connection is
@code{0} (that is, use in-memory temporary tables).
This variable previously was named @code{SQL_BIG_TABLES}.  In MySQL 4.0, you
should normally never need to set this variable, because MySQL automatically
converts in-memory tables to disk-based tables as necessary.

@item CHARACTER SET character_set_name | DEFAULT
This maps all strings from and to the client with the given mapping.
Currently the only option for @code{character_set_name} is
@code{cp1251_koi8}, but you can easily add new mappings by editing the
@file{sql/convert.cc} file in the MySQL source distribution.  The
default mapping can be restored by using a @code{character_set_name} value of
@code{DEFAULT}.

Note that the syntax for setting the @code{CHARACTER SET} option differs
from the syntax for setting the other options.

@c THIS IS NOT IMPLEMENTED
@c @item DATE_FORMAT = format_str
@c Determines how the server converts @code{DATE} values to strings. This
@c variable is available as a global, local, or command-line
@c option. @code{format_str} can be specified conveniently using the
@c @code{GET_FORMAT()} function.
@c See @xref{Date and time functions}.

@c THIS IS NOT IMPLEMENTED
@c @item DATETIME_FORMAT = format_str
@c Determines how the server converts @code{DATETIME} values to
@c strings. This variable is available as a global, local, or command-line
@c option. @code{format_str} can be specified conveniently using the
@c @code{GET_FORMAT()} function.
@c See @xref{Date and time functions}.

@item INSERT_ID = #
Set the value to be used by the following @code{INSERT} or @code{ALTER TABLE}
command when inserting an @code{AUTO_INCREMENT} value.  This is mainly used
with the binary log.

@item LAST_INSERT_ID = #
Set the value to be returned from @code{LAST_INSERT_ID()}. This is stored in
the binary log when you use @code{LAST_INSERT_ID()} in a command that updates
a table. Setting this variable does not update @code{mysql_insert_id()}.

@item LOW_PRIORITY_UPDATES = 0 | 1
If set to @code{1}, all @code{INSERT}, @code{UPDATE}, @code{DELETE}, and
@code{LOCK TABLE WRITE} statements wait until there is no pending
@code{SELECT} or @code{LOCK TABLE READ} on the affected table.
This variable previously was named @code{SQL_LOW_PRIORITY_UPDATES}.

@item MAX_JOIN_SIZE = value | DEFAULT

Don't allow @code{SELECT} statements that will probably need to examine more
than @code{value} row combinations or is likely to do more than @code{value}
disk seeks.  By setting this value, you can catch @code{SELECT} statements
where keys are not used properly and that would probably take a long
time. Setting this to a value other than @code{DEFAULT} resets the
@code{SQL_BIG_SELECTS} value to @code{0}.  If you set the
@code{SQL_BIG_SELECTS} value
again, the @code{SQL_MAX_JOIN_SIZE} variable will be ignored.  You can
set a default value for this variable by starting @code{mysqld} with the
@code{--max_join_size=value} option.  This variable previously was named
@code{SQL_MAX_JOIN_SIZE}.

Note that if a query result already is in the query cache, no result size
check is performed, because the result has already been computed and it will
not burden the server to send it to the client.

@item PASSWORD = PASSWORD('some password')
@cindex passwords, setting
Set the password for the current user. Any non-anonymous user can change his
own password!

@item PASSWORD FOR user = PASSWORD('some password')
Set the password for a specific user on the current server host. Only a user
with access to the @code{mysql} database can do this.  The user should be
given in @code{user@@hostname} format, where @code{user} and @code{hostname}
are exactly as they are listed in the @code{User} and @code{Host} columns of
the @code{mysql.user} table entry.  For example, if you had an entry with
@code{User} and @code{Host} fields of @code{'bob'} and @code{'%.loc.gov'},
you would write:

@example
mysql> SET PASSWORD FOR 'bob'@@'%.loc.gov' = PASSWORD('newpass');
@end example

Which is equivalent to:

@example
mysql> UPDATE mysql.user SET Password=PASSWORD('newpass')
    ->                   WHERE User='bob' AND Host='%.loc.gov';
mysql> FLUSH PRIVILEGES;
@end example

@item QUERY_CACHE_TYPE = OFF | ON | DEMAND
@item QUERY_CACHE_TYPE = 0   | 1  | 2
Set query cache setting for this thread.
@multitable @columnfractions .20 .70
@item @strong{Option} @tab @strong{Description}
@item @code{0} or @code{OFF} @tab Don't cache or retrieve results.
@item @code{1} or @code{ON} @tab Cache all results except @code{SELECT SQL_NO_CACHE ...} queries.
@item @code{2} or @code{DEMAND} @tab Cache only @code{SELECT SQL_CACHE ...} queries.
@end multitable

@item SQL_AUTO_IS_NULL = 0 | 1
If set to @code{1} (default), you can find the last inserted row for a table
that contains an @code{AUTO_INCREMENT} column by using the following construct:
@code{WHERE auto_increment_column IS NULL}.  This is used by some
ODBC programs like Access.

@item SQL_BIG_SELECTS = 0 | 1
If set to @code{0}, MySQL aborts @code{SELECT} statements
that probably will take a very long time (that is, statements for which
the optimizer estimates that the number of of examined rows probably will
exceed the value of @code{MAX_JOIN_SIZE}).
This is useful when an inadvisable @code{WHERE} statement has been
issued.  The default value for a new connection is @code{1}, which allows
all @code{SELECT} statements.

If you set @code{MAX_JOIN_SIZE} to a value other than @code{DEFAULT},
@code{SQL_BIG_SELECTS} will be set to @code{0}.

@item SQL_BUFFER_RESULT = 0 | 1
@code{SQL_BUFFER_RESULT} forces the result from @code{SELECT} statements
to be put into a temporary table. This will help MySQL free the
table locks early and will help in cases where it takes a long time to
send the result set to the client.

@item SQL_LOG_BIN = 0 | 1
If set to @code{0}, no logging is done to the binary log for the client,
if the client has the @code{SUPER} privilege.

@item SQL_LOG_OFF = 0 | 1
If set to @code{1}, no logging is done to the standard log for this
client, if the client has the @code{SUPER} privilege.

@item SQL_LOG_UPDATE = 0 | 1
If set to @code{0}, no logging is done to the update log for the client,
if the client has the @code{SUPER} privilege.
This variable is deprecated starting from version 5.0.0 and mapped to
@code{SQL_LOG_BIN} (@pxref{News-5.0.0}).

@item SQL_QUOTE_SHOW_CREATE = 0 | 1
If set to @code{1}, @code{SHOW CREATE TABLE} quotes
table and column names. This is @strong{on} by default,
so that replication of tables with fancy column names will work.
@ref{SHOW CREATE TABLE, , @code{SHOW CREATE TABLE}}.

@item SQL_SAFE_UPDATES = 0 | 1
If set to @code{1}, MySQL aborts @code{UPDATE} or
@code{DELETE} statements that do not use a key or @code{LIMIT} in the
@code{WHERE} clause. This makes it possible to catch wrong updates
when creating SQL statements by hand.

@item SQL_SELECT_LIMIT = value | DEFAULT
The maximum number of records to return from @code{SELECT} statements.  If
a @code{SELECT} has a @code{LIMIT} clause, the @code{LIMIT} takes precedence
over the value of @code{SQL_SELECT_LIMIT}.  The default value for a new
connection is ``unlimited.'' If you have changed the limit, the default value
can be restored by using a @code{SQL_SELECT_LIMIT} value of @code{DEFAULT}.

@item TIMESTAMP = timestamp_value | DEFAULT
Set the time for this client.  This is used to get the original timestamp if
you use the binary log to restore rows.  @code{timestamp_value} should be a
Unix epoch timestamp, not a MySQL timestamp.

@c THIS IS NOT IMPLEMENTED
@c @item TIME_FORMAT = format_str
@c Determines how the server converts @code{TIME} values to strings. This
@c variable is available as a global, local, or command-line
@c option. @code{format_str} can be specified conveniently using the
@c @code{GET_FORMAT()} function.
@c See @xref{Date and time functions}.

@end table

@node Disk issues,  , Optimising the Server, MySQL Optimisation
@section Disk Issues

@cindex disk issues
@cindex performance, disk issues

@itemize @bullet
@item
As mentioned before, disks seeks are a big performance bottleneck. This
problems gets more and more apparent when the data starts to grow so
large that effective caching becomes impossible. For large databases,
where you access data more or less randomly, you can be sure that you
will need at least one disk seek to read and a couple of disk seeks to
write things. To minimise this problem, use disks with low seek times.

@item
Increase the number of available disk spindles (and thereby reduce
the seek overhead) by either symlink files to different disks or striping
the disks.

@table @strong
@item Using symbolic links
This means that, for MyISAM tables, you symlink the index file and/or
datafile from their usual location in the data directory to another disk
(that may also be striped). This makes both the seek and read times better,
assuming the disk is not used for other purposes as well). @xref{Symbolic
links}.

@cindex striping, defined
@item Striping
Striping means that you have many disks and put the first block on the
first disk, the second block on the second disk, and the Nth on the
(N mod number_of_disks) disk, and so on. This means if your normal data
size is less than the stripe size (or perfectly aligned) you will get
much better performance. Striping is very dependent on the operating system
and the stripe size, so benchmark your application with different
stripe sizes. @xref{Custom Benchmarks}.

Note that the speed difference for striping is @strong{very} dependent
on the parameters. Depending on how you set the striping parameters and
number of disks you may get a difference in orders of magnitude. Note that
you have to choose to optimize for random or sequential access.
@end table

@item
For reliability you may want to use RAID 0+1 (striping + mirroring), but
in this case you will need 2*N drives to hold N drives of data. This is
probably the best option if you have the money for it!  However, you may
also have to invest in some volume-management software to handle it
efficiently.

@item
A good option is to vary the RAID level according to how critical a type of
data is. For example, have semi-important data that can be regenerated
on a RAID 0 disk while storing really important data such as host information
and logs on a RAID 0+1 or RAID N disk. RAID N can be a problem if you
have many writes because of the time to update the parity bits.

@item
On Linux, you can get much more performance (up to 100% under load is
not uncommon) by using @code{hdparm} to configure your disk's interface!  The
following should be quite good @code{hdparm} options for MySQL (and
probably many other applications):

@example
hdparm -m 16 -d 1
@end example

Note that performance and reliability when using the above depends
on your hardware, so we strongly suggest that you test your system
thoroughly after using @code{hdparm}.  Please consult the @code{hdparm}
man page for more information.  If @code{hdparm} is not used wisely,
filesystem corruption may result, so back up everything before
experimenting!

@item
You may also set the parameters for the filesystem that the database
uses:

@itemize @bullet
@item
If you don't need to know when files were last accessed (which is
not really useful on a database server), you can mount your
filesystems with the @code{-o noatime} option.  That skips updates
to the last access time in inodes on the filesystem, which avoids
some disk seeks.

@item
On many operating systems you can mount the disks with the @code{-o async}
option to set the filesystem to be updated asynchronously.  If your computer is
reasonably stable, this should give you more performance without sacrificing
too much reliability.  (This flag is on by default on Linux.)

@end itemize

@end itemize

@menu
* Symbolic links::              Using Symbolic Links
@end menu


@node Symbolic links,  , Disk issues, Disk issues
@subsection Using Symbolic Links

@cindex symbolic links
@cindex links, symbolic

You can move tables and databases from the database directory to other
locations and replace them with symbolic links to the new locations.
You might want to do this, for example, to move a database to a file
system with more free space or increase the speed of your system by
spreading your tables to different disk.

The recommended way to do this is to just symlink databases to a
different disk and only symlink tables as a last resort.

@menu
* Symbolic links to databases::  Using Symbolic Links for Databases on Unix
* Symbolic links to tables::    Using Symbolic Links for Tables on Unix
* Windows symbolic links::      Using Symbolic Links for Databases on Windows
@end menu


@node Symbolic links to databases, Symbolic links to tables, Symbolic links, Symbolic links
@subsubsection Using Symbolic Links for Databases on Unix

@cindex databases, symbolic links

On Unix, the way to symlink a database is to first create a directory on some
disk where you have free space and then create a symlink to it from
the MySQL database directory.

@example
shell> mkdir /dr1/databases/test
shell> ln -s /dr1/databases/test mysqld-datadir
@end example

MySQL doesn't support that you link one directory to multiple
databases.  Replacing a database directory with a symbolic link will
work fine as long as you don't make a symbolic link between databases.
Suppose you have a database @code{db1} under the MySQL data
directory, and then make a symlink @code{db2} that points to @code{db1}:

@example
shell> cd /path/to/datadir
shell> ln -s db1 db2
@end example

Now, for any table @code{tbl_a} in @code{db1}, there also appears to be
a table @code{tbl_a} in @code{db2}.  If one thread updates @code{db1.tbl_a}
and another thread updates @code{db2.tbl_a}, there will be problems.

If you really need this, you must change the following code in
@file{mysys/mf_format.c}:

@example
if (flag & 32 || (!lstat(to,&stat_buff) && S_ISLNK(stat_buff.st_mode)))
@end example

to

@example
if (1)
@end example

On Windows you can use internal symbolic links to directories by compiling
MySQL with @code{-DUSE_SYMDIR}. This allows you to put different
databases on different disks. @xref{Windows symbolic links}.


@node Symbolic links to tables, Windows symbolic links, Symbolic links to databases, Symbolic links
@subsubsection Using Symbolic Links for Tables on Unix

@cindex tables, symbolic links

Before MySQL 4.0 you should not symlink tables unless you are
@strong{very} careful with them. The problem is that if you run @code{ALTER
TABLE}, @code{REPAIR TABLE}, or @code{OPTIMIZE TABLE} on a symlinked
table, the symlinks will be removed and replaced by the original
files. This happens because these statements work by creating a
temporary file in the database directory and replacing the original
file with the temporary file when the statement operation is complete.

You should not symlink tables on systems that don't have a fully
working @code{realpath()} call. (At least Linux and Solaris support
@code{realpath()}). You can check if your system supports symbolic links
by doing @code{SHOW VARIABLES LIKE 'have_symlink'}.

In MySQL 4.0, symlinks are fully supported only for @code{MyISAM}
tables.  For other table types, you will probably get strange problems
if you try to use symbolic links on files in the operating system with
any of the above commands.

The handling of symbolic links for @code{MyISAM} tables in MySQL 4.0 works
the following way:

@itemize @bullet
@item
In the data directory you will always have the table definition
file, the datafile, and the index files The datafile and index file
can be moved elsewhere and replaced in the data directory by
symlinks. The definition file cannot.

@item
You can symlink the datafile and the index file to different directories
independently of the other.

@item
The symlinking can be done at the operating system level (if @code{mysqld} is
not running) or with SQL by using the @code{DATA DIRECTORY} and @code{INDEX
DIRECTORY} options to @code{CREATE TABLE}.
@xref{CREATE TABLE,  , @code{CREATE TABLE}}.

@item
@code{myisamchk} will not replace a symlink with the datafile or index file.
It works directly on the file a symlink points to. Any temporary files
will be created in the same directory where the datafile or index file is
located.

@item
When you drop a table that is using symlinks, both the symlink and the
file the symlink points to are dropped.  This is a good reason to why you
should @strong{not} run @code{mysqld} as @code{root} or allow
persons to have write access to the MySQL database directories.

@item
@c TODO: is this also true for RENAME table?
If you rename a table with @code{ALTER TABLE RENAME} and you don't move
the table to another database, the symlinks in the database directory
are renamed to the new names and the datafile and index file are
renamed accordingly.

@item
@c TODO: is this also true for RENAME table?
If you use @code{ALTER TABLE RENAME} to move a table to another database,
the table is moved to the other database directory and the old
symlinks and the files to which they pointed are deleted.  (In other words,
the new table will not be symlinked.)

@item
If you are not using symlinks, you should use the @code{--skip-symlink}
option to @code{mysqld} to ensure that no one can use @code{mysqld} to drop
or rename a file outside of the data directory.
@end itemize

@code{SHOW CREATE TABLE} doesn't report if the table has symbolic links
prior to MySQL 4.0.15. This is also true for @code{mysqldump}, which uses
@code{SHOW CREATE TABLE} to generate @code{CREATE TABLE} statements.

Things that are not yet supported:

@cindex TODO, symlinks
@itemize @bullet
@item
@code{ALTER TABLE} ignores the @code{DATA DIRECTORY} and @code{INDEX
DIRECTORY} table options.
@item
@code{BACKUP TABLE} and @code{RESTORE TABLE} don't respect symbolic
links.
@item
The @code{frm} file must @strong{never} be a symbolic link (as said
previously, only the data and index files can be symbolic links).
Doing this (for example to make synonyms), will produce incorrect
results.
Suppose you have a database @code{db1} under the MySQL data
directory, a table @code{tbl1} in this database, and in the @code{db1}
directory you make a symlink @code{tbl2} that points to @code{tbl1}:

@example
shell> cd /path/to/datadir/db1
shell> ln -s tbl1.frm tbl2.frm
shell> ln -s tbl1.MYD tbl2.MYD
shell> ln -s tbl1.MYI tbl2.MYI
@end example

Now if one thread reads @code{db1.tbl1} and another thread updates
@code{db1.tbl2}, there will be problems: the query cache will be fooled
(it will believe @code{tbl1} has not been updated so will return
out-of-date results), the @code{ALTER} commands on @code{tbl2} will also
fail.
@end itemize


@node Windows symbolic links,  , Symbolic links to tables, Symbolic links
@subsubsection Using Symbolic Links for Databases on Windows

@cindex symbolic links
@cindex using multiple disks to start data
@cindex disks, splitting data across

Beginning with MySQL Version 3.23.16, the @code{mysqld-max}
and @code{mysql-max-nt} servers in the MySQL distribution are
compiled with the @code{-DUSE_SYMDIR} option.  This allows you to put a
database directory on a different disk by setting up a symbolic link to it.
This is similar to the way that symbolic links work on Unix, though the
procedure for setting up the link is different.

On Windows, you make a symbolic link to a MySQL database by creating a file
that contains the path to the destination directory. Save the file in
the data directory using the filename @file{db_name.sym}, where
@code{db_name} is the database name.

For example, if the MySQL data directory is @file{C:\mysql\data}
and you want to have database @code{foo} located at @file{D:\data\foo},
you should create the file @file{C:\mysql\data\foo.sym} that contains
the pathname @code{D:\data\foo\}.  After that, all tables created in
the database @code{foo} will be created in @file{D:\data\foo}.
The @file{D:\data\foo} directory must exist for this to work. Also,
note that the symbolic link will not be used if a directory with
the database name exists in the MySQL data directory.  This means
that if you already have a database directory named @file{foo} in
the data directory, you must move it to @file{D:\data} before the
symbolic link will be effective.  (To avoid problems, the server
should not be running when you move the database directory.)

Note that because of the speed penalty you get when opening every table,
we have not enabled this by default even if you have compiled
MySQL with support for this. To enable symlinks you should put
in your @file{my.cnf} or @file{my.ini} file the following entry:

@example
[mysqld]
symbolic-links
@end example

In MySQL 4.0, symbolic links are enabled by default. If you don't need them,
you can disable them with the @code{skip-symbolic-links} option.


@node Client-Side Scripts, Reference, MySQL Optimisation, Top
@chapter MySQL Client and Utility Programs

@c TODO: my_print_defaults

@menu
* Client-Side Overview::        Overview of the Client-Side Scripts and Utilities
* mysql::                       @code{mysql}, The Command-line Tool
* mysqlcc::                     @code{mysqlcc}, The MySQL Control Center
* mysqladmin::                  @code{mysqladmin}, Administering a MySQL Server
* mysqlbinlog::                 @code{mysqlbinlog}, Executing the queries from a binary log
* Using mysqlcheck::            Using @code{mysqlcheck} for Table Maintenance and Crash Recovery
* mysqldump::                   @code{mysqldump}, Dumping Table Structure and Data
* mysqlhotcopy::                @code{mysqlhotcopy}, Copying MySQL Databases and Tables
* mysqlimport::                 @code{mysqlimport}, Importing Data from Text Files
* mysqlshow::                   @code{mysqlshow}, Showing Databases, Tables, and Columns
* myisampack::                  @code{myisampack}, The MySQL Compressed Read-only Table Generator
* mysql_config::                @code{mysql_config}, Get compile options for compiling clients
* perror::                      @code{perror}, Explaining Error Codes
@end menu


@node Client-Side Overview, mysql, Client-Side Scripts, Client-Side Scripts
@section Overview of the Client-Side Scripts and Utilities

@cindex environment variables
@cindex programs, list of

All MySQL clients that communicate with the server using the
@code{mysqlclient} library use the following environment variables:

@tindex @code{MYSQL_UNIX_PORT} environment variable
@tindex environment variable, @code{MYSQL_UNIX_PORT}
@tindex @code{MYSQL_TCP_PORT} environment variable
@tindex environment variable, @code{MYSQL_TCP_PORT}
@tindex @code{MYSQL_PWD} environment variable
@tindex environment variable, @code{MYSQL_PWD}
@tindex @code{MYSQL_DEBUG} environment variable
@tindex environment variable, @code{MYSQL_DEBUG}
@multitable @columnfractions .25 .60
@item @strong{Name} @tab @strong{Description}
@item @code{MYSQL_UNIX_PORT} @tab The default socket; used for connections to @code{localhost}
@item @code{MYSQL_TCP_PORT}  @tab The default TCP/IP port
@item @code{MYSQL_PWD} @tab The default password
@item @code{MYSQL_DEBUG} @tab Debug-trace options when debugging
@item @code{TMPDIR} @tab The directory where temporary tables/files are created
@end multitable

Use of @code{MYSQL_PWD} is insecure.
@xref{Connecting}.

@tindex @code{MYSQL_HISTFILE} environment variable
@tindex environment variable, @code{MYSQL_HISTFILE}
@tindex @code{HOME} environment variable
@tindex environment variable, @code{HOME}
@cindex history file
@cindex command-line history
@tindex .mysql_history file
On Unix,
the @file{mysql} client uses the file named in the @code{MYSQL_HISTFILE}
environment variable to save the command-line history. The default value for
the history file is @file{$HOME/.mysql_history}, where @code{$HOME} is the
value of the @code{HOME} environment variable. @xref{Environment variables}.

If you do not want to maintain a file that contains a record of your queries,
first remove @file{.mysql_history} if it exists, then use either of the
following techniques:

@itemize @bullet

@item
Set the @code{MYSQL_HISTFILE} variable to @file{/dev/null}. To cause this
setting to take effect each time you log in, put the setting in one of
your shell's startup files.

@item
Create @file{.mysql_histfile} as a symbolic link to @file{/dev/null}:

@example
shell> ln -s /dev/null $HOME/.mysql_history
@end example

You need do this only once.

@end itemize

All MySQL programs take many different options. However, every
MySQL program provides a @code{--help} option that you can use
to get a full description of the program's different options. For example, try
@code{mysql --help}.

You can override default options for all standard programs by specifying
options on the command line or in an option file.
@ref{Program Options}.

The following list briefly describes the MySQL client programs and utilities:

@table @code

@cindex @code{msql2mysql}
@item msql2mysql
A shell script that converts @code{mSQL} programs to MySQL. It doesn't
handle all cases, but it gives a good start when converting.

@cindex @code{mysql}
@item mysql
The command-line tool for interactively entering queries or executing
queries from a file in batch mode.
@xref{mysql, , @code{mysql}}.

@cindex @code{mysqlcc}
@item mysqlcc
This program provides a graphical interface for interacting with the
server.
@xref{mysqlcc, , @code{mysqlcc}}.

@cindex @code{mysqlaccess}
@item mysqlaccess
A script that checks the access privileges for a host, user, and database
combination.

@cindex @code{mysqladmin}
@item mysqladmin
Utility for performing administrative operations, such as creating or
dropping databases, reloading the grant tables, flushing tables to disk, and
reopening log files.  @code{mysqladmin} can also be used to retrieve version,
process, and status information from the server.
@xref{mysqladmin, , @code{mysqladmin}}.

@cindex @code{mysqlbinlog}
@item mysqlbinlog
Utility for reading queries from a binary log. Can be used to recover
from a crash with an old backup.
@xref{mysqlbinlog, , @code{mysqlbinlog}}.

@cindex @code{mysqldump}
@item mysqldump
Dumps a MySQL database into a file as SQL statements or
as tab-separated text files. Enhanced freeware originally by Igor Romanenko.
@xref{mysqldump, , @code{mysqldump}}.

@cindex @code{mysqlimport}
@item mysqlimport
Imports text files into their respective tables using @code{LOAD DATA
INFILE}. @xref{mysqlimport, , @code{mysqlimport}}.

@cindex @code{mysqlshow}
@item mysqlshow
Displays information about databases, tables, columns, and indexes.

@cindex @code{replace}
@item replace
A utility program that is used by @code{msql2mysql}, but that has more
general applicability as well.  @code{replace} changes strings in place in
files or on the standard input. Uses a finite state machine to match longer
strings first. Can be used to swap strings. For example, this command
swaps @code{a} and @code{b} in the given files:

@example
shell> replace a b b a -- file1 file2 ...
@end example
@end table


@node mysql, mysqlcc, Client-Side Overview, Client-Side Scripts
@section @code{mysql}, The Command-line Tool

@cindex command-line tool
@cindex tools, command-line
@cindex scripts
@cindex @code{mysql}

@menu
* Batch Commands::              How to Run SQL Commands from a Text File
@end menu

@code{mysql} is a simple SQL shell (with GNU @code{readline} capabilities).
It supports interactive and non-interactive use. When used interactively,
query results are presented in an ASCII-table format. When used
non-interactively (for example, as a filter), the result is presented in
tab-separated format.  (The output format can be changed using command-line
options.)  You can run scripts simply like this:

@example
shell> mysql database < script.sql > output.tab
@end example

If you have problems due to insufficient memory in the client, use the
@code{--quick} option!  This forces @code{mysql} to use
@code{mysql_use_result()} rather than @code{mysql_store_result()} to
retrieve the result set.

Using @code{mysql} is very easy. Just start it as follows:
@code{mysql database} or @code{mysql --user=user_name --password=your_password
database}. Type an SQL statement, end it with @samp{;}, @samp{\g}, or @samp{\G}
and press Enter.

@cindex @code{mysql} command-line options
@cindex command-line options, @code{mysql}
@cindex options, command-line, @code{mysql}
@cindex startup parameters, @code{mysql}
@code{mysql} supports the following options:

@table @code
@cindex @code{help}, @code{mysql} option
@item -?, --help
Display this help and exit.

@cindex @code{no-auto-rehash}, @code{mysql} option
@item -A, --no-auto-rehash
No automatic rehashing. One has to use 'rehash' to get table and field
completion. This gives a quicker start of mysql.

@cindex @code{prompt}, @code{mysql} option
@item --prompt=...
Set the mysql prompt to specified format.

@cindex @code{no-beep}, @code{mysql} option
@item -b, --no-beep
Turn off beep-on-error.

@cindex @code{batch}, @code{mysql} option
@item -B, --batch
Print results with a tab as separator, each row on a new line. Doesn't use
history file.

@cindex @code{character-sets-dir}, @code{mysql} option
@item --character-sets-dir=...
Directory where character sets are located.

@cindex @code{compress}, @code{mysql} option
@item -C, --compress
Use compression in server/client protocol.

@cindex @code{debug}, @code{mysql} option
@item -#, --debug[=...]
Debug log. Default is 'd:t:o,/tmp/mysql.trace'.

@cindex @code{database}, @code{mysql} option
@item -D, --database=...
Database to use. This is mainly useful in the @file{my.cnf} file.

@cindex @code{default-character-set}, @code{mysql} option
@item --default-character-set=...
Set the default character set.

@cindex @code{execute}, @code{mysql} option
@item -e, --execute=...
Execute command and quit. (Output like with --batch)

@cindex @code{vertical}, @code{mysql} option
@item -E, --vertical
Print the output of a query (rows) vertically. Without this option you
can also force this output by ending your statements with @code{\G}.

@cindex @code{force}, @code{mysql} option
@item -f, --force
Continue even if we get an SQL error.

@cindex @code{no-named-commands}, @code{mysql} option
@item -g, --no-named-commands
Named commands are disabled. Use \* form only, or use named commands
only in the beginning of a line ending with a semicolon (@samp{;}). Since
Version 10.9, the client now starts with this option @strong{enabled} by default!
With the -g option, long format commands will still work from the first
line, however.

@cindex @code{enable-named-commands}, @code{mysql} option
@item -G, --enable-named-commands
Named commands are @strong{enabled}.  Long format commands are allowed as
well as shortened \* commands.

@cindex @code{ignore-space}, @code{mysql} option
@item -i, --ignore-space
Ignore space after function names.

@cindex @code{host}, @code{mysql} option
@item -h, --host=...
Connect to the given host.

@cindex @code{html}, @code{mysql} option
@item -H, --html
Produce HTML output.

@cindex @code{xml}, @code{mysql} option
@item -X, --xml
Produce XML output.

@cindex @code{skip-line-numbers}, @code{mysql} option
@item -L, --skip-line-numbers
Don't write line number for errors. Useful when one wants to compare result
files that includes error messages

@cindex @code{no-pager}, @code{mysql} option
@item --no-pager
Disable pager and print to stdout. See interactive help (\h) also.

@cindex @code{no-tee}, @code{mysql} option
@item --no-tee
Disable outfile. See interactive help (\h) also.

@cindex @code{unbuffered}, @code{mysql} option
@item -n, --unbuffered
Flush buffer after each query.

@cindex @code{skip-column-names}, @code{mysql} option
@item -N, --skip-column-names
Don't write column names in results.

@cindex @code{set-variable}, @code{mysql} option
@item -O, --set-variable=name=value
Give a variable a value. @code{--help} lists variables.
Please note that @code{--set-variable=name=value} and @code{-O name=value}
syntax is deprecated as of MySQL 4.0.  Use @code{--name=value} instead.

@cindex @code{one-database}, @code{mysql} option
@item -o, --one-database
Only update the default database. This is useful for skipping updates to
other database in the binary log.

@cindex @code{pager}, @code{mysql} option
@item @code{--pager[=...]}
Output type. Default is your @code{ENV} variable @code{PAGER}. Valid
pagers are less, more, cat [> filename], etc.  See interactive help (\h)
also. This option does not work in batch mode. Pager works only in Unix.

@cindex @code{password}, @code{mysql} option
@item -p[password], --password[=...]
Password to use when connecting to server. If a password is not given on
the command-line, you will be prompted for it.  Note that if you use the
short form @code{-p} you can't have a space between the option and the
password.

@cindex @code{port}, @code{mysql} option
@item -P port_num, --port=port_num
TCP/IP port number to use for connection.

@cindex @code{protocol}, @code{mysql} option
@item @code{--protocol=(TCP | SOCKET | PIPE | MEMORY)}
To specify the connect protocol to use.  New in MySQL 4.1.

@cindex @code{quick}, @code{mysql} option
@item -q, --quick
Don't cache result, print it row-by-row. This may slow down the server
if the output is suspended. Doesn't use history file.

@cindex @code{raw}, @code{mysql} option
@item -r, --raw
Write column values without escape conversion. Used with @code{--batch}

@cindex @code{reconnect}, @code{mysql} option
@item --reconnect
If the connection is lost, automatically try to reconnect to
the server (but only once).

@cindex @code{silent}, @code{mysql} option
@item -s, --silent
Be more silent.

@cindex @code{socket}, @code{mysql} option
@item -S  --socket=...
Socket file to use for connection.

@cindex @code{table}, @code{mysql} option
@item -t  --table
Output in table format. This is default in non-batch mode.

@cindex @code{debug-info}, @code{mysql} option
@item -T, --debug-info
Print some debug information at exit.

@cindex @code{tee}, @code{mysql} option
@item --tee=...
Append everything into outfile. See interactive help (\h) also. Does not
work in batch mode.

@cindex @code{user}, @code{mysql} option
@item -u, --user=#
User for login if not current user.

@cindex @code{safe-updates}, @code{mysql} option
@item -U, --safe-updates[=#], --i-am-a-dummy[=#]
Only allow @code{UPDATE} and @code{DELETE} that uses keys. See below for
more information about this option.  You can reset this option if you have
it in your @file{my.cnf} file by using @code{--safe-updates=0}.

@cindex @code{verbose}, @code{mysql} option
@item -v, --verbose
More verbose output (-v -v -v gives the table output format).

@cindex @code{version}, @code{mysql} option
@item -V, --version
Output version information and exit.

@cindex @code{wait}, @code{mysql} option
@item -w, --wait
Wait and retry if connection is down instead of aborting.
@end table

You can also set the following variables with @code{-O} or
@code{--set-variable}.
Please note that @code{--set-variable=name=value} and @code{-O name=value}
syntax is deprecated as of MySQL 4.0.  Use @code{--name=value} instead.

@cindex timeout, @code{connect_timeout} variable
@cindex @code{connect_timeout} variable
@cindex @code{local-infile}
@cindex @code{max_allowed_packet}
@cindex @code{net_buffer_length}
@cindex @code{select_limit}
@cindex @code{max_join_size}
@multitable @columnfractions .25 .10 .65
@item @strong{Variable Name} @tab @strong{Default} @tab @strong{Description}
@item connect_timeout    @tab 0         @tab Number of seconds before connection timeout.
@item local-infile       @tab 0         @tab Disable (0) or enable (1) @code{LOCAL} capability for @code{LOAD DATA INFILE}
@item max_allowed_packet @tab 16777216  @tab Max packet length to send to/receive from server
@item net_buffer_length  @tab 16384     @tab Buffer for TCP/IP and socket communication
@item select_limit       @tab 1000      @tab Automatic limit for @code{SELECT} when using @code{--safe-updates}
@item max_join_size      @tab 1000000   @tab Automatic limit for rows in a join when using @code{--safe-updates}
@end multitable

If the @code{mysql} client loses connection to the server while
sending it a query, it will immediately and automatically try to
reconnect once to the server and send the query again.
Note that even if it succeeds in reconnecting, as your first
connection has ended, all your previous session objects are lost: temporary
tables, user and session variables. Therefore, the above behavior may
be dangerous for you, as in this example where the server was shut
down and restarted without you knowing it:

@example
mysql> SET @@a=1;
Query OK, 0 rows affected (0.05 sec)

mysql> INSERT INTO t VALUES(@@a);
ERROR 2006: MySQL server has gone away
No connection. Trying to reconnect...
Connection id:    1
Current database: test

Query OK, 1 row affected (1.30 sec)

mysql> SELECT * FROM t;
+------+
| a    |
+------+
| NULL |
+------+
1 row in set (0.05 sec)
@end example

The @code{@@a} user variable has been lost with the connection, and
after the reconnection it is undefined.
To protect from this risk, you can start the @code{mysql} client
with the @code{--disable-reconnect} option.

If you type 'help' on the command-line, @code{mysql} will print out the
commands that it supports:

@cindex commands, list of
@example
mysql> help

MySQL commands:
help      (\h)    Display this text.
?         (\h)    Synonym for `help'.
clear     (\c)    Clear command.
connect   (\r)    Reconnect to the server.
                  Optional arguments are db and host.
delimiter (\d)    Set query delimiter.
edit      (\e)    Edit command with $EDITOR.
ego       (\G)    Send command to mysql server,
                  display result vertically.
exit      (\q)    Exit mysql. Same as quit.
go        (\g)    Send command to mysql server.
nopager   (\n)    Disable pager, print to stdout.
notee     (\t)    Don't write into outfile.
pager     (\P)    Set PAGER [to_pager].
                  Print the query results via PAGER.
print     (\p)    Print current command.
prompt    (\R)    Change your mysql prompt.
quit      (\q)    Quit mysql.
rehash    (\#)    Rebuild completion hash.
source    (\.)    Execute an SQL script file.
                  Takes a file name as an argument.
status    (\s)    Get status information from the server.
system    (\!)    Execute a system shell command.
tee       (\T)    Set outfile [to_outfile].
                  Append everything into given outfile.
use       (\u)    Use another database.
                  Takes database name as argument.
@end example

The @code{edit}, @code{nopager}, @code{pager}, and @code{system} commands
work only in Unix.

@cindex @code{status} command
The @code{status} command gives you some information about the
connection and the server you are using. If you are running in the
@code{--safe-updates} mode, @code{status} will also print the values for
the @code{mysql} variables that affect your queries.

@cindex @code{safe-mode} command
A useful startup option for beginners (introduced in MySQL
Version 3.23.11) is @code{--safe-updates} (or @code{--i-am-a-dummy} for
users that once may have done a @code{DELETE FROM table_name} but forgot
the @code{WHERE} clause).  When using this option, @code{mysql} sends
the following command to the MySQL server when opening the connection:

@example
SET SQL_SAFE_UPDATES=1,SQL_SELECT_LIMIT=#select_limit#,
    SQL_MAX_JOIN_SIZE=#max_join_size#"
@end example

where @code{#select_limit#} and @code{#max_join_size#} are variables that
can be set from the @code{mysql} command-line. @xref{SET OPTION, @code{SET}}.

The effect of the above is:

@itemize @bullet
@item
You are not allowed to do an @code{UPDATE} or @code{DELETE} statement
if you don't have a key constraint in the @code{WHERE} part. One can,
however, force an @code{UPDATE/DELETE} by using @code{LIMIT}:
@example
UPDATE table_name SET not_key_column=# WHERE not_key_column=# LIMIT 1;
@end example
@item
All big results are automatically limited to @code{#select_limit#} rows.
@item
@code{SELECT} statements that will probably need to examine more than
@code{#max_join_size} row combinations will be aborted.
@end itemize

Some useful hints about the @code{mysql} client:

Some data is much more readable when displayed vertically, instead of
the usual horizontal box type output. For example longer text, which
includes new lines, is often much easier to be read with vertical
output.

@example
mysql> SELECT * FROM mails WHERE LENGTH(txt) < 300 lIMIT 300,1\G
*************************** 1. row ***************************
  msg_nro: 3068
     date: 2000-03-01 23:29:50
time_zone: +0200
mail_from: Monty
    reply: monty@@no.spam.com
  mail_to: "Thimble Smith" <tim@@no.spam.com>
      sbj: UTF-8
      txt: >>>>> "Thimble" == Thimble Smith writes:

Thimble> Hi.  I think this is a good idea.  Is anyone familiar with UTF-8
Thimble> or Unicode? Otherwise, I'll put this on my TODO list and see what
Thimble> happens.

Yes, please do that.

Regards,
Monty
     file: inbox-jani-1
     hash: 190402944
1 row in set (0.09 sec)
@end example

For logging, you can use the @code{tee} option. The @code{tee} can be
started with option @code{--tee=...}, or from the command-line
interactively with command @code{tee}. All the data displayed on the
screen will also be appended into a given file. This can be very useful
for debugging purposes also. The @code{tee} can be disabled from the
command-line with command @code{notee}. Executing @code{tee} again
starts logging again. Without a parameter the previous file will be
used. Note that @code{tee} will flush the results into the file after
each command, just before the command-line appears again waiting for the
next command.

Browsing, or searching the results in the interactive mode in Unix less,
more, or any other similar program, is now possible with option
@code{--pager[=...]}. Without argument, @code{mysql} client will look
for the @code{PAGER} environment variable and set @code{pager} to that.
@code{pager} can be started from the interactive command-line with
command @code{pager} and disabled with command @code{nopager}.  The
command takes an argument optionally and the @code{pager} will be set to
that. Command @code{pager} can be called without an argument, but this
requires that the option @code{--pager} was used, or the @code{pager}
will default to stdout. @code{pager} works only in Unix, since it uses
the @code{popen()} function, which doesn't exist in Windows. In Windows, the
@code{tee} option can be used instead, although it may not be as handy
as @code{pager} can be in some situations.

A few tips about @code{pager}:
@itemize @bullet
@item
You can use it to write to a file:
@example
mysql> pager cat > /tmp/log.txt
@end example
and the results will go only to a file. You can also pass any options
for the programs that you want to use with the @code{pager}:
@example
mysql> pager less -n -i -S
@end example

@item
From the above do note the option @code{-S}. You may find it very useful when
browsing the results; try the option with horizontal output (end
commands with @code{\g}, or @samp{;}) and with vertical output (end commands with
@code{\G}). Sometimes a very wide result set is hard to be read from the screen,
with option @code{-S} to @code{less} you can browse the results within the interactive
@code{less} from left to right, preventing lines longer than your screen from
being continued to the next line. This can make the result set much more
readable. You can switch the mode between on and off within the interactive
@code{less} with @code{-S}. See the 'h' for more help about @code{less}.

@item
You can combine very complex ways to handle the results, for example the
following would send the results to two files in two different
directories, on two different hard-disks mounted on /dr1 and /dr2, yet
let the results still be seen on the screen via less:
@example
mysql> pager cat | tee /dr1/tmp/res.txt | \
tee /dr2/tmp/res2.txt | less -n -i -S
@end example

@end itemize

You can also combine the two functions above; have the @code{tee}
enabled, @code{pager} set to 'less' and you will be able to browse the
results in Unix 'less' and still have everything appended into a file
the same time. The difference between Unix @code{tee} used with the
@code{pager} and the @code{mysql} client in-built @code{tee}, is that
the in-built @code{tee} works even if you don't have the Unix @code{tee}
available. The in-built @code{tee} also logs everything that is printed
on the screen, where the Unix @code{tee} used with @code{pager} doesn't
log quite that much. Last, but not least, the interactive @code{tee} is
more handy to switch on and off, when you want to log something into a
file, but want to be able to turn the feature off sometimes.

@cindex @code{prompt} command
From MySQL version 4.0.2 it is possible to change the prompt in the
@code{mysql} command-line client.

You can use the following prompt options:
@c FIX these columnfractions have NOT been measured!
@multitable @columnfractions .10 .50
@item @strong{Option} @tab @strong{Description}
@item \v   @tab  mysqld version
@item \d   @tab  database in use
@item \h   @tab  host connected to
@item \p   @tab  port connected on
@item \u   @tab  username
@item \U   @tab  full username@@host
@item \\   @tab  @samp{\}
@item \n   @tab  new line break
@item \t   @tab  tab
@item \    @tab  space
@item \_   @tab  space
@item \R   @tab  military hour time (0-23)
@item \r   @tab  standard hour time (1-12)
@item \m   @tab  minutes
@item \y   @tab  two digit year 
@item \Y   @tab  four digit year
@item \D   @tab  full date format
@item \s   @tab  seconds
@item \w   @tab  day of the week in three letter format (Mon, Tue, ...)
@item \P   @tab  am/pm
@item \o   @tab  month in number format
@item \O   @tab  month in three letter format (Jan, Feb, ...)
@item \c   @tab  counter that counts up for each command you do
@end multitable

@samp{\} followed by any other letter just becomes that letter.

You may set the prompt in the following places:

@table @strong
@item Environment Variable
You may set the @code{MYSQL_PS1} environment variable to a prompt string.  For
example:

@example
shell> export MYSQL_PS1="(\u@@\h) [\d]> "
@end example

@item @file{my.cnf}
@item @file{.my.cnf}
You may set the @code{prompt} option in any MySQL configuration file, in the
@code{mysql} group.  For example:

@example
[mysql]
prompt=(\u@@\h) [\d]>\_
@end example

@item Command Line
You may set the @code{--prompt} option on the command line to @code{mysql}.
For example:

@example
shell> mysql --prompt="(\u@@\h) [\d]> "

(user@@host) [database]> 
@end example

@item Interactively
You may also use the @code{prompt} (or @code{\R}) command to change your 
prompt interactively.  For example:

@example
mysql> prompt (\u@@\h) [\d]>\_
PROMPT set to '(\u@@\h) [\d]>\_'
(user@@host) [database]> 
(user@@host) [database]> prompt
Returning to default PROMPT of mysql> 
mysql> 
@end example

@end table


@node Batch Commands,  , mysql, mysql
@subsection How to Run SQL Commands from a Text File

The @code{mysql} client typically is used interactively, like this:

@example
shell> mysql database
@end example

However, it's also possible to put your SQL commands in a file and tell
@code{mysql} to read its input from that file.  To do so, create a text
file @file{text_file} that contains the commands you wish to execute.
Then invoke @code{mysql} as shown here:

@example
shell> mysql database < text_file
@end example

You can also start your text file with a @code{USE db_name} statement.  In
this case, it is unnecessary to specify the database name on the command
line:

@example
shell> mysql < text_file
@end example

If you are already running @code{mysql}, you can execute an SQL
script file using the @code{source} command:

@example
mysql> source filename;
@end example

For more information about batch mode, @ref{Batch mode}.


@node mysqlcc, mysqladmin, mysql, Client-Side Scripts
@section @code{mysqlcc}, The MySQL Control Center

@cindex graphical tool
@cindex GUI tool
@cindex tools, graphical
@cindex tools, GUI
@cindex @code{mysqlcc}

@code{mysqlcc}, the MySQL Control Center, is a platform-independent client that
provides a graphical user interface (GUI) to the MySQL database server.
It supports interactive use, including syntax highlighting and tab-completion.
It provides database and table management, and allows server administration.

Currently, @code{mysqlcc} runs on Windows and Linux platforms.

@code{mysqlcc} is not included with MySQL distributions, but can be downloaded
separately at @uref{http://www.mysql.com/downloads/}.

@cindex @code{mysqlcc} command-line options
@cindex command-line options, @code{mysqlcc}
@cindex options, command-line, @code{mysqlcc}
@cindex startup parameters, @code{mysqlcc}
@code{mysqlcc} supports the following options:

@table @code
@cindex @code{help}, @code{mysqlcc} option
@item -?, --help
Display this help and exit.

@cindex @code{blocking_queries}, @code{mysqlcc} option
@item -b, --blocking_queries 
Use blocking queries.

@cindex @code{compress}, @code{mysqlcc} option
@item -C, --compress
Use compression in server/client protocol.

@cindex @code{connection_name}, @code{mysqlcc} option
@item -c, --connection_name=name 
This is a synonym for @code{--server}.

@cindex @code{database}, @code{mysqlcc} option
@item -d, --database=...
Database to use. This is mainly useful in the @file{my.cnf} file.

@cindex @code{history_size}, @code{mysqlcc} option
@item -H, --history_size=# 
History size for the query window.

@cindex @code{host}, @code{mysql} option
@item -h, --host=...
Connect to the given host.

@cindex @code{password}, @code{mysqlcc} option
@item -p[password], --password[=...]
Password to use when connecting to server. If a password is not given on
the command-line, you will be prompted for it.  Note that if you use the
short form @code{-p} you can't have a space between the option and the
password.

@cindex @code{plugins_path}, @code{mysqlcc} option
@item -g, --plugins_path=name 
Path to the directory where MySQL Control Center plugins are located.

@cindex @code{port}, @code{mysqlcc} option
@item -P port_num, --port=port_num
TCP/IP port number to use for connection.

@cindex @code{query}, @code{mysqlcc} option
@item -q, --query
Open a query window on startup.

@cindex @code{register}, @code{mysqlcc} option
@item -r, --register
Open the 'Register Server' dialog on startup.

@cindex @code{server}, @code{mysqlcc} option
@item -s, --server=name
MySQL Control Center connection name.

@cindex @code{socket}, @code{mysqlcc} option
@item -S  --socket=...
Socket file to use for connection.

@cindex @code{syntax}, @code{mysqlcc} option
@item -y, --syntax
Enable syntax highlighting and completion.

@cindex @code{syntax_file}, @code{mysqlcc} option
@item -Y, --syntax_file=name 
Syntax file for completion.

@cindex @code{translations_path}, @code{mysqlcc} option
@item -T, --translations_path=name 
Path to the directory where MySQL Control Center translations are located.

@cindex @code{user}, @code{mysqlcc} option
@item -u, --user=#
User for login if not current user.

@cindex @code{version}, @code{mysqlcc} option
@item -V, --version
Output version information and exit.

@end table

You can also set the following variables with @code{-O} or
@code{--set-variable}. please note that @code{--set-variable}
Please note that @code{--set-variable=name=value} and @code{-O name=value}
syntax is deprecated as of MySQL 4.0.  Use @code{--name=value} instead.

@cindex timeout, @code{connect_timeout} variable
@cindex @code{connect_timeout} variable
@cindex @code{local-infile}
@cindex @code{max_allowed_packet}
@cindex @code{net_buffer_length}
@cindex @code{select_limit}
@cindex @code{max_join_size}
@multitable @columnfractions .25 .10 .65
@item @strong{Variable Name} @tab @strong{Default} @tab @strong{Description}
@item connect_timeout    @tab 0         @tab Number of seconds before connection timeout.
@item local-infile       @tab 0         @tab Disable (0) or enable (1) @code{LOCAL} capability for @code{LOAD DATA INFILE}
@item max_allowed_packet @tab 16777216  @tab Max packet length to send to/receive from server
@item net_buffer_length  @tab 16384     @tab Buffer for TCP/IP and socket communication
@item select_limit       @tab 1000      @tab Automatic limit for @code{SELECT} when using @code{--safe-updates}
@item max_join_size      @tab 1000000   @tab Automatic limit for rows in a join when using @code{--safe-updates}
@end multitable


@node mysqladmin, mysqlbinlog, mysqlcc, Client-Side Scripts
@section @code{mysqladmin}, Administering a MySQL Server

@cindex administration, server
@cindex server administration
@cindex @code{mysqladmin}

A utility for performing administrative operations. The syntax is:

@example
shell> mysqladmin [OPTIONS] command [command-option] command ...
@end example

You can get a list of the options your version of @code{mysqladmin} supports
by executing @code{mysqladmin --help}.

The current @code{mysqladmin} supports the following commands:

@table @code
@item create databasename
Create a new database.

@item drop databasename
Delete a database and all its tables.

@item extended-status
Gives an extended status message from the server.

@item flush-hosts
Flush all cached hosts.

@item flush-logs
Flush all logs.

@item flush-tables
Flush all tables.

@item flush-privileges
Reload grant tables (same as reload).

@item kill id,id,...
Kill mysql threads.

@item password
Set a new password. Change old password to new-password.

@item ping
Check if mysqld is alive.

@item processlist
Show list of active threads in server, as with the
@code{SHOW PROCESSLIST} statement.
If the @code{--verbose} option is given, the output is like that of
@code{SHOW FULL PROCESSLIST}.

@item reload
Reload grant tables.

@item refresh
Flush all tables and close and open log files.

@item shutdown
Take down the server.

@item slave-start
Start slave replication thread.

@item slave-stop
Stop slave replication thread.

@item status
Gives a short status message from the server.

@item variables
Prints variables available.

@item version
Get version information from server.
@end table

All commands can be shortened to their unique prefix.  For example:

@example
shell> mysqladmin proc stat
+----+-------+-----------+----+-------------+------+-------+------+
| Id | User  | Host      | db | Command     | Time | State | Info |
+----+-------+-----------+----+-------------+------+-------+------+
| 6  | monty | localhost |    | Processlist | 0    |       |      |
+----+-------+-----------+----+-------------+------+-------+------+
Uptime: 10077  Threads: 1  Questions: 9  Slow queries: 0
Opens: 6 Flush tables: 1  Open tables: 2
Memory in use: 1092K  Max memory used: 1116K
@end example

@cindex status command, results
The @code{mysqladmin status} command result has the following columns:

@cindex uptime
@multitable @columnfractions .20 .65
@item @strong{Column} @tab @strong{Description}
@item Uptime @tab Number of seconds the MySQL server has been up.
@cindex threads
@item Threads @tab Number of active threads (clients).
@cindex questions
@item Questions @tab Number of questions from clients since @code{mysqld} was started.
@cindex slow queries
@item Slow queries @tab Queries that have taken more than @code{long_query_time} seconds. @xref{Slow query log}.
@cindex opens
@item Opens @tab How many tables @code{mysqld} has opened.
@cindex flush tables
@cindex tables, flush
@item Flush tables @tab Number of @code{flush ...}, @code{refresh}, and @code{reload} commands.
@cindex open tables
@item Open tables @tab Number of tables that are open now.
@cindex memory use
@item Memory in use @tab Memory allocated directly by the @code{mysqld} code (only available when MySQL is compiled with --with-debug=full).
@cindex max memory used
@item Max memory used @tab Maximum memory allocated directly by the @code{mysqld} code (only available when MySQL is compiled with --with-debug=full).
@end multitable

If you do @code{mysqladmin shutdown} on a socket (in other words, on a
the computer where @code{mysqld} is running), @code{mysqladmin} will
wait until the MySQL @code{pid-file} is removed to ensure that
the @code{mysqld} server has stopped properly.

@node mysqlbinlog, Using mysqlcheck, mysqladmin, Client-Side Scripts
@section @code{mysqlbinlog}, Executing the queries from a binary log

@cindex @code{mysqlbinlog}

You can examine the binary log file (@pxref{Binary log}) with the
@code{mysqlbinlog} utility.

@example
shell> mysqlbinlog hostname-bin.001
@end example

will print all queries contained in binlog @file{hostname-bin.001},
together with information (time the query took, ID of the thread which
issued it, timestamp when it was issued etc).

You can pipe the output of @code{mysqlbinlog} into a @code{mysql}
client; this is used to recover from a crash when you have an old
backup (@pxref{Backup}):

@example
shell> mysqlbinlog hostname-bin.001 | mysql
@end example

or:

@example
shell> mysqlbinlog hostname-bin.[0-9]* | mysql
@end example

You can also redirect the output of @code{mysqlbinlog} to a text file
instead, modify this text file (to cut queries you don't want to
execute for some reason), then execute the queries from the text file
into @code{mysql}.

@code{mysqlbinlog} has the @code{position=#} options which will print
only queries whose offset in the binlog is greater or equal to @code{#}.

If you have more than one binary log to execute on the MySQL server,
the safe method is to do it in one unique MySQL connection. Here is
what may be UNsafe:

@example
shell> mysqlbinlog hostname-bin.001 | mysql # DANGER!!
shell> mysqlbinlog hostname-bin.002 | mysql # DANGER!!
@end example

It will cause problems if the first binlog contains a @code{CREATE
TEMPORARY TABLE} and the second one contains a query which uses this
temporary table: when the first @code{mysql} terminates, it will drop
the temporary table, so the second @code{mysql} will report ``unknown
table''. This is why you should run all binlogs you want in one unique
connection, especially if you use temporary tables. Here are two
possible ways:

@example
shell> mysqlbinlog hostname-bin.001 hostname-bin.002 | mysql
@end example

@example
shell> mysqlbinlog hostname-bin.001 >  /tmp/queries.sql
shell> mysqlbinlog hostname-bin.002 >> /tmp/queries.sql
shell> mysql -e "source /tmp/queries.sql"
@end example

Starting from MySQL 4.0.14, @code{mysqlbinlog} can prepare suitable input 
for @code{mysql} to
execute a @code{LOAD DATA INFILE} from a binlog. As the binlog
contains the data to load (this is true for MySQL 4.0; MySQL 3.23 did
not write the loaded data into the binlog, so the original
file was needed when one wanted to execute the content of
the binlog), @code{mysqlbinlog} will copy this data to a
temporary file and print a @code{LOAD DATA INFILE} command for
@code{mysql} to load
this temporary file. The location where the temporary file is
created is by default the temporary directory; it can be changed with
the @code{local-load} option of @code{mysqlbinlog}.

@strong{Warning:} When you run @code{mysqlbinlog} on a binary log file,
it will create a temporary file for every found @code{LOAD DATA INFILE}
command. These files will @strong{not} be automatically deleted, because
you will need them when executing the produced sql log.  You should delete
them yourself when you don't need the sql log anymore.  The files are named
@file{temporary-dir/original_file_name-#-#}.

In the future we will fix this problem by allowing @code{mysqlbinlog}
to connect directly to a @code{mysqld} server.  In this case we can
safely remove the log files when the logs have been applied.

Before MySQL 4.1, @code{mysqlbinlog} could not prepare suitable output
for @code{mysql} when the binary log contained queries from different
threads using temporary tables of the same name, if these queries were
interlaced. This is solved in MySQL 4.1.

You can also use @code{mysqlbinlog --read-from-remote-server} to read
the binary log directly from a remote MySQL server.  However, this is
something that is deprecated as we instead want to make it easy to to
apply binary logs to a running MySQL server.

@code{mysqlbinlog --help} will give you more information.

@node Using mysqlcheck, mysqldump, mysqlbinlog, Client-Side Scripts
@section Using @code{mysqlcheck} for Table Maintenance and Crash Recovery

Since MySQL version 3.23.38 you will be able to use a new
checking and repairing tool for @code{MyISAM} tables. The difference to
@code{myisamchk} is that @code{mysqlcheck} should be used when the
@code{mysqld} server is running, whereas @code{myisamchk} should be used
when it is not. The benefit is that you no longer have to take down the
server for checking or repairing your tables.

@code{mysqlcheck} uses MySQL server commands @code{CHECK},
@code{REPAIR}, @code{ANALYZE} and @code{OPTIMIZE} in a convenient way
for the user.

There are three alternative ways to invoke @code{mysqlcheck}:

@example
shell> mysqlcheck [OPTIONS] database [tables]
shell> mysqlcheck [OPTIONS] --databases DB1 [DB2 DB3...]
shell> mysqlcheck [OPTIONS] --all-databases
@end example

So it can be used in a similar way as @code{mysqldump} when it
comes to what databases and tables you want to choose.

@code{mysqlcheck} does have a special feature compared to the other
clients; the default behavior, checking tables (-c), can be changed by
renaming the binary. So if you want to have a tool that repairs tables
by default, you should just copy @code{mysqlcheck} to your harddrive
with a new name, @code{mysqlrepair}, or alternatively make a symbolic
link to @code{mysqlrepair} and name the symbolic link as
@code{mysqlrepair}. If you invoke @code{mysqlrepair} now, it will repair
tables by default.

The names that you can use to change @code{mysqlcheck} default behavior
are here:

@example
mysqlrepair:   The default option will be -r
mysqlanalyze:  The default option will be -a
mysqloptimize: The default option will be -o
@end example

The options available for @code{mysqlcheck} are listed here, please
check what your version supports with @code{mysqlcheck --help}.

@table @code
@item -A, --all-databases
Check all the databases. This will be same as --databases with all
databases selected
@item -1, --all-in-1
Instead of making one query for each table, execute all queries in 1
query separately for each database. Table names will be in a comma
separated list.
@item  -a, --analyze
Analyze given tables.
@item --auto-repair
If a checked table is corrupted, automatically fix it. Repairing will be
done after all tables have been checked, if corrupted ones were found.
@item -#, --debug=...
Output debug log. Often this is 'd:t:o,filename'
@item --character-sets-dir=...
Directory where character sets are
@item -c, --check
Check table for errors
@item -C, --check-only-changed
Check only tables that have changed since last check or haven't been
closed properly.
@item --compress
Use compression in server/client protocol.
@item -?, --help
Display this help message and exit.
@item -B, --databases
To check several databases. Note the difference in usage; in this case
no tables are given. All name arguments are regarded as database names.
@item --default-character-set=...
Set the default character set
@item -F, --fast
Check only tables that hasn't been closed properly
@item -f, --force
Continue even if we get an sql-error.
@item -e, --extended
If you are using this option with CHECK TABLE, it will ensure that the
table is 100 percent consistent, but will take a long time.

If you are using this option with REPAIR TABLE, it will run an extended
repair on the table, which may not only take a long time to execute, but
may produce a lot of garbage rows also!
@item -h, --host=...
Connect to host.
@item -m, --medium-check
Faster than extended-check, but only finds 99.99 percent of all
errors. Should be good enough for most cases.
@item -o, --optimize
Optimize table
@item -p, --password[=...]
Password to use when connecting to server. If password is not given
it's solicited on the tty.
@item -P, --port=...
Port number to use for TCP/IP connections.
@item @code{--protocol=(TCP | SOCKET | PIPE | MEMORY)}
To specify the connect protocol to use.  New in MySQL 4.1.
@item -q, --quick
If you are using this option with CHECK TABLE, it prevents the check
from scanning the rows to check for wrong links. This is the fastest
check.

If you are using this option with REPAIR TABLE, it will try to repair
only the index tree. This is the fastest repair method for a table.
@item -r, --repair
Can fix almost anything except unique keys that aren't unique.
@item -s, --silent
Print only error messages.
@item -S, --socket=...
Socket file to use for connection.
@item --tables
Overrides option @code{--databases} (@code{-B}). All arguments 
following that option are regarded as table names.
@item -u, --user=#
User for login if not current user.
@item -v, --verbose
Print information about the various stages.
@item -V, --version
Output version information and exit.
@end table


@node mysqldump, mysqlhotcopy, Using mysqlcheck, Client-Side Scripts
@section @code{mysqldump}, Dumping Table Structure and Data

@cindex dumping, databases
@cindex databases, dumping
@cindex tables, dumping
@cindex backing up, databases

@cindex @code{mysqldump}
The @code{mysqldump} client can be used
to dump a database or a collection of database for backup or for
transferring the data to another SQL server (not necessarily a MySQL
server).  The dump will contain SQL statements to create the table
and/or populate the table.

If you are doing a backup on the server, you should consider using
the @code{mysqlhotcopy} instead. @xref{mysqlhotcopy, , @code{mysqlhotcopy}}.

@example
shell> mysqldump [OPTIONS] database [tables]
OR     mysqldump [OPTIONS] --databases [OPTIONS] DB1 [DB2 DB3...]
OR     mysqldump [OPTIONS] --all-databases [OPTIONS]
@end example

If you don't give any tables or use the @code{--databases} or
@code{--all-databases} option, entire databases will be dumped.

You can get a list of the options your version of @code{mysqldump} supports
by executing @code{mysqldump --help}.

If you run @code{mysqldump} without @code{--quick} or
@code{--opt}, @code{mysqldump} will load the whole result set into
memory before dumping the result.  This will probably be a problem if
you are dumping a big database.

If you are using a recent copy of the @code{mysqldump} program
and you are going to do a dump that will be read into a very old MySQL
server, you should not use the @code{--opt} or @code{-e} options.

Out-of-range numeric values such as @code{-inf} and @code{inf}, as well
as NaN (not-a-number) values are dumped by @code{mysqldump} as @code{NULL}.
You can see this using the following example table:

@example
mysql> CREATE TABLE t (f DOUBLE);
mysql> INSERT INTO t VALUES(1e+111111111111111111111);
mysql> INSERT INTO t VALUES(-1e111111111111111111111);
mysql> SELECT f FROM t;
+------+
| f    |
+------+
|  inf |
| -inf |
+------+
@end example

For this table, @code{mysqldump} produces the following data output:

@example
--
-- Dumping data for table `t`
--

INSERT INTO t VALUES (NULL);
INSERT INTO t VALUES (NULL);
@end example

The significance of this behavior is that if you dump and restore the
table, the new table has contents that differ from the original contents.

@code{mysqldump} supports the following options:

@table @code
@item --add-locks
Add @code{LOCK TABLES} before and @code{UNLOCK TABLE} after each table dump.
(To get faster inserts into MySQL.)
@item --add-drop-table
Add a @code{drop table} before each create statement.
@item -A, --all-databases
Dump all the databases. This will be same as @code{--databases} with all
databases selected.
@item -a, --all
Include all MySQL-specific create options.
@item --allow-keywords
Allow creation of column names that are keywords.  This works by
prefixing each column name with the table name.
@item -c, --complete-insert
Use complete insert statements (with column names).
@item --comments=...
If set to @code{0}, suppresses additional information (like program version, 
server version, host) in dumps. The @code{--skip-comments} option does
the same. Default is @code{1} to not suppress that information. 
New in MySQL 4.0.17.
@item -C, --compress
Compress all information between the client and the server if both support
compression.
@item -B, --databases
To dump several databases. Note the difference in usage. In this case
no tables are given. All name arguments are regarded as database names.
@code{USE db_name;} will be included in the output before each new database.
@item --default-character-set=...
Sets the character set for the dump.
If not specified, @file{mysqldump} 10.3 (MySQL-4.1.2) or later
will use @code{utf8}, earlier versions use @code{latin1}.
@item --delayed
Insert rows with the @code{INSERT DELAYED} command.
@item -e, --extended-insert
Use the new multiline @code{INSERT} syntax. (Gives more compact and
faster inserts statements.)
@item -#, --debug[=option_string]
Trace usage of the program (for debugging).
@item --help
Display a help message and exit.
@item --fields-terminated-by=...
@itemx --fields-enclosed-by=...
@itemx --fields-optionally-enclosed-by=...
@itemx --fields-escaped-by=...
@itemx --lines-terminated-by=...
These options are used with the @code{-T} option and have the same
meaning as the corresponding clauses for @code{LOAD DATA INFILE}.
@xref{LOAD DATA, , @code{LOAD DATA}}.
@item -F, --flush-logs
Flush log file in the MySQL server before starting the dump. Note that
if you use this option in combination with the @code{--all-databases}
(or @code{-A}) option, the logs will be flushed 
@emph{for each database dumped}.
@item -f, --force
Continue even if we get an SQL error during a table dump.
@item -h, --host=...
Dump data from the MySQL server on the named host. The default host
is @code{localhost}.
@item -l, --lock-tables
Lock all tables before starting the dump.  The tables are locked with
@code{READ LOCAL} to allow concurrent inserts in the case of @code{MyISAM}
tables.

Please note that when dumping multiple databases, @code{--lock-tables}
will lock tables for each database separately. So using this option will
not guarantee your tables will be logically consistent between databases.
Tables in different databases may be dumped in completely different
states.
@item -K, --disable-keys
@code{/*!40000 ALTER TABLE tb_name DISABLE KEYS */;} and
@code{/*!40000 ALTER TABLE tb_name ENABLE KEYS */;}
will be put in the output.  This will make loading the data into a MySQL
4.0 server faster as the indexes are created after all data are inserted.
@item -n, --no-create-db
@code{CREATE DATABASE /*!32312 IF NOT EXISTS*/ db_name;} will not be put in the
output. The above line will be added otherwise, if a @code{--databases} or
@code{--all-databases} option was given.
@item -t, --no-create-info
Don't write table creation information (the @code{CREATE TABLE} statement).
@item -d, --no-data
Don't write any row information for the table.  This is very useful if you
just want to get a dump of the structure for a table!
@item --opt
Same as @code{--quick --add-drop-table --add-locks --extended-insert
--lock-tables}.  Should give you the fastest possible dump for reading
into a MySQL server.
@item -pyour_pass, --password[=your_pass]
The password to use when connecting to the server. If you specify
no @samp{=your_pass} part,
@code{mysqldump} you will be prompted for a password.
@item -P, --port=...
Port number to use for TCP/IP connections.
@item @code{--protocol=(TCP | SOCKET | PIPE | MEMORY)}
To specify the connect protocol to use.  New in MySQL 4.1.
@item  -q, --quick
Don't buffer query, dump directly to stdout. Uses @code{mysql_use_result()}
to do this. Especially useful for big dumps.
@item -Q, --quote-names
Quote table and column names within @samp{`} characters.
@item -r, --result-file=...
Direct output to a given file. This option should be used in MSDOS,
because it prevents new line @samp{\n} from being converted to @samp{\n\r}
(new line + carriage return).
@item --single-transaction
This option issues a @code{BEGIN} SQL command before dumping data from
server. It is mostly useful with @code{InnoDB} tables and
@code{READ_COMMITTED} transaction isolation level, as in this mode it
will dump the consistent state of the database at the time then
@code{BEGIN} was issued without blocking any applications.

When using this option you should keep in mind that only transactional
tables will be dumped in a consistent state, for example, any @code{MyISAM} or
@code{HEAP} tables dumped while using this option may still change
state.

The @code{--single-transaction} option was added in version 4.0.2.
This option is mutually exclusive with the @code{--lock-tables} option
as @code{LOCK TABLES} already commits a previous transaction internally.
@item -S /path/to/socket, --socket=/path/to/socket
The socket file to use when connecting to @code{localhost} (which is the
default host).
@item --skip-comments
Suppresses additional information (like program version, 
server version, host) in dumps. It does the same as setting @code{--comments} 
to @code{0}. New in MySQL 4.0.17.
@item --tables
Overrides option --databases (-B).
@item  -T, --tab=path-to-some-directory
Creates a @code{table_name.sql} file, that contains the SQL CREATE commands,
and a @code{table_name.txt} file, that contains the data, for each give table.
The format of the @file{.txt} file is made according to the
@code{--fields-xxx} and @code{--lines--xxx} options.
@strong{Note:} This option works only if @code{mysqldump} is run on the same
machine as the @code{mysqld} daemon. You must use a MySQL account that has the
@code{FILE} privilege, and the login user/group that @code{mysqld}
is running as (normally user @code{mysql}, group @code{mysql}) must have
permission to create/write a file at the location you specify.
@item -u user_name, --user=user_name
The MySQL username to use when connecting to the server. The
default value is your Unix login name.
@item -O name=value, --set-variable=name=value
Set the value of a variable.  The possible variables are listed below.
Please note that @code{--set-variable=name=value} and @code{-O name=value}
syntax is deprecated as of MySQL 4.0.  Use @code{--name=value} instead.
@item -v, --verbose
Verbose mode.  Print out more information on what the program does.
@item -V, --version
Print version information and exit.
@item -w, --where='where-condition'
Dump only selected records. Note that quotes are mandatory:
@example
"--where=user='jimf'" "-wuserid>1" "-wuserid<1"
@end example
@item -X, --xml
Dumps a database as well formed XML
@item -x, --first-slave
Locks all tables across all databases.
@item --master-data
Like @code{--first-slave}, but also prints some @code{CHANGE MASTER
TO} commands which will later make your slave start from the right position
in the master's binlogs, if you have set up your slave using this SQL
dump of the master.
@item -O net_buffer_length=#, where # < 16M
When creating multi-row-insert statements (as with option
@code{--extended-insert} or @code{--opt}), @code{mysqldump} will create
rows up to @code{net_buffer_length} length. If you increase this
variable, you should also ensure that the @code{max_allowed_packet}
variable in the MySQL server is bigger than the
@code{net_buffer_length}.
@end table

The most normal use of @code{mysqldump} is probably for making a backup of
whole databases. @xref{Backup}.

@example
mysqldump --opt database > backup-file.sql
@end example

You can read this back into MySQL with:

@example
mysql database < backup-file.sql
@end example

or:

@example
mysql -e "source /path-to-backup/backup-file.sql" database
@end example

However, it's also very useful to populate another MySQL server with
information from a database:

@example
mysqldump --opt database | mysql ---host=remote-host -C database
@end example

It is possible to dump several databases with one command:

@example
mysqldump --databases database1 [database2 ...] > my_databases.sql
@end example

If all the databases are wanted, one can use:

@example
mysqldump --all-databases > all_databases.sql
@end example


@node mysqlhotcopy, mysqlimport, mysqldump, Client-Side Scripts
@section @code{mysqlhotcopy}, Copying MySQL Databases and Tables

@cindex dumping, databases
@cindex databases, dumping
@cindex tables, dumping
@cindex backing up, databases

@code{mysqlhotcopy} is a Perl script that uses @code{LOCK TABLES},
@code{FLUSH TABLES} and @code{cp} or @code{scp} to quickly make a backup
of a database.  It's the fastest way to make a backup of the database
or single tables, but it can only be run on the same machine where the
database directories are.  @code{mysqlhotcopy} works only for backing up
@code{MyISAM} and @code{ISAM} tables. It runs on Unix, and on NetWare as of
MySQL 4.0.18.

@example
mysqlhotcopy db_name [/path/to/new_directory]

mysqlhotcopy db_name_1 ... db_name_n /path/to/new_directory

mysqlhotcopy db_name./regex/
@end example

@code{mysqlhotcopy} supports the following options:

@table @code
@item -?, --help
Display a help screen and exit
@item -u, --user=#
User for database login
@item -p, --password=#
Password to use when connecting to server
@item -P, --port=#
Port to use when connecting to local server
@item -S, --socket=#
Socket to use when connecting to local server
@item --allowold
Don't abort if target already exists (rename it _old)
@item --keepold
Don't delete previous (now renamed) target when done
@item --noindices
Don't include full index files in copy to make the backup smaller and faster
The indexes can later be reconstructed with @code{myisamchk -rq.}.
@item --method=#
Method for copy (@code{cp} or @code{scp}).
@item -q, --quiet
Be silent except for errors
@item --debug
Enable debug
@item -n, --dryrun
Report actions without doing them
@item --regexp=#
Copy all databases with names matching regexp
@item --suffix=#
Suffix for names of copied databases
@item --checkpoint=#
Insert checkpoint entry into specified db.table
@item --flushlog
Flush logs once all tables are locked.
@item --tmpdir=#
Temporary directory (instead of /tmp).
@end table

You can use @code{perldoc mysqlhotcopy} to get more complete
documentation for @code{mysqlhotcopy}.

@code{mysqlhotcopy} reads the groups @code{[client]} and  @code{[mysqlhotcopy]}
from the option files.

To be able to execute @code{mysqlhotcopy} you need write access to the
backup directory, the @code{SELECT} privilege for the tables you are about to
copy and the MySQL @code{RELOAD} privilege (to be able to
execute @code{FLUSH TABLES}).


@node mysqlimport, mysqlshow, mysqlhotcopy, Client-Side Scripts
@section @code{mysqlimport}, Importing Data from Text Files

@cindex importing, data
@cindex data, importing
@cindex files, text
@cindex text files, importing
@cindex @code{mysqlimport}

@code{mysqlimport} provides a command-line interface to the @code{LOAD DATA
INFILE} SQL statement.  Most options to @code{mysqlimport} correspond
directly to the same options to @code{LOAD DATA INFILE}.
@xref{LOAD DATA, , @code{LOAD DATA}}.

@code{mysqlimport} is invoked like this:

@example
shell> mysqlimport [options] database textfile1 [textfile2 ...]
@end example

For each text file named on the command-line,
@code{mysqlimport} strips any extension from the filename and uses the result
to determine which table to import the file's contents into.  For example,
files named @file{patient.txt}, @file{patient.text}, and @file{patient} would
all be imported into a table named @code{patient}.

@code{mysqlimport} supports the following options:

@table @code
@item -c, --columns=...
This option takes a comma-separated list of field names as an argument.
The field list is used to create a proper @code{LOAD DATA INFILE} command,
which is then passed to MySQL. @xref{LOAD DATA, , @code{LOAD DATA}}.

@item -C, --compress
Compress all information between the client and the server if both support
compression.

@item -#, --debug[=option_string]
Trace usage of the program (for debugging).

@item -d, --delete
Empty the table before importing the text file.

@item --fields-terminated-by=...
@itemx --fields-enclosed-by=...
@itemx --fields-optionally-enclosed-by=...
@itemx --fields-escaped-by=...
@itemx --lines-terminated-by=...
These options have the same meaning as the corresponding clauses for
@code{LOAD DATA INFILE}. @xref{LOAD DATA, , @code{LOAD DATA}}.

@item -f, --force
Ignore errors.  For example, if a table for a text file doesn't exist,
continue processing any remaining files.  Without @code{--force},
@code{mysqlimport} exits if a table doesn't exist.

@item --help
Display a help message and exit.

@item -h host_name, --host=host_name
Import data to the MySQL server on the named host. The default host
is @code{localhost}.

@item -i, --ignore
See the description for the @code{--replace} option.

@item --ignore-lines=n
Ignore first @code{n} lines of the datafile.

@item -l, --lock-tables
Lock @strong{all} tables for writing before processing any text files. This
ensures that all tables are synchronized on the server.

@item -L, --local
Read input files from the client.  By default, text files are assumed to be on
the server if you connect to @code{localhost} (which is the default host).

@item -pyour_pass, --password[=your_pass]
The password to use when connecting to the server. If you specify
no @samp{=your_pass} part,
@code{mysqlimport} you will be prompted for a password.

@item -P port_num, --port=port_num
TCP/IP port number to use for connection.

@cindex @code{protocol}, @code{mysql} option
@item @code{--protocol=(TCP | SOCKET | PIPE | MEMORY)}
To specify the connect protocol to use.  New in MySQL 4.1.

@item -r, --replace
The @code{--replace} and @code{--ignore} options control handling of input
records that duplicate existing records on unique key values.  If you specify
@code{--replace}, new rows replace existing rows that have the same unique key
value. If you specify @code{--ignore}, input rows that duplicate an existing
row on a unique key value are skipped.  If you don't specify either option, an
error occurs when a duplicate key value is found, and the rest of the text
file is ignored.

@item  -s, --silent
Silent mode.  Write output only when errors occur.

@item -S /path/to/socket, --socket=/path/to/socket
The socket file to use when connecting to @code{localhost} (which is the
default host).

@item -u user_name, --user=user_name
The MySQL username to use when connecting to the server. The
default value is your Unix login name.

@item -v, --verbose
Verbose mode.  Print out more information what the program does.

@item -V, --version
Print version information and exit.
@end table

Here is a sample run using @code{mysqlimport}:

@example
$ mysql --version
mysql  Ver 9.33 Distrib 3.22.25, for pc-linux-gnu (i686)
$ uname -a
Linux xxx.com 2.2.5-15 #1 Mon Apr 19 22:21:09 EDT 1999 i586 unknown
$ mysql -e 'CREATE TABLE imptest(id INT, n VARCHAR(30))' test
$ ed
a
100     Max Sydow
101     Count Dracula
.
w imptest.txt
32
q
$ od -c imptest.txt
0000000   1   0   0  \t   M   a   x       S   y   d   o   w  \n   1   0
0000020   1  \t   C   o   u   n   t       D   r   a   c   u   l   a  \n
0000040
$ mysqlimport --local test imptest.txt
test.imptest: Records: 2  Deleted: 0  Skipped: 0  Warnings: 0
$ mysql -e 'SELECT * FROM imptest' test
+------+---------------+
| id   | n             |
+------+---------------+
|  100 | Max Sydow     |
|  101 | Count Dracula |
+------+---------------+
@end example


@node mysqlshow, myisampack, mysqlimport, Client-Side Scripts
@section @code{mysqlshow}, Showing Databases, Tables, and Columns

@cindex databases, displaying
@cindex displaying, database information
@cindex tables, displaying
@cindex columns, displaying
@cindex showing, database information

@code{mysqlshow} can be used to quickly look at which databases exist,
their tables, and the table's columns.

With the @code{mysql} program you can get the same information with the
@code{SHOW} commands.  @xref{SHOW}.

@code{mysqlshow} is invoked like this:

@example
shell> mysqlshow [OPTIONS] [database [table [column]]]
@end example

@itemize @bullet
@item
If no database is given, all matching databases are shown.
@item
If no table is given, all matching tables in the database are shown.
@item
If no column is given, all matching columns and column types in the table
are shown.
@end itemize

Note that in newer MySQL versions, you only see those
database/tables/columns for which you have some privileges.

If the last argument contains a shell or SQL wildcard (@code{*},
@code{?}, @code{%} or @code{_}), only what's matched by the wildcard
is shown.  If a database name contains any underscores, those should be escaped
with backslash (some Unix shells will require two), in order to get
tables / columns properly. '*' are converted into SQL '%' wildcard and
'?' into SQL '_' wildcard.  This may cause some confusion when you try
to display the columns for a table with a @code{_} as in this case
@code{mysqlshow} only shows you the table names that match the pattern.
This is easily fixed by adding an extra @code{%} last on the
command-line (as a separate argument).


@node myisampack, mysql_config, mysqlshow, Client-Side Scripts
@section @code{myisampack}, The MySQL Compressed Read-only Table Generator

@cindex compressed tables
@cindex tables, compressed
@cindex MyISAM, compressed tables
@cindex @code{myisampack}
@cindex @code{pack_isam}

@code{myisampack} is used to compress MyISAM tables, and @code{pack_isam}
is used to compress ISAM tables. Because ISAM tables are deprecated, we
will discuss only @code{myisampack} here, but everything said about
@code{myisampack} should also be true for @code{pack_isam}.

@code{myisampack} works by compressing each column in the table separately.
The information needed to decompress columns is read into memory when the
table is opened. This results in much better performance when accessing
individual records, because you only have to uncompress exactly one record, not
a much larger disk block as when using Stacker on MS-DOS.
Usually, @code{myisampack} packs the datafile 40%-70%.

MySQL uses memory mapping (@code{mmap()}) on compressed tables and
falls back to normal read/write file usage if @code{mmap()} doesn't work.

Please note the following:
@itemize @bullet
@item
After packing, the table is read-only. This is generally intended
(such as when accessing packed tables on a CD). Also allowing writes
to a packed table is on our TODO list but with low priority.
@item
@code{myisampack} can also pack @code{BLOB} or @code{TEXT} columns.
The older @code{pack_isam} (for @code{ISAM} tables) cannot do this.
@end itemize

@code{myisampack} is invoked like this:

@example
shell> myisampack [options] filename ...
@end example

Each filename should be the name of an index (@file{.MYI}) file.  If you
are not in the database directory, you should specify the pathname to the
file.  It is permissible to omit the @file{.MYI} extension.

@code{myisampack} supports the following options:

@table @code
@item -b, --backup
Make a backup of the table as @code{tbl_name.OLD}.

@item -#, --debug=debug_options
Output debug log. The @code{debug_options} string often is
@code{'d:t:o,filename'}.

@item -f, --force
Force packing of the table even if it becomes bigger or if the temporary file
exists.  @code{myisampack} creates a temporary file named @file{tbl_name.TMD}
while it compresses the table.  If you kill @code{myisampack}, the @file{.TMD}
file may not be deleted.  Normally, @code{myisampack} exits with an error if
it finds that @file{tbl_name.TMD} exists.  With @code{--force},
@code{myisampack} packs the table anyway.

@item -?, --help
Display a help message and exit.

@item -j big_tbl_name, --join=big_tbl_name
Join all tables named on the command-line into a single table
@code{big_tbl_name}.  All tables that are to be combined
@strong{must} be identical (same column names and types, same indexes, etc.).

@item -p #, --packlength=#
Specify the record length storage size, in bytes.  The value should be 1, 2,
or 3.  (@code{myisampack} stores all rows with length pointers of 1, 2, or 3
bytes.  In most normal cases, @code{myisampack} can determine the right length
value before it begins packing the file, but it may notice during the packing
process that it could have used a shorter length. In this case,
@code{myisampack} will print a note that the next time you pack the same file,
you could use a shorter record length.)

@item -s, --silent
Silent mode.  Write output only when errors occur.

@item -t, --test
Don't actually pack table, just test packing it.

@item -T dir_name, --tmp_dir=dir_name
Use the named directory as the location in which to write the temporary table.

@item -v, --verbose
Verbose mode.  Write information about progress and packing result.

@item -V, --version
Display version information and exit.

@item -w, --wait

Wait and retry if table is in use.  If the @code{mysqld} server was
invoked with the @code{--skip-external-locking} option, it is not a good idea
to invoke @code{myisampack} if the table might be updated during the
packing process.
@end table

@cindex examples, compressed tables
The sequence of commands shown here illustrates a typical table compression
session:

@example
shell> ls -l station.*
-rw-rw-r--   1 monty    my         994128 Apr 17 19:00 station.MYD
-rw-rw-r--   1 monty    my          53248 Apr 17 19:00 station.MYI
-rw-rw-r--   1 monty    my           5767 Apr 17 19:00 station.frm

shell> myisamchk -dvv station

MyISAM file:     station
Isam-version:  2
Creation time: 1996-03-13 10:08:58
Recover time:  1997-02-02  3:06:43
Data records:              1192  Deleted blocks:              0
Datafile: Parts:           1192  Deleted data:                0
Datafile pointer (bytes):     2  Keyfile pointer (bytes):     2
Max datafile length:   54657023  Max keyfile length:   33554431
Recordlength:               834
Record format: Fixed length

table description:
Key Start Len Index   Type                       Root  Blocksize    Rec/key
1   2     4   unique  unsigned long              1024       1024          1
2   32    30  multip. text                      10240       1024          1

Field Start Length Type
1     1     1
2     2     4
3     6     4
4     10    1
5     11    20
6     31    1
7     32    30
8     62    35
9     97    35
10    132   35
11    167   4
12    171   16
13    187   35
14    222   4
15    226   16
16    242   20
17    262   20
18    282   20
19    302   30
20    332   4
21    336   4
22    340   1
23    341   8
24    349   8
25    357   8
26    365   2
27    367   2
28    369   4
29    373   4
30    377   1
31    378   2
32    380   8
33    388   4
34    392   4
35    396   4
36    400   4
37    404   1
38    405   4
39    409   4
40    413   4
41    417   4
42    421   4
43    425   4
44    429   20
45    449   30
46    479   1
47    480   1
48    481   79
49    560   79
50    639   79
51    718   79
52    797   8
53    805   1
54    806   1
55    807   20
56    827   4
57    831   4

shell> myisampack station.MYI
Compressing station.MYI: (1192 records)
- Calculating statistics

normal:     20  empty-space:      16  empty-zero:        12  empty-fill:  11
pre-space:   0  end-space:        12  table-lookups:      5  zero:         7
Original trees:  57  After join: 17
- Compressing file
87.14%

shell> ls -l station.*
-rw-rw-r--   1 monty    my         127874 Apr 17 19:00 station.MYD
-rw-rw-r--   1 monty    my          55296 Apr 17 19:04 station.MYI
-rw-rw-r--   1 monty    my           5767 Apr 17 19:00 station.frm

shell> myisamchk -dvv station

MyISAM file:     station
Isam-version:  2
Creation time: 1996-03-13 10:08:58
Recover time:  1997-04-17 19:04:26
Data records:              1192  Deleted blocks:              0
Datafile: Parts:           1192  Deleted data:                0
Datafilepointer (bytes):      3  Keyfile pointer (bytes):     1
Max datafile length:   16777215  Max keyfile length:     131071
Recordlength:               834
Record format: Compressed

table description:
Key Start Len Index   Type                       Root  Blocksize    Rec/key
1   2     4   unique  unsigned long             10240       1024          1
2   32    30  multip. text                      54272       1024          1

Field Start Length Type                         Huff tree  Bits
1     1     1      constant                             1     0
2     2     4      zerofill(1)                          2     9
3     6     4      no zeros, zerofill(1)                2     9
4     10    1                                           3     9
5     11    20     table-lookup                         4     0
6     31    1                                           3     9
7     32    30     no endspace, not_always              5     9
8     62    35     no endspace, not_always, no empty    6     9
9     97    35     no empty                             7     9
10    132   35     no endspace, not_always, no empty    6     9
11    167   4      zerofill(1)                          2     9
12    171   16     no endspace, not_always, no empty    5     9
13    187   35     no endspace, not_always, no empty    6     9
14    222   4      zerofill(1)                          2     9
15    226   16     no endspace, not_always, no empty    5     9
16    242   20     no endspace, not_always              8     9
17    262   20     no endspace, no empty                8     9
18    282   20     no endspace, no empty                5     9
19    302   30     no endspace, no empty                6     9
20    332   4      always zero                          2     9
21    336   4      always zero                          2     9
22    340   1                                           3     9
23    341   8      table-lookup                         9     0
24    349   8      table-lookup                        10     0
25    357   8      always zero                          2     9
26    365   2                                           2     9
27    367   2      no zeros, zerofill(1)                2     9
28    369   4      no zeros, zerofill(1)                2     9
29    373   4      table-lookup                        11     0
30    377   1                                           3     9
31    378   2      no zeros, zerofill(1)                2     9
32    380   8      no zeros                             2     9
33    388   4      always zero                          2     9
34    392   4      table-lookup                        12     0
35    396   4      no zeros, zerofill(1)               13     9
36    400   4      no zeros, zerofill(1)                2     9
37    404   1                                           2     9
38    405   4      no zeros                             2     9
39    409   4      always zero                          2     9
40    413   4      no zeros                             2     9
41    417   4      always zero                          2     9
42    421   4      no zeros                             2     9
43    425   4      always zero                          2     9
44    429   20     no empty                             3     9
45    449   30     no empty                             3     9
46    479   1                                          14     4
47    480   1                                          14     4
48    481   79     no endspace, no empty               15     9
49    560   79     no empty                             2     9
50    639   79     no empty                             2     9
51    718   79     no endspace                         16     9
52    797   8      no empty                             2     9
53    805   1                                          17     1
54    806   1                                           3     9
55    807   20     no empty                             3     9
56    827   4      no zeros, zerofill(2)                2     9
57    831   4      no zeros, zerofill(1)                2     9
@end example

The information printed by @code{myisampack} is described here:

@table @code
@item normal
The number of columns for which no extra packing is used.

@item empty-space
The number of columns containing
values that are only spaces; these will occupy 1 bit.

@item empty-zero
The number of columns containing
values that are only binary 0's; these will occupy 1 bit.

@item empty-fill
The number of integer columns that don't occupy the full byte range of their
type; these are changed to a smaller type (for example, an @code{INTEGER}
column may be changed to @code{MEDIUMINT}).

@item pre-space
The number of decimal columns that are stored with leading spaces. In this
case, each value will contain a count for the number of leading spaces.

@item end-space
The number of columns that have a lot of trailing spaces.  In this case, each
value will contain a count for the number of trailing spaces.

@item table-lookup
The column had only a small number of different values, which were
converted to an @code{ENUM} before Huffman compression.

@item zero
The number of columns for which all values are zero.

@item Original trees
The initial number of Huffman trees.

@item After join
The number of distinct Huffman trees left after joining
trees to save some header space.
@end table

After a table has been compressed, @code{myisamchk -dvv} prints additional
information about each field:

@table @code
@item Type
The field type may contain the following descriptors:

@table @code
@item constant
All rows have the same value.

@item no endspace
Don't store endspace.

@item no endspace, not_always
Don't store endspace and don't do end space compression for all values.

@item no endspace, no empty
Don't store endspace. Don't store empty values.

@item table-lookup
The column was converted to an @code{ENUM}.

@item zerofill(n)
The most significant @code{n} bytes in the value are always 0 and are not
stored.

@item no zeros
Don't store zeros.

@item always zero
0 values are stored in 1 bit.
@end table

@item Huff tree
The Huffman tree associated with the field.

@item Bits
The number of bits used in the Huffman tree.
@end table

After you have run @code{pack_isam}/@code{myisampack} you must run
@code{isamchk}/@code{myisamchk} to re-create the index.  At this time you
can also sort the index blocks and create statistics needed for
the MySQL optimizer to work more efficiently:

@example
myisamchk -rq --analyze --sort-index table_name.MYI
isamchk   -rq --analyze --sort-index table_name.ISM
@end example

After you have installed the packed table into the MySQL database
directory you should do @code{mysqladmin flush-tables} to force @code{mysqld}
to start using the new table.

If you want to unpack a packed table, you can do this with the
@code{--unpack} option to @code{isamchk} or @code{myisamchk}.


@node mysql_config, perror, myisampack, Client-Side Scripts
@section @code{mysql_config}, Get compile options for compiling clients

@code{mysql_config} provides you with useful information how to compile
your MySQL client and connect it to MySQL.

@code{mysql_config} supports the following options:

@table @code
@item --cflags
Compiler flags to find include files and critical ccompiler flags and
defines used when compiling the @code{libmysqlclient} library.
@item --include
Compiler options to find MySQL include files. (Normally one would use
@code{--cflags} instead of this)
@item --libs
Libraries and options required to link with the MySQL client library.
@item --libs_r
Libraries and options required to link with the thread-safe MySQL client library.
@item --socket
The default socket name, defined when configuring MySQL.
@item --port
The default port number, defined when configuring MySQL.
@item --version
Version number and version for the MySQL distribution.
@item --libmysqld-libs or --embedded
Libraries and options required to link with the MySQL embedded server.
@end table

If you execute @code{mysql_config} without any options it will print
all options it supports plus the value of all options:

@example
shell> mysql_config
Usage: /usr/local/mysql/bin/mysql_config [OPTIONS]
Options:
        --cflags         [-I/usr/local/mysql/include/mysql -mcpu=pentiumpro]
        --include        [-I/usr/local/mysql/include/mysql]
        --libs           [-L/usr/local/mysql/lib/mysql -lmysqlclient -lz -lcrypt -lnsl -lm -L/usr/lib -lssl -lcrypto]
        --libs_r         [-L/usr/local/mysql/lib/mysql -lmysqlclient_r -lpthread -lz -lcrypt -lnsl -lm -lpthread]
        --socket         [/tmp/mysql.sock]
        --port           [3306]
        --version        [4.0.16]
        --libmysqld-libs [-L/usr/local/mysql/lib/mysql -lmysqld -lpthread -lz -lcrypt -lnsl -lm -lpthread -lrt]
@end example

You can use this to compile a MySQL client by as follows:

@example
CFG=/usr/local/mysql/bin/mysql_config
sh -c "gcc -o progname `$CFG --cflags` progname.c `$CFG --libs`"
@end example

@node perror,  , mysql_config, Client-Side Scripts
@section @code{perror}, Explaining Error Codes

@cindex error messages, displaying
@cindex perror

@cindex errno
@cindex Errcode

For most system errors MySQL will, in addition to a internal text message,
also print the system error code in one of the following styles:
@code{message ... (errno: #)} or @code{message ... (Errcode: #)}.

You can find out what the error code means by either examining the
documentation for your system or use the @code{perror} utility.

@code{perror} prints a description for a system error code, or an MyISAM/ISAM
storage engine (table handler) error code.

@code{perror} is invoked like this:

@example
shell> perror [OPTIONS] [ERRORCODE [ERRORCODE...]]

Example:

shell> perror 13 64
Error code  13:  Permission denied
Error code  64:  Machine is not on the network
@end example

Note that the error messages are mostly system dependent!


@node Reference, Language Structure, Client-Side Scripts, Top
@chapter MySQL Language Reference

@c TODO: The Reference chapter now has been split up into several smaller
@c chapers.  Some of them will soon become bigger as material from elsewhere
@c in the manual moves into them. (E.g., descriptions for all SQL statements
@c will move to the SQL Syntax chapter.)  This node is left in place so as
@c not to break external links to our web site for now.

MySQL has a very complex, but intuitive and easy to learn SQL
interface.  The next several chapters of the manual comprise a language
reference. They describe the various commands, types,
and functions you will need to know in order to use MySQL efficiently and
effectively.  These chapters also serve as a reference to all functionality
included in MySQL. The material they contain is grouped by topic:

@itemize @bullet
@item

See @ref{Language Structure} for information about how to write data values,
identifiers, and comments.

@item
See @ref{Column types} for information about the various column types that
MySQL supports for storing data in tables.

@item
See @ref{Functions} for a list of the functions and operators that you can
use when writing expressions.

@item
See @ref{SQL Syntax} for descriptions of the SQL statements that MySQL
supports.

@end itemize

In order to use this material most effectively, you may find
it useful to refer to the various indexes.


@node Language Structure, Column types, Reference, Top
@chapter Language Structure

This chapter discusses the rules for writing the following elements of SQL
statements when using MySQL:

@itemize @bullet

@item
Literal values such as strings and numbers

@item
Identifiers such as table and column names

@item
User and system variables

@item
Comments

@item
Reserved words

@end itemize

@menu
* Literals::                    Literal Values
* Legal names::                 Database, Table, Index, Column, and Alias Names
* Variables::                   User Variables
* System Variables::            System Variables
* Comments::                    Comment Syntax
* Reserved words::              Treatment of Reserved Words in MySQL
@end menu


@node Literals, Legal names, Language Structure, Language Structure
@section Literal Values

@cindex strings, defined
@cindex strings, escaping characters
@cindex literals
@cindex escape characters
@cindex backslash, escape character


This section describes how to write literal values in MySQL. These include
strings, numbers, hexadecimal values, boolean values, and @code{NULL}. The section also
covers the various nuances and ``gotchas'' that
you may run into when dealing with these basic types in MySQL.

@menu
* String syntax::               Strings
* Number syntax::               Numbers
* Hexadecimal values::          Hexadecimal Values
* Boolean values::              Boolean Values
* NULL values::                 @code{NULL} Values
@end menu


@node String syntax, Number syntax, Literals, Literals
@subsection Strings

A string is a sequence of characters, surrounded by either single quote
(@samp{'}) or double quote.  Examples:

@example
'a string'
"another string"
@end example

If the server SQL mode has @code{ANSI_QUOTES} enabled, string literals can be
quoted only with single quotes. (A string quoted with double quotes will be
interpreted as an identifier.)

Within a string, certain sequences have special meaning.  Each of these
sequences begins with a backslash (@samp{\}), known as the @emph{escape
character}.  MySQL recognizes the following escape sequences:

@c these aren't really functions, but that's probably the most reasonable index
@table @code
@findex \0 (ASCII 0)
@findex NUL
@item \0
An ASCII 0 (@code{NUL}) character.

@findex \' (single quote)
@findex single quote (\')
@item \'
A single quote (@samp{'}) character.

@findex \" (double quote)
@findex double quote (\")
@item \"
A double quote (@samp{"}) character.

@findex \b (backspace)
@findex backspace (\b)
@item \b
A backspace character.

@findex \n (newline)
@findex newline (\n)
@findex \n (linefeed)
@findex linefeed (\n)
@item \n
A newline (linefeed) character.

@findex \r (carriage return)
@findex return (\r)
@findex carriage return (\r)
@item \r
A carriage return character.

@findex \t (tab)
@findex tab (\t)
@item \t
A tab character.

@findex \z (Control-Z) ASCII 26
@findex (Control-Z) \z
@item \z
ASCII 26 (Control-Z).  This character can be encoded as @samp{\z}
to allow you to
work around the problem that ASCII 26 stands for END-OF-FILE on Windows.
(ASCII 26 will cause problems if you try to use
@code{mysql db_name < file_name}.)

@findex \\ (escape)
@findex escape (\\)
@item \\
A backslash (@samp{\}) character.

@findex % (wildcard character)
@findex Wildcard character (%)
@item \%
A @samp{%} character. This is used to search for literal instances of
@samp{%} in pattern-matching contexts where @samp{%} would otherwise be interpreted
as a wildcard character. @xref{String comparison functions}.

@findex _ (wildcard character)
@findex Wildcard character (_)
@item \_
A @samp{_} character. This is used to search for literal instances of
@samp{_} in pattern-matching contexts where @samp{_} would otherwise be interpreted
as a wildcard character. @xref{String comparison functions}.
@end table

These sequences are case sensitive. For example, @samp{\b} is interpreted as
a backslash, but @samp{\B} is interpreted as @samp{B}.

Note that if you use @samp{\%} or @samp{\_} in some string contexts, these
will return the strings @samp{\%} and @samp{\_} and not @samp{%} and
@samp{_}.

@cindex quotes, in strings
@noindent
There are several ways to include quotes within a string:

@itemize @bullet
@item
A @samp{'} inside a string quoted with @samp{'} may be written as @samp{''}.

@item
A @samp{"} inside a string quoted with @samp{"} may be written as @samp{""}.

@item
You can precede the quote character with an escape character (@samp{\}).

@item
A @samp{'} inside a string quoted with @samp{"} needs no special treatment
and need not be doubled or escaped.  In the same way, @samp{"} inside a
string quoted with @samp{'} needs no special treatment.
@end itemize

The @code{SELECT} statements shown here demonstrate how quoting and
escaping work:

@example
mysql> SELECT 'hello', '"hello"', '""hello""', 'hel''lo', '\'hello';
+-------+---------+-----------+--------+--------+
| hello | "hello" | ""hello"" | hel'lo | 'hello |
+-------+---------+-----------+--------+--------+

mysql> SELECT "hello", "'hello'", "''hello''", "hel""lo", "\"hello";
+-------+---------+-----------+--------+--------+
| hello | 'hello' | ''hello'' | hel"lo | "hello |
+-------+---------+-----------+--------+--------+

mysql> SELECT "This\nIs\nFour\nlines";
+--------------------+
| This
Is
Four
lines |
+--------------------+
@end example

@cindex quoting binary data

If you want to insert binary data into a string column (such as a
@code{BLOB}), the following characters must be represented by escape
sequences:
@table @code
@item NUL
@code{NUL} byte (ASCII 0).
Represent this character by @samp{\0} (a backslash followed by an ASCII @samp{0} character).
@item \
Backslash (ASCII 92).  Represent this character by @samp{\\}.
@item '
Single quote (ASCII 39).  Represent this character by @samp{\'}.
@item "
Double quote (ASCII 34).  Represent this character by @samp{\"}.
@end table

@cindex quoting
@cindex @code{BLOB}, inserting binary data
@findex mysql_real_escape_string()
@findex DBI->quote
When writing application programs, any string that might contain any of these
special characters
must be properly escaped before the string is used as a data value in a SQL
statement that is sent to the MySQL server.
You can do this in two ways:

@itemize @bullet
@item
Process the string with a function that escapes the special characters.
For example, if you write C code, you can use the C API function
@code{mysql_real_escape_string()} to escape characters.
@xref{C API function overview}.  The Perl DBI interface provides a
@code{quote} method to convert special characters to the proper escape
sequences.  @xref{Perl}.

@item
As an alternative to explicitly escaping special characters,
many MySQL APIs provide some sort of placeholder capability
that allows you to insert special markers into a query string, and then bind
data values to them when you issue the query.  In this case, the API takes
care of escaping special characters in the values for you.

@end itemize


@node Number syntax, Hexadecimal values, String syntax, Literals
@subsection Numbers

@cindex numbers
@cindex valid numbers, examples
@cindex integers
@cindex floats
@cindex negative values
@findex TRUE
@findex FALSE

Integers are represented as a sequence of digits. Floats use @samp{.} as a
decimal separator.  Either type of number may be preceded by @samp{-} to
indicate a negative value.

Examples of valid integers:

@example
1221
0
-32
@end example

Examples of valid floating-point numbers:

@example
294.42
-32032.6809e+10
148.00
@end example

An integer may be used in a floating-point context; it is interpreted
as the equivalent floating-point number.


@node Hexadecimal values, Boolean values, Number syntax, Literals
@subsection Hexadecimal Values

@tindex hexadecimal values

MySQL supports hexadecimal values.  In numeric contexts, these act
like integers (64-bit precision). In string contexts, these act like binary
strings, where each pair of hex digits is converted to a character:

@example
mysql> SELECT x'4D7953514C';
        -> 'MySQL'
mysql> SELECT 0xa+0;
        -> 10
mysql> SELECT 0x5061756c;
        -> 'Paul'
@end example

In MySQL 4.1 (and in MySQL 4.0 when using the @code{--new} option) the default
type of of a hexadecimal value is a string.  If you want to ensure that
the value is treated as a number, you can use @code{CAST(... AS UNSIGNED)}:

@example
mysql> SELECT 0x41, CAST(0x41 AS UNSIGNED);
        -> 'A', 65
@end example

The @code{0x} syntax is based on ODBC.  Hexadecimal strings are often used by
ODBC to supply values for @code{BLOB} columns.
The @code{x'hexstring'} syntax is new in 4.0 and is based on standard SQL.

Beginning with MySQL 4.0.1, you can convert a string or a number to a string
in hexadecimal format with the @code{HEX()} function:

@example
mysql> SELECT HEX('cat');
        -> '636174'
mysql> SELECT 0x636174;
        -> 'cat'
@end example

@node Boolean values, NULL values, Hexadecimal values, Literals
@subsection Boolean Values

Beginning with MySQL 4.1.0, the constant @code{TRUE} evaluates to @code{1} and
the constant @code{FALSE} evaluates to @code{0}. The constant names can be
written in any lettercase.

@example
mysql> SELECT TRUE, true, FALSE, false;
        -> 1, 1, 0, 0
@end example


@node NULL values,  , Boolean values, Literals
@subsection @code{NULL} Values

@tindex NULL value

The @code{NULL} value means ``no data.''
@code{NULL} can be written in any lettercase.

Be aware that the @code{NULL} value is different than values such
as @code{0} for numeric types or the empty string for string types.
@xref{Problems with NULL, , Problems with @code{NULL}}.

@code{NULL} may be represented by @code{\N} when using the text file import
or export formats (@code{LOAD DATA INFILE}, @code{SELECT ... INTO OUTFILE}).
@xref{LOAD DATA, , @code{LOAD DATA}}.


@node Legal names, Variables, Literals, Language Structure
@section Database, Table, Index, Column, and Alias Names

@menu
* Identifier qualifiers::       Identifier Qualifiers
* Name case sensitivity::       Identifier Case Sensitivity
@end menu

@cindex identifiers
@cindex names
@cindex legal names
@cindex databases, names
@cindex tables, names
@cindex indexes, names
@cindex columns, names
@cindex aliases, names

Database, table, index, column, and alias names are identifiers.
This section describes the allowable syntax for identifiers in MySQL.

The following table describes the maximum length and allowable characters for
each type of identifier.

@multitable @columnfractions .15 .15 .70
@item @strong{Identifier} @tab @strong{Maximum length (bytes)} @tab @strong{Allowed characters}
@item Database @tab 64 @tab Any character that is allowed in a directory name except @samp{/}, @samp{\}, or @samp{.}
@item Table @tab 64 @tab Any character that is allowed in a filename, except @samp{/}, @samp{\}, or @samp{.}
@item Column @tab 64 @tab All characters
@item Index @tab 64 @tab All characters
@item Alias @tab 255 @tab All characters
@end multitable

In addition to the restrictions noted in the table, no identifier can contain
ASCII 0, ASCII 255, or the quoting character.

@tindex identifiers, quoting
@tindex quoting of identifiers
@tindex `
@tindex "

An identifier may be quoted or unquoted.  If an identifier is a reserved
word or contains special characters, you @strong{must} quote it whenever you
refer to it.  For a list of reserved words, see @ref{Reserved words}.
Special characters are those outside the set of alphanumeric characters from
the current character set, @samp{_}, and @samp{$}.

The quote character is the backtick (@samp{`}):

@example
mysql> SELECT * FROM `select` WHERE `select`.id > 100;
@end example

If the server SQL mode includes the @code{ANSI_QUOTES} mode option,
it is also allowable to quote identifiers with double quotes:

@example
mysql> CREATE TABLE "test" (col INT);
ERROR 1064: You have an error in your SQL syntax. (...)
mysql> SET sql_mode="ANSI_QUOTES";
mysql> CREATE TABLE "test" (col INT);
Query OK, 0 rows affected (0.00 sec)
@end example

@xref{SQL mode}.

Identifier quoting was introduced in MySQL 3.23.6 to allow use of
identifiers that are reserved words or that contain special characters.
Before 3.23.6, cannot use identifiers that require quotes, so the rules for
legal identifiers are more restrictive:

@itemize @bullet
@item
A name may consist of alphanumeric characters from the current character set,
@samp{_}, and @samp{$}. The default character set is ISO-8859-1
(Latin1). This may be changed with the @code{--default-character-set} option
to @code{mysqld}.
@xref{Character sets}.

@item
A name may start with any character that is legal in a name.  In particular,
a name may start with a digit; this differs from many other database
systems!  However, a name cannot consist @emph{only} of digits.

@item
You cannot use the @samp{.} character in names because it is used to extend the
format by which you can refer to columns (see immediately below).
@end itemize

It is recommended that you do not use names like @code{1e}, because
an expression like @code{1e+1} is ambiguous. It may be interpreted as the
expression @code{1e + 1} or as the number @code{1e+1}.


@node Identifier qualifiers, Name case sensitivity, Legal names, Legal names
@subsection Identifier Qualifiers

MySQL allows names that consist of a single identifier or
multiple identifiers. The components of a multiple-part name should be
separated by period (@samp{.}) characters. The initial parts of a
multiple-part name act as qualifiers that affect the context within which
the final identifier is interpreted.

In MySQL you can refer to a column using any of the following forms:

@multitable @columnfractions .30 .70
@item @strong{Column reference} @tab @strong{Meaning}
@item @code{col_name} @tab Column @code{col_name}
from whichever table used in the query contains a column of that name.
@item @code{tbl_name.col_name} @tab Column @code{col_name} from table
@code{tbl_name} of the current database.
@item @code{db_name.tbl_name.col_name} @tab Column @code{col_name} from table
@code{tbl_name} of the database @code{db_name}.  This syntax is unavailable
before MySQL Version 3.22.
@end multitable

If any components of a multiple-part name require quoting, quote them
individually rather than quoting the name as a whole. For example,
@code{`my-table`.`my-column`} is legal, but @code{`my-table.my-column`} is
not.

You need not specify a @code{tbl_name} or @code{db_name.tbl_name} prefix for
a column reference in a statement unless the reference would be ambiguous.
Suppose tables @code{t1} and @code{t2} each contain a column
@code{c}, and you retrieve @code{c} in a @code{SELECT} statement that uses
both @code{t1} and @code{t2}.  In this case, @code{c} is ambiguous because it
is not unique among the tables used in the statement. You must qualify it
with a table name as @code{t1.c} or @code{t2.c} to indicate which table you
mean.  Similarly, to retrieve from a table @code{t} in database @code{db1}
and from a table @code{t} in database @code{db2} in the same statement,
you must refer to columns in those tables as @code{db1.t.col_name}
and @code{db2.t.col_name}.

@cindex ODBC compatibility
@cindex compatibility, with ODBC
The syntax @code{.tbl_name} means the table @code{tbl_name} in the current
database.  This syntax is accepted for ODBC compatibility, because some ODBC
programs prefix table names with a @samp{.} character.


@node Name case sensitivity,  , Identifier qualifiers, Legal names
@subsection Identifier Case Sensitivity

@cindex identifiers, case sensitivity
@cindex case sensitivity, in identifiers
@cindex names, case sensitivity
@cindex case sensitivity, in names
@cindex database names, case sensitivity
@cindex table names, case sensitivity
@cindex column names, case sensitivity
@cindex alias names, case sensitivity

In MySQL, databases correspond to directories within the data directory.
Tables within a database correspond to at least one file within the database
directory (and possibly more, depending on the storage engine).
Consequently, the case sensitivity of the
underlying operating system determines the case sensitivity of database and
table names.  This means database and table names are not case sensitive in
Windows, and case sensitive in most varieties of Unix. One notable
exception is Mac OS X, for which the default filesystem type (HFS+) is not
case sensitive.  However Mac OS X also supports UFS volumes, which are case
sensitive just as on any Unix.
@xref{Extensions to ANSI}.

@strong{Note:} Although database and table names are not case sensitive on
some platforms, you should not refer to a given database or table using
different
cases within the same query.  The following query would not work because it
refers to a table both as @code{my_table} and as @code{MY_TABLE}:

@example
mysql> SELECT * FROM my_table WHERE MY_TABLE.col=1;
@end example

Column names, index names,
and column aliases are not case sensitive on any platform.

Table aliases are case sensitive before MySQL 4.1.1.  The following
query would not work because it refers to the alias both as @code{a} and
as @code{A}:

@example
mysql> SELECT col_name FROM tbl_name AS a
    -> WHERE a.col_name = 1 OR A.col_name = 2;
@end example

If you have trouble remembering the lettercase for database and table names,
adopt a consistent convention, such as always creating databases and
tables using lowercase names.

How table names are stored on disk and used in MySQL is defined by the
@code{lower_case_table_names} variable, which you can set when starting
@code{mysqld}.  It can take one of the following values:

@multitable @columnfractions .10 .90
@item @strong{Value} @tab @strong{Meaning}
@item 0 @tab Table and database names are case sensitive and are stored on disk using the lettercase specified in the @code{CREATE TABLE} or @code{CREATE DATABASE} statement.  This is the default on Unix systems.
@item 1 @tab Table and database names are not case sensitive and are stored on disk in lowercase. MySQL will convert all table names to lowercase on storage and lookup. This is the default on Windows and Mac OS X systems. (This option also applies to database names as of MySQL 4.0.2, and to table aliases as of 4.1.1.)
@item 2 @tab New in 4.0.18: Table and database names are not case sensitive, but are stored on disk using the lettercase specified in the @code{CREATE TABLE} or @code{CREATE DATABASE} statement. MySQL will convert all table names to lowercase on storage and lookup. @strong{Note:} This works @strong{only} on file systems that are not case sensitive!
@end multitable

If you are using MySQL on only one platform, you don't normally have to
change the @code{lower_case_table_names} variable. However, you may encounter
difficulties if you want to transfer tables between platforms that differ in
filesystem case sensitivity. For example, on Unix, you can have two different
tables named @code{my_table} and @code{MY_TABLE}, but on Windows those names
are considered the same.  To avoid data transfer problems stemming from
database or table name lettercase, you have two options:

@itemize @bullet
@item
Use @code{lower_case_table_names=1} on all systems. The main disadvantage
with this is that when you use @code{SHOW TABLES} or @code{SHOW DATABASES},
you don't see the names in their original case.

@item
Use @code{lower_case_table_names=0} on Unix and @code{lower_case_table_names=2}
on Windows. This will preserve the case of database and table names.
The disadvantage of this is that you must ensure that you always refer
to your database and table names with the correct case on Windows as things will
not work on Unix if you use the wrong case (as Unix is case sensitive).
@end itemize

Note that if you set @code{lower_case_table_names} to 1 on Unix, you must
first convert your old database and table names to lowercase before restarting
@code{mysqld}.

@node Variables, System Variables, Legal names, Language Structure
@section User Variables

@cindex variables, user
@cindex user variables
@cindex names, variables

MySQL supports user variables as of version 3.23.6. You can store a value in
a user variable and refer to it later, which allows you to pass values from
one statement to another. User variables are connection-specific. That is,
a variable defined by one client cannot be seen or used by other clients.
All variables for a client connection are automatically freed when the
client exits.

User variables are written as @code{@@var_name}, where the variable name
@code{var_name} may consist of alphanumeric characters from the current
character set, @samp{_}, @samp{$}, and @samp{.} . The default character set
is ISO-8859-1 (Latin1). This may be changed with the
@code{--default-character-set} option to @code{mysqld}. @xref{Character
sets}. User variable names are not case insensitive beginning with MySQL 5.0.
Before that, they are case sensitive.

One way to set a user variable is by issuing a @code{SET} statement:

@example
SET @@var_name = expression [,@@var_name = expression] ...
@end example

The @code{expression} assigned to the variable can evaluate to an integer,
real, string, or @code{NULL} value.

You can also assign a value to a user variable in statements other than
@code{SET}.  However, in this case, the assignment operator is @code{:=}
rather than @code{=}, because @code{=} is treated as a comparison operator
in non-@code{SET} statements:

@example
mysql> SET @@t1=0, @@t2=0, @@t3=0;
mysql> SELECT @@t1:=(@@t2:=1)+@@t3:=4,@@t1,@@t2,@@t3;
+----------------------+------+------+------+
| @@t1:=(@@t2:=1)+@@t3:=4 | @@t1  | @@t2  | @@t3  |
+----------------------+------+------+------+
|                    5 |    5 |    1 |    4 |
+----------------------+------+------+------+
@end example

User variables may be used where expressions are allowed.  However, this
does not currently include contexts that explicitly require a number, such
as in the @code{LIMIT} clause of a @code{SELECT} statement, or the
@code{IGNORE number LINES} clause of a @code{LOAD DATA} statement.

If you refer to a variable that has not been initialized, its value
is @code{NULL}.

@strong{Note:} In a @code{SELECT} statement, each expression is evaluated
only when it's sent to the client.  This means that in the @code{HAVING},
@code{GROUP BY}, or @code{ORDER BY} clause, you can't refer to an expression
that involves variables that are set in the @code{SELECT} part. For example,
the following statement will @strong{not} work as expected:

@example
mysql> SELECT (@@aa:=id) AS a, (@@aa+3) AS b FROM table_name HAVING b=5;
@end example

The reason is that @code{@@aa} will not contain the value of the current
row, but the value of @code{id} from the previous selected row.

The general rule is to never assign @strong{and} use the same variable in
the same statement.

Another issue with setting a variable and using it in the same statement
is that the default result type of a variable is based on the type of
the variable at the start of the statement.  The following example
illustrates this:

@example
mysql> SET @@a="test";
mysql> SELECT @@a,(@@a:=20) FROM table_name;
@end example

For the @code{SELECT} statement, MySQL will report to the client that
column one is a string and convert all accesses of @code{@@a} to strings,
even if @@a will be set to a number for the second row.  After the
@code{SELECT} statement is executed, @code{@@a} will be regarded as a
number for the next statement.

An unassigned variable has a value of @code{NULL} with a type of string.

To avoid problems with this behavior, either do not set and use the same
variable within a single statement, or else set the variable to @code{0},
@code{0.0}, or @code{''} to define its type before you use it.


@node System Variables, Comments, Variables, Language Structure
@section System Variables

@c TODO: some of this could go in the server configuration chapter...

@cindex variables, System
@cindex system variables

@menu
* Dynamic System Variables::    Dynamic System Variables
* Structured System Variables::  Structured System Variables
@end menu

Starting from MySQL 4.0.3, we provide better access to a lot of system
and connection variables. Many variables can be changed dynamically while
the server is running. This allows you to modify server operation without
having to stop and restart it.

The @code{mysqld} server maintains two kinds of variables while it runs.
Global variables affect the overall operation of the server.
Session variables affect its operation for individual client connections.

When the server starts, it initializes all global variables to their default
values. These defaults may be changed by options specified in option files
or on the command line.  After the server starts, those global variables
that are dynamic can be changed by connecting to the server and issuing
a @code{SET GLOBAL var_name} statement. To change a global variable,
you must have the @code{SUPER} privilege.

The server also maintains a set of session variables for each client
that connects. The client's session variables are initialized at connect
time using the current values of the corresponding global variables. For
those session variables that are dynamic, the client can change them
by issuing a @code{SET SESSION var_name} statement. Setting a session
variable requires no special privilege, but a client can change only its
own session variables, not those of any other client.

A change to a global variable affects only client connections that occur
after the change. It does not affect session variables for any client
that is already connected (not even those of the client that issues the
@code{SET GLOBAL} statement).

Global or session variables may be set or retrieved using several syntax
forms.  The following examples use @code{sort_buffer_size} as a sample variable
name.

To set the value of a @code{GLOBAL} variable, use one
of the following syntaxes:

@example
mysql> SET GLOBAL sort_buffer_size=value;
mysql> SET @@@@global.sort_buffer_size=value;
@end example

To set the value of a @code{SESSION} variable, use one of the
following syntaxes:

@example
mysql> SET SESSION sort_buffer_size=value;
mysql> SET @@@@session.sort_buffer_size=value;
mysql> SET sort_buffer_size=value;
@end example

@code{LOCAL} is a synonym for @code{SESSION}.

If you don't specify @code{GLOBAL}, @code{SESSION}, or @code{LOCAL} when
setting a variable, @code{SESSION} is the default.
@xref{SET OPTION,  , @code{SET OPTION}}.

To retrieve the value of a @code{GLOBAL} variable, use one of the
following statements:

@example
mysql> SELECT @@@@global.sort_buffer_size;
mysql> SHOW GLOBAL VARIABLES like 'sort_buffer_size';
@end example

To retrieve the value of a @code{SESSION} variable, use one of the
following statements:

@example
mysql> SELECT @@@@session.sort_buffer_size;
mysql> SHOW SESSION VARIABLES like 'sort_buffer_size';
@end example

Here, too, @code{LOCAL} is a synonym for @code{SESSION}.

If you don't specify @code{@@@@global}, @code{@@@@session}, or
@code{@@@@local} when retrieving a variable with @code{SELECT}, MySQL returns
the @code{SESSION} value if it exists and the @code{GLOBAL} value otherwise.

If you don't specify @code{GLOBAL}, @code{SESSION}, or @code{LOCAL} for
@code{SHOW VARIABLES}, MySQL returns the @code{SESSION} value.

The reason for requiring the @code{GLOBAL} keyword when setting
@code{GLOBAL}-only variables but not when retrieving them is to ensure that
we don't later run into problems if we would introduce a @code{SESSION}
variable with the same name or remove a @code{SESSION} variable.  In that
case, a client with the @code{SUPER} privilege might change the
@code{GLOBAL} variable by accident, rather than just the @code{SESSION}
variable for the client's own connection.

Further information about system variables can be found in the
startup options section, and in the descriptions of the @code{SHOW VARIABLES}
and @code{SET} statements.
@xref{Server options}.
@xref{SHOW VARIABLES,  , @code{SHOW VARIABLES}}.
@xref{SET OPTION,  , @code{SET OPTION}}.


@node Dynamic System Variables, Structured System Variables, System Variables, System Variables
@subsection Dynamic System Variables

The following table shows the full list of all variables that you can change
and retrieve using @code{GLOBAL} or @code{SESSION}. The last column indicates
for each variable whether @code{GLOBAL} or @code{SESSION} (or both) apply.

@multitable @columnfractions .45 .25 .30
@item @strong{Variable name} @tab @strong{Value type} @tab @strong{Type}
@item @code{autocommit} @tab bool @tab @code{SESSION}
@item @code{big_tables} @tab bool @tab @code{SESSION}
@item @code{binlog_cache_size} @tab num @tab @code{GLOBAL}
@item @code{bulk_insert_buffer_size} @tab num @tab @code{GLOBAL} | @code{SESSION}
@item @code{concurrent_insert} @tab bool @tab @code{GLOBAL}
@item @code{connect_timeout} @tab num @tab @code{GLOBAL}
@item @code{convert_character_set} @tab string @tab @code{GLOBAL} | @code{SESSION}
@item @code{delay_key_write} @tab @code{OFF} | @code{ON} | @code{ALL} @tab @code{GLOBAL}
@item @code{delayed_insert_limit} @tab num @tab @code{GLOBAL}
@item @code{delayed_insert_timeout} @tab num @tab @code{GLOBAL}
@item @code{delayed_queue_size} @tab @code{num} @tab @code{GLOBAL}
@item @code{error_count} @tab num @tab @code{SESSION}
@item @code{flush} @tab bool @tab @code{GLOBAL}
@item @code{flush_time} @tab num @tab @code{GLOBAL}
@item @code{foreign_key_checks} @tab bool @tab @code{SESSION}
@item @code{identity} @tab num @tab @code{SESSION}
@item @code{insert_id} @tab bool @tab @code{SESSION}
@item @code{interactive_timeout} @tab num @tab @code{GLOBAL} | @code{SESSION}
@item @code{join_buffer_size} @tab num @tab @code{GLOBAL} | @code{SESSION}
@item @code{key_buffer_size} @tab num @tab @code{GLOBAL}
@item @code{last_insert_id} @tab num @tab @code{SESSION}
@item @code{local_infile} @tab bool @tab @code{GLOBAL}
@item @code{log_warnings} @tab bool @tab @code{GLOBAL}
@item @code{long_query_time} @tab num @tab @code{GLOBAL} | @code{SESSION}
@item @code{low_priority_updates} @tab bool @tab @code{GLOBAL} | @code{SESSION}
@item @code{max_allowed_packet} @tab num @tab @code{GLOBAL} | @code{SESSION}
@item @code{max_binlog_cache_size} @tab num @tab @code{GLOBAL}
@item @code{max_binlog_size} @tab num @tab @code{GLOBAL}
@item @code{max_connect_errors} @tab num @tab @code{GLOBAL}
@item @code{max_connections} @tab num @tab @code{GLOBAL}
@item @code{max_error_count} @tab num @tab @code{GLOBAL} | @code{SESSION}
@item @code{max_delayed_threads} @tab num @tab @code{GLOBAL}
@item @code{max_heap_table_size} @tab num @tab @code{GLOBAL} | @code{SESSION}
@item @code{max_join_size} @tab num @tab @code{GLOBAL} | @code{SESSION}
@item @code{max_relay_log_size} @tab num @tab @code{GLOBAL}
@item @code{max_seeks_for_key} @tab num @tab @code{GLOBAL} | @code{SESSION}
@item @code{max_sort_length} @tab num @tab @code{GLOBAL} | @code{SESSION}
@item @code{max_tmp_tables} @tab num @tab @code{GLOBAL}
@item @code{max_user_connections} @tab num @tab @code{GLOBAL}
@item @code{max_write_lock_count} @tab num @tab @code{GLOBAL}
@item @code{myisam_max_extra_sort_file_size} @tab num @tab @code{GLOBAL} | @code{SESSION}
@item @code{myisam_repair_threads} @tab num @tab @code{GLOBAL} | @code{SESSION}
@item @code{myisam_max_sort_file_size} @tab num @tab @code{GLOBAL} | @code{SESSION}
@item @code{myisam_sort_buffer_size} @tab num @tab @code{GLOBAL} | @code{SESSION}
@item @code{net_buffer_length} @tab num @tab @code{GLOBAL} | @code{SESSION}
@item @code{net_read_timeout} @tab num @tab @code{GLOBAL} | @code{SESSION}
@item @code{net_retry_count} @tab num @tab @code{GLOBAL} | @code{SESSION}
@item @code{net_write_timeout} @tab num @tab @code{GLOBAL} | @code{SESSION}
@item @code{query_alloc_block_size} @tab num @tab @code{GLOBAL} | @code{SESSION}
@item @code{query_cache_limit} @tab num @tab @code{GLOBAL}
@item @code{query_cache_size} @tab num @tab @code{GLOBAL}
@item @code{query_cache_type} @tab enum @tab @code{GLOBAL}
@item @code{query_prealloc_size} @tab num @tab @code{GLOBAL} | @code{SESSION}
@item @code{range_alloc_block_size} @tab num @tab @code{GLOBAL} | @code{SESSION}
@item @code{read_buffer_size} @tab num @tab @code{GLOBAL} | @code{SESSION}
@item @code{read_rnd_buffer_size} @tab num @tab @code{GLOBAL} | @code{SESSION}
@item @code{rpl_recovery_rank} @tab num @tab @code{GLOBAL}
@item @code{safe_show_database} @tab bool @tab @code{GLOBAL}
@item @code{server_id} @tab num @tab @code{GLOBAL}
@item @code{slave_compressed_protocol} @tab bool @tab @code{GLOBAL}
@item @code{slave_net_timeout} @tab num @tab @code{GLOBAL}
@item @code{slow_launch_time} @tab num @tab @code{GLOBAL}
@item @code{sort_buffer_size} @tab num @tab @code{GLOBAL} | @code{SESSION}
@item @code{sql_auto_is_null} @tab bool @tab @code{SESSION}
@item @code{sql_big_selects} @tab bool @tab @code{SESSION}
@item @code{sql_big_tables} @tab bool @tab @code{SESSION}
@item @code{sql_buffer_result} @tab bool @tab @code{SESSION}
@item @code{sql_log_binlog} @tab bool @tab @code{SESSION}
@item @code{sql_log_off} @tab bool @tab @code{SESSION}
@item @code{sql_log_update} @tab bool @tab @code{SESSION}
@item @code{sql_low_priority_updates} @tab bool @tab @code{GLOBAL} | @code{SESSION}
@item @code{sql_max_join_size} @tab num @tab @code{GLOBAL} | @code{SESSION}
@item @code{sql_quote_show_create} @tab bool @tab @code{SESSION}
@item @code{sql_safe_updates} @tab bool @tab @code{SESSION}
@item @code{sql_select_limit} @tab bool @tab @code{SESSION}
@item @code{sql_slave_skip_counter} @tab num @tab @code{GLOBAL}
@item @code{sql_warnings} @tab bool @tab @code{SESSION}
@item @code{table_cache} @tab num @tab @code{GLOBAL}
@item @code{table_type} @tab enum @tab @code{GLOBAL} | @code{SESSION}
@item @code{thread_cache_size} @tab num @tab @code{GLOBAL}
@item @code{timestamp} @tab bool @tab @code{SESSION}
@item @code{tmp_table_size} @tab enum @tab @code{GLOBAL} | @code{SESSION}
@item @code{transaction_alloc_block_size} @tab num @tab @code{GLOBAL} | @code{SESSION}
@item @code{transaction_prealloc_size} @tab num @tab @code{GLOBAL} | @code{SESSION}
@item @code{tx_isolation} @tab enum @tab @code{GLOBAL} | @code{SESSION}
@item @code{wait_timeout} @tab num @tab @code{GLOBAL} | @code{SESSION}
@item @code{warning_count} @tab num @tab @code{SESSION}
@item @code{unique_checks} @tab bool @tab @code{SESSION}
@end multitable

Variables that are marked as @code{num} can be given a numeric
value. Variables that are marked as @code{bool} can be set to 0, 1,
@code{ON} or @code{OFF}. Variables that are marked as @code{enum} should
normally be set to one of the available values for the variable, but can
also be set to the number that correspond to the desired enumeration value.
(The first enumeration value corresponds to 0; note that this differs
from @code{ENUM} columns, for which the first enumeration value
corresponds to 1.)

Here is a description of some of the variables:

@multitable @columnfractions 0.35 0.65
@item @strong{Variable} @tab @strong{Description}
@item @code{identity} @tab Alias for @code{last_insert_id} (Sybase compatibility)
@item @code{sql_low_priority_updates} @tab Alias for @code{low_priority_updates}
@item @code{sql_max_join_size} @tab Alias for @code{max_join_size}
@item @code{version} @tab Alias for @code{VERSION()} (Sybase (?) compatibility)
@end multitable


@node Structured System Variables,  , Dynamic System Variables, System Variables
@subsection Structured System Variables

Structured system variables are supported beginning with MySQL 4.1.1.
A structured variable differs from a regular system variable in two
respects:

@itemize @bullet
@item
Its value is a structure with components that specify some
parameters of the server that are considered to be closely related.
@item
There might be several instances of a given type of structured variable.
Each one will have a different name and refers to a different resource
maintained by the server.
@end itemize

Currently, MySQL supports one structured variable type. It specifies
parameters that govern the operation of key caches. A key cache structured
variable has these components:

@itemize @bullet
@item
@code{key_buffer_size}
@item
@code{key_cache_block_size}
@item
@code{key_cache_division_limit}
@item
@code{key_cache_age_threshold}
@end itemize

The purpose of this section is to describe the syntax for referring to
structured variables. Key cache variables are used for syntax examples,
but specific details about how key caches operate are found elsewhere, in
@ref{MyISAM key cache}.

To refer to a component of a structured variable instance, you can use a
compound name in @code{instance_name.component_name} format. Examples:

@example
hot_cache.key_buffer_size
hot_cache.key_cache_block_size.
cold_cache.key_cache_block_size.
@end example

An instance with the name of @code{default} is always predefined for each
structured system variable.  If you refer to a component of a structured
variable without any instance name, the @code{default} instance is used.
Thus, @code{default.key_buffer_size} and @code{key_buffer_size} both refer
to the same system variable.

The naming rules for structured variable instances and components are as
follows:

@itemize @bullet
@item
For a given type of structured variable, each instance must have a name
that is unique @emph{within} variables of that type. However, instance names
need not be unique @emph{across} structured variable types. For example,
each structured variable will have an instance named @code{default},
so @code{default} is not unique across variable types.

@item
The names of the components of each structured variable type must be
unique across all system variable names.  If this were not true (such
that two different types of structured variables could share component
member names), it would not be clear which default structured variable
to use for references to member names that are not qualified by an
instance name.

@end itemize

At the moment, these rules have no possibility of being violated, because
the only structured variable type is the one for key caches. If some other
type of structured variable is created in the future, these rules will
assume greater significance.

With one exception, it is allowable to refer to structured variable
components using compound names in any context where simple variable
names can occur.

For example, you can assign a value to a structured variable using a
command line option:

@example
shell> mysqld --hot_cache.key_buffer_size=64K
@end example

In an option file, do this:

@example
[mysqld]
hot_cache.key_buffer_size=64K
@end example

If you start the server with such an option, it creates a key cache
named @code{hot_cache} with a size of 64 KB in addition to the default
key cache that has a default size of 8 MB.

Suppose you start the server as follows:

@example
shell> mysqld --key_buffer_size=256K  \
         --extra_cache.key_buffer_size=128K  \
         --extra_cache.key_cache_block_size=2096
@end example

In this case, the server sets the size of the default key cache to 256 KB.
(You could also have written @code{--default.key_buffer_size=256}.)
In addition, the server creates a second key cache named @code{extra_cache}
that has a size of 128 KB, with the size of block buffers for caching
table index blocks set to 2096 bytes.

The following example starts the server with three different key caches
having sizes in a 3:1:1 ratio:

@example
shell> mysqld --key_buffer_size=6M \
         --hot_cache.key_buffer_size=2M \
         --cold_cache.key_buffer_size=2M
@end example

Structured variable values may be set and retrieved at runtime as well.
For example, to set a key cache named @code{hot_cache} to a size of 10 MB,
use either of these statements:

@example
mysql> SET GLOBAL hot_cache.key_buffer_size = 10*1024*1024;
mysql> SET @@global.hot_cache.key_buffer_size = 10*1024*1024;
@end example

To retrieve the cache size, do this:

@example
mysql> SELECT @@global.hot_cache.key_buffer_size;
@end example

However, the following statement does not work, because the variable is not
interpreted as a compound name, but as a simple string for a @code{LIKE}
pattern-matching operation:

@example
mysql> SHOW GLOBAL VARIABLES LIKE 'hot_cache.key_buffer_size';
@end example

This is the exception to being able to use structured variable names anywhere
a simple variable name may occur.


@node Comments, Reserved words, System Variables, Language Structure
@section Comment Syntax

@findex Comment syntax

@cindex comments, adding

@c TODO: this is really the place to describe /*!...*/ and /*!nnnnn ... */
@c comment syntax.

The MySQL server supports three comment styles:

@itemize @bullet
@item
From a @samp{#} character to the end of the line.

@item
From a @samp{-- } sequence to the end of the line.
This style is supported as of MySQL 3.23.3.
Note that the @samp{-- } (double-dash) comment style requires the second dash
to be followed by at least one space (or by a control character such as a
newline). This syntax differs slightly from SQL-99 comment syntax, as discussed in
@ref{ANSI diff comments}.

@item
From a @samp{/*} sequence to the following @samp{*/} sequence.
The closing sequence need not be on the same line, so this
syntax allows a comment to extend over multiple lines.

@end itemize

The following example demonstrates all three comment styles:

@example
mysql> SELECT 1+1;     # This comment continues to the end of line
mysql> SELECT 1+1;     -- This comment continues to the end of line
mysql> SELECT 1 /* this is an in-line comment */ + 1;
mysql> SELECT 1+
/*
this is a
multiple-line comment
*/
1;
@end example

The comment syntax just described applies to how the @code{mysqld} server
parses SQL statements. The @code{mysql} client program also performs some
parsing of statements before sending them to the server. (For example, it
does this to determine statement boundaries within a multiple-statement input
line.) However, there are some limitations on the way that @code{mysql}
parses @code{/* ... */} comments:

@itemize @bullet
@item
A single-quote or double-quote character is taken to indicate the beginning
of a quoted string, even within a comment.  If the quote is not matched by a
second quote within the comment, the parser doesn't realize the comment has
ended.  If you are running @code{mysql} interactively, you can tell that it
has gotten confused like this because the prompt changes from @code{mysql>}
to @code{'>} or @code{">}.
This problem was fixed in MySQL 4.1.1.

@item
A semicolon within the comment is taken to indicate the end of the current
SQL statement and anything following it to indicate the beginning of the
next statement.  This problem was fixed in MySQL 4.0.13.
@end itemize

For affected versions of MySQL,
these limitations apply both when you run @code{mysql} interactively
and when you put commands in a file and use @code{mysql} in batch mode to
process the file with @code{mysql < file_name}.


@node Reserved words,  , Comments, Language Structure
@section Treatment of Reserved Words in MySQL

@cindex keywords
@cindex reserved words, exceptions

A common problem stems from trying to use an identifier such as a table or
column name that is the name of a built-in MySQL datatype or function,
such as @code{TIMESTAMP} or @code{GROUP}.  You're allowed
to do this (for example, @code{ABS} is allowed as a column name). However,
by default, no whitespace is allowed in function invocations between the
function name and the following @samp{(} character. This requirement allows
a function call to be distinguished from a reference to a column name.

A side-effect of this behavior is that omitting a space in some contexts
causes an identifier to be interpreted as a function name. For example, this
statement is legal:

@example
mysql> CREATE TABLE abs (val INT);
@end example

But omitting the space after @code{abs} causes a syntax error, because the
statement then appears to invoke the @code{ABS()} function:

@example
mysql> CREATE TABLE abs(val INT);
@end example

If the server SQL mode includes the @code{IGNORE_SPACE} mode value, the
server allows function invocations to have whitespace between a function
name and the following @samp{(} character. This causes function names to be
treated as reserved words. As a result, identifiers that are the same as
function names must be quoted as described in @ref{Legal names}.  The server
SQL mode is controlled as described in @ref{SQL mode}.

The words in the following table are explicitly reserved in MySQL. Most of
them are forbidden by SQL-92 as column and/or table names (for example,
@code{GROUP}).  A few are reserved because MySQL needs them and (currently)
uses a @code{yacc} parser.  A reserved word can be used as an identifier by
quoting it.

@include reservedwords.texi

The following symbols (from the table above) are disallowed by SQL-99
but allowed by MySQL as column/table names. This is because they
are very natural names and a lot of people have already used them.

@itemize @bullet
@item @code{ACTION}
@item @code{BIT}
@item @code{DATE}
@item @code{ENUM}
@item @code{NO}
@item @code{TEXT}
@item @code{TIME}
@item @code{TIMESTAMP}
@end itemize


@node Column types, Functions, Language Structure, Top
@chapter Column Types

@c TODO: rename to Datatypes; values of these types can be used independently
@c of being stored in table columns.

@cindex datatypes
@cindex types, data
@cindex columns, types
@cindex types, columns

@c help_category Column Types

MySQL supports a number of column types, which may be grouped into
three categories: numeric types, date and time types, and string (character)
types.  This section first gives an overview of the types available and
summarizes the storage requirements for each column type, and then provides a
more detailed description of the properties of the types in each category.
The overview is intentionally brief.  The more detailed descriptions should
be consulted for additional information about particular column types, such
as the allowable formats in which you can specify values.

The column types supported by MySQL follow.
The following code letters are used in the descriptions:

@cindex display size
@cindex sizes, display
@cindex digits
@cindex decimal point
@cindex brackets, square
@cindex square brackets
@table @code
@item M
Indicates the maximum display size.  The maximum legal display size is 255.

@item D
Applies to floating-point types and indicates the number of digits
following the decimal point.  The maximum possible value is 30, but
should be no greater than @code{M}-2.
@end table

Square brackets (@samp{[} and @samp{]}) indicate parts of type specifiers
that are optional.

@tindex Types

@c The @w{-number} stuff keeps a linebreak from occurring between
@c the - and number.

Note that if you specify @code{ZEROFILL} for a column, MySQL
automatically adds the @code{UNSIGNED} attribute to the column.

@strong{Warning:} You should be aware that when you use subtraction
between integer values where one is of type @code{UNSIGNED}, the result
will be unsigned! @xref{Cast Functions}.

@table @code
@tindex TINYINT
@c description_for_help_topic TINYINT  BOOLEAN BOOL BIT ZEROFILL UNSIGNED INT1
@item TINYINT[(M)] [UNSIGNED] [ZEROFILL]

A very small integer. The signed range is @code{-128} to @code{127}. The
unsigned range is @code{0} to @code{255}.

@tindex BOOLEAN
@tindex BOOL
@tindex BIT
@item BIT
@itemx BOOL
@itemx BOOLEAN
These are synonyms for @code{TINYINT(1)}.
The @code{BOOLEAN} synonym was added in version 4.1.0

Full boolean type handling will be introduced in accordance with SQL-99.
@c end_description_for_help_topic

@tindex SMALLINT
@c description_for_help_topic SMALLINT  INT2
@item SMALLINT[(M)] [UNSIGNED] [ZEROFILL]

A small integer. The signed range is @code{-32768} to @code{32767}. The
unsigned range is @code{0} to @code{65535}.
@c end_description_for_help_topic

@tindex MEDIUMINT
@c description_for_help_topic MEDIUMINT  INT3 MIDDLEINT
@item MEDIUMINT[(M)] [UNSIGNED] [ZEROFILL]

A medium-size integer. The signed range is @code{-8388608} to
@code{8388607}. The unsigned range is @code{0} to @code{16777215}.
@c end_description_for_help_topic

@tindex INT
@c description_for_help_topic INT  INT4 UNSIGNED ZEROFILL INTEGER
@item INT[(M)] [UNSIGNED] [ZEROFILL]

A normal-size integer. The signed range is @code{-2147483648} to
@code{2147483647}.  The unsigned range is @code{0} to @code{4294967295}.

@tindex INTEGER
@item INTEGER[(M)] [UNSIGNED] [ZEROFILL]

This is a synonym for @code{INT}.
@c end_description_for_help_topic

@tindex BIGINT
@c description_for_help_topic BIGINT  UNSIGNED ZEROFILL INT8
@item BIGINT[(M)] [UNSIGNED] [ZEROFILL]
A large integer. The signed range is @code{-9223372036854775808} to
@code{9223372036854775807}. The unsigned range is @code{0} to
@code{18446744073709551615}.
@c end_description_for_help_topic
Some things you should be aware of with respect to @code{BIGINT} columns:

@itemize @bullet
@item
@cindex rounding errors
All arithmetic is done using signed @code{BIGINT} or @code{DOUBLE}
values, so you shouldn't use unsigned big integers larger than
@code{9223372036854775807} (63 bits) except with bit functions! If you
do that, some of the last digits in the result may be wrong because of
rounding errors when converting the @code{BIGINT} to a @code{DOUBLE}.

MySQL 4.0 can handle @code{BIGINT} in the following cases:
@itemize @bullet
@item
Use integers to store big unsigned values in a @code{BIGINT} column.
@item
In @code{MIN(big_int_column)} and @code{MAX(big_int_column)}.
@item
When using operators (@code{+}, @code{-}, @code{*}, etc.) where
both operands are integers.
@end itemize

@item
You can always store an exact integer value in a @code{BIGINT} column by
storing it as a string.  In this case, MySQL will perform a string-to-number
conversion that involves no intermediate double representation.
@item
@samp{-}, @samp{+}, and @samp{*} will use @code{BIGINT} arithmetic when
both arguments are integer values!  This means that if you
multiply two big integers (or results from functions that return
integers) you may get unexpected results when the result is larger than
@code{9223372036854775807}.
@end itemize

@cindex floating-point number
@tindex FLOAT
@tindex FLOAT(precision)
@c description_for_help_topic FLOAT  UNSIGNED ZEROFILL FLOAT4
@item FLOAT(precision) [UNSIGNED] [ZEROFILL]

A floating-point number.  @code{precision} can be
@code{<=24} for a single-precision floating-point number and between 25
and 53 for a double-precision floating-point number. These types are like
the @code{FLOAT} and @code{DOUBLE} types described immediately following.
@code{FLOAT(X)} has the same range as the corresponding @code{FLOAT} and
@code{DOUBLE} types, but the display size and number of decimals are undefined.

In MySQL Version 3.23, this is a true floating-point value.  In
earlier MySQL versions, @code{FLOAT(precision)} always has 2 decimals.

Note that using @code{FLOAT} might give you some unexpected problems because
all calculations in MySQL are done with double precision.
@xref{No matching rows}.

@cindex ODBC compatibility
@cindex compatibility, with ODBC
This syntax is provided for ODBC compatibility.

@tindex FLOAT
@tindex FLOAT(M,D)
@item FLOAT[(M,D)] [UNSIGNED] [ZEROFILL]

A small (single-precision) floating-point number.  Allowable values are
@code{@w{-3.402823466E+38}} to @code{@w{-1.175494351E-38}}, @code{0},
and @code{@w{1.175494351E-38}} to @code{3.402823466E+38}.  If
@code{UNSIGNED} is specified, negative values are disallowed.  The @code{M}
is the display width and @code{D} is the number of decimals.  @code{FLOAT}
without arguments or @code{FLOAT(X)} (where @code{X} is in the range from
0 to 24) stands for a single-precision floating-point number.
@c end_description_for_help_topic

@tindex DOUBLE
@tindex FLOAT(precision)
@c description_for_help_topic DOUBLE  FLOAT8 UNSIGNED ZEROFILL PRECISION REAL
@item DOUBLE[(M,D)] [UNSIGNED] [ZEROFILL]

A normal-size (double-precision) floating-point number.
Allowable values are @code{@w{-1.7976931348623157E+308}} to
@code{@w{-2.2250738585072014E-308}}, @code{0}, and
@code{2.2250738585072014E-308} to @code{1.7976931348623157E+308}.  If
@code{UNSIGNED} is specified, negative values are disallowed.  The
@code{M} is the display width and @code{D} is the number of decimals.
@code{DOUBLE} without arguments or @code{FLOAT(X)} (where @code{X} is in the
range from 25 to 53) stands for a double-precision floating-point number.

@tindex DOUBLE PRECISION
@tindex REAL
@item DOUBLE PRECISION[(M,D)] [UNSIGNED] [ZEROFILL]
@itemx REAL[(M,D)] [UNSIGNED] [ZEROFILL]

These are synonyms for @code{DOUBLE}.
@c end_description_for_help_topic

@tindex DECIMAL
@c description_for_help_topic NUMERIC  ZEROFILL UNSIGNED DECIMAL DEC FIXED
@item DECIMAL[(M[,D])] [UNSIGNED] [ZEROFILL]

An unpacked floating-point number.  Behaves like a
@code{CHAR} column: ``unpacked'' means the number is stored as a string,
using one character for each digit of the value.  The decimal point and,
for negative numbers, the @samp{-} sign, are not counted in @code{M} (but
space for these is reserved). If @code{D} is 0, values will have no decimal
point or fractional part.  The maximum range of @code{DECIMAL} values is
the same as for @code{DOUBLE}, but the actual range for a given
@code{DECIMAL} column may be constrained by the choice of @code{M} and
@code{D}.  If @code{UNSIGNED} is specified, negative values are disallowed.  

If @code{D} is omitted, the default is 0.  If @code{M} is omitted, the
default is 10.

Prior to MySQL Version 3.23, the @code{M} argument must include the space
needed for the sign and the decimal point.

@tindex DEC
@tindex NUMERIC
@tindex FIXED
@item DEC[(M[,D])] [UNSIGNED] [ZEROFILL]
@itemx NUMERIC[(M[,D])] [UNSIGNED] [ZEROFILL]
@itemx FIXED[(M[,D])] [UNSIGNED] [ZEROFILL]

These are synonyms for @code{DECIMAL}.

The @code{FIXED} alias was added in version 4.1.0 for compatibility
with other servers.
@c end_description_for_help_topic

@tindex DATE
@item DATE

@c description_for_help_topic DATE  DATE
A date.  The supported range is @code{'1000-01-01'} to @code{'9999-12-31'}.
MySQL displays @code{DATE} values in @code{'YYYY-MM-DD'} format, but
allows you to assign values to @code{DATE} columns using either strings or
numbers. @xref{DATETIME}.
@c end_description_for_help_topic

@tindex DATETIME
@item DATETIME

@c description_for_help_topic DATETIME
A date and time combination.  The supported range is @code{'1000-01-01
00:00:00'} to @code{'9999-12-31 23:59:59'}.  MySQL displays
@code{DATETIME} values in @code{'YYYY-MM-DD HH:MM:SS'} format, but allows you
to assign values to @code{DATETIME} columns using either strings or numbers.
@c end_description_for_help_topic
@xref{DATETIME}.

@tindex TIMESTAMP
@c description_for_help_topic TIMESTAMP  TIMESTAMP
@item TIMESTAMP[(M)]

A timestamp.  The range is @code{'1970-01-01 00:00:00'} to sometime in the
year @code{2037}.

In MySQL 4.0 and earlier, @code{TIMESTAMP} values are displayed in
@code{YYYYMMDDHHMMSS}, @code{YYMMDDHHMMSS}, @code{YYYYMMDD}, or @code{YYMMDD}
format, depending on whether @code{M} is @code{14} (or missing), @code{12},
@code{8}, or @code{6}, but allows you to assign values to @code{TIMESTAMP}
columns using either strings or numbers.

From MySQL 4.1, @code{TIMESTAMP} is returned as a string with the format
@code{'YYYY-MM-DD HH:MM:SS'}. If you want to have this as a number, you
should add +0 to the timestamp column. Different timestamp lengths are
not supported. From version 4.0.12, the @code{--new} option can be used
to make the server behave as in version 4.1.

A @code{TIMESTAMP} column is useful
for recording the date and time of an @code{INSERT} or @code{UPDATE}
operation because it is automatically set to the date and time of the most
recent operation if you don't give it a value yourself.  You can also set it
to the current date and time by assigning it a @code{NULL} value.
@xref{Date and time types}.

The @code{M} argument affects only how a @code{TIMESTAMP} column is displayed;
its values always are stored using 4 bytes each.

Note that @code{TIMESTAMP(M)} columns where @code{M} is 8 or 14 are reported to
be numbers, whereas other @code{TIMESTAMP(M)} columns are reported to be
strings.  This is just to ensure that you can reliably dump and restore
the table with these types!
@xref{DATETIME, , @code{DATETIME}}.
@c end_description_for_help_topic

@tindex TIME
@c description_for_help_topic TIME  TIME
@item TIME

A time.  The range is @code{'-838:59:59'} to @code{'838:59:59'}.
MySQL displays @code{TIME} values in @code{'HH:MM:SS'} format, but
allows you to assign values to @code{TIME} columns using either strings or
numbers. @xref{TIME, , @code{TIME}}.
@c end_description_for_help_topic

@tindex YEAR
@c description_for_help_topic YEAR type
@item YEAR[(2|4)]

A year in 2- or 4-digit format (default is 4-digit).  The allowable values
are @code{1901} to @code{2155}, @code{0000} in the 4-digit year format,
and 1970-2069 if you use the 2-digit format (70-69).  MySQL displays
@code{YEAR} values in @code{YYYY} format, but allows you to assign values to
@code{YEAR} columns using either strings or numbers. (The @code{YEAR} type is
unavailable prior to MySQL Version 3.22.) @xref{YEAR, , @code{YEAR}}.
@c end_description_for_help_topic

@tindex NATIONAL CHAR
@tindex NCHAR
@tindex CHAR
@tindex CHARACTER
@c description_for_help_topic CHAR  NATIONAL CHARACTER NCHAR BINARY
@c UPDATE START
@item [NATIONAL] CHAR(M) [BINARY | ASCII | UNICODE]
@c UPDATE STOP

A fixed-length string that is always right-padded with spaces to the
specified length when stored. The range of @code{M} is 0 to 255 characters
(1 to 255 prior to MySQL Version 3.23).
Trailing spaces are removed when the value is retrieved. @code{CHAR} values
are sorted and compared in case-insensitive fashion according to the
default character set unless the @code{BINARY} keyword is given.

From version 4.1.0, if the @code{M} value specified is greater than 255,
the column type is converted to @code{TEXT}.
This is a compatibility feature.

@code{NATIONAL CHAR} (or its equivalent short form, @code{NCHAR}) is the
SQL-99 way to define that a @code{CHAR} column should use the default
CHARACTER set.  This is the default in MySQL.

@code{CHAR} is a shorthand for @code{CHARACTER}.

@c INSERT START
From version 4.1.0, the @code{ASCII} attribute can be specified which 
assigns the @code{latin1} character set to a @code{CHAR} column.

From version 4.1.1, the @code{UNICODE} attribute can be specified which 
assigns the @code{ucs2} character set to a @code{CHAR} column.
@c INSERT STOP

MySQL allows you to create a column of type
@code{CHAR(0)}. This is mainly useful when you have to be compliant with
some old applications that depend on the existence of a column but that do not
actually use the value.  This is also quite nice when you need a
column that can take only two values: A @code{CHAR(0)}, that is not defined
as @code{NOT NULL}, will occupy only one bit and can take two values:
@code{NULL} or @code{""}. @xref{CHAR, , @code{CHAR}}.

@item CHAR
This is a synonym for @code{CHAR(1)}.
@c end_description_for_help_topic

@tindex CHARACTER VARYING
@tindex CHAR VARYING
@tindex VARCHAR
@tindex VARCHARACTER
@c description_for_help_topic VARCHAR  BINARY NATIONAL VARYING CHARACTER VARCHARACTER
@item [NATIONAL] VARCHAR(M) [BINARY]

A variable-length string.  @strong{Note:} Trailing spaces are removed when
the value is stored (this differs from the SQL-99 specification). The range
of @code{M} is 0 to 255 characters (1 to 255 prior to MySQL Version 4.0.2).
@code{VARCHAR} values are sorted and compared in case-insensitive fashion
unless the @code{BINARY} keyword is given. @xref{Silent column changes}.

From version 4.1.0, if the @code{M} value specified is greater than 255,
the column type is converted to @code{TEXT}.
This is a compatibility feature.

@code{VARCHAR} is a shorthand for @code{CHARACTER VARYING}.
@c end_description_for_help_topic
@xref{CHAR}.

@tindex TINYBLOB
@tindex TINYTEXT
@c description_for_help_topic TINYBLOB  TINYTEXT
@item TINYBLOB
@itemx TINYTEXT

A @code{BLOB} or @code{TEXT} column with a maximum length of 255 (2^8 - 1)
characters. @xref{Silent column changes}. @xref{BLOB}.
@c end_description_for_help_topic

@tindex BLOB
@tindex TEXT
@c description_for_help_topic BLOB type TEXT BLOB
@item BLOB
@itemx TEXT

A @code{BLOB} or @code{TEXT} column with a maximum length of 65535 (2^16 - 1)
characters. @xref{Silent column changes}. @xref{BLOB}.
@c end_description_for_help_topic

@tindex MEDIUMBLOB
@tindex MEDIUMTEXT
@c description_for_help_topic MEDIUMBLOB  MEDIUMTEXT
@item MEDIUMBLOB
@itemx MEDIUMTEXT

A @code{BLOB} or @code{TEXT} column with a maximum length of 16777215
(2^24 - 1) characters. @xref{Silent column changes}. @xref{BLOB}.
@c end_description_for_help_topic

@tindex LONGBLOB
@tindex LONGTEXT
@c description_for_help_topic LONGBLOB  LONGTEXT LONG LONGBINARY
@item LONGBLOB
@itemx LONGTEXT

A @code{BLOB} or @code{TEXT} column with a maximum length of 4294967295
or 4G (2^32 - 1) characters. @xref{Silent column changes}.
Up to MySQL version 3.23 the server/client protocol and MyISAM tables had
a limit of 16M per communication packet / table row, from version 4.x
the maximum allowed length of @code{LONGTEXT} or @code{LONGBLOB} columns
depends on the configured maximum packet size in the client/server
protocol and available memory. @xref{BLOB}.
@c end_description_for_help_topic

@tindex ENUM
@c description_for_help_topic ENUM
@item ENUM('value1','value2',...)

An enumeration.  A string object that can have only one value, chosen
from the list of values @code{'value1'}, @code{'value2'}, @code{...},
@code{NULL} or the special @code{""} error value.  An @code{ENUM} can
have a maximum of 65535 distinct values. @xref{ENUM}.
@c end_description_for_help_topic

@tindex SET
@c description_for_help_topic type SET
@item SET('value1','value2',...)

A set.  A string object that can have zero or more values, each of which must
be chosen from the list of values @code{'value1'}, @code{'value2'},
@code{...} A @code{SET} can have a maximum of 64 members. @xref{SET}.
@end table
@c end_description_for_help_topic

@menu
* Numeric types::               Numeric Types
* Date and time types::         Date and Time Types
* String types::                String Types
* Choosing types::              Choosing the Right Type for a Column
* Other-vendor column types::   Using Column Types from Other Database Engines
* Storage requirements::        Column Type Storage Requirements
@end menu


@node Numeric types, Date and time types, Column types, Column types
@section Numeric Types

MySQL supports all of the SQL-92 numeric datatypes.  These
types include the exact numeric datatypes (@code{NUMERIC},
@code{DECIMAL}, @code{INTEGER}, and @code{SMALLINT}), as well as the
approximate numeric datatypes (@code{FLOAT}, @code{REAL}, and
@code{DOUBLE PRECISION}). The keyword @code{INT} is a synonym for
@code{INTEGER}, and the keyword @code{DEC} is a synonym for
@code{DECIMAL}.

The @code{NUMERIC} and @code{DECIMAL} types are implemented as the same
type by MySQL, as permitted by the SQL-92 standard.  They are
used for values for which it is important to preserve exact precision,
for example with monetary data.  When declaring a column of one of these
types the precision and scale can be (and usually is) specified; for
example:

@example
    salary DECIMAL(5,2)
@end example

In this example, @code{5} (@code{precision}) represents the number of
significant decimal digits that will be stored for values, and @code{2}
(@code{scale}) represents the number of digits that will be stored
following the decimal point.  In this case, therefore, the range of
values that can be stored in the @code{salary} column is from
@code{-99.99} to @code{99.99}.
(MySQL can actually store numbers up to @code{999.99} in this column
because it doesn't have to store the sign for positive numbers)

In SQL-92, the syntax @code{DECIMAL(p)} is equivalent to
@code{DECIMAL(p,0)}.  Similarly, the syntax @code{DECIMAL} is equivalent
to @code{DECIMAL(p,0)}, where the implementation is allowed to decide
the value of @code{p}.  MySQL does not currently support either of these
variant forms of the @code{DECIMAL}/@code{NUMERIC} datatypes.  This is
not generally a serious problem, as the principal benefits of these
types derive from the ability to control both precision and scale
explicitly.

@code{DECIMAL} and @code{NUMERIC} values are stored as strings, rather
than as binary floating-point numbers, in order to preserve the decimal
precision of those values.  One character is used for each digit of the
value, the decimal point (if @code{scale} > 0), and the @samp{-} sign
(for negative numbers).  If @code{scale} is 0, @code{DECIMAL} and
@code{NUMERIC} values contain no decimal point or fractional part.

The maximum range of @code{DECIMAL} and @code{NUMERIC} values is the
same as for @code{DOUBLE}, but the actual range for a given
@code{DECIMAL} or @code{NUMERIC} column can be constrained by the
@code{precision} or @code{scale} for a given column.  When such a column
is assigned a value with more digits following the decimal point than
are allowed by the specified @code{scale}, the value is converted to that
@code{scale}.  (The precise behavior is operating-system specific, but
generally the effect is truncation to the allowable number of digits.)
When a @code{DECIMAL} or @code{NUMERIC} column is
assigned a value whose magnitude exceeds the range implied by the
specified (or defaulted) @code{precision} and @code{scale},
MySQL stores the value representing the corresponding end
point of that range.

As an extension to the SQL-92 standard, MySQL also
supports the integer types @code{TINYINT}, @code{MEDIUMINT}, and
@code{BIGINT} as listed in the tables above.  Another extension is
supported by MySQL for optionally specifying the display width
of an integer value in parentheses following the base keyword for the
type (for example, @code{INT(4)}).  This optional width specification is
used to left-pad the display of values whose width is less than the
width specified for the column, but does not constrain the range of
values that can be stored in the column, nor the number of digits that
will be displayed for values whose width exceeds that specified for the
column.  When used in conjunction with the optional extension attribute
@code{ZEROFILL}, the default padding of spaces is replaced with zeroes.
For example, for a column declared as @code{INT(5) ZEROFILL}, a value
of @code{4} is retrieved as @code{00004}.  Note that if you store larger
values than the display width in an integer column, you may experience
problems when MySQL generates temporary tables for some
complicated joins, as in these cases MySQL trusts that the
data did fit into the original column width.

All integer types can have an optional (non-standard) attribute
@code{UNSIGNED}.  Unsigned values can be used when you want to allow
only positive numbers in a column and you need a little bigger numeric
range for the column.

As of MySQL 4.0.2, floating-point types also can be @code{UNSIGNED}.
As with integer types, this attribute prevents negative values from
being stored in the column.  Unlike the integer types, the upper range
of column values remains the same.

The @code{FLOAT} type is used to represent approximate numeric datatypes.
The SQL-92 standard allows an optional specification of
the precision (but not the range of the exponent) in bits following the
keyword @code{FLOAT} in parentheses.  The MySQL implementation
also supports this optional precision specification.  When the keyword
@code{FLOAT} is used for a column type without a precision
specification, MySQL uses four bytes to store the values.  A
variant syntax is also supported, with two numbers given in parentheses
following the @code{FLOAT} keyword.  With this option, the first number
continues to represent the storage requirements for the value in bytes,
and the second number specifies the number of digits to be stored and
displayed following the decimal point (as with @code{DECIMAL} and
@code{NUMERIC}).  When MySQL is asked to store a number for
such a column with more decimal digits following the decimal point than
specified for the column, the value is rounded to eliminate the extra
digits when the value is stored.

The @code{REAL} and @code{DOUBLE PRECISION} types do not accept
precision specifications.  As an extension to the SQL-92
standard, MySQL recognizes @code{DOUBLE} as a synonym for the
@code{DOUBLE PRECISION} type.  In contrast with the standard's
requirement that the precision for @code{REAL} be smaller than that used
for @code{DOUBLE PRECISION}, MySQL implements both as 8-byte
double-precision floating-point values (when not running in ``ANSI mode'').
For maximum portability, code requiring storage of approximate numeric
data values should use @code{FLOAT} or @code{DOUBLE PRECISION} with no
specification of precision or number of decimal points.

When asked to store a value in a numeric column that is outside the column
type's allowable range, MySQL clips the value to the appropriate
endpoint of the range and stores the resulting value instead.

For example, the range of an @code{INT} column is @code{-2147483648} to
@code{2147483647}.  If you try to insert @code{-9999999999} into an
@code{INT} column, the value is clipped to the lower endpoint of the range,
and @code{-2147483648} is stored instead. Similarly, if you try to insert
@code{9999999999}, @code{2147483647} is stored instead.

If the @code{INT} column is @code{UNSIGNED}, the size of the column's
range is the same but its endpoints shift up to @code{0} and @code{4294967295}.
If you try to store @code{-9999999999} and @code{9999999999},
the values stored in the column become @code{0} and @code{4294967296}.

Conversions that occur due to clipping are reported as ``warnings'' for
@code{ALTER TABLE}, @code{LOAD DATA INFILE}, @code{UPDATE}, and
multi-row @code{INSERT} statements.

@c FIX arjen 2002-08-07 New table, not yet measured for O'Reilly/DocBook
@c FIX also need to shuffle into proper position and adjust text.
@multitable @columnfractions .20 .20 .30 .30
@item @strong{Type}    @tab @strong{Bytes} @tab @strong{From}        @tab @strong{To}
@item @code{TINYINT}   @tab              1 @tab                 -128 @tab                 127
@item @code{SMALLINT}  @tab              2 @tab               -32768 @tab               32767
@item @code{MEDIUMINT} @tab              3 @tab             -8388608 @tab             8388607
@item @code{INT}       @tab              4 @tab          -2147483648 @tab          2147483647
@item @code{BIGINT}    @tab              8 @tab -9223372036854775808 @tab 9223372036854775807
@end multitable


@node Date and time types, String types, Numeric types, Column types
@section Date and Time Types

@cindex types, Date and Time
@cindex Date and Time types

@menu
* Y2K issues::                  Y2K Issues and Date Types
* DATETIME::                    The @code{DATETIME}, @code{DATE}, and @code{TIMESTAMP} Types
* TIME::                        The @code{TIME} Type
* YEAR::                        The @code{YEAR} Type
@end menu


The date and time types are @code{DATETIME}, @code{DATE},
@code{TIMESTAMP}, @code{TIME}, and @code{YEAR}.  Each of these has a
range of legal values, as well as a ``zero'' value that is used when you
specify a really illegal value.  Note that MySQL allows you to store
certain 'not strictly' legal date values, for example @code{1999-11-31}.
The reason for this is that we think it's the responsibility of the
application to handle date checking, not the SQL servers.  To make the
date checking 'fast', MySQL only checks that the month is in
the range of 0-12 and the day is in the range of 0-31. The above ranges
are defined this way because MySQL allows you to store, in a
@code{DATE} or @code{DATETIME} column, dates where the day or month-day
is zero.  This is extremely useful for applications that need to store
a birth-date for which you don't know the exact date. In this case you
simply store the date like @code{1999-00-00} or @code{1999-01-00}.  (You
cannot expect to get a correct value from functions like @code{DATE_SUB()}
or @code{DATE_ADD} for dates like these.)

Here are some general considerations to keep in mind when working
with date and time types:

@itemize @bullet
@item
MySQL retrieves values for a given date or time type in a standard
format, but it attempts to interpret a variety of formats for values that
you supply (for example, when you specify a value to be assigned to or
compared to a date or time type).  Nevertheless, only the formats described
in the following sections are supported.  It is expected that you will supply
legal values, and unpredictable results may occur if you use values in other
formats.

@item
Although MySQL tries to interpret values in several formats, it
always expects the year part of date values to be leftmost.  Dates must be
given in year-month-day order (for example, @code{'98-09-04'}), rather than
in the month-day-year or day-month-year orders commonly used elsewhere (for
example, @code{'09-04-98'}, @code{'04-09-98'}).

@item
MySQL automatically converts a date or time type value to a number
if the value is used in a numeric context, and vice versa.

@item
When MySQL encounters a value for a date or time type that is
out of range or otherwise illegal for the type (see the start of this
section), it converts the value to the ``zero'' value for that type.
(The exception is that out-of-range @code{TIME} values are clipped to
the appropriate endpoint of the @code{TIME} range.)  The following table
shows the format of the ``zero'' value for each type:

@multitable @columnfractions .15 .55
@item @strong{Column type} @tab @strong{``Zero'' value}
@item @code{DATETIME}      @tab @code{'0000-00-00 00:00:00'}
@item @code{DATE}          @tab @code{'0000-00-00'}
@item @code{TIMESTAMP}     @tab @code{00000000000000} (length depends on display size)
@item @code{TIME}          @tab @code{'00:00:00'}
@item @code{YEAR}          @tab @code{0000}
@end multitable

@item
The ``zero'' values are special, but you can store or refer to them
explicitly using the values shown in the table.  You can also do this
using the values @code{'0'} or @code{0}, which are easier to write.

@item
``Zero'' date or time values used through @code{MyODBC} are converted
automatically to @code{NULL} in @code{MyODBC} Version 2.50.12 and above,
because ODBC can't handle such values.
@end itemize


@node Y2K issues, DATETIME, Date and time types, Date and time types
@subsection Y2K Issues and Date Types

@cindex Year 2000 issues
@cindex date types, Y2K issues

MySQL itself is Y2K-safe (@pxref{Year 2000 compliance}),
but input values presented to MySQL may not be.  Any input
containing 2-digit year values is ambiguous, because the century is unknown.
Such values must be interpreted into 4-digit form because MySQL stores
years internally using four digits.

For @code{DATETIME}, @code{DATE}, @code{TIMESTAMP}, and @code{YEAR} types,
MySQL interprets dates with ambiguous year values using the
following rules:

@itemize @bullet
@item
Year values in the range @code{00-69} are converted to @code{2000-2069}.

@item
Year values in the range @code{70-99} are converted to @code{1970-1999}.
@end itemize

Remember that these rules provide only reasonable guesses as to what your
data mean.  If the heuristics used by MySQL don't produce the
correct values, you should provide unambiguous input containing 4-digit
year values.

@code{ORDER BY} will sort 2-digit @code{YEAR/DATE/DATETIME} types properly.

Note also that some functions like @code{MIN()} and @code{MAX()} will convert a
@code{TIMESTAMP/DATE} to a number. This means that a timestamp with a
2-digit year will not work properly with these functions.  The fix in this
case is to convert the @code{TIMESTAMP/DATE} to 4-digit year format or
use something like @code{MIN(DATE_ADD(timestamp,INTERVAL 0 DAYS))}.


@node DATETIME, TIME, Y2K issues, Date and time types
@subsection The @code{DATETIME}, @code{DATE}, and @code{TIMESTAMP} Types

@tindex DATETIME
@tindex DATE
@tindex TIMESTAMP

The @code{DATETIME}, @code{DATE}, and @code{TIMESTAMP} types are related.
This section describes their characteristics, how they are similar, and how
they differ.

The @code{DATETIME} type is used when you need values that contain both date
and time information.  MySQL retrieves and displays @code{DATETIME}
values in @code{'YYYY-MM-DD HH:MM:SS'} format.  The supported range is
@code{'1000-01-01 00:00:00'} to @code{'9999-12-31 23:59:59'}.  (``Supported''
means that although earlier values might work, there is no guarantee that
they will.)

The @code{DATE} type is used when you need only a date value, without a time
part.  MySQL retrieves and displays @code{DATE} values in
@code{'YYYY-MM-DD'} format.  The supported range is @code{'1000-01-01'} to
@code{'9999-12-31'}.

@c INSERT START
The @code{TIMESTAMP} column type has varying properties and behavior,
depending on the MySQL version and the SQL mode the server is running in.

@subsubheading @code{TIMESTAMP} behavior when running in @code{MAXDB} mode

When MySQL is running in @code{MAXDB} mode, @code{TIMESTAMP} behaves like 
@code{DATETIME}. No automatic updating of @code{TIMESTAMP} columns occurs,
as described in the following paragraphs. MySQL can be run in @code{MAXDB}
mode as of version 4.1.1. @xref{Server options}.

@subsubheading @code{TIMESTAMP} behavior when not running in @code{MAXDB} mode
@c INSERT STOP

The @code{TIMESTAMP} column type provides a type that you can use to
automatically mark @code{INSERT} or @code{UPDATE} operations with the current
date and time.  If you have multiple @code{TIMESTAMP} columns, only the first
one is updated automatically.

Automatic updating of the first @code{TIMESTAMP} column occurs under any of
the following conditions:

@itemize @bullet
@item
The column is not specified explicitly in an @code{INSERT} or
@code{LOAD DATA INFILE} statement.
@item
The column is not specified explicitly in an @code{UPDATE} statement and some
other column changes value.  (Note that an @code{UPDATE} that sets a column
to the value it already has will not cause the @code{TIMESTAMP} column to be
updated, because if you set a column to its current value, MySQL
ignores the update for efficiency.)
@item
You explicitly set the @code{TIMESTAMP} column to @code{NULL}.
@end itemize

@code{TIMESTAMP} columns other than the first may also be set to the current
date and time.  Just set the column to @code{NULL} or to @code{NOW()}.

You can set any @code{TIMESTAMP} column to a value different from the current
date and time by setting it explicitly to the desired value.  This is true
even for the first @code{TIMESTAMP} column.  You can use this property if,
for example, you want a @code{TIMESTAMP} to be set to the current date and
time when you create a row, but not to be changed whenever the row is updated
later:

@itemize @bullet
@item
Let MySQL set the column when the row is created.
This will initialize it to the current date and time.

@item
When you perform subsequent updates to other columns in the row, set
the @code{TIMESTAMP} column explicitly to its current value.
@end itemize

On the other hand, you may find it just as easy to use a @code{DATETIME}
column that you initialize to @code{NOW()} when the row is created and
leave alone for subsequent updates.

@c INSERT START
@subsubheading @code{TIMESTAMP} properties when running in @code{MAXDB} mode

When MySQL is running in @code{MAXDB} mode, @code{TIMESTAMP} is identical with 
@code{DATETIME}. It uses the same format to store and display values, and it 
has the same range. MySQL can be run in @code{MAXDB} mode as of version 4.1.1. 
@xref{Server options}.

@subsubheading @code{TIMESTAMP} properties as of MySQL 4.1 when not running in @code{MAXDB} mode

In MySQL 4.1.0, @code{TIMESTAMP} columns are stored and displayed in the same 
format as @code{DATETIME} columns. This also means that they cannot be narrowed 
or widened in the ways described in the following paragraphs. In other words, 
you cannot use @code{TIMESTAMP(2)}, @code{TIMESTAMP(4)}, etc. Other than that, 
the properties are the same as in previous MySQL versions.

@subsubheading @code{TIMESTAMP} properties prior to MySQL 4.1
@c INSERT STOP

@code{TIMESTAMP} values may range from the beginning of 1970 to sometime in
the year 2037, with a resolution of one second.  Values are displayed as
numbers.

The format in which MySQL retrieves and displays @code{TIMESTAMP}
values depends on the display size, as illustrated by the following table.  The
`full' @code{TIMESTAMP} format is 14 digits, but @code{TIMESTAMP} columns may
be created with shorter display sizes:

@multitable @columnfractions .20 .25
@item @strong{Column type}  @tab @strong{Display format}
@item @code{TIMESTAMP(14)}  @tab @code{YYYYMMDDHHMMSS}
@item @code{TIMESTAMP(12)}  @tab @code{YYMMDDHHMMSS}
@item @code{TIMESTAMP(10)}  @tab @code{YYMMDDHHMM}
@item @code{TIMESTAMP(8)}   @tab @code{YYYYMMDD}
@item @code{TIMESTAMP(6)}   @tab @code{YYMMDD}
@item @code{TIMESTAMP(4)}   @tab @code{YYMM}
@item @code{TIMESTAMP(2)}   @tab @code{YY}
@end multitable

All @code{TIMESTAMP} columns have the same storage size, regardless of
display size.  The most common display sizes are 6, 8, 12, and 14.  You can
specify an arbitrary display size at table creation time, but values of 0 or
greater than 14 are coerced to 14.  Odd-valued sizes in the range from 1 to
13 are coerced to the next higher even number.

@strong{Note:} From version 4.1, @code{TIMESTAMP} is returned as a string with
the format @code{'YYYY-MM-DD HH:MM:SS'} and different timestamp lengths are
no longer supported.

You can specify @code{DATETIME}, @code{DATE}, and @code{TIMESTAMP} values using
any of a common set of formats:

@itemize @bullet
@item
As a string in either @code{'YYYY-MM-DD HH:MM:SS'} or @code{'YY-MM-DD
HH:MM:SS'} format.  A ``relaxed'' syntax is allowed---any punctuation
character may be used as the delimiter between date parts or time parts.
For example, @code{'98-12-31 11:30:45'}, @code{'98.12.31 11+30+45'},
@code{'98/12/31 11*30*45'}, and @code{'98@@12@@31 11^30^45'} are
equivalent.

@item
As a string in either @code{'YYYY-MM-DD'} or @code{'YY-MM-DD'} format.
A ``relaxed'' syntax is allowed here, too.  For example, @code{'98-12-31'},
@code{'98.12.31'}, @code{'98/12/31'}, and @code{'98@@12@@31'} are
equivalent.

@item
As a string with no delimiters in either @code{'YYYYMMDDHHMMSS'} or
@code{'YYMMDDHHMMSS'} format, provided that the string makes sense as a
date.  For example, @code{'19970523091528'} and @code{'970523091528'} are
interpreted as @code{'1997-05-23 09:15:28'}, but @code{'971122129015'} is
illegal (it has a nonsensical minute part) and becomes @code{'0000-00-00
00:00:00'}.

@item
As a string with no delimiters in either @code{'YYYYMMDD'} or @code{'YYMMDD'}
format, provided that the string makes sense as a date.  For example,
@code{'19970523'} and @code{'970523'} are interpreted as
@code{'1997-05-23'}, but @code{'971332'} is illegal (it has nonsensical month
and day parts) and becomes @code{'0000-00-00'}.

@item
As a number in either @code{YYYYMMDDHHMMSS} or @code{YYMMDDHHMMSS}
format, provided that the number makes sense as a date.  For example,
@code{19830905132800} and @code{830905132800} are interpreted as
@code{'1983-09-05 13:28:00'}.

@item
As a number in either @code{YYYYMMDD} or @code{YYMMDD}
format, provided that the number makes sense as a date.  For example,
@code{19830905} and @code{830905} are interpreted as @code{'1983-09-05'}.

@item
As the result of a function that returns a value that is acceptable
in a @code{DATETIME}, @code{DATE}, or @code{TIMESTAMP} context, such as
@code{NOW()} or @code{CURRENT_DATE}.
@end itemize

Illegal @code{DATETIME}, @code{DATE}, or @code{TIMESTAMP} values are converted
to the ``zero'' value of the appropriate type (@code{'0000-00-00 00:00:00'},
@code{'0000-00-00'}, or @code{00000000000000}).

For values specified as strings that include date part delimiters, it is not
necessary to specify two digits for month or day values that are less than
@code{10}.  @code{'1979-6-9'} is the same as @code{'1979-06-09'}.  Similarly,
for values specified as strings that include time part delimiters, it is not
necessary to specify two digits for hour, minute, or second values that are
less than @code{10}.  @code{'1979-10-30 1:2:3'} is the same as
@code{'1979-10-30 01:02:03'}.

Values specified as numbers should be 6, 8, 12, or 14 digits long.  If the
number is 8 or 14 digits long, it is assumed to be in @code{YYYYMMDD} or
@code{YYYYMMDDHHMMSS} format and that the year is given by the first 4
digits.  If the number is 6 or 12 digits long, it is assumed to be in
@code{YYMMDD} or @code{YYMMDDHHMMSS} format and that the year is given by the
first 2 digits.  Numbers that are not one of these lengths are interpreted
as though padded with leading zeros to the closest length.

@cindex non-delimited strings
@cindex strings, non-delimited
Values specified as non-delimited strings are interpreted using their length
as given.  If the string is 8 or 14 characters long, the year is assumed to
be given by the first 4 characters.  Otherwise, the year is assumed to be
given by the first 2 characters.  The string is interpreted from left to
right to find year, month, day, hour, minute, and second values, for as many
parts as are present in the string.  This means you should not use strings
that have fewer than 6 characters.  For example, if you specify @code{'9903'},
thinking that will represent March, 1999, you will find that MySQL
inserts a ``zero'' date into your table.  This is because the year and month
values are @code{99} and @code{03}, but the day part is completely missing, so
the value is not a legal date.  However, as of MySQL 3.23, you can explicitly
specify a value of zero to represent missing month or day parts.  For example,
you can use @code{'990300'} to insert the value @code{'1999-03-00'}.

@code{TIMESTAMP} columns store legal values using the full precision with
which the value was specified, regardless of the display size.  This has
several implications:

@itemize @bullet
@item
Always specify year, month, and day, even if your column types are
@code{TIMESTAMP(4)} or @code{TIMESTAMP(2)}.  Otherwise, the value will not
be a legal date and @code{0} will be stored.

@item
If you use @code{ALTER TABLE} to widen a narrow @code{TIMESTAMP} column,
information will be displayed that previously was ``hidden''.

@item
Similarly, narrowing a @code{TIMESTAMP} column does not cause information to
be lost, except in the sense that less information is shown when the values
are displayed.

@item
Although @code{TIMESTAMP} values are stored to full precision, the only
function that operates directly on the underlying stored value is
@code{UNIX_TIMESTAMP()}.  Other functions operate on the formatted retrieved
value.  This means you cannot use functions such as @code{HOUR()} or
@code{SECOND()} unless the relevant part of the @code{TIMESTAMP} value is
included in the formatted value.  For example, the @code{HH} part of a
@code{TIMESTAMP} column is not displayed unless the display size is at least
10, so trying to use @code{HOUR()} on shorter @code{TIMESTAMP} values
produces a meaningless result.
@end itemize

You can to some extent assign values of one date type to an object
of a different date type.  However, there may be some alteration
of the value or loss of information:

@itemize @bullet
@item
If you assign a @code{DATE} value to a @code{DATETIME} or @code{TIMESTAMP}
object, the time part of the resulting value is set to @code{'00:00:00'},
because the @code{DATE} value contains no time information.

@item
If you assign a @code{DATETIME} or @code{TIMESTAMP} value to a @code{DATE}
object, the time part of the resulting value is deleted, because the
@code{DATE} type stores no time information.

@item
Remember that although @code{DATETIME}, @code{DATE}, and @code{TIMESTAMP}
values all can be specified using the same set of formats, the types do not
all have the same range of values.  For example, @code{TIMESTAMP} values
cannot be earlier than @code{1970} or later than @code{2037}.  This means
that a date such as @code{'1968-01-01'}, while legal as a @code{DATETIME} or
@code{DATE} value, is not a valid @code{TIMESTAMP} value and will be
converted to @code{0} if assigned to such an object.
@end itemize

@cindex problems, date values
@cindex date values, problems
Be aware of certain pitfalls when specifying date values:

@itemize @bullet
@item
The relaxed format allowed for values specified as strings can be deceiving.
For example, a value such as @code{'10:11:12'} might look like a time value
because of the @samp{:} delimiter, but if used in a date context will be
interpreted as the year @code{'2010-11-12'}.  The value @code{'10:45:15'}
will be converted to @code{'0000-00-00'} because @code{'45'} is not a legal
month.

@item
The MySQL server only performs basic checking on the validity of a date:
days @code{00-31}, months @code{00-12}, years @code{1000-9999}.
Any date not within this range will revert to @code{0000-00-00}.
Please note that this still allows you to store invalid dates such as
@code{2002-04-31}. It allows web applications to store data from a form
without further checking. To ensure a date is valid, perform a check in
your application.

@item
Year values specified as two digits are ambiguous, because the century is
unknown.  MySQL interprets 2-digit year values using the following
rules:

@itemize @minus
@item
Year values in the range @code{00-69} are converted to @code{2000-2069}.

@item
Year values in the range @code{70-99} are converted to @code{1970-1999}.
@end itemize
@end itemize


@node TIME, YEAR, DATETIME, Date and time types
@subsection The @code{TIME} Type

@tindex TIME

MySQL retrieves and displays @code{TIME} values in @code{'HH:MM:SS'}
format (or @code{'HHH:MM:SS'} format for large hours values).  @code{TIME}
values may range from @code{'-838:59:59'} to @code{'838:59:59'}.  The reason
the hours part may be so large is that the @code{TIME} type may be used not
only to represent a time of day (which must be less than 24 hours), but also
elapsed time or a time interval between two events (which may be much greater
than 24 hours, or even negative).

You can specify @code{TIME} values in a variety of formats:

@itemize @bullet
@item
As a string in @code{'D HH:MM:SS.fraction'} format.  (Note that
MySQL doesn't yet store the fraction for the time column.)  One
can also use one of the following ``relaxed'' syntax:

@code{HH:MM:SS.fraction}, @code{HH:MM:SS}, @code{HH:MM}, @code{D HH:MM:SS},
@code{D HH:MM}, @code{D HH} or @code{SS}.  Here @code{D} is days between 0-33.

@item
As a string with no delimiters in @code{'HHMMSS'} format, provided that
it makes sense as a time.  For example, @code{'101112'} is understood as
@code{'10:11:12'}, but @code{'109712'} is illegal (it has a nonsensical
minute part) and becomes @code{'00:00:00'}.

@item
As a number in @code{HHMMSS} format, provided that it makes sense as a time.
For example, @code{101112} is understood as @code{'10:11:12'}.  The following
alternative formats are also understood: @code{SS}, @code{MMSS},@code{HHMMSS},
@code{HHMMSS.fraction}.  Note that MySQL doesn't yet store the
fraction part.

@item
As the result of a function that returns a value that is acceptable
in a @code{TIME} context, such as @code{CURRENT_TIME}.
@end itemize

For @code{TIME} values specified as strings that include a time part
delimiter, it is not necessary to specify two digits for hours, minutes, or
seconds values that are less than @code{10}.  @code{'8:3:2'} is the same as
@code{'08:03:02'}.

Be careful about assigning ``short'' @code{TIME} values to a @code{TIME}
column. Without colons, MySQL interprets values using the
assumption that the rightmost digits represent seconds. (MySQL
interprets @code{TIME} values as elapsed time rather than as time of
day.) For example, you might think of @code{'1112'} and @code{1112} as
meaning @code{'11:12:00'} (12 minutes after 11 o'clock), but
MySQL interprets them as @code{'00:11:12'} (11 minutes, 12 seconds).
Similarly, @code{'12'} and @code{12} are interpreted as @code{'00:00:12'}.
@code{TIME} values with colons, by contrast, are always treated as
time of the day. That is @code{'11:12'} will mean @code{'11:12:00'},
not @code{'00:11:12'}.

Values that lie outside the @code{TIME} range
but are otherwise legal are clipped to the appropriate
endpoint of the range.  For example, @code{'-850:00:00'} and
@code{'850:00:00'} are converted to @code{'-838:59:59'} and
@code{'838:59:59'}.

Illegal @code{TIME} values are converted to @code{'00:00:00'}.  Note that
because @code{'00:00:00'} is itself a legal @code{TIME} value, there is no way
to tell, from a value of @code{'00:00:00'} stored in a table, whether the
original value was specified as @code{'00:00:00'} or whether it was illegal.


@node YEAR,  , TIME, Date and time types
@subsection The @code{YEAR} Type

@tindex YEAR

The @code{YEAR} type is a 1-byte type used for representing years.

MySQL retrieves and displays @code{YEAR} values in @code{YYYY}
format.  The range is @code{1901} to @code{2155}.

You can specify @code{YEAR} values in a variety of formats:

@itemize @bullet
@item
As a four-digit string in the range @code{'1901'} to @code{'2155'}.

@item
As a four-digit number in the range @code{1901} to @code{2155}.

@item
As a two-digit string in the range @code{'00'} to @code{'99'}.  Values in the
ranges @code{'00'} to @code{'69'} and @code{'70'} to @code{'99'} are
converted to @code{YEAR} values in the ranges @code{2000} to @code{2069} and
@code{1970} to @code{1999}.

@item
As a two-digit number in the range @code{1} to @code{99}.  Values in the
ranges @code{1} to @code{69} and @code{70} to @code{99} are converted to
@code{YEAR} values in the ranges @code{2001} to @code{2069} and @code{1970}
to @code{1999}.  Note that the range for two-digit numbers is slightly
different from the range for two-digit strings, because you cannot specify zero
directly as a number and have it be interpreted as @code{2000}.  You
@strong{must} specify it as a string @code{'0'} or @code{'00'} or it will be
interpreted as @code{0000}.

@item
As the result of a function that returns a value that is acceptable
in a @code{YEAR} context, such as @code{NOW()}.
@end itemize

Illegal @code{YEAR} values are converted to @code{0000}.


@node String types, Choosing types, Date and time types, Column types
@section String Types

@cindex types, strings
@cindex string types

@tindex CHAR
@tindex VARCHAR

@menu
* CHAR::                        The @code{CHAR} and @code{VARCHAR} Types
* BLOB::                        The @code{BLOB} and @code{TEXT} Types
* ENUM::                        The @code{ENUM} Type
* SET::                         The @code{SET} Type
@end menu


The string types are @code{CHAR}, @code{VARCHAR}, @code{BLOB}, @code{TEXT},
@code{ENUM}, and @code{SET}.  This section describes how these types work,
their storage requirements, and how to use them in your queries.

@c FIX arjen 2002-08-07 New table, not yet measured for O'Reilly/DocBook
@c FIX also need to shuffle into proper position and adjust text.
@multitable @columnfractions .40 .30 .30
@item @strong{Type}                          @tab @strong{Max.size} @tab @strong{Bytes}
@item @code{TINYTEXT}   or @code{TINYBLOB}   @tab 2^8-1             @tab            255
@item @code{TEXT}       or @code{BLOB}       @tab 2^16-1 (64K-1)    @tab          65535
@item @code{MEDIUMTEXT} or @code{MEDIUMBLOB} @tab 2^24-1 (16M-1)    @tab       16777215
@item                      @code{LONGBLOB}   @tab 2^32-1 (4G-1)     @tab     4294967295
@end multitable


@node CHAR, BLOB, String types, String types
@subsection The @code{CHAR} and @code{VARCHAR} Types

The @code{CHAR} and @code{VARCHAR} types are similar, but differ in the
way they are stored and retrieved.

The length of a @code{CHAR} column is fixed to the length that you declare
when you create the table.  The length can be any value between 1 and 255.
(As of MySQL Version 3.23, the length of @code{CHAR} may be 0 to 255.)
When @code{CHAR} values are stored, they are right-padded with spaces to the
specified length.  When @code{CHAR} values are retrieved, trailing spaces are
removed.

Values in @code{VARCHAR} columns are variable-length strings.  You can
declare a @code{VARCHAR} column to be any length between 1 and 255, just as
for @code{CHAR} columns.  However, in contrast to @code{CHAR}, @code{VARCHAR}
values are stored using only as many characters as are needed, plus one byte
to record the length.  Values are not padded; instead, trailing spaces are
removed when values are stored.  (This space removal differs from the SQL-99 
specification.) No case conversion takes place during storage or retrieval.

If you assign a value to a @code{CHAR} or @code{VARCHAR} column that
exceeds the column's maximum length, the value is truncated to fit.

The following table illustrates the differences between the two types of columns
by showing the result of storing various string values into @code{CHAR(4)}
and @code{VARCHAR(4)} columns:

@c Need to use @(space) to make sure second column values retain spacing
@c in output for table below.

@multitable @columnfractions .15 .15 .20 .15 .20
@item @strong{Value}  @tab @code{CHAR(4)}     @tab @strong{Storage required} @tab @code{VARCHAR(4)} @tab @strong{Storage required}
@item @code{''}       @tab @code{'@ @ @ @ '} @tab 4 bytes @tab @code{''} @tab 1 byte
@item @code{'ab'}     @tab @code{'ab@ @ '}   @tab 4 bytes @tab @code{'ab'} @tab 3 bytes
@item @code{'abcd'}   @tab @code{'abcd'}     @tab 4 bytes @tab @code{'abcd'} @tab 5 bytes
@item @code{'abcdefgh'} @tab @code{'abcd'}     @tab 4 bytes @tab @code{'abcd'} @tab 5 bytes
@end multitable

The values retrieved from the @code{CHAR(4)} and @code{VARCHAR(4)} columns
will be the same in each case, because trailing spaces are removed from
@code{CHAR} columns upon retrieval.

Values in @code{CHAR} and @code{VARCHAR} columns are sorted and compared
in case-insensitive fashion, unless the @code{BINARY} attribute was
specified when the table was created.  The @code{BINARY} attribute means
that column values are sorted and compared in case-sensitive fashion
according to the ASCII order of the machine where the MySQL
server is running. @code{BINARY} doesn't affect how the column is stored
or retrieved.

From version 4.1.0, column type @code{CHAR BYTE} is an alias for
@code{CHAR BINARY}. This is a compatibility feature.

The @code{BINARY} attribute is sticky.  This means that if a column marked
@code{BINARY} is used in an expression, the whole expression is compared as a
@code{BINARY} value.

MySQL may silently change the type of a @code{CHAR} or @code{VARCHAR}
column at table creation time.
@xref{Silent column changes}.


@node BLOB, ENUM, CHAR, String types
@subsection The @code{BLOB} and @code{TEXT} Types

@tindex BLOB
@tindex TEXT
@tindex LONG

@c description_for_help_topic BLOB
A @code{BLOB} is a binary large object that can hold a variable amount of
data.  The four @code{BLOB} types @code{TINYBLOB}, @code{BLOB},
@code{MEDIUMBLOB}, and @code{LONGBLOB} differ only in the maximum length of
the values they can hold.
@c end_description_for_help_topic
@xref{Storage requirements}.

The four @code{TEXT} types @code{TINYTEXT}, @code{TEXT}, @code{MEDIUMTEXT},
and @code{LONGTEXT} correspond to the four @code{BLOB} types and have the
same maximum lengths and storage requirements.  The only difference between
@code{BLOB} and @code{TEXT} types is that sorting and comparison is performed
in case-sensitive fashion for @code{BLOB} values and case-insensitive fashion
for @code{TEXT} values.  In other words, a @code{TEXT} is a case-insensitive
@code{BLOB}. No case conversion takes place during storage or retrieval.

If you assign a value to a @code{BLOB} or @code{TEXT} column that exceeds
the column type's maximum length, the value is truncated to fit.

In most respects, you can regard a @code{TEXT} column as a @code{VARCHAR}
column that can be as big as you like.  Similarly, you can regard a
@code{BLOB} column as a @code{VARCHAR BINARY} column.  The differences are:

@itemize @bullet
@item
You can have indexes on @code{BLOB} and @code{TEXT} columns with
MySQL Version 3.23.2 and newer. Older versions of
MySQL did not support this.

@item
There is no trailing-space removal for @code{BLOB} and @code{TEXT} columns
when values are stored, as there is for @code{VARCHAR} columns.

@item
@cindex default values, @code{BLOB} and @code{TEXT} columns
@cindex @code{BLOB} columns, default values
@cindex @code{TEXT} columns, default values
@code{BLOB} and @code{TEXT} columns cannot have @code{DEFAULT} values.
@end itemize

From version 4.1.0, @code{LONG} and @code{LONG VARCHAR} map to the
@code{MEDIUMTEXT} data type. This is a compatibility feature.

@code{MyODBC} defines @code{BLOB} values as @code{LONGVARBINARY} and
@code{TEXT} values as @code{LONGVARCHAR}.

Because @code{BLOB} and @code{TEXT} values may be extremely long, you
may run up against some constraints when using them:

@itemize @bullet
@item
If you want to use @code{GROUP BY} or @code{ORDER BY} on a @code{BLOB} or
@code{TEXT} column, you must convert the column value into a fixed-length
object. The standard way to do this is with the @code{SUBSTRING}
function.  For example:

@example
mysql> SELECT comment FROM tbl_name,SUBSTRING(comment,20) AS substr
    ->                 ORDER BY substr;
@end example

If you don't do this, only the first @code{max_sort_length} bytes of the
column are used when sorting.  The default value of @code{max_sort_length} is
1024; this value can be changed using the @code{-O} option when starting the
@code{mysqld} server. You can group on an expression involving @code{BLOB} or
@code{TEXT} values by specifying the column position or by using an alias:

@example
mysql> SELECT id,SUBSTRING(blob_col,1,100) FROM tbl_name GROUP BY 2;
mysql> SELECT id,SUBSTRING(blob_col,1,100) AS b FROM tbl_name GROUP BY b;
@end example

@item
The maximum size of a @code{BLOB} or @code{TEXT} object is determined by its
type, but the largest value you can actually transmit between the client and
server is determined by the amount of available memory and the size of the
communications buffers.  You can change the message buffer size
(@code{max_allowed_packet}), but you must
do so on both the server and client ends. @xref{Server parameters}.
@end itemize

Note that each @code{BLOB} or @code{TEXT} value is represented
internally by a separately allocated object. This is in contrast to all
other column types, for which storage is allocated once per column when
the table is opened.


@node ENUM, SET, BLOB, String types
@subsection The @code{ENUM} Type

@tindex ENUM

An @code{ENUM} is a string object whose value normally is chosen from a list
of allowed values that are enumerated explicitly in the column specification
at table creation time.

The value may also be the empty string (@code{""}) or @code{NULL} under
certain circumstances:

@itemize @bullet
@item
If you insert an invalid value into an @code{ENUM} (that is, a string not
present in the list of allowed values), the empty string is inserted
instead as a special error value. This string can be distinguished from a
'normal' empty string by the fact that this string has the numerical value
0. More about this later.

@item
If an @code{ENUM} is declared @code{NULL}, @code{NULL} is also a legal value
for the column, and the default value is @code{NULL}.  If an @code{ENUM} is
declared @code{NOT NULL}, the default value is the first element of the
list of allowed values.
@end itemize

Each enumeration value has an index:

@itemize @bullet
@item
Values from the list of allowable elements in the column specification are
numbered beginning with 1.

@item
The index value of the empty string error value is 0.  This means that you
can use the following @code{SELECT} statement to find rows into which invalid
@code{ENUM} values were assigned:

@example
mysql> SELECT * FROM tbl_name WHERE enum_col=0;
@end example

@item
The index of the @code{NULL} value is @code{NULL}.
@end itemize

For example, a column specified as @code{ENUM("one", "two", "three")} can
have any of the values shown here.  The index of each value is also shown:

@multitable @columnfractions .10 .10
@item @strong{Value} @tab @strong{Index}
@item @code{NULL}    @tab @code{NULL}
@item @code{""}      @tab 0
@item @code{"one"}   @tab 1
@item @code{"two"}   @tab 2
@item @code{"three"} @tab 3
@end multitable

An enumeration can have a maximum of 65535 elements.

Starting from 3.23.51 trailing spaces are automatically deleted from
@code{ENUM} values when the table is created.

Lettercase is irrelevant when you assign values to an @code{ENUM} column.
However, values retrieved from the column later have lettercase matching the
values that were used to specify the allowable values at table creation time.

If you retrieve an @code{ENUM} in a numeric context, the column value's
index is returned.  For example, you can retrieve numeric values from
an @code{ENUM} column like this:

@example
mysql> SELECT enum_col+0 FROM tbl_name;
@end example

If you store a number into an @code{ENUM}, the number is treated as an
index, and the value stored is the enumeration member with that index.
(However, this will not work with @code{LOAD DATA}, which treats all
input as strings.)
It's not advisable to store numbers in an @code{ENUM} string because
it will make things confusing.

@code{ENUM} values are sorted according to the order in which the enumeration
members were listed in the column specification.  (In other words,
@code{ENUM} values are sorted according to their index numbers.)  For
example, @code{"a"} sorts before @code{"b"} for @code{ENUM("a", "b")}, but
@code{"b"} sorts before @code{"a"} for @code{ENUM("b", "a")}.  The empty
string sorts before non-empty strings, and @code{NULL} values sort before
all other enumeration values.
To prevent unexpected results, specify the @code{ENUM} list in alphabetical
order. You can also use @code{GROUP BY CONCAT(col)} to make sure the column
is sorted alphabetically rather than by index number.

If you want to get all possible values for an @code{ENUM} column, you should
use: @code{SHOW COLUMNS FROM table_name LIKE enum_column_name} and parse
the @code{ENUM} definition in the second column.


@node SET,  , ENUM, String types
@subsection The @code{SET} Type

@tindex SET

A @code{SET} is a string object that can have zero or more values, each of
which must be chosen from a list of allowed values specified when the table
is created.  @code{SET} column values that consist of multiple set members
are specified with members separated by commas (@samp{,}).  A consequence of
this is that @code{SET} member values cannot themselves contain commas.

For example, a column specified as @code{SET("one", "two") NOT NULL} can have
any of these values:

@example
""
"one"
"two"
"one,two"
@end example


A @code{SET} can have a maximum of 64 different members.

Starting from 3.23.51 trailing spaces are automatically deleted from
@code{SET} values when the table is created.

MySQL stores @code{SET} values numerically, with the low-order bit
of the stored value corresponding to the first set member.  If you retrieve a
@code{SET} value in a numeric context, the value retrieved has bits set
corresponding to the set members that make up the column value.  For example,
you can retrieve numeric values from a @code{SET} column like this:

@example
mysql> SELECT set_col+0 FROM tbl_name;
@end example

If a number is stored into a @code{SET} column, the bits that
are set in the binary representation of the number determine the
set members in the column value.  Suppose a column is specified as
@code{SET("a","b","c","d")}.  Then the members have the following bit
values:

@multitable @columnfractions .15 .20 .20
@item @code{SET} @strong{member} @tab @strong{Decimal value} @tab @strong{Binary value}
@item @code{a} @tab @code{1} @tab @code{0001}
@item @code{b} @tab @code{2} @tab @code{0010}
@item @code{c} @tab @code{4} @tab @code{0100}
@item @code{d} @tab @code{8} @tab @code{1000}
@end multitable

If you assign a value of @code{9} to this column, that is @code{1001} in
binary, so the first and fourth @code{SET} value members @code{"a"} and
@code{"d"} are selected and the resulting value is @code{"a,d"}.

For a value containing more than one @code{SET} element, it does not matter
what order the elements are listed in when you insert the value.  It also
does not matter how many times a given element is listed in the value.
When the value is retrieved later, each element in the value will appear
once, with elements listed according to the order in which they were
specified at table creation time.  For example, if a column is specified as
@code{SET("a","b","c","d")}, then @code{"a,d"}, @code{"d,a"}, and
@code{"d,a,a,d,d"} will all appear as @code{"a,d"} when retrieved.

If you set a @code{SET} column to an unsupported value, the value will
be ignored.

@code{SET} values are sorted numerically.  @code{NULL} values sort before
non-@code{NULL} @code{SET} values.

Normally, you perform a @code{SELECT} on a @code{SET} column using
the @code{LIKE} operator or the @code{FIND_IN_SET()} function:

@example
mysql> SELECT * FROM tbl_name WHERE set_col LIKE '%value%';
mysql> SELECT * FROM tbl_name WHERE FIND_IN_SET('value',set_col)>0;
@end example

But the following will also work:

@example
mysql> SELECT * FROM tbl_name WHERE set_col = 'val1,val2';
mysql> SELECT * FROM tbl_name WHERE set_col & 1;
@end example

The first of these statements looks for an exact match.  The second looks
for values containing the first set member.

If you want to get all possible values for a @code{SET} column, you should
use: @code{SHOW COLUMNS FROM table_name LIKE set_column_name} and parse
the @code{SET} definition in the second column.


@node Choosing types, Other-vendor column types, String types, Column types
@section Choosing the Right Type for a Column

@cindex types, columns
@cindex choosing types

For the most efficient use of storage, try to use the most precise type in
all cases. For example, if an integer column will be used for values in the
range between @code{1} and @code{99999}, @code{MEDIUMINT UNSIGNED} is the
best type.

Accurate representation of monetary values is a common problem. In
MySQL, you should use the @code{DECIMAL} type. This is stored as
a string, so no loss of accuracy should occur. If accuracy is not
too important, the @code{DOUBLE} type may also be good enough.

For high precision, you can always convert to a fixed-point type stored
in a @code{BIGINT}. This allows you to do all calculations with integers
and convert results back to floating-point values only when necessary.


@node Other-vendor column types, Storage requirements, Choosing types, Column types
@section Using Column Types from Other Database Engines

@cindex types, portability
@cindex portability, types
@cindex columns, other types

To make it easier to use code written for SQL implementations from other
vendors, MySQL maps column types as shown in the following table.  These
mappings make it easier to move table definitions from other database engines
to MySQL:

@multitable @columnfractions .25 .30
@item @strong{Other vendor type}        @tab @strong{MySQL type}
@item @code{BINARY(NUM)}                @tab @code{CHAR(NUM) BINARY}
@item @code{CHAR VARYING(NUM)}          @tab @code{VARCHAR(NUM)}
@item @code{FLOAT4}                     @tab @code{FLOAT}
@item @code{FLOAT8}                     @tab @code{DOUBLE}
@item @code{INT1}                       @tab @code{TINYINT}
@item @code{INT2}                       @tab @code{SMALLINT}
@item @code{INT3}                       @tab @code{MEDIUMINT}
@item @code{INT4}                       @tab @code{INT}
@item @code{INT8}                       @tab @code{BIGINT}
@item @code{LONG VARBINARY}             @tab @code{MEDIUMBLOB}
@item @code{LONG VARCHAR}               @tab @code{MEDIUMTEXT}
@item @code{MIDDLEINT}                  @tab @code{MEDIUMINT}
@item @code{VARBINARY(NUM)}             @tab @code{VARCHAR(NUM) BINARY}
@end multitable

Column type mapping occurs at table creation time.  If you create a table
with types used by other vendors and then issue a @code{DESCRIBE tbl_name}
statement, MySQL reports the table structure using the equivalent
MySQL types.


@node Storage requirements,  , Other-vendor column types, Column types
@section Column Type Storage Requirements

@cindex storage requirements, column type
@cindex columns, storage requirements

The storage requirements for each of the column types supported by
MySQL are listed by category.

@cindex numeric types
@cindex types, numeric

@subsubheading Storage Requirements for Numeric Types

@multitable @columnfractions .35 .65
@item @strong{Column type} @tab @strong{Storage required}
@item @code{TINYINT}       @tab 1 byte
@item @code{SMALLINT}      @tab 2 bytes
@item @code{MEDIUMINT}     @tab 3 bytes
@item @code{INT}           @tab 4 bytes
@item @code{INTEGER}       @tab 4 bytes
@item @code{BIGINT}        @tab 8 bytes
@item @code{FLOAT(X)}      @tab 4 if X <= 24 or 8 if 25 <= X <= 53
@item @code{FLOAT}         @tab 4 bytes
@item @code{DOUBLE}        @tab 8 bytes
@item @code{DOUBLE PRECISION} @tab 8 bytes
@item @code{REAL}         @tab 8 bytes
@item @code{DECIMAL(M,D)} @tab @code{M+2} bytes if D > 0, @code{M+1} bytes if D = 0 (@code{D}+2, if @code{M < D})
@item @code{NUMERIC(M,D)} @tab @code{M+2} bytes if D > 0, @code{M+1} bytes if D = 0 (@code{D}+2, if @code{M < D})
@end multitable

@cindex date types
@cindex time types
@cindex types, date
@cindex types, time

@subsubheading Storage Requirements for Date and Time Types

@multitable @columnfractions .35 .65
@item @strong{Column type} @tab @strong{Storage required}
@item @code{DATE}          @tab 3 bytes
@item @code{DATETIME}      @tab 8 bytes
@item @code{TIMESTAMP}     @tab 4 bytes
@item @code{TIME}          @tab 3 bytes
@item @code{YEAR}          @tab 1 byte
@end multitable

@subsubheading Storage Requirements for String Types

@multitable @columnfractions .35 .65
@item @strong{Column type} @tab @strong{Storage required}
@item @code{CHAR(M)} @tab @code{M} bytes, @code{1 <= M <= 255}
@item @code{VARCHAR(M)} @tab @code{L}+1 bytes, where @code{L <= M} and
@code{1 <= M <= 255}
@item @code{TINYBLOB}, @code{TINYTEXT} @tab @code{L}+1 bytes,
where @code{L} < 2^8
@item @code{BLOB}, @code{TEXT} @tab @code{L}+2 bytes,
where @code{L} < 2^16
@item @code{MEDIUMBLOB}, @code{MEDIUMTEXT} @tab @code{L}+3 bytes,
where @code{L} < 2^24
@item @code{LONGBLOB}, @code{LONGTEXT} @tab @code{L}+4 bytes,
where @code{L} < 2^32
@item @code{ENUM('value1','value2',...)} @tab 1 or 2 bytes, depending on
the number of enumeration values (65535 values maximum)
@item @code{SET('value1','value2',...)} @tab 1, 2, 3, 4 or 8 bytes, depending
on the number of set members (64 members maximum)
@end multitable

@cindex @code{BLOB}, size
@cindex @code{TEXT}, size
@cindex @code{VARCHAR}, size
@code{VARCHAR} and the @code{BLOB} and @code{TEXT} types are variable-length
types, for which the storage requirements depend on the actual length of
column values (represented by @code{L} in the preceding table), rather than
on the type's maximum possible size.  For example, a @code{VARCHAR(10)}
column can hold a string with a maximum length of 10 characters.  The actual
storage required is the length of the string (@code{L}), plus 1 byte to
record the length of the string.  For the string @code{'abcd'}, @code{L} is 4
and the storage requirement is 5 bytes.

The @code{BLOB} and @code{TEXT} types require 1, 2, 3, or 4 bytes to record
the length of the column value, depending on the maximum possible length of
the type.  @xref{BLOB}.

If a table includes any variable-length column types, the record format will
also be variable-length.  Note that when a table is created, MySQL
may, under certain conditions, change a column from a variable-length type to a
fixed-length type, or vice-versa.  @xref{Silent column changes}.

@cindex ENUM, size
The size of an @code{ENUM} object is determined by the number of
different enumeration values.  One byte is used for enumerations with up
to 255 possible values.  Two bytes are used for enumerations with up to
65535 values. @xref{ENUM}.

@cindex SET, size
The size of a @code{SET} object is determined by the number of different
set members.  If the set size is @code{N}, the object occupies @code{(N+7)/8}
bytes, rounded up to 1, 2, 3, 4, or 8 bytes.  A @code{SET} can have a maximum
of 64 members. @xref{SET}.

@cindex MyISAM, size
The maximum size of a row in a @code{MyISAM} table is 65534 bytes. Each 
@code{BLOB} and @code{TEXT} column accounts for only 5-9 bytes 
toward this size.

@node Functions, SQL Syntax, Column types, Top
@chapter Functions and Operators

@cindex functions for @code{SELECT} and @code{WHERE} clauses
@cindex functions
@cindex operators

@c help_category Functions

A @code{select_expression} or @code{where_definition} in an SQL statement
can consist of any expression using the functions described below.

An expression that contains @code{NULL} always produces a @code{NULL} value
unless otherwise indicated in the documentation for the operators and
functions involved in the expression.

@strong{Note:} There must be no whitespace between a function name and the
parentheses following it. This helps the MySQL parser distinguish
between function calls and references to tables or columns that happen to
have the same name as a function.  Spaces around arguments are permitted,
though.

You can force MySQL to accept spaces after the function name by
starting @code{mysqld} with @code{--ansi} or using the
@code{CLIENT_IGNORE_SPACE} to @code{mysql_connect()}, but in this case all
function names will become reserved words. @xref{ANSI mode}.

@need 2000
For the sake of brevity, examples display the output from the @code{mysql}
program in abbreviated form.  So this:

@example
mysql> SELECT MOD(29,9);
1 rows in set (0.00 sec)

+-----------+
| mod(29,9) |
+-----------+
|         2 |
+-----------+
@end example

is displayed like this:

@example
mysql> SELECT MOD(29,9);
        -> 2
@end example

@menu
* Non-typed Operators::         Non-Type-Specific Operators and Functions
* String functions::            String Functions
* Numeric Functions::           Numeric Functions
* Date and time functions::     Date and Time Functions
* Cast Functions::              Cast Functions
* Other Functions::             Other Functions
* Group by functions and modifiers::  Functions and Modifiers for Use with @code{GROUP BY} Clauses
@end menu


@node Non-typed Operators, String functions, Functions, Functions
@section Non-Type-Specific Operators and Functions

@menu
* Parentheses::                 Parentheses
* Comparison Operators::        Comparison Operators
* Logical Operators::           Logical Operators
* Control flow functions::      Control Flow Functions
@end menu


@node Parentheses, Comparison Operators, Non-typed Operators, Non-typed Operators
@subsection Parentheses

@findex () (parentheses)
@findex parentheses ( and )

@cindex functions, grouping
@cindex grouping, expressions

@example
( ... )
@end example

Use parentheses to force the order of evaluation in an expression.  For
example:

@example
mysql> SELECT 1+2*3;
        -> 7
mysql> SELECT (1+2)*3;
        -> 9
@end example

@node Comparison Operators, Logical Operators, Parentheses, Non-typed Operators
@subsection Comparison Operators

@findex comparison operators
@c help_category Comparison operators@Functions

@cindex casts
@cindex type conversions

Comparison operations result in a value of @code{1} (TRUE), @code{0} (FALSE),
or @code{NULL}. These functions work for both numbers and strings.  Strings
are automatically converted to numbers and numbers to strings as needed (as
in Perl).

MySQL performs comparisons using the following
rules:

@itemize @bullet
@item
If one or both arguments are @code{NULL}, the result of the comparison
is @code{NULL}, except for the @code{<=>} operator.

@item
If both arguments in a comparison operation are strings, they are compared as
strings.

@item
If both arguments are integers, they are compared as integers.

@item
Hexadecimal values are treated as binary strings if not compared to a number.

@item
@cindex ODBC compatibility
@cindex compatibility, with ODBC
If one of the arguments is a @code{TIMESTAMP} or @code{DATETIME} column and
the other argument is a constant, the constant is converted
to a timestamp before the comparison is performed. This is done to be more
ODBC-friendly.

@item
In all other cases, the arguments are compared as floating-point (real)
numbers.
@end itemize

By default, string comparisons are done in case-independent fashion using the
current character set (ISO-8859-1 Latin1 by default, which also works
excellently for English).

If you are comparing case-insensitive strings with any of the standard
operators (@code{=}, @code{<>}..., but not @code{LIKE}) trailing whitespace 
(spaces, tabs and newlines) will be ignored.

@example
mysql> SELECT "a" ="A \n";
        -> 1
@end example

The following examples illustrate conversion of strings to numbers for comparison
operations:

@example
mysql> SELECT 1 > '6x';
        -> 0
mysql> SELECT 7 > '6x';
        -> 1
mysql> SELECT 0 > 'x6';
        -> 0
mysql> SELECT 0 = 'x6';
        -> 1
@end example

Note that when you are comparing a string column with a number, MySQL
can't use index to quickly look up the value:

@example
SELECT * FROM table_name WHERE string_key=1
@end example

The reason for this is that there is many different strings that may
return the value @code{1}:  @code{"1"}, @code{" 1"}, @code{"1a"} ...

@table @code
@findex = (equal)
@findex equal (=)
@c description_for_help_topic =
@item =
Equal:
@c end_description_for_help_topic
@c example_for_help_topic =
@example
mysql> SELECT 1 = 0;
        -> 0
mysql> SELECT '0' = 0;
        -> 1
mysql> SELECT '0.0' = 0;
        -> 1
mysql> SELECT '0.01' = 0;
        -> 0
mysql> SELECT '.01' = 0.01;
        -> 1
@end example

@findex <> (not equal)
@findex not equal (<>)
@findex != (not equal)
@findex not equal (!=)
@c description_for_help_topic !=  <>
@item <>
@itemx !=
Not equal:
@c end_description_for_help_topic
@c example_for_help_topic !=
@example
mysql> SELECT '.01' <> '0.01';
        -> 1
mysql> SELECT .01 <> '0.01';
        -> 0
mysql> SELECT 'zapp' <> 'zappp';
        -> 1
@end example

@findex <= (less than or equal)
@findex less than or equal (<=)
@c description_for_help_topic <=
@item <=
Less than or equal:
@c end_description_for_help_topic
@c example_for_help_topic <=
@example
mysql> SELECT 0.1 <= 2;
        -> 1
@end example

@findex < (less than)
@findex less than (<)
@c description_for_help_topic <
@item <
Less than:
@c end_description_for_help_topic
@c example_for_help_topic <
@example
mysql> SELECT 2 < 2;
        -> 0
@end example

@findex >= (greater than or equal)
@findex greater than or equal (>=)
@c description_for_help_topic >=
@item >=
Greater than or equal:
@c end_description_for_help_topic
@c example_for_help_topic >=
@example
mysql> SELECT 2 >= 2;
        -> 1
@end example

@findex > (greater than)
@findex greater than (>)
@c description_for_help_topic >
@item >
Greater than:
@c end_description_for_help_topic
@c example_for_help_topic >
@example
mysql> SELECT 2 > 2;
        -> 0
@end example

@cindex @code{NULL}, testing for null
@findex <=> (Equal to)
@c description_for_help_topic <=>
@item <=>
@code{NULL}-safe equal:
@c end_description_for_help_topic
@c example_for_help_topic <=>
@example
mysql> SELECT 1 <=> 1, NULL <=> NULL, 1 <=> NULL;
        -> 1 1 0
@end example

@cindex @code{NULL}, testing for null
@findex IS NULL
@findex IS NOT NULL
@c description_for_help_topic IS NULL  NULL IS
@item IS NULL
@itemx IS NOT NULL
Test whether a value is or is not @code{NULL}:
@c end_description_for_help_topic
@c example_for_help_topic IS NULL
@example
mysql> SELECT 1 IS NULL, 0 IS NULL, NULL IS NULL;
        -> 0 0 1
mysql> SELECT 1 IS NOT NULL, 0 IS NOT NULL, NULL IS NOT NULL;
        -> 1 1 0
@end example

@cindex ODBC compatibility
@cindex compatibility, with ODBC
To be able to work well with other programs, MySQL supports the following
extra features when using @code{IS NULL}:

@itemize @bullet
@item
You can find the last inserted row with:

@example
SELECT * FROM tbl_name WHERE auto_col IS NULL
@end example

This can be disabled by setting @code{SQL_AUTO_IS_NULL=0}. @xref{SET OPTION}.
@item
For @code{NOT NULL} @code{DATE} and @code{DATETIME} columns you can find
the special date @code{0000-00-00} by using:

@example
SELECT * FROM tbl_name WHERE date_column IS NULL
@end example

This is needed to get some ODBC applications to work (as ODBC doesn't
support a @code{0000-00-00} date)
@end itemize

@findex BETWEEN ... AND
@c description_for_help_topic BETWEEN AND  BETWEEN AND
@item expr BETWEEN min AND max
If @code{expr} is greater than or equal to @code{min} and @code{expr} is
less than or equal to @code{max}, @code{BETWEEN} returns @code{1},
otherwise it returns @code{0}.  This is equivalent to the expression
@code{(min <= expr AND expr <= max)} if all the arguments are of the
same type. Otherwise type conversion takes place, according to the rules
above, but applied to all the three arguments. @strong{Note} that before
4.0.5 arguments were converted to the type of @code{expr} instead.

@c end_description_for_help_topic
@c example_for_help_topic BETWEEN AND
@example
mysql> SELECT 1 BETWEEN 2 AND 3;
        -> 0
mysql> SELECT 'b' BETWEEN 'a' AND 'c';
        -> 1
mysql> SELECT 2 BETWEEN 2 AND '3';
        -> 1
mysql> SELECT 2 BETWEEN 2 AND 'x-3';
        -> 0
@end example

@findex NOT BETWEEN
@c description_for_help_topic NOT BETWEEN
@item expr NOT BETWEEN min AND max
Same as @code{NOT (expr BETWEEN min AND max)}.

@c end_description_for_help_topic
@findex IN
@c description_for_help_topic IN
@item expr IN (value,...)
Returns @code{1} if @code{expr} is any of the values in the @code{IN} list,
else returns @code{0}.  If all values are constants, then all values are
evaluated according to the type of @code{expr} and sorted. The search for the
item is then done using a binary search. This means @code{IN} is very quick
if the @code{IN} value list consists entirely of constants.  If @code{expr}
is a case-sensitive string expression, the string comparison is performed in
case-sensitive fashion:

@c end_description_for_help_topic
@c example_for_help_topic IN
@example
mysql> SELECT 2 IN (0,3,5,'wefwf');
        -> 0
mysql> SELECT 'wefwf' IN (0,3,5,'wefwf');
        -> 1
@end example

The number of values in the @code{IN} list is only limited by the
@code{max_allowed_packet} value.

From 4.1 (to comply with the SQL-99 standard), @code{IN} returns @code{NULL} 
not only if the expression on the left hand side is @code{NULL}, but also if
no match is found in the list and one of the expressions in the list is 
@code{NULL}.

From MySQL version 4.1, an IN() clause may also contain a subquery.
@xref{ANY IN SOME subqueries}.

@findex NOT IN
@c description_for_help_topic NOT IN
@item expr NOT IN (value,...)
Same as @code{NOT (expr IN (value,...))}.

@c end_description_for_help_topic
@findex ISNULL()
@c description_for_help_topic ISNULL
@item ISNULL(expr)
If @code{expr} is @code{NULL}, @code{ISNULL()} returns @code{1}, otherwise
it returns @code{0}:
@c end_description_for_help_topic
@c example_for_help_topic ISNULL
@example
mysql> SELECT ISNULL(1+1);
        -> 0
mysql> SELECT ISNULL(1/0);
        -> 1
@end example

Note that a comparison of @code{NULL} values using @code{=} will always be
false!

@cindex @code{NULL}, testing for null
@findex COALESCE()
@c description_for_help_topic COALESCE
@item COALESCE(list)
Returns first non-@code{NULL} element in list:

@c end_description_for_help_topic
@c example_for_help_topic COALESCE
@example
mysql> SELECT COALESCE(NULL,1);
        -> 1
mysql> SELECT COALESCE(NULL,NULL,NULL);
        -> NULL
@end example

@findex INTERVAL()
@c description_for_help_topic INTERVAL
@item INTERVAL(N,N1,N2,N3,...)
Returns @code{0} if @code{N} < @code{N1}, @code{1} if @code{N} < @code{N2}
and so on or @code{-1} if @code{N} is @code{NULL}. All arguments are treated
as integers.  It is required that @code{N1} < @code{N2} < @code{N3} < 
@code{...} < @code{Nn} for this function to work correctly. This is because
a binary search is used (very fast):

@c end_description_for_help_topic
@c example_for_help_topic INTERVAL
@example
mysql> SELECT INTERVAL(23, 1, 15, 17, 30, 44, 200);
        -> 3
mysql> SELECT INTERVAL(10, 1, 10, 100, 1000);
        -> 2
mysql> SELECT INTERVAL(22, 23, 30, 44, 200);
        -> 0
@end example
@end table

@node Logical Operators, Control flow functions, Comparison Operators, Non-typed Operators
@subsection Logical Operators

@findex Logical operators
@findex Operators, logical
@c help_category Logical operators@Functions

In SQL, all logical operators evaluate to TRUE, FALSE or NULL (UNKNOWN).
In MySQL, this is implemented as @code{1} (TRUE), @code{0} (FALSE),
and @code{NULL}. Most of this is common between different SQL databases,
however some may return any non-zero value for TRUE.

@table @code
@findex NOT, logical
@findex ! (logical NOT)
@c description_for_help_topic !  NOT
@item NOT
@itemx !
Logical NOT.
Evaluates to @code{1} if the operand is @code{0},
to @code{0} if the operand is non-zero,
and @code{NOT NULL} returns @code{NULL}.
@c end_description_for_help_topic
@c example_for_help_topic !
@example
mysql> SELECT NOT 10;
        -> 0
mysql> SELECT NOT 0;
        -> 1
mysql> SELECT NOT NULL;
        -> NULL
mysql> SELECT ! (1+1);
        -> 0
mysql> SELECT ! 1+1;
        -> 1
@end example
The last example produces @code{1} because the expression evaluates
the same way as @code{(!1)+1}.

@findex AND, logical
@findex && (logical AND)
@c description_for_help_topic &&  AND
@item AND
@itemx &&
Logical AND.
Evaluates to @code{1} if all operands are non-zero and not @code{NULL},
to @code{0} if one or more operands are @code{0},
otherwise @code{NULL} is returned.
@c end_description_for_help_topic
@c example_for_help_topic &&
@example
mysql> SELECT 1 && 1;
        -> 1
mysql> SELECT 1 && 0;
        -> 0
mysql> SELECT 1 && NULL;
        -> NULL
mysql> SELECT 0 && NULL;
        -> 0
mysql> SELECT NULL && 0;
        -> 0
@end example

Please note that MySQL versions prior to 4.0.5 stop evaluation when
a @code{NULL} is encountered, rather than continuing the process to
check for possible @code{0} values. This means that in these versions,
@code{SELECT (NULL AND 0)} returns @code{NULL} instead of @code{0}.
In 4.0.5 the code has been re-engineered so that the result will
always be as prescribed by the SQL standards while still using the
optimization wherever possible.

@findex OR, logical
@findex || (logical OR)
@c description_for_help_topic ||  OR
@item OR
@itemx ||
Logical OR.
Evaluates to @code{1} if any operand is non-zero,
to @code{NULL} if any operand is @code{NULL},
otherwise @code{0} is returned.
@c end_description_for_help_topic
@c example_for_help_topic ||
@example
mysql> SELECT 1 || 1;
        -> 1
mysql> SELECT 1 || 0;
        -> 1
mysql> SELECT 0 || 0;
        -> 0
mysql> SELECT 0 || NULL;
        -> NULL
mysql> SELECT 1 || NULL;
        -> 1
@end example

@findex XOR, logical
@c description_for_help_topic XOR
@item XOR
Logical XOR.
Returns @code{NULL} if either operand is @code{NULL}.
For non-@code{NULL} operands, evaluates to @code{1} if an odd number
of operands is non-zero,
otherwise @code{0} is returned.
@c end_description_for_help_topic
@example
@ example_for_help_topic XOR
mysql> SELECT 1 XOR 1;
        -> 0
mysql> SELECT 1 XOR 0;
        -> 1
mysql> SELECT 1 XOR NULL;
        -> NULL
mysql> SELECT 1 XOR 1 XOR 1;
        -> 1
@end example

@code{a XOR b} is mathematically equal to
@code{(a AND (NOT b)) OR ((NOT a) and b)}.

@code{XOR} was added in version 4.0.2.
@end table


@node Control flow functions,  , Logical Operators, Non-typed Operators
@subsection Control Flow Functions

@findex control flow functions
@findex functions, control flow
@c help_category Control flow functions@Functions

@table @code

@findex CASE
@c description_for_help_topic CASE  WHEN THEN ELSE END
@item CASE value WHEN [compare-value] THEN result [WHEN [compare-value] THEN result ...] [ELSE result] END
@item CASE WHEN [condition] THEN result [WHEN [condition] THEN result ...] [ELSE result] END

The first version returns the @code{result} where
@code{value=compare-value}. The second version returns the result for
the first condition, which is true. If there was no matching result
value, then the result after @code{ELSE} is returned. If there is no
@code{ELSE} part then @code{NULL} is returned:

@c end_description_for_help_topic
@c example_for_help_topic CASE
@example
mysql> SELECT CASE 1 WHEN 1 THEN "one"
           WHEN 2 THEN "two" ELSE "more" END;
       -> "one"
mysql> SELECT CASE WHEN 1>0 THEN "true" ELSE "false" END;
       -> "true"
mysql> SELECT CASE BINARY "B" WHEN "a" THEN 1 WHEN "b" THEN 2 END;
       -> NULL
@end example

The type of the return value (@code{INTEGER}, @code{DOUBLE} or
@code{STRING}) is the same as the type of the first returned value (the
expression after the first @code{THEN}).

@findex IF()
@c description_for_help_topic IF
@item IF(expr1,expr2,expr3)
If @code{expr1} is TRUE (@code{expr1 <> 0} and @code{expr1 <> NULL}) then
@code{IF()} returns @code{expr2}, else it returns @code{expr3}.
@code{IF()} returns a numeric or string value, depending on the context
in which it is used:

@c end_description_for_help_topic
@c example_for_help_topic IF
@example
mysql> SELECT IF(1>2,2,3);
        -> 3
mysql> SELECT IF(1<2,'yes','no');
        -> 'yes'
mysql> SELECT IF(STRCMP('test','test1'),'no','yes');
        -> 'no'
@end example

If @code{expr2} or @code{expr3} is explicitly @code{NULL} then the
result type of the @code{IF()} function is the type of the not
@code{NULL} column. (This behavior is new in MySQL 4.0.3).

@code{expr1} is evaluated as an integer value, which means that if you are
testing floating-point or string values, you should do so using a comparison
operation:

@example
mysql> SELECT IF(0.1,1,0);
        -> 0
mysql> SELECT IF(0.1<>0,1,0);
        -> 1
@end example

In the first case above, @code{IF(0.1)} returns @code{0} because @code{0.1}
is converted to an integer value, resulting in a test of @code{IF(0)}.  This
may not be what you expect.  In the second case, the comparison tests the
original floating-point value to see whether it is non-zero.  The result
of the comparison is used as an integer.

The default return type of @code{IF()} (which may matter when it is
stored into a temporary table) is calculated in MySQL Version
3.23 as follows:

@multitable @columnfractions .50 .20
@item @strong{Expression} @tab @strong{Return value}
@item expr2 or expr3 returns string @tab string
@item expr2 or expr3 returns a floating-point value @tab floating-point
@item expr2 or expr3 returns an integer @tab integer
@end multitable

If expr2 and expr3 are strings, then the result is case insensitive if
both strings are case-insensitive. (Starting from 3.23.51)

@cindex @code{NULL}, testing for null
@findex IFNULL()
@c description_for_help_topic IFNULL
@item IFNULL(expr1,expr2)
If @code{expr1} is not @code{NULL}, @code{IFNULL()} returns @code{expr1},
else it returns @code{expr2}.  @code{IFNULL()} returns a numeric or string
value, depending on the context in which it is used:
@c end_description_for_help_topic
@c example_for_help_topic IFNULL
@example
mysql> SELECT IFNULL(1,0);
        -> 1
mysql> SELECT IFNULL(NULL,10);
        -> 10
mysql> SELECT IFNULL(1/0,10);
        -> 10
mysql> SELECT IFNULL(1/0,'yes');
        -> 'yes'
@end example

In MySQL 4.0.6 and above, the default result value of
@code{IFNULL(expr1,expr2)} is the more ``general'' of the two expressions,
in the order @code{STRING}, @code{REAL} or @code{INTEGER}. The difference
to earlier MySQL versions are mostly notable when you create a table
based on expressions or MySQL has to internally store a value from
@code{IFNULL()} in a temporary table.

@example
CREATE TABLE foo SELECT IFNULL(1,"test") as test;
@end example

In MySQL 4.0.6, the type for column 'test' is @code{CHAR(4)} while in
earlier versions you would get @code{BIGINT}.

@findex NULLIF()
@c description_for_help_topic NULLIF
@item NULLIF(expr1,expr2)
If @code{expr1 = expr2} is true, return @code{NULL} else return @code{expr1}.
This is the same as @code{CASE WHEN x = y THEN NULL ELSE x END}:
@c end_description_for_help_topic
@c example_for_help_topic NULLIF
@example
mysql> SELECT NULLIF(1,1);
        -> NULL
mysql> SELECT NULLIF(1,2);
        -> 1
@end example

Note that @code{expr1} is evaluated twice in MySQL if the arguments
are not equal.

@end table

@node String functions, Numeric Functions, Non-typed Operators, Functions
@section String Functions

@findex string functions
@findex functions, string
@c help_category String Functions@Functions

String-valued functions return @code{NULL} if the length of the result would
be greater than the @code{max_allowed_packet} server parameter.  @xref{Server
parameters}.

For functions that operate on string positions,
the first position is numbered 1.

@table @code

@findex ASCII()
@c description_for_help_topic ASCII
@item ASCII(str)
Returns the ASCII code value of the leftmost character of the string
@code{str}. Returns @code{0} if @code{str} is the empty string.  Returns
@code{NULL} if @code{str} is @code{NULL}:

@c end_description_for_help_topic
@c example_for_help_topic ASCII
@example
mysql> SELECT ASCII('2');
        -> 50
mysql> SELECT ASCII(2);
        -> 50
mysql> SELECT ASCII('dx');
        -> 100
@end example

See also the @code{ORD()} function.

@findex BIN()
@c description_for_help_topic BIN
@item BIN(N)
Returns a string representation of the binary value of @code{N}, where
@code{N} is a longlong (@code{BIGINT}) number.  This is equivalent to
@code{CONV(N,10,2)}.  Returns @code{NULL} if @code{N} is @code{NULL}:

@c end_description_for_help_topic
@c example_for_help_topic BIN
@example
mysql> SELECT BIN(12);
        -> '1100'
@end example

@findex BIT_LENGTH()
@c description_for_help_topic BIT_LENGTH
@item BIT_LENGTH(str)
Returns the length of the string @code{str} in bits:

@c end_description_for_help_topic
@c example_for_help_topic BIT_LENGTH
@example
mysql> SELECT BIT_LENGTH('text');
        -> 32
@end example

@findex CHAR()
@c description_for_help_topic CHAR function
@item CHAR(N,...)
@code{CHAR()} interprets the arguments as integers and returns a string
consisting of the characters given by the ASCII code values of those
integers. @code{NULL} values are skipped:

@c end_description_for_help_topic
@c example_for_help_topic CHAR function
@example
mysql> SELECT CHAR(77,121,83,81,'76');
        -> 'MySQL'
mysql> SELECT CHAR(77,77.3,'77.3');
        -> 'MMM'
@end example

@findex CHAR_LENGTH()
@c description_for_help_topic CHAR_LENGTH
@item CHAR_LENGTH(str)

Returns the length of the string @code{str}, measured in characters.
A multi-byte character counts as a single character.
This means that for a string containing five two-byte characters,
@code{LENGTH()} returns @code{10}, whereas @code{CHAR_LENGTH()} returns
@code{5}.
@c end_description_for_help_topic

@findex CHARACTER_LENGTH()
@c description_for_help_topic CHARACTER_LENGTH
@item CHARACTER_LENGTH(str)

@code{CHARACTER_LENGTH()} is a synonym for @code{CHAR_LENGTH()}.
@c end_description_for_help_topic

@findex COMPRESS()
@c description_for_help_topic COMPRESS
@item COMPRESS(string_to_compress)
Compresses a string.
@c end_description_for_help_topic

@c example_for_help_topic COMPRESS
@example
mysql> SELECT LENGTH(COMPRESS(REPEAT("a",1000)));
        -> 21
mysql> SELECT LENGTH(COMPRESS(""));
        -> 0
mysql> SELECT LENGTH(COMPRESS("a"));
        -> 13
mysql> SELECT LENGTH(COMPRESS(REPEAT("a",16)));
        -> 15
@end example

@code{COMPRESS()} was added in MySQL version 4.1.1.
It requires MySQL to have been compiled with a compression library such as
@code{zlib}. Otherwise, the return value is always @code{NULL}.

The compressed string contents are stored the following way:
@itemize @bullet
@item
Empty strings are stored as empty strings.
@item
Non-empty strings are stored as a 4-byte length of the uncompressed string
(low byte first), followed by the string compressed with gzip.  If the string
ends with space, we add an extra @samp{.} to avoid problems with end space
trimming should the result be stored in a @code{CHAR} or @code{VARCHAR}
column.  Use of @code{CHAR} or @code{VARCHAR} to store compressed strings is
not recommended. It is better to use a @code{BLOB} column instead.
@end itemize


@findex CONCAT()
@c description_for_help_topic CONCAT
@item CONCAT(str1,str2,...)
Returns the string that results from concatenating the arguments.  Returns
@code{NULL} if any argument is @code{NULL}.  May have more than two arguments.
A numeric argument is converted to its equivalent string form:

@c end_description_for_help_topic
@c example_for_help_topic CONCAT
@example
mysql> SELECT CONCAT('My', 'S', 'QL');
        -> 'MySQL'
mysql> SELECT CONCAT('My', NULL, 'QL');
        -> NULL
mysql> SELECT CONCAT(14.3);
        -> '14.3'
@end example

@findex CONCAT_WS()
@c description_for_help_topic CONCAT_WS
@item CONCAT_WS(separator, str1, str2,...)

@code{CONCAT_WS()} stands for CONCAT With Separator and is a special form of
@code{CONCAT()}.  The first argument is the separator for the rest of the
arguments.
The separator is added between the strings to be concatenated:
The separator can be a string as can the rest of the
arguments. If the separator is @code{NULL}, the result is @code{NULL}.
The function skips any @code{NULL} values after the
separator argument.

@c end_description_for_help_topic
@c example_for_help_topic CONCAT_WS
@example
mysql> SELECT CONCAT_WS(",","First name","Second name","Last Name");
       -> 'First name,Second name,Last Name'
mysql> SELECT CONCAT_WS(",","First name",NULL,"Last Name");
       -> 'First name,Last Name'
@end example

Before MySQL 4.0.14, @code{CONCAT_WS()} skips empty strings as well as
@code{NULL} values.

@findex CONV()
@c description_for_help_topic CONV
@item CONV(N,from_base,to_base)
Converts numbers between different number bases.  Returns a string
representation of the number @code{N}, converted from base @code{from_base}
to base @code{to_base}.  Returns @code{NULL} if any argument is @code{NULL}.
The argument @code{N} is interpreted as an integer, but may be specified as
an integer or a string.  The minimum base is @code{2} and the maximum base is
@code{36}.  If @code{to_base} is a negative number, @code{N} is regarded as a
signed number.  Otherwise, @code{N} is treated as unsigned.  @code{CONV} works
with 64-bit precision:

@c end_description_for_help_topic
@c example_for_help_topic CONV
@example
mysql> SELECT CONV("a",16,2);
        -> '1010'
mysql> SELECT CONV("6E",18,8);
        -> '172'
mysql> SELECT CONV(-17,10,-18);
        -> '-H'
mysql> SELECT CONV(10+"10"+'10'+0xa,10,10);
        -> '40'
@end example

@findex ELT()
@c description_for_help_topic ELT
@item ELT(N,str1,str2,str3,...)
Returns @code{str1} if @code{N} = @code{1}, @code{str2} if @code{N} =
@code{2}, and so on.  Returns @code{NULL} if @code{N} is less than @code{1}
or greater than the number of arguments.  @code{ELT()} is the complement of
@code{FIELD()}:

@c end_description_for_help_topic
@c example_for_help_topic ELT
@example
mysql> SELECT ELT(1, 'ej', 'Heja', 'hej', 'foo');
        -> 'ej'
mysql> SELECT ELT(4, 'ej', 'Heja', 'hej', 'foo');
        -> 'foo'
@end example

@findex EXPORT_SET()
@c description_for_help_topic EXPORT_SET
@item EXPORT_SET(bits,on,off,[separator,[number_of_bits]])
Returns a string in which for every bit set in @code{bits}, you get an @code{on} 
string and for every reset bit you get an @code{off} string. Each string is 
separated by @code{separator} (default @code{,}), and only 
@code{number_of_bits} (default 64) of @code{bits} is used:

@c end_description_for_help_topic
@c example_for_help_topic EXPORT_SET
@example
mysql> SELECT EXPORT_SET(5,'Y','N',',',4)
        -> Y,N,Y,N
@end example

@findex FIELD()
@c description_for_help_topic FIELD
@item FIELD(str,str1,str2,str3,...)
Returns the index of @code{str} in the @code{str1}, @code{str2},
@code{str3}, @code{...} list.
Returns @code{0} if @code{str} is not found.
@code{FIELD()} is the complement of @code{ELT()}:

@c end_description_for_help_topic
@c example_for_help_topic FIELD
@example
mysql> SELECT FIELD('ej', 'Hej', 'ej', 'Heja', 'hej', 'foo');
        -> 2
mysql> SELECT FIELD('fo', 'Hej', 'ej', 'Heja', 'hej', 'foo');
        -> 0
@end example

@findex FIND_IN_SET()
@c description_for_help_topic FIND_IN_SET
@item FIND_IN_SET(str,strlist)
Returns a value @code{1} to @code{N} if the string @code{str} is in the list
@code{strlist} consisting of @code{N} substrings. A string list is a string
composed of substrings separated by @samp{,} characters. If the first
argument is a constant string and the second is a column of type @code{SET},
the @code{FIND_IN_SET()} function is optimized to use bit arithmetic!
Returns @code{0} if @code{str} is not in @code{strlist} or if @code{strlist}
is the empty string.  Returns @code{NULL} if either argument is @code{NULL}.
This function will not work properly if the first argument contains a comma
@samp{,}:

@c end_description_for_help_topic
@c example_for_help_topic FIND_IN_SET
@example
mysql> SELECT FIND_IN_SET('b','a,b,c,d');
        -> 2
@end example

@findex HEX()
@c description_for_help_topic HEX
@item HEX(N_or_S)

If N_OR_S is a number, returns a string representation of the hexadecimal
value of @code{N}, where @code{N} is a longlong (@code{BIGINT}) number.
This is equivalent to @code{CONV(N,10,16)}.

If N_OR_S is a string, returns a hexadecimal string of N_OR_S where each
character in N_OR_S is converted to two hexadecimal digits. This is the
inverse of the @code{0xff} strings.

@c end_description_for_help_topic
@c example_for_help_topic HEX
@example
mysql> SELECT HEX(255);
        -> 'FF'
mysql> SELECT HEX("abc");
        -> 616263
mysql> SELECT 0x616263;
        -> "abc"
@end example

@findex INSERT()
@c description_for_help_topic INSERT
@item INSERT(str,pos,len,newstr)
Returns the string @code{str}, with the substring beginning at position
@code{pos} and @code{len} characters long replaced by the string
@code{newstr}:

@c end_description_for_help_topic
@c example_for_help_topic INSERT
@example
mysql> SELECT INSERT('Quadratic', 3, 4, 'What');
        -> 'QuWhattic'
@end example

This function is multi-byte safe.

@findex INSTR()
@c description_for_help_topic INSTR
@item INSTR(str,substr)
Returns the position of the first occurrence of substring @code{substr} in
string @code{str}. This is the same as the two-argument form of
@code{LOCATE()}, except that the arguments are swapped:

@c end_description_for_help_topic
@c example_for_help_topic INSTR
@example
mysql> SELECT INSTR('foobarbar', 'bar');
        -> 4
mysql> SELECT INSTR('xbar', 'foobar');
        -> 0
@end example

This function is multi-byte safe.  In MySQL 3.23 this function is case
sensitive, while in 4.0 it's only case sensitive if either argument is
a binary string.

@findex LCASE()
@c description_for_help_topic LCASE
@item LCASE(str)

@code{LCASE()} is a synonym for @code{LOWER()}.
@c end_description_for_help_topic

@findex LEFT()
@c description_for_help_topic LEFT
@item LEFT(str,len)
Returns the leftmost @code{len} characters from the string @code{str}:

@c end_description_for_help_topic
@c example_for_help_topic LEFT
@example
mysql> SELECT LEFT('foobarbar', 5);
        -> 'fooba'
@end example

@findex LENGTH()
@c description_for_help_topic LENGTH
@item LENGTH(str)
Returns the length of the string @code{str}, measured in bytes.
A multi-byte character counts as multiple bytes.
This means that for a string containing five two-byte characters,
@code{LENGTH()} returns @code{10}, whereas @code{CHAR_LENGTH()} returns
@code{5}.

@c end_description_for_help_topic
@c example_for_help_topic LENGTH
@example
mysql> SELECT LENGTH('text');
        -> 4
@end example

@findex FILE
@findex LOAD_FILE()
@c description_for_help_topic LOAD_FILE
@item LOAD_FILE(file_name)
Reads the file and returns the file contents as a string.  The file
must be on the server, you must specify the full pathname to the
file, and you must have the @code{FILE} privilege.  The file must
be readable by all and be smaller than @code{max_allowed_packet}.

If the file doesn't exist or can't be read due to one of these reasons,
the function returns @code{NULL}:

@c end_description_for_help_topic
@c example_for_help_topic LOAD_FILE
@example
mysql> UPDATE tbl_name
           SET blob_column=LOAD_FILE("/tmp/picture")
           WHERE id=1;
@end example

If you are not using MySQL Version 3.23, you have to do the reading
of the file inside your application and create an @code{INSERT} statement
to update the database with the file information. One way to do this, if
you are using the MySQL++ library, can be found at
@uref{http://www.mysql.com/documentation/mysql++/mysql++-examples.html}.

@findex LOCATE()
@c description_for_help_topic LOCATE
@item LOCATE(substr,str)
@itemx LOCATE(substr,str,pos)

The first syntax
returns the position of the first occurrence of substring @code{substr}
in string @code{str}.
The second syntax
returns the position of the first occurrence of substring @code{substr} in
string @code{str}, starting at position @code{pos}.
Returns @code{0} if @code{substr} is not in @code{str}.

@c end_description_for_help_topic
@c example_for_help_topic POSITION
@example
mysql> SELECT LOCATE('bar', 'foobarbar');
        -> 4
mysql> SELECT LOCATE('xbar', 'foobar');
        -> 0
mysql> SELECT LOCATE('bar', 'foobarbar',5);
        -> 7
@end example

This function is multi-byte safe.  In MySQL 3.23 this function is case
sensitive, while in 4.0 it's only case sensitive if either argument is
a binary string.

@findex LOWER()
@c description_for_help_topic LOWER
@item LOWER(str)
Returns the string @code{str} with all characters changed to lowercase
according to the current character set mapping (the default is ISO-8859-1
Latin1):

@c end_description_for_help_topic
@c example_for_help_topic LOWER
@example
mysql> SELECT LOWER('QUADRATICALLY');
        -> 'quadratically'
@end example

This function is multi-byte safe.

@findex LPAD()
@c description_for_help_topic LPAD
@item LPAD(str,len,padstr)
Returns the string @code{str}, left-padded with the string @code{padstr}
to a length of @code{len} characters. If @code{str} is longer
than @code{len}, the return value is shortened to @code{len} characters.

@c end_description_for_help_topic
@c example_for_help_topic LPAD
@example
mysql> SELECT LPAD('hi',4,'??');
        -> '??hi'
@end example

@findex LTRIM()
@c description_for_help_topic LTRIM
@item LTRIM(str)
Returns the string @code{str} with leading space characters removed:

@c end_description_for_help_topic
@c example_for_help_topic LTRIM
@example
mysql> SELECT LTRIM('  barbar');
        -> 'barbar'
@end example

@findex MAKE_SET()
@c description_for_help_topic MAKE_SET
@item MAKE_SET(bits,str1,str2,...)
Returns a set (a string containing substrings separated by @samp{,}
characters) consisting of the strings that have the corresponding bit in
@code{bits} set.  @code{str1} corresponds to bit 0, @code{str2} to bit 1,
etc.  @code{NULL} strings in @code{str1}, @code{str2}, @code{...}
are not appended to the result:

@c end_description_for_help_topic
@c example_for_help_topic MAKE_SET
@example
mysql> SELECT MAKE_SET(1,'a','b','c');
        -> 'a'
mysql> SELECT MAKE_SET(1 | 4,'hello','nice','world');
        -> 'hello,world'
mysql> SELECT MAKE_SET(0,'a','b','c');
        -> ''
@end example

@findex MID()
@c description_for_help_topic MID
@item MID(str,pos,len)

@code{MID(str,pos,len)} is a synonym for @code{SUBSTRING(str,pos,len)}.
@c end_description_for_help_topic

@findex OCT()
@c description_for_help_topic OCT
@item OCT(N)
Returns a string representation of the octal value of @code{N}, where
@code{N} is a longlong number.  This is equivalent to @code{CONV(N,10,8)}.
Returns @code{NULL} if @code{N} is @code{NULL}:

@c end_description_for_help_topic
@c example_for_help_topic OCT
@example
mysql> SELECT OCT(12);
        -> '14'
@end example

@findex OCTET_LENGTH()
@c description_for_help_topic OCTETLENGTH
@item OCTET_LENGTH(str)

@code{OCTET_LENGTH()} is a synonym for @code{LENGTH()}.
@c end_description_for_help_topic

@findex ORD()
@c description_for_help_topic ORD
@item ORD(str)
If the leftmost character of the string @code{str} is a multi-byte character,
returns the code for that character, calculated from the ASCII code values
of its constituent characters using this formula:
@code{((first byte ASCII code)*256+(second byte ASCII code))[*256+third byte ASCII code...]}.
If the leftmost character is not a multi-byte character, returns the same
value that the @code{ASCII()} function does:

@c end_description_for_help_topic
@c example_for_help_topic ORD
@example
mysql> SELECT ORD('2');
        -> 50
@end example

@findex POSITION()
@c description_for_help_topic POSITION
@item POSITION(substr IN str)

@code{POSITION(substr IN str)} is a synonym for @code{LOCATE(substr,str)}.
@c end_description_for_help_topic

@findex QUOTE()
@c description_for_help_topic QUOTE
@item QUOTE(str)
Quotes a string to produce a result that can be used as a properly escaped
data value in an SQL statement.  The string is returned surrounded by single
quotes and with each instance of single quote (@samp{'}), backslash (@samp{\}),
ASCII NUL, and Control-Z preceded by a backslash.  If the argument is
@code{NULL}, the return value is the word ``NULL'' without surrounding
single quotes.
The @code{QUOTE()} function was added in MySQL version 4.0.3.
@c end_description_for_help_topic

@c example_for_help_topic QUOTE
@example
mysql> SELECT QUOTE("Don't");
        -> 'Don\'t!'
mysql> SELECT QUOTE(NULL);
        -> NULL
@end example

@findex REPEAT()
@c description_for_help_topic REPEAT
@item REPEAT(str,count)
Returns a string consisting of the string @code{str} repeated @code{count}
times. If @code{count <= 0}, returns an empty string. Returns @code{NULL} if
@code{str} or @code{count} are @code{NULL}:

@c end_description_for_help_topic
@c example_for_help_topic REPEAT
@example
mysql> SELECT REPEAT('MySQL', 3);
        -> 'MySQLMySQLMySQL'
@end example

@findex REPLACE()
@c description_for_help_topic REPLACE
@item REPLACE(str,from_str,to_str)
Returns the string @code{str} with all occurrences of the string
@code{from_str} replaced by the string @code{to_str}:

@c end_description_for_help_topic
@c example_for_help_topic REPLACE
@example
mysql> SELECT REPLACE('www.mysql.com', 'w', 'Ww');
        -> 'WwWwWw.mysql.com'
@end example

This function is multi-byte safe.

@findex REVERSE()
@c description_for_help_topic REVERSE
@item REVERSE(str)
Returns the string @code{str} with the order of the characters reversed:

@c end_description_for_help_topic
@c example_for_help_topic REVERSE
@example
mysql> SELECT REVERSE('abc');
        -> 'cba'
@end example

This function is multi-byte safe.

@findex RIGHT()
@c description_for_help_topic RIGHT
@item RIGHT(str,len)
Returns the rightmost @code{len} characters from the string @code{str}:

@c end_description_for_help_topic
@c example_for_help_topic RIGHT
@example
mysql> SELECT RIGHT('foobarbar', 4);
        -> 'rbar'
@end example

This function is multi-byte safe.

@findex RPAD()
@c description_for_help_topic RPAD
@item RPAD(str,len,padstr)
Returns the string @code{str}, right-padded with the string @code{padstr}
to a length of @code{len} characters. If @code{str} is longer
than @code{len}, the return value is shortened to @code{len} characters.

@c end_description_for_help_topic
@c example_for_help_topic RPAD
@example
mysql> SELECT RPAD('hi',5,'?');
        -> 'hi???'
@end example

This function is multi-byte safe.

@findex RTRIM()
@c description_for_help_topic RTRIM
@item RTRIM(str)
Returns the string @code{str} with trailing space characters removed:

@c end_description_for_help_topic
@c example_for_help_topic RTRIM
@example
mysql> SELECT RTRIM('barbar   ');
        -> 'barbar'
@end example

This function is multi-byte safe.

@findex SOUNDEX()
@c description_for_help_topic SOUNDEX
@item SOUNDEX(str)
Returns a soundex string from @code{str}. Two strings that sound almost the
same should have identical soundex strings. A standard soundex string
is 4 characters long, but the @code{SOUNDEX()} function returns an
arbitrarily long string. You can use @code{SUBSTRING()} on the result to get
a standard soundex string.  All non-alphanumeric characters are ignored
in the given string. All international alpha characters outside the A-Z range
are treated as vowels:

@c end_description_for_help_topic
@c example_for_help_topic SOUNDEX
@example
mysql> SELECT SOUNDEX('Hello');
        -> 'H400'
mysql> SELECT SOUNDEX('Quadratically');
        -> 'Q36324'
@end example

@findex SOUNDS LIKE
@c description_for_help_topic SOUNDS LIKE  SOUNDS LIKE
@item expr1 SOUNDS LIKE expr2

Same as @code{SOUNDEX(expr1)=SOUNDEX(expr2)} (available only in version 4.1 or later). 
@c end_description_for_help_topic

@findex SPACE()
@c description_for_help_topic SPACE
@item SPACE(N)
Returns a string consisting of @code{N} space characters:

@c end_description_for_help_topic
@c example_for_help_topic SPACE
@example
mysql> SELECT SPACE(6);
        -> '      '
@end example

@findex SUBSTRING()
@c description_for_help_topic SUBSTRING
@item SUBSTRING(str,pos)
@itemx SUBSTRING(str FROM pos)
@itemx SUBSTRING(str,pos,len)
@itemx SUBSTRING(str FROM pos FOR len)

The forms without a @code{len} argument
return a substring from string @code{str} starting at position @code{pos}.
The forms with a @code{len} argument
return a substring @code{len} characters long from string @code{str},
starting at position @code{pos}.
The forms that use @code{FROM} are SQL-92 syntax.

@c end_description_for_help_topic
@c example_for_help_topic SUBSTRING
@example
mysql> SELECT SUBSTRING('Quadratically',5);
        -> 'ratically'
mysql> SELECT SUBSTRING('foobarbar' FROM 4);
        -> 'barbar'
mysql> SELECT SUBSTRING('Quadratically',5,6);
        -> 'ratica'
@end example

This function is multi-byte safe.

@findex SUBSTRING_INDEX()
@c description_for_help_topic SUBSTRING_INDEX
@item SUBSTRING_INDEX(str,delim,count)
Returns the substring from string @code{str} before @code{count}
occurrences of the delimiter @code{delim}.
If @code{count} is positive, everything to the left of the final delimiter
(counting from the left) is returned.
If @code{count} is negative, everything to the right of the final delimiter
(counting from the right) is returned:

@c end_description_for_help_topic
@c example_for_help_topic SUBSTRING_INDEX
@example
mysql> SELECT SUBSTRING_INDEX('www.mysql.com', '.', 2);
        -> 'www.mysql'
mysql> SELECT SUBSTRING_INDEX('www.mysql.com', '.', -2);
        -> 'mysql.com'
@end example

This function is multi-byte safe.

@findex TRIM()
@c description_for_help_topic TRIM  BOTH LEADING TRAILING FROM
@item TRIM([[BOTH | LEADING | TRAILING] [remstr] FROM] str)
Returns the string @code{str} with all @code{remstr} prefixes and/or suffixes
removed. If none of the specifiers @code{BOTH}, @code{LEADING} or
@code{TRAILING} is given, @code{BOTH} is assumed. If @code{remstr} is not
specified, spaces are removed:

@c end_description_for_help_topic
@c example_for_help_topic TRIM
@example
mysql> SELECT TRIM('  bar   ');
        -> 'bar'
mysql> SELECT TRIM(LEADING 'x' FROM 'xxxbarxxx');
        -> 'barxxx'
mysql> SELECT TRIM(BOTH 'x' FROM 'xxxbarxxx');
        -> 'bar'
mysql> SELECT TRIM(TRAILING 'xyz' FROM 'barxxyz');
        -> 'barx'
@end example

This function is multi-byte safe.

@findex UCASE()
@c description_for_help_topic UCASE
@item UCASE(str)

@code{UCASE()} is a synonym for @code{UPPER()}.
@c end_description_for_help_topic

@findex UNCOMPRESS()
@c description_for_help_topic UNCOMPRESS
@item UNCOMPRESS(string_to_uncompress)
Uncompresses a string compressed by the @code{COMPRESS()} function.
@c end_description_for_help_topic

@c example_for_help_topic UNCOMPRESS
@example
mysql> SELECT UNCOMPRESS(COMPRESS("any string"));
        -> 'any string'
@end example

@code{UNCOMPRESS()} was added in MySQL version 4.1.1.
It requires MySQL to have been compiled with a compression library such as
@code{zlib}. Otherwise, the return value is always @code{NULL}.

@findex UNCOMPRESSED_LENGTH()
@c description_for_help_topic UNCOMPRESSED_LENGTH
@item UNCOMPRESSED_LENGTH(compressed_string)
Returns the length of a compressed string before compressing.
@c end_description_for_help_topic

@c example_for_help_topic UNCOMPRESSED_LENGTH
@example
mysql> SELECT UNCOMPRESSED_LENGTH(COMPRESS(REPEAT("a",30)));
        -> 30
@end example

@code{UNCOMPRESSED_LENGTH()} was added in MySQL version 4.1.1.

@findex UPPER()
@c description_for_help_topic UPPER
@item UPPER(str)
Returns the string @code{str} with all characters changed to uppercase
according to the current character set mapping (the default is ISO-8859-1
Latin1):

@c end_description_for_help_topic
@c example_for_help_topic UPPER
@example
mysql> SELECT UPPER('Hej');
        -> 'HEJ'
@end example

This function is multi-byte safe.

@end table


@menu
* String comparison functions::  String Comparison Functions
* Case Sensitivity Operators::  Case-Sensitivity
@end menu

@node String comparison functions, Case Sensitivity Operators, String functions, String functions
@subsection String Comparison Functions

@findex string comparison functions
@findex functions, string comparison

MySQL automatically converts numbers to strings as necessary, and
vice-versa:

@example
mysql> SELECT 1+"1";
        -> 2
mysql> SELECT CONCAT(2,' test');
        -> '2 test'
@end example

If you want to convert a number to a string explicitly, pass it as the
argument to @code{CONCAT()}.

If a string function is given a binary string as an argument, the resulting
string is also a binary string.  A number converted to a string is treated as
a binary string.  This only affects comparisons.

@cindex case sensitivity, in string comparisons
@cindex string comparisons, case sensitivity

Normally, if any expression in a string comparison is case sensitive, the
comparison is performed in case-sensitive fashion.

@table @code

@findex LIKE
@c description_for_help_topic LIKE  ESCAPE
@item expr LIKE pat [ESCAPE 'escape-char']
Pattern matching using
SQL simple regular expression comparison. Returns @code{1} (TRUE) or @code{0}
(FALSE).  With @code{LIKE} you can use the following two wildcard characters
in the pattern:

@multitable @columnfractions .10 .60
@item @strong{Char} @tab @strong{Description}
@item @code{%} @tab Matches any number of characters, even zero characters
@item @code{_} @tab Matches exactly one character
@end multitable

@c end_description_for_help_topic
@c example_for_help_topic LIKE
@example
mysql> SELECT 'David!' LIKE 'David_';
        -> 1
mysql> SELECT 'David!' LIKE '%D%v%';
        -> 1
@end example

To test for literal instances of a wildcard character, precede the character
with the escape character.  If you don't specify the @code{ESCAPE} character,
@samp{\} is assumed:

@multitable @columnfractions .10 .60
@item @strong{String} @tab @strong{Description}
@item @code{\%} @tab Matches one @code{%} character
@item @code{\_} @tab Matches one @code{_} character
@end multitable

@example
mysql> SELECT 'David!' LIKE 'David\_';
        -> 0
mysql> SELECT 'David_' LIKE 'David\_';
        -> 1
@end example

To specify a different escape character, use the @code{ESCAPE} clause:

@example
mysql> SELECT 'David_' LIKE 'David|_' ESCAPE '|';
        -> 1
@end example

The following two statements illustrate that string comparisons are
not case sensitive unless one of the operands is a binary string:

@example
mysql> SELECT 'abc' LIKE 'ABC';
        -> 1
mysql> SELECT 'abc' LIKE BINARY 'ABC';
        -> 0
@end example

@code{LIKE} is allowed on numeric expressions! (This is a MySQL
extension to the SQL-99 @code{LIKE}.)

@example
mysql> SELECT 10 LIKE '1%';
        -> 1
@end example

Note: Because MySQL uses the C escape syntax in strings (for example,
@samp{\n}), you must double any @samp{\} that you use in your @code{LIKE}
strings.  For example, to search for @samp{\n}, specify it as @samp{\\n}.  To
search for @samp{\}, specify it as @samp{\\\\} (the backslashes are stripped
once by the parser and another time when the pattern match is done, leaving
a single backslash to be matched).

@strong{Note:} Currently @code{LIKE} is not @code{multi-byte character} safe.
Comparison is done character by character.

@findex MATCH ... AGAINST()
@c help_category String Functions@Functions
@c description_for_help_topic MATCH AGAINST  MATCH AGAINST BOOLEAN IN MODE  MATCH AGAINST QUERY EXPANSION WITH
@item MATCH (col1,col2,...) AGAINST (expr [IN BOOLEAN MODE | WITH QUERY EXPANSION] )
@code{MATCH ... AGAINST()} is used for full-text search and returns
relevance - similarity measure between the text in columns
@code{(col1,col2,...)} and the query @code{expr}. Relevance is a
positive floating-point number. Zero relevance means no similarity.
@code{MATCH ... AGAINST()} is available in MySQL version
3.23.23 or later. @code{IN BOOLEAN MODE} extension was added in version
4.0.1, @code{WITH QUERY EXPANSION} was added in 4.1.1.
For details and usage examples, see @ref{Fulltext Search}.
@c end_description_for_help_topic

@findex NOT LIKE
@c description_for_help_topic NOT LIKE
@item expr NOT LIKE pat [ESCAPE 'escape-char']

Same as @code{NOT (expr LIKE pat [ESCAPE 'escape-char'])}.
@c end_description_for_help_topic

@findex NOT REGEXP
@c description_for_help_topic NOT REGEXP
@item expr NOT REGEXP pat
@itemx expr NOT RLIKE pat

Same as @code{NOT (expr REGEXP pat)}.
@c end_description_for_help_topic

@cindex mSQL compatibility
@cindex compatibility, with mSQL
@findex REGEXP
@findex RLIKE
@c description_for_help_topic RLIKE  REGEXP
@item expr REGEXP pat
@itemx expr RLIKE pat
Performs a pattern match of a string expression @code{expr} against a pattern
@code{pat}.  The pattern can be an extended regular expression.
@xref{Regexp}.  Returns @code{1} if @code{expr} matches @code{pat}, otherwise
returns @code{0}.  @code{RLIKE} is a synonym for @code{REGEXP}, provided for
@code{mSQL} compatibility. Note: Because MySQL uses the C escape
syntax in strings (for example, @samp{\n}), you must double any @samp{\} that
you use in your @code{REGEXP} strings.  As of MySQL Version 3.23.4,
@code{REGEXP} is not case sensitive for normal (not binary) strings:

@c end_description_for_help_topic
@c example_for_help_topic RLIKE
@example
mysql> SELECT 'Monty!' REGEXP 'm%y%%';
        -> 0
mysql> SELECT 'Monty!' REGEXP '.*';
        -> 1
mysql> SELECT 'new*\n*line' REGEXP 'new\\*.\\*line';
        -> 1
mysql> SELECT "a" REGEXP "A", "a" REGEXP BINARY "A";
        -> 1  0
mysql> SELECT "a" REGEXP "^[a-d]";
        -> 1
@end example

@code{REGEXP} and @code{RLIKE} use the current character set (ISO-8859-1
Latin1 by default) when deciding the type of a character.

@findex STRCMP()
@c description_for_help_topic STRCMP
@item STRCMP(expr1,expr2)
@code{STRCMP()}
returns @code{0} if the strings are the same, @code{-1} if the first
argument is smaller than the second according to the current sort order,
and @code{1} otherwise:

@c end_description_for_help_topic
@c example_for_help_topic STRCMP
@example
mysql> SELECT STRCMP('text', 'text2');
        -> -1
mysql> SELECT STRCMP('text2', 'text');
        -> 1
mysql> SELECT STRCMP('text', 'text');
        -> 0
@end example

As of MySQL 4.0,
@code{STRCMP()} uses the current character set when performing comparisons.
This makes the default comparison behavior case insensitive unless
one or both of the operands are binary strings.
Before MySQL 4.0, @code{STRCMP()} is case sensitive.

@end table

@node Case Sensitivity Operators,  , String comparison functions, String functions
@subsection Case-Sensitivity

@findex casts

@cindex cast operators
@cindex operators, cast

@table @code

@findex BINARY
@c description_for_help_topic BINARY
@item @code{BINARY}
The @code{BINARY} operator casts the string following it to a binary string.
This is an easy way to force a column comparison to be case sensitive even
if the column isn't defined as @code{BINARY} or @code{BLOB}:
@c end_description_for_help_topic
@c example_for_help_topic BINARY
@example
mysql> SELECT "a" = "A";
        -> 1
mysql> SELECT BINARY "a" = "A";
        -> 0
@end example

@code{BINARY string} is a shorthand for @code{CAST(string AS BINARY)}.
@xref{Cast Functions}.
@code{BINARY} was introduced in MySQL Version 3.23.0.

Note that in some context MySQL will not be able to use the
index efficiently when you cast an indexed column to @code{BINARY}.

@end table

If you want to compare a @code{BLOB} case-insensitively you can always convert
it to uppercase before doing the comparison:

@example
SELECT 'A' LIKE UPPER(blob_col) FROM table_name;
@end example

We plan to soon introduce casting between different character sets to
make string comparison even more flexible.


@node Numeric Functions, Date and time functions, String functions, Functions
@section Numeric Functions

@menu
* Arithmetic functions::        Arithmetic Operations
* Mathematical functions::      Mathematical Functions
@end menu
@c help_category Numeric Functions@Functions

@node Arithmetic functions, Mathematical functions, Numeric Functions, Numeric Functions
@subsection Arithmetic Operations

@cindex operators, cast
The usual arithmetic operators are available. Note that in the case of
@samp{-}, @samp{+}, and @samp{*}, the result is calculated with
@code{BIGINT} (64-bit) precision if both arguments are integers!
If one of the argument is an unsigned integer, and the other argument
is also an integer, the result will be an unsigned integer.
@xref{Cast Functions}.

@cindex operations, arithmetic
@cindex arithmetic expressions

@table @code

@findex + (addition)
@findex addition (+)
@c description_for_help_topic +
@item +
Addition:
@c end_description_for_help_topic
@c example_for_help_topic +
@example
mysql> SELECT 3+5;
        -> 8
@end example

@findex - (subtraction)
@findex subtraction (-)
@c description_for_help_topic - binary
@item -
Subtraction:
@c end_description_for_help_topic
@c example_for_help_topic - binary
@example
mysql> SELECT 3-5;
        -> -2
@end example

@findex * (multiplication)
@findex multiplication (*)
@c description_for_help_topic *
@item *
Multiplication:
@c end_description_for_help_topic
@c example_for_help_topic *
@example
mysql> SELECT 3*5;
        -> 15
mysql> SELECT 18014398509481984*18014398509481984.0;
        -> 324518553658426726783156020576256.0
mysql> SELECT 18014398509481984*18014398509481984;
        -> 0
@end example

The result of the last expression is incorrect because the result of the
integer multiplication exceeds the 64-bit range of @code{BIGINT}
calculations.

@findex / (division)
@findex division (/)
@c description_for_help_topic /
@item /
Division:
@c end_description_for_help_topic
@c example_for_help_topic /
@example
mysql> SELECT 3/5;
        -> 0.60
@end example

Division by zero produces a @code{NULL} result:

@example
mysql> SELECT 102/(1-1);
        -> NULL
@end example

A division will be calculated with @code{BIGINT} arithmetic only if performed
in a context where its result is converted to an integer!

@end table


@node Mathematical functions,  , Arithmetic functions, Numeric Functions
@subsection Mathematical Functions
All mathematical functions return @code{NULL} in case of an error.

@findex mathematical functions
@findex functions, mathematical

@table @code

@findex - (unary minus)
@findex minus, unary (-)
@findex unary minus (-)
@c description_for_help_topic - unary
@item -
Unary minus. Changes the sign of the argument:
@c end_description_for_help_topic
@c example_for_help_topic - unary
@example
mysql> SELECT - 2;
        -> -2
@end example

Note that if this operator is used with a @code{BIGINT}, the return value is a
@code{BIGINT}!  This means that you should avoid using @code{-} on integers that
may have the value of @code{-2^63}!

@findex ABS()
@c description_for_help_topic ABS
@item ABS(X)
Returns the absolute value of @code{X}:
@c end_description_for_help_topic
@c example_for_help_topic ABS
@example
mysql> SELECT ABS(2);
        -> 2
mysql> SELECT ABS(-32);
        -> 32
@end example

This function is safe to use with @code{BIGINT} values.

@findex ACOS()
@c description_for_help_topic ACOS
@item ACOS(X)
Returns the arc cosine of @code{X}, that is, the value whose cosine is
@code{X}. Returns @code{NULL} if @code{X} is not in the range @code{-1} to
@code{1}:
@c end_description_for_help_topic
@c example_for_help_topic ACOS
@example
mysql> SELECT ACOS(1);
        -> 0.000000
mysql> SELECT ACOS(1.0001);
        -> NULL
mysql> SELECT ACOS(0);
        -> 1.570796
@end example

@findex ASIN()
@c description_for_help_topic ASIN
@item ASIN(X)
Returns the arc sine of @code{X}, that is, the value whose sine is
@code{X}. Returns @code{NULL} if @code{X} is not in the range @code{-1} to
@code{1}:
@c end_description_for_help_topic
@c example_for_help_topic ASIN
@example
mysql> SELECT ASIN(0.2);
        -> 0.201358
mysql> SELECT ASIN('foo');
        -> 0.000000
@end example

@findex ATAN()
@c description_for_help_topic ATAN
@item ATAN(X)
Returns the arc tangent of @code{X}, that is, the value whose tangent is
@code{X}:
@c end_description_for_help_topic
@c example_for_help_topic ATAN
@example
mysql> SELECT ATAN(2);
        -> 1.107149
mysql> SELECT ATAN(-2);
        -> -1.107149
@end example

@findex ATAN2()
@c description_for_help_topic ATAN2
@item ATAN(Y,X)
@itemx ATAN2(Y,X)
Returns the arc tangent of the two variables @code{X} and @code{Y}. It is
similar to calculating the arc tangent of @code{Y / X}, except that the
signs of both arguments are used to determine the quadrant of the
result:
@c end_description_for_help_topic
@c example_for_help_topic ATAN2
@example
mysql> SELECT ATAN(-2,2);
        -> -0.785398
mysql> SELECT ATAN2(PI(),0);
        -> 1.570796
@end example

@findex CEILING()
@c description_for_help_topic CEILING  CEIL
@item CEILING(X)
@itemx CEIL(X)
Returns the smallest integer value not less than @code{X}:
@c end_description_for_help_topic
@c example_for_help_topic CEILING
@example
mysql> SELECT CEILING(1.23);
        -> 2
mysql> SELECT CEIL(-1.23);
        -> -1
@end example

The @code{CEIL()} alias was added in version 4.0.6.

Note that the return value is converted to a @code{BIGINT}!

@findex COS()
@c description_for_help_topic COS
@item COS(X)
Returns the cosine of @code{X}, where @code{X} is given in radians:
@c end_description_for_help_topic
@c example_for_help_topic COS
@example
mysql> SELECT COS(PI());
        -> -1.000000
@end example

@findex COT()
@c description_for_help_topic COT
@item COT(X)
Returns the cotangent of @code{X}:
@c end_description_for_help_topic
@c example_for_help_topic COT
@example
mysql> SELECT COT(12);
        -> -1.57267341
mysql> SELECT COT(0);
        -> NULL
@end example

@findex CRC32()
@c description_for_help_topic CRC32
@item CRC32(expr)
Computes a cyclic redundancy check value and returns a 32-bit unsigned value.
The result is @code{NULL} if the argument is @code{NULL}.
The argument is expected be a string and will be treated as one if it is not.
@c end_description_for_help_topic
@c example_for_help_topic CRC32
@example
mysql> SELECT CRC32('MySQL');
        -> 3259397556
@end example

@code{CRC32()} is available as of MySQL 4.1.0.

@findex DEGREES()
@c description_for_help_topic DEGREES
@item DEGREES(X)
Returns the argument @code{X}, converted from radians to degrees:
@c end_description_for_help_topic
@c example_for_help_topic DEGREES
@example
mysql> SELECT DEGREES(PI());
        -> 180.000000
@end example

@findex DIV
@item DIV
@c description_for_help_topic DIV  FLOOR BIGINT
Integer division.
Similar to @code{FLOOR()} but safe with @code{BIGINT} values.
@c end_description_for_help_topic
@c example_for_help_topic DIV
@example
mysql> SELECT 5 DIV 2
        -> 2
@end example

@code{DIV} is new in MySQL 4.1.0.

@findex EXP()
@c description_for_help_topic EXP
@item EXP(X)
Returns the value of @code{e} (the base of natural logarithms) raised to
the power of @code{X}:
@c end_description_for_help_topic
@c example_for_help_topic EXP
@example
mysql> SELECT EXP(2);
        -> 7.389056
mysql> SELECT EXP(-2);
        -> 0.135335
@end example

@findex FLOOR()
@c description_for_help_topic FLOOR
@item FLOOR(X)
Returns the largest integer value not greater than @code{X}:
@c end_description_for_help_topic
@c example_for_help_topic FLOOR
@example
mysql> SELECT FLOOR(1.23);
        -> 1
mysql> SELECT FLOOR(-1.23);
        -> -2
@end example

Note that the return value is converted to a @code{BIGINT}!

@findex GREATEST()
@c description_for_help_topic GREATEST
@item GREATEST(X,Y,...)
Returns the largest (maximum-valued) argument.
The arguments are compared using the same rules as for @code{LEAST}:
@c end_description_for_help_topic
@c example_for_help_topic GREATEST
@example
mysql> SELECT GREATEST(2,0);
        -> 2
mysql> SELECT GREATEST(34.0,3.0,5.0,767.0);
        -> 767.0
mysql> SELECT GREATEST("B","A","C");
        -> "C"
@end example
In MySQL versions prior to Version 3.22.5, you can use @code{MAX()}
instead of @code{GREATEST}.


@findex LEAST()
@c description_for_help_topic LEAST
@item LEAST(X,Y,...)
With two or more arguments, returns the smallest (minimum-valued) argument.
The arguments are compared using the following rules:

@itemize @bullet
@item
If the return value is used in an @code{INTEGER} context or all arguments
are integer-valued, they are compared as integers.

@item
If the return value is used in a @code{REAL} context or all arguments are
real-valued, they are compared as reals.

@item
If any argument is a case-sensitive string, the arguments are compared
as case-sensitive strings.

@item
In other cases, the arguments are compared as case-insensitive strings:
@end itemize

@c end_description_for_help_topic
@c example_for_help_topic LEAST
@example
mysql> SELECT LEAST(2,0);
        -> 0
mysql> SELECT LEAST(34.0,3.0,5.0,767.0);
        -> 3.0
mysql> SELECT LEAST("B","A","C");
        -> "A"
@end example
In MySQL versions prior to Version 3.22.5, you can use @code{MIN()}
instead of @code{LEAST}.

Note that the above conversion rules can produce strange results in some
borderline cases:

@example
SELECT CAST(least(3600, 9223372036854775808.0) as SIGNED);
 -> -9223372036854775808
@end example

This happens because MySQL reads @code{9223372036854775808.0} in an
integer context and the integer representation is not good enough to
hold the value so it's wraps to a signed integer.

@findex LN()
@c description_for_help_topic LN
@item LN(X)
Returns the natural logarithm of @code{X}:
@c end_description_for_help_topic
@c example_for_help_topic LN
@example
mysql> SELECT LN(2);
        -> 0.693147
mysql> SELECT LN(-2);
        -> NULL
@end example

This function was added in MySQL version 4.0.3.
It is synonymous with @code{LOG(X)} in MySQL.

@findex LOG()
@c description_for_help_topic LOG
@item LOG(X)
@itemx LOG(B,X)
If called with one parameter, this function returns the natural logarithm
of @code{X}:
@c end_description_for_help_topic
@c example_for_help_topic LOG
@example
mysql> SELECT LOG(2);
        -> 0.693147
mysql> SELECT LOG(-2);
        -> NULL
@end example

If called with two parameters, this function returns the logarithm of
@code{X} for an arbitary base @code{B}:
@example
mysql> SELECT LOG(2,65536);
        -> 16.000000
mysql> SELECT LOG(1,100);
        -> NULL
@end example

The arbitrary base option was added in MySQL version 4.0.3.
@code{LOG(B,X)} is equivalent to @code{LOG(X)/LOG(B)}.

@findex LOG2()
@c description_for_help_topic LOG2
@item LOG2(X)
Returns the base-2 logarithm of @code{X}:
@c end_description_for_help_topic
@c example_for_help_topic LOG2
@example
mysql> SELECT LOG2(65536);
        -> 16.000000
mysql> SELECT LOG2(-100);
        -> NULL
@end example

@code{LOG2()} is useful for finding out how many bits a number would
require for storage.
This function was added in MySQL version 4.0.3.
In earlier versions, you can use @code{LOG(X)/LOG(2)} instead.

@findex LOG10()
@c description_for_help_topic LOG10
@item LOG10(X)
Returns the base-10 logarithm of @code{X}:
@c end_description_for_help_topic
@c example_for_help_topic LOG10
@example
mysql> SELECT LOG10(2);
        -> 0.301030
mysql> SELECT LOG10(100);
        -> 2.000000
mysql> SELECT LOG10(-100);
        -> NULL
@end example

@findex MOD()
@findex % (modulo)
@findex MOD (modulo)
@findex modulo (%)
@findex modulo (MOD)
@c description_for_help_topic %  MOD
@item MOD(N,M)
@itemx %
Modulo (like the @code{%} operator in C).
Returns the remainder of @code{N} divided by @code{M}:
@c end_description_for_help_topic
@c example_for_help_topic %
@example
mysql> SELECT MOD(234, 10);
        -> 4
mysql> SELECT 253 % 7;
        -> 1
mysql> SELECT MOD(29,9);
        -> 2
mysql> SELECT 29 MOD 9;
        -> 2
@end example

This function is safe to use with @code{BIGINT} values.
The last example works only in MySQL 4.1

@findex PI()
@c description_for_help_topic PI
@item PI()
Returns the value of PI. The default shown number of decimals is 5, but
MySQL internally uses the full double precession for PI.
@c end_description_for_help_topic
@c example_for_help_topic PI
@example
mysql> SELECT PI();
        -> 3.141593
mysql> SELECT PI()+0.000000000000000000;
        -> 3.141592653589793116
@end example

@findex POW()
@findex POWER()
@c description_for_help_topic POWER  POW
@item POW(X,Y)
@itemx POWER(X,Y)
Returns the value of @code{X} raised to the power of @code{Y}:
@c end_description_for_help_topic
@c example_for_help_topic POWER
@example
mysql> SELECT POW(2,2);
        -> 4.000000
mysql> SELECT POW(2,-2);
        -> 0.250000
@end example

@findex RADIANS()
@c description_for_help_topic RADIANS
@item RADIANS(X)
Returns the argument @code{X}, converted from degrees to radians:
@c end_description_for_help_topic
@c example_for_help_topic RADIANS
@example
mysql> SELECT RADIANS(90);
        -> 1.570796
@end example

@findex RAND()
@c description_for_help_topic RAND
@item RAND()
@itemx RAND(N)
Returns a random floating-point value in the range @code{0} to @code{1.0}.
If an integer argument @code{N} is specified, it is used as the seed value
(producing a repeatable sequence):
@c end_description_for_help_topic
@c example_for_help_topic RAND
@example
mysql> SELECT RAND();
        -> 0.9233482386203
mysql> SELECT RAND(20);
        -> 0.15888261251047
mysql> SELECT RAND(20);
        -> 0.15888261251047
mysql> SELECT RAND();
        -> 0.63553050033332
mysql> SELECT RAND();
        -> 0.70100469486881
@end example

You can't use a column with @code{RAND()} values in an @code{ORDER BY}
clause, because @code{ORDER BY} would evaluate the column multiple times.
From version 3.23 you can do:
@code{SELECT * FROM table_name ORDER BY RAND()}

This is useful to get a random sample of a set @code{SELECT * FROM
table1,table2 WHERE a=b AND c<d ORDER BY RAND() LIMIT 1000}.

Note that a @code{RAND()} in a @code{WHERE} clause will be re-evaluated
every time the @code{WHERE} is executed.

@code{RAND()} is not meant to be a perfect random generator, but instead a
fast way to generate ad hoc random numbers that will be portable between
platforms for the same MySQL version.

@findex ROUND()
@c description_for_help_topic ROUND
@item ROUND(X)
@itemx ROUND(X,D)
Returns the argument @code{X}, rounded to the nearest integer.
With two arguments, rounded to a number to @code{D} decimals.
@c end_description_for_help_topic
@c example_for_help_topic ROUND
@example
mysql> SELECT ROUND(-1.23);
        -> -1
mysql> SELECT ROUND(-1.58);
        -> -2
mysql> SELECT ROUND(1.58);
        -> 2
mysql> SELECT ROUND(1.298, 1);
        -> 1.3
mysql> SELECT ROUND(1.298, 0);
        -> 1
mysql> SELECT ROUND(23.298, -1);
        -> 20
@end example

Note that the behavior of @code{ROUND()} when the argument
is halfway between two integers depends on the C library
implementation.  Some round to the nearest even number,
always up, always down, or always toward zero.  If you need
one kind of rounding, you should use a well-defined function
such as @code{TRUNCATE()} or @code{FLOOR()} instead.

@findex SIGN()
@c description_for_help_topic SIGN
@item SIGN(X)
Returns the sign of the argument as @code{-1}, @code{0}, or @code{1}, depending
on whether @code{X} is negative, zero, or positive:
@c end_description_for_help_topic
@c example_for_help_topic SIGN
@example
mysql> SELECT SIGN(-32);
        -> -1
mysql> SELECT SIGN(0);
        -> 0
mysql> SELECT SIGN(234);
        -> 1
@end example

@findex SIN()
@c description_for_help_topic SIN
@item SIN(X)
Returns the sine of @code{X}, where @code{X} is given in radians:
@c end_description_for_help_topic
@c example_for_help_topic SIN
@example
mysql> SELECT SIN(PI());
        -> 0.000000
@end example

@findex SQRT()
@c description_for_help_topic SQRT
@item SQRT(X)
Returns the non-negative square root of @code{X}:
@c end_description_for_help_topic
@c example_for_help_topic SQRT
@example
mysql> SELECT SQRT(4);
        -> 2.000000
mysql> SELECT SQRT(20);
        -> 4.472136
@end example

@findex TAN()
@c description_for_help_topic TAN
@item TAN(X)
Returns the tangent of @code{X}, where @code{X} is given in radians:
@c end_description_for_help_topic
@c example_for_help_topic TAN
@example
mysql> SELECT TAN(PI()+1);
        -> 1.557408
@end example

@findex TRUNCATE()
@c description_for_help_topic TRUNCATE
@item TRUNCATE(X,D)
Returns the number @code{X}, truncated to @code{D} decimals.  If @code{D}
is @code{0}, the result will have no decimal point or fractional part:
@c end_description_for_help_topic
@c example_for_help_topic TRUNCATE
@example
mysql> SELECT TRUNCATE(1.223,1);
        -> 1.2
mysql> SELECT TRUNCATE(1.999,1);
        -> 1.9
mysql> SELECT TRUNCATE(1.999,0);
        -> 1
mysql> SELECT TRUNCATE(-1.999,1);
        -> -1.9
@end example

Starting from MySQL 3.23.51, all numbers are rounded toward zero.

If @code{D} is negative, the whole part of the number is zeroed out:

@example
mysql> SELECT TRUNCATE(122,-2);
       -> 100
@end example

Note that decimal numbers are normally not stored as exact numbers in
computers, but as double-precision values, so you may be fooled by the following
result:

@cindex rounding errors
@example
mysql> SELECT TRUNCATE(10.28*100,0);
       -> 1027
@end example

The above happens because 10.28 is actually stored as something like
10.2799999999999999.

@end table

@node Date and time functions, Cast Functions, Numeric Functions, Functions
@section Date and Time Functions
@c help_category Date and Time Functions@Functions

@findex date and time functions
@findex functions, date and time

This section describes the functions that can be used to manipulate
temporal values.
See @ref{Date and time types} for a description of the range of values
each date and time type has and the valid formats in which values may be
specified.

Here is an example that uses date functions.  The following query selects
all records with a @code{date_col} value from within the last 30 days:

@example
mysql> SELECT something FROM tbl_name
           WHERE TO_DAYS(NOW()) - TO_DAYS(date_col) <= 30;
@end example

(Note that the query will also select records with dates that lie in the
future.)

Functions that expect date values usually will accept datetime values
and ignore the time part. Functions that expect time values usually will
accept datetime values and ignore the date part.

Functions that return the current date or time each are evaluated only once
per query at the start of query execution. This means that multiple references
to a function such as @code{NOW()} within a single query will always produce
the same result.  This principle also applies to @code{CURDATE()},
@code{CURTIME()}, @code{UTC_DATE()}, @code{UTC_TIME()}, @code{UTC_TIMESTAMP()},
and any of their synonyms.

The return value ranges in the following function descriptions apply for
complete dates. If a date is a ``zero'' value or an incomplete date such
as @code{'2001-11-00'}, functions that extract a part of a date may return
@code{0}. For example, @code{DAYOFMONTH('2001-11-00')} returns @code{0}.

@table @code

@findex ADDDATE()
@c description_for_help_topic ADDDATE
@item ADDDATE(date,INTERVAL expr type)
@itemx ADDDATE(expr,days)

When invoked with the @code{INTERVAL} form of the second argument,
@code{ADDDATE()} is a synonym for @code{DATE_ADD()}.  The related
function @code{SUBDATE()} is a synonym for @code{DATE_SUB()}.

@example
mysql> SELECT DATE_ADD('1998-01-02', INTERVAL 31 DAY);
        -> '1998-02-02'
mysql> SELECT ADDDATE('1998-01-02', INTERVAL 31 DAY);
        -> '1998-02-02'
@end example

As of MySQL 4.1.1, the second syntax is allowed, where @code{expr} is a date
or datetime expression and @code{days} is the number of days to be added to
@code{expr}.

@example
mysql> SELECT ADDDATE('1998-01-02', 31);
        -> '1998-02-02'
@end example
@c end_description_for_help_topic

@findex ADDTIME()
@c description_for_help_topic ADDTIME
@item ADDTIME(expr,expr2)

@c TODO: DESCRIPTION. Depends on SAP/MySQL mode.

@code{ADDTIME()} adds @code{expr2} to @code{expr} and returns the result.
@code{expr} is a date or datetime expression, and @code{expr2} is a time
expression.

@c end_description_for_help_topic
@c example_for_help_topic ADDTIME
@example
mysql> SELECT ADDTIME("1997-12-31 23:59:59.999999", "1 1:1:1.000002");
        -> '1998-01-02 01:01:01.000001'
mysql> SELECT ADDTIME("01:00:00.999999", "02:00:00.999998");
        -> '03:00:01.999997'
@end example

@code{ADDTIME()} was added in MySQL 4.1.1.

@findex CURDATE()
@c description_for_help_topic CURDATE
@item CURDATE()

Returns the current date as a value in @code{'YYYY-MM-DD'} or @code{YYYYMMDD}
format, depending on whether the function is used in a string or numeric
context:

@c end_description_for_help_topic
@c example_for_help_topic CURDATE
@example
mysql> SELECT CURDATE();
        -> '1997-12-15'
mysql> SELECT CURDATE() + 0;
        -> 19971215
@end example

@findex CURRENT_DATE
@c description_for_help_topic CURRENT_DATE
@item CURRENT_DATE
@itemx CURRENT_DATE()

@code{CURRENT_DATE} and @code{CURRENT_DATE()} are synonyms for
@code{CURDATE()}.
@c end_description_for_help_topic

@findex CURTIME()
@c description_for_help_topic CURTIME
@item CURTIME()

Returns the current time as a value in @code{'HH:MM:SS'} or @code{HHMMSS}
format, depending on whether the function is used in a string or numeric
context:

@c end_description_for_help_topic
@c example_for_help_topic CURTIME
@example
mysql> SELECT CURTIME();
        -> '23:50:26'
mysql> SELECT CURTIME() + 0;
        -> 235026
@end example

@findex CURRENT_TIME
@c description_for_help_topic CURRENT_TIME
@item CURRENT_TIME
@itemx CURRENT_TIME()

@code{CURRENT_TIME} and @code{CURRENT_TIME()} are synonyms for
@code{CURTIME()}.
@c end_description_for_help_topic

@findex CURRENT_TIMESTAMP
@c description_for_help_topic CURRENT_TIMESTAMP
@item CURRENT_TIMESTAMP
@itemx CURRENT_TIMESTAMP()

@code{CURRENT_TIMESTAMP} and @code{CURRENT_TIMESTAMP()} are synonyms for
@code{NOW()}.
@c end_description_for_help_topic

@findex DATE()
@c description_for_help_topic DATE function  DATE
@item DATE(expr)

Extracts the date part of the date or datetime expression @code{expr}.

@c end_description_for_help_topic
@c example_for_help_topic DATE function
@example
mysql> SELECT DATE('2003-12-31 01:02:03');
        -> '2003-12-31'
@end example

@code{DATE()} is available as of MySQL 4.1.1.

@findex DATEDIFF()
@c description_for_help_topic DATEDIFF
@item DATEDIFF(expr,expr2)

@c TODO: DESCRIPTION. Depends on SAP/MySQL mode.

@code{DATEDIFF()} returns the number of days between the start date
@code{expr} and the end date @code{expr2}.
@code{expr} and @code{expr2} are date or date-and-time expressions.
Only the date parts of the values are used in the calculation.

@c end_description_for_help_topic
@c example_for_help_topic DATEDIFF
@example
mysql> SELECT DATEDIFF('1997-12-31 23:59:59','1997-12-30');
        -> 1
mysql> SELECT DATEDIFF('1997-11-31 23:59:59','1997-12-31');
        -> -30
@end example

@code{DATEDIFF()} was added in MySQL 4.1.1.

@findex DATE_ADD()
@findex DATE_SUB()
@c description_for_help_topic DATE OPERATIONS  DATE DATE_ADD DATE_SUB SECOND MINUTE HOUR DAY MONTH YEAR MINUTE_SECOND HOUR_MINUTE DAY_HOUR YEAR_MONTH HOUR_SECOND DAY_MINUTE DAY_SECOND INTERVAL
@item DATE_ADD(date,INTERVAL expr type)
@itemx DATE_SUB(date,INTERVAL expr type)

These functions perform date arithmetic.

As of MySQL Version 3.23, @code{INTERVAL expr type} is allowed on either
side of the @code{+} operator if the expression on the other side is a
date or datetime value.
For the @code{-} operator, @code{INTERVAL expr type} is allowed only on
the right side, because
it makes no sense to subtract a date or datetime value from an interval.
(See examples below.)

@code{date} is a @code{DATETIME} or @code{DATE} value specifying the starting
date.  @code{expr} is an expression specifying the interval value to be added
or subtracted from the starting date.  @code{expr} is a string; it may start
with a @samp{-} for negative intervals.  @code{type} is a keyword indicating
how the expression should be interpreted.
@c end_description_for_help_topic

The following table shows how the @code{type} and @code{expr} arguments
are related:

@multitable @columnfractions .35 .45
@item @code{type} @strong{Value} @tab @strong{Expected} @code{expr} @strong{Format}
@item @code{MICROSECOND}        @tab @code{MICROSECONDS}
@item @code{SECOND}             @tab @code{SECONDS}
@item @code{MINUTE}             @tab @code{MINUTES}
@item @code{HOUR}               @tab @code{HOURS}
@item @code{DAY}                @tab @code{DAYS}
@item @code{WEEK}               @tab @code{WEEKS}
@item @code{MONTH}              @tab @code{MONTHS}
@item @code{QUARTER}            @tab @code{QUARTERS}
@item @code{YEAR}               @tab @code{YEARS}
@item @code{SECOND_MICROSECOND} @tab @code{'SECONDS.MICROSECONDS'}
@item @code{MINUTE_MICROSECOND} @tab @code{'MINUTES.MICROSECONDS'}
@item @code{MINUTE_SECOND}      @tab @code{'MINUTES:SECONDS'}
@item @code{HOUR_MICROSECOND}   @tab @code{'HOURS.MICROSECONDS'}
@item @code{HOUR_SECOND}        @tab @code{'HOURS:MINUTES:SECONDS'}
@item @code{HOUR_MINUTE}        @tab @code{'HOURS:MINUTES'}
@item @code{DAY_MICROSECOND}    @tab @code{'DAYS.MICROSECONDS'}
@item @code{DAY_SECOND}         @tab @code{'DAYS HOURS:MINUTES:SECONDS'}
@item @code{DAY_MINUTE}         @tab @code{'DAYS HOURS:MINUTES'}
@item @code{DAY_HOUR}           @tab @code{'DAYS HOURS'}
@item @code{YEAR_MONTH}         @tab @code{'YEARS-MONTHS'}
@end multitable

The @code{type} values @code{DAY_MICROSECOND}, @code{HOUR_MICROSECOND},
@code{MINUTE_MICROSECOND}, @code{SECOND_MICROSECOND},
and @code{MICROSECOND} are allowed as of MySQL 4.1.1.
The values @code{QUARTER} and @code{WEEK} are allowed as of MySQL 5.0.0.

MySQL allows any punctuation delimiter in the @code{expr} format.
Those shown in the table are the suggested delimiters.  If the @code{date}
argument is a @code{DATE} value and your calculations involve only
@code{YEAR}, @code{MONTH}, and @code{DAY} parts (that is, no time parts), the
result is a @code{DATE} value.  Otherwise, the result is a @code{DATETIME}
value:

@c example_for_help_topic DATE OPERATIONS
@example
mysql> SELECT '1997-12-31 23:59:59' + INTERVAL 1 SECOND;
        -> '1998-01-01 00:00:00'
mysql> SELECT INTERVAL 1 DAY + '1997-12-31';
        -> '1998-01-01'
mysql> SELECT '1998-01-01' - INTERVAL 1 SECOND;
        -> '1997-12-31 23:59:59'
mysql> SELECT DATE_ADD('1997-12-31 23:59:59',
    ->                 INTERVAL 1 SECOND);
        -> '1998-01-01 00:00:00'
mysql> SELECT DATE_ADD('1997-12-31 23:59:59',
    ->                 INTERVAL 1 DAY);
        -> '1998-01-01 23:59:59'
mysql> SELECT DATE_ADD('1997-12-31 23:59:59',
    ->                 INTERVAL '1:1' MINUTE_SECOND);
        -> '1998-01-01 00:01:00'
mysql> SELECT DATE_SUB('1998-01-01 00:00:00',
    ->                 INTERVAL '1 1:1:1' DAY_SECOND);
        -> '1997-12-30 22:58:59'
mysql> SELECT DATE_ADD('1998-01-01 00:00:00',
    ->                 INTERVAL '-1 10' DAY_HOUR);
        -> '1997-12-30 14:00:00'
mysql> SELECT DATE_SUB('1998-01-02', INTERVAL 31 DAY);
        -> '1997-12-02'
mysql> SELECT DATE_ADD('1992-12-31 23:59:59.000002',
    ->                 INTERVAL '1.999999' SECOND_MICROSECOND);
        -> '1993-01-01 00:00:01.000001'
@end example

If you specify an interval value that is too short (does not include all the
interval parts that would be expected from the @code{type} keyword),
MySQL assumes you have left out the leftmost parts of the interval
value.  For example, if you specify a @code{type} of @code{DAY_SECOND}, the
value of @code{expr} is expected to have days, hours, minutes, and seconds
parts.  If you specify a value like @code{'1:10'}, MySQL assumes
that the days and hours parts are missing and the value represents minutes
and seconds.  In other words, @code{'1:10' DAY_SECOND} is interpreted in such
a way that it is equivalent to @code{'1:10' MINUTE_SECOND}.  This is
analogous to the way that MySQL interprets @code{TIME} values
as representing elapsed time rather than as time of day.

Note that if you add to or subtract from a date value something that
contains a time part, the result is automatically converted to a
datetime value:

@example
mysql> SELECT DATE_ADD('1999-01-01', INTERVAL 1 DAY);
        -> '1999-01-02'
mysql> SELECT DATE_ADD('1999-01-01', INTERVAL 1 HOUR);
        -> '1999-01-01 01:00:00'
@end example

If you use really malformed dates, the result is @code{NULL}. If you add
@code{MONTH}, @code{YEAR_MONTH}, or @code{YEAR} and the resulting date
has a day that is larger than the maximum day for the new month, the day is
adjusted to the maximum days in the new month:

@example
mysql> SELECT DATE_ADD('1998-01-30', interval 1 month);
        -> '1998-02-28'
@end example

Note from the preceding example that the keyword @code{INTERVAL} and the
@code{type} specifier are not case sensitive.

@findex DATE_FORMAT()
@c description_for_help_topic DATE_FORMAT
@item DATE_FORMAT(date,format)
Formats the @code{date} value according to the @code{format} string. The
following specifiers may be used in the @code{format} string:

@multitable @columnfractions .10 .65
@item @strong{Specifier} @tab @strong{Description}
@item @code{%a} @tab Abbreviated weekday name (@code{Sun}..@code{Sat})
@item @code{%b} @tab Abbreviated month name (@code{Jan}..@code{Dec})
@item @code{%c} @tab Month, numeric (@code{0}..@code{12})
@item @code{%D} @tab Day of the month with English suffix (@code{0th}, @code{1st}, @code{2nd}, @code{3rd}, etc.)
@item @code{%d} @tab Day of the month, numeric (@code{00}..@code{31})
@item @code{%e} @tab Day of the month, numeric (@code{0}..@code{31})
@item @code{%f} @tab Microseconds (@code{000000}..@code{999999})
@item @code{%H} @tab Hour (@code{00}..@code{23})
@item @code{%h} @tab Hour (@code{01}..@code{12})
@item @code{%I} @tab Hour (@code{01}..@code{12})
@item @code{%i} @tab Minutes, numeric (@code{00}..@code{59})
@item @code{%j} @tab Day of year (@code{001}..@code{366})
@item @code{%k} @tab Hour (@code{0}..@code{23})
@item @code{%l} @tab Hour (@code{1}..@code{12})
@item @code{%M} @tab Month name (@code{January}..@code{December})
@item @code{%m} @tab Month, numeric (@code{00}..@code{12})
@item @code{%p} @tab @code{AM} or @code{PM}
@item @code{%r} @tab Time, 12-hour (@code{hh:mm:ss} followed by @code{AM} or @code{PM})
@item @code{%S} @tab Seconds (@code{00}..@code{59})
@item @code{%s} @tab Seconds (@code{00}..@code{59})
@item @code{%T} @tab Time, 24-hour (@code{hh:mm:ss})
@item @code{%U} @tab Week (@code{00}..@code{53}), where Sunday is the first day of the week
@item @code{%u} @tab Week (@code{00}..@code{53}), where Monday is the first day of the week
@item @code{%V} @tab Week (@code{01}..@code{53}), where Sunday is the first day of the week; used with @code{%X}
@item @code{%v} @tab Week (@code{01}..@code{53}), where Monday is the first day of the week; used with @code{%x}
@item @code{%W} @tab Weekday name (@code{Sunday}..@code{Saturday})
@item @code{%w} @tab Day of the week (@code{0}=Sunday..@code{6}=Saturday)
@item @code{%X} @tab Year for the week where Sunday is the first day of the week, numeric, 4 digits; used with @code{%V}
@item @code{%x} @tab Year for the week, where Monday is the first day of the week, numeric, 4 digits; used with @code{%v}
@item @code{%Y} @tab Year, numeric, 4 digits
@item @code{%y} @tab Year, numeric, 2 digits
@item @code{%%} @tab A literal @samp{%}.
@end multitable

All other characters are just copied to the result without interpretation.

The @code{%f} format specifier is available as of MySQL 4.1.1.

As of MySQL Version 3.23, the @samp{%} character is required before
format specifier characters.  In earlier versions of MySQL,
@samp{%} was optional.

The reason the ranges for the month and day specifiers begin with zero
is that MySQL allows incomplete dates such as @code{'2004-00-00'} to be
stored as of MySQL 3.23.

@c end_description_for_help_topic
@c example_for_help_topic DATE_FORMAT
@example
mysql> SELECT DATE_FORMAT('1997-10-04 22:23:00', '%W %M %Y');
        -> 'Saturday October 1997'
mysql> SELECT DATE_FORMAT('1997-10-04 22:23:00', '%H:%i:%s');
        -> '22:23:00'
mysql> SELECT DATE_FORMAT('1997-10-04 22:23:00',
                          '%D %y %a %d %m %b %j');
        -> '4th 97 Sat 04 10 Oct 277'
mysql> SELECT DATE_FORMAT('1997-10-04 22:23:00',
                          '%H %k %I %r %T %S %w');
        -> '22 22 10 10:23:00 PM 22:23:00 00 6'
mysql> SELECT DATE_FORMAT('1999-01-01', '%X %V');
        -> '1998 52'
@end example

@findex DAY()
@c description_for_help_topic DAY
@item DAY(date)

@code{DAY()} is a synonym for @code{DAYOFMONTH()}.
It is available as of MySQL 4.1.1.
@c end_description_for_help_topic

@findex DAYNAME()
@c description_for_help_topic DAYNAME
@item DAYNAME(date)
Returns the name of the weekday for @code{date}:

@c end_description_for_help_topic
@c example_for_help_topic DAYNAME
@example
mysql> SELECT DAYNAME('1998-02-05');
        -> 'Thursday'
@end example

@findex DAYOFMONTH()
@c description_for_help_topic DAYOFMONTH
@item DAYOFMONTH(date)
Returns the day of the month for @code{date}, in the range @code{1} to
@code{31}:

@c end_description_for_help_topic
@c example_for_help_topic DAYOFMONTH
@example
mysql> SELECT DAYOFMONTH('1998-02-03');
        -> 3
@end example

@findex DAYOFWEEK()
@c description_for_help_topic DAYOFWEEK
@item DAYOFWEEK(date)
Returns the weekday index
for @code{date} (@code{1} = Sunday, @code{2} = Monday, ... @code{7} =
Saturday).  These index values correspond to the ODBC standard.

@c end_description_for_help_topic
@c example_for_help_topic DAYOFWEEK
@example
mysql> SELECT DAYOFWEEK('1998-02-03');
        -> 3
@end example

@findex DAYOFYEAR()
@c description_for_help_topic DAYOFYEAR
@item DAYOFYEAR(date)
Returns the day of the year for @code{date}, in the range @code{1} to
@code{366}:

@c end_description_for_help_topic
@c example_for_help_topic DAYOFYEAR
@example
mysql> SELECT DAYOFYEAR('1998-02-03');
        -> 34
@end example

@findex EXTRACT()
@c description_for_help_topic EXTRACT
@item EXTRACT(type FROM date)

The @code{EXTRACT()} function uses the same kinds of interval type
specifiers as @code{DATE_ADD()} or @code{DATE_SUB()}, but extracts parts
from the date rather than performing date arithmetic.

@c end_description_for_help_topic
@c example_for_help_topic EXTRACT
@example
mysql> SELECT EXTRACT(YEAR FROM "1999-07-02");
       -> 1999
mysql> SELECT EXTRACT(YEAR_MONTH FROM "1999-07-02 01:02:03");
       -> 199907
mysql> SELECT EXTRACT(DAY_MINUTE FROM "1999-07-02 01:02:03");
       -> 20102
mysql> SELECT EXTRACT(MICROSECOND FROM "2003-01-02 10:30:00.00123");
        -> 123
@end example

@findex FROM_DAYS()
@c description_for_help_topic FROM_DAYS
@item FROM_DAYS(N)
Given a daynumber @code{N}, returns a @code{DATE} value:

@c end_description_for_help_topic
@c example_for_help_topic FROM_DAYS
@example
mysql> SELECT FROM_DAYS(729669);
        -> '1997-10-07'
@end example

@code{FROM_DAYS()} is not intended for use with values that precede the
advent of the Gregorian calendar (1582), because it doesn't take into account
the days that were lost when the calendar was changed.

@findex FROM_UNIXTIME()
@c description_for_help_topic FROM_UNIXTIME
@item FROM_UNIXTIME(unix_timestamp)
@itemx FROM_UNIXTIME(unix_timestamp,format)
Returns a representation of the @code{unix_timestamp} argument as a value in
@code{'YYYY-MM-DD HH:MM:SS'} or @code{YYYYMMDDHHMMSS} format, depending on
whether the function is used in a string or numeric context:

@c example_for_help_topic FROM_UNIXTIME
@example
mysql> SELECT FROM_UNIXTIME(875996580);
        -> '1997-10-04 22:23:00'
mysql> SELECT FROM_UNIXTIME(875996580) + 0;
        -> 19971004222300
@end example

If @code{format} is given, the result is formatted according to the
@code{format} string. @code{format} may contain the same specifiers as
those listed in the entry for the @code{DATE_FORMAT()} function:
@c end_description_for_help_topic

@c example_for_help_topic FROM_UNIXTIME
@example
mysql> SELECT FROM_UNIXTIME(UNIX_TIMESTAMP(),
    ->                      '%Y %D %M %h:%i:%s %x');
        -> '2003 6th August 06:22:58 2003'
@end example

@findex GET_FORMAT()
@c description_for_help_topic GET_FORMAT
@item GET_FORMAT(DATE | TIME | TIMESTAMP, 'EUR' | 'USA' | 'JIS' | 'ISO' | 'INTERNAL')
Returns a format string. This function is useful in combination with the 
@code{DATE_FORMAT()} and the @code{STR_TO_DATE()} functions.
@c Following is commented out because not yet implemented
@c and when setting 
@c the server variables @code{DATE_FORMAT}, @code{TIME_FORMAT}, and 
@c @code{DATETIME_FORMAT}.
The three possible values for the first argument 
and the five possible values for the second argument result in 15 possible 
format strings (for the specifiers used, see the table in the 
@code{DATE_FORMAT()} function description):
@multitable @columnfractions .50 .50
@item @strong{Function call} @tab @strong{Result}
@item @code{GET_FORMAT(DATE,'USA')} @tab @code{'%m.%d.%Y'}
@item @code{GET_FORMAT(DATE,'JIS')} @tab @code{'%Y-%m-%d'}
@item @code{GET_FORMAT(DATE,'ISO')} @tab @code{'%Y-%m-%d'}
@item @code{GET_FORMAT(DATE,'EUR')} @tab @code{'%d.%m.%Y'}
@item @code{GET_FORMAT(DATE,'INTERNAL')} @tab @code{'%Y%m%d'}
@item @code{GET_FORMAT(TIMESTAMP,'USA')} @tab @code{'%Y-%m-%d-%H.%i.%s'}
@item @code{GET_FORMAT(TIMESTAMP,'JIS')} @tab @code{'%Y-%m-%d %H:%i:%s'}
@item @code{GET_FORMAT(TIMESTAMP,'ISO')} @tab @code{'%Y-%m-%d %H:%i:%s'}
@item @code{GET_FORMAT(TIMESTAMP,'EUR')} @tab @code{'%Y-%m-%d-%H.%i.%s'}
@item @code{GET_FORMAT(TIMESTAMP,'INTERNAL')} @tab @code{'%Y%m%d%H%i%s'}
@item @code{GET_FORMAT(TIME,'USA')} @tab @code{'%h:%i:%s %p'}
@item @code{GET_FORMAT(TIME,'JIS')} @tab @code{'%H:%i:%s'}
@item @code{GET_FORMAT(TIME,'ISO')} @tab @code{'%H:%i:%s'}
@item @code{GET_FORMAT(TIME,'EUR')} @tab @code{'%H.%i.%S'}
@item @code{GET_FORMAT(TIME,'INTERNAL')} @tab @code{'%H%i%s'}
@end multitable
ISO format is ISO 9075, not ISO 8601.
@c If the first argument of 
@c @code{GET_FORMAT()} is illegal or missing, or if the second argument 
@c is missing, the function returns an error. If the second argument is illegal, 
@c the function returns @code{NULL}.
@c end_description_for_help_topic
@c example_for_help_topic GET_FORMAT
@example
mysql> SELECT DATE_FORMAT('2003-10-03', GET_FORMAT(DATE, 'EUR')
        -> '03.10.2003'
mysql> SELECT STR_TO_DATE('10.31.2003', GET_FORMAT(DATE, 'USA'))
        -> 2003-10-31
@c Following is commented out because not yet implemented
@c mysql> SET DATE_FORMAT=GET_FORMAT(DATE, 'USA'); SELECT '2003-10-31';
@c         -> 10-31-2003
@end example
@code{GET_FORMAT()} is available as of MySQL 4.1.1.
See @xref{SET OPTION}.
@c INSERT STOP

@findex HOUR()
@c description_for_help_topic HOUR
@item HOUR(time)
Returns the hour for @code{time}. The range of the return value will be
@code{0} to @code{23} for time-of-day values:

@c end_description_for_help_topic
@c example_for_help_topic HOUR
@example
mysql> SELECT HOUR('10:05:03');
        -> 10
@end example

However, the range of @code{TIME} values actually is much larger, so
@code{HOUR} can return values greater than @code{23}:
@example

mysql> SELECT HOUR('272:59:59');
        -> 272
@end example

@findex LAST_DAY()
@c description_for_help_topic LAST_DAY
@item LAST_DAY(date)

Takes a date or datetime value and returns the corresponding value for the
last day of the month.  Returns @code{NULL} if the argument is invalid.

@c end_description_for_help_topic
@c example_for_help_topic LAST_DAY
@example
mysql> SELECT LAST_DAY('2003-02-05'), LAST_DAY('2004-02-05');
        -> '2003-02-28', '2004-02-29'
mysql> SELECT LAST_DAY('2004-01-01 01:01:01');
        -> '2004-01-31'
mysql> SELECT LAST_DAY('2003-03-32');
        -> NULL
@end example

@code{LAST_DAY()} is available as of MySQL 4.1.1.

@findex LOCALTIME
@c description_for_help_topic LOCALTIME
@item LOCALTIME
@itemx LOCALTIME()

@code{LOCALTIME} and @code{LOCALTIME()} are synonyms for
@code{NOW()}.
@c end_description_for_help_topic

@findex LOCALTIMESTAMP
@c description_for_help_topic LOCALTIMESTAMP
@item LOCALTIMESTAMP
@itemx LOCALTIMESTAMP()

@code{LOCALTIMESTAMP} and @code{LOCALTIMESTAMP()} are synonyms for
@code{NOW()}.
@c end_description_for_help_topic

@findex MAKEDATE()
@c description_for_help_topic MAKEDATE
@item MAKEDATE(year,dayofyear)

Returns a date, given year and day-of-year values.
@code{dayofyear} must be greater than 0 or the result will @code{NULL}.

@c end_description_for_help_topic
@c example_for_help_topic MAKEDATE
@example
mysql> SELECT MAKEDATE(2001,31), MAKEDATE(2001,32);
        -> '2001-01-31', '2001-02-01'
mysql> SELECT MAKEDATE(2001,365), MAKEDATE(2004,365);
        -> '2001-12-31', '2004-12-30'
mysql> SELECT MAKEDATE(2001,0);
        -> NULL
@end example

@code{MAKEDATE()} is available as of MySQL 4.1.1.

@findex MAKETIME()
@c description_for_help_topic MAKETIME
@item MAKETIME(hour,minute,second)

Returns a time value calculated from the @code{hour}, @code{minute}, and
@code{second} arguments.

@c end_description_for_help_topic
@c example_for_help_topic MAKETIME
@example
mysql> SELECT MAKETIME(12,15,30);
        -> '12:15:30'
@end example

@code{MAKETIME()} is available as of MySQL 4.1.1.

@findex MICROSECOND()
@c description_for_help_topic MICROSECOND
@item MICROSECOND(expr)

Returns the microseconds from the time or datetime expression @code{expr} as a
number in the range from @code{0} to @code{999999}.

@c end_description_for_help_topic
@c example_for_help_topic MICROSECOND
@example
mysql> SELECT MICROSECOND('12:00:00.123456');
        -> 123456
mysql> SELECT MICROSECOND('1997-12-31 23:59:59.000010');
        -> 10
@end example

@code{MICROSECOND()} is available as of MySQL 4.1.1.

@findex MINUTE()
@c description_for_help_topic MINUTE
@item MINUTE(time)
Returns the minute for @code{time}, in the range @code{0} to @code{59}:

@c end_description_for_help_topic
@c example_for_help_topic MINUTE
@example
mysql> SELECT MINUTE('98-02-03 10:05:03');
        -> 5
@end example

@findex MONTH()
@c description_for_help_topic MONTH
@item MONTH(date)
Returns the month for @code{date}, in the range @code{1} to @code{12}:

@c end_description_for_help_topic
@c example_for_help_topic MONTH
@example
mysql> SELECT MONTH('1998-02-03');
        -> 2
@end example

@findex MONTHNAME()
@c description_for_help_topic MONTHNAME
@item MONTHNAME(date)
Returns the name of the month for @code{date}:

@c end_description_for_help_topic
@c example_for_help_topic MONTHNAME
@example
mysql> SELECT MONTHNAME('1998-02-05');
        -> 'February'
@end example

@findex NOW()
@c description_for_help_topic NOW
@item NOW()

Returns the current date and time as a value in @code{'YYYY-MM-DD HH:MM:SS'}
or @code{YYYYMMDDHHMMSS} format, depending on whether the function is used in
a string or numeric context:

@c end_description_for_help_topic
@c example_for_help_topic NOW
@example
mysql> SELECT NOW();
        -> '1997-12-15 23:50:26'
mysql> SELECT NOW() + 0;
        -> 19971215235026
@end example

@findex PERIOD_ADD()
@c description_for_help_topic PERIOD_ADD
@item PERIOD_ADD(P,N)
Adds @code{N} months to period @code{P} (in the format @code{YYMM} or
@code{YYYYMM}). Returns a value in the format @code{YYYYMM}.

Note that the period argument @code{P} is @strong{not} a date value:

@c end_description_for_help_topic
@c example_for_help_topic PERIOD_ADD
@example
mysql> SELECT PERIOD_ADD(9801,2);
        -> 199803
@end example

@findex PERIOD_DIFF()
@c description_for_help_topic PERIOD_DIFF
@item PERIOD_DIFF(P1,P2)
Returns the number of months between periods @code{P1} and @code{P2}.
@code{P1} and @code{P2} should be in the format @code{YYMM} or @code{YYYYMM}.

Note that the period arguments @code{P1} and @code{P2} are @strong{not}
date values:

@c end_description_for_help_topic
@c example_for_help_topic PERIOD_DIFF
@example
mysql> SELECT PERIOD_DIFF(9802,199703);
        -> 11
@end example

@findex QUARTER()
@c description_for_help_topic QUARTER
@item QUARTER(date)
Returns the quarter of the year for @code{date}, in the range @code{1}
to @code{4}:

@c end_description_for_help_topic
@c example_for_help_topic QUARTER
@example
mysql> SELECT QUARTER('98-04-01');
        -> 2
@end example

@findex SECOND()
@c description_for_help_topic SECOND
@item SECOND(time)
Returns the second for @code{time}, in the range @code{0} to @code{59}:

@c end_description_for_help_topic
@c example_for_help_topic SECOND
@example
mysql> SELECT SECOND('10:05:03');
        -> 3
@end example

@findex SEC_TO_TIME()
@c description_for_help_topic SEC_TO_TIME
@item SEC_TO_TIME(seconds)
Returns the @code{seconds} argument, converted to hours, minutes, and seconds,
as a value in @code{'HH:MM:SS'} or @code{HHMMSS} format, depending on whether
the function is used in a string or numeric context:

@c end_description_for_help_topic
@c example_for_help_topic SEC_TO_TIME
@example
mysql> SELECT SEC_TO_TIME(2378);
        -> '00:39:38'
mysql> SELECT SEC_TO_TIME(2378) + 0;
        -> 3938
@end example

@c INSERT START
@findex STR_TO_DATE()
@c description_for_help_topic STR_TO_DATE
@item STR_TO_DATE(str,format)
This is the reverse function of the @code{DATE_FORMAT()} function. It takes a 
string @code{str}, and a format string @code{format}, and returns a 
DATETIME value.
@c NOT YET IMPLEMENTED START
@c If @code{format_str} is not specified, values are expected to be in the 
@c following format (for the specifiers used, see the table in the 
@c @code{DATE_FORMAT()} function description):
@c @multitable @columnfractions .20 .65
@c @item @strong{Type} @tab @strong{Format}
@c @item @code{DATE} @tab @code{'%Y-%m-%d'}
@c @item @code{TIME} @tab @code{'%h-%m-%s'}
@c @item @code{TIMESTAMP} @tab @code{'%Y-%m-%d %H:%i:%s'}
@c @end multitable
@c NOT YET IMPLEMENTED STOP
The date, time, or datetime values contained in @code{str} should be given 
in the format indicated by @code{format}. For the specifiers that can be 
used in @code{format}, see the table in the @code{DATE_FORMAT()} function 
description. All other characters are just taken verbatim, thus not being 
interpreted.
If @code{str} contains an illegal date, time, or datetime value, 
@code{STR_TO_DATE()} returns @code{NULL}.
@c end_description_for_help_topic
@c example_for_help_topic STR_TO_DATE
@example
@c next example commented out until format string becomes optional
@c mysql> SELECT STR_TO_DATE('2003-10-03')
@c         -> 2003-10-03 00:00:00
mysql> SELECT STR_TO_DATE('03.10.2003 09.20', '%d.%m.%Y %H.%i')
        -> 2003-10-03 09:20:00
mysql> SELECT STR_TO_DATE('10rap', '%crap')
        -> 0000-10-00 00:00:00
mysql> SELECT STR_TO_DATE('2003-15-10 00:00:00', '%Y-%m-%d %H:%i:%s')
        -> NULL
@end example
@code{STR_TO_DATE()} is available as of MySQL 4.1.1.

@findex SUBDATE()
@c description_for_help_topic SUBDATE
@item SUBDATE(date,INTERVAL expr type)
@itemx SUBDATE(expr,days)

When invoked with the @code{INTERVAL} form of the second argument,
@code{SUBDATE()} is a synonym for @code{DATE_SUB()}.

@example
mysql> SELECT DATE_SUB('1998-01-02', INTERVAL 31 DAY);
        -> '1997-12-02'
mysql> SELECT SUBDATE('1998-01-02', INTERVAL 31 DAY);
        -> '1997-12-02'
@end example

As of MySQL 4.1.1, the second syntax is allowed, where @code{expr} is a date
or datetime expression and @code{days} is the number of days to be
subtracted from @code{expr}.

@example
mysql> SELECT SUBDATE('1998-01-02 12:00:00', 31);
        -> '1997-12-02 12:00:00'
@end example
@c end_description_for_help_topic

@findex SUBTIME()
@c description_for_help_topic SUBTIME
@item SUBTIME(expr,expr2)

@c TODO: DESCRIPTION. Depends on SAP/MySQL mode.

@code{SUBTIME()} subtracts @code{expr2} from @code{expr} and returns the result.
@code{expr} is a date or datetime expression, and @code{expr2} is a time
expression.

@c end_description_for_help_topic
@c example_for_help_topic SUBTIME
@example
mysql> SELECT SUBTIME("1997-12-31 23:59:59.999999", "1 1:1:1.000002");
        -> '1997-12-30 22:58:58.999997'
mysql> SELECT SUBTIME("01:00:00.999999", "02:00:00.999998");
        -> '-00:59:59.999999'
@end example

@code{SUBTIME()} was added in MySQL 4.1.1.

@findex SYSDATE()
@c description_for_help_topic SYSDATE
@item SYSDATE()

@code{SYSDATE()} is a synonym for @code{NOW()}.
@c end_description_for_help_topic

@findex TIME()
@c description_for_help_topic TIME function  TIME
@item TIME(expr)

Extracts the time part of the time or datetime expression @code{expr}.

@c end_description_for_help_topic
@c example_for_help_topic TIME function
@example
mysql> SELECT TIME('2003-12-31 01:02:03');
        -> '01:02:03'
mysql> SELECT TIME('2003-12-31 01:02:03.000123');
        -> '01:02:03.000123'
@end example

@code{TIME()} is available as of MySQL 4.1.1.

@findex TIMEDIFF()
@c description_for_help_topic TIMEDIFF
@item TIMEDIFF(expr,expr2)

@c TODO: DESCRIPTION. Depends on SAP/MySQL mode.

@code{TIMEDIFF()} returns the time between the start time
@code{expr} and the end time @code{expr2}.
@code{expr} and @code{expr2} are time or date-and-time expressions, but both
must be of the same type.

@c end_description_for_help_topic
@c example_for_help_topic TIMEDIFF
@example
mysql> SELECT TIMEDIFF('2000:01:01 00:00:00', '2000:01:01 00:00:00.000001');
        -> '-00:00:00.000001'
mysql> SELECT TIMEDIFF('1997-12-31 23:59:59.000001','1997-12-30 01:01:01.000002');
        -> '46:58:57.999999'
@end example

@code{TIMEDIFF()} was added in MySQL 4.1.1.

@findex TIMESTAMP()
@c description_for_help_topic TIMESTAMP function  TIMESTAMP
@item TIMESTAMP(expr)
@itemx TIMESTAMP(expr,expr2)

With one argument, returns the date or datetime expression @code{expr}
as a datetime value.
With two arguments, adds the time expression @code{expr2} to the
date or datetime expression @code{expr} and returns a datetime value.

@c end_description_for_help_topic
@c example_for_help_topic TIMESTAMP function
@example
mysql> SELECT TIMESTAMP('2003-12-31');
        -> '2003-12-31 00:00:00'
mysql> SELECT TIMESTAMP('2003-12-31 12:00:00','12:00:00');
        -> '2004-01-01 00:00:00'
@end example

@code{TIMESTAMP()} is available as of MySQL 4.1.1.

@findex TIMESTAMPADD()
@c description_for_help_topic TIMESTAMPADD
@item TIMESTAMPADD(interval,int_expr,datetime_expr)

Adds the integer expression @code{int_expr} to the date or datetime expression
@code{datetime_expr}. The unit for @code{int_expr} is given by the
@code{interval} argument, which should be one of the following values:
@code{FRAC_SECOND},
@code{SECOND},
@code{MINUTE},
@code{HOUR},
@code{DAY},
@code{WEEK},
@code{MONTH},
@code{QUARTER},
or
@code{YEAR}.

The @code{interval} value may be specified using one of keywords as shown,
or with a prefix of @code{SQL_TSI_}. For example, @code{DAY} or
@code{SQL_TSI_DAY} both are legal.

@c end_description_for_help_topic
@c example_for_help_topic TIMESTAMPADD function
@example
mysql> SELECT TIMESTAMPADD(MINUTE,1,'2003-01-02');
        -> '2003-01-02 00:01:00'
mysql> SELECT TIMESTAMPADD(WEEK,1,'2003-01-02');
        -> '2003-01-09'
@end example

@code{TIMESTAMPADD()} is available as of MySQL 5.0.0.

@findex TIMESTAMPDIFF()
@c description_for_help_topic TIMESTAMPDIFF
@item TIMESTAMPDIFF(interval,datetime_expr1,datetime_expr2)

Returns the integer difference between the date or datetime expressions
@code{datetime_expr1} and
@code{datetime_expr2}. The unit for the result is given by the
@code{interval} argument. The legal values for @code{interval} are the same as
those described in the desription of the @code{TIMESTAMPADD()} function.

@c end_description_for_help_topic
@c example_for_help_topic TIMESTAMPDIFF function
@example
mysql> SELECT TIMESTAMPDIFF(MONTH,'2003-02-01','2003-05-01');
        -> 3
mysql> SELECT TIMESTAMPDIFF(YEAR,'2002-05-01','2001-01-01');
        -> -1
@end example

@code{TIMESTAMPDIFF()} is available as of MySQL 5.0.0.

@findex TIME_FORMAT()
@c description_for_help_topic TIME_FORMAT
@item TIME_FORMAT(time,format)
This is used like the @code{DATE_FORMAT()} function, but the
@code{format} string may contain only those format specifiers that handle
hours, minutes, and seconds.  Other specifiers produce a @code{NULL} value or
@code{0}.
@c end_description_for_help_topic

If the @code{time} value contains an hour part that is greater than
@code{23}, the @code{%H} and @code{%k} hour format specifiers produce a
value larger than the usual range of @code{0..23}. The other hour format
specifiers produce the hour value modulo 12:

@example
mysql> SELECT TIME_FORMAT('100:00:00', '%H %k %h %I %l');
        -> '100 100 04 04 4'
@end example

@findex TIME_TO_SEC()
@c description_for_help_topic TIME_TO_SEC
@item TIME_TO_SEC(time)
Returns the @code{time} argument, converted to seconds:

@c end_description_for_help_topic
@c example_for_help_topic TIME_TO_SEC
@example
mysql> SELECT TIME_TO_SEC('22:23:00');
        -> 80580
mysql> SELECT TIME_TO_SEC('00:39:38');
        -> 2378
@end example

@findex TO_DAYS()
@c description_for_help_topic TO_DAYS
@item TO_DAYS(date)
Given a date @code{date}, returns a daynumber (the number of days since year
0):

@c end_description_for_help_topic
@c example_for_help_topic TO_DAYS
@example
mysql> SELECT TO_DAYS(950501);
        -> 728779
mysql> SELECT TO_DAYS('1997-10-07');
        -> 729669
@end example

@code{TO_DAYS()} is not intended for use with values that precede the advent
of the Gregorian calendar (1582), because it doesn't take into account the
days that were lost when the calendar was changed.

@findex UNIX_TIMESTAMP()
@c description_for_help_topic UNIX_TIMESTAMP
@item UNIX_TIMESTAMP()
@itemx UNIX_TIMESTAMP(date)
If called with no argument, returns a Unix timestamp (seconds since
@code{'1970-01-01 00:00:00'} GMT) as an unsigned integer. If
@code{UNIX_TIMESTAMP()} is called with a @code{date} argument, it
returns the value of the argument as seconds since @code{'1970-01-01
00:00:00'} GMT.  @code{date} may be a @code{DATE} string, a
@code{DATETIME} string, a @code{TIMESTAMP}, or a number in the format
@code{YYMMDD} or @code{YYYYMMDD} in local time:

@c end_description_for_help_topic
@c example_for_help_topic UNIX_TIMESTAMP
@example
mysql> SELECT UNIX_TIMESTAMP();
        -> 882226357
mysql> SELECT UNIX_TIMESTAMP('1997-10-04 22:23:00');
        -> 875996580
@end example

When @code{UNIX_TIMESTAMP} is used on a @code{TIMESTAMP} column, the function
returns the internal timestamp value directly, with no implicit
``string-to-Unix-timestamp'' conversion.
If you pass an out-of-range date to @code{UNIX_TIMESTAMP()}, it
returns @code{0}, but please note that only basic checking is performed
(year 1970-2037, month 01-12, day 01-31).

If you want to subtract @code{UNIX_TIMESTAMP()} columns, you might want to
cast the result to signed integers. @xref{Cast Functions}.

@findex UTC_DATE()
@c description_for_help_topic UTC_DATE
@item UTC_DATE
@itemx UTC_DATE()
Returns the current UTC date as a value in @code{'YYYY-MM-DD'} or
@code{YYYYMMDD} format, depending on whether the function is used in a
string or numeric context:

@c end_description_for_help_topic
@c example_for_help_topic UTC_DATE
@example
mysql> SELECT UTC_DATE(), UTC_DATE() + 0;
        -> '2003-08-14', 20030814
@end example

@code{UTC_DATE()} is available as of MySQL 4.1.1.

@findex UTC_TIME()
@c description_for_help_topic UTC_TIME
@item UTC_TIME
@itemx UTC_TIME()
Returns the current UTC time as a value in @code{'HH:MM:SS'} or @code{HHMMSS}
format, depending on whether the function is used in a string or numeric
context:

@c end_description_for_help_topic
@c example_for_help_topic UTC_TIME
@example
mysql> SELECT UTC_TIME(), UTC_TIME() + 0;
        -> '18:07:53', 180753
@end example

@code{UTC_TIME()} is available as of MySQL 4.1.1.

@findex UTC_TIMESTAMP()
@c description_for_help_topic UTC_TIMESTAMP
@item UTC_TIMESTAMP
@itemx UTC_TIMESTAMP()
Returns the current UTC date and time as a value in @code{'YYYY-MM-DD HH:MM:SS'}
or @code{YYYYMMDDHHMMSS} format, depending on whether the function is used in
a string or numeric context:

@c end_description_for_help_topic
@c example_for_help_topic UTC_TIMESTAMP
@example
mysql> SELECT UTC_TIMESTAMP(), UTC_TIMESTAMP() + 0;
        -> '2003-08-14 18:08:04', 20030814180804
@end example

@code{UTC_TIMESTAMP()} is available as of MySQL 4.1.1.

@findex WEEK()
@c description_for_help_topic WEEK
@item WEEK(date [,mode])
The function returns the week number for @code{date}.
The two-argument form of @code{WEEK()} allows you to specify whether the week
starts on Sunday or Monday and whether the return value should be in the range
0-53 or 1-52. When @code{mode} argument is omitted the
value of a @code{default_week_format} server variable (or 0 in
MySQL 4.0 or earlier) is assumed. @xref{SET OPTION}.

The following table demonstrates how the @code{mode} argument works:

@multitable @columnfractions .10 .80
@item @strong{Value} @tab @strong{Meaning}
@item 0 @tab Week starts on Sunday; return value range is 0 to 53; week 1 is the first week that starts in this year
@item 1 @tab Week starts on Monday; return value range is 0 to 53; week 1 is the first week that has more than 3 days in this year
@item 2 @tab Week starts on Sunday; return value range is 1 to 53; week 1 is the first week that starts in this year
@item 3 @tab Week starts on Monday; return value range is 1 to 53; week 1 is the first week that has more than 3 days in this year
@item 4 @tab Week starts on Sunday; return value range is 0 to 53; week 1 is the first week that has more than 3 days in this year
@item 5 @tab Week starts on Monday; return value range is 0 to 53; week 1 is the first week that starts in this year
@item 6 @tab Week starts on Sunday; return value range is 1 to 53; week 1 is the first week that has more than 3 days in this year
@item 7 @tab Week starts on Monday; return value range is 1 to 53; week 1 is the first week that starts in this year
@end multitable

The @code{mode} value of 3 can be used as of MySQL 4.0.5.
The @code{mode} value of 4 and above can be used as of MySQL 4.0.17.

@c end_description_for_help_topic
@c example_for_help_topic WEEK
@example
mysql> SELECT WEEK('1998-02-20');
        -> 7
mysql> SELECT WEEK('1998-02-20',0);
        -> 7
mysql> SELECT WEEK('1998-02-20',1);
        -> 8
mysql> SELECT WEEK('1998-12-31',1);
        -> 53
@end example

Note: In Version 4.0, @code{WEEK(date,0)} was changed to match the
calendar in the USA.  Before that, @code{WEEK()} was calculated incorrectly
for dates in USA. (In effect, @code{WEEK(date)} and @code{WEEK(date,0)} was
incorrect for all cases.)

Note that if a date falls in the last week of the previous year, MySQL will
return 0 if you don't use 2, 3, 6, or 7
as the optional @code{mode} argument:

@example
mysql> SELECT YEAR('2000-01-01'), WEEK('2000-01-01',0);
        -> 2000, 0
@end example

One might argue that MySQL should return 52 for the @code{WEEK()}
function, because the given date actually occurs in the 52nd week of 1999.  We
decided to return 0 instead as we want the function to return ``the week
number in the given year.''  This makes the usage of the @code{WEEK()}
function reliable when combined with other functions that extract a
date part from a date.

If you would prefer the result to be evaluated with respect to the year
that contains the first day of the week for the given date, you should use
2, 3, 6, or 7 as the optional @code{mode} argument.

@example
mysql> SELECT WEEK('2000-01-01',2);
        -> 52
@end example

Alternatively, use the @code{YEARWEEK()} function:

@example
mysql> SELECT YEARWEEK('2000-01-01');
        -> 199952
mysql> SELECT MID(YEARWEEK('2000-01-01'),5,2);
        -> '52'
@end example

@findex WEEKDAY()
@c description_for_help_topic WEEKDAY
@item WEEKDAY(date)
Returns the weekday index for
@code{date} (@code{0} = Monday, @code{1} = Tuesday, ... @code{6} = Sunday):

@c end_description_for_help_topic
@c example_for_help_topic WEEKDAY
@example
mysql> SELECT WEEKDAY('1998-02-03 22:23:00');
        -> 1
mysql> SELECT WEEKDAY('1997-11-05');
        -> 2
@end example

@findex WEEKOFYEAR()
@c description_for_help_topic WEEKOFYEAR
@item WEEKOFYEAR(date)

Returns the calendar week of the date as a number in the
range from @code{1} to @code{53}.

@c end_description_for_help_topic
@c example_for_help_topic WEEKOFYEAR
@example
mysql> SELECT WEEKOFYEAR('1998-02-20');
        -> 8
@end example

@code{WEEKOFYEAR()} is available as of MySQL 4.1.1.

@findex YEAR()
@c description_for_help_topic YEAR
@item YEAR(date)
Returns the year for @code{date}, in the range @code{1000} to @code{9999}:

@c end_description_for_help_topic
@c example_for_help_topic YEAR
@example
mysql> SELECT YEAR('98-02-03');
        -> 1998
@end example

@item YEARWEEK(date)
@itemx YEARWEEK(date,start)
@c description_for_help_topic YEARWEEK
Returns year and week for a date.  The @code{start} argument works exactly
like the @code{start} argument to @code{WEEK()}.  Note that the year in the
result may be
different from the year in the date argument for the first and the last
week of the year:
@c end_description_for_help_topic


@c example_for_help_topic YEARWEEK
@example
mysql> SELECT YEARWEEK('1987-01-01');
        -> 198653
@end example

Note that the week number is different from what the @code{WEEK()}
function would return (@code{0}) for optional arguments @code{0} or @code{1},
as @code{WEEK()} then returns the week in the context of the given year.

@end table

@node Cast Functions, Other Functions, Date and time functions, Functions
@section Cast Functions

@c description_for_help_topic CAST  CONVERT SIGNED UNSIGNED BINARY CHAR DATE DATETIME TIME
The @code{CAST()} and @code{CONVERT()} functions may be used to take a
value of one type and produce a value of another type.  Their syntax is:

@findex CAST
@findex CONVERT

@example
CAST(expression AS type)
CONVERT(expression,type)
CONVERT(expr USING transcoding_name)
@end example

The @code{type} value can be one of the following:
@itemize @bullet
@item
@code{BINARY}
@item
@code{CHAR}
@item
@code{DATE}
@item
@code{DATETIME}
@item
@code{SIGNED @{INTEGER@}}
@item
@code{TIME}
@item
@code{UNSIGNED @{INTEGER@}}
@end itemize

@code{CAST()} and @code{CONVERT()} are available as of MySQL 4.0.2.
The @code{CHAR} conversion type is available as of 4.0.6.
The @code{USING} form of @code{CONVERT()} is available as of 4.1.0.

@code{CAST()} and @code{CONVERT(... USING ...)} are SQL-99 syntax.
The non-@code{USING} form of @code{CONVERT()} is ODBC syntax.

The cast functions are useful when you want to create a column with
a specific type in a @code{CREATE ... SELECT} statement:
@c end_description_for_help_topic

@example
CREATE TABLE new_table SELECT CAST('2000-01-01' AS DATE);
@end example

The functions also can be useful for sorting @code{ENUM} columns in lexical
order. Normally sorting of @code{ENUM} columns occurs using the internal
numeric values. Casting the values to @code{CHAR} results in a lexical
sort:

@c example_for_help_topic CAST
@example
SELECT enum_col FROM tbl_name ORDER BY CAST(enum_col AS CHAR);
@end example

@code{CAST(string AS BINARY)} is the same thing as @code{BINARY string}.
@code{CAST(expr AS CHAR)} treats the expression as a string with the
default character set.

@strong{NOTE}: In MysQL 4.0 the @code{CAST()} to @code{DATE},
@code{DATETIME}, or @code{TIME} only marks the column to be a specific
type but doesn't change the value of the column.

In MySQL 4.1.0 the value is converted to the correct column type when
it's sent to the user (this is a feature of how the new protocol in 4.1
sends date information to the client):

@example
mysql> SELECT CAST(NOW() AS DATE);
       -> 2003-05-26
@end example

In later MySQL versions (probably 4.1.2 or 5.0) we will fix that @code{CAST}
also changes the result if you use it as part of a more complex expression,
like @code{CONCAT("Date: ",CAST(NOW() AS DATE))}.

You should not use @code{CAST()} to extract data in different formats but
instead use string functions like @code{LEFT} or
@code{EXTRACT()}. @xref{Date and time functions}.

To cast a string to a numeric value, you don't normally have to do
anything; just use the string value as it would be a number:

@example
mysql> SELECT 1+'1';
       -> 2
@end example

If you use a number in string context, the number automatically will be
converted to a @code{BINARY} string.

@example
mysql> SELECT CONCAT("hello you ",2);
       ->  "hello you 2"
@end example

MySQL supports arithmetic with both signed and unsigned 64-bit values.
If you are using numerical operations (like @code{+}) and one of the
operands is @code{unsigned integer}, the result will be unsigned.
You can override this by using the @code{SIGNED} and @code{UNSIGNED}
cast operators to cast the operation to a signed or
unsigned 64-bit integer, respectively.

@example
mysql> SELECT CAST(1-2 AS UNSIGNED)
        -> 18446744073709551615
mysql> SELECT CAST(CAST(1-2 AS UNSIGNED) AS SIGNED);
        -> -1
@end example

Note that if either operand is a floating-point value, the result is
a floating-point value and is not affected by the above rule.
(In this context, @code{DECIMAL} values are regarded as floating-point values.)

@example
mysql> SELECT CAST(1 AS UNSIGNED) - 2.0;
        -> -1.0
@end example

If you are using a string in an arithmetic operation, this is converted
to a floating-point number.

The handing of unsigned values was changed in MySQL 4.0 to be able to
support @code{BIGINT} values properly. If you have some code that you
want to run in both MySQL 4.0 and 3.23 (in which case you probably can't
use the @code{CAST()} function), you can use the following technique to get
a signed result when subtracting two unsigned integer columns:

@example
SELECT (unsigned_column_1+0.0)-(unsigned_column_2+0.0);
@end example

The idea is that the columns are converted to floating-point values before
the subtraction occurs.

If you get a problem with @code{UNSIGNED} columns in your old MySQL
application when porting to MySQL 4.0, you can use the
@code{--sql-mode=NO_UNSIGNED_SUBTRACTION} option when starting
@code{mysqld}.  Note however that as long as you use this, you will not
be able to make efficient use of the @code{BIGINT UNSIGNED} column type.

@code{CONVERT()} with @code{USING} is used to convert data between different
character sets.  In MySQL, transcoding names are the same as the
corresponding character set names.  For example, this statement converts
the string @code{'abc'} in the server's default character set to the
corresponding string in the @code{utf8} character set:

@example
SELECT CONVERT('abc' USING utf8);
@end example

@node Other Functions, Group by functions and modifiers, Cast Functions, Functions
@section Other Functions

@menu
* Bit functions::               Bit Functions
* Encryption functions::        Encryption Functions
* Information functions::       Information Functions
* Miscellaneous functions::     Miscellaneous Functions
@end menu
@c help_category Bit Functions@Functions

@node Bit functions, Encryption functions, Other Functions, Other Functions
@subsection Bit Functions

@findex arithmetic functions
@findex functions, arithmetic
@findex functions, bit

MySQL uses @code{BIGINT} (64-bit) arithmetic for bit operations, so
these operators have a maximum range of 64 bits.

@table @code

@findex | (bitwise OR)
@c description_for_help_topic |
@findex OR, bitwise
@item |
Bitwise OR
@c end_description_for_help_topic
@c example_for_help_topic |
@example
mysql> SELECT 29 | 15;
        -> 31
@end example

The result is an unsigned 64-bit integer.

@findex & (bitwise AND)
@c description_for_help_topic &
@findex AND, bitwise
@item &
Bitwise AND
@c end_description_for_help_topic
@c example_for_help_topic &
@example
mysql> SELECT 29 & 15;
        -> 13
@end example

The result is an unsigned 64-bit integer.

@findex ^ (bitwise XOR)
@c description_for_help_topic ^
@findex XOR, bitwise
@item ^
Bitwise XOR
@c end_description_for_help_topic
@c example_for_help_topic ^
@example
mysql> SELECT 1 ^ 1;
        -> 0
mysql> SELECT 1 ^ 0;
        -> 1
mysql> SELECT 11 ^ 3;
        -> 8
@end example

The result is an unsigned 64-bit integer.

@code{XOR} was added in version 4.0.2.

@findex << (left shift)
@c description_for_help_topic <<
@item <<
Shifts a longlong (@code{BIGINT}) number to the left:
@c end_description_for_help_topic
@c example_for_help_topic <<
@example
mysql> SELECT 1 << 2;
        -> 4
@end example

The result is an unsigned 64-bit integer.

@findex >> (right shift)
@c description_for_help_topic >>
@item >>
Shifts a longlong (@code{BIGINT}) number to the right:
@c end_description_for_help_topic
@c example_for_help_topic >>
@example
mysql> SELECT 4 >> 2;
        -> 1
@end example

The result is an unsigned 64-bit integer.

@findex ~
@c description_for_help_topic ~
@item ~
Invert all bits:
@c end_description_for_help_topic
@c example_for_help_topic ~
@example
mysql> SELECT 5 & ~1;
        -> 4
@end example

The result is an unsigned 64-bit integer.

@findex BIT_COUNT()
@c description_for_help_topic BIT_COUNT
@item BIT_COUNT(N)
Returns the number of bits that are set in the argument @code{N}:
@c end_description_for_help_topic
@c example_for_help_topic BIT_COUNT
@example
mysql> SELECT BIT_COUNT(29);
        -> 4
@end example

@end table


@node Encryption functions, Information functions, Bit functions, Other Functions
@subsection Encryption Functions

@findex encryption functions
@findex functions, encryption
@c help_category Encryption Functions@Functions

@table @code

@findex AES_ENCRYPT()
@findex AES_DECRYPT()
@c description_for_help_topic AES_DECRYPT  AES_ENCRYPT
@item AES_ENCRYPT(string,key_string)
@itemx AES_DECRYPT(string,key_string)
These functions allow encryption/decryption of data using the official
AES (Advanced Encryption Standard) algorithm, previously known as Rijndael.
Encoding with a 128-bit key length is used, but you can extend it up to
256 bits by modifying the source. We chose 128 bits because it is much
faster and it is usually secure enough.

The input arguments may be any length. If either argument is @code{NULL},
the result of this function is also @code{NULL}.

Because AES is a block-level algorithm, padding is used to encode uneven length
strings and so the result string length may be calculated as
16*(trunc(string_length/16)+1).

If @code{AES_DECRYPT()} detects invalid data or incorrect padding, it
returns @code{NULL}. However, it is possible for @code{AES_DECRYPT()}
to return a non-@code{NULL} value (possibly garbage) if the input data or
the key is invalid.

You can use the AES functions to store data in an encrypted form by
modifying your queries:
@c end_description_for_help_topic

@c example_for_help_topic AES_DECRYPT
@example
INSERT INTO t VALUES (1,AES_ENCRYPT('text','password'));
@end example

You can get even more security by not transferring the key over the
connection for each query, which can be accomplished by storing it in a
server-side variable at connection time. For example:
@example
SELECT @@password:='my password';
INSERT INTO t VALUES (1,AES_ENCRYPT('text',@@password));
@end example

@code{AES_ENCRYPT()} and @code{AES_DECRYPT()} were added in version 4.0.2,
and can be considered the most cryptographically secure encryption
functions currently available in MySQL.

@findex DECODE()
@c description_for_help_topic DECODE
@item DECODE(crypt_str,pass_str)
Descrypts the encrypted string @code{crypt_str} using @code{pass_str} as the
password.  @code{crypt_str} should be a string returned from
@code{ENCODE()}.
@c end_description_for_help_topic

@findex ENCODE()
@c description_for_help_topic ENCODE
@item ENCODE(str,pass_str)
Encrypt @code{str} using @code{pass_str} as the password.
To decrypt the result, use @code{DECODE()}.

The result is a binary string of the same length as @code{string}.
If you want to save it in a column, use a @code{BLOB} column type.
@c end_description_for_help_topic

@findex DES_DECRYPT()
@c description_for_help_topic DES_DECRYPT
@item DES_DECRYPT(string_to_decrypt [, key_string])

Decrypts a string encrypted with @code{DES_ENCRYPT()}.

Note that this function works only if MySQL has been configured with
SSL support. @xref{Secure connections}.

If no @code{key_string} argument is given, @code{DES_DECRYPT()} examines
the first byte of the encrypted string to determine the DES key number
that was used to encrypt the original string, and then reads the key
from the @code{des-key-file} to decrypt the message.  For this to work,
the user must have the @code{SUPER} privilege.

If you pass this function a @code{key_string} argument, that string
is used as the key for decrypting the message.

If the @code{string_to_decrypt} doesn't look like an encrypted string, MySQL
will return the given @code{string_to_decrypt}.

On error, this function returns @code{NULL}.
@c end_description_for_help_topic

@findex DES_ENCRYPT()
@c description_for_help_topic DES_ENCRYPT
@item DES_ENCRYPT(string_to_encrypt [, (key_number | key_string) ] )

Encrypts the string with the given key using the Triple-DES algorithm.

Note that this function works only if MySQL has been configured with
SSL support. @xref{Secure connections}.

The encryption key to use is chosen the following way:

@multitable @columnfractions .25 .65
@item @strong{Argument} @tab @strong{Description}
@item Only one argument @tab
The first key from @code{des-key-file} is used.
@item key number @tab
The given key (0-9) from the @code{des-key-file} is used.
@item string @tab
The given @code{key_string} will be used to crypt @code{string_to_encrypt}.
@end multitable

The return string will be a binary string where the first character
will be @code{CHAR(128 | key_number)}.

The 128 is added to make it easier to recognize an encrypted key.
If you use a string key, @code{key_number} will be 127.

On error, this function returns @code{NULL}.

The string length for the result will be
@code{new_length= org_length + (8-(org_length % 8))+1}.

The @code{des-key-file} has the following format:

@c end_description_for_help_topic
@c example_for_help_topic DES_ENCRYPT
@example
key_number des_key_string
key_number des_key_string
@end example

Each @code{key_number} must be a number in the range from 0 to 9.  Lines in
the file may be in any order.  @code{des_key_string} is the string that
will be used to encrypt the message.  Between the number and the key there
should be at least one space.  The first key is the default key that will
be used if you don't specify any key argument to @code{DES_ENCRYPT()}

You can tell MySQL to read new key values from the key file with the
@code{FLUSH DES_KEY_FILE} command.  This requires the @code{Reload_priv}
privilege.

One benefit of having a set of default keys is that it gives applications
a way to check for the existence of encrypted column values, without giving
the end user the right to decrypt those values.

@example
mysql> SELECT customer_address FROM customer_table WHERE
       crypted_credit_card = DES_ENCRYPT("credit_card_number");
@end example


@findex ENCRYPT()
@c description_for_help_topic ENCRYPT
@item ENCRYPT(str[,salt])
Encrypt @code{str} using the Unix @code{crypt()} system call. The
@code{salt} argument should be a string with two characters.
(As of MySQL Version 3.22.16, @code{salt} may be longer than two characters.)

@c end_description_for_help_topic
@c example_for_help_topic ENCRYPT
@example
mysql> SELECT ENCRYPT("hello");
        -> 'VxuFAJXVARROc'
@end example

@code{ENCRYPT()} ignores all but the first 8 characters of @code{str}, at
least on some systems.  This behavior is determined by the implementation
of the underlying @code{crypt()} system call.

If @code{crypt()} is not available on your system, @code{ENCRYPT()} always
returns @code{NULL}.  Because of this we recommend that you use @code{MD5()}
or @code{SHA1()} instead; these two functions exist on all platforms.

@findex MD5()
@c description_for_help_topic MD5
@item MD5(string)
Calculates an MD5 128-bit checksum for the string. The value is returned
as a 32-digit hex number that may, for example, be used as a hash key:

@c end_description_for_help_topic
@c example_for_help_topic MD5
@example
mysql> SELECT MD5("testing");
        -> 'ae2b1fca515949e5d54fb22b8ed95575'
@end example

This is the "RSA Data Security, Inc. MD5 Message-Digest Algorithm".

@findex PASSWORD()
@findex OLD_PASSWORD()
@c description_for_help_topic OLD_PASSWORD
@item PASSWORD(str)
@itemx OLD_PASSWORD(str)
Calculates a password string from the plaintext password @code{str}. This is
the function that is used for encrypting MySQL passwords for storage
in the @code{Password} column of the @code{user} grant table:

@c end_description_for_help_topic
@c example_for_help_topic OLD_PASSWORD
@example
mysql> SELECT PASSWORD('badpwd');
        -> '7f84554057dd964b'
@end example

@cindex password encryption, reversibility of
@code{PASSWORD()} encryption is irreversible.

@code{PASSWORD()} does not perform password encryption in the same way that
Unix passwords are encrypted. See @code{ENCRYPT()}.

@strong{Note:}
The @code{PASSWORD()} function is used by the authentication system in
MySQL Server, you should @strong{NOT} use it in your own applications.
For that purpose, use @code{MD5()} or @code{SHA1()} instead.
Also see @code{RFC-2195} for more information about handling passwords
and authentication securely in your application.

@findex SHA1()
@findex SHA()
@c description_for_help_topic SHA  SHA1
@item SHA1(string)
@itemx SHA(string)
Calculates an SHA1 160-bit checksum for the string, as described in
RFC 3174 (Secure Hash Algorithm). The value is returned as a 40-digit
hex number, or @code{NULL} in case the input argument was @code{NULL}.
One of the possible uses for this function is as a hash key. You can
also use it as cryptographically safe function for storing passwords.

@c end_description_for_help_topic
@c example_for_help_topic SHA
@example
mysql> SELECT SHA1("abc");
        -> 'a9993e364706816aba3e25717850c26c9cd0d89d'
@end example

@code{SHA1()} was added in version 4.0.2, and can be considered
a cryptographically more secure equivalent of @code{MD5()}.
@code{SHA()} is synonym for @code{SHA1()}.

@end table


@node Information functions, Miscellaneous functions, Encryption functions, Other Functions
@subsection Information Functions

@findex information functions
@findex functions, information
@c help_category Information Functions@Functions

@table @code

@findex BENCHMARK()
@c description_for_help_topic BENCHMARK
@item BENCHMARK(count,expr)
The @code{BENCHMARK()} function executes the expression @code{expr}
repeatedly @code{count} times.  It may be used to time how fast MySQL
processes the expression.  The result value is always @code{0}.  The intended
use is in the @code{mysql} client, which reports query execution times:
@c end_description_for_help_topic

@c example_for_help_topic BENCHMARK
@example
mysql> SELECT BENCHMARK(1000000,ENCODE("hello","goodbye"));
+----------------------------------------------+
| BENCHMARK(1000000,ENCODE("hello","goodbye")) |
+----------------------------------------------+
|                                            0 |
+----------------------------------------------+
1 row in set (4.74 sec)
@end example

The time reported is elapsed time on the client end, not CPU time on the
server end.  It may be advisable to execute @code{BENCHMARK()} several
times, and interpret the result with regard to how heavily loaded the
server machine is.

@findex CHARSET()
@c description_for_help_topic CHARSET
@item CHARSET(str)
Returns the character set of the string argument.
@c end_description_for_help_topic

@c example_for_help_topic CHARSET
@example
mysql> SELECT CHARSET(_utf8'abc');
        -> 'utf8'
@end example

@code{CHARSET()} was added in version 4.1.0.

@findex COERCIBILITY()
@c description_for_help_topic COERCIBILITY
@item COERCIBILITY(str)
Returns the collation coercibility value of the string argument.
@c end_description_for_help_topic

@c example_for_help_topic COERCIBILITY
@example
mysql> SELECT COERCIBILITY('abc' COLLATE latin1_swedish_ci);
        -> 0
mysql> SELECT COERCIBILITY('abc');
        -> 3
mysql> SELECT COERCIBILITY(USER());
        -> 2
@end example

The return values have the following meanings:

@multitable @columnfractions .15 .30
@item @code{0} @tab Explicit collation
@item @code{1} @tab No collation
@item @code{2} @tab Implicit collation
@item @code{3} @tab Coercible
@end multitable

Lower values have higher precedence.

@code{COERCIBILITY()} was added in version 4.1.1.

@findex COLLATION()
@c description_for_help_topic COLLATION
@item COLLATION(str)
Returns the collation for the character set of the string argument.
@c end_description_for_help_topic

@c example_for_help_topic COLLATION
@example
mysql> SELECT COLLATION('abc');
        -> 'latin1_swedish_ci'
mysql> SELECT COLLATION(_utf8'abc');
        -> 'utf8_general_ci'
@end example

@code{COLLATION()} was added in version 4.1.0.

@findex CONNECTION_ID()
@c description_for_help_topic CONNECTION_ID
@item CONNECTION_ID()
Returns the connection ID (thread ID) for the connection.
Every connection has its own unique ID:

@c end_description_for_help_topic
@c example_for_help_topic CONNECTION_ID
@example
mysql> SELECT CONNECTION_ID();
        -> 23786
@end example

@findex CURRENT_USER()
@c description_for_help_topic CURRENT_USER
@item CURRENT_USER()
Returns the username and hostname that the current session was authenticated
as. This value corresponds to the account that is used for assessing your
access privileges. It may be different than the value of @code{USER()}.

@c end_description_for_help_topic
@c example_for_help_topic CURRENT_USER
@example
mysql> SELECT USER();
        -> 'davida@@localhost'
mysql> SELECT * FROM mysql.user;
        -> ERROR 1044: Access denied for user: '@@localhost' to database 'mysql'
mysql> SELECT CURRENT_USER();
        -> '@@localhost'
@end example

The example illustrates that although the client specified a username of
@code{davida} (as indicated by the value of the @code{USER()} function),
the server authenticated the client using an anonymous user account (as seen by
the empty username part of the @code{CURRENT_USER()} value). One way this might
occur is that there is no account listed in the grant tables for
@code{davida}.

@findex DATABASE()
@c description_for_help_topic DATABASE
@item DATABASE()
Returns the current database name:

@c end_description_for_help_topic
@c example_for_help_topic DATABASE
@example
mysql> SELECT DATABASE();
        -> 'test'
@end example

If there is no current database, @code{DATABASE()} returns @code{NULL} as
of MySQL 4.1.1, and the empty string before that.


@findex FOUND_ROWS()
@findex LIMIT
@item FOUND_ROWS()
@c description_for_help_topic FOUND_ROWS

A @code{SELECT} statement may include a @code{LIMIT} clause to restrict the
number of rows the server returns to the client.
In some cases, it is desirable to know how many rows the statement would have
returned without the @code{LIMIT}, but without running the statement again.
To get this row count, include a @code{SQL_CALC_FOUND_ROWS} option in the
@code{SELECT} statement, then invoke @code{FOUND_ROWS()} afterward:
@c end_description_for_help_topic

@c example_for_help_topic FOUND_ROWS
@example
mysql> SELECT SQL_CALC_FOUND_ROWS * FROM tbl_name
       WHERE id > 100 LIMIT 10;
mysql> SELECT FOUND_ROWS();
@end example

The second @code{SELECT} will return a number indicating how many rows the
first @code{SELECT} would have returned had it been written without the
@code{LIMIT} clause.
(If the preceding @code{SELECT} statement does not include the
@code{SQL_CALC_FOUND_ROWS} option, then @code{FOUND_ROWS()} may return
a different result when @code{LIMIT} is used than when it is not.)

Note that if you are using @code{SELECT SQL_CALC_FOUND_ROWS ...} MySQL has
to calculate how many rows are in the full result set.  However, this is
faster than running the query again without @code{LIMIT}, because the result
set need not be sent to the client.

@code{SQL_CALC_FOUND_ROWS} and @code{FOUND_ROWS()} can be useful in situations
when you want to restrict the number of rows that a query returns, but also
determine the number of rows in the full result set without running the query
again. An example is a web script that presents a paged display containing
links to the pages that show other sections of a search result. Using
@code{FOUND_ROWS()} allows you to determine how many other pages are needed
for the rest of the result.

The use of @code{SQL_CALC_FOUND_ROWS} and @code{FOUND_ROWS()} is more complex
for @code{UNION} queries than for simple @code{SELECT} statements, because
@code{LIMIT} may occur at multiple places in a @code{UNION}. It may be applied
to individual @code{SELECT} statements in the @code{UNION}, or global to the
@code{UNION} result as a whole.

The intent of @code{SQL_CALC_FOUND_ROWS} for @code{UNION} is that it should
return the row count that would be returned without a global @code{LIMIT}.
The conditions for use of @code{SQL_CALC_FOUND_ROWS} with @code{UNION} are:

@itemize @bullet

@item
The @code{SQL_CALC_FOUND_ROWS} keyword must appear in the first @code{SELECT}
of the @code{UNION}.

@item
The value of @code{FOUND_ROWS()} is exact only if @code{UNION ALL} is used.
If @code{UNION} without @code{ALL} is used, duplicate removal occurs and the
value of @code{FOUND_ROWS()} is only approximate.

@item
If no @code{LIMIT} is present in the @code{UNION}, @code{SQL_CALC_FOUND_ROWS}
is ignored and returns the number of rows in the temporary table that is
created to process the @code{UNION}.

@end itemize

@code{SQL_CALC_FOUND_ROWS} and @code{FOUND_ROWS()} are available starting
at MySQL version 4.0.0.

@findex LAST_INSERT_ID([expr])
@c description_for_help_topic LAST_INSERT_ID
@item LAST_INSERT_ID([expr])
Returns the last automatically @strong{generated} value that was inserted into
an @code{AUTO_INCREMENT} column.

@c end_description_for_help_topic
@c example_for_help_topic LAST_INSERT_ID
@example
mysql> SELECT LAST_INSERT_ID();
        -> 195
@end example

The last ID that was generated is maintained in the server on a
per-connection basis. This means the value the function returns to a given
client is the most recent @code{AUTO_INCREMENT} value generated by that
client. The value cannot be affected by other clients, even if they generate
@code{AUTO_INCREMENT} values of their own. This behavior ensures that you can
retrieve your own ID without concern for the activity of other clients, and
without the need for locks or transactions.

The value of @code{LAST_INSERT_ID()} is not changed if you
update the @code{AUTO_INCREMENT} column of a row with a
non-magic value (that is, a value that is not @code{NULL} and not @code{0}).

If you insert many rows at the same time with an insert statement,
@code{LAST_INSERT_ID()} returns the value for the first inserted row.
The reason for this is to make it possible to easily reproduce
the same @code{INSERT} statement against some other server.

@cindex sequence emulation
If @code{expr} is given as an argument to @code{LAST_INSERT_ID()}, then
the value of the argument is returned by the function, and is set as the
next value to be returned by @code{LAST_INSERT_ID()}.  This can be used
to simulate sequences:

First create the table:

@example
mysql> CREATE TABLE sequence (id INT NOT NULL);
mysql> INSERT INTO sequence VALUES (0);
@end example

Then the table can be used to generate sequence numbers like this:

@example
mysql> UPDATE sequence SET id=LAST_INSERT_ID(id+1);
@end example

You can generate sequences without calling @code{LAST_INSERT_ID()}, but the
utility of using the function this way is that the ID value is maintained in
the server as the last automatically generated value (multi-user safe).
You can retrieve the new ID as you would read any normal
@code{AUTO_INCREMENT} value in MySQL. For example, @code{LAST_INSERT_ID()}
(without an argument) will return the new ID.  The C API function
@code{mysql_insert_id()} can also be used to get the value.

Note that @code{mysql_insert_id()} is only updated after @code{INSERT}
and @code{UPDATE} statements, so you can't use the C API function to
retrieve the value for @code{LAST_INSERT_ID(expr)} after executing other
SQL statements like @code{SELECT} or @code{SET}.
@xref{mysql_insert_id,, @code{mysql_insert_id()}}.

@findex SESSION_USER()
@c description_for_help_topic SESSION_USER
@item SESSION_USER()

@code{SESSION_USER()} is a synonym for @code{USER()}.
@c end_description_for_help_topic

@findex SYSTEM_USER()
@c description_for_help_topic SYSTEM_USER
@item SYSTEM_USER()

@code{SYSTEM_USER()} is a synonym for @code{USER()}.
@c end_description_for_help_topic

@findex USER()
@c description_for_help_topic USER
@item USER()

Returns the current MySQL username and hostname:

@c end_description_for_help_topic
@c example_for_help_topic USER
@example
mysql> SELECT USER();
        -> 'davida@@localhost'
@end example

The value indicates the username you specified when connecting to
the server, and the client host from which you connected.  (Prior
to MySQL Version 3.22.11, the function value does not include the
client hostname.)

You can extract just the username part, regardless of whether the
value includes a hostname part, like this:

@example
mysql> SELECT SUBSTRING_INDEX(USER(),'@@',1);
        -> 'davida'
@end example

@findex VERSION()
@c description_for_help_topic VERSION
@item VERSION()
Returns a string indicating the MySQL server version:

@c end_description_for_help_topic
@c example_for_help_topic VERSION
@example
mysql> SELECT VERSION();
        -> '3.23.13-log'
@end example

Note that if your version ends with @code{-log} this means that logging is
enabled.

@end table


@node Miscellaneous functions,  , Information functions, Other Functions
@subsection Miscellaneous Functions

@findex miscellaneous functions
@findex functions, miscellaneous
@c help_category Miscellaneous Functions@Functions

@table @code

@findex FORMAT()
@c description_for_help_topic FORMAT
@item FORMAT(X,D)
Formats the number @code{X} to a format like @code{'#,###,###.##'}, rounded
to @code{D} decimals, and returns the result as a string.
If @code{D} is @code{0}, the result will have no
decimal point or fractional part:

@c end_description_for_help_topic
@c example_for_help_topic FORMAT
@example
mysql> SELECT FORMAT(12332.123456, 4);
        -> '12,332.1235'
mysql> SELECT FORMAT(12332.1,4);
        -> '12,332.1000'
mysql> SELECT FORMAT(12332.2,0);
        -> '12,332'
@end example

@cindex timeout
@findex GET_LOCK()
@c description_for_help_topic GET_LOCK
@item GET_LOCK(str,timeout)
Tries to obtain a lock with a name given by the string @code{str}, with a
timeout of @code{timeout} seconds.  Returns @code{1} if the lock was obtained
successfully, @code{0} if the attempt timed out (for example, because another
client has already locked the name), or @code{NULL} if an error
occurred (such as running out of memory or the thread was killed with
@code{mysqladmin kill}).  A lock is released when you execute
@code{RELEASE_LOCK()}, execute a new @code{GET_LOCK()}, or the thread
terminates (either normally or abnormally).

This function can be used to implement application locks or to
simulate record locks.  Names are locked on a server-wide basis.
If a name has been locked by one client, @code{GET_LOCK()} blocks
any request by another client for a lock with the same name. This
allows clients that agree on a given lock name to use the name to
perform cooperative advisory locking:


@c end_description_for_help_topic
@c example_for_help_topic GET_LOCK
@example
mysql> SELECT GET_LOCK('lock1',10);
        -> 1
mysql> SELECT IS_FREE_LOCK('lock2');
        -> 1
mysql> SELECT GET_LOCK('lock2',10);
        -> 1
mysql> SELECT RELEASE_LOCK('lock2');
        -> 1
mysql> SELECT RELEASE_LOCK('lock1');
        -> NULL
@end example

Note that the second @code{RELEASE_LOCK()} call returns @code{NULL} because
the lock @code{'lock1'} was automatically released by the second
@code{GET_LOCK()} call.

@findex INET_ATON()
@c description_for_help_topic INET_ATON
@item INET_ATON(expr)
Given the dotted-quad representation of a network address as a string,
returns an integer that represents the numeric value of the address.
Addresses may be 4 or 8 byte addresses:

@c end_description_for_help_topic
@c example_for_help_topic INET_ATON
@example
mysql> SELECT INET_ATON('209.207.224.40');
       ->  3520061480
@end example

The generated number is always in network byte order; for example the
above number is calculated as @code{209*256^3 + 207*256^2 + 224*256 +40}.

As of MySQL 4.1.2, @code{INET_ATON()} also understands short-form IP
addresses:

@example
mysql> SELECT INET_ATON('127.0.0.1'), INET_ATON('127.1');
        -> 2130706433, 2130706433
@end example

@findex INET_NTOA()
@c description_for_help_topic INET_NTOA
@item INET_NTOA(expr)
Given a numeric network address (4 or 8 byte), returns the dotted-quad
representation of the address as a string:

@c end_description_for_help_topic
@c example_for_help_topic INET_NTOA
@example
mysql> SELECT INET_NTOA(3520061480);
       ->  "209.207.224.40"
@end example

@findex IS_FREE_LOCK()
@c description_for_help_topic IS_FREE_LOCK
@item IS_FREE_LOCK(str)
Checks if the lock named @code{str} is free to use (that is, not locked).
Returns @code{1} if the lock is free (no one is using the lock),
@code{0} if the lock is in use, and
@code{NULL} on errors (such as incorrect arguments).
@c end_description_for_help_topic

@code{IS_FREE_LOCK()} was added in MySQL version 4.0.2.

@findex IS_USED_LOCK()
@c description_for_help_topic IS_USED_LOCK
@item IS_USED_LOCK(str)
Checks if the lock named @code{str} is in use (that is, locked).
If so, it returns the connection identifier of the client that holds
the lock.
Otherwise, it returns @code{NULL}.
@c end_description_for_help_topic

@code{IS_USED_LOCK()} was added in MySQL version 4.1.0.


@findex MASTER_POS_WAIT()
@c description_for_help_topic MASTER_POS_WAIT
@item MASTER_POS_WAIT(log_name, log_pos [, timeout])

Blocks until the slave reaches (that is, has read and applied all updates up
to) the specified position in the master log. If master information is
not initialized, or if the arguments are incorrect, returns
@code{NULL}. If the slave is not running, will block and wait until it
is started and goes to or past the specified position. If the slave is
already past the specified position, returns immediately.
@c end_description_for_help_topic

If @code{timeout} (new in 4.0.10) is specified, will give up waiting
when @code{timeout} seconds have elapsed. @code{timeout} must be greater
than 0; a zero or negative @code{timeout} means no timeout.  The return
value is the number of log events it had to wait to get to the specified
position, or @code{NULL} in case of error, or @code{-1} if the timeout
has been exceeded.

This command is useful for control of master/slave synchronization.

@findex RELEASE_LOCK()
@c description_for_help_topic RELEASE_LOCK
@item RELEASE_LOCK(str)
Releases the lock named by the string @code{str} that was obtained with
@code{GET_LOCK()}. Returns @code{1} if the lock was released, @code{0} if the
lock wasn't locked by this thread (in which case the lock is not released),
and @code{NULL} if the named lock didn't exist.  (The lock will not exist if
it was never obtained by a call to @code{GET_LOCK()} or if it already has
been released.)

The @code{DO} statement is convenient to use with @code{RELEASE_LOCK()}.
@xref{DO}.
@c end_description_for_help_topic

@end table


@node Group by functions and modifiers,  , Other Functions, Functions
@section Functions and Modifiers for Use with @code{GROUP BY} Clauses
@c help_category Functions and Modifiers for Use with GROUP BY Clauses@Functions

@menu
* GROUP-BY-Functions::          @code{GROUP BY} Functions
* GROUP-BY-Modifiers::          @code{GROUP BY} Modifiers
* GROUP-BY-hidden-fields::      @code{GROUP BY} with Hidden Fields
@end menu

@node GROUP-BY-Functions, GROUP-BY-Modifiers, Group by functions and modifiers, Group by functions and modifiers
@subsection @code{GROUP BY} Functions

@findex GROUP BY functions
@findex functions, GROUP BY

If you use a group function in a statement containing no @code{GROUP BY}
clause, it is equivalent to grouping on all rows.

@table @code

@findex AVG()
@c description_for_help_topic AVG
@item AVG(expr)
Returns the average value of @code{expr}:

@c end_description_for_help_topic
@c example_for_help_topic AVG
@example
mysql> SELECT student_name, AVG(test_score)
    ->        FROM student
    ->        GROUP BY student_name;
@end example

@findex BIT_AND()
@c description_for_help_topic BIT_AND
@item BIT_AND(expr)
Returns the bitwise @code{AND} of all bits in @code{expr}. The calculation is
performed with 64-bit (@code{BIGINT}) precision.
@c end_description_for_help_topic

As of MySQL 4.0.17, this function returns
18446744073709551615 if there were no matching rows.
(This is an unsigned @code{BIGINT} value with all bits set to 1.)
Before 4.0.17, the function returns -1 if there were no matching rows.

@findex BIT_OR()
@c description_for_help_topic BIT_OR
@item BIT_OR(expr)
Returns the bitwise @code{OR} of all bits in @code{expr}. The calculation is
performed with 64-bit (@code{BIGINT}) precision.
@c end_description_for_help_topic

This function returns 0 if there were no matching rows.

@findex BIT_XOR()
@c description_for_help_topic BIT_XOR
@item BIT_XOR(expr)
Returns the bitwise @code{XOR} of all bits in @code{expr}. The calculation is
performed with 64-bit (@code{BIGINT}) precision.
@c end_description_for_help_topic

Function returns 0 if there were no matching rows.

This function is available as of MySQL 4.1.1.

@findex COUNT()
@c description_for_help_topic COUNT
@item COUNT(expr)
Returns a count of the number of non-@code{NULL} values in the rows
retrieved by a @code{SELECT} statement:

@c end_description_for_help_topic
@c example_for_help_topic COUNT
@example
mysql> SELECT student.student_name,COUNT(*)
    ->        FROM student,course
    ->        WHERE student.student_id=course.student_id
    ->        GROUP BY student_name;

@end example

@code{COUNT(*)} is somewhat different in that it returns a count of
the number of rows retrieved, whether or not they contain @code{NULL}
values.

@code{COUNT(*)} is optimized to
return very quickly if the @code{SELECT} retrieves from one table, no
other columns are retrieved, and there is no @code{WHERE} clause.
For example:

@example
mysql> SELECT COUNT(*) FROM student;
@end example

This optimization applies only to @code{MyISAM} and @code{ISAM} tables
only, because an exact record count is stored for these table types and
can be accessed very quickly. For transactional storage engines
(@code{InnodB}, @code{BDB}), storing an exact row count is more problematic
because multiple transactions may be occurring, each of which may affect the
count.

@findex COUNT(DISTINCT)
@findex DISTINCT
@c description_for_help_topic COUNT DISTINCT  COUNT DISTINCT
@item COUNT(DISTINCT expr,[expr...])
Returns a count of the number of different non-@code{NULL} values:

@c end_description_for_help_topic
@c example_for_help_topic COUNT DISTINCT
@example
mysql> SELECT COUNT(DISTINCT results) FROM student;
@end example

In MySQL you can get the number of distinct expression
combinations that don't contain NULL by giving a list of expressions.
In SQL-99 you would have to do a concatenation of all expressions
inside @code{COUNT(DISTINCT ...)}.

@findex GROUP_CONCAT()
@c description_for_help_topic GROUP_CONCAT  DISTINCT SEPARATOR ORDER BY ASC DESC
@item GROUP_CONCAT(expr)
Full syntax:
@example
GROUP_CONCAT([DISTINCT] expr [,expr ...]
             [ORDER BY @{unsigned_integer | col_name | formula@} [ASC | DESC] [,col ...]]
             [SEPARATOR str_val])
@end example
This function was added in MySQL version 4.1.
It returns a string result with the concatenated values from a group:
@c end_description_for_help_topic

@c example_for_help_topic GROUP_CONCAT
@example
mysql> SELECT student_name,
    ->        GROUP_CONCAT(test_score)
    ->        FROM student 
    ->        GROUP BY student_name;
@end example

or:

@example
mysql> SELECT student_name,
    ->        GROUP_CONCAT(DISTINCT test_score
    ->                     ORDER BY test_score DESC SEPARATOR " ")
    ->        FROM student
    ->        GROUP BY student_name;
@end example

In MySQL you can get the concatenated values of expression combinations.
You can eliminate duplicate values by using @code{DISTINCT}.
If you want to sort values in the result you should use @code{ORDER BY}
clause.
To sort in reverse order, add the @code{DESC} (descending) keyword to the
name of the column you are sorting by in the @code{ORDER BY} clause. The
default is ascending order; this may be specified explicitly using the
@code{ASC} keyword.
@code{SEPARATOR} is the string value which should be inserted between
values of result. The default is a comma (@samp{","}). You can remove
the separator altogether by specifying @code{SEPARATOR ""}.

You can set a maximum allowed length with the variable
@code{group_concat_max_len} in your configuration.
The syntax to do this at runtime is:
@example
SET [SESSION | GLOBAL] group_concat_max_len = unsigned_integer;
@end example
If a maximum length has been set, the result is truncated to this
maximum length. 

The @code{GROUP_CONCAT()} function is an enhanced implementation of
the basic @code{LIST()} function supported by Sybase SQL Anywhere.
@code{GROUP_CONCAT()} is backward compatible with the extremely limited
functionality of @code{LIST()}, if only one column and no other options
are specified. @code{LIST()} does have a default sorting order.

@findex MIN()
@findex MAX()
@c description_for_help_topic MIN MAX  MIN MAX
@item MIN(expr)
@itemx MAX(expr)
Returns the minimum or maximum value of @code{expr}.  @code{MIN()} and
@code{MAX()} may take a string argument; in such cases they return the
minimum or maximum string value. @xref{MySQL indexes}.

@c end_description_for_help_topic
@c example_for_help_topic MIN MAX
@example
mysql> SELECT student_name, MIN(test_score), MAX(test_score)
    ->        FROM student
    ->        GROUP BY student_name;
@end example

In @code{MIN()}, @code{MAX()} and other aggregate functions, MySQL
currently compares @code{ENUM} and @code{SET} columns by their string
value rather than by the string's relative position in the set.
This will be rectified.

@c description_for_help_topic STDDEV  STD
@findex STD()
@findex STDDEV()
@cindex Oracle compatibility
@cindex compatibility, with Oracle
@item STD(expr)
@itemx STDDEV(expr)
Returns the standard deviation of @code{expr} (the square root of
@code{VARIANCE()}. This is an extension to SQL-99. The @code{STDDEV()}
form of this function is provided for Oracle compatibility.
@c end_description_for_help_topic

@findex SUM()
@c description_for_help_topic SUM
@item SUM(expr)
Returns the sum of @code{expr}.  Note that if the return set has no rows,
it returns NULL!
@c end_description_for_help_topic

@findex VARIANCE()
@c description_for_help_topic VARIANCE
@item VARIANCE(expr)
Returns the standard variance of @code{expr} (considering rows as the
whole population, not as a sample; so it has the number of rows as
denominator). This is an extension to 
SQL-99 (available only in version 4.1 or later).
@c end_description_for_help_topic

@end table

@node GROUP-BY-Modifiers, GROUP-BY-hidden-fields, GROUP-BY-Functions, Group by functions and modifiers
@subsection @code{GROUP BY} Modifiers

@findex ROLLUP

@c TODO: Comparison with UNION, WRT: complexity, table accesses,
@c optimization

@c Statements to create and populate the sales table used in the
@c ROLLUP examples

@c DROP TABLE IF EXISTS sales;
@c CREATE TABLE sales
@c (
@c     year    INT NOT NULL,
@c     country VARCHAR(20) NOT NULL,
@c     product VARCHAR(32) NOT NULL,
@c     profit  INT
@c );
@c INSERT INTO sales (product,country,year,profit) VALUES
@c INSERT INTO sales  VALUES
@c ('Computer', 'India', 2000, 1200),
@c ('TV', 'USA', 2001, 150),
@c ('Calculator', 'USA', 2001, 50),
@c ('Computer', 'USA', 2001, 1500),
@c ('Computer', 'USA', 2000, 1500),
@c ('Phone', 'Finland', 2000, 100),
@c ('Calculator', 'USA', 2000, 75),
@c ('Calculator', 'India', 2000, 75),
@c ('TV', 'USA', 2001, 100),
@c ('Computer', 'USA', 2001, 1200),
@c ('Computer', 'Finland', 2000, 1500),
@c ('Calculator', 'India', 2000, 75),
@c ('Phone', 'Finland', 2001, 10)
@c ;

As of MySQL 4.1.1, the @code{GROUP BY} clause allows a @code{WITH
ROLLUP} modifier that causes extra rows to be added to the summary
output. These rows represent higher-level (or super-aggregate) summary
operations. @code{ROLLUP} thus allows you to answer questions at multiple
levels of analysis with a single query. It can be used, for example,
to provide support for OLAP (Online Analytical Processing) operations.

As an illustration, suppose that a table named @code{sales} has @code{year},
@code{country},
@code{product}, and @code{profit} columns for recording sales profitability:

@example
CREATE TABLE sales
(
    year    INT NOT NULL,
    country VARCHAR(20) NOT NULL,
    product VARCHAR(32) NOT NULL,
    profit  INT
);
@end example

The table's contents can be summarized per year with a simple @code{GROUP BY}
like this:

@example
mysql> SELECT year, SUM(profit) FROM sales GROUP BY year;
+------+-------------+
| year | SUM(profit) |
+------+-------------+
| 2000 |        4525 |
| 2001 |        3010 |
+------+-------------+
@end example

This output shows the total profit for each year, but if you also want
to determine the total profit summed over all years, you must add up
the individual values yourself or run an additional query.

Or you can use @code{ROLLUP}, which provides both levels of analysis with a
single query.
Adding a @code{WITH ROLLUP} modifier to the @code{GROUP BY} clause causes the query
to produce another row that shows the grand total over all year values:

@example
mysql> SELECT year, SUM(profit) FROM sales GROUP BY year WITH ROLLUP;
+------+-------------+
| year | SUM(profit) |
+------+-------------+
| 2000 |        4525 |
| 2001 |        3010 |
| NULL |        7535 |
+------+-------------+
@end example

The grand total super-aggregate line is identified by the value @code{NULL} in
the @code{year} column.

@code{ROLLUP} has a more complex effect when there are multiple @code{GROUP BY}
columns. In this case, each time there is a ``break'' (change in value)
in any but the last grouping column, the query produces an extra
super-aggregate summary row.

For example, without @code{ROLLUP}, a summary on the @code{sales} table based
on @code{year},
@code{country}, and @code{product} might look like this:

@example
mysql> SELECT year, country, product, SUM(profit)
    -> FROM sales
    -> GROUP BY year, country, product;
+------+---------+------------+-------------+
| year | country | product    | SUM(profit) |
+------+---------+------------+-------------+
| 2000 | Finland | Computer   |        1500 |
| 2000 | Finland | Phone      |         100 |
| 2000 | India   | Calculator |         150 |
| 2000 | India   | Computer   |        1200 |
| 2000 | USA     | Calculator |          75 |
| 2000 | USA     | Computer   |        1500 |
| 2001 | Finland | Phone      |          10 |
| 2001 | USA     | Calculator |          50 |
| 2001 | USA     | Computer   |        2700 |
| 2001 | USA     | TV         |         250 |
+------+---------+------------+-------------+
@end example

The output indicates summary values only at the year/country/product level of
analysis.  When @code{ROLLUP} is added, the query produces several extra rows:

@example
mysql> SELECT year, country, product, SUM(profit)
    -> FROM sales
    -> GROUP BY year, country, product WITH ROLLUP;
+------+---------+------------+-------------+
| year | country | product    | SUM(profit) |
+------+---------+------------+-------------+
| 2000 | Finland | Computer   |        1500 |
| 2000 | Finland | Phone      |         100 |
| 2000 | Finland | NULL       |        1600 |
| 2000 | India   | Calculator |         150 |
| 2000 | India   | Computer   |        1200 |
| 2000 | India   | NULL       |        1350 |
| 2000 | USA     | Calculator |          75 |
| 2000 | USA     | Computer   |        1500 |
| 2000 | USA     | NULL       |        1575 |
| 2000 | NULL    | NULL       |        4525 |
| 2001 | Finland | Phone      |          10 |
| 2001 | Finland | NULL       |          10 |
| 2001 | USA     | Calculator |          50 |
| 2001 | USA     | Computer   |        2700 |
| 2001 | USA     | TV         |         250 |
| 2001 | USA     | NULL       |        3000 |
| 2001 | NULL    | NULL       |        3010 |
| NULL | NULL    | NULL       |        7535 |
+------+---------+------------+-------------+
@end example

For this query, adding @code{ROLLUP} causes the output to include summary
information at four levels of analysis, not just one.  Here's how to
interpret the @code{ROLLUP} output:

@itemize @bullet

@item
Following each set of product rows for a given year and country, an
extra summary row is produced showing the total for all products. These rows
have the @code{product} column set to @code{NULL}.

@item
Following each set of rows for a given year, an extra summary row is
produced showing the total for all countries and products. These rows
have the @code{country} and @code{products} columns set to @code{NULL}.

@item
Finally, following all other rows, an extra summary row is produced
showing the grand total for all years, countries, and products. This
row has the @code{year}, @code{country}, and @code{products} columns set to
@code{NULL}.

@end itemize

@strong{Other Considerations When using @code{ROLLUP}}

The following items list some behaviors specific to the MySQL implementation
of @code{ROLLUP}:

When you use @code{ROLLUP}, you cannot also use an @code{ORDER BY} clause to
sort the results. (In other words, @code{ROLLUP} and @code{ORDER BY} are mutually
exclusive.) However, you still have some control over sort order.
@code{GROUP BY}
in MySQL sorts results, and you can use explicit @code{ASC} and @code{DESC} keywords
with columns named in the @code{GROUP BY} list to specify sort order for
individual columns.  (The higher-level summary rows added by @code{ROLLUP}
still appear after the rows from which they are calculated, regardless
of the sort order.)

@code{LIMIT} can be used to restrict the number of rows returned to the
client. @code{LIMIT} is applied after @code{ROLLUP}, so the limit applies
against the extra rows added by @code{ROLLUP}. For example:

@example
mysql> SELECT year, country, product, SUM(profit)
    -> FROM sales
    -> GROUP BY year, country, product WITH ROLLUP
    -> LIMIT 5;
+------+---------+------------+-------------+
| year | country | product    | SUM(profit) |
+------+---------+------------+-------------+
| 2000 | Finland | Computer   |        1500 |
| 2000 | Finland | Phone      |         100 |
| 2000 | Finland | NULL       |        1600 |
| 2000 | India   | Calculator |         150 |
| 2000 | India   | Computer   |        1200 |
+------+---------+------------+-------------+
@end example

Note that using @code{LIMIT} with @code{ROLLUP} may produce results
that are more difficult to interpret, because you have less context
for understanding the super-aggregate rows.

The @code{NULL} indicators in each super-aggregate row are produced when the
row is sent to the client.  The server looks at the columns named in
the @code{GROUP BY} clause following the leftmost one that has changed value.
For any column in the result set with a name that is a lexical match to
any of those names, its value is set to @code{NULL}.  (If you specify grouping
columns by column number, the server identifies which columns to set to
@code{NULL} by number.)

Because the @code{NULL} values in the super-aggregate rows are placed into the
result set at such a late stage in query processing, you cannot test them
as @code{NULL} values within the query itself.  For example, you cannot add
@code{HAVING product IS NULL} to the query to eliminate from the output all
but the super-aggregate rows.

On the other hand, the @code{NULL} values do appear as @code{NULL}
on the client side and can be tested as such using any MySQL client
programming interface.

@node GROUP-BY-hidden-fields,  , GROUP-BY-Modifiers, Group by functions and modifiers
@subsection @code{GROUP BY} with Hidden Fields

@cindex @code{GROUP BY}, extensions to standard SQL
MySQL has extended the use of @code{GROUP BY}. You can use columns or
calculations in the @code{SELECT} expressions that don't appear in
the @code{GROUP BY} part. This stands for @emph{any possible value for this
group}.  You can use this to get better performance by avoiding sorting and
grouping on unnecessary items.  For example, you don't need to group on
@code{customer.name} in the following query:

@c end_description_for_help_topic
@c example_for_help_topic BIT_AND
@example
mysql> SELECT order.custid,customer.name,MAX(payments)
    ->        FROM order,customer
    ->        WHERE order.custid = customer.custid
    ->        GROUP BY order.custid;
@end example

In standard SQL, you would have to add @code{customer.name} to the
@code{GROUP BY} clause.  In MySQL, the name is redundant if you don't run in
ANSI mode.

@strong{Don't use this feature} if the columns you omit from the
@code{GROUP BY} part aren't unique in the group!  You will get
unpredictable results.

In some cases, you can use @code{MIN()} and @code{MAX()} to obtain a specific
column value even if it isn't unique. The following gives the value of
@code{column} from the row containing the smallest value in the @code{sort}
column:

@example
SUBSTR(MIN(CONCAT(RPAD(sort,6,' '),column)),7)
@end example

@xref{example-Maximum-column-group-row}.

@cindex @code{ORDER BY}, aliases in
@cindex aliases, in @code{ORDER BY} clauses
@cindex @code{GROUP BY}, aliases in
@cindex aliases, in @code{GROUP BY} clauses
@cindex expression aliases
@cindex aliases, for expressions
Note that if you are using MySQL Version 3.22 (or earlier) or if
you are trying to follow SQL-99, you can't use expressions in @code{GROUP
BY} or @code{ORDER BY} clauses.  You can work around this limitation by
using an alias for the expression:

@example
mysql> SELECT id,FLOOR(value/100) AS val FROM tbl_name
    ->        GROUP BY id,val ORDER BY val;
@end example

In MySQL Version 3.23 you can do:

@example
mysql> SELECT id,FLOOR(value/100) FROM tbl_name ORDER BY RAND();
@end example


@node SQL Syntax, Table types, Functions, Top
@chapter SQL Statement Syntax

@c TODO: move DDL before DML; you have to create something before you
@c can manipulate it...

This chapter describes the syntax for the SQL statements supported in MySQL.

@menu
* Data Manipulation::           Data Manipulation Statements
* Data Definition::             Data Definition Statements
* Basic User Commands::         Basic MySQL User Utility Statements
* Transactional Commands::      MySQL Transactional and Locking Statements
* Database Administration::     Database Administration Statements
* Replication SQL::             Replication Statements
* Fulltext Search::             MySQL Full-text Search
* Query Cache::                 MySQL Query Cache
@end menu
@node Data Manipulation, Data Definition, SQL Syntax, SQL Syntax
@section Data Manipulation Statements


@menu
* DELETE::                      @code{DELETE} Syntax
* DO::                          @code{DO} Syntax
* HANDLER::                     @code{HANDLER} Syntax
* INSERT::                      @code{INSERT} Syntax
* LOAD DATA::                   @code{LOAD DATA INFILE} Syntax
* REPLACE::                     @code{REPLACE} Syntax
* SELECT::                      @code{SELECT} Syntax
* Subqueries::                  Subquery Syntax
* TRUNCATE::                    @code{TRUNCATE} Syntax
* UPDATE::                      @code{UPDATE} Syntax
@end menu

@c help_category Data Manipulation


@node DELETE, DO, Data Manipulation, Data Manipulation
@subsection @code{DELETE} Syntax

@findex DELETE

@c example_for_help_topic DELETE
@example
DELETE [LOW_PRIORITY] [QUICK] [IGNORE] FROM table_name
       [WHERE where_definition]
       [ORDER BY ...]
       [LIMIT row_count]
@end example

or:

@example
DELETE [LOW_PRIORITY] [QUICK] [IGNORE] table_name[.*] [, table_name[.*] ...]
       FROM table-references
       [WHERE where_definition]
@end example

or:

@example
DELETE [LOW_PRIORITY] [QUICK] [IGNORE]
       FROM table_name[.*] [, table_name[.*] ...]
       USING table-references
       [WHERE where_definition]
@end example

@c description_for_help_topic DELETE  BY ORDER LIMIT WHERE FROM USING LOW_PRIORITY QUICK
@code{DELETE} deletes rows from @code{table_name} that satisfy the condition
given by @code{where_definition}, and returns the number of records deleted.

If you issue a @code{DELETE} with no @code{WHERE} clause, all rows are
deleted.  If you do this in @code{AUTOCOMMIT} mode, this works as
@code{TRUNCATE}. @xref{TRUNCATE, , @code{TRUNCATE}}.  In MySQL 3.23,
@code{DELETE} without a @code{WHERE} clause will return zero as the number
of affected records.
@c end_description_for_help_topic

If you really want to know how many records are deleted when you are deleting
all rows, and are willing to suffer a speed penalty, you can use a
@code{DELETE} statement of this form:

@example
mysql> DELETE FROM table_name WHERE 1>0;
@end example

Note that this is much slower than @code{DELETE FROM table_name} with no
@code{WHERE} clause, because it deletes rows one at a time.

If you specify the keyword @code{LOW_PRIORITY}, execution of the
@code{DELETE} is delayed until no other clients are reading from the table.

For MyISAM tables,
if you specify the word @code{QUICK} then the storage engine will not
merge index leaves during delete, which may speed up certain kind of
deletes.

The speed of delete operations may also be affected by factors discussed in
@ref{Delete speed}.

Option @code{IGNORE} causes MySQL to ignore all errors during the process of
deleting rows. Errors encountered during the parsing stage are processed
in the usual manner. Errors that are ignored due to the use of this option
are returned as warnings. This option first appeared in version 4.1.1.

In @code{MyISAM} tables, deleted records are maintained in a linked list and
subsequent @code{INSERT} operations reuse old record positions. To
reclaim unused space and reduce file-sizes, use the @code{OPTIMIZE
TABLE} statement or the @code{myisamchk} utility to reorganize tables.
@code{OPTIMIZE TABLE} is easier, but @code{myisamchk} is faster.  See
@ref{OPTIMIZE TABLE, , @code{OPTIMIZE TABLE}} and @ref{Optimisation}.

The first multiple-table delete format is supported starting from MySQL 4.0.0.
The second multiple-table delete format is supported starting from MySQL 4.0.2.

The idea is that only matching rows from the tables listed
@strong{before} the @code{FROM} or before the @code{USING} clause are
deleted. The effect is that you can delete rows from many tables at the
same time and also have additional tables that are used for searching.

The @code{.*} after the table names is there just to be compatible with
@code{Access}:

@example
DELETE t1,t2 FROM t1,t2,t3 WHERE t1.id=t2.id AND t2.id=t3.id
@end example

or:

@example
DELETE FROM t1,t2 USING t1,t2,t3 WHERE t1.id=t2.id AND t2.id=t3.id
@end example

In the above case we delete matching rows only from tables @code{t1} and
@code{t2}.

The examples show inner joins using the comma operator, but
multiple-table @code{DELETE} statements can use any type of
join allowed in @code{SELECT} statements, such as @code{LEFT JOIN}.

If an @code{ORDER BY} clause is used (available from MySQL 4.0.0), the rows
will be deleted in that order. This is really useful only in conjunction
with @code{LIMIT}.  For example:

@example
DELETE FROM somelog
WHERE user = 'jcole'
ORDER BY timestamp
LIMIT 1
@end example

This will delete the oldest entry (by @code{timestamp}) where the row matches
the @code{WHERE} clause.

The MySQL-specific @code{LIMIT row_count} option to @code{DELETE} tells
the server the maximum number of rows to be deleted before control is
returned to the client.  This can be used to ensure that a specific
@code{DELETE} command doesn't take too much time.  You can simply repeat
the @code{DELETE} command until the number of affected rows is less than
the @code{LIMIT} value.

From MySQL 4.0, you can specify multiple tables in the @code{DELETE}
statement to delete rows from one or more tables depending on a particular
condition in multiple tables. However, you cannot use @code{ORDER BY}
or @code{LIMIT} in a multiple-table @code{DELETE}.


@node DO, HANDLER, DELETE, Data Manipulation
@subsection @code{DO} Syntax

@findex DO

@c example_for_help_topic DO
@example
DO expression, [expression, ...]
@end example

@c description_for_help_topic DO
Execute the expression but don't return any results.  This is a
shorthand of @code{SELECT expression, expression}, but has the advantage
that it's slightly faster when you don't care about the result.

This is mainly useful with functions that has side effects, like
@code{RELEASE_LOCK}.
@c end_description_for_help_topic


@node HANDLER, INSERT, DO, Data Manipulation
@subsection @code{HANDLER} Syntax

@findex HANDLER

@c example_for_help_topic HANDLER
@example
HANDLER tbl_name OPEN [ AS alias ]
HANDLER tbl_name READ index_name @{ = | >= | <= | < @} (value1,value2,...)
    [ WHERE ... ] [LIMIT ... ]
HANDLER tbl_name READ index_name @{ FIRST | NEXT | PREV | LAST @}
    [ WHERE ... ] [LIMIT ... ]
HANDLER tbl_name READ @{ FIRST | NEXT @}
    [ WHERE ... ] [LIMIT ... ]
HANDLER tbl_name CLOSE
@end example

@c description_for_help_topic HANDLER  OPEN READ LIMIT FIRST NEXT PREV LAST WHERE CLOSE
The @code{HANDLER} statement provides direct access to the @code{MyISAM} table
storage engine interface.
@c end_description_for_help_topic

The first form of @code{HANDLER} statement opens a table, making
it accessible via subsequent @code{HANDLER ... READ} statements.
This table object is not shared by other threads and will not be closed
until the thread calls @code{HANDLER tbl_name CLOSE} or the thread dies.

@c FIX The sentence below needs to be rewritten. The reference to "the condition" is not clear.
@c FIX Also all mentions of the LIMIT clause need to be clarified in various sentences below.

The second form fetches one row (or more, specified by @code{LIMIT}
clause) where the index specified satisfies the given values and the
@code{WHERE} condition is met.  If you have a multiple-column index,
specify the index column values as a comma-separated list. Either specify
values for all the columns in the index, or specify values for a leftmost
prefix of the index columns. Suppose an index includes three columns
named @code{col_a}, @code{col_b}, and @code{col_c}, in that order.
The @code{HANDLER} statement can specify values for all three columns in the
index, or for the columns in a leftmost prefix. For example:

@example
HANDLER ... index_name = (col_a_val,col_b_val,col_c_val) ...
HANDLER ... index_name = (col_a_val,col_b_val) ...
HANDLER ... index_name = (col_a_val) ...
@end example

The third form fetches one row (or more, specified by @code{LIMIT} clause)
from the table in index order, matching @code{WHERE} condition.

The fourth form (without index specification) fetches one row (or more, specified
by @code{LIMIT} clause) from the table in natural row order (as stored
in datafile) matching @code{WHERE} condition. It is faster than
@code{HANDLER tbl_name READ index_name} when a full table scan is desired.

@code{HANDLER ... CLOSE} closes a table that was opened with
@code{HANDLER ... OPEN}.

Note: If you're using @code{HANDLER} interface for @code{PRIMARY KEY} you should
remember to quote the keyword PRIMARY with backticks:
@code{HANDLER tbl READ `PRIMARY` > (...)}

@code{HANDLER} is a somewhat low-level statement.  For example, it does
not provide consistency.  That is, @code{HANDLER ... OPEN} does @strong{NOT}
take a snapshot of the table, and does @strong{NOT} lock the table. This
means that after a @code{HANDLER ... OPEN} is issued, table data can be
modified (by this or any other thread) and these modifications may appear
only partially in @code{HANDLER ... NEXT} or @code{HANDLER ... PREV} scans.

The reasons to use this interface instead of normal SQL are:

@itemize @bullet
@item
It's faster than @code{SELECT} because:
@itemize @bullet
@item
A designated storage engine is allocated for the thread in @code{HANDLER OPEN}.
@item
There is less parsing involved.
@item
No optimizer and no query checking overhead.
@item
The used table doesn't have to be locked between two handler requests.
@item
The handler interface doesn't have to provide a consistent look of the
data (for example, dirty-reads are allowed), so the storage engine can
do optimizations that SQL doesn't normally allow.
@end itemize
@item
It makes it much easier to port applications that uses an ISAM like
interface to MySQL.
@item
It allows one to traverse a database in a manner that is not easy
(in some cases impossible) to do with SQL. The handler interface is
more natural way to look at data when working with applications that
provide an interactive user interfaces to the database.
@end itemize


@node INSERT, LOAD DATA, HANDLER, Data Manipulation
@subsection @code{INSERT} Syntax

@findex INSERT

@c example_for_help_topic INSERT INTO
@example
    INSERT [LOW_PRIORITY | DELAYED] [IGNORE]
        [INTO] tbl_name [(col_name,...)]
        VALUES ((expression | DEFAULT),...),(...),...
        [ ON DUPLICATE KEY UPDATE col_name=expression, ... ]
or  INSERT [LOW_PRIORITY | DELAYED] [IGNORE]
        [INTO] tbl_name [(col_name,...)]
        SELECT ...
or  INSERT [LOW_PRIORITY | DELAYED] [IGNORE]
        [INTO] tbl_name
        SET col_name=(expression | DEFAULT), ...
        [ ON DUPLICATE KEY UPDATE col_name=expression, ... ]

@end example

@c description_for_help_topic INSERT INTO  INSERT INTO LOW_PRIORITY IGNORE DUPLICATE KEY UPDATE DELAYED DEFAULT
@code{INSERT} inserts new rows into an existing table.  The @code{INSERT
...  VALUES} form of the statement inserts rows based on explicitly
specified values.  The @code{INSERT ... SELECT} form inserts rows
selected from another table or tables.  The @code{INSERT ... VALUES}
form with multiple value lists is supported in MySQL Version
3.22.5 or later.  The @code{col_name=expression} syntax is supported in
MySQL Version 3.22.10 or later.
@c end_description_for_help_topic

@code{tbl_name} is the table into which rows should be inserted.  The column
name list or the @code{SET} clause indicates which columns the statement
specifies values for:

@itemize @bullet
@item
If you specify no column list for @code{INSERT ... VALUES} or @code{INSERT
... SELECT}, values for all columns in the table must be provided in the
@code{VALUES()} list or by the @code{SELECT}.  If you don't know the order of
the columns in the table, use @code{DESCRIBE tbl_name} to find out.

@item
@cindex default values
Any column not explicitly given a value is set to its default value.  For
example, if you specify a column list that doesn't name all the columns in
the table, unnamed columns are set to their default values.  Default value
assignment is described in @ref{CREATE TABLE, , @code{CREATE TABLE}}.

You can also use the keyword @code{DEFAULT} to set a column to its
default value. (New in MySQL 4.0.3.)  This makes it easier to write
@code{INSERT} statements that assign values to all but a few columns,
because it allows you to avoid writing an incomplete @code{VALUES()} list
(a list that does not include a value for each column in the table).
Otherwise, you would have to write out the list of column names
corresponding to each value in the @code{VALUES()} list.

MySQL always has a default value for all fields. This is something
that is imposed on MySQL to be able to work with both transactional
and non-transactional tables.

Our view is that checking of fields content should be done in the
application and not in the database server.

@item
An @code{expression} may refer to any column that was set earlier in a value
list.  For example, you can say this:

@example
mysql> INSERT INTO tbl_name (col1,col2) VALUES(15,col1*2);
@end example

But not this:

@example
mysql> INSERT INTO tbl_name (col1,col2) VALUES(col2*2,15);
@end example

@item
If you specify the keyword @code{DELAYED}, the server puts the row or
rows to be inserted into a buffer, and the client issuing the @code{INSERT
DELAYED} statement then may continue on.  If the table is busy, the server
holds the rows.  When the table becomes free, it begins inserting rows,
checking periodically to see whether there are new read requests for the
table. If there are, the delayed row queue is suspended until the table
becomes free again.

@item
If you specify the keyword @code{LOW_PRIORITY}, execution of the
@code{INSERT} is delayed until no other clients are reading from the
table. This includes other clients that began reading while existing
clients are reading, and while the @code{INSERT LOW_PRIORITY} statement
is waiting. It is possible, therefore, for a client that issues an
@code{INSERT LOW_PRIORITY} statement to wait for a very long time (or
even forever) in a read-heavy environment.
(This is in contrast to @code{INSERT DELAYED}, which lets the client
continue at once.)  @xref{INSERT DELAYED}.  Note that @code{LOW_PRIORITY}
should normally not be used with @code{MyISAM} tables as this disables
concurrent inserts. @xref{MyISAM}.

@item
If you specify the keyword @code{IGNORE} in an @code{INSERT} with many
rows, any rows that duplicate an existing @code{PRIMARY} or @code{UNIQUE}
key in the table are ignored and are not inserted.  If you do not specify
@code{IGNORE}, the insert is aborted if there is any row that duplicates an
existing key value.  You can determine with the C API function
@code{mysql_info()} how many rows were inserted into the table.

@item
If you specify @code{ON DUPLICATE KEY UPDATE} clause (new in MySQL 4.1.0), and
a row is inserted that would cause a duplicate value in a @code{PRIMARY} or
@code{UNIQUE} key, an @code{UPDATE} of the old row is performed. For
example, the command:

@example
mysql> INSERT INTO table (a,b,c) VALUES (1,2,3)
    -> ON DUPLICATE KEY UPDATE c=c+1;
@end example

in case of column @code{a} is declared as @code{UNIQUE} and already
holds @code{1} once, would be identical to the

@example
mysql> UPDATE table SET c=c+1 WHERE a=1;
@end example

@strong{Note:} If column @code{b} is unique too, the
@code{UPDATE} command would be written as

@example
mysql> UPDATE table SET c=c+1 WHERE a=1 OR b=2 LIMIT 1;
@end example

and if @code{a=1 OR b=2} matches several rows, only @strong{one} row
will be updated! In general, one should try to avoid using
@code{ON DUPLICATE KEY} clause on tables with multiple @code{UNIQUE} keys.

Since MySQL 4.1.1 one can use function @code{VALUES(col_name)}
to refer to the column value in the @code{INSERT} part of the
@code{INSERT ... UPDATE} command - that is the value that would be
inserted if there would be no duplicate key conflict. This function
especially useful in multiple-row inserts. Naturally @code{VALUES()}
function is only meaningful in @code{INSERT ... UPDATE} command
and returns @code{NULL} otherwise.

Example:

@example
mysql> INSERT INTO table (a,b,c) VALUES (1,2,3),(4,5,6)
    -> ON DUPLICATE KEY UPDATE c=VALUES(a)+VALUES(b);
@end example

The command above is identical to

@example
mysql> INSERT INTO table (a,b,c) VALUES (1,2,3)
    -> ON DUPLICATE KEY UPDATE c=3;
mysql> INSERT INTO table (a,b,c) VALUES (4,5,6)
    -> ON DUPLICATE KEY UPDATE c=9;
@end example

When one uses @code{ON DUPLICATE KEY UPDATE},
the @code{DELAYED} option is ignored.

@item
If MySQL was configured using the @code{DONT_USE_DEFAULT_FIELDS}
option, @code{INSERT} statements generate an error unless you explicitly
specify values for all columns that require a non-@code{NULL} value.
@xref{configure options,  , @code{configure} options}.

@item
You can find the value used for an @code{AUTO_INCREMENT} column
with the @code{mysql_insert_id} function.
@xref{mysql_insert_id, , @code{mysql_insert_id()}}.
@end itemize

@findex mysql_info()
If you use @code{INSERT ... SELECT} or an @code{INSERT ... VALUES}
statement with multiple value lists, you can use the C API function
@code{mysql_info()} to get information about the query.  The format of the
information string is shown here:

@example
Records: 100 Duplicates: 0 Warnings: 0
@end example

@code{Duplicates} indicates the number of rows that couldn't be inserted
because they would duplicate some existing unique index value.
@code{Warnings} indicates the number of attempts to insert column values that
were problematic in some way. Warnings can occur under any of the following
conditions:

@itemize @bullet
@item
Inserting @code{NULL} into a column that has been declared @code{NOT NULL}.
The column is set to the default value appropriate for the column type.
This is @code{0} for numeric types, the empty string (@code{''}) for
string types, and the ``zero'' value for date and time types.

@item
Setting a numeric column to a value that lies outside the column's range.
The value is clipped to the appropriate endpoint of the range.

@item
Setting a numeric column to a value such as @code{'10.34 a'}.  The trailing
garbage is stripped and the remaining numeric part is inserted.  If the value
doesn't make sense as a number at all, the column is set to @code{0}.

@item
Inserting a string into a @code{CHAR}, @code{VARCHAR}, @code{TEXT}, or
@code{BLOB} column that exceeds the column's maximum length.  The value is
truncated to the column's maximum length.

@item
Inserting a value into a date or time column that is illegal for the column
type.  The column is set to the appropriate zero value for the type.
@end itemize

@findex REPLACE ... SELECT
@findex INSERT ... SELECT

@menu
* INSERT SELECT::               @code{INSERT ... SELECT} Syntax
* INSERT DELAYED::              @code{INSERT DELAYED} Syntax
@end menu


@node INSERT SELECT, INSERT DELAYED, INSERT, INSERT
@subsubsection @code{INSERT ... SELECT} Syntax

@c description_for_help_topic INSERT SELECT
@example
INSERT [LOW_PRIORITY] [IGNORE] [INTO] tbl_name [(column list)] SELECT ...
@end example

With @code{INSERT ... SELECT}, you can quickly insert many rows
into a table from one or many tables.
@c end_description_for_help_topic

@c example_for_help_topic INSERT SELECT
@example
INSERT INTO tblTemp2 (fldID) SELECT tblTemp1.fldOrder_ID FROM tblTemp1 WHERE
tblTemp1.fldOrder_ID > 100;
@end example

The following conditions hold for an @code{INSERT ... SELECT} statement:

@itemize @minus
@item
Prior to MySQL 4.0.1, @code{INSERT ... SELECT} implicitly operates in
@code{IGNORE} mode.  As of MySQL 4.0.1, you should specify @code{IGNORE}
explicitly to ignore records that would cause duplicate-key violations.

@item
Do not use @code{DELAYED} with @code{INSERT ... SELECT}.

@item
Prior to MySQL 4.0.14,
the target table of the @code{INSERT} statement cannot appear in the
@code{FROM} clause of the @code{SELECT} part of the query.
This limitation is lifted in 4.0.14.
@c (The problem is that the @code{SELECT} possibly would
@c find records that were inserted earlier during the same run.  When using
@c subquery clauses, the situation could easily be very confusing.)

@item
@code{AUTO_INCREMENT} columns work as usual.

@item
In C programs,
you can use the C API function @code{mysql_info()} to get information about
the query. @xref{INSERT}.

@item
To ensure that the binary log can be used to re-create the
original tables, MySQL will not allow concurrent inserts during
@code{INSERT ... SELECT}.
@end itemize

You can use @code{REPLACE} instead of @code{INSERT} to overwrite old rows.
@code{REPLACE} is the counterpart to @code{INSERT IGNORE} in the treatment
of new rows that contain unique key values that duplicate old rows:
The new rows are used to replace the old rows rather than being discarded.


@node INSERT DELAYED,  , INSERT SELECT, INSERT
@subsubsection @code{INSERT DELAYED} Syntax

@findex INSERT DELAYED
@findex DELAYED

@cindex INSERT DELAYED

@c example_for_help_topic INSERT DELAYED
@example
INSERT DELAYED ...
@end example

@c description_for_help_topic INSERT DELAYED  INSERT DELAYED
The @code{DELAYED} option for the @code{INSERT} statement is a
MySQL-specific option that is very useful if you have clients
that can't wait for the @code{INSERT} to complete.  This is a common
problem when you use MySQL for logging and you also
periodically run @code{SELECT} and @code{UPDATE} statements that take a
long time to complete.  @code{DELAYED} was introduced in MySQL
Version 3.22.15.  It is a MySQL extension to SQL-92.

@code{INSERT DELAYED} works only with @code{ISAM} and @code{MyISAM}
tables.  Note that as @code{MyISAM} tables support concurrent
@code{SELECT} and @code{INSERT}, if there is no free blocks in the
middle of the datafile, you very seldom need to use @code{INSERT
DELAYED} with @code{MyISAM}. @xref{MyISAM}.

@code{INSERT DELAYED} should be used only for @code{INSERT} statements that
specify value lists. This is enforced as of MySQL 4.0.18; the server ignores
@code{DELAYED} for @code{INSERT DELAYED ... SELECT} statements.
@c end_description_for_help_topic

When you use @code{INSERT DELAYED}, the client will get an OK at once
and the row will be inserted when the table is not in use by any other thread.

Another major benefit of using @code{INSERT DELAYED} is that inserts
from many clients are bundled together and written in one block. This is much
faster than doing many separate inserts.

Note that currently the queued rows are only stored in memory until they are
inserted into the table.  This means that if you kill @code{mysqld}
the hard way (@code{kill -9}) or if @code{mysqld} dies unexpectedly, any
queued rows that weren't written to disk are lost!

The following describes in detail what happens when you use the
@code{DELAYED} option to @code{INSERT} or @code{REPLACE}.  In this
description, the ``thread'' is the thread that received an @code{INSERT
DELAYED} command and ``handler'' is the thread that handles all
@code{INSERT DELAYED} statements for a particular table.

@itemize @bullet
@item
When a thread executes a @code{DELAYED} statement for a table, a handler
thread is created to process all @code{DELAYED} statements for the table, if
no such handler already exists.

@item
The thread checks whether the handler has acquired a @code{DELAYED}
lock already; if not, it tells the handler thread to do so.  The
@code{DELAYED} lock can be obtained even if other threads have a @code{READ}
or @code{WRITE} lock on the table.  However, the handler will wait for all
@code{ALTER TABLE} locks or @code{FLUSH TABLES} to ensure that the table
structure is up to date.

@item
The thread executes the @code{INSERT} statement, but instead of writing
the row to the table, it puts a copy of the final row into a queue that
is managed by the handler thread. Any syntax errors are noticed by the
thread and reported to the client program.

@item
The client can't report the number of duplicates or the @code{AUTO_INCREMENT}
value for the resulting row; it can't obtain them from the server, because
the @code{INSERT} returns before the insert operation has been completed.  If
you use the C API, the @code{mysql_info()} function doesn't return anything
meaningful, for the same reason.

@item
The binary log is updated by the handler thread when the row is inserted into
the table.  In case of multiple-row inserts, the binary log is updated when
the first row is inserted.

@item
After every @code{delayed_insert_limit} rows are written, the handler checks
whether any @code{SELECT} statements are still pending.  If so, it
allows these to execute before continuing.

@cindex delayed_insert_limit
@cindex timeout
@item
When the handler has no more rows in its queue, the table is unlocked.  If no
new @code{INSERT DELAYED} commands are received within
@code{delayed_insert_timeout} seconds, the handler terminates.

@item
If more than @code{delayed_queue_size} rows are pending already in a
specific handler queue, the thread requesting @code{INSERT DELAYED}
waits until there is room in the queue.  This is done to ensure that
the @code{mysqld} server doesn't use all memory for the delayed memory
queue.

@item
The handler thread will show up in the MySQL process list
with @code{delayed_insert} in the @code{Command} column.  It will
be killed if you execute a @code{FLUSH TABLES} command or kill it with
@code{KILL thread_id}. However, it will first store all queued rows into the
table before exiting. During this time it will not accept any new
@code{INSERT} commands from another thread. If you execute an @code{INSERT
DELAYED} command after this, a new handler thread will be created.

Note that the above means that @code{INSERT DELAYED} commands have higher
priority than normal @code{INSERT} commands if there is an @code{INSERT
DELAYED} handler already running!  Other update commands will have to wait
until the @code{INSERT DELAYED} queue is empty, someone kills the handler
thread (with @code{KILL thread_id}), or someone executes @code{FLUSH TABLES}.

@item
The following status variables provide information about @code{INSERT
DELAYED} commands:

@multitable @columnfractions .30 .55
@item @strong{Variable} @tab @strong{Meaning}
@item @code{Delayed_insert_threads} @tab Number of handler threads
@item @code{Delayed_writes} @tab Number of rows written with @code{INSERT DELAYED}
@item @code{Not_flushed_delayed_rows} @tab Number of rows waiting to be written
@end multitable

You can view these variables by issuing a @code{SHOW STATUS} statement or
by executing a @code{mysqladmin extended-status} command.
@end itemize

Note that @code{INSERT DELAYED} is slower than a normal INSERT if the
table is not in use.  There is also the additional overhead for the
server to handle a separate thread for each table on which you use
@code{INSERT DELAYED}.  This means that you should use @code{INSERT
DELAYED} only when you are really sure you need it!


@node LOAD DATA, REPLACE, INSERT, Data Manipulation
@subsection @code{LOAD DATA INFILE} Syntax

@findex LOAD DATA INFILE

@c example_for_help_topic LOAD DATA
@example
LOAD DATA [LOW_PRIORITY | CONCURRENT] [LOCAL] INFILE 'file_name.txt'
    [REPLACE | IGNORE]
    INTO TABLE tbl_name
    [FIELDS
        [TERMINATED BY '\t']
        [[OPTIONALLY] ENCLOSED BY '']
        [ESCAPED BY '\\' ]
    ]
    [LINES 
        [STARTING BY '']    
        [TERMINATED BY '\n']
    ]
    [IGNORE number LINES]
    [(col_name,...)]
@end example

@c description_for_help_topic LOAD DATA  BY LOAD DATA LOW_PRIORITY CONCURRENT LOCAL INFILE REPLACE IGNORE FIELDS ENCLOSED TERMINATED ESCAPED LINES IMPORT CSV OPTIONALLY STARTING
The @code{LOAD DATA INFILE} statement reads rows from a text file into a
table at a very high speed.  If the @code{LOCAL} keyword is specified, it is
interpreted with respect to the client end of the connection. When
@code{LOCAL} is specified, the file is read by the client program on the client
host and sent to the server.  If @code{LOCAL} is not specified, the
file must be located on the server host and is read directly by the server.
(@code{LOCAL} is available in MySQL Version 3.22.6 or later.)

For security reasons, when reading text files located on the server, the
files must either reside in the database directory or be readable by all.
Also, to use @code{LOAD DATA INFILE} on server files, you must have the
@code{FILE} privilege on the server host.
@c end_description_for_help_topic
@xref{Privileges provided}.

As of MySQL 3.23.49 and MySQL 4.0.2 (4.0.13 on Windows), 
@code{LOCAL} will work only if your server
and your client both have been enabled to allow it.  For example, if
@code{mysqld} was started with @code{--local-infile=0}, @code{LOCAL} will
not work.
@xref{LOAD DATA LOCAL}.

If you specify the keyword @code{LOW_PRIORITY}, execution of the
@code{LOAD DATA} statement is delayed until no other clients are reading
from the table.

If you specify the keyword @code{CONCURRENT} with a @code{MyISAM} table,
then other threads can retrieve data from the table while @code{LOAD
DATA} is executing. Using this option will affect the
performance of @code{LOAD DATA} a bit even if no other thread is using
the table at the same time.

Using @code{LOCAL} will be a bit slower than letting the server access the
files directly, because the contents of the file must be sent over the
connection by the client
to the server.  On the other hand, you do not need the
@code{FILE} privilege to load local files.

@c old version
If you are using MySQL before Version 3.23.24 you can't read from a
FIFO with @code{LOAD DATA INFILE}.  If you need to read from a FIFO (for
example the output from gunzip), use @code{LOAD DATA LOCAL INFILE}
instead.

@cindex @code{mysqlimport}
You can also load datafiles by using the @code{mysqlimport} utility; it
operates by sending a @code{LOAD DATA INFILE} command to the server.  The
@code{--local} option causes @code{mysqlimport} to read datafiles from the
client host.  You can specify the @code{--compress} option to get better
performance over slow networks if the client and server support the
compressed protocol.

When locating files on the server host, the server uses the following rules:

@itemize @bullet
@item
If an absolute pathname is given, the server uses the pathname as is.

@item
If a relative pathname with one or more leading components is given,
the server searches for the file relative to the server's data directory.

@item
If a filename with no leading components is given, the server looks for
the file in the database directory of the current database.
@end itemize

Note that these rules mean a file named as @file{./myfile.txt} is read from
the server's data directory, whereas the same file named as @file{myfile.txt} is
read from the database directory of the current database.  For example,
the following @code{LOAD DATA} statement reads the file @file{data.txt}
from the database directory for @code{db1} because @code{db1} is the current
database, even though the statement explicitly loads the file into a
table in the @code{db2} database:

@example
mysql> USE db1;
mysql> LOAD DATA INFILE "data.txt" INTO TABLE db2.my_table;
@end example

The @code{REPLACE} and @code{IGNORE} keywords control handling of input
records that duplicate existing records on unique key values.

If you specify @code{REPLACE}, input rows replace existing rows (in other
words rows that has the same value for a primary or unique index as an
existing row). @xref{REPLACE}.

If you specify @code{IGNORE}, input rows that duplicate an existing row
on a unique key value are skipped.  If you don't specify either option,
the behavior depends on whether or not the @code{LOCAL} keyword is specified.
Without @code{LOCAL}, an error occurs when a duplicate key value is
found, and the rest of the text file is ignored.  With @code{LOCAL},
the default behavior is the same as if @code{IGNORE} is specified;
this is because the server has no way to stop transmission of the file
in the middle of the operation.

If you want to ignore foreign key constraints during load you can do
@code{SET FOREIGN_KEY_CHECKS=0} before executing @code{LOAD DATA}.

If you use @code{LOAD DATA INFILE} on an empty @code{MyISAM} table, all
non-unique indexes are created in a separate batch (like in
@code{REPAIR}).  This normally makes @code{LOAD DATA INFILE} much faster
when you have many indexes.  Normally this is very fast, but in some
extreme cases you can create the indexes even faster by turning them off
with @code{ALTER TABLE .. DISABLE KEYS} and use @code{ALTER TABLE .. ENABLE
KEYS} to re-create the indexes.
@xref{Table maintenance}.

@code{LOAD DATA INFILE} is the complement of @code{SELECT ... INTO OUTFILE}.
@xref{SELECT, , @code{SELECT}}.
To write data from a table to a file, use @code{SELECT ... INTO OUTFILE}.
To read the file back into a table, use @code{LOAD DATA INFILE}.
The syntax of the @code{FIELDS} and @code{LINES} clauses is the same for
both commands.  Both clauses are optional, but @code{FIELDS}
must precede @code{LINES} if both are specified.

If you specify a @code{FIELDS} clause,
each of its subclauses (@code{TERMINATED BY}, @code{[OPTIONALLY] ENCLOSED
BY}, and @code{ESCAPED BY}) is also optional, except that you must
specify at least one of them.

If you don't specify a @code{FIELDS} clause, the defaults are the
same as if you had written this:

@example
FIELDS TERMINATED BY '\t' ENCLOSED BY '' ESCAPED BY '\\'
@end example

If you don't specify a @code{LINES} clause, the default
is the same as if you had written this:

@example
LINES TERMINATED BY '\n'
@end example

@strong{Note:} If you have generated the text file on a Windows system
you may have to change the above to: @code{LINES TERMINATED BY '\r\n'}
as Windows uses two characters as a line terminator. Some programs, like
@code{wordpad}, may use @code{\r} as a line terminator.

If all the lines you want to read in has a common prefix that you want
to skip, you can use @code{LINES STARTING BY prefix_string} for this.

In other words, the defaults cause @code{LOAD DATA INFILE} to act as follows
when reading input:

@itemize @bullet
@item
Look for line boundaries at newlines.

@item
If @code{LINES STARTING BY prefix} is used, read until prefix is found
and start reading at character after prefix.  If line doesn't include prefix
it will be skipped.

@item
Break lines into fields at tabs.

@item
Do not expect fields to be enclosed within any quoting characters.

@item
Interpret occurrences of tab, newline, or @samp{\} preceded by
@samp{\} as literal characters that are part of field values.
@end itemize

Conversely, the defaults cause @code{SELECT ... INTO OUTFILE} to act as
follows when writing output:

@itemize @bullet
@item
Write tabs between fields.

@item
Do not enclose fields within any quoting characters.

@item
Use @samp{\} to escape instances of tab, newline or @samp{\} that occur
within field values.

@item
Write newlines at the ends of lines.
@end itemize

Note that to write @code{FIELDS ESCAPED BY '\\'}, you must specify two
backslashes for the value to be read as a single backslash.

The @code{IGNORE number LINES} option can be used to ignore lines at
the start of the file.  For example, you can use @code{IGNORE 1 LINES}
to skip over an initial header line containing column names:

@example
mysql> LOAD DATA INFILE "/tmp/file_name" INTO TABLE test IGNORE 1 LINES;
@end example

When you use @code{SELECT ... INTO OUTFILE} in tandem with @code{LOAD
DATA INFILE} to write data from a database into a file and then read
the file back into the database later, the field and line handling
options for both commands must match.  Otherwise, @code{LOAD DATA
INFILE} will not interpret the contents of the file properly.  Suppose
you use @code{SELECT ... INTO OUTFILE} to write a file with
fields delimited by commas:

@example
mysql> SELECT * INTO OUTFILE 'data.txt'
    ->          FIELDS TERMINATED BY ','
    ->          FROM ...;
@end example

To read the comma-delimited file back in, the correct statement would be:

@example
mysql> LOAD DATA INFILE 'data.txt' INTO TABLE table2
    ->           FIELDS TERMINATED BY ',';
@end example

If instead you tried to read in the file with the statement shown here, it
wouldn't work because it instructs @code{LOAD DATA INFILE} to look for
tabs between fields:

@example
mysql> LOAD DATA INFILE 'data.txt' INTO TABLE table2
    ->           FIELDS TERMINATED BY '\t';
@end example

The likely result is that each input line would be interpreted as
a single field.

@code{LOAD DATA INFILE} can be used to read files obtained from
external sources, too. For example, a file in dBASE format will have
fields separated by commas and enclosed in double quotes.  If lines in
the file are terminated by newlines, the command shown here
illustrates the field and line handling options you would use to load
the file:

@example
mysql> LOAD DATA INFILE 'data.txt' INTO TABLE tbl_name
    ->           FIELDS TERMINATED BY ',' ENCLOSED BY '"'
    ->           LINES TERMINATED BY '\n';
@end example

Any of the field or line handling options may specify an empty string
(@code{''}).  If not empty, the @code{FIELDS [OPTIONALLY] ENCLOSED BY}
and @code{FIELDS ESCAPED BY} values must be a single character.  The
@code{FIELDS TERMINATED BY} and @code{LINES TERMINATED BY} values may
be more than one character.  For example, to write lines that are
terminated by carriage return-linefeed pairs, or to read a file
containing such lines, specify a @code{LINES TERMINATED BY '\r\n'}
clause.

For example, to read a file of jokes, that are separated with a line
of @code{%%}, into an SQL table you can do:

@example
CREATE TABLE jokes (a INT NOT NULL AUTO_INCREMENT PRIMARY KEY, joke TEXT
NOT NULL);
LOAD DATA INFILE "/tmp/jokes.txt" INTO TABLE jokes FIELDS TERMINATED BY ""
LINES TERMINATED BY "\n%%\n" (joke);
@end example

@code{FIELDS [OPTIONALLY] ENCLOSED BY} controls quoting of fields.  For
output (@code{SELECT ... INTO OUTFILE}), if you omit the word
@code{OPTIONALLY}, all fields are enclosed by the @code{ENCLOSED BY}
character.  An example of such output (using a comma as the field
delimiter) is shown here:

@example
"1","a string","100.20"
"2","a string containing a , comma","102.20"
"3","a string containing a \" quote","102.20"
"4","a string containing a \", quote and comma","102.20"
@end example

If you specify @code{OPTIONALLY}, the @code{ENCLOSED BY} character is
used only to enclose @code{CHAR} and @code{VARCHAR} fields:

@example
1,"a string",100.20
2,"a string containing a , comma",102.20
3,"a string containing a \" quote",102.20
4,"a string containing a \", quote and comma",102.20
@end example

Note that occurrences of the @code{ENCLOSED BY} character within a
field value are escaped by prefixing them with the @code{ESCAPED BY}
character.  Also note that if you specify an empty @code{ESCAPED BY}
value, it is possible to generate output that cannot be read properly by
@code{LOAD DATA INFILE}. For example, the preceding output just shown would
appear as follows if the escape character is empty.  Observe that the
second field in the fourth line contains a comma following the quote, which
(erroneously) appears to terminate the field:

@example
1,"a string",100.20
2,"a string containing a , comma",102.20
3,"a string containing a " quote",102.20
4,"a string containing a ", quote and comma",102.20
@end example

For input, the @code{ENCLOSED BY} character, if present, is stripped
from the ends of field values.  (This is true whether @code{OPTIONALLY}
is specified; @code{OPTIONALLY} has no effect on input interpretation.)
Occurrences of the @code{ENCLOSED BY} character preceded by the
@code{ESCAPED BY} character are interpreted as part of the current
field value.

If the field begins with the @code{ENCLOSED BY} character, instances
of that character are recognized as terminating a field value only
if followed by the field or line @code{TERMINATED BY} sequence.
To avoid ambiguity, occurrences of the @code{ENCLOSED BY} character
within a field value can be doubled and will be interpreted as a
single instance of the character.  For example, if @code{ENCLOSED
BY '"'} is specified, quotes are handled as shown here:

@example
"The ""BIG"" boss"  -> The "BIG" boss
The "BIG" boss      -> The "BIG" boss
The ""BIG"" boss    -> The ""BIG"" boss
@end example

@code{FIELDS ESCAPED BY} controls how to write or read special characters.
If the @code{FIELDS ESCAPED BY} character is not empty, it is used to prefix
the following characters on output:
@itemize @bullet
@item
The @code{FIELDS ESCAPED BY} character
@item
The @code{FIELDS [OPTIONALLY] ENCLOSED BY} character
@item
The first character of the @code{FIELDS TERMINATED BY} and
@code{LINES TERMINATED BY} values
@item
ASCII @code{0} (what is actually written following the escape character is
ASCII @code{'0'}, not a zero-valued byte)
@end itemize

If the @code{FIELDS ESCAPED BY} character is empty, no characters are escaped.
It is probably not a good idea to specify an empty escape character,
particularly if field values in your data contain any of the characters in
the list just given.

For input, if the @code{FIELDS ESCAPED BY} character is not empty, occurrences
of that character are stripped and the following character is taken literally
as part of a field value.  The exceptions are an escaped @samp{0} or
@samp{N} (for example, @code{\0} or @code{\N} if the escape character is
@samp{\}).  These sequences are interpreted as ASCII @code{0} (a zero-valued
byte) and @code{NULL}.  See below for the rules on @code{NULL} handling.

For more information about @samp{\}-escape syntax,
see @ref{Literals}.

In certain cases, field and line handling options interact:

@itemize @bullet
@item
If @code{LINES TERMINATED BY} is an empty string and @code{FIELDS
TERMINATED BY} is non-empty, lines are also terminated with
@code{FIELDS TERMINATED BY}.
@item
If the @code{FIELDS TERMINATED BY} and @code{FIELDS ENCLOSED BY} values
are both empty (@code{''}), a fixed-row (non-delimited) format is used.
With fixed-row format, no delimiters are used between fields (but you
can still have a line terminator). Instead, column values are written
and read using the ``display'' widths of the columns.  For example, if a
column is declared as @code{INT(7)}, values for the column are written
using 7-character fields.  On input, values for the column are obtained
by reading 7 characters.

@code{LINES TERMINATED BY} is still used to separate lines.  If a line
doesn't contain all fields, the rest of the fields will be set to their
default values. If you don't have a line terminator, you should set this
to @code{''}.  In this case the text file must contain all fields for
each row.

Fixed-row format also affects handling of @code{NULL} values; see below.
Note that fixed-size format will not work if you are using a multi-byte
character set.
@end itemize

Handling of @code{NULL} values varies, depending on the @code{FIELDS} and
@code{LINES} options you use:

@itemize @bullet
@item
For the default @code{FIELDS} and @code{LINES} values,
@code{NULL} is written as @code{\N} for output and @code{\N} is read
as @code{NULL} for input (assuming the @code{ESCAPED BY} character
is @samp{\}).

@item
If @code{FIELDS ENCLOSED BY} is not empty, a field containing the literal
word @code{NULL} as its value is read as a @code{NULL} value (this differs
from the word @code{NULL} enclosed within @code{FIELDS ENCLOSED BY}
characters, which is read as the string @code{'NULL'}).

@item
If @code{FIELDS ESCAPED BY} is empty, @code{NULL} is written as the word
@code{NULL}.

@item
With fixed-row format (which happens when @code{FIELDS TERMINATED BY} and
@code{FIELDS ENCLOSED BY} are both empty), @code{NULL} is written as an empty
string.  Note that this causes both @code{NULL} values and empty strings in
the table to be indistinguishable when written to the file because they are
both written as empty strings.  If you need to be able to tell the two apart
when reading the file back in, you should not use fixed-row format.
@end itemize

Some cases are not supported by @code{LOAD DATA INFILE}:
@itemize @bullet

@item
Fixed-size rows (@code{FIELDS TERMINATED BY} and @code{FIELDS ENCLOSED
BY} both empty) and @code{BLOB} or @code{TEXT} columns.

@item
If you specify one separator that is the same as or a prefix of another,
@code{LOAD DATA INFILE} won't be able to interpret the input properly.
For example, the following @code{FIELDS} clause would cause problems:

@example
FIELDS TERMINATED BY '"' ENCLOSED BY '"'
@end example

@item
If @code{FIELDS ESCAPED BY} is empty, a field value that contains an occurrence
of @code{FIELDS ENCLOSED BY} or @code{LINES TERMINATED BY}
followed by the @code{FIELDS TERMINATED BY} value will cause @code{LOAD
DATA INFILE} to stop reading a field or line too early.
This happens because @code{LOAD DATA INFILE} cannot properly determine
where the field or line value ends.
@end itemize

The following example loads all columns of the @code{persondata} table:

@example
mysql> LOAD DATA INFILE 'persondata.txt' INTO TABLE persondata;
@end example

No field list is specified, so @code{LOAD DATA INFILE} expects input rows
to contain a field for each table column.  The default @code{FIELDS} and
@code{LINES} values are used.

If you want to load only some of a table's columns, specify a field list:

@example
mysql> LOAD DATA INFILE 'persondata.txt'
    ->           INTO TABLE persondata (col1,col2,...);
@end example

You must also specify a field list if the order of the fields in the input
file differs from the order of the columns in the table.  Otherwise,
MySQL cannot tell how to match up input fields with table columns.

If a row has too few fields, the columns for which no input field is present
are set to default values.  Default value assignment is described in
@ref{CREATE TABLE, , @code{CREATE TABLE}}.

An empty field value is interpreted differently than if the field value
is missing:

@itemize @bullet
@item
For string types, the column is set to the empty string.

@item
For numeric types, the column is set to @code{0}.

@item
For date and time types, the column is set to the appropriate ``zero''
value for the type.
@xref{Date and time types}.
@end itemize

Note that these are the same values that result if you assign an empty
string explicitly to a string, numeric, or date or time type explicitly
in an @code{INSERT} or @code{UPDATE} statement.

@code{TIMESTAMP} columns are set to the current date and time only if there
is a @code{NULL} value for the column (that is, @code{\N}), or (for the
first @code{TIMESTAMP} column only) if the @code{TIMESTAMP} column is
omitted from the field list when a field list is specified.

If an input row has too many fields, the extra fields are ignored and
the number of warnings is incremented.  Note that before MySQL 4.1.1 the
warnings is just a number to indicate that something went wrong.
In MySQL 4.1.1 you can do @code{SHOW WARNINGS} to get more information for
what went wrong.

@code{LOAD DATA INFILE} regards all input as strings, so you can't use
numeric values for @code{ENUM} or @code{SET} columns the way you can with
@code{INSERT} statements.  All @code{ENUM} and @code{SET} values must be
specified as strings!

@findex mysql_info()
If you are using the C API, you can get information about the query by
calling the API function @code{mysql_info()} when the @code{LOAD DATA INFILE}
query finishes.  The format of the information string is shown here:

@example
Records: 1  Deleted: 0  Skipped: 0  Warnings: 0
@end example

Warnings occur under the same circumstances as when values are inserted
via the @code{INSERT} statement (@pxref{INSERT, , @code{INSERT}}), except
that @code{LOAD DATA INFILE} also generates warnings when there are too few
or too many fields in the input row.  The warnings are not stored anywhere;
the number of warnings can only be used as an indication if everything went
well.

If you get warnings and want to know exactly why you got them, one way
to do this is to use @code{SELECT ... INTO OUTFILE} into another file
and compare this to your original input file.

If you need @code{LOAD DATA} to read from a pipe, you can use the
following trick:

@example
mkfifo /mysql/db/x/x
chmod 666 /mysql/db/x/x
cat < /dev/tcp/10.1.1.12/4711 > /nt/mysql/db/x/x
mysql -e "LOAD DATA INFILE 'x' INTO TABLE x" x
@end example

If you are using a version of MySQL older than 3.23.25
you can only do the above with @code{LOAD DATA LOCAL INFILE}.

In MySQL 4.1.1 you can use @code{SHOW WARNINGS} to get a list of the first
@code{max_error_count} warnings. @xref{SHOW WARNINGS}.

For more information about the efficiency of @code{INSERT} versus
@code{LOAD DATA INFILE} and speeding up @code{LOAD DATA INFILE},
@xref{Insert speed}.


@node REPLACE, SELECT, LOAD DATA, Data Manipulation
@subsection @code{REPLACE} Syntax

@findex REPLACE

@c example_for_help_topic REPLACE INTO
@example
    REPLACE [LOW_PRIORITY | DELAYED]
        [INTO] tbl_name [(col_name,...)]
        VALUES (expression,...),(...),...
or  REPLACE [LOW_PRIORITY | DELAYED]
        [INTO] tbl_name [(col_name,...)]
        SELECT ...
or  REPLACE [LOW_PRIORITY | DELAYED]
        [INTO] tbl_name
        SET col_name=expression, col_name=expression,...
@end example

@c description_for_help_topic REPLACE INTO  DELAYED LOW_PRIORITY INTO VALUES SELECT SET
@code{REPLACE} works exactly like @code{INSERT}, except that if an old
record in the table has the same value as a new record on a @code{UNIQUE}
index or @code{PRIMARY KEY}, the old record is deleted before the new
record is inserted.
@xref{INSERT, ,@code{INSERT}}.

In other words, you can't access the values of the old row from a
@code{REPLACE} statement.  In some old MySQL versions it appeared that
you could do this, but that was a bug that has been corrected.

To be able to use @code{REPLACE}, you must have @code{INSERT} and
@code{DELETE} privileges for the table.
@c end_description_for_help_topic

When you use a @code{REPLACE} command, @code{mysql_affected_rows()}
will return 2 if the new row replaced an old row.  This is because
one row was inserted after the duplicate was deleted.

This fact makes it easy to determine whether @code{REPLACE} added
or replaced a row: check whether the affected-rows value is 1 (added)
or 2 (replaced).

Note that unless the table has a @code{UNIQUE} index or @code{PRIMARY KEY},
using a @code{REPLACE} command makes no sense. It becomes equivalent to
@code{INSERT}, because there is no index to be used to determine whether a new
row duplicates another.

Here follows the used algorithm in more detail:
(This is also used with @code{LOAD DATA ... REPLACE}.)

@example
- Insert the row into the table
  - While duplicate key error for primary or unique key
    - Revert changed keys
    - Read conflicting row from the table through the duplicate key value
    - Delete conflicting row
    - Try again to insert the original primary key and unique keys in the tree
@end example


@node SELECT, Subqueries, REPLACE, Data Manipulation
@subsection @code{SELECT} Syntax

@findex SELECT

@c help SELECT
@c example_for_help_topic SELECT
@example
SELECT [STRAIGHT_JOIN]
       [SQL_SMALL_RESULT] [SQL_BIG_RESULT] [SQL_BUFFER_RESULT]
       [SQL_CACHE | SQL_NO_CACHE] [SQL_CALC_FOUND_ROWS] [HIGH_PRIORITY]
       [DISTINCT | DISTINCTROW | ALL]
    select_expression,...
    [INTO @{OUTFILE | DUMPFILE@} 'file_name' export_options]
    [FROM table_references
      [WHERE where_definition]
      [GROUP BY @{unsigned_integer | col_name | formula@} [ASC | DESC], ...
        [WITH ROLLUP]]
      [HAVING where_definition]
      [ORDER BY @{unsigned_integer | col_name | formula@} [ASC | DESC] ,...]
      [LIMIT [offset,] row_count | row_count OFFSET offset]
      [PROCEDURE procedure_name(argument_list)]
      [FOR UPDATE | LOCK IN SHARE MODE]]
@end example
@c help end

@c description_for_help_topic SELECT  AS ASC DESC ORDER GROUP HAVING BY STRAIGHT_JOIN SQL_SMALL_RESULT SQL_BIG_RESULT SQL_BUFFER_RESULT SQL_CACHE SQL_NO_CACHE SQL_CALC_FOUND_ROWS HIGH_PRIORITY DISTINCT DISTINCTROW ALL INTO FROM OUTFILE DUMPFILE IGNORE JOIN LOCK IN SHARE MODE FOR UPDATE OFFSET LIMIT MEMORY PROCEDURE
@code{SELECT} is used to retrieve rows selected from one or more tables.
Each @code{select_expression} indicates a column you want to retrieve.
@code{SELECT} may also be used to retrieve rows computed without reference to
any table.  
@c end_description_for_help_topic
For example:

@example
mysql> SELECT 1 + 1;
        -> 2
@end example

All clauses used must be given in exactly the order shown in the syntax
description. For example,
a @code{HAVING} clause must come after any @code{GROUP BY} clause and before
any @code{ORDER BY} clause.

@itemize @bullet

@item
@cindex aliases, on expressions
@cindex expression aliases
A @code{SELECT} expression may be given an alias using @code{AS alias_name}.
The alias is used as the expression's column name and can be used with
@code{ORDER BY} or @code{HAVING} clauses.  For example:

@example
mysql> SELECT CONCAT(last_name,', ',first_name) AS full_name
    FROM mytable ORDER BY full_name;
@end example

The @code{AS} keyword is optional when aliasing a @code{SELECT} expression.
The preceding example could have been written like this:

@example
mysql> SELECT CONCAT(last_name,', ',first_name) full_name
    FROM mytable ORDER BY full_name;
@end example

Because the @code{AS} is optional, a subtle problem can occur
if you forget the comma between two @code{SELECT} expressions: MySQL will
interpret the second as an alias name. For example, in the following
statement, @code{columnb} is treated as an alias name:

@example
mysql> SELECT columna columnb FROM mytable;
@end example

@item
It is not allowed to use a column alias in a @code{WHERE} clause,
because the column value may not yet be determined when the
@code{WHERE} clause is executed.
@xref{Problems with alias}.

@item
@findex FROM
@findex AS
@findex USE INDEX
@findex IGNORE INDEX
@findex USE KEY
@findex IGNORE KEY
@findex FORCE INDEX
The @code{FROM table_references} clause indicates the tables from which to
retrieve rows. If you name more than one table, you are performing a
join.  For information on join syntax, see @ref{JOIN, , @code{JOIN}}.
For each table specified, you may optionally specify an alias.
@example
table_name [[AS] alias] [[USE INDEX (key_list)] | [IGNORE INDEX (key_list)] | [FORCE INDEX (key_list)]]
@end example
As of MySQL Version 3.23.12, you can give hints about which
index MySQL should use when retrieving information from a
table. This is useful if @code{EXPLAIN} shows that MySQL is
using the wrong index from the list of possible indexes.  By specifying
@code{USE INDEX (key_list)}, you can tell MySQL to use only one of the
possible indexes to find rows in the table.  The alternative syntax
@code{IGNORE INDEX (key_list)} can be used to tell MySQL to not use some
particular index.

In MySQL 4.0.9 you can also use @code{FORCE INDEX}. This acts likes
@code{USE INDEX (key_list)} but with the addition that a table scan
is assumed to be VERY expensive.  In other words a table scan will
only be used if there is no way to use one of the given index to
find rows in the table.

@code{USE/IGNORE/FORCE KEY} are synonyms for @code{USE/IGNORE/FORCE INDEX}.

@strong{Note:} @code{USE/IGNORE/FORCE INDEX} only affects which indexes are
used when MySQL decides how to find rows in the table and how to do the
join. It doesn't affect whether an index will be used when resolving an
@code{ORDER BY} or @code{GROUP BY}.

In MySQL 4.0.14, you can use @code{SET MAX_SEEKS_FOR_KEY=value} as an
alternative way to force MySQL to prefer key scans instead of table scans.

@item
You can refer to a table as @code{tbl_name} (within the current database),
or as @code{dbname.tbl_name} to explicitly specify a database.
You can refer to a column as @code{col_name}, @code{tbl_name.col_name}, or
@code{db_name.tbl_name.col_name}.  You need not specify a @code{tbl_name} or
@code{db_name.tbl_name} prefix for a column reference in a @code{SELECT}
statement unless the reference would be ambiguous.  See @ref{Legal names},
for examples of ambiguity that require the more explicit column reference
forms.

@item
From version 4.1.0, you are allowed to specify @code{DUAL} as a dummy
table name, in situations where no tables are referenced. This is purely
compatibility feature, some other servers require this syntax.

@example
mysql> SELECT 1 + 1 FROM DUAL;
        -> 2
@end example

@item
@cindex aliases, for tables
@cindex table aliases
A table reference may be aliased using @code{tbl_name [AS] alias_name}:

@example
mysql> SELECT t1.name, t2.salary FROM employee AS t1, info AS t2
    ->        WHERE t1.name = t2.name;
mysql> SELECT t1.name, t2.salary FROM employee t1, info t2
    ->        WHERE t1.name = t2.name;
@end example

@item
Columns selected for output may be referred to in @code{ORDER BY} and
@code{GROUP BY} clauses using column names, column aliases, or column
positions.  Column positions begin with 1:

@example
mysql> SELECT college, region, seed FROM tournament
    ->        ORDER BY region, seed;
mysql> SELECT college, region AS r, seed AS s FROM tournament
    ->        ORDER BY r, s;
mysql> SELECT college, region, seed FROM tournament
    ->        ORDER BY 2, 3;
@end example

To sort in reverse order, add the @code{DESC} (descending) keyword to the
name of the column in the @code{ORDER BY} clause that you are sorting by.
The default is ascending order; this may be specified explicitly using
the @code{ASC} keyword.

@item
In the @code{WHERE} clause, you can use any of the functions that
MySQL supports, except for aggregate (summary) functions.
@xref{Functions}.

@item
The @code{HAVING} clause can refer to any column or alias named in the
@code{select_expression}. It is applied nearly last, just before items are
sent to the client, with no optimization. (@code{LIMIT} is applied after
@code{HAVING}.) Don't use @code{HAVING} for items that
should be in the @code{WHERE} clause.  For example, do not write this:

@example
mysql> SELECT col_name FROM tbl_name HAVING col_name > 0;
@end example

Write this instead:

@example
mysql> SELECT col_name FROM tbl_name WHERE col_name > 0;
@end example

In MySQL Version 3.22.5 or later, you can also write queries like this:

@example
mysql> SELECT user,MAX(salary) FROM users
    ->        GROUP BY user HAVING MAX(salary)>10;
@end example

In older MySQL versions, you can write this instead:

@example
mysql> SELECT user,MAX(salary) AS sum FROM users
    ->        group by user HAVING sum>10;
@end example

@item
The options @code{DISTINCT}, @code{DISTINCTROW} and @code{ALL} specify
whether duplicate rows should be returned. The default is (@code{ALL}),
all matching rows are returned. @code{DISTINCT} and @code{DISTINCTROW}
are synonyms and specify that duplicate rows in the result set should
be removed.

@item
@code{STRAIGHT_JOIN}, @code{HIGH_PRIORITY}, and options beginning with
@code{SQL_} are MySQL extensions to SQL-99.

@itemize @bullet

@item
@cindex hints
@code{STRAIGHT_JOIN} forces the optimizer to join the tables in the order in
which they are listed in the @code{FROM} clause. You can use this to speed up
a query if the optimizer joins the tables in non-optimal order.
@xref{EXPLAIN, , @code{EXPLAIN}}.

@item
@code{HIGH_PRIORITY} will give the @code{SELECT} higher priority than
a statement that updates a table.  You should use this only for queries
that are very fast and must be done at once.  A @code{SELECT HIGH_PRIORITY}
query will run if the table is locked for read even if there is an update
statement that is waiting for the table to be free.

@item
@code{SQL_BIG_RESULT} can be used with @code{GROUP BY} or @code{DISTINCT}
to tell the optimizer that the result set will have many rows.  In this case,
MySQL will directly use disk-based temporary tables if needed.
MySQL will also, in this case, prefer sorting to doing a
temporary table with a key on the @code{GROUP BY} elements.

@item
@code{SQL_BUFFER_RESULT} forces the result to be put into a temporary
table. This helps MySQL free the table locks early and helps
in cases where it takes a long time to send the result set to the client.

@item
@code{SQL_SMALL_RESULT}, a MySQL-specific option, can be used
with @code{GROUP BY} or @code{DISTINCT} to tell the optimizer that the
result set will be small.  In this case, MySQL uses fast
temporary tables to store the resulting table instead of using sorting. In
MySQL Version 3.23 this shouldn't normally be needed.

@item
@code{SQL_CALC_FOUND_ROWS} (version 4.0.0 and up) tells MySQL to calculate
how many rows there would be in the result set, disregarding any
@code{LIMIT} clause.
The number of rows can then be retrieved with @code{SELECT FOUND_ROWS()}.
@xref{Miscellaneous functions}.

Please note that in versions prior to 4.1.0 this does not work with
@code{LIMIT 0}, which is optimized to return instantly (resulting in a
row count of 0). @xref{LIMIT optimisation}.
@item
@code{SQL_CACHE} tells MySQL to store the query result in the query cache
if you are using @code{QUERY_CACHE_TYPE=2} (@code{DEMAND}).
@xref{Query Cache}. For a query that uses @code{UNION} or subqueries, this
option takes effect to be used in any @code{SELECT} of the query.

@item
@code{SQL_NO_CACHE} tells MySQL not to store the query result
in the query cache. @xref{Query Cache}.
For a query that uses @code{UNION} or subqueries, this
option takes effect to be used in any @code{SELECT} of the query.

@end itemize

@item
@cindex @code{GROUP BY}, extensions to standard SQL
If you use @code{GROUP BY}, the output rows will be sorted according to the
@code{GROUP BY} as if you had an @code{ORDER BY} over all the fields
in the @code{GROUP BY}. MySQL has extended the @code{GROUP BY} clause so that
you can also specify @code{ASC} and @code{DESC} after columns named in the
clause:

@example
SELECT a,COUNT(b) FROM test_table GROUP BY a DESC
@end example

@item
MySQL has extended the use of @code{GROUP BY} to allow you to
select fields that are not mentioned in the @code{GROUP BY} clause.
If you are not getting the results you expect from your query, please
read the @code{GROUP BY} description.
@xref{Group by functions and modifiers}.

@item
As of MySQL 4.1.1, @code{GROUP BY} allows a @code{WITH ROLLUP} modifier.
@xref{GROUP-BY-Modifiers, , @code{GROUP BY} Modifiers}.

@item
The @code{LIMIT} clause can be used to constrain the number of rows returned
by the @code{SELECT} statement.  @code{LIMIT} takes one or two numeric
arguments, which must be integer constants.

With one argument, the value specifies the number of rows to return from the
beginning of the result set.
With two arguments, the first argument specifies the offset of the first row to
return, and the second specifies the maximum number of rows to return.
The offset of the initial row is 0 (not 1):

To be compatible with PostgreSQL MySQL also supports the syntax:
@code{LIMIT row_count OFFSET offset}.

@example
mysql> SELECT * FROM table LIMIT 5,10;  # Retrieve rows 6-15
@end example

To retrieve all rows from a certain offset up to the end of the result set,
you can use some large number for the second parameter:

@example
mysql> SELECT * FROM table LIMIT 95,18446744073709551615; # Retrieve rows 96-last.
@end example

If one argument is given, it indicates the maximum number of rows to return:

@example
mysql> SELECT * FROM table LIMIT 5;     # Retrieve first 5 rows
@end example

In other words, @code{LIMIT n} is equivalent to @code{LIMIT 0,n}.

@item
@tindex /etc/passwd
The @code{SELECT ... INTO OUTFILE 'file_name'} form of @code{SELECT} writes
the selected rows to a file. The file is created on the server host and
cannot already exist (among other things, this prevents database tables and
files such as @file{/etc/passwd} from being destroyed).  You must have the
@code{FILE} privilege on the server host to use this form of @code{SELECT}.

The @code{SELECT ... INTO OUTFILE} statement is intended primarily to let you very
quickly dump a table on the server machine. If you want to create the
resulting file on some other host than the server host, you can't use
@code{SELECT ... INTO OUTFILE}. In that case, you should instead use some
client program like @code{mysqldump --tab} or @code{mysql -e "SELECT
..." > outfile} to generate the file.

@code{SELECT ...  INTO OUTFILE} is the complement of @code{LOAD DATA
INFILE}; the syntax for the @code{export_options} part of the statement
consists of the same @code{FIELDS} and @code{LINES} clauses that are used
with the @code{LOAD DATA INFILE} statement.
@xref{LOAD DATA, , @code{LOAD DATA}}.

In the resulting text file, only the following characters are escaped by
the @code{ESCAPED BY} character:

@itemize @bullet
@item The @code{ESCAPED BY} character
@item The first character in @code{FIELDS TERMINATED BY}
@item The first character in @code{LINES TERMINATED BY}
@end itemize

Additionally, @code{ASCII 0} is converted to @code{ESCAPED BY} followed by 0
(@code{ASCII 48}).

The reason for the above is that you @strong{must} escape any @code{FIELDS
TERMINATED BY}, @code{ESCAPED BY}, or @code{LINES TERMINATED BY}
characters to reliably be able to read the file back. @code{ASCII 0} is
escaped to make it easier to view with some pagers.

As the resulting file doesn't have to conform to the SQL syntax, nothing
else need be escaped.

Here follows an example of getting a file in the format used by many
old programs.

@example
SELECT a,b,a+b INTO OUTFILE "/tmp/result.text"
FIELDS TERMINATED BY ',' OPTIONALLY ENCLOSED BY '"'
LINES TERMINATED BY "\n"
FROM test_table;
@end example

@item
@findex DUMPFILE
If you use @code{INTO DUMPFILE} instead of @code{INTO OUTFILE}, MySQL
will write only one row into the file, without any column or line
terminations and without performing any escape processing.  This is useful if you want to
store a @code{BLOB} value in a file.

@item
Note that any file created by @code{INTO OUTFILE} and @code{INTO
DUMPFILE} will be writable by all users on the server host!  The reason is that the
MySQL server can't create a file that is owned by anyone else
than the user it's running as (you should never run @code{mysqld} as
@code{root}).
The file thus must be world-writable so that you can manipulate its contents.

@item
A @code{PROCEDURE} clause names a procedure that should process the data
in the result set.  For an example, see @ref{procedure analyse}.

@item
If you use @code{FOR UPDATE} on a storage engine with page or row locks,
the examined rows are write-locked until the end of the current
transaction.
@end itemize


@menu
* JOIN::                        @code{JOIN} Syntax
* UNION::                       @code{UNION} Syntax
@end menu

@node JOIN, UNION, SELECT, SELECT
@subsubsection @code{JOIN} Syntax

@findex JOIN
@findex INNER JOIN
@findex CROSS JOIN
@findex LEFT JOIN
@findex LEFT OUTER JOIN
@findex NATURAL LEFT JOIN
@findex NATURAL LEFT OUTER JOIN
@findex RIGHT JOIN
@findex RIGHT OUTER JOIN
@findex NATURAL RIGHT JOIN
@findex NATURAL RIGHT OUTER JOIN
@findex STRAIGHT_JOIN

@c description_for_help_topic JOIN  INNER CROSS LEFT OUTER NATURAL RIGHT STRAIGHT_JOIN USE INDEX AS IGNORE FORCE ON USING
MySQL supports the following @code{JOIN} syntaxes for use in
@code{SELECT} statements:

@example
table_reference, table_reference
table_reference [INNER | CROSS] JOIN table_reference [join_condition]
table_reference STRAIGHT_JOIN table_reference
table_reference LEFT [OUTER] JOIN table_reference [join_condition]
table_reference NATURAL [LEFT [OUTER]] JOIN table_reference
@{ OJ table_reference LEFT OUTER JOIN table_reference ON conditional_expr @}
table_reference RIGHT [OUTER] JOIN table_reference [join_condition]
table_reference NATURAL [RIGHT [OUTER]] JOIN table_reference
@end example

Where @code{table_reference} is defined as:
@findex AS
@example
table_name [[AS] alias] [[USE INDEX (key_list)] | [IGNORE INDEX (key_list)] | [FORCE INDEX (key_list)]]
@end example

and @code{join_condition} is defined as:

@example
ON conditional_expr |
USING (column_list)
@end example
@c end_description_for_help_topic

You should generally not have any conditions in the @code{ON} part that are
used to restrict which rows you want in the result set, but rather specify
these conditions in the @code{WHERE} clause. There are exceptions to this rule.

Note that @code{INNER JOIN} syntax allows a @code{join_condition} only from
MySQL 3.23.17 on.  The same is true for @code{JOIN} and @code{CROSS JOIN} only
as of MySQL 4.0.11.

@cindex ODBC compatibility
@cindex compatibility, with ODBC
The last @code{LEFT OUTER JOIN} syntax shown in the preceding list exists only for
compatibility with ODBC:

@itemize @bullet
@item
A table reference may be aliased using @code{tbl_name AS alias_name} or
@code{tbl_name alias_name}:

@example
mysql> SELECT t1.name, t2.salary FROM employee AS t1, info AS t2
    ->        WHERE t1.name = t2.name;
@end example

@item
The @code{ON} conditional is any conditional of the form that may be used in
a @code{WHERE} clause.

@item
If there is no matching record for the right table in the @code{ON} or
@code{USING} part in a @code{LEFT JOIN}, a row with all columns set to
@code{NULL} is used for the right table.  You can use this fact to find
records in a table that have no counterpart in another table:

@c example_for_help_topic JOIN
@example
mysql> SELECT table1.* FROM table1
    ->        LEFT JOIN table2 ON table1.id=table2.id
    ->        WHERE table2.id IS NULL;
@end example

This example finds all rows in @code{table1} with an @code{id} value that is
not present in @code{table2} (that is, all rows in @code{table1} with no
corresponding row in @code{table2}).  This assumes that @code{table2.id} is
declared @code{NOT NULL}. @xref{LEFT JOIN optimisation}.

@item
The @code{USING} @code{(column_list)} clause names a list of columns that must
exist in both tables. The following two clauses are semantically identical:

@example
a LEFT JOIN b USING (c1,c2,c3)
a LEFT JOIN b ON a.c1=b.c1 AND a.c2=b.c2 AND a.c3=b.c3
@end example

@item
The @code{NATURAL [LEFT] JOIN} of two tables is defined to be
semantically equivalent to an @code{INNER JOIN} or a @code{LEFT JOIN}
with a @code{USING} clause that names all columns that exist in both
tables.

@item
@cindex hints
@code{INNER JOIN} and @code{,} (comma) are semantically equivalent in
the absence of a join condition: both will produce a Cartesian product
between the specified tables (that is, each and every row in the first table
will be joined onto all rows in the second table).

@item
@code{RIGHT JOIN} works analogously to @code{LEFT JOIN}.  To keep code
portable across databases, it's recommended to use @code{LEFT JOIN}
instead of @code{RIGHT JOIN}.

@item
@cindex hints
@code{STRAIGHT_JOIN} is identical to @code{JOIN}, except that the left table
is always read before the right table. This can be used for those (few)
cases in which the join optimizer puts the tables in the wrong order.

@item
@cindex hints
@findex USE INDEX
@findex IGNORE INDEX
As of MySQL Version 3.23.12, you can give hints about which
index MySQL should use when retrieving information from a
table. This is useful if @code{EXPLAIN} shows that MySQL is
using the wrong index from the list of possible indexes.  By specifying
@code{USE INDEX (key_list)}, you can tell MySQL to use only one of the
possible indexes to find rows in the table.  The alternative syntax
@code{IGNORE INDEX (key_list)} can be used to tell MySQL to not use some
particular index.

@findex FORCE INDEX
In MySQL 4.0.9 you can also use @code{FORCE INDEX}. This acts likes
@code{USE INDEX (key_list)} but with the addition that a table scan
is assumed to be VERY expensive.  In other words a table scan will
only be used if there is no way to use one of the given index to
find rows in the table.

@findex USE KEY
@findex IGNORE KEY
@code{USE/IGNORE KEY} are synonyms for @code{USE/IGNORE INDEX}.
@end itemize

@strong{Note:} @code{USE/IGNORE/FORCE INDEX} only affects which indexes are
used when MySQL decides how to find rows in the table and how to do the
join. It doesn't affect whether an index will be used when resolving an
@code{ORDER BY} or @code{GROUP BY}.

Some examples:

@example
mysql> SELECT * FROM table1,table2 WHERE table1.id=table2.id;
mysql> SELECT * FROM table1 LEFT JOIN table2 ON table1.id=table2.id;
mysql> SELECT * FROM table1 LEFT JOIN table2 USING (id);
mysql> SELECT * FROM table1 LEFT JOIN table2 ON table1.id=table2.id
    ->          LEFT JOIN table3 ON table2.id=table3.id;
mysql> SELECT * FROM table1 USE INDEX (key1,key2)
    ->          WHERE key1=1 AND key2=2 AND key3=3;
mysql> SELECT * FROM table1 IGNORE INDEX (key3)
    ->          WHERE key1=1 AND key2=2 AND key3=3;
@end example

@xref{LEFT JOIN optimisation, , @code{LEFT JOIN} optimisation}.


@node UNION,  , JOIN, SELECT
@subsubsection @code{UNION} Syntax

@findex UNION

@c example_for_help_topic UNION
@example
SELECT ...
UNION [ALL | DISTINCT]
SELECT ...
  [UNION [ALL | DISTINCT]
   SELECT ...]
@end example

@c description_for_help_topic UNION  ALL
@code{UNION} is implemented in MySQL 4.0.0.

@code{UNION} is used to combine the result from many @code{SELECT}
statements into one result set.

The columns listed in the @code{select_expression} portion of the @code{SELECT}
should have the same type. The column names used in the first
@code{SELECT} query will be used as the column names for the results
returned.
@c end_description_for_help_topic

The @code{SELECT} commands are normal select commands, but with the following
restrictions:

@itemize @bullet
@item
Only the last @code{SELECT} command can have @code{INTO OUTFILE}.
@end itemize

If you don't use the keyword @code{ALL} for the @code{UNION}, all
returned rows will be unique, as if you had done a @code{DISTINCT} for
the total result set.  If you specify @code{ALL}, you will get all
matching rows from all the used @code{SELECT} statements.

The @code{DISTINCT} keyword is an optional word (introduced in MySQL 4.0.17)
that does nothing. But it is required by the SQL standard.

If you want to use an @code{ORDER BY} for the total @code{UNION} result,
you should use parentheses:

@example
(SELECT a FROM table_name WHERE a=10 AND B=1 ORDER BY a LIMIT 10)
UNION
(SELECT a FROM table_name WHERE a=11 AND B=2 ORDER BY a LIMIT 10)
ORDER BY a;
@end example

@strong{Note:} You cannot mix @code{UNION ALL} and @code{UNION
DISTINCT} in the same query yet.  If you use @code{ALL} for one
@code{UNION} then it is used for all of them.
@c this is also written in the "known bugs" section

The types and lengths of the columns in the result set of a @code{UNION}
take into acccount the values retrieved by all the @code{SELECT} statements.
Before MySQL 4.1.1, a limitation of @code{UNION} is that only the values from
the first @code{SELECT} were used to determine result types and lengths.
This could result in value truncation if, for example, the second
@code{SELECT} retrieved longer values than the first @code{SELECT}:

@example
mysql> SELECT REPEAT('a',1) UNION SELECT REPEAT('b',10);
+---------------+
| REPEAT('a',1) |
+---------------+
| a             |
| b             |
+---------------+
@end example

That limitation has been removed as of MySQL 4.1.1:

@example
mysql> SELECT REPEAT('a',1) UNION SELECT REPEAT('b',10);
+---------------+
| REPEAT('a',1) |
+---------------+
| a             |
| bbbbbbbbbb    |
+---------------+
@end example


@node Subqueries, TRUNCATE, SELECT, Data Manipulation
@subsection Subquery Syntax

@cindex subselects
@cindex subqueries
@cindex subquery

A subquery is a @code{SELECT} statement inside another statement.
For example:

@example
SELECT * FROM t1 WHERE column1 = (SELECT column1 FROM t2);
@end example

In the above example, @code{SELECT * FROM t1 ...} is the @emph{outer query}
(or @emph{outer statement}), and @code{(SELECT column1 FROM t2)} is the
@emph{subquery}.
We say that the subquery is @emph{nested} in the outer query, and in fact
it's possible to nest subqueries within other subqueries, to a great depth.
A subquery must always be inside parentheses.

Starting with version 4.1, MySQL supports all subquery forms and operations
which the SQL standard requires, as well as a few features which are
MySQL-specific. The main advantages of subqueries are:

@itemize @bullet
@item
They allow queries which are @emph{structured} so that it's possible to
isolate each part of a statement.
@item
They provide alternative ways to perform operations which would otherwise
require complex joins and unions.
@item
They are, in many people's opinion, readable.
Indeed, it was the innovation of subqueries which gave people the original
idea of calling the early @code{SQL} ``Structured Query Language''.
@end itemize

With earlier MySQL versions it was necessary to work around or avoid
subqueries, but people starting to write code now will find that subqueries
are a very useful part of the toolkit.

Here is an example statement which shows the major points about subquery
syntax as specified by the SQL standard and supported in MySQL.

@example
DELETE FROM t1
WHERE s11 > ANY
 (SELECT COUNT(*) /* no hint */ FROM t2
 WHERE NOT EXISTS
  (SELECT * FROM t3
   WHERE ROW(5*t2.s1,77)=
    (SELECT 50,11*s1 FROM t4 UNION SELECT 50,77 FROM
     (SELECT * FROM t5) AS t5)));
@end example

For MySQL versions prior to 4.1, most subqueries can be successfully
rewritten using joins and and other methods.
@xref{Rewriting subqueries}.


@menu
* Scalar subqueries::           The Subquery as Scalar Operand
* Comparisons using subqueries::  Comparisons Using Subqueries
* ANY IN SOME subqueries::      Subqueries with @code{ANY}, @code{IN}, and @code{SOME}
* ALL subqueries::              Subqueries with @code{ALL}
* Correlated subqueries::       Correlated Subqueries
* EXISTS and NOT EXISTS subqueries::  @code{EXISTS} and @code{NOT EXISTS}
* Row subqueries::              Row Subqueries
* Unnamed views::               Subqueries in the @code{FROM} clause
* Subquery errors::             Subquery Errors
* Optimising subqueries::       Optimizing Subqueries
* Rewriting subqueries::        Rewriting Subqueries for Earlier MySQL Versions
@end menu

@node Scalar subqueries, Comparisons using subqueries, Subqueries, Subqueries
@subsubsection The Subquery as Scalar Operand

In its simplest form (the @emph{scalar} subquery as opposed to the
@emph{row} or @emph{table} subqueries which will be discussed later),
a subquery is a simple operand. Thus you can use it wherever a column value
or literal is legal, and you can expect it to have those characteristics
that all operands have: a data type, a length, an indication whether it can
be @code{NULL}, and so on.
For example:

@example
CREATE TABLE t1 (s1 INT, s2 CHAR(5) NOT NULL);
SELECT (SELECT s2 FROM t1);
@end example

The subquery in the above @code{SELECT} has a data type of @code{CHAR},
a length of 5, a character set and collation equal to the defaults in
effect at @code{CREATE TABLE} time, and an indication that the value in
the column can be @code{NULL}. In fact almost all subqueries can be
@code{NULL}, because if the table is empty -- as in the example -- then
the value of the subquery will be @code{NULL}.
There are few restrictions.

@itemize @bullet
@item
A subquery's outer statement can be any one of:
@code{SELECT}, @code{INSERT}, @code{UPDATE}, @code{DELETE},
@code{SET}, or @code{DO}.
@item
A subquery can contain any of the keywords or clauses that an ordinary
@code{SELECT} can contain:
@code{DISTINCT}, @code{GROUP BY}, @code{ORDER BY}, @code{LIMIT},
joins, hints, @code{UNION} constructs, comments, functions, and so on.
@end itemize

So, when you see examples in the following sections that contain the rather
Spartan construct @code{(SELECT column1 FROM t1)}, imagine that your own
code will contain much more diverse and complex constructions.

For example, suppose we make two tables:

@example
CREATE TABLE t1 (s1 INT);
INSERT INTO t1 VALUES (1);
CREATE TABLE t2 (s1 INT);
INSERT INTO t2 VALUES (2);
@end example

Then perform a @code{SELECT}:

@example
SELECT (SELECT s1 FROM t2) FROM t1;
@end example

The result will be @code{2} because there is a row in @code{t2}, with a
column @code{s1}, with a value of 2.

The subquery may be part of an expression. If it is an operand for a
function, don't forget the parentheses.
For example:

@example
SELECT UPPER((SELECT s1 FROM t1)) FROM t2;
@end example


@node Comparisons using subqueries, ANY IN SOME subqueries, Scalar subqueries, Subqueries
@subsubsection Comparisons Using Subqueries

The most common use of a subquery is in the form:

@example
<non-subquery operand> <comparison operator> (<subquery>)
@end example

Where <comparison operator> is one of:
@example
= > < >= <= <>
@end example

For example:
@example
... 'a' = (SELECT column1 FROM t1)
@end example

At one time the only legal place for a subquery was on the right side of a
comparison, and you might still find some old DBMSs which insist on that.

Here is an example of a common-form subquery comparison which you can't do
with a join: find all the values in table @code{t1} which are equal to a
maximum value in table @code{t2}.

@example
SELECT column1 FROM t1
       WHERE column1 = (SELECT MAX(column2) FROM t2);
@end example

Here is another example, which again is impossible with a join because it
involves aggregating for one of the tables: find all rows in table
@code{t1} which contain a value which occurs twice.

@example
SELECT * FROM t1
       WHERE 2 = (SELECT COUNT(column1) FROM t1);
@end example


@node ANY IN SOME subqueries, ALL subqueries, Comparisons using subqueries, Subqueries
@subsubsection Subqueries with @code{ANY}, @code{IN}, and @code{SOME}

Syntax:
@example
<operand> <comparison operator> ANY (<subquery>)
<operand> IN (<subquery>)
<operand> <comparison operator> SOME (<subquery>)
@end example

The word @code{ANY}, which must follow a comparison operator, means
``return @code{TRUE} if the comparison is @code{TRUE} for @code{ANY} of the
rows that the subquery returns.''
For example,

@example
SELECT s1 FROM t1 WHERE s1 > ANY (SELECT s1 FROM t2);
@end example

Suppose that there is a row in table @code{t1} containing @{10@}.
The expression is @code{TRUE} if table @code{t2} contains @{21,14,7@} because
there is a value in @code{t2} -- 7 -- which is less than 10.
The expression is @code{FALSE} if table @code{t2} contains @{20,10@},
or if table @code{t2} is empty.
The expression is @code{UNKNOWN} if table @code{t2} contains
@{@code{NULL},@code{NULL},@code{NULL}@}.

The word @code{IN} is an alias for @code{= ANY}. Thus these two statements
are the same:

@example
SELECT s1 FROM t1 WHERE s1 = ANY (SELECT s1 FROM t2);
SELECT s1 FROM t1 WHERE s1 IN    (SELECT s1 FROM t2);
@end example

The word @code{SOME} is an alias for @code{ANY}. Thus these two statements
are the same:

@example
SELECT s1 FROM t1 WHERE s1 <> ANY  (SELECT s1 FROM t2);
SELECT s1 FROM t1 WHERE s1 <> SOME (SELECT s1 FROM t2);
@end example

Use of the word @code{SOME} is rare, but the above example shows why it
might be useful. The English phrase ``a is not equal to any b'' means, to
most people's ears, ``there is no b which is equal to a'' -- which isn't
what is meant by the SQL syntax. By using @code{<> SOME} instead, you
ensure that everyone understands the true meaning of the query.


@node ALL subqueries, Correlated subqueries, ANY IN SOME subqueries, Subqueries
@subsubsection Subqueries with @code{ALL}

Syntax:
@example
<operand> <comparison operator> ALL (<subquery>)
@end example

The word @code{ALL}, which must follow a comparison operator, means
``return @code{TRUE} if the comparison is @code{TRUE} for @code{ALL} of
the rows that the subquery returns''.
For example,

@example
SELECT s1 FROM t1 WHERE s1 > ALL (SELECT s1 FROM t2);
@end example

Suppose that there is a row in table @code{t1} containing @{10@}.
The expression is @code{TRUE} if table @code{t2} contains @{-5,0,+5@}
because all three values in @code{t2} are less than 10.
The expression is @code{FALSE} if table @code{t2} contains
@{12,6,NULL,-100@} because there is a single value in table @code{t2} -- 12
-- which is greater than 10.
The expression is @code{UNKNOWN} if table @code{t2} contains @{0,NULL,1@}.

Finally, if table @code{t2} is empty, the result is @code{TRUE}.
You might think the result should be @code{UNKNOWN}, but
sorry, it's @code{TRUE}. So, rather oddly,

@example
SELECT * FROM t1 WHERE 1 > ALL (SELECT s1 FROM t2);
@end example

is @code{TRUE} when table @code{t2} is empty, but

@example
SELECT * FROM t1 WHERE 1 > (SELECT s1 FROM t2);
@end example

is @code{UNKNOWN} when table @code{t2} is empty. In addition,

@example
SELECT * FROM t1 WHERE 1 > ALL (SELECT MAX(s1) FROM t2);
@end example

is @code{UNKNOWN} when table @code{t2} is empty.
In general, @emph{tables with NULLs} and @emph{empty tables} are
@emph{edge cases} -- when writing subquery code, always consider whether
you have taken those two possibilities into account.


@node Correlated subqueries, EXISTS and NOT EXISTS subqueries, ALL subqueries, Subqueries
@subsubsection Correlated Subqueries

A @emph{correlated subquery} is a subquery which contains a reference to a
column which is also in the outer query.
For example:

@example
SELECT * FROM t1 WHERE column1 = ANY
       (SELECT column1 FROM t2 WHERE t2.column2 = t1.column2);
@end example

Notice, in the example, that the subquery contains a reference to a column
of @code{t1}, even though the subquery's @code{FROM} clause doesn't mention
a table @code{t1}. So MySQL looks outside the subquery, and finds t1 in the
outer query.

Suppose that table @code{t1} contains a row where @code{column1 = 5} and
@code{column2 = 6}; meanwhile table @code{t2} contains a row where
@code{column1 = 5} and @code{column2 = 7}. The simple expression
@code{... WHERE column1 = ANY (SELECT column1 FROM t2)} would be
@code{TRUE}, but in this example the @code{WHERE} clause within the
subquery is @code{FALSE} (because 7 <> 5), so the subquery as a whole is
@code{FALSE}.

@strong{Scoping rule:} MySQL evaluates from inside to outside.
For example:

@example
SELECT column1 FROM t1 AS x
  WHERE x.column1 = (SELECT column1 FROM t2 AS x
    WHERE x.column1 = (SELECT column1 FROM t3 WHERE x.column2 = t3.column1));
@end example

In the above, @code{x.column2} must be a column in table @code{t2} because
@code{SELECT column1 FROM t2 AS x ...} renames @code{t2}. It is not a
column in table @code{t1} because @code{SELECT column1 FROM t1 ...} is an
outer query which is @emph{further out}.

For subqueries in @code{HAVING} or @code{ORDER BY} clauses, MySQL also
looks for column names in the outer select list.

MySQL's unofficial recommendation is: avoid correlation
because it makes your queries look more complex, and
run more slowly.


@node EXISTS and NOT EXISTS subqueries, Row subqueries, Correlated subqueries, Subqueries
@subsubsection @code{EXISTS} and @code{NOT EXISTS}

If a subquery returns any values at all, then @code{EXISTS <subquery>} is
@code{TRUE}, and @code{NOT EXISTS <subquery>} is @code{FALSE}.
For example:

@example
SELECT column1 FROM t1 WHERE EXISTS (SELECT * FROM t2);
@end example

Traditionally an @code{EXISTS} subquery starts with @code{SELECT *} but it
could begin with @code{SELECT 5} or @code{SELECT column1} or anything at
all -- MySQL ignores the @code{SELECT} list in such a subquery, so it
doesn't matter.

For the above example, if @code{t2} contains any rows, even rows with
nothing but @code{NULL} values, then the @code{EXISTS} condition is
@code{TRUE}. This is actually an unlikely example, since almost always a
@code{[NOT] EXISTS} subquery will contain correlations.
Here are some more realistic examples.

Example: What kind of store is present in one or
more cities?
@example
SELECT DISTINCT store_type FROM Stores
  WHERE EXISTS (SELECT * FROM Cities_Stores
                WHERE Cities_Stores.store_type = Stores.store_type);
@end example

Example: What kind of store is present in no cities?
@example
SELECT DISTINCT store_type FROM Stores
  WHERE NOT EXISTS (SELECT * FROM Cities_Stores
                    WHERE Cities_Stores.store_type = Stores.store_type);
@end example

Example: What kind of store is present in all cities?
@example
SELECT DISTINCT store_type FROM Stores S1
  WHERE NOT EXISTS (
    SELECT * FROM Cities WHERE NOT EXISTS (
      SELECT * FROM Cities_Stores
       WHERE Cities_Stores.city = Cities.city
       AND Cities_Stores.store_type = Stores.store_type));
@end example

The last example is a double-nested @code{NOT EXISTS} query -- it has a
@code{NOT EXISTS} clause within a @code{NOT EXISTS} clause. Formally, it
answers the question ``does a city exist with a store which is not in
Stores?''. But it's easier to say that a nested @code{NOT EXISTS} answers
the question ``is x TRUE for all y?''.


@node Row subqueries, Unnamed views, EXISTS and NOT EXISTS subqueries, Subqueries
@subsubsection Row Subqueries

The discussion to this point has been of
@emph{column (or scalar) subqueries} -- subqueries which return a single
column value. A @emph{row subquery} is a subquery variant that returns a
single row value -- and may thus return more than one column value.
Here are two examples:

@example
SELECT * FROM t1 WHERE (1,2) = (SELECT column1, column2 FROM t2);
SELECT * FROM t1 WHERE ROW(1,2) = (SELECT column1, column2 FROM t2);
@end example

The queries above are both @code{TRUE} if table @code{t2} has
a row where @code{column1 = 1} and @code{column2 = 2}.

The expression @code{(1,2)} is sometimes called a @emph{row constructor}
and is legal in other contexts too. For example

@example
SELECT * FROM t1 WHERE (column1,column2) = (1,1);
@end example

is equivalent to
@example
SELECT * FROM t1 WHERE column1 = 1 AND column2 = 1;
@end example

The normal use of row constructors, though, is for comparisons with
subqueries that return two or more columns. For example, this query answers
the request: ``find all rows in table t1 which are duplicated in table t2'':

@example
SELECT column1,column2,column3
       FROM t1
       WHERE (column1,column2,column3) IN
             (SELECT column1,column2,column3 FROM t2);
@end example


@node Unnamed views, Subquery errors, Row subqueries, Subqueries
@subsubsection Subqueries in the @code{FROM} clause

@cindex derived tables
@cindex unnamed views

Subqueries are legal in a @code{SELECT} statement's @code{FROM} clause.
The syntax that you'll actually see is:

@example
SELECT ... FROM (<subquery>) AS <name> ...
@end example

The @code{AS <name>} clause is mandatory, because any table in a
@code{FROM} clause must have a name. Any columns in the @code{<subquery>}
select list must have unique names. You may find this syntax described
elsewhere in this manual, where the term used is ``derived tables''.

For illustration, assume you have this table:
@example
CREATE TABLE t1 (s1 INT, s2 CHAR(5), s3 FLOAT);
@end example

Here's how to use the @emph{Subqueries in the FROM clause} feature, using
the example table:

@example
INSERT INTO t1 VALUES (1,'1',1.0);
INSERT INTO t1 VALUES (2,'2',2.0);
SELECT sb1,sb2,sb3
       FROM (SELECT s1 AS sb1, s2 AS sb2, s3*2 AS sb3 FROM t1) AS sb
       WHERE sb1 > 1;
@end example

Result: 2, '2', 4.0.

Here's another example: Suppose you want to know the average of the sum for
a grouped table. This won't work:
@example
SELECT AVG(SUM(column1)) FROM t1 GROUP BY column1;
@end example

But this query will provide the desired information:

@example
SELECT AVG(sum_column1)
       FROM (SELECT SUM(column1) AS sum_column1
             FROM t1 GROUP BY column1) AS t1;
@end example

Notice that the column name used within the subquery
@code{(sum_column1)} is recognized in the outer query.

At the moment, subqueries in the @code{FROM} clause cannot be correlated
subqueries.


@node Subquery errors, Optimising subqueries, Unnamed views, Subqueries
@subsubsection Subquery Errors

There are some new error returns which apply only to subqueries.
This section groups them together because reviewing them will help
remind you of some points.

@itemize @bullet
@item
@example
ERROR 1235 (ER_NOT_SUPPORTED_YET)
SQLSTATE = 42000
Message = "This version of MySQL doesn't yet support
'LIMIT & IN/ALL/ANY/SOME subquery'"
@end example

This means that

@example
SELECT * FROM t1 WHERE s1 IN (SELECT s2 FROM t2 ORDER BY s1 LIMIT 1)
@end example

will not work, but only in some early versions, such as MySQL 4.1.1.

@item
@example
ERROR 1240 (ER_CARDINALITY_COL)
SQLSTATE = 21000
Message = "Operand should contain 1 column(s)"
@end example

This error will occur in cases like this:

@example
SELECT (SELECT column1, column2 FROM t2) FROM t1;
@end example

It's okay to use a subquery that returns multiple columns, if the purpose
is comparison. @xref{Row subqueries}.
But in other contexts the subquery must be a scalar operand.

@item
@example
ERROR 1241 (ER_SUBSELECT_NO_1_ROW)
SQLSTATE = 21000
Message = "Subquery returns more than 1 row"
@end example

This error will occur in cases like this:
@example
SELECT * FROM t1 WHERE column1 = (SELECT column1 FROM t2);
@end example

but only when there is more than one row in @code{t2}. That means this
error might occur in code that has been working for years, because somebody
happened to make a change which affected the number of rows that the
subquery can return. Remember that if the object is to find any number of
rows, not just one, then the correct statement would look like this:

@example
SELECT * FROM t1 WHERE column1 = ANY (SELECT column1 FROM t2);
@end example

@item
@example
Error 1093 (ER_UPDATE_TABLE_USED)
SQLSTATE = HY000
Message = "You can't specify target table 'x' for update in FROM clause"
@end example

This error will occur in cases like this:

@example
UPDATE t1 SET column2 = (SELECT MAX(column1) FROM t1);
@end example
@end itemize

It's okay to use a subquery for assignment within an
@code{UPDATE} statement, since subqueries are legal in @code{UPDATE}
and in @code{DELETE} statements as well as in @code{SELECT} statements.
However, you cannot use the same table, in this case table @code{t1}, for
both the subquery's @code{FROM} clause and the update target.

Usually, failure of the subquery causes the entire statement to fail.


@node Optimising subqueries, Rewriting subqueries, Subquery errors, Subqueries
@subsubsection Optimizing Subqueries

Development is ongoing, so no optimization tip is reliable for the long
term. Some interesting tricks that you might want to play with are:

@itemize @bullet
@item
Using subquery clauses which affect the number or order of the rows in the
subquery, for example

@example
SELECT * FROM t1 WHERE t1.column1 IN
  (SELECT column1 FROM t2 ORDER BY column1);
SELECT * FROM t1 WHERE t1.column1 IN
  (SELECT DISTINCT column1 FROM t2);
SELECT * FROM t1 WHERE EXISTS
  (SELECT * FROM t2 LIMIT 1);
@end example

@item
Replacing a join with a subquery, for example

@example
SELECT DISTINCT column1 FROM t1 WHERE t1.column1 IN (
  SELECT column1 FROM t2);
@end example

instead of

@example
SELECT DISTINCT t1.column1 FROM t1, t2
  WHERE t1.column1 = t2.column1;
@end example

@item
Moving clauses from outside to inside the subquery, for example:

@example
SELECT * FROM t1
  WHERE s1 IN (SELECT s1 FROM t1 UNION ALL SELECT s1 FROM t2);
@end example

instead of

@example
SELECT * FROM t1
  WHERE s1 IN (SELECT s1 FROM t1) OR s1 IN (SELECT s1 FROM t2);
@end example

For another example:

@example
SELECT (SELECT column1 + 5 FROM t1) FROM t2;
@end example

instead of

@example
SELECT (SELECT column1 FROM t1) + 5 FROM t2;
@end example

@item
Using a row subquery instead of a correlated subquery, for example:

@example
SELECT * FROM t1
  WHERE (column1,column2) IN (SELECT column1,column2 FROM t2);
@end example

instead of

@example
SELECT * FROM t1
  WHERE EXISTS (SELECT * FROM t2 WHERE t2.column1=t1.column1
  AND t2.column2=t1.column2);
@end example

@item
Using @code{NOT (a = ANY (...))} rather than @code{a <> ALL (...)}.

@item
Using @code{x = ANY (table containing @{1,2@})} rather than
@code{x=1 OR x=2}.

@item
Using @code{= ANY} rather than @code{EXISTS}
@end itemize

The above tricks may cause programs to go faster or slower. Using MySQL
facilities like the @code{BENCHMARK()} function, you can get an idea about
what helps in your own situation. Don't worry too much about transforming
to joins except for compatibility with older versions.

Some optimizations that MySQL itself will make are:

@enumerate
@item
MySQL will execute non-correlated subqueries only once, (use @code{EXPLAIN}
to make sure that a given subquery really is non-correlated),

@item
MySQL will rewrite @code{IN}/@code{ALL}/@code{ANY}/@code{SOME} subqueries
in an attempt to take advantage of the possibility that the select-list
columns in the subquery are indexed,

@item
MySQL will replace subqueries of the form

@example
... IN (SELECT indexed_column FROM single_table ...)
@end example

with an index-lookup function, which @code{EXPLAIN} will describe as a
special join type,

@item
MySQL will enhance expressions of the form

@example
value @{ALL|ANY|SOME@} @{> | < | >= | <=@} (non-correlated subquery)
@end example

with an expression involving @code{MIN} or @code{MAX} (unless @code{NULL}
values or empty sets are involved). For example,

@example
WHERE 5 > ALL (SELECT x FROM t)
@end example

might be treated as

@example
WHERE 5 > (SELECT MAX(x) FROM t)
@end example

@end enumerate

There is a chapter titled ``How MySQL Transforms Subqueries''
in the MySQL Internals Manual, which you can find by downloading the
MySQL source package and looking for a file named @file{internals.texi}.


@node Rewriting subqueries,  , Optimising subqueries, Subqueries
@subsubsection Rewriting Subqueries for Earlier MySQL Versions

Up to version 4.0, only nested queries of the form
@code{INSERT ... SELECT ...} and @code{REPLACE ... SELECT ...}
are supported.
The @code{IN()} construct can be used in other contexts.

It is often possible to rewrite a query without a subquery:

@example
SELECT * FROM t1 WHERE id IN (SELECT id FROM t2);
@end example

This can be rewritten as:

@example
SELECT t1.* FROM t1,t2 WHERE t1.id=t2.id;
@end example

The queries:
@example
SELECT * FROM t1 WHERE id NOT IN (SELECT id FROM t2);
SELECT * FROM t1 WHERE NOT EXISTS (SELECT id FROM t2 WHERE t1.id=t2.id);
@end example

Can be rewritten as:

@example
SELECT table1.* FROM table1 LEFT JOIN table2 ON table1.id=table2.id
                                       WHERE table2.id IS NULL;
@end example

A @code{LEFT [OUTER] JOIN} can be faster than an equivalent subquery
because the server might be able to optimize it better -- a fact that is
not specific to MySQL Server alone.
Prior to SQL-92, outer joins did not exist, so subqueries were the only way
to do certain things in those bygone days. Today, MySQL Server and many
other modern database systems offer a whole range of outer joins types.

For more complicated subqueries you can often create temporary tables
to hold the subquery.  In some cases, however, this option will not
work. The most frequently encountered of these cases arises with
@code{DELETE} statements, for which standard SQL does not support joins
(except in subqueries).  For this situation there are three options
available:

@itemize @bullet
@item
The first option is to upgrade to MySQL version 4.1.

@item
The second option is to use a procedural programming language (such as
Perl or PHP) to submit a @code{SELECT} query to obtain the primary keys
for the records to be deleted, and then use these values to construct
the @code{DELETE} statement (@code{DELETE FROM ... WHERE ... IN (key1,
key2, ...)}).

@item
The third option is to use interactive SQL to construct a set of
@code{DELETE} statements automatically, using the MySQL
extension @code{CONCAT()} (in lieu of the standard @code{||} operator).
For example:

@example
SELECT CONCAT('DELETE FROM tab1 WHERE pkid = ', "'", tab1.pkid, "'", ';')
  FROM tab1, tab2
 WHERE tab1.col1 = tab2.col2;
@end example

You can place this query in a script file and redirect input from it to
the @code{mysql} command-line interpreter, piping its output back to a
second instance of the interpreter:

@example
shell> mysql --skip-column-names mydb < myscript.sql | mysql mydb
@end example
@end itemize

MySQL Server 4.0 supports multiple-table @code{DELETE} statements that can be used to
efficiently delete rows based on information from one table or even
from many tables at the same time.
Multiple-table @code{UPDATE} statements are also supported from version 4.0.


@node TRUNCATE, UPDATE, Subqueries, Data Manipulation
@subsection @code{TRUNCATE} Syntax

@findex TRUNCATE

@c example_for_help_topic TRUNCATE TABLE
@example
TRUNCATE TABLE table_name
@end example

@c description_for_help_topic TRUNCATE TABLE
In 3.23 @code{TRUNCATE TABLE} is mapped to
@code{COMMIT; DELETE FROM table_name}. @xref{DELETE}.

@code{TRUNCATE TABLE} differs from @code{DELETE FROM ...}
in the following ways:

@itemize @bullet
@item
Truncate operations drop and re-create the table, which is much faster
than deleting rows one by one.
@item
Truncate operations are not transaction-safe; you will get an error if
you have an active transaction or an active table lock.
@item
The number of deleted rows is not returned.
@item
As long as the table definition file @file{table_name.frm} is
valid, the table can be re-created this way, even if the data or index
files have become corrupted.
@item
The table handler may not remember the last used @code{AUTO_INCREMENT} value
but may start counting from the beginning.  This is true for
@code{MyISAM}, @code{ISAM}, and @code{BDB} tables.
@end itemize


@code{TRUNCATE TABLE} is an Oracle SQL extension.
This statement was added in MySQL 3.23.28, although from 3.23.28
to 3.23.32, the keyword @code{TABLE} must be omitted.
@c end_description_for_help_topic


@node UPDATE,  , TRUNCATE, Data Manipulation
@subsection @code{UPDATE} Syntax

@findex UPDATE

@c example_for_help_topic UPDATE
@example
UPDATE [LOW_PRIORITY] [IGNORE] tbl_name
    SET col_name1=expr1 [, col_name2=expr2 ...]
    [WHERE where_definition]
    [ORDER BY ...]
    [LIMIT row_count]
@end example

or:

@example
UPDATE [LOW_PRIORITY] [IGNORE] tbl_name [, tbl_name ...]
    SET col_name1=expr1 [, col_name2=expr2 ...]
    [WHERE where_definition]
@end example

@c description_for_help_topic UPDATE  BY LOW_PRIORITY IGNORE SET ORDER LIMIT WHERE
@code{UPDATE} updates columns in existing table rows with new values.
The @code{SET} clause indicates which columns to modify and the values
they should be given.  The @code{WHERE} clause, if given, specifies
which rows should be updated.  Otherwise, all rows are updated. If the
@code{ORDER BY} clause is specified, the rows will be updated in the
order that is specified.

If you specify the keyword @code{LOW_PRIORITY}, execution of the
@code{UPDATE} is delayed until no other clients are reading from the table.

If you specify the keyword @code{IGNORE}, the update statement will not
abort even if duplicate key errors occur during the update.  Rows that
would cause conflicts will not be updated.
@c end_description_for_help_topic

If you access a column from @code{tbl_name} in an expression,
@code{UPDATE} uses the current value of the column.  For example, the
following statement sets the @code{age} column to one more than its
current value:

@example
mysql> UPDATE persondata SET age=age+1;
@end example

@code{UPDATE} assignments are evaluated from left to right.  For example, the
following statement doubles the @code{age} column, then increments it:

@example
mysql> UPDATE persondata SET age=age*2, age=age+1;
@end example

If you set a column to the value it currently has, MySQL notices
this and doesn't update it.

@findex mysql_info()
@code{UPDATE} returns the number of rows that were actually changed.
In MySQL Version 3.22 or later, the C API function @code{mysql_info()}
returns the number of rows that were matched and updated and the number of
warnings that occurred during the @code{UPDATE}.
If you update a column that has been declared @code{NOT NULL} by
setting to @code{NULL}, the column is set to the default value appropriate
for the column type and the warning count is incremented.  The default
value is is @code{0} for numeric types, the empty string (@code{''})
for string types, and the ``zero'' value for date and time types.

Starting from MySQL version 3.23, you can use @code{LIMIT row_count} to
restrict the scope of the @code{UPDATE}. A @code{LIMIT} clause works as
follows:

@itemize @bullet
@item
Before MySQL 4.0.13, @code{LIMIT} is a rows-affected restriction.
The statement stops as soon as it has changed @code{row_count} rows that
satisfy the @code{WHERE} clause.

@item
From 4.0.13 on, @code{LIMIT} is a rows-matched restriction.  The statement
stops as soon as it has found @code{row_count} rows that satisfy the
@code{WHERE} clause, whether or not they actually were changed.

@end itemize

If an @code{ORDER BY} clause is used (available from MySQL 4.0.0), the rows
will be updated in that order. This is really useful only in conjunction
with @code{LIMIT}.

Starting with MySQL Version 4.0.4, you can also perform @code{UPDATE}
operations that cover multiple tables:

@example
UPDATE items,month SET items.price=month.price
WHERE items.id=month.id;
@end example

The example shows an inner join using the comma operator, but
multiple-table @code{UPDATE} statements can use any type of
join allowed in @code{SELECT} statements, such as @code{LEFT JOIN}.

Note: You cannot use @code{ORDER BY} or @code{LIMIT} with multiple-table
@code{UPDATE}.

Before MySQL 4.0.18 one needed the @code{UPDATE} privilege for all
tables used in a multi table @code{UPDATE} (even if they where not
updated).  In MySQL 4.0.18 one need the @code{SELECT} privilege for any
columns that are only read.


@node Data Definition, Basic User Commands, Data Manipulation, SQL Syntax
@section Data Definition Statements
@c help_category Data Definition
@menu
* ALTER DATABASE::              @code{ALTER DATABASE} Syntax
* ALTER TABLE::                 @code{ALTER TABLE} Syntax
* CREATE DATABASE::             @code{CREATE DATABASE} Syntax
* CREATE INDEX::                @code{CREATE INDEX} Syntax
* CREATE TABLE::                @code{CREATE TABLE} Syntax
* DROP DATABASE::               @code{DROP DATABASE} Syntax
* DROP INDEX::                  @code{DROP INDEX} Syntax
* DROP TABLE::                  @code{DROP TABLE} Syntax
* RENAME TABLE::                @code{RENAME TABLE} Syntax
@end menu


@node ALTER DATABASE, ALTER TABLE, Data Definition, Data Definition
@subsection @code{ALTER DATABASE} Syntax

@findex ALTER DATABASE
@cindex changing, database
@cindex database, changing

@c example_for_help_topic ALTER DATABASE
@example
ALTER DATABASE db_name alter_specification [, alter_specification] ....

alter_specification:
    [DEFAULT] CHARACTER SET charset_name
  | [DEFAULT] COLLATE collation_name
@end example

@c description_for_help_topic ALTER DATABASE  CHARACTER SET

@code{ALTER DATABASE} allows you to change the overall characteristics of
a database.
@c end_description_for_help_topic

The @code{CHARACTER SET} clause changes the database character set.
The @code{COLLATE} clause changes the database collation.

Database characteristics are stored in the @file{db.opt} file in the
database directory.

To use @code{ALTER DATABASE}, you need the @code{ALTER} privilege on the
database.

@c It's really 4.1.0, but with a different syntax than in 4.1.1.
@c (COLLATE is not supported.)
@code{ALTER DATABASE} was added in MySQL 4.1.1.

@node ALTER TABLE, CREATE DATABASE, ALTER DATABASE, Data Definition
@subsection @code{ALTER TABLE} Syntax

@findex ALTER TABLE
@cindex changing, table
@cindex table, changing

@c example_for_help_topic ALTER TABLE
@example
ALTER [IGNORE] TABLE tbl_name alter_specification [, alter_specification] ...

alter_specification:
    ADD [COLUMN] create_definition [FIRST | AFTER column_name ]
  | ADD [COLUMN] (create_definition, create_definition,...)
  | ADD INDEX [index_name] [index_type] (index_col_name,...)
  | ADD [CONSTRAINT [symbol]] PRIMARY KEY [index_type] (index_col_name,...)
  | ADD [CONSTRAINT [symbol]] UNIQUE [index_name] [index_type] (index_col_name,...)
  | ADD FULLTEXT [index_name] (index_col_name,...)
  | ADD [CONSTRAINT [symbol]] FOREIGN KEY [index_name] (index_col_name,...)
           [reference_definition]
  | ALTER [COLUMN] col_name @{SET DEFAULT literal | DROP DEFAULT@}
  | CHANGE [COLUMN] old_col_name create_definition
           [FIRST | AFTER column_name]
  | MODIFY [COLUMN] create_definition [FIRST | AFTER column_name]
  | DROP [COLUMN] col_name
  | DROP PRIMARY KEY
  | DROP INDEX index_name
  | DISABLE KEYS
  | ENABLE KEYS
  | RENAME [TO] new_tbl_name
  | ORDER BY col
  | CHARACTER SET character_set_name [COLLATE collation_name]
  | table_options
@end example

@c description_for_help_topic ALTER TABLE  ADD ALTER AFTER AVG_ROW_LENGTH BY COLUMN FIRST INDEX PRIMARY KEY KEYS UNIQUE FULLTEXT CONSTRAINT DROP DISABLE ENABLE RENAME ORDER MODIFY CHANGE DEFAULT SET FOREIGN IGNORE ENGINE TYPE
@code{ALTER TABLE} allows you to change the structure of an existing table.
For example, you can add or delete columns, create or destroy indexes, change
the type of existing columns, or rename columns or the table itself.  You can
also change the comment for the table and type of the table.
@c end_description_for_help_topic
@xref{CREATE TABLE, , @code{CREATE TABLE}}.

If you use @code{ALTER TABLE} to change a column specification but
@code{DESCRIBE tbl_name} indicates that your column was not changed, it is
possible that MySQL ignored your modification for one of the reasons
described in @ref{Silent column changes}.  For example, if you try to change
a @code{VARCHAR} column to @code{CHAR}, MySQL will still use
@code{VARCHAR} if the table contains other variable-length columns.

@code{ALTER TABLE} works by making a temporary copy of the original table.
The alteration is performed on the copy, then the original table is
deleted and the new one is renamed. This is done in such a way that
all updates are automatically redirected to the new table without
any failed updates. While @code{ALTER TABLE} is executing, the original
table is readable by other clients. Updates and writes to the table
are stalled until the new table is ready.

Note that if you use any other option to @code{ALTER TABLE} than
@code{RENAME}, MySQL will always create a temporary table, even
if the data wouldn't strictly need to be copied (such as when you change the
name of a column). We plan to fix this in the future, but as one doesn't
normally do @code{ALTER TABLE} that often this isn't that high on our TODO.
For MyISAM tables, you can speed up the index recreation part (which is the
slowest part of the recreation process) by setting the
@code{myisam_sort_buffer_size} variable to a high value.

@itemize @bullet
@item
To use @code{ALTER TABLE}, you need @code{ALTER}, @code{INSERT},
and @code{CREATE} privileges on the table.

@item
@code{IGNORE} is a MySQL extension to SQL-92.
It controls how @code{ALTER TABLE} works if there are duplicates on
unique keys in the new table.
If @code{IGNORE} isn't specified, the copy is aborted and rolled back.
If @code{IGNORE} is specified, then for rows with duplicates on a unique
key, only the first row is used; the others are deleted.

@item
You can issue multiple @code{ADD}, @code{ALTER}, @code{DROP}, and
@code{CHANGE} clauses in a single @code{ALTER TABLE} statement. This is a
MySQL extension to SQL-92, which allows only one of each clause
per @code{ALTER TABLE} statement.

@item
@code{CHANGE col_name}, @code{DROP col_name}, and @code{DROP
INDEX} are MySQL extensions to SQL-92.

@item
@code{MODIFY} is an Oracle extension to @code{ALTER TABLE}.

@item
The optional word @code{COLUMN} is a pure noise word and can be omitted.

@item
If you use @code{ALTER TABLE tbl_name RENAME TO new_name} without any other
options, MySQL simply renames the files that correspond to the table
@code{tbl_name}.  There is no need to create the temporary table.
@xref{RENAME TABLE,, @code{RENAME TABLE}}.

@item
@code{create_definition} clauses use the same syntax for @code{ADD} and
@code{CHANGE} as for @code{CREATE TABLE}.  Note that this syntax includes
the column name, not just the column type.
@xref{CREATE TABLE, , @code{CREATE TABLE}}.

@item
You can rename a column using a @code{CHANGE old_col_name create_definition}
clause.  To do so, specify the old and new column names and the type that
the column currently has.  For example, to rename an @code{INTEGER} column
from @code{a} to @code{b}, you can do this:

@example
mysql> ALTER TABLE t1 CHANGE a b INTEGER;
@end example

If you want to change a column's type but not the name, @code{CHANGE}
syntax still requires an old and new column name, even if they are the same.
For example:

@example
mysql> ALTER TABLE t1 CHANGE b b BIGINT NOT NULL;
@end example

However, as of MySQL Version 3.22.16a, you can also use @code{MODIFY}
to change a column's type without renaming it:

@example
mysql> ALTER TABLE t1 MODIFY b BIGINT NOT NULL;
@end example

@item
If you use @code{CHANGE} or @code{MODIFY} to shorten a column for which
an index exists on part of the column (for instance, if you have an index
on the first 10 characters of a @code{VARCHAR} column), you cannot make
the column shorter than the number of characters that are indexed.

@item
When you change a column type using @code{CHANGE} or @code{MODIFY},
MySQL tries to convert data to the new type as well as possible.

@item
In MySQL Version 3.22 or later, you can use @code{FIRST} or
@code{ADD ... AFTER col_name} to add a column at a specific position
within a table row. The default is to add the column last.
From MySQL Version 4.0.1, you can also use the @code{FIRST} and
@code{AFTER} keywords in @code{CHANGE} or @code{MODIFY}.

@findex ALTER COLUMN
@cindex changing, column
@cindex column, changing
@cindex changing, field
@cindex field, changing
@item
@code{ALTER COLUMN} specifies a new default value for a column
or removes the old default value.
If the old default is removed and the column can be @code{NULL}, the new
default is @code{NULL}. If the column cannot be @code{NULL}, MySQL
assigns a default value, as described in
@ref{CREATE TABLE, , @code{CREATE TABLE}}.

@findex DROP INDEX
@cindex deleting, index
@cindex index, deleting
@item
@code{DROP INDEX} removes an index. This is a MySQL extension to
SQL-92. @xref{DROP INDEX}.

@item
If columns are dropped from a table, the columns are also removed from any
index of which they are a part.  If all columns that make up an index are
dropped, the index is dropped as well.

@item
If a table contains only one column, the column cannot be dropped.
If what you intend is to remove the table, use @code{DROP TABLE} instead.

@findex DROP PRIMARY KEY
@cindex deleting, primary key
@cindex primary key, deleting
@item
@code{DROP PRIMARY KEY} drops the primary index. (Prior to MySQL 4.1.2,
if no primary index exists, @code{DROP PRIMARY KEY} drops the first
@code{UNIQUE} index in the table.
MySQL marks the first @code{UNIQUE} key as the @code{PRIMARY KEY}
if no @code{PRIMARY KEY} was specified explicitly.)

@findex UNIQUE
@findex PRIMARY KEY
If you add a @code{UNIQUE INDEX} or @code{PRIMARY KEY} to a table, this
is stored before any not @code{UNIQUE} index so that MySQL can detect
duplicate keys as early as possible.

@findex ORDER BY
@item
@code{ORDER BY} allows you to create the new table with the rows in a
specific order.  Note that the table will not remain in this order after
inserts and deletes.  In some cases, it might make sorting easier for
MySQL if the table is in order by the column that you want to
order it by later.  This option is mainly useful when you know that you
are mostly going to query the rows in a certain order; by using this
option after big changes to the table, you might be able to get higher
performance.

@findex ALTER TABLE
@cindex changing, table
@cindex table, changing
@item
If you use @code{ALTER TABLE} on a @code{MyISAM} table, all non-unique
indexes are created in a separate batch (like in @code{REPAIR}).
This should make @code{ALTER TABLE} much faster when you have many indexes.

@item
Since @strong{MySQL 4.0} the above feature can be activated explicitly.
@code{ALTER TABLE ... DISABLE KEYS} makes MySQL to stop updating
non-unique indexes for @code{MyISAM} table.
@code{ALTER TABLE ... ENABLE KEYS} then should be used to re-create missing
indexes. As MySQL does it with a special algorithm which is much
faster then inserting keys one by one, disabling keys could give a
considerable speedup on bulk inserts.

@item
@findex mysql_info()
With the C API function @code{mysql_info()}, you can find out how many
records were copied, and (when @code{IGNORE} is used) how many records were
deleted due to duplication of unique key values.

@item
@cindex foreign keys
@cindex references
The @code{FOREIGN KEY}, @code{CHECK}, and @code{REFERENCES} clauses don't
actually do anything, except for InnoDB type tables which support
@code{... ADD [CONSTRAINT [symbol]] FOREIGN KEY (...) REFERENCES ... (...)}
and @code{... DROP FOREIGN KEY ...}.
@xref{InnoDB foreign key constraints}.
The syntax for other table types is provided only for compatibility,
to make it easier to port code from other SQL servers and to run applications
that create tables with references.
@xref{Differences from ANSI}.

@item
@code{ALTER TABLE} ignores the @code{DATA DIRECTORY} and @code{INDEX
DIRECTORY} table options.

@item
If you want to change all CHAR/VARCHAR/TEXT columns to a new character set
(for example after upgrading from MySQL 4.0.x to 4.1.1) you can do:

@example
ALTER TABLE table_name CHARACTER SET character_set_name;
@end example

Note that the following command will change only the @code{default character
set} for a table:

@example
ALTER TABLE table_name DEFAULT CHARACTER SET character_set_name;
@end example

The @code{default character set} is the character set that is used if
you don't specify the character set for a new column you add to a table
(for example with @code{ALTER TABLE ... ADD column}).
@end itemize

Here is an example that shows some of the uses of @code{ALTER TABLE}.  We
begin with a table @code{t1} that is created as shown here:

@example
mysql> CREATE TABLE t1 (a INTEGER,b CHAR(10));
@end example

To rename the table from @code{t1} to @code{t2}:

@example
mysql> ALTER TABLE t1 RENAME t2;
@end example

To change column @code{a} from @code{INTEGER} to @code{TINYINT NOT NULL}
(leaving the name the same), and to change column @code{b} from
@code{CHAR(10)} to @code{CHAR(20)} as well as renaming it from @code{b} to
@code{c}:

@example
mysql> ALTER TABLE t2 MODIFY a TINYINT NOT NULL, CHANGE b c CHAR(20);
@end example

To add a new @code{TIMESTAMP} column named @code{d}:

@example
mysql> ALTER TABLE t2 ADD d TIMESTAMP;
@end example

To add an index on column @code{d}, and make column @code{a} the primary key:

@example
mysql> ALTER TABLE t2 ADD INDEX (d), ADD PRIMARY KEY (a);
@end example

To remove column @code{c}:

@example
mysql> ALTER TABLE t2 DROP COLUMN c;
@end example

To add a new @code{AUTO_INCREMENT} integer column named @code{c}:

@example
mysql> ALTER TABLE t2 ADD c INT UNSIGNED NOT NULL AUTO_INCREMENT,
           ADD INDEX (c);
@end example

Note that we indexed @code{c}, because @code{AUTO_INCREMENT} columns must be
indexed, and also that we declare @code{c} as @code{NOT NULL}, because
indexed columns cannot be @code{NULL}.

When you add an @code{AUTO_INCREMENT} column, column values are filled in
with sequence numbers for you automatically.  You can set the first
sequence number by executing @code{SET INSERT_ID=value} before
@code{ALTER TABLE} or using the @code{AUTO_INCREMENT=value} table option.
@xref{SET OPTION}.

With MyISAM tables, if you don't change the @code{AUTO_INCREMENT}
column, the sequence number will not be affected. If you drop an
@code{AUTO_INCREMENT} column and then add another @code{AUTO_INCREMENT}
column, the numbers will start from 1 again.

@xref{ALTER TABLE problems}.


@node CREATE DATABASE, CREATE INDEX, ALTER TABLE, Data Definition
@subsection @code{CREATE DATABASE} Syntax

@findex CREATE DATABASE

@c example_for_help_topic CREATE DATABASE
@example
CREATE DATABASE [IF NOT EXISTS] db_name
    [create_specification [, create_specification] ...]

create_specification:
    [DEFAULT] CHARACTER SET charset_name
  | [DEFAULT] COLLATE collation_name
@end example

@c description_for_help_topic CREATE DATABASE  CREATE DATABASE IF EXIST NOT
@code{CREATE DATABASE} creates a database with the given name.  
@c end_description_for_help_topic

Rules for
allowable database names are given in @ref{Legal names}.  An error occurs if
the database already exists and you didn't specify @code{IF NOT EXISTS}.

As of MySQL 4.1.1, @code{create_specification} options may be given.
The @code{CHARACTER SET} clause specifies the database character set.
The @code{COLLATE} clause specifies the database collation.

Database characteristics are stored in the @file{db.opt} file in the
database directory.

Databases in MySQL are implemented as directories containing files
that correspond to tables in the database.  Because there are no tables in a
database when it is initially created, the @code{CREATE DATABASE} statement
only creates a directory under the MySQL data directory.

@cindex @code{mysqladmin}
You can also create databases with @code{mysqladmin}.
@xref{Client-Side Scripts}.


@node CREATE INDEX, CREATE TABLE, CREATE DATABASE, Data Definition
@subsection @code{CREATE INDEX} Syntax

@findex CREATE INDEX

@cindex indexes
@cindex indexes, multi-part
@cindex multi-part index

@c example_for_help_topic CREATE INDEX
@example
CREATE [UNIQUE|FULLTEXT] INDEX index_name [index_type]
       ON tbl_name (index_col_name,...)

index_col_name:
        col_name [(length)] [ASC | DESC]
@end example

@c description_for_help_topic CREATE INDEX  BTREE RTREE INDEX CREATE FULLTEXT
The @code{CREATE INDEX} statement doesn't do anything in MySQL prior
to Version 3.22.  In Version 3.22 or later, @code{CREATE INDEX} is mapped to an
@code{ALTER TABLE} statement to create indexes.
@c end_description_for_help_topic
@xref{ALTER TABLE, , @code{ALTER TABLE}}.

Normally, you create all indexes on a table at the time the table itself
is created with @code{CREATE TABLE}.
@xref{CREATE TABLE, , @code{CREATE TABLE}}.
@code{CREATE INDEX} allows you to add indexes to existing tables.

A column list of the form @code{(col1,col2,...)} creates a multiple-column
index.  Index values are formed by concatenating the values of the given
columns.

For @code{CHAR} and @code{VARCHAR} columns, indexes can be created that
use only part of a column, using @code{col_name(length)} syntax to index the
first @code{length} bytes of each column value.  (For
@code{BLOB} and @code{TEXT} columns, a prefix length is required;
@code{length} may be a value up to 255.) The
statement shown here creates an index using the first 10 characters of
the @code{name} column:

@example
mysql> CREATE INDEX part_of_name ON customer (name(10));
@end example

Because most names usually differ in the first 10 characters, this index should
not be much slower than an index created from the entire @code{name} column.
Also, using partial columns for indexes can make the index file much smaller,
which could save a lot of disk space and might also speed up @code{INSERT}
operations!

Note that you can add an index on a column that can have @code{NULL}
values only if you are using MySQL Version 3.23.2 or newer and are using the
@code{MyISAM}, @code{InnoDB}, or @code{BDB} table type.
You can only add an index on a @code{BLOB}/@code{TEXT} column if you are using
MySQL Version 3.23.2 or newer and are using the @code{MyISAM} or @code{BDB}
table type, or MySQL Version 4.0.14 or newer and the @code{InnoDB} table type.
For an index on a @code{BLOB} or @code{TEXT} column, a prefix length must always
be specified.

An @code{index_col_name} specification may end with @code{ASC} or @code{DESC}.
These keywords are allowed for future extensions for specifying ascending
or descending index value storage.  Currently they are parsed but ignored;
index values are always stored in ascending order.

For more information about how MySQL uses indexes, see
@ref{MySQL indexes, , MySQL indexes}.

@code{FULLTEXT} indexes can index only @code{CHAR}, @code{VARCHAR}, and
@code{TEXT} columns, and only in @code{MyISAM} tables. @code{FULLTEXT} indexes
are available in MySQL Version 3.23.23 and later.
@ref{Fulltext Search}.


@node CREATE TABLE, DROP DATABASE, CREATE INDEX, Data Definition
@subsection @code{CREATE TABLE} Syntax

@findex CREATE TABLE

@menu
* Silent column changes::       Silent Column Specification Changes
@end menu

@c example_for_help_topic CREATE TABLE
@c UPDATE START
@c Changed the following line in the example:
@c  | CHAR(length) [BINARY | ASCII | UNICODE]
@c UPDATE STOP
@example
CREATE [TEMPORARY] TABLE [IF NOT EXISTS] tbl_name [(create_definition,...)]
[table_options] [select_statement]
@end example

or:

@example
CREATE [TEMPORARY] TABLE [IF NOT EXISTS] tbl_name [(] LIKE old_tbl_name [)];

create_definition:
    col_name type [NOT NULL | NULL] [DEFAULT default_value] [AUTO_INCREMENT]
            [[PRIMARY] KEY] [COMMENT 'string'] [reference_definition]
  | [CONSTRAINT [symbol]] PRIMARY KEY [index_type] (index_col_name,...)
  | KEY [index_name] [index_type] (index_col_name,...)
  | INDEX [index_name] [index_type] (index_col_name,...)
  | [CONSTRAINT [symbol]] UNIQUE [INDEX] [index_name] [index_type] (index_col_name,...)
  | FULLTEXT [INDEX] [index_name] (index_col_name,...)
  | [CONSTRAINT [symbol]] FOREIGN KEY [index_name] (index_col_name,...)
            [reference_definition]
  | CHECK (expr)

type:
    TINYINT[(length)] [UNSIGNED] [ZEROFILL]
  | SMALLINT[(length)] [UNSIGNED] [ZEROFILL]
  | MEDIUMINT[(length)] [UNSIGNED] [ZEROFILL]
  | INT[(length)] [UNSIGNED] [ZEROFILL]
  | INTEGER[(length)] [UNSIGNED] [ZEROFILL]
  | BIGINT[(length)] [UNSIGNED] [ZEROFILL]
  | REAL[(length,decimals)] [UNSIGNED] [ZEROFILL]
  | DOUBLE[(length,decimals)] [UNSIGNED] [ZEROFILL]
  | FLOAT[(length,decimals)] [UNSIGNED] [ZEROFILL]
  | DECIMAL(length,decimals) [UNSIGNED] [ZEROFILL]
  | NUMERIC(length,decimals) [UNSIGNED] [ZEROFILL]
  | CHAR(length) [BINARY | ASCII | UNICODE]
  | VARCHAR(length) [BINARY]
  | DATE
  | TIME
  | TIMESTAMP
  | DATETIME
  | TINYBLOB
  | BLOB
  | MEDIUMBLOB
  | LONGBLOB
  | TINYTEXT
  | TEXT
  | MEDIUMTEXT
  | LONGTEXT
  | ENUM(value1,value2,value3,...)
  | SET(value1,value2,value3,...)

index_col_name:
        col_name [(length)] [ASC | DESC]

reference_definition:
        REFERENCES tbl_name [(index_col_name,...)]
                   [MATCH FULL | MATCH PARTIAL]
                   [ON DELETE reference_option]
                   [ON UPDATE reference_option]

reference_option:
        RESTRICT | CASCADE | SET NULL | NO ACTION | SET DEFAULT

table_options: table_option [table_option] ...

table_option:
    @{ENGINE | TYPE@} = @{BDB | HEAP | ISAM | InnoDB | MERGE | MRG_MYISAM | MYISAM@}
  | AUTO_INCREMENT = #
  | AVG_ROW_LENGTH = #
  | CHECKSUM = @{0 | 1@}
  | COMMENT = 'string'
  | MAX_ROWS = #
  | MIN_ROWS = #
  | PACK_KEYS = @{0 | 1 | DEFAULT@}
  | PASSWORD = 'string'
  | DELAY_KEY_WRITE = @{0 | 1@}
  | ROW_FORMAT = @{ DEFAULT | DYNAMIC | FIXED | COMPRESSED @}
  | RAID_TYPE = @{ 1 | STRIPED | RAID0 @} RAID_CHUNKS=#  RAID_CHUNKSIZE=#
  | UNION = (table_name,[table_name...])
  | INSERT_METHOD = @{ NO | FIRST | LAST @}
  | DATA DIRECTORY = 'absolute path to directory'
  | INDEX DIRECTORY = 'absolute path to directory'
  | DEFAULT CHARACTER SET character_set_name [COLLATE collation_name]

select_statement:
    [IGNORE | REPLACE] [AS] SELECT ...     (Some legal select statement)
@end example

@c description_for_help_topic CREATE TABLE  ENGINE TYPE KEY CREATE DATA ACTION AVG_ROW_LENGTH BERKELEYDB BDB BY CASCADE CHECK CHECKSUM COMMENT CONSTRAINT COMPRESSED FIXED DYNAMIC DEFAULT DELAY_KEY_WRITE DELETE DIRECTORY INDEX FIRST FOREIGN RAID_TYPE RAID_CHUNKS RAID_CHUNKSIZE ROW_FORMAT FULL FULLTEXT HEAP INNOBASE INNODB ISAM INSERT_METHOD MAX_ROWS MIN_ROWS PACK_KEYS PARTIAL RAID0 STRIPED MERGE MRG_MYISAM MYISAM NO REFERENCES SERIAL
@code{CREATE TABLE} creates a table with the given name.
Rules for allowable table names are given in @ref{Legal names}.  
By default, the table is created in the current database.  
An error occurs if the table already exists, if there is no current database,
or if the database does not exist.
@c end_description_for_help_topic

In MySQL Version 3.22 or later, the table name can be specified as
@code{db_name.tbl_name} to create the table in a specific database.
This works regardless of whether there is a current database.

From MySQL Version 3.23, you can use the @code{TEMPORARY} keyword when
you create a table. The temporary table is visible only to the
current connection, and will be deleted automatically when the
connection is closed.  This means that two different
connections can both use the same temporary table name without conflicting
with each other or with an existing table of the same name. (The existing table
is hidden until the temporary table is deleted.)  From MySQL 4.0.2 on, you must
have the @code{CREATE TEMPORARY TABLES} privilege to be able to create
temporary tables.

In MySQL Version 3.23 or later, you can use the keywords
@code{IF NOT EXISTS} so that an error does not occur if the table already
exists.  Note that there is no verification that the existing table has a
structure identical to that indicated by the @code{CREATE TABLE} statement.

From version 4.1.0, the attribute @code{SERIAL} can be used as an alias for
@code{BIGINT NOT NULL AUTO_INCREMENT UNIQUE}. This is compatibility feature.

@cindex copying tables
@cindex tables, copying

As of MySQL 3.23, you can create one table from another by adding a
@code{SELECT} statement at the end of the @code{CREATE TABLE} statement:

@example
CREATE TABLE new_tbl SELECT * FROM orig_tbl;
@end example

Indexes are not carried over to the new table, and some conversion of column
types may occur. For example, the @code{AUTO_INCREMENT} attribute is not
preserved, and @code{VARCHAR} columns may become @code{CHAR} columns.

When creating a table with @code{CREATE ... SELECT}, make sure to alias any
function calls or expressions in the query. If you do not, the @code{CREATE}
statement may fail or result in undesirable column names.

@example
CREATE TABLE artists_and_works
SELECT artist.name, COUNT(work.artist_id) AS number_of_works
FROM artist LEFT JOIN work ON artist.id = work.artist_id
GROUP BY artist.id;
@end example

As of MySQL 4.1, you can explicitly specify the type for a generated column:

@example
CREATE TABLE foo (a tinyint not null) SELECT b+1 AS 'a' FROM bar;
@end example

In MySQL 4.1, you can also use @code{LIKE} to create a table based on the
definition of another table, including any column attributes and
indexes the original table has:

@example
CREATE TABLE new_tbl LIKE orig_tbl;
@end example

@code{CREATE TABLE ... LIKE} does not copy any @code{DATA DIRECTORY} or
@code{INDEX DIRECTORY} table options that were specified for the original
table.

Each table @code{tbl_name} is represented by some files in the database
directory. In the case of @code{MyISAM}-type tables you will get:

@multitable @columnfractions .20 .30
@item @strong{File} @tab @strong{Purpose}
@item @code{tbl_name.frm} @tab Table format (definition) file
@item @code{tbl_name.MYD} @tab Datafile
@item @code{tbl_name.MYI} @tab Index file
@end multitable

For more information on the properties of the various column types, see
@ref{Column types}:

@itemize @bullet
@item
If neither @code{NULL} nor @code{NOT NULL} is specified, the column
is treated as though @code{NULL} had been specified.

@item
An integer column may have the additional attribute @code{AUTO_INCREMENT}.
When you insert a value of @code{NULL} (recommended) or @code{0} into an
indexed
@code{AUTO_INCREMENT} column, the column is set to the next sequence value.
Typically this is @code{value+1}, where
@code{value} is the largest value for the column currently in the table.
@code{AUTO_INCREMENT} sequences begin with @code{1}.
@xref{mysql_insert_id, , @code{mysql_insert_id()}}.

As of MySQL 4.1.1, specifying the @code{NO_AUTO_VALUE_ON_ZERO} flag for the
@code{--sql-mode} server option or the @code{sql_mode} server variable allows
you to store @code{0} in @code{AUTO_INCREMENT} columns as @code{0}, instead
of generating a new sequence value.
@xref{Server options}.

If you delete the row containing the maximum value for an
@code{AUTO_INCREMENT} column, the value will be reused for an
@code{ISAM} or @code{BDB} table, but not for a
@code{MyISAM} or @code{InnoDB} table.  If you delete all rows in the table
with @code{DELETE FROM table_name} (without a @code{WHERE}) in
@code{AUTOCOMMIT} mode, the sequence starts over for all table types except
@code{InnoDB}. @xref{InnoDB auto-increment column}.

@strong{Note:} There can be only one @code{AUTO_INCREMENT} column per
table, it must be indexed and it can't have a @code{DEFAULT} value.
In MySQL Version 3.23, an @code{AUTO_INCREMENT} column will work properly
only if it contains only positive values. Inserting a
negative number is regarded as inserting a very large positive number.
This is done to avoid precision problems when numbers ``wrap'' over from
positive to negative and also to ensure that one doesn't accidentally
get an @code{AUTO_INCREMENT} column that contains 0.

In @code{MyISAM} and @code{BDB} tables you can specify @code{AUTO_INCREMENT}
secondary column in a multiple-column key.  @xref{example-AUTO_INCREMENT}.

@cindex ODBC compatibility
@cindex compatibility, with ODBC
To make MySQL compatible with some ODBC applications, you can find the
@code{AUTO_INCREMENT} value for the last inserted row with the following query:

@example
SELECT * FROM tbl_name WHERE auto_col IS NULL
@end example

@item
@code{NULL} values are handled differently for @code{TIMESTAMP} columns than
for other column types.  You cannot store a literal @code{NULL} in a
@code{TIMESTAMP} column; setting the column to @code{NULL} sets it to the
current date and time.  Because @code{TIMESTAMP} columns behave this way, the
@code{NULL} and @code{NOT NULL} attributes do not apply in the normal way and
are ignored if you specify them.

On the other hand, to make it easier for MySQL clients to use
@code{TIMESTAMP} columns, the server reports that such columns may be
assigned @code{NULL} values (which is true), even though @code{TIMESTAMP}
never actually will contain a @code{NULL} value.  You can see this when you
use @code{DESCRIBE tbl_name} to get a description of your table.

Note that setting a @code{TIMESTAMP} column to @code{0} is not the same
as setting it to @code{NULL}, because @code{0} is a valid @code{TIMESTAMP}
value.

@item
@cindex default values
A @code{DEFAULT} value must be a constant; it cannot be a function or
an expression.

If no @code{DEFAULT} value is specified for a column, MySQL
automatically assigns one, as follows.

If the column may take @code{NULL} as a value, the default value is
@code{NULL}.

If the column is declared as @code{NOT NULL}, the default value depends on
the column type:

@itemize @minus
@item
For numeric types other than those declared with the @code{AUTO_INCREMENT}
attribute, the default is @code{0}.  For an @code{AUTO_INCREMENT} column, the
default value is the next value in the sequence.

@item
For date and time types other than @code{TIMESTAMP}, the default is the
appropriate zero value for the type.  For the first @code{TIMESTAMP}
column in a table, the default value is the current date and time.
@xref{Date and time types}.

@item
For string types other than @code{ENUM}, the default value is the empty
string.  For @code{ENUM}, the default is the first enumeration value.
@end itemize

Default values must be constants. This means, for example, that you cannot
set the default for a date column to be the value of a function such as
@code{NOW()} or @code{CURRENT_DATE}.

@item
@cindex column comments
A comment for a column may be specified with the @code{COMMENT} option.
The comment is displayed by the
@code{SHOW CREATE TABLE} statement, and by @code{SHOW FULL COLUMNS}.
This option is available as of MySQL 4.1.
(It is allowed but ignored in earlier versions.)

@item
@code{KEY} is normally a synonym for @code{INDEX}.
From version 4.1, the key attribute @code{PRIMARY KEY} may also be
specified as just @code{KEY}. This was implemented for compatibility
with other databases.

@item
In MySQL, a @code{UNIQUE} key can have only distinct values. An
error occurs if you try to add a new row with a key that matches an existing
row.

@item
@tindex PRIMARY KEY
A @code{PRIMARY KEY} is a unique @code{KEY} where all key columns must be
defined as @code{NOT NULL}. If they are not explicitly declared as
@code{NOT NULL}, it will be done implicitly (and quietly).  In MySQL,
the key is named @code{PRIMARY}. A table can have only one @code{PRIMARY KEY}.
If you don't have a @code{PRIMARY KEY} and some applications ask for the
@code{PRIMARY KEY} in your tables, MySQL will return the first
@code{UNIQUE} key, which doesn't have any @code{NULL} columns, as the
@code{PRIMARY KEY}.

@item
A @code{PRIMARY KEY} can be a multiple-column index.  However, you cannot
create a multiple-column index using the @code{PRIMARY KEY} key attibute in a
column specification.  Doing so will mark only that single column as primary.
You must use a separate @code{PRIMARY KEY(index_col_name, ...)} clause.

@item
A @code{UNIQUE} index is one in which all values in the index must be
distinct. The exception to this is that if a column in the index is allowed
to contain @code{NULL} values, it may contain multiple @code{NULL} values.
This exception does not apply to @code{BDB} tables, which allow only a single
@code{NULL}.

@item
If the @code{PRIMARY} or @code{UNIQUE} key consists of only one column and this
is of type integer, you can also refer to it as @code{_rowid}
(new in Version 3.23.11).

@item
If you don't assign a name to an index that is not a @code{PRIMARY KEY},
the index will be assigned the same
name as the first @code{index_col_name}, with an optional suffix (@code{_2},
@code{_3}, @code{...}) to make it unique.  You can see index names for a
table using @code{SHOW INDEX FROM tbl_name}.
@xref{Show database info}.

@item
From MySQL 4.1.0 on, some storage engines allow you to specify an index
type when creating an index.  The syntax for the @code{index_type}
specifier is @code{USING type_name}. The allowable @code{type_name}
values supported by different storage engines are shown in the following
table. Where multiple index types are listed, the first one is the
default when no @code{index_type} specifier is given.

@multitable @columnfractions .40 .50
@item @strong{Storage engine} @tab @strong{Allowable index types}
@item @code{MyISAM} @tab @code{BTREE}
@item @code{InnoDB} @tab @code{BTREE}
@item @code{MEMORY/HEAP} @tab @code{HASH}, @code{BTREE}
@end multitable

Example:

@example
CREATE TABLE lookup (id INT, INDEX USING BTREE (id)) ENGINE = MEMORY;
@end example

@code{TYPE type_name} may be used as a synonym for @code{USING type_name}
to specify an index type.  @code{USING} is the preferred form, however.
(The preceding index name is not optional with @code{TYPE}, because unlike
@code{USING}, @code{TYPE} is not a reserved word and thus is interpreted
as an index name.)

@item
@cindex @code{NULL} values, and indexes
@cindex indexes, and @code{NULL} values
Only the @code{MyISAM}, @code{InnoDB}, and @code{BDB} table types support indexes on columns that can have
@code{NULL} values. In other cases you must declare such columns
@code{NOT NULL} or an error results.

@item
With @code{col_name(length)} syntax in an index specification, you can create
an index that uses only the first @code{length} bytes of a @code{CHAR}
or @code{VARCHAR} column. This can make the index file much smaller.
@xref{Indexes}.

@item
@cindex @code{BLOB} columns, indexing
@cindex indexes, and @code{BLOB} columns
@cindex @code{TEXT} columns, indexing
@cindex indexes, and @code{TEXT} columns
Only the @code{MyISAM} and (as of MySQL 4.0.14)
@code{InnoDB} table types support indexing on @code{BLOB} and
@code{TEXT} columns.  When putting an index on a @code{BLOB} or @code{TEXT}
column, you @emph{must} always specify the length of the index, up to 255 bytes. For
example:
@example
CREATE TABLE test (blob_col BLOB, INDEX(blob_col(10)));
@end example

@item
An @code{index_col_name} specification may end with @code{ASC} or @code{DESC}.
These keywords are allowed for future extensions for specifying ascending
or descending index value storage.  Currently they are parsed but ignored;
index values are always stored in ascending order.

@item
When you use @code{ORDER BY} or @code{GROUP BY} with a @code{TEXT} or
@code{BLOB} column, the server sorts values using only the initial number of
bytes indicated by the @code{max_sort_length} server variable.
@xref{BLOB,  , @code{BLOB}}.

@item
In MySQL Version 3.23.23 or later, you can also create special
@code{FULLTEXT} indexes. They are used for full-text search. Only the
@code{MyISAM} table type supports @code{FULLTEXT} indexes. They can be created
only from @code{CHAR}, @code{VARCHAR}, and @code{TEXT} columns.
Indexing always happens over the entire column; partial indexing is not
supported. See @ref{Fulltext Search} for details of operation.

@item
In MySQL Version 3.23.44 or later, @code{InnoDB} tables support checking of
foreign key constraints. @xref{InnoDB}. Note that the
@code{FOREIGN KEY} syntax in @code{InnoDB} is more restrictive than
the syntax presented above: The columns of the referenced
table must always be explicitly named.
InnoDB supports both @code{ON DELETE} and @code{ON UPDATE}
actions on foreign keys as of MySQL 3.23.50 and 4.0.8, respectively.
See the @code{InnoDB} manual section for the precise syntax.
@xref{InnoDB foreign key constraints}.
For other table types, MySQL Server does parse the @code{FOREIGN KEY},
@code{CHECK}, and @code{REFERENCES} syntax in @code{CREATE TABLE} commands,
but without further action being taken. @xref{ANSI diff Foreign Keys}.

@item
For @code{MyISAM} and @code{ISAM} tables,
each @code{NULL} column takes one bit extra, rounded up to the nearest byte.
The maximum record length in bytes can be calculated as follows:

@example
row length = 1
             + (sum of column lengths)
             + (number of NULL columns + delete_flag + 7)/8
             + (number of variable-length columns)
@end example

@code{delete_flag} is 1 for tables with static record format. Static
tables use a bit in the row record for a flag that indicates whether
the row has been deleted.  @code{delete_flag} is 0 for dynamic tables
because the flag is stored in the dynamic row header.

These calculations do not apply for @code{InnoDB} tables, for which
storage size is not different for @code{NULL} columns compared to @code{NOT
NULL} columns.

@item
The @code{table_options} and @code{SELECT} options are only
implemented in MySQL Version 3.23 and above.

The @code{ENGINE} and @code{TYPE} options specify the storage engine for the
table.  @code{ENGINE} was added in MySQL 4.0.18 (for 4.0) and 4.1.2 (for 4.1).
It is the preferred option name as of those versions, and @code{TYPE} has
become deprecated.  @code{TYPE} will be supported throughout the 4.x series,
but likely will be removed in MySQL 5.1.

The @code{ENGINE} and @code{TYPE} options take the following values:

@multitable @columnfractions .25 .70
@item @strong{Storage engine} @tab @strong{Description}
@item @code{BDB} or @code{BerkeleyDB} @tab Transaction-safe tables with page locking. @xref{BDB}.
@item @code{HEAP} @tab The data for this table is only stored in memory. @xref{HEAP}.
@item @code{ISAM} @tab The original storage engine. @xref{ISAM}.
@item @code{InnoDB} @tab Transaction-safe tables with row locking. @xref{InnoDB}.
@item @code{MERGE} @tab A collection of @code{MyISAM} tables used as one table. @xref{MERGE}.
@item @code{MRG_MyISAM} @tab An alias for @code{MERGE}.
@item @code{MyISAM} @tab The new binary portable storage engine that is the replacement for @code{ISAM}. @xref{MyISAM, , @code{MyISAM}}.
@end multitable
@xref{Table types}.

If a storage engine is specified and that particular engine is not available,
MySQL will use @code{MyISAM} instead.
For example, if a table definition includes the @code{ENGINE=BDB} option but the
MySQL server does not support @code{BDB} tables, the table will be created
as a @code{MyISAM} table.  This makes it possible to have a replication
setup where you have transactional tables on the master but tables created
on the slave are non-transactional (to get more speed).  In MySQL 4.1.1 you
get a warning if the specified table type is not honored.

The other table options are used to optimize the behavior of the
table. In most cases, you don't have to specify any of them.
The options work for all table types unless otherwise indicated:

@multitable @columnfractions .25 .70
@item @strong{Option} @tab @strong{Description}
@item @code{AUTO_INCREMENT} @tab The next @code{AUTO_INCREMENT} value you want to set for your table (@code{MyISAM} only; to set the first auto-increment value for an @code{InnoDB} table, insert a dummy row with a value one less, and delete the dummy row).
@item @code{AVG_ROW_LENGTH} @tab An approximation of the average row length for your table. You need to set this only for large tables with variable size records.
@item @code{CHECKSUM} @tab Set this to 1 if you want MySQL to maintain a checksum for all rows. It makes the table a little slower to update but it also makes it easier to find corrupted tables. (@code{MyISAM} only).
@item @code{COMMENT} @tab A 60-character comment for your table.
@item @code{MAX_ROWS} @tab Maximum number of rows you plan to store in the table.
@item @code{MIN_ROWS} @tab Minimum number of rows you plan to store in the table.
@item @code{PACK_KEYS} @tab Set this to 1 if you want to have a smaller index.  This usually makes updates slower and reads faster (@code{MyISAM} and @code{ISAM} only). Setting this to 0 disables all packing of keys. Setting this to @code{DEFAULT} (MySQL 4.0) tells the storage engine to only pack long @code{CHAR}/@code{VARCHAR} columns.
@item @code{PASSWORD} @tab Encrypt the @file{.frm} file with a password.  This option doesn't do anything in the standard MySQL version.
@item @code{DELAY_KEY_WRITE} @tab Set this to 1 if you want to delay key table updates until the table is closed (@code{MyISAM} only).
@item @code{ROW_FORMAT} @tab Defines how the rows should be stored. Currently this option works only with @code{MyISAM} tables, which supports the @code{DYNAMIC} and @code{FIXED} row formats. @xref{MyISAM table formats}.
@end multitable

When you use a @code{MyISAM} table, MySQL uses the product of
@code{MAX_ROWS * AVG_ROW_LENGTH} to decide how big the resulting table
will be.  If you don't specify any of the above options, the maximum size
for a table will be 4G (or 2G if your operating systems only supports 2G
tables). The reason for this is just to keep down the pointer sizes
to make the index smaller and faster if you don't really need big files.

If you don't use @code{PACK_KEYS}, the default is to only pack strings,
not numbers.  If you use @code{PACK_KEYS=1}, numbers will be packed as well.

When packing binary number keys, MySQL will use prefix compression.
This means that you will get a big benefit from this only if you have
many numbers that are the same.  Prefix compression means that every
key needs one extra byte to indicate how many bytes of the previous key are
the same for the next key (note that the pointer to the row is stored
in high-byte-first order directly after the key, to improve
compression).  This means that if you have many equal keys on two consecutive
rows, all following ``same'' keys will usually only take 2 bytes
(including the pointer to the row).  Compare this to the ordinary case
where the following keys will take storage_size_for_key +
pointer_size (usually 4).  On the other hand, if all keys are
totally different, you will use 1 byte more per key, if the key isn't a
key that can have @code{NULL} values. (In this case the packed key length will
be stored in the same byte that is used to mark if a key is @code{NULL}.)

@item
As of MySQL 3.23,
if you specify a @code{SELECT} after the @code{CREATE} statement,
MySQL will create new fields for all elements in the
@code{SELECT}.  For example:

@example
mysql> CREATE TABLE test (a INT NOT NULL AUTO_INCREMENT,
    ->        PRIMARY KEY (a), KEY(b))
    ->        TYPE=MyISAM SELECT b,c FROM test2;
@end example

This will create a @code{MyISAM} table with three columns, a, b, and c.
Notice that the columns from the @code{SELECT} statement are appended to
the right side of the table, not overlapped onto it.  Take the following
example:

@example
mysql> SELECT * FROM foo;
+---+
| n |
+---+
| 1 |
+---+

mysql> CREATE TABLE bar (m INT) SELECT n FROM foo;
Query OK, 1 row affected (0.02 sec)
Records: 1  Duplicates: 0  Warnings: 0

mysql> SELECT * FROM bar;
+------+---+
| m    | n |
+------+---+
| NULL | 1 |
+------+---+
1 row in set (0.00 sec)
@end example

For each row in table @code{foo}, a row is inserted in @code{bar} with
the values from @code{foo} and default values for the new columns.

@code{CREATE TABLE ... SELECT} will not automatically create any indexes
for you.  This is done intentionally to make the command as flexible as
possible.  If you want to have indexes in the created table, you should
specify these before the @code{SELECT} statement:

@example
mysql> CREATE TABLE bar (UNIQUE (n)) SELECT n FROM foo;
@end example

If any errors occur while copying the data to the table, it will
automatically be deleted.

You can precede the @code{SELECT} by @code{IGNORE} or @code{REPLACE}
to indicate how to handle records that duplicate unique key values.
With @code{IGNORE}, new records that duplicate an existing record on a
unique key value are discarded.  With @code{REPLACE}, new records replace
records that have the same unique key value.  If neither @code{IGNORE}
nor @code{REPLACE} are specified, duplicate unique key values result in
an error.

To ensure that the update log/binary log can be used to re-create the
original tables, MySQL will not allow concurrent inserts during
@code{CREATE TABLE ... SELECT}.
@item
@cindex RAID, table type
@cindex tables, RAID
The @code{RAID_TYPE} option will help you to exceed the 2G/4G limit for
the MyISAM datafile (not the index file) on operating systems that
don't support big files. Note that this option is not recommended for
a filesystem that supports big files!

You can get more speed from the I/O bottleneck by putting @code{RAID}
directories on different physical disks. @code{RAID_TYPE} will work on
any operating system, as long as you have built MySQL with the
@code{--with-raid} option to @code{configure}.  For now, the only allowed
@code{RAID_TYPE} is @code{STRIPED} (@code{1} and @code{RAID0} are aliases
for this).

If you specify @code{RAID_TYPE=STRIPED} for a @code{MyISAM} table,
@code{MyISAM} will create @code{RAID_CHUNKS} subdirectories named 00,
01, 02 in the database directory.  In each of these directories,
@code{MyISAM} will create a @code{table_name.MYD}.  When writing data
to the datafile, the @code{RAID} handler will map the first
@code{RAID_CHUNKSIZE} *1024 bytes to the first file, the next
@code{RAID_CHUNKSIZE} *1024 bytes to the next file and so on.
@item
@code{UNION} is used when you want to use a collection of identical
tables as one. This works only with @code{MERGE} tables.
@xref{MERGE, , @code{MERGE}}.

For the moment, you need to have @code{SELECT}, @code{UPDATE}, and
@code{DELETE} privileges on the tables you map to a @code{MERGE} table.
All mapped tables must be in the same database as the @code{MERGE} table.

@item
If you want to insert data in a @code{MERGE} table, you have to specify with
@code{INSERT_METHOD} into which table the row should be inserted.
@code{INSERT_METHOD} is an option useful for @code{MERGE} tables only. 
@xref{MERGE}. This option was introduced in MySQL 4.0.0.

@item
In the created table the @code{PRIMARY} key will be placed first, followed
by all @code{UNIQUE} keys, and then the normal keys.  This helps the
MySQL optimizer to prioritize which key to use and also more quickly
to detect duplicated @code{UNIQUE} keys.

@item
By using @code{DATA DIRECTORY='directory'} or @code{INDEX
DIRECTORY='directory'} you can specify where the storage engine should
put its datafile and index file.  Note that the directory should be a full
path to the directory (not a relative path).

This works only for @code{MyISAM} tables in @code{MySQL} 4.0, when you
are not using the @code{--skip-symlink} option. Your operating system
must also have a working, thread-safe @code{realpath()}
call. @xref{Symbolic links to tables}.
@end itemize


@node Silent column changes,  , CREATE TABLE, CREATE TABLE
@subsubsection Silent Column Specification Changes

@cindex silent column changes

In some cases, MySQL silently changes a column specification from
that given in a @code{CREATE TABLE} statement.  (This may also occur with
@code{ALTER TABLE}.):

@itemize @bullet
@item
@code{VARCHAR} columns with a length less than four are changed to
@code{CHAR}.

@item
If any column in a table has a variable length, the entire row is
variable-length as a result.  Therefore, if a table contains any
variable-length columns (@code{VARCHAR}, @code{TEXT}, or @code{BLOB}),
all @code{CHAR} columns longer than three characters are changed to
@code{VARCHAR} columns.  This doesn't affect how you use the columns in
any way; in MySQL, @code{VARCHAR} is just a different way to
store characters.  MySQL performs this conversion because it
saves space and makes table operations faster.  @xref{Table types}.

@item
From version 4.1.0, if a @code{CHAR} or @code{VARCHAR} field with a
length specification greater than 255 is converted to @code{TEXT}.
This is a compatibility feature.

@item
@code{TIMESTAMP} display sizes must be even and in the range from 2 to 14.
If you specify a display size of 0 or greater than 14, the size is coerced
to 14.  Odd-valued sizes in the range from 1 to 13 are coerced
to the next higher even number.

@item
You cannot store a literal @code{NULL} in a @code{TIMESTAMP} column; setting
it to @code{NULL} sets it to the current date and time.  Because
@code{TIMESTAMP} columns behave this way, the @code{NULL} and @code{NOT NULL}
attributes do not apply in the normal way and are ignored if you specify
them.  @code{DESCRIBE tbl_name} always reports that a @code{TIMESTAMP}
column may be assigned @code{NULL} values.

@item
MySQL maps certain column types used by other SQL database vendors
to MySQL types.  @xref{Other-vendor column types}.
@end itemize

If you want to see whether MySQL used a column type other
than the one you specified, issue a @code{DESCRIBE tbl_name} statement after
creating or altering your table.

@cindex @code{myisampack}
Certain other column type changes may occur if you compress a table
using @code{myisampack}. @xref{Compressed format}.


@node DROP DATABASE, DROP INDEX, CREATE TABLE, Data Definition
@subsection @code{DROP DATABASE} Syntax

@findex DROP DATABASE
@cindex deleting, database
@cindex database, deleting

@c example_for_help_topic DROP DATABASE
@example
DROP DATABASE [IF EXISTS] db_name
@end example

@c description_for_help_topic DROP DATABASE  DROP DATABASE EXISTS IF
@code{DROP DATABASE} drops all tables in the database and deletes the
database.  If you do a @code{DROP DATABASE} on a symbolic linked
database, both the link and the original database are deleted. Be @emph{very}
careful with this statement!
@c end_description_for_help_topic

@code{DROP DATABASE} returns the number of files that were removed from
the database directory.  For @code{MyISAM} tables, this is three times the number of
tables, because normally each table corresponds to a @file{.MYD} file, a
@file{.MYI} file, and a @file{.frm} file.

The @code{DROP DATABASE} command removes from the given database
directory all files with the following extensions:

@multitable @columnfractions .10 .10 .10 .10
@item @strong{Ext} @tab @strong{Ext} @tab @strong{Ext} @tab @strong{Ext}
@item .BAK  @tab .DAT  @tab .HSH  @tab .ISD
@item .ISM  @tab .ISM  @tab .MRG  @tab .MYD
@item .MYI  @tab .db   @tab .frm  @tab
@end multitable

All subdirectories that consists of 2 digits (@code{RAID} directories)
are also removed.

In MySQL Version 3.22 or later, you can use the keywords
@code{IF EXISTS} to prevent an error from occurring if the database doesn't
exist.

@cindex @code{mysqladmin}
You can also drop databases with @code{mysqladmin}. @xref{Client-Side Scripts}.


@node DROP INDEX, DROP TABLE, DROP DATABASE, Data Definition
@subsection @code{DROP INDEX} Syntax

@findex DROP INDEX
@cindex deleting, index
@cindex index, deleting

@c example_for_help_topic DROP INDEX
@example
DROP INDEX index_name ON tbl_name
@end example

@c description_for_help_topic DROP INDEX  DROP INDEX
@code{DROP INDEX} drops the index named @code{index_name} from the table
@code{tbl_name}.  @code{DROP INDEX} doesn't do anything in MySQL
prior to Version 3.22.  In Version 3.22 or later, @code{DROP INDEX} is mapped to an
@code{ALTER TABLE} statement to drop the index.
@xref{ALTER TABLE, , @code{ALTER TABLE}}.
@c end_description_for_help_topic


@node DROP TABLE, RENAME TABLE, DROP INDEX, Data Definition
@subsection @code{DROP TABLE} Syntax

@findex DROP TABLE
@cindex deleting, table
@cindex table, deleting

@c example_for_help_topic DROP TABLE
@example
DROP [TEMPORARY] TABLE [IF EXISTS] tbl_name [, tbl_name,...] [RESTRICT | CASCADE]
@end example

@c description_for_help_topic DROP TABLE  DROP TABLE EXISTS IF TEMPORARY RESTRICT CASCADE
@code{DROP TABLE} removes one or more tables. All table data and the table
definition are @emph{removed}, so @strong{be careful} with this command!

In MySQL Version 3.22 or later, you can use the keywords
@code{IF EXISTS} to prevent an error from occurring for tables that don't
exist.  In 4.1 one gets a @code{NOTE} for all not existing tables when using
@code{IF EXISTS}. @xref{SHOW WARNINGS}.

@code{RESTRICT} and @code{CASCADE} are allowed to make porting easier.
For the moment they don't do anything.

@strong{Note:} @code{DROP TABLE} automatically commits the current
active transaction (except if you are using 4.1 and the @code{TEMPORARY}
key word.
@c end_description_for_help_topic

Option @code{TEMPORARY} is ignored in 4.0.  In 4.1 this option works as
follows:

@itemize @bullet
@item
Only drops temporary tables.
@item
It doesn't end a running transactions.
@item
No access rights is checked.
@end itemize

Using @code{TEMPORARY} is a good way to ensure that you don't accidently
drop a real table.


@node RENAME TABLE,  , DROP TABLE, Data Definition
@subsection @code{RENAME TABLE} Syntax

@findex RENAME TABLE

@c description_for_help_topic RENAME TABLE
@example
RENAME TABLE tbl_name TO new_tbl_name[, tbl_name2 TO new_tbl_name2,...]
@end example

The rename is done atomically, which means that no other thread can
access any of the tables while the rename is running. This makes it
possible to replace a table with an empty one
@c end_description_for_help_topic
:

@c example_for_help_topic RENAME TABLE
@example
CREATE TABLE new_table (...);
RENAME TABLE old_table TO backup_table, new_table TO old_table;
@end example

The rename is done from left to right, which means that if you want to
swap two table names, you have to:

@example
RENAME TABLE old_table    TO backup_table,
             new_table    TO old_table,
             backup_table TO new_table;
@end example

As long as two databases are on the same disk you can also rename
from one database to another:

@example
RENAME TABLE current_db.tbl_name TO other_db.tbl_name;
@end example

When you execute @code{RENAME}, you can't have any locked tables or
active transactions.  You must also have the @code{ALTER} and @code{DROP}
privileges on the original table, and the @code{CREATE} and @code{INSERT}
privileges on the new table.

If MySQL encounters any errors in a multiple-table rename, it
will do a reverse rename for all renamed tables to get everything back
to the original state.

@code{RENAME TABLE} was added in MySQL 3.23.23.

@node Basic User Commands, Transactional Commands, Data Definition, SQL Syntax
@section Basic MySQL User Utility Statements

@menu
* DESCRIBE::                    @code{DESCRIBE} Syntax (Get Information About Columns)
* USE::                         @code{USE} Syntax
@end menu


@node DESCRIBE, USE, Basic User Commands, Basic User Commands
@subsection @code{DESCRIBE} Syntax (Get Information About Columns)

@findex DESC
@findex DESCRIBE

@c help_category Administration
@c description_for_help_topic DESCRIBE  DESC
@example
@{DESCRIBE | DESC@} tbl_name [col_name | wild]
@end example

@code{DESCRIBE} is a shortcut for @code{SHOW COLUMNS FROM}.
@c end_description_for_help_topic
@xref{Show database info}.

@code{DESCRIBE} provides information about a table's columns.  @code{col_name}
may be a column name or a string containing the SQL @samp{%} and @samp{_}
wildcard characters to obtain output only for the columns with names matching
the string. There is no need to enclose the string in quotes.

If the column types are different from what you expect them to be based on a
@code{CREATE TABLE} statement, note that MySQL sometimes
changes column types.  @xref{Silent column changes}.

@cindex Oracle compatibility
@cindex compatibility, with Oracle
This statement is provided for Oracle compatibility.

The @code{SHOW} statement provides similar information.
@xref{SHOW, , @code{SHOW}}.


@node USE,  , DESCRIBE, Basic User Commands
@subsection @code{USE} Syntax

@findex USE

@example
USE db_name
@end example

The @code{USE db_name} statement tells MySQL to use the @code{db_name}
database as the default database for subsequent queries.  The database remains
current until the end of the session or until another @code{USE} statement
is issued:

@example
mysql> USE db1;
mysql> SELECT COUNT(*) FROM mytable;      # selects from db1.mytable
mysql> USE db2;
mysql> SELECT COUNT(*) FROM mytable;      # selects from db2.mytable
@end example

Making a particular database current by means of the @code{USE} statement
does not preclude you from accessing tables in other databases.  The following example
accesses the @code{author} table from the @code{db1} database and the
@code{editor} table from the @code{db2} database:

@example
mysql> USE db1;
mysql> SELECT author_name,editor_name FROM author,db2.editor
    ->        WHERE author.editor_id = db2.editor.editor_id;
@end example

@cindex Sybase compatibility
@cindex compatibility, with Sybase
The @code{USE} statement is provided for Sybase compatibility.


@node Transactional Commands, Database Administration, Basic User Commands, SQL Syntax
@section MySQL Transactional and Locking Statements

@menu
* COMMIT::                      @code{START TRANSACTION}, @code{COMMIT}, and @code{ROLLBACK} Syntax
* Cannot roll back::            Statements That Cannot Be Rolled Back
* Implicit commit::             Statements That Cause an Implicit Commit
* Savepoints::                  @code{SAVEPOINT} and @code{ROLLBACK TO SAVEPOINT} Syntax
* LOCK TABLES::                 @code{LOCK TABLES} and @code{UNLOCK TABLES} Syntax
* SET TRANSACTION::             @code{SET TRANSACTION} Syntax
@end menu

@c help_category Transactions

@node COMMIT, Cannot roll back, Transactional Commands, Transactional Commands
@subsection @code{START TRANSACTION}, @code{COMMIT}, and @code{ROLLBACK} Syntax

@findex START TRANSACTION
@findex BEGIN
@findex COMMIT
@findex ROLLBACK

@c description_for_help_topic START TRANSACTION  START TRANSACTION BEGIN WORK COMMIT ROLLBACK SET AUTOCOMMIT
By default, MySQL runs in autocommit mode. This means that
as soon as you execute a statement that updates (modifies) a table,
MySQL will store the update on disk.

If you are using transaction-safe tables (like @code{InnoDB} or @code{BDB}),
you can put MySQL into non-autocommit mode with the following command:

@example
SET AUTOCOMMIT=0
@end example

After disabling autocommit mode by setting the @code{AUTOCOMMIT} variable to
zero, you must use @code{COMMIT} to store your changes to disk or
@code{ROLLBACK} if you want to ignore the changes you have made since
the beginning of your transaction.

If you want to disable autocommit mode for a single series of
statements, you can use the @code{START TRANSACTION} statement:
@c end_description_for_help_topic
:

@c example_for_help_topic START TRANSACTION
@example
START TRANSACTION;
SELECT @@A:=SUM(salary) FROM table1 WHERE type=1;
UPDATE table2 SET summmary=@@A WHERE type=1;
COMMIT;
@end example

@code{BEGIN} and @code{BEGIN WORK} can be used instead of 
@code{START TRANSACTION} to initiate a transaction.
@code{START TRANSACTION} was added in MySQL 4.0.11.  This is SQL-99 syntax and
is the recommended way to start an ad-hoc transaction.  @code{BEGIN} and
@code{BEGIN WORK} are available from MySQL 3.23.17 and 3.23.19, respectively.

Note that if you are not using transaction-safe tables, any changes will be
stored at once, regardless of the status of autocommit mode.

If you issue a @code{ROLLBACK} statement after updating a non-transactional
table, you will get an error (@code{ER_WARNING_NOT_COMPLETE_ROLLBACK}) as
a warning.  All transaction-safe tables will be restored, but any
non-transaction-safe table will not change.

If you are using @code{START TRANSACTION} or @code{SET AUTOCOMMIT=0}, you
should use the MySQL binary log for backups instead of the
older update log.  Transactions are stored in the binary log
in one chunk, upon @code{COMMIT}, to ensure that transactions that are
rolled back are not stored.  @xref{Binary log}.

You can change the isolation level for transactions with
@code{SET TRANSACTION ISOLATION LEVEL}.
@xref{SET TRANSACTION}.

@node Cannot roll back, Implicit commit, COMMIT, Transactional Commands
@subsection Statements That Cannot Be Rolled Back

Some statements cannot be rolled back.  In general, these include data
definition language (DDL) statements, such as those that create or drop
databases, or those that create, drop, or alter tables.

You may wish to design your transactions not to include such statements.
If you issue a statement that cannot be rolled back early in a transaction,
and then another statement later fails, the full effect of the transaction
cannot be rolled back by issuing a @code{ROLLBACK} statement.

@node Implicit commit, Savepoints, Cannot roll back, Transactional Commands
@subsection Statements That Cause an Implicit Commit

The following commands implicitly end a transaction (as if you had done
a @code{COMMIT} before executing the command):

@multitable @columnfractions .25 .25 .25
@item @strong{Command}      @tab @strong{Command}   @tab @strong{Command}
@item @code{ALTER TABLE}    @tab @code{BEGIN}       @tab @code{CREATE INDEX}
@item @code{DROP DATABASE}  @tab @code{DROP INDEX}  @tab @code{DROP TABLE}
@item @code{LOAD MASTER DATA} @tab @code{LOCK TABLES} @tab @code{RENAME TABLE}
@item @code{SET AUTOCOMMIT=1} @tab @code{START TRANSACTION} @tab @code{TRUNCATE}
@end multitable

@code{UNLOCK TABLES} also ends a transaction if any tables currently are
locked.  Prior to MySQL 4.0.13, @code{CREATE TABLE} ends a transaction if
the binary update log is enabled.

Transactions cannot be nested. This is a consequence of the implicit
@code{COMMIT} performed for any current transaction when you issue a
@code{START TRANSACTION} statement or one of its synonyms.

@node Savepoints, LOCK TABLES, Implicit commit, Transactional Commands
@subsection @code{SAVEPOINT} and @code{ROLLBACK TO SAVEPOINT} Syntax

@findex SAVEPOINT
@findex ROLLBACK TO SAVEPOINT

Starting from MySQL 4.0.14 and 4.1.1, @code{InnoDB} supports the SQL commands
@code{SAVEPOINT} and @code{ROLLBACK TO SAVEPOINT}.

@c example_for_help_topic SAVEPOINT
@example
SAVEPOINT identifier
@end example

This statement sets a named transaction savepoint whose name is
@code{identifier}.  If the current transaction already has a
savepoint with the same name, the old savepoint is deleted and a
new one is set.

@c example_for_help_topic ROLLBACK TO SAVEPOINT
@example
ROLLBACK TO SAVEPOINT identifier
@end example

This statement rolls back a transaction to the named savepoint.
Modifications that this transaction made to rows after the savepoint
was set are undone in the rollback, but @code{InnoDB} does @strong{not}
release the row locks that were stored in memory after the savepoint.
(Note that for a new inserted row, the lock information is carried by
the transaction ID stored in the row; the lock is not separately
stored in memory. In this case, the row lock is released in the undo.)
Savepoints that were set at a later time than the named savepoint are
deleted.

If the command returns the following error, it means that
no savepoint with the specified name  exists:

@example
ERROR 1181: Got error 153 during ROLLBACK
@end example

All savepoints of the current transaction are deleted if you execute a
@code{COMMIT}, or a @code{ROLLBACK} that does not name a savepoint.


@node LOCK TABLES, SET TRANSACTION, Savepoints, Transactional Commands
@subsection @code{LOCK TABLES} and @code{UNLOCK TABLES} Syntax

@findex LOCK TABLES
@findex UNLOCK TABLES

@c example_for_help_topic LOCK
@example
LOCK TABLES tbl_name [AS alias] @{READ [LOCAL] | [LOW_PRIORITY] WRITE@}
            [, tbl_name [AS alias] @{READ [LOCAL] | [LOW_PRIORITY] WRITE@} ...]
...
UNLOCK TABLES
@end example

@c description_for_help_topic LOCK  LOCK UNLOCK TABLES AS READ LOCAL LOW_PRIORITY WRITE
@code{LOCK TABLES} locks tables for the current thread.  @code{UNLOCK
TABLES} releases any locks held by the current thread.  All tables that
are locked by the current thread are implicitly unlocked when the
thread issues another @code{LOCK TABLES}, or when the connection to the
server is closed.
@c end_description_for_help_topic

To use @code{LOCK TABLES} in MySQL 4.0.2, you need the global
@code{LOCK TABLES} privilege and a @code{SELECT} privilege on the
involved tables. In MySQL 3.23 you need to have @code{SELECT},
@code{insert}, @code{DELETE} and @code{UPDATE} privileges for the
tables.

The main reasons to use @code{LOCK TABLES} are for emulating transactions
or getting more speed when updating tables.  This is explained in more
detail later.

If a thread obtains a @code{READ} lock on a table, that thread (and all other
threads) can only read from the table. If a thread obtains a @code{WRITE}
lock on a table, only the thread holding the lock can read from
or write to the table.  Other threads are blocked.

The difference between @code{READ LOCAL} and @code{READ} is that
@code{READ LOCAL} allows non-conflicting @code{INSERT} statements to
execute while the lock is held.  However, this can't be used if you are
going to manipulate the database files outside MySQL while you
hold the lock.

When you use @code{LOCK TABLES}, you must lock all tables that you are
going to use and you must use the same alias that you are going to use
in your queries!  If you are using a table multiple times in a query
(with aliases), you must get a lock for each alias!

@code{WRITE} locks normally have higher priority than @code{READ} locks, to
ensure that updates are processed as soon as possible. This means that if one
thread obtains a @code{READ} lock and then another thread requests a
@code{WRITE} lock, subsequent @code{READ} lock requests will wait until the
@code{WRITE} thread has gotten the lock and released it.  You can use
@code{LOW_PRIORITY WRITE} locks to allow other threads to obtain @code{READ}
locks while the thread is waiting for the @code{WRITE} lock. You should
use @code{LOW_PRIORITY WRITE} locks only if you are sure that there will
eventually be a time when no threads will have a @code{READ} lock.

@code{LOCK TABLES} works as follows:
@enumerate
@item
Sort all tables to be locked in a internally defined order (from the
user standpoint, the order is undefined).
@item
If a table is locked with a read and a write lock, put the write lock
before the read lock.
@item
Lock one table at a time until the thread gets all locks.
@end enumerate

This policy ensures that table locking is deadlock free. There are,
however, other things you need to be aware of with this schema:

If you are using a @code{LOW_PRIORITY WRITE} lock for a table, it
means only that MySQL will wait for this particlar lock until
there is no threads that want a @code{READ} lock.  When the thread has
gotten the @code{WRITE} lock and is waiting to get the lock for the next
table in the lock table list, all other threads will wait for the
@code{WRITE} lock to be released.  If this becomes a serious problem
with your application, you should consider converting some of your
tables to transaction-safe tables.

You can safely kill a thread that is waiting for a table lock with
@code{KILL}.  @xref{KILL}.

Note that you should @strong{not} lock any tables that you are using with
@code{INSERT DELAYED}. This is because, in this case, the @code{INSERT}
is done by a separate thread.

Normally, you don't have to lock tables, because all single @code{UPDATE} statements
are atomic; no other thread can interfere with any other currently executing
SQL statement. There are a few cases when you would like to lock tables
anyway:

@itemize @bullet
@item
If you are going to run many operations on a bunch of tables, it's much
faster to lock the tables you are going to use.  The downside is
that no thread can update a @code{READ}-locked table (including the one
holding the lock) and no thread can read a @code{WRITE}-locked table other
than the one holding the lock.

The reason some things are faster under @code{LOCK TABLES} is that
MySQL will not flush the key cache for the locked tables until
@code{UNLOCK TABLES} is called (normally the key cache is flushed after
each SQL statement). This speeds up inserting, updating, or deleting on
@code{MyISAM} tables.
@item
If you are using a storage engine in MySQL that doesn't support
transactions, you must use @code{LOCK TABLES} if you want to ensure that
no other thread comes between a @code{SELECT} and an @code{UPDATE}. The
example shown here requires @code{LOCK TABLES} to execute safely:

@example
mysql> LOCK TABLES trans READ, customer WRITE;
mysql> SELECT SUM(value) FROM trans WHERE customer_id=some_id;
mysql> UPDATE customer SET total_value=sum_from_previous_statement
    ->        WHERE customer_id=some_id;
mysql> UNLOCK TABLES;
@end example

Without @code{LOCK TABLES}, there is a chance that another thread might
insert a new row in the @code{trans} table between execution of the
@code{SELECT} and @code{UPDATE} statements.
@end itemize

By using incremental updates (@code{UPDATE customer SET
value=value+new_value}) or the @code{LAST_INSERT_ID()} function, you can
avoid using @code{LOCK TABLES} in many cases.

You can also solve some cases by using the user-level lock functions
@code{GET_LOCK()} and @code{RELEASE_LOCK()}.  These locks are saved in a hash
table in the server and implemented with @code{pthread_mutex_lock()} and
@code{pthread_mutex_unlock()} for high speed.
@xref{Miscellaneous functions}.

See @ref{Internal locking}, for more information on locking policy.

You can lock all tables in all databases with read locks with the
@code{FLUSH TABLES WITH READ LOCK} command. @xref{FLUSH}. This is very
convenient way to get backups if you have a filesystem, such as Veritas,
that can take snapshots in time.

@strong{NOTE}: @code{LOCK TABLES} is not transaction-safe and will
implicitly commit any active transactions before attempting to lock the
tables.


@node SET TRANSACTION,  , LOCK TABLES, Transactional Commands
@subsection @code{SET TRANSACTION} Syntax

@findex SET TRANSACTION
@findex ISOLATION LEVEL

@c description_for_help_topic ISOLATION  TRANSACTION ISOLATION LEVEL GLOBAL SESSION READ COMMITTED UNCOMMITTED REPEATABLE SERIALIZABLE
@example
SET [GLOBAL | SESSION] TRANSACTION ISOLATION LEVEL
@{ READ UNCOMMITTED | READ COMMITTED | REPEATABLE READ | SERIALIZABLE @}
@end example

Sets the transaction isolation level for the global, whole session, or
the next transaction.

The default behavior is to set the isolation level for the next (not
started) transaction.  If you use the @code{GLOBAL} keyword, the statement
sets the default transaction level globally for all new connections
created from that point on (but not existing connections).
You need the @code{SUPER}
privilege to do this.  Using the @code{SESSION} keyword sets the
default transaction level for all future transactions performed on the
current connection.

For description of each @code{InnoDB} transaction isolation level, see
@ref{InnoDB transaction isolation}.  InnoDB supports each of these levels
from MySQL 4.0.5 on. The default level is @code{REPEATABLE READ}.

You can set the default global isolation level for @code{mysqld} with
@code{--transaction-isolation=...}. @xref{Server options}.


@c end_description_for_help_topic


@node Database Administration, Replication SQL, Transactional Commands, SQL Syntax
@section Database Administration Statements

@c TODO: This node should be renamed. There is a "MySQL Database
@c Administration" node already, which is too similar.


@menu
* Account management SQL::      Account Management Statements
* Table maintenance SQL::       Table Maintenance Statements
* SHOW::                        @code{SHOW} Syntax
* Other administrative SQL::    Other Administrative Statements
@end menu

@c help_category Administration


@node Account management SQL, Table maintenance SQL, Database Administration, Database Administration
@subsection Account Management Statements

@c TODO: discuss SET PASSWORD here as well. Maybe split GRANT/REVOKE
@c into separate sections?

@menu
* GRANT::                       @code{GRANT} and @code{REVOKE} Syntax
@end menu

@node GRANT,  , Account management SQL, Account management SQL
@subsubsection @code{GRANT} and @code{REVOKE} Syntax

@findex GRANT
@findex REVOKE

@cindex privileges, granting
@cindex privileges, revoking
@cindex global privileges
@cindex revoking, privileges
@cindex granting, privileges

@c help_category Administration
@c example_for_help_topic GRANT
@example
GRANT priv_type [(column_list)] [, priv_type [(column_list)] ...]
    ON @{tbl_name | * | *.* | db_name.*@}
    TO user_name [IDENTIFIED BY [PASSWORD] 'password']
        [, user_name [IDENTIFIED BY [PASSWORD] 'password'] ...]
    [REQUIRE
        NONE |
        [@{SSL| X509@}]
        [CIPHER cipher [AND]]
        [ISSUER issuer [AND]]
        [SUBJECT subject]]
    [WITH [GRANT OPTION | MAX_QUERIES_PER_HOUR # |
                          MAX_UPDATES_PER_HOUR # |
                          MAX_CONNECTIONS_PER_HOUR #]]
@end example

@c example_for_help_topic REVOKE
@example
REVOKE priv_type [(column_list)] [, priv_type [(column_list)] ...]
    ON @{tbl_name | * | *.* | db_name.*@}
    FROM user_name [, user_name ...]

REVOKE ALL PRIVILEGES,GRANT FROM user_name [, user_name ...]
@end example

@code{GRANT} and @code{REVOKE} are implemented in MySQL Version 3.22.11 or
later. For earlier MySQL versions, these statements do nothing.

@c description_for_help_topic GRANT  ALL BY ALTER IDENTIFIED REQUIRE PASSWORD GRANT REVOKE ISSUER CIPHER WITH SUBJECT OPTION MAX_QUERIES_PER_HOUR MAX_UPDATES_PER_HOUR MAX_CONNECTIONS_PER_HOUR CLIENT EXECUTE FILE SSL X509 SECURITY USAGE SUPER NONE PROCESS PRIVILEGES REFERENCES RELOAD REPLICATION SHUTDOWN
The @code{GRANT} and @code{REVOKE} statements allow system administrators
to create users and grant and revoke rights to MySQL users at
four privilege levels:

@table @strong
@item Global level
Global privileges apply to all databases on a given server. These privileges
are stored in the @code{mysql.user} table.
@code{GRANT ALL ON *.*} and
@code{REVOKE ALL ON *.*} will grant and revoke only global privileges.

@item Database level
Database privileges apply to all tables in a given database. These privileges
are stored in the @code{mysql.db} and @code{mysql.host} tables.
@code{GRANT ALL ON db.*} and
@code{REVOKE ALL ON db.*} will grant and revoke only database privileges.

@item Table level
Table privileges apply to all columns in a given table. These privileges are
stored in the @code{mysql.tables_priv} table.
@code{GRANT ALL ON db.table} and
@code{REVOKE ALL ON db.table} will grant and revoke only table privileges.

@item Column level
Column privileges apply to single columns in a given table. These privileges are
stored in the @code{mysql.columns_priv} table.
When using @code{REVOKE} you must specify the same columns that were granted.
@end table
@c end_description_for_help_topic

To make it easy to revoke all privileges for a user, MySQL 4.1.1 has
added the syntax:

@example
REVOKE ALL PRIVILEGES,GRANT FROM user_name [, user_name ...]
@end example

This will drop all database, table and column level privileges for the
user.

@c description_for_help_topic GRANT types
For the @code{GRANT} and @code{REVOKE} statements, @code{priv_type} may be
specified as any of the following:

@c FIX agl 2002-06-13 New table, need to measure colwidths!
@multitable @columnfractions .30 .70
@item @code{ALL [PRIVILEGES]} @tab Sets all simple privileges except @code{WITH GRANT OPTION}
@item @code{ALTER}  @tab Allows usage of @code{ALTER TABLE}
@item @code{CREATE} @tab Allows usage of @code{CREATE TABLE}
@item @code{CREATE TEMPORARY TABLES} @tab Allows usage of @code{CREATE TEMPORARY TABLE}
@item @code{DELETE} @tab Allows usage of @code{DELETE}
@item @code{DROP} @tab Allows usage of @code{DROP TABLE}.
@item @code{EXECUTE} @tab Allows the user to run stored procedures (MySQL 5.0)
@item @code{FILE} @tab Allows usage of @code{SELECT ... INTO OUTFILE} and @code{LOAD DATA INFILE}.
@item @code{INDEX} @tab Allows usage of @code{CREATE INDEX} and @code{DROP INDEX}
@item @code{INSERT} @tab Allows usage of @code{INSERT}
@item @code{LOCK TABLES} @tab Allows usage of @code{LOCK TABLES} on tables for which one has the @code{SELECT} privilege.
@item @code{PROCESS} @tab Allows usage of @code{SHOW FULL PROCESSLIST}
@item @code{REFERENCES} @tab For the future
@item @code{RELOAD} @tab Allows usage of @code{FLUSH}
@item @code{REPLICATION CLIENT} @tab Gives the right to the user to ask where the slaves/masters are.
@item @code{REPLICATION SLAVE} @tab Needed for the replication slaves (to read binlogs from master).
@item @code{SELECT} @tab Allows usage of @code{SELECT}
@item @code{SHOW DATABASES} @tab @code{SHOW DATABASES} shows all databases.
@item @code{SHUTDOWN} @tab Allows usage of @code{mysqladmin shutdown}
@item @code{SUPER} @tab Allows one connect (once) even if
max_connections is reached and execute commands @code{CHANGE MASTER},
@code{KILL thread}, @code{mysqladmin debug}, @code{PURGE MASTER LOGS} and @code{SET GLOBAL}
@item @code{UPDATE} @tab Allows usage of @code{UPDATE}
@item @code{USAGE} @tab Synonym for ``no privileges.''
@item @code{GRANT OPTION} @tab Synonym for @code{WITH GRANT OPTION}
@end multitable
@c end_description_for_help_topic

@code{USAGE} can be used when you want to create a user that has no privileges.

The privileges @code{CREATE TEMPORARY TABLES}, @code{EXECUTE},
@code{LOCK TABLES}, @code{REPLICATION ...}, @code{SHOW DATABASES} and
@code{SUPER} are new for in version 4.0.2.  To use these new privileges
after upgrading to 4.0.2, you have to run the
@code{mysql_fix_privilege_tables} script.
@xref{Upgrading-grant-tables}.

In older MySQL versions, the @code{PROCESS} privilege gives the same
rights as the new @code{SUPER} privilege.

To revoke the @code{GRANT} privilege from a user, use a @code{priv_type}
value of @code{GRANT OPTION}:

@example
mysql> REVOKE GRANT OPTION ON ... FROM ...;
@end example

The only @code{priv_type} values you can specify for a table are @code{SELECT},
@code{INSERT}, @code{UPDATE}, @code{DELETE}, @code{CREATE}, @code{DROP},
@code{GRANT OPTION}, @code{INDEX}, and @code{ALTER}.

The only @code{priv_type} values you can specify for a column (that is, when
you use a @code{column_list} clause) are @code{SELECT}, @code{INSERT}, and
@code{UPDATE}.

MySQL allows you to create database level privileges even if the
database doesn't exist, to make it easy to prepare for database usage.
Currently MySQL does however not allow one to create table level grants
if the table doesn't exist. MySQL will not automatically revoke any privileges
even if you drop a table or drop a database.

You can set global privileges by using @code{ON *.*} syntax.  You can set
database privileges by using @code{ON db_name.*} syntax. If you specify
@code{ON *} and you have a current database, you will set the privileges for
that database.  (@strong{Warning:} If you specify @code{ON *} and you
@strong{don't} have a current database, you will affect the global privileges!)

@strong{Please note}: the @samp{_} and @samp{%} wildcards are allowed when
specifying database names in @code{GRANT} statements that grant privileges at
the global or database levels. This means that if you
wish to use for instance a @samp{_} character as part of a database name,
you should specify it as @samp{\_} in the @code{GRANT} command, to prevent
the user from being able to access additional databases matching the
wildcard pattern, for example, @code{GRANT ... ON `foo\_bar`.* TO ...}.

In order to accommodate granting rights to users from arbitrary hosts,
MySQL supports specifying the @code{user_name} value in the form
@code{user@@host}.  If you want to specify a @code{user} string
containing special characters (such as @samp{-}), or a @code{host} string
containing special characters or wildcard characters (such as @samp{%}), you
can quote the username or hostname (for example, @code{'test-user'@@'test-hostname'}).

You can specify wildcards in the hostname.  For example,
@code{user@@'%.loc.gov'} applies to @code{user} for any host in the
@code{loc.gov} domain, and @code{user@@'144.155.166.%'} applies to @code{user}
for any host in the @code{144.155.166} class C subnet.

The simple form @code{user} is a synonym for @code{user@@"%"}.

MySQL doesn't support wildcards in usernames.  Anonymous users are
defined by inserting entries with @code{User=''} into the
@code{mysql.user} table or creating a user with an empty name with the
@code{GRANT} command.

@strong{Note:} If you allow anonymous users to connect to the MySQL
server, you should also grant privileges to all local users as
@code{user@@localhost} because otherwise the anonymous user entry for
the local host in the @code{mysql.user} table will be used when the user
tries to log into the MySQL server from the local machine!

You can verify if this applies to you by executing this query:

@example
mysql> SELECT Host,User FROM mysql.user WHERE User='';
@end example

For the moment, @code{GRANT} only supports host, table, database, and
column names up to 60 characters long. A username can be up to 16
characters.

The privileges for a table or column are formed from the
logical OR of the privileges at each of the four privilege
levels.  For example, if the @code{mysql.user} table specifies that a
user has a global @code{SELECT} privilege, this can't be denied by an
entry at the database, table, or column level.

The privileges for a column can be calculated as follows:

@example
global privileges
OR (database privileges AND host privileges)
OR table privileges
OR column privileges
@end example

In most cases, you grant rights to a user at only one of the privilege
levels, so life isn't normally as complicated as above. The details of the
privilege-checking procedure are presented in
@ref{Privilege system}.

If you grant privileges for a user/hostname combination that does not exist
in the @code{mysql.user} table, an entry is added and remains there until
deleted with a @code{DELETE} command.  In other words, @code{GRANT} may
create @code{user} table entries, but @code{REVOKE} will not remove them;
you must do that explicitly using @code{DELETE}.

@cindex passwords, setting
In MySQL Version 3.22.12 or later,
if a new user is created or if you have global grant privileges, the user's
password will be set to the password specified by the @code{IDENTIFIED BY}
clause, if one is given.  If the user already had a password, it is replaced
by the new one.

If you don't want to send the password in clear text you can use the
@code{PASSWORD} option followed by a scrambled password from SQL
function @code{PASSWORD()} or the C API function
@code{make_scrambled_password(char *to, const char *password)}.

@strong{Warning:} If you create a new user but do not specify an
@code{IDENTIFIED BY} clause, the user has no password.  This is insecure.

Passwords can also be set with the @code{SET PASSWORD} command.
@xref{SET OPTION, , @code{SET}}.

If you grant privileges for a database, an entry in the @code{mysql.db}
table is created if needed. When all privileges for the database have been
removed with @code{REVOKE}, this entry is deleted.

If a user doesn't have any privileges on a table, the table is not displayed
when the user requests a list of tables (for example, with a @code{SHOW TABLES}
statement). The same is true for @code{SHOW DATABASES}.

The @code{WITH GRANT OPTION} clause gives the user the ability to give
to other users any privileges the user has at the specified privilege level.
You should be careful to whom you give the @code{GRANT} privilege, as two
users with different privileges may be able to join privileges!

@code{MAX_QUERIES_PER_HOUR #}, @code{MAX_UPDATES_PER_HOUR #} and
@code{MAX_CONNECTIONS_PER_HOUR #} are new in MySQL version 4.0.2.
These options limit the number of queries/updates and logins the user can
do during one hour. If @code{#} is 0 (default), then this means that there
are no limitations for that user. @xref{User resources}.
Note: To specify any of these options for an existing user without adding
other additional privileges, use @code{GRANT USAGE ON *.* ... WITH MAX_...}.

You cannot grant another user a privilege you don't have yourself;
the @code{GRANT} privilege allows you to give away only those privileges
you possess.

Be aware that when you grant a user the @code{GRANT} privilege at a
particular privilege level, any privileges the user already possesses (or
is given in the future!) at that level are also grantable by that user.
Suppose you grant a user the @code{INSERT} privilege on a database.  If
you then grant the @code{SELECT} privilege on the database and specify
@code{WITH GRANT OPTION}, the user can give away not only the @code{SELECT}
privilege, but also @code{INSERT}.  If you then grant the @code{UPDATE}
privilege to the user on the database, the user can give away the
@code{INSERT}, @code{SELECT} and @code{UPDATE}.

You should not grant @code{ALTER} privileges to a normal user.  If you
do that, the user can try to subvert the privilege system by renaming
tables!

Note that if you are using table or column privileges for even one user, the
server examines table and column privileges for all users and this will slow
down MySQL a bit.

When @code{mysqld} starts, all privileges are read into memory.
Database, table, and column privileges take effect at once, and
user-level privileges take effect the next time the user connects.
Modifications to the grant tables that you perform using @code{GRANT} or
@code{REVOKE} are noticed by the server immediately.
If you modify the grant tables manually (using @code{INSERT}, @code{UPDATE},
etc.), you should execute a @code{FLUSH PRIVILEGES} statement or run
@code{mysqladmin flush-privileges} to tell the server to reload the grant
tables.
@xref{Privilege changes}.

@cindex Standard SQL, differences from
The biggest differences between the SQL standard and MySQL versions of
@code{GRANT} are:

@itemize @bullet
@item
In MySQL privileges are given for a username + hostname combination
and not only for a username.

@item
SQL-99 doesn't have global or database-level privileges, nor does it 
support all the privilege types that MySQL supports.
MySQL doesn't support the SQL-99 @code{TRIGGER} or @code{UNDER}
privileges.

@item
SQL-99 privileges are structured in a hierarchal manner. If you remove
an user, all privileges the user has granted are revoked. In
MySQL the granted privileges are not automatically revoked, but
you have to revoke these yourself if needed.

@item
In MySQL, if you have the @code{INSERT} privilege on only some of the
columns in a table, you can execute @code{INSERT} statements on the
table; the columns for which you don't have the @code{INSERT} privilege
will be set to their default values. SQL-99 requires you to have the
@code{INSERT} privilege on all columns.

@item
With SQL99, when you drop a table, all privileges for the table are revoked.
With SQL-99, when you revoke a privilege, all privileges that were granted based
on the privilege are also revoked. In MySQL, privileges can be
dropped only with explicit @code{REVOKE} commands or by manipulating the
MySQL grant tables.
@end itemize

For a description of using @code{REQUIRE}, see @ref{Secure connections}.

@node Table maintenance SQL, SHOW, Account management SQL, Database Administration
@subsection Table Maintenance Statements

@menu
* ANALYZE TABLE::               @code{ANALYZE TABLE} Syntax
* BACKUP TABLE::                @code{BACKUP TABLE} Syntax
* CHECK TABLE::                 @code{CHECK TABLE} Syntax
* CHECKSUM TABLE::              @code{CHECKSUM TABLE} Syntax
* OPTIMIZE TABLE::              @code{OPTIMIZE TABLE} Syntax
* REPAIR TABLE::                @code{REPAIR TABLE} Syntax
* RESTORE TABLE::               @code{RESTORE TABLE} Syntax
@end menu


@node ANALYZE TABLE, BACKUP TABLE, Table maintenance SQL, Table maintenance SQL
@subsubsection @code{ANALYZE TABLE} Syntax

@findex ANALYZE TABLE

@c example_for_help_topic ANALYZE
@example
ANALYZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE tbl_name[,tbl_name...]
@end example

@c description_for_help_topic ANALYZE  TABLE NO_WRITE_TO_BINLOG LOCAL
Analyze and store the key distribution for the table.  During the
analysis, the table is locked with a read lock.  This works on
@code{MyISAM} and @code{BDB} tables.

This is equivalent to running @code{myisamchk -a} on the table.

MySQL uses the stored key distribution to decide in which order
tables should be joined when you perform a join on something other than a
constant.
@c end_description_for_help_topic

The command returns a table with the following columns:

@multitable @columnfractions .15 .40
@item @strong{Column} @tab @strong{Value}
@item Table @tab Table name
@item Op @tab Always @code{analyze}
@item Msg_type @tab One of @code{status}, @code{error}, @code{info}, or @code{warning}
@item Msg_text @tab The message
@end multitable

You can check the stored key distribution with the @code{SHOW INDEX} command.
@xref{Show database info}.

If the table hasn't changed since the last @code{ANALYZE TABLE} command,
the table will not be analyzed again.

Before MySQL 4.1.1, @code{ANALYZE} commands are not written
to the binary log. Since MySQL 4.1.1 they are written to the binary
log unless the optional @code{NO_WRITE_TO_BINLOG} keyword 
(or its alias @code{LOCAL}) was used.


@node BACKUP TABLE, CHECK TABLE, ANALYZE TABLE, Table maintenance SQL
@subsubsection @code{BACKUP TABLE} Syntax

@findex BACKUP TABLE

@cindex backups, database

@c example_for_help_topic BACKUP TABLE
@example
BACKUP TABLE tbl_name[,tbl_name...] TO '/path/to/backup/directory'
@end example

@c description_for_help_topic BACKUP TABLE  BACKUP TABLE
Note: This statement is deprecated. We are working on a better
replacement for it that will provide online backup capabilities.
In the meantime, the @code{mysqlhotcopy} script can be used instead.

Copies to the backup directory the minimum number of table files needed
to restore the table, after flushing any buffered changes to disk. Currently
works only for @code{MyISAM} tables.
For @code{MyISAM} tables, copies @file{.frm} (definition)  and
@file{.MYD} (data) files. The index file can be rebuilt from those two files.
@c end_description_for_help_topic

Before using this command, please see @ref{Backup}.

During the backup, a read lock will be held for each table, one at time,
as they are being backed up. If you want to back up several tables as
a snapshot, you must first issue @code{LOCK TABLES} to obtain a read
lock for each table in the group.

The command returns a table with the following columns:

@multitable @columnfractions .15 .40
@item @strong{Column} @tab @strong{Value}
@item Table @tab Table name
@item Op @tab Always @code{backup}
@item Msg_type @tab One of @code{status}, @code{error}, @code{info}, or @code{warning}
@item Msg_text @tab The message
@end multitable

Note that @code{BACKUP TABLE} is only available in MySQL
version 3.23.25 and later.


@node CHECK TABLE, CHECKSUM TABLE, BACKUP TABLE, Table maintenance SQL
@subsubsection @code{CHECK TABLE} Syntax

@findex CHECK TABLE

@c example_for_help_topic CHECK
@example
CHECK TABLE tbl_name[,tbl_name...] [option [option...]]

option = QUICK | FAST | MEDIUM | EXTENDED | CHANGED
@end example

@c description_for_help_topic CHECK  TABLE QUICK FAST MEDIUM EXTENDED CHANGED
@code{CHECK TABLE} works only on @code{MyISAM} and @code{InnoDB} tables. On
@code{MyISAM} tables, it's the same thing as running @code{myisamchk
--medium-check table_name} on the table.

If you don't specify any option, @code{MEDIUM} is used.
@c end_description_for_help_topic

Checks the table or tables for errors. For @code{MyISAM} tables, the key statistics
are updated. The command returns a table with the following columns:

@multitable @columnfractions .15 .40
@item @strong{Column} @tab @strong{Value}
@item Table    @tab Table name
@item Op       @tab Always @code{check}
@item Msg_type @tab One of @code{status}, @code{error}, @code{info}, or @code{warning}
@item Msg_text @tab The message
@end multitable

Note that the statement might produce many rows of information for each checked table.
The last row will be of @code{Msg_type status} and should normally be
@code{OK}.
If you don't get @code{OK}, or @code{Table is already up to
date} you should normally run a repair of the table. @xref{Table
maintenance}. @code{Table is already up to date} means that the storage
manager for the table indicated that there was no need to check the table.

The different check types are as follows:

@multitable @columnfractions .15 .85
@item @strong{Type} @tab @strong{Meaning}
@item @code{QUICK} @tab Don't scan the rows to check for incorrect links.
@item @code{FAST}  @tab Only check tables that haven't been closed properly.
@item @code{CHANGED} @tab Only check tables that have been changed since the last check or haven't been closed properly.
@item @code{MEDIUM} @tab Scan rows to verify that deleted links are okay. This also calculates a key checksum for the rows and verifies this with a calculated checksum for the keys.
@item @code{EXTENDED} @tab Do a full key lookup for all keys for each row.  This ensures that the table is 100% consistent, but will take a long time!
@end multitable

For dynamically sized @code{MyISAM} tables, a started check will always
do a @code{MEDIUM} check. For statically sized rows, we skip the row scan
for @code{QUICK} and @code{FAST} because the rows are very seldom corrupted.

You can combine check options, as in the following example, which does
a quick check on the table to see whether it was
closed properly:

@example
CHECK TABLE test_table FAST QUICK;
@end example

@strong{Note:} In some cases, @code{CHECK TABLE} will change the
table!  This happens if the table is marked as 'corrupted' or 'not
closed properly' but @code{CHECK TABLE} didn't find any problems in the
table.  In this case, @code{CHECK TABLE} will mark the table as okay.

If a table is corrupted, it's most likely that the problem is in
the indexes and not in the data part.  All of the above check types
checks the indexes thoroughly and should thus find most errors.

If you just want to check a table that you assume is okay, you should use
no check options or the @code{QUICK} option. The latter should be used
when you are in a hurry and can take the very small risk that
@code{QUICK} didn't find an error in the datafile. (In most cases
MySQL should find, under normal usage, any error in the datafile.
If this happens then the table will be marked as 'corrupted',
in which case the table can't be used until it's repaired.)

@code{FAST} and @code{CHANGED} are mostly intended to be used from a
script (for example to be executed from @code{cron}) if you want to check your
table from time to time. In most cases, @code{FAST} is to be preferred
over @code{CHANGED}.  (The only case when it isn't is when you suspect
that you have found a bug in the @code{MyISAM} code.)

@code{EXTENDED} is to be used only after you have run a normal check but
still get strange errors from a table when MySQL tries to
update a row or find a row by key. (This is very unlikely if a
normal check has succeeded!)

Some problems reported by @code{CHECK TABLE} can't be corrected automatically:

@itemize @bullet
@item
@code{Found row where the auto_increment column has the value 0}.

This means that you have a row in the table where the
@code{AUTO_INCREMENT} index column contains the value 0.
(It's possible to create a row where the @code{AUTO_INCREMENT} column is 0 by
explicitly setting the column to 0 with an @code{UPDATE} statement.)

This isn't an error in itself, but could cause trouble if you decide to
dump the table and restore it or do an @code{ALTER TABLE} on the
table. In this case, the @code{AUTO_INCREMENT} column will change value
according to the rules of @code{AUTO_INCREMENT} columns, which could cause
problems such as a duplicate key error.

To get rid of the warning, just execute an @code{UPDATE} statement
to set the column to some other value than 0.
@end itemize


@node CHECKSUM TABLE, OPTIMIZE TABLE, CHECK TABLE, Table maintenance SQL
@subsubsection @code{CHECKSUM TABLE} Syntax
@findex CHECKSUM TABLE

@c example_for_help_topic CHECKSUM
@example
CHECKSUM TABLE tbl_name[,tbl_name ...] [ QUICK | EXTENDED ]
@end example

@c description_for_help_topic CHECKSUM

Reports a table checksum. If @code{QUICK} is specified, live table
checksum is reported, or @code{NULL} if the table does not support live
checksum. This is very fast.  In @code{EXTENDED}
mode the whole table is read row by row and the checksum is
calculated. This can be very slow for large tables. By default - with
neither @code{QUICK} nor @code{EXTENDED} - MySQL returns live checksum
if the table support it and scans the table otherwise.

This statement is implemented in MySQL 4.1.1.


@node OPTIMIZE TABLE, REPAIR TABLE, CHECKSUM TABLE, Table maintenance SQL
@subsubsection @code{OPTIMIZE TABLE} Syntax

@findex OPTIMIZE TABLE

@cindex tables, defragmenting
@cindex tables, fragmentation

@c example_for_help_topic OPTIMIZE
@example
OPTIMIZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE tbl_name[,tbl_name]...
@end example

@c description_for_help_topic OPTIMIZE  NO_WRITE_TO_BINLOG LOCAL TABLE
@code{OPTIMIZE TABLE} should be used if you have deleted a large part of a
table or if you have made many changes to a table with variable-length rows
(tables that have @code{VARCHAR}, @code{BLOB}, or @code{TEXT} columns).
Deleted records are maintained in a linked list and subsequent @code{INSERT}
operations reuse old record positions. You can use @code{OPTIMIZE TABLE} to
reclaim the unused space and to defragment the datafile.
@c end_description_for_help_topic

In most setups you don't have to run @code{OPTIMIZE TABLE} at all.  Even
if you do a lot of updates to variable length rows it's not likely that
you need to do this more than once a month/week and only on certain
tables.

For the moment, @code{OPTIMIZE TABLE} works only on @code{MyISAM} and
@code{BDB} tables. For @code{BDB} tables, @code{OPTIMIZE TABLE} is
currently mapped to @code{ANALYZE TABLE}.
@xref{ANALYZE TABLE, , @code{ANALYZE TABLE}}.

You can get @code{OPTIMIZE TABLE} to work on other table types by starting
@code{mysqld} with @code{--skip-new} or @code{--safe-mode}, but in this
case @code{OPTIMIZE TABLE} is just mapped to @code{ALTER TABLE}.

@code{OPTIMIZE TABLE} works the following way:
@itemize @bullet
@item
If the table has deleted or split rows, repair the table.
@item
If the index pages are not sorted, sort them.
@item
If the statistics are not up to date (and the repair couldn't be done
by sorting the index), update them.
@end itemize

Note that the table is locked during the time @code{OPTIMIZE TABLE} is
running!

Before MySQL 4.1.1, @code{OPTIMIZE} commands are not written
to the binary log. Since MySQL 4.1.1 they are written to the binary
log unless the optional @code{NO_WRITE_TO_BINLOG} keyword 
(or its alias @code{LOCAL}) was used.


@node REPAIR TABLE, RESTORE TABLE, OPTIMIZE TABLE, Table maintenance SQL
@subsubsection @code{REPAIR TABLE} Syntax

@findex REPAIR TABLE

@c example_for_help_topic REPAIR
@example
REPAIR [LOCAL | NO_WRITE_TO_BINLOG] TABLE tbl_name[,tbl_name...] [QUICK] [EXTENDED] [USE_FRM]
@end example

@c description_for_help_topic REPAIR  USE_FRM TABLE QUICK EXTENDED NO_WRITE_TO_BINLOG LOCAL
@code{REPAIR TABLE} works only on @code{MyISAM} tables and is the same
as running @code{myisamchk -r table_name} on the table.
@c end_description_for_help_topic

Normally you should never have to run this command, but if disaster strikes,
you are very likely to get back all your data from a MyISAM table with
@code{REPAIR TABLE}. If your tables get corrupted often, you should
try to find the reason for it, to eliminate the need to use @code{REPAIR
TABLE}.
@xref{Crashing}. @xref{MyISAM table problems}.

@code{REPAIR TABLE} repairs a possibly corrupted table. The command returns a
table with the following columns:

@multitable @columnfractions .15 .40
@item @strong{Column} @tab @strong{Value}
@item Table @tab Table name
@item Op @tab Always @code{repair}
@item Msg_type @tab One of @code{status}, @code{error}, @code{info}, or @code{warning}
@item Msg_text @tab The message
@end multitable

Note that the statement might produce many rows of information for each repaired
table.
The last one row will be of @code{Msg_type status} and should
normally be @code{OK}.
If you don't get @code{OK}, you should try
repairing the table with @code{myisamchk --safe-recover}, because @code{REPAIR TABLE}
does not yet implement all the options of @code{myisamchk}. In the near
future, we will make it more flexible.

If @code{QUICK} is given, @code{REPAIR TABLE} tries to repair
only the index tree.

If you use @code{EXTENDED}, MySQL creates the index row
by row instead of creating one index at a time with sorting; this might be
better than sorting on fixed-length keys if you have long @code{CHAR}
keys that compress very well.  This type of repair is like that done by
@code{myisamchk --safe-recover}.

As of @code{MySQL} 4.0.2, there is a @code{USE_FRM} mode for @code{REPAIR}.
Use it if the @file{.MYI} file is missing or if its header is corrupted.
In this mode MySQL will re-create the table, using information from the
@file{.frm} file. This kind of repair cannot be done with @code{myisamchk}.

@strong{Warning:} If @code{mysqld} dies during a @code{REPAIR TABLE},
it's essential that you do at once another @code{REPAIR} on the table
before executing any other commands on it. (It's always good
to start by making a backup).  In the worst case you can have a new clean
index file without information about the datafile and when the next
command you do may overwrite the datafile.  This is not a likely, but
possible scenario.

Before MySQL 4.1.1, @code{REPAIR} commands are not written
to the binary log. Since MySQL 4.1.1 they are written to the binary
log unless the optional @code{NO_WRITE_TO_BINLOG} keyword 
(or its alias @code{LOCAL}) was used.


@node RESTORE TABLE,  , REPAIR TABLE, Table maintenance SQL
@subsubsection @code{RESTORE TABLE} Syntax

@findex RESTORE TABLE

@c description_for_help_topic RESTORE  TABLE

@example
RESTORE TABLE tbl_name[,tbl_name...] FROM '/path/to/backup/directory'
@end example

Restores the table or tables from the backup that was made with
@code{BACKUP TABLE}. Existing tables will not be overwritten; if you
try to restore over an existing table, you will get an error. Restoring
will take longer than backing up due to the need to rebuild the index. The
more keys you have, the longer it will take. Just as @code{BACKUP TABLE},
@code{RESTORE TABLE} currently works only for @code{MyISAM} tables.
@c end_description_for_help_topic

The command returns a table with the following columns:

@multitable @columnfractions .15 .40
@item @strong{Column} @tab @strong{Value}
@item Table @tab Table name
@item Op @tab Always @code{restore}
@item Msg_type @tab One of @code{status}, @code{error}, @code{info}, or @code{warning}
@item Msg_text @tab The message
@end multitable


@node SHOW, Other administrative SQL, Table maintenance SQL, Database Administration
@subsection @code{SHOW} Syntax

@c FIX more index hits needed

@findex Database information, obtaining
@findex SHOW DATABASES
@findex SHOW TABLES
@findex SHOW COLUMNS
@findex SHOW FIELDS
@findex SHOW INDEX
@findex SHOW KEYS
@findex SHOW STATUS
@findex SHOW VARIABLES
@findex SHOW PROCESSLIST
@findex SHOW TABLE STATUS
@findex SHOW GRANTS
@findex SHOW CREATE TABLE
@findex SHOW MASTER STATUS
@findex SHOW MASTER LOGS
@findex SHOW SLAVE STATUS
@findex SHOW WARNINGS
@findex SHOW TABLE TYPES

@c example_for_help_topic SHOW
@example
   SHOW DATABASES [LIKE wild]
or SHOW [OPEN] TABLES [FROM db_name] [LIKE wild]
or SHOW [FULL] COLUMNS FROM tbl_name [FROM db_name] [LIKE wild]
or SHOW INDEX FROM tbl_name [FROM db_name]
or SHOW TABLE STATUS [FROM db_name] [LIKE wild]
or SHOW STATUS [LIKE wild]
or SHOW VARIABLES [LIKE wild]
or SHOW [BDB] LOGS
or SHOW [FULL] PROCESSLIST
or SHOW GRANTS FOR user
or SHOW CREATE TABLE table_name
or SHOW MASTER STATUS
or SHOW MASTER LOGS
or SHOW SLAVE STATUS
or SHOW WARNINGS [LIMIT row_count]
or SHOW ERRORS [LIMIT row_count]
or SHOW TABLE TYPES
@end example

@c description_for_help_topic SHOW  COLUMNS EVENTS LIKE TABLES OPEN FROM INDEX INDEXES STATUS VARIABLES DATABASES LOGS FULL PROCESSLIST FOR GRANTS TABLE CREATE MASTER SLAVE WARNINGS ERRORS TYPES FIELDS HOSTS KEYS MASTER_SERVER_ID NEW

@code{SHOW} provides information about databases, tables, columns, or
status information about the server. If the @code{LIKE wild} part is
used, the @code{wild} string can be a string that uses the SQL @samp{%}
and @samp{_} wildcard characters.
@c end_description_for_help_topic

Note that there are other forms of the @code{SHOW} statement that provide
information about replication master and slave servers. They are described
in @ref{Replication SQL}.

@menu
* Show database info::          Retrieving Information about Database, Tables, Columns, and Indexes
* SHOW TABLE STATUS::           @code{SHOW TABLE STATUS}
* SHOW STATUS::                 @code{SHOW STATUS}
* SHOW VARIABLES::              @code{SHOW VARIABLES}
* SHOW LOGS::                   @code{SHOW [BDB] LOGS}
* SHOW PROCESSLIST::            @code{SHOW PROCESSLIST}
* SHOW GRANTS::                 @code{SHOW GRANTS}
* SHOW CREATE TABLE::           @code{SHOW CREATE TABLE}
* SHOW WARNINGS::               @code{SHOW WARNINGS | ERRORS}
* SHOW TABLE TYPES::            @code{SHOW TABLE TYPES}
* SHOW PRIVILEGES::             @code{SHOW PRIVILEGES}
@end menu


@node Show database info, SHOW TABLE STATUS, SHOW, SHOW
@subsubsection Retrieving Information about Database, Tables, Columns, and Indexes

@cindex displaying, information, @code{SHOW}

You can use @code{db_name.tbl_name} as an alternative to the @code{tbl_name
FROM db_name} syntax.  These two statements are equivalent:

@example
mysql> SHOW INDEX FROM mytable FROM mydb;
mysql> SHOW INDEX FROM mydb.mytable;
@end example

@code{SHOW DATABASES} lists the databases on the MySQL server host.
You can also get this list using the @code{mysqlshow} command line tool.
In version 4.0.2 you will see only those databases for which you have some
kind of privilege, if you don't have the global @code{SHOW DATABASES}
privilege.

@code{SHOW TABLES} lists the tables in a given database.  You can also
get this list using the @code{mysqlshow db_name} command.

@strong{Note:} If a user doesn't have any privileges for a table, the table
will not show up in the output from @code{SHOW TABLES} or @code{mysqlshow
db_name}.

@code{SHOW OPEN TABLES} lists the tables that are currently open in
the table cache. @xref{Table cache}.  The @code{Comment} field tells
how many times the table is @code{cached} and @code{in_use}.

@code{SHOW COLUMNS} lists the columns in a given table.  If you specify
the @code{FULL} option, you will also get the privileges you have for
each column.  If the column types are different from what you expect them to
be based on a @code{CREATE TABLE} statement, note that MySQL
sometimes changes column types.  @xref{Silent column changes}.
As of MySQL 4.1, the @code{FULL} keyword also causes any per-column comments
to be displayed.

The @code{DESCRIBE} statement provides information similar to
@code{SHOW COLUMNS}.
@xref{DESCRIBE, , @code{DESCRIBE}}.

@code{SHOW FIELDS} is a synonym for @code{SHOW COLUMNS}, and
@code{SHOW KEYS} is a synonym for @code{SHOW INDEX}.  You can also
list a table's columns or indexes with @code{mysqlshow db_name tbl_name}
or @code{mysqlshow -k db_name tbl_name}.

@code{SHOW INDEX} returns the index information in a format that closely
resembles the @code{SQLStatistics} call in ODBC. The following columns
are returned:

@multitable @columnfractions .15 .55
@item @strong{Column}            @tab @strong{Meaning}
@item @code{Table}               @tab Name of the table.
@item @code{Non_unique}          @tab 0 if the index can't contain duplicates, 1 if it can.
@item @code{Key_name}            @tab Name of the index.
@item @code{Seq_in_index}        @tab Column sequence number in index,
                                      starting with 1.
@item @code{Column_name}         @tab Column name.
@item @code{Collation}           @tab How the column is sorted in the index.
                                      In MySQL, this can have values
                                      @samp{A} (Ascending) or @code{NULL} (Not
                                      sorted).
@item @code{Cardinality}         @tab Number of unique values in the index.
                                      This is updated by running
                                      @code{myisamchk -a}.
@item @code{Sub_part}            @tab Number of indexed characters if the
                                      column is only partly indexed.
                                      @code{NULL} if the entire column is indexed.
@item @code{Packed}              @tab Indicates how the key is packed.  @code{NULL} if it is not.
@item @code{Null}                @tab Contains @code{YES} if the column may contain @code{NULL}.
@item @code{Index_type}          @tab Index method used.
@item @code{Comment}             @tab Various remarks.  For now, it tells
in MySQL < 4.0.2 whether or not index is @code{FULLTEXT}.
@end multitable

Note that as the @code{Cardinality} is counted based on statistics
stored as integers, it's not necessarily accurate for small tables.

The @code{Packed} and @code{Comments} columns were added in MySQL 3.23.0.
The @code{Null} and @code{Index_type} columns were added in MySQL 4.0.2.

@node SHOW TABLE STATUS, SHOW STATUS, Show database info, SHOW
@subsubsection @code{SHOW TABLE STATUS}

@cindex displaying, table status
@cindex tables, displaying status
@cindex status, tables

@example
SHOW TABLE STATUS [FROM db_name] [LIKE wild]
@end example

@code{SHOW TABLE STATUS} (new in Version 3.23) works likes @code{SHOW
TABLE}, but provides a lot of information about each table. You can
also get this list using the @code{mysqlshow --status db_name} command.
The following columns are returned:

@multitable @columnfractions .20 .70
@item @strong{Column} @tab @strong{Meaning}
@item @code{Name} @tab Name of the table.
@item @code{Type} @tab Type of table. @xref{Table types}.
@item @code{Row_format} @tab The row storage format (Fixed, Dynamic, or Compressed).
@item @code{Rows} @tab Number of rows.
@item @code{Avg_row_length} @tab Average row length.
@item @code{Data_length} @tab Length of the datafile.
@item @code{Max_data_length} @tab Max length of the datafile.
For fixed row formats, this is the max number of rows in the table.
For dynamic row formats, this is the total number of data bytes that
can be stored in the table, given the data pointer size used.
@item @code{Index_length} @tab Length of the index file.
@item @code{Data_free} @tab Number of allocated but not used bytes.
@item @code{Auto_increment} @tab Next autoincrement value.
@item @code{Create_time} @tab When the table was created.
@item @code{Update_time} @tab When the datafile was last updated.
@item @code{Check_time} @tab When the table was last checked.
@item @code{Collation} @tab Table's character set and collation. (new 4.1.1)
@item @code{Checksum} @tab Live checksum value (if any). (new in 4.1.1)
@item @code{Create_options} @tab Extra options used with @code{CREATE TABLE}.
@item @code{Comment} @tab The comment used when creating the table (or some information why MySQL couldn't access the table information).
@end multitable

@code{InnoDB} tables will report the free space in the tablespace
in the table comment.


@node SHOW STATUS, SHOW VARIABLES, SHOW TABLE STATUS, SHOW
@subsubsection @code{SHOW STATUS}

@cindex @code{mysqladmin}
@code{SHOW STATUS} provides server status information
(like @code{mysqladmin extended-status}). The output resembles that shown
here, though the format and numbers probably differ:

@example
+--------------------------+------------+
| Variable_name            | Value      |
+--------------------------+------------+
| Aborted_clients          | 0          |
| Aborted_connects         | 0          |
| Bytes_received           | 155372598  |
| Bytes_sent               | 1176560426 |
| Connections              | 30023      |
| Created_tmp_disk_tables  | 0          |
| Created_tmp_tables       | 8340       |
| Created_tmp_files        | 60         |
| Delayed_insert_threads   | 0          |
| Delayed_writes           | 0          |
| Delayed_errors           | 0          |
| Flush_commands           | 1          |
| Handler_delete           | 462604     |
| Handler_read_first       | 105881     |
| Handler_read_key         | 27820558   |
| Handler_read_next        | 390681754  |
| Handler_read_prev        | 6022500    |
| Handler_read_rnd         | 30546748   |
| Handler_read_rnd_next    | 246216530  |
| Handler_update           | 16945404   |
| Handler_write            | 60356676   |
| Key_blocks_used          | 14955      |
| Key_read_requests        | 96854827   |
| Key_reads                | 162040     |
| Key_write_requests       | 7589728    |
| Key_writes               | 3813196    |
| Max_used_connections     | 0          |
| Not_flushed_key_blocks   | 0          |
| Not_flushed_delayed_rows | 0          |
| Open_tables              | 1          |
| Open_files               | 2          |
| Open_streams             | 0          |
| Opened_tables            | 44600      |
| Questions                | 2026873    |
| Select_full_join         | 0          |
| Select_full_range_join   | 0          |
| Select_range             | 99646      |
| Select_range_check       | 0          |
| Select_scan              | 30802      |
| Slave_running            | OFF        |
| Slave_open_temp_tables   | 0          |
| Slow_launch_threads      | 0          |
| Slow_queries             | 0          |
| Sort_merge_passes        | 30         |
| Sort_range               | 500        |
| Sort_rows                | 30296250   |
| Sort_scan                | 4650       |
| Table_locks_immediate    | 1920382    |
| Table_locks_waited       | 0          |
| Threads_cached           | 0          |
| Threads_created          | 30022      |
| Threads_connected        | 1          |
| Threads_running          | 1          |
| Uptime                   | 80380      |
+--------------------------+------------+
@end example

@cindex variables, status
The status variables listed above have the following meaning:

@multitable @columnfractions .30 .70
@item @strong{Variable} @tab @strong{Meaning}
@item @code{Aborted_clients} @tab Number of connections aborted because the client died without closing the connection properly. @xref{Communication errors}.
@item @code{Aborted_connects} @tab Number of tries to connect to the MySQL server that failed. @xref{Communication errors}.
@item @code{Bytes_received} @tab Number of bytes received from all clients.
@item @code{Bytes_sent} @tab Number of bytes sent to all clients.
@item @code{Com_xxx} @tab Number of times each xxx command has been executed.
@item @code{Connections} @tab Number of connection attempts to the MySQL server.
@item @code{Created_tmp_disk_tables} @tab Number of implicit temporary tables on disk created while executing statements.
@item @code{Created_tmp_tables} @tab Number of implicit temporary tables in memory created while executing statements.
@item @code{Created_tmp_files} @tab How many temporary files @code{mysqld} has created.
@item @code{Delayed_insert_threads} @tab Number of delayed insert handler threads in use.
@item @code{Delayed_writes} @tab Number of rows written with @code{INSERT DELAYED}.
@item @code{Delayed_errors} @tab Number of rows written with @code{INSERT DELAYED} for which some error occurred (probably @code{duplicate key}).
@item @code{Flush_commands} @tab Number of executed @code{FLUSH} commands.
@item @code{Handler_commit} @tab Number of internal @code{COMMIT} commands.
@item @code{Handler_delete} @tab Number of times a row was deleted from a table.
@item @code{Handler_read_first} @tab Number of times the first entry was read from an index.
If this is high, it suggests that the server is doing a lot of full index scans, for example,
@code{SELECT col1 FROM foo}, assuming that col1 is indexed.
@item @code{Handler_read_key} @tab Number of requests to read a row based on a key. If this
is high, it is a good indication that your queries and tables are properly indexed.
@item @code{Handler_read_next} @tab Number of requests to read next row in key order. This
will be incremented if you are querying an index column with a range constraint. This also
will be incremented if you are doing an index scan.
@item @code{Handler_read_prev} @tab Number of requests to read previous row in key order.  This is mainly used to optimize @code{ORDER BY ... DESC}.
@item @code{Handler_read_rnd} @tab Number of requests to read a row based on a fixed position.
This will be high if you are doing a lot of queries that require sorting of the result.
@item @code{Handler_read_rnd_next} @tab Number of requests to read the next row in the datafile.
This will be high if you are doing a lot of table scans. Generally this suggests that your tables
are not properly indexed or that your queries are not written to take advantage of the indexes you
have.
@item @code{Handler_rollback} @tab  Number of internal @code{ROLLBACK} commands.
@item @code{Handler_update} @tab Number of requests to update a row in a table.
@item @code{Handler_write} @tab Number of requests to insert a row in a table.
@item @code{Key_blocks_used} @tab The number of used blocks in the key cache.
You can use this value to determine how much of the key cache is in use.
See the discussion of @code{key_buffer_size} in
 @ref{SHOW VARIABLES,  , @code{SHOW VARIABLES}}.
@item @code{Key_read_requests} @tab The number of requests to read a key block from the cache.
@item @code{Key_reads} @tab The number of physical reads of a key block from disk.
@item @code{Key_write_requests} @tab The number of requests to write a key block to the cache.
@item @code{Key_writes} @tab The number of physical writes of a key block to disk.
@item @code{Max_used_connections} @tab The maximum number of connections in use simultaneously.
@item @code{Not_flushed_key_blocks} @tab Keys blocks in the key cache that has changed but hasn't yet been flushed to disk.
@item @code{Not_flushed_delayed_rows} @tab Number of rows waiting to be written in @code{INSERT DELAY} queues.
@item @code{Open_tables} @tab Number of tables that are open.
@item @code{Open_files} @tab  Number of files that are open.
@item @code{Open_streams} @tab Number of streams that are open (used mainly for logging).
@item @code{Opened_tables} @tab Number of tables that have been opened.
@item @code{Rpl_status} @tab Status of failsafe replication. (Not yet in use).
@item @code{Select_full_join} @tab Number of joins without keys (If this is not 0, you should carefully check the indexes of your tables).
@item @code{Select_full_range_join} @tab Number of joins where we used a range search on reference table.
@item @code{Select_range} @tab Number of joins where we used ranges on the first table. (It's normally not critical even if this is big.)
@item @code{Select_scan} @tab Number of joins where we did a full scan of the first table.
@item @code{Select_range_check} @tab Number of joins without keys where we check for key usage after each row (If this is not 0, you should carefully check the indexes of your tables).
@item @code{Questions} @tab Number of queries sent to the server.
@item @code{Slave_open_temp_tables} @tab Number of temporary tables currently
open by the slave thread
@item @code{Slave_running} @tab Is @code{ON} if this is a slave that is connected to a master.
@item @code{Slow_launch_threads} @tab Number of threads that have taken more than @code{slow_launch_time} to create.
@item @code{Slow_queries} @tab Number of queries that have taken more than @code{long_query_time} seconds. @xref{Slow query log}.
@item @code{Sort_merge_passes} @tab Number of merges passes the sort algoritm have had to do. If this value is large you should consider increasing @code{sort_buffer}.
@item @code{Sort_range} @tab Number of sorts that were done with ranges.
@item @code{Sort_rows}  @tab Number of sorted rows.
@item @code{Sort_scan}  @tab Number of sorts that were done by scanning the table.
@item @code{ssl_xxx}    @tab Variables used by SSL; Not yet implemented.
@item @code{Table_locks_immediate} @tab Number of times a table lock was
acquired immediately. Available after 3.23.33.
@item @code{Table_locks_waited} @tab Number of times a table lock could not
be acquired immediately and a wait was needed. If this is high, and you
have performance problems, you should first optimize your queries, and then
either split your table or tables or use replication. Available after 3.23.33.
@item @code{Threads_cached} @tab Number of threads in the thread cache.
@item @code{Threads_connected} @tab Number of currently open connections.
@item @code{Threads_created} @tab Number of threads created to handle connections.
@item @code{Threads_running} @tab Number of threads that are not sleeping.
@item @code{Uptime} @tab How many seconds the server has been up.
@end multitable

Some comments about the above:

@itemize @bullet
@item
If @code{Opened_tables} is big, then your @code{table_cache}
variable is probably too small.
@item
If @code{Key_reads} is big, then your @code{key_buffer_size} variable is
probably too small.  The @strong{cache miss rate} can be calculated with
@code{Key_reads}/@code{Key_read_requests}.
@item
If @code{Handler_read_rnd} is big, then you probably have a lot of
queries that require MySQL to scan whole tables or you have
joins that don't use keys properly.
@item
If @code{Threads_created} is big, you may want to increase the
@code{thread_cache_size} variable.  The cache hit rate can be calculated
with @code{Threads_created}/@code{Connections}.
@item
If @code{Created_tmp_disk_tables} is big, you may want to increase the
@code{tmp_table_size} variable to get the temporary tables memory-based
instead of disk based.
@end itemize


@node SHOW VARIABLES, SHOW LOGS, SHOW STATUS, SHOW
@subsubsection @code{SHOW VARIABLES}

@example
SHOW [GLOBAL | SESSION] VARIABLES [LIKE wild]
@end example

@code{SHOW VARIABLES} shows the values of some MySQL system variables.
The options @code{GLOBAL} and @code{SESSION} are new in MySQL 4.0.3.
With @code{GLOBAL}, you will get the variables that will be used for new
connections to MySQL. With @code{SESSION}, you will get the values that
are in effect for the current connection. If you are not using either
option, @code{SESSION} is used.

If the default values are unsuitable, you can set most of these
variables using command-line options when @code{mysqld} starts.
@xref{Server options}. It is also possible to change most variables
with the @code{SET} statement.
@xref{SET OPTION, , @code{SET}}.

The output from @code{SHOW VARIABLES} resembles that shown in the
following list, though the format and numbers may differ somewhat.
You can also get this information using the @code{mysqladmin variables}
command.

@example
+---------------------------------+------------------------------+
| Variable_name                   | Value                        |
+---------------------------------+------------------------------|
| back_log                        | 50                           |
| basedir                         | /usr/local/mysql             |
| bdb_cache_size                  | 8388572                      |
| bdb_log_buffer_size             | 32768                        |
| bdb_home                        | /usr/local/mysql             |
| bdb_max_lock                    | 10000                        |
| bdb_logdir                      |                              |
| bdb_shared_data                 | OFF                          |
| bdb_tmpdir                      | /tmp/                        |
| bdb_version                     | Sleepycat Software: ...      |
| binlog_cache_size               | 32768                        |
| bulk_insert_buffer_size         | 8388608                      |
| character_set                   | latin1                       |
| character_sets                  | latin1 big5 czech euc_kr     |
| concurrent_insert               | ON                           |
| connect_timeout                 | 5                            |
| convert_character_set           |                              |
| datadir                         | /usr/local/mysql/data/       |
| delay_key_write                 | ON                           |
| delayed_insert_limit            | 100                          |
| delayed_insert_timeout          | 300                          |
| delayed_queue_size              | 1000                         |
| flush                           | OFF                          |
| flush_time                      | 0                            |
| ft_boolean_syntax               | + -><()~*:""&|               |
| ft_min_word_len                 | 4                            |
| ft_max_word_len                 | 84                           |
| ft_query_expansion_limit        | 20                           |
| ft_stopword_file                | (built-in)                   |
| have_bdb                        | YES                          |
| have_innodb                     | YES                          |
| have_isam                       | YES                          |
| have_raid                       | NO                           |
| have_symlink                    | DISABLED                     |
| have_openssl                    | YES                          |
| have_query_cache                | YES                          |
| init_file                       |                              |
| innodb_additional_mem_pool_size | 1048576                      |
| innodb_buffer_pool_size         | 8388608                      |
| innodb_data_file_path           | ibdata1:10M:autoextend       |
| innodb_data_home_dir            |                              |
| innodb_file_io_threads          | 4                            |
| innodb_force_recovery           | 0                            |
| innodb_thread_concurrency       | 8                            |
| innodb_flush_log_at_trx_commit  | 1                            |
| innodb_fast_shutdown            | ON                           |
| innodb_flush_method             |                              |
| innodb_lock_wait_timeout        | 50                           |
| innodb_log_arch_dir             |                              |
| innodb_log_archive              | OFF                          |
| innodb_log_buffer_size          | 1048576                      |
| innodb_log_file_size            | 5242880                      |
| innodb_log_files_in_group       | 2                            |
| innodb_log_group_home_dir       | ./                           |
| innodb_mirrored_log_groups      | 1                            |
| interactive_timeout             | 28800                        |
| join_buffer_size                | 131072                       |
| key_buffer_size                 | 16773120                     |
| key_cache_block_size            | 1024                         |
| key_cache_division_limit        | 100                          |
| key_cache_age_threshold         | 300                          |
| language                        | /usr/local/mysql/share/...   |
| large_files_support             | ON                           |
| local_infile                    | ON                           |
| locked_in_memory                | OFF                          |
| log                             | OFF                          |
| log_update                      | OFF                          |
| log_bin                         | OFF                          |
| log_slave_updates               | OFF                          |
| log_slow_queries                | OFF                          |
| log_warnings                    | OFF                          |
| long_query_time                 | 10                           |
| low_priority_updates            | OFF                          |
| lower_case_table_names          | 0                            |
| max_allowed_packet              | 1047552                      |
| max_binlog_cache_size           | 4294967295                   |
| max_binlog_size                 | 1073741824                   |
| max_connections                 | 100                          |
| max_connect_errors              | 10                           |
| max_delayed_threads             | 20                           |
| max_heap_table_size             | 16777216                     |
| max_join_size                   | 4294967295                   |
| max_relay_log_size              | 0                            |
| max_sort_length                 | 1024                         |
| max_user_connections            | 0                            |
| max_tmp_tables                  | 32                           |
| max_write_lock_count            | 4294967295                   |
| myisam_max_extra_sort_file_size | 268435456                    |
| myisam_repair_threads           | 1                            |
| myisam_max_sort_file_size       | 2147483647                   |
| myisam_recover_options          | force                        |
| myisam_sort_buffer_size         | 8388608                      |
| net_buffer_length               | 16384                        |
| net_read_timeout                | 30                           |
| net_retry_count                 | 10                           |
| net_write_timeout               | 60                           |
| open_files_limit                | 1024                         |
| pid_file                        | /usr/local/mysql/name.pid    |
| port                            | 3306                         |
| protocol_version                | 10                           |
| query_cache_limit               | 1048576                      |
| query_cache_size                | 0                            |
| query_cache_type                | ON                           |
| read_buffer_size                | 131072                       |
| read_rnd_buffer_size            | 262144                       |
| rpl_recovery_rank               | 0                            |
| safe_show_database              | OFF                          |
| server_id                       | 0                            |
| slave_net_timeout               | 3600                         |
| skip_external_locking           | ON                           |
| skip_networking                 | OFF                          |
| skip_show_database              | OFF                          |
| slow_launch_time                | 2                            |
| socket                          | /tmp/mysql.sock              |
| sort_buffer_size                | 2097116                      |
| sql_mode                        |                              |
| table_cache                     | 64                           |
| table_type                      | MYISAM                       |
| thread_cache_size               | 3                            |
| thread_stack                    | 131072                       |
| tx_isolation                    | READ-COMMITTED               |
| timezone                        | EEST                         |
| tmp_table_size                  | 33554432                     |
| tmpdir                          | /tmp/:/mnt/hd2/tmp/          |
| version                         | 4.0.4-beta                   |
| wait_timeout                    | 28800                        |
+---------------------------------+------------------------------+
@end example

Each option is described here. Values for buffer sizes, lengths, and stack
sizes are given in bytes.  You can specify values with a suffix of @samp{K}
or @samp{M} to indicate kilobytes or megabytes. For example, @code{16M}
indicates 16 megabytes.  The case of suffix letters does not matter;
@code{16M} and @code{16m} are equivalent:

@c FIX 2002-04-29 arjen / paul
@c FIX Below should be a @multitable just like SHOW STATUS.
@c FIX Has to wait till after O'Reilly printed edition is out the door.

@cindex variables, values
@itemize @bullet
@item @code{ansi_mode}.
Is @code{ON} if @code{mysqld} was started with @code{--ansi}.
@xref{ANSI mode}.

@item @code{back_log}
The number of outstanding connection requests MySQL can have. This
comes into play when the main MySQL thread gets @strong{very}
many connection requests in a very short time. It then takes some time
(although very little) for the main thread to check the connection and start
a new thread. The @code{back_log} value indicates how many requests can be
stacked during this short time before MySQL momentarily stops
answering new requests. You need to increase this only if you expect a large
number of connections in a short period of time.

In other words, this value is the size of the listen queue for incoming
TCP/IP connections.  Your operating system has its own limit on the size
of this queue.  The manual page for the Unix @code{listen(2)} system
call should have more details.  Check your OS documentation for the
maximum value for this variable.  Attempting to set @code{back_log}
higher than your operating system limit will be ineffective.

@item @code{basedir}
The value of the @code{--basedir} option.

@item @code{bdb_cache_size}
The buffer that is allocated to cache index and rows for @code{BDB}
tables.  If you don't use @code{BDB} tables, you should start
@code{mysqld} with @code{--skip-bdb} to not waste memory for this
cache.

@item @code{bdb_log_buffer_size}
The buffer that is allocated to cache index and rows for @code{BDB}
tables.  If you don't use @code{BDB} tables, you should set this to 0 or
start @code{mysqld} with @code{--skip-bdb} to not waste memory for this
cache.

@item @code{bdb_home}
The base directory for @code{BDB} tables.  This should be the same directory
you use for @code{--datadir}.

@item @code{bdb_max_lock}
The maximum number of locks (10,000 by default) you can have active on a
BDB table. You should increase this if you get errors of type @code{bdb:
Lock table is out of available locks} or @code{Got error 12 from ...}
when you have do long transactions or when @code{mysqld} has to examine
a lot of rows to calculate the query.

@item @code{bdb_logdir}
The value of the @code{--bdb-logdir} option.

@item @code{bdb_shared_data}
Is @code{ON} if you are using @code{--bdb-shared-data}.

@item @code{bdb_tmpdir}
The value of the @code{--bdb-tmpdir} option.

@item @code{binlog_cache_size}.  The size of the cache to hold the SQL
statements for the binary log during a transaction.  If you often use
big, multiple-statement transactions you can increase this to get more
performance. @xref{COMMIT}.

@item @code{bulk_insert_buffer_size}
MyISAM uses special tree-like cache to make bulk inserts (that is,
@code{INSERT ... SELECT}, @code{INSERT ... VALUES (...), (...), ...}, and
@code{LOAD DATA INFILE}) faster. This variable limits
the size of the cache tree in bytes per thread. Setting it to 0
will disable this optimization.
@strong{Note:} This cache is used only when adding data to a non-empty table.
Default value is 8 MB.
This option used to be named @code{myisam_bulk_insert_tree_size}.

@item @code{character_set}
The default character set.

@item @code{character_sets}
The supported character sets.

@item @code{concurrent_inserts}
If @code{ON} (the default), MySQL will allow you to use @code{INSERT} on
@code{MyISAM} tables at the same time as you run @code{SELECT} queries
on them.  You can turn this option off by starting @code{mysqld} with
@code{--safe} or @code{--skip-new}.

@cindex timeout
@item @code{connect_timeout}
The number of seconds the @code{mysqld} server is waiting for a connect
packet before responding with @code{Bad handshake}.

@item @code{datadir}
The value of the @code{--datadir} option.

@item @code{delay_key_write}
Option for MyISAM tables. Can have one of the following values:

@multitable @columnfractions .30 .70
@item OFF @tab All @code{CREATE TABLE ... DELAYED_KEY_WRITE} are ignored.
@item ON  @tab (default)  MySQL will honor the @code{DELAY_KEY_WRITE} option
for @code{CREATE TABLE}.
@item ALL @tab All new opened tables are treated as if they were created with the @code{DELAY_KEY_WRITE} option.
@end multitable

If @code{DELAY_KEY_WRITE} is enabled this means that the key buffer for
tables with this option will not get flushed on every index update, but
only when a table is closed.  This will speed up writes on keys a lot,
but you should add automatic checking of all tables with @code{myisamchk
--fast --force} if you use this.

@item @code{delayed_insert_limit}
After inserting @code{delayed_insert_limit} rows, the @code{INSERT
DELAYED} handler will check if there are any @code{SELECT} statements
pending. If so, it allows these to execute before continuing.

@item @code{delayed_insert_timeout}
How long a @code{INSERT DELAYED} thread should wait for @code{INSERT}
statements before terminating.

@item @code{delayed_queue_size}
What size queue (in rows) should be allocated for handling @code{INSERT
DELAYED}.  If the queue becomes full, any client that does @code{INSERT
DELAYED} will wait until there is room in the queue again.

@item @code{flush}
This is @code{ON} if you have started MySQL with the @code{--flush}
option.

@item @code{flush_time}
If this is set to a non-zero value, then every @code{flush_time} seconds all
tables will be closed (to free up resources and sync unflushed data to disk). We
only recommend this option on Windows 9x/Me, or on systems where you have
very little resources.

@item @code{ft_boolean_syntax}
List of operators supported by @code{MATCH ... AGAINST(... IN BOOLEAN MODE)}.
@xref{Fulltext Search}.

@item @code{ft_min_word_len}
The minimum length of the word to be included in a @code{FULLTEXT} index.
@strong{Note: @code{FULLTEXT} indexes must be rebuilt after changing
this variable.} This variable is available as of MySQL 4.0.

@item @code{ft_max_word_len}
The maximum length of the word to be included in a @code{FULLTEXT} index.
@strong{Note: @code{FULLTEXT} indexes must be rebuilt after changing
this variable.} This variable is available as of MySQL 4.0.

@item @code{ft_query_expansion_limit}
Number of top matches to use for query expansion (in
@code{MATCH ... AGAINST (... WITH QUERY EXPANSION)}.
This variable is available as of MySQL 4.1.1.

@item @code{ft_stopword_file}
The file from which to read the list of stopwords for full-text searches.
All the words from the file will be used; comments are @strong{not} honored.
By default, built-in list of stopwords is used
(as defined in @file{myisam/ft_static.c}).
Setting this parameter to an empty string (@code{""}) will disable
stopword filtering.
@strong{Note: @code{FULLTEXT} indexes must be rebuilt after changing
this variable.} This variable is available as of MySQL 4.0.10.

@item @code{have_innodb}
@code{YES} if @code{mysqld} supports InnoDB tables. @code{DISABLED}
if @code{--skip-innodb} is used.
@item @code{have_bdb}
@code{YES} if @code{mysqld} supports Berkeley DB tables. @code{DISABLED}
if @code{--skip-bdb} is used.
@item @code{have_raid}
@code{YES} if @code{mysqld} supports the @code{RAID} option.
@item @code{have_openssl}
@code{YES} if @code{mysqld} supports SSL (encryption) on the client/server
protocol.

@c TODO: it may be that init_connect/init_slave should be discussed in
@c a separate section that describes how to control client/slave startup.
@c Move the examples to such a section if it is written.

@item @code{init_connect}
A string to be executed by the server for each client that connects.
The string consists of one or more SQL statements. To specify multiple
statements, separate them by semicolon characters.
This variable was added in MySQL 4.1.2.

For example, each client begins by default with auto-commit mode enabled.
There is no global server variable to specify that auto-commit should be
disabled by default, but @code{init_connect} can be used to achieve the
same effect:

@example
SET GLOBAL init_connect='SET AUTOCOMMIT=0';
@end example

This variable may also be set on the command line or in an option file.
To set the variable as just shown using an option file, include these
lines:

@example
[mysqld]
init_connect='SET AUTOCOMMIT=0'
@end example

@item @code{init_file}
The name of the file specified with the @code{--init-file} option when
you start the server.  This is a file of SQL statements you want the
server to execute when it starts.

@item @code{init_slave}
This variable is similar to @code{init_connect}, but is a string to be
executed by a slave server each time the SQL thread starts.  The format of
the string is the same as for the @code{init_connect} variable.
This variable was added in MySQL 4.1.2.

@item @code{interactive_timeout}
The number of seconds the server waits for activity on an interactive
connection before closing it.  An interactive client is defined as a
client that uses the @code{CLIENT_INTERACTIVE} option to
@code{mysql_real_connect()}.  See also @code{wait_timeout}.

@item @code{join_buffer_size}
The size of the buffer that is used for full joins (joins that do not
use indexes).  The buffer is allocated one time for each full join
between two tables. Increase this value to get a faster full join when
adding indexes is not possible. (Normally the best way to get fast joins
is to add indexes.)

@c Make texi2html support index @anchor{Index cache size}. Then change
@c some xrefs to point here
@cindex indexes, block size
@item @code{key_buffer_size}
Index blocks are buffered and are shared by all threads.
@code{key_buffer_size} is the size of the buffer used for index blocks.

Increase this to get better index handling (for all reads and multiple
writes) to as much as you can afford; 64M on a 256M machine that mainly
runs MySQL is quite common.  However, if you make this too large
(for instance more than 50% of your total memory) your system might start
to page and become extremely slow. Remember that because MySQL does not
cache data reads, you will have to leave some room for the OS
filesystem cache.

You can check the performance of the key buffer by issuing a @code{SHOW
STATUS} statement and examining the variables @code{Key_read_requests},
@code{Key_reads}, @code{Key_write_requests}, and @code{Key_writes}.  The
@code{Key_reads/Key_read_request} ratio should normally be < 0.01.
The @code{Key_write/Key_write_requests} is usually near 1 if you are
using mostly updates/deletes but might be much smaller if you tend to
do updates that affect many at the same time or if you are
using @code{DELAY_KEY_WRITE}. @xref{SHOW, , @code{SHOW}}.

To get even more speed when writing many rows at the same time, use
@code{LOCK TABLES}.  @xref{LOCK TABLES, , @code{LOCK TABLES}}.

The fraction of the key buffer in use can be determined using
@code{key_buffer_size} in conjunction with the @code{Key_blocks_used}
status variable and the blocksize.  Before MySQL 4.1.1, key cache blocks
are 1024 bytes, so the fraction of the key buffer in use is:

@example
(Key_blocks_used * 1024) / key_buffer_size
@end example

From 4.1.1 on, the buffer block size is available from the
@code{key_cache_block_size} server variable. The fraction of the buffer
in use is:

@example
(Key_blocks_used * key_cache_block_size) / key_buffer_size
@end example

@xref{MyISAM key cache}.

@item @code{key_cache_age_threshold}
This value controls the demotion of buffers from the hot sub-chain of a key
cache to the warm sub-chain.
Lower values cause demotion to happen more quickly.
The minimum value is 100.
The default value is 300.
This variable was added in MySQL 4.1.1.
@xref{MyISAM key cache}.

@item @code{key_cache_block_size}
The size in bytes of blocks in the key buffer.
The default value is 1024.
This variable was added in MySQL 4.1.1.
@xref{MyISAM key cache}.

@item @code{key_cache_division_limit}
The division point between the hot and warm sub-chains of the key cache
buffer chain. The value is the percentage of the buffer chain to use for
the warm sub-chain.  Allowable values range from 1 to 100.
The default value is 100.
This variable was added in MySQL 4.1.1.
@xref{MyISAM key cache}.

@item @code{language}
The language used for error messages.

@item @code{large_file_support}
If @code{mysqld} was compiled with options for big file support.

@item @code{locked_in_memory}
If @code{mysqld} was locked in memory with @code{--memlock}

@item @code{log}
If logging of all queries is enabled.

@item @code{log_update}
If the update log is enabled.

@item @code{log_bin}
If the binary log is enabled.

@item @code{log_slave_updates}
If the updates from the slave should be logged.

@item @code{long_query_time}
If a query takes longer than this (in seconds), the @code{Slow_queries} counter
will be incremented. If you are using @code{--log-slow-queries}, the query
will be logged to the slow query log file. This value is measured in real
time, not CPU time, so a query that may be under the threshold on a lightly
loaded system may be above the threshold on a heavily loaded one.
@xref{Slow query log}.

@item @code{lower_case_table_names}
If set to 1 table names are stored in lowercase on disk and table
name comparisons will not be case sensitive.
If set to 2 (new in 4.0.18) then table names will be stored as given but
compared in lower case.
From version 4.0.2, this option also applies to database names.
From 4.1.1 this option also applies to table aliases.
Note that you should NOT set this to 0 if you are running MYSQL on a system
that does not have case sensitive filenames (such as Windows or Mac OS X).
New in 4.0.18:  If this value is 0 and the @code{datadir} is not case
sensitive, MySQL automaticallys set @code{lower_case_table_names} to 1.
@xref{Name case sensitivity}.

@item @code{max_allowed_packet}
The maximum size of one packet. The message buffer is initialized to
@code{net_buffer_length} bytes, but can grow up to @code{max_allowed_packet}
bytes when needed.  This value by default is small, to catch big (possibly
wrong) packets.  You must increase this value if you are using big
@code{BLOB} columns. It should be as big as the biggest @code{BLOB} you want
to use.  The protocol limits for @code{max_allowed_packet} is 16M in MySQL
3.23 and 1G in MySQL 4.0.

@item @code{max_binlog_cache_size}
If a multiple-statement transaction requires more than this amount of memory,
one will get the error "Multi-statement transaction required more than
'max_binlog_cache_size' bytes of storage".

@item @code{max_binlog_size}
Available after 3.23.33. If a write to the binary (replication) log exceeds
the given value, rotate the logs. You cannot set it to less than 4096
bytes (1024 in MySQL versions older than 4.0.14),
or more than 1 GB. Default is 1 GB. Note if you are using
transactions: a transaction is written in one chunk to the binary log,
hence it is never split between several binary logs. Therefore, if you
have big transactions, you may see binlogs bigger than
@code{max_binlog_size}. If @code{max_relay_log_size} (available
starting from MySQL 4.0.14) is 0, then @code{max_binlog_size} will
apply to relay logs as well.

@item @code{max_connections}
The number of simultaneous clients allowed. Increasing this value increases
the number of file descriptors that @code{mysqld} requires.  See below for
comments on file descriptor limits. @xref{Too many connections}.

@item @code{max_connect_errors}
If there is more than this number of interrupted connections from a host
this host will be blocked from further connections.  You can unblock a host
with the command @code{FLUSH HOSTS}.

@item @code{max_delayed_threads}
Don't start more than this number of threads to handle @code{INSERT DELAYED}
statements.  If you try to insert data into a new table after all @code{INSERT
DELAYED} threads are in use, the row will be inserted as if the
@code{DELAYED} attribute wasn't specified. If you set this to 0, MySQL
will never create a max_delayed thread.

@item @code{max_heap_table_size}
This variable sets the maximum size to which subsequently created @code{HEAP}
tables are allowed to grow.  The value of the variable is used to calculate
a @code{HEAP} table's @code{MAX_ROWS} value.  Setting this variable has no
effect on any existing @code{HEAP} table, unless the table is re-created with
a statement such as @code{CREATE TABLE} or @code{TRUNCATE TABLE}, or altered
with @code{ALTER TABLE}.

@item @code{max_join_size}
Joins that are probably going to read more than @code{max_join_size}
records return an error. Set this value if your users tend to perform joins
that lack a @code{WHERE} clause, that take a long time, and that return
millions of rows.

@item @code{max_relay_log_size}
Available starting from 4.0.14. If a write to the relay log (a kind of
log used by replication slaves, @pxref{Replication Implementation
Details}) exceeds the given value, rotate the relay log.
This variable enables you to put different size constraints on relay
logs and binary logs.
However, setting the variable to 0 will make MySQL use 
@code{max_binlog_size} for both binary logs and relay logs.
You have to set @code{max_relay_log_size} to 0 or more than 4096,
and less than 1 GB. Default is 0.

@item @code{max_seeks_for_key}
Limit assumed max number of seeks when looking up rows based on a key.
The MySQL optimizer will assume that when searching after matching rows
in a table through scanning a key, we will not cause more than this
number of key seeks independent of the cardinality of the key.  By setting
this to a low value (100 ?) you can force MySQL to prefer keys instead
of table scans.

@item @code{max_sort_length}
The number of bytes to use when sorting @code{BLOB} or @code{TEXT}
values. Only the first @code{max_sort_length} bytes of each value
are used; the rest are ignored.

@item @code{max_user_connections}
The maximum number of active connections for a single user (0 = no limit).

@item @code{max_tmp_tables}
(This option doesn't yet do anything.)
Maximum number of temporary tables a client can keep open at the same time.

@item @code{max_write_lock_count}
After this many write locks, allow some read locks to run in between.

@item @code{myisam_recover_options}
The value of the @code{--myisam-recover} option.

@item @code{myisam_sort_buffer_size}
The buffer that is allocated when sorting the index when doing a
@code{REPAIR} or when creating indexes with @code{CREATE INDEX} or
@code{ALTER TABLE}.

@item @code{myisam_max_extra_sort_file_size}.
If the temporary file used for fast index creation would be bigger than
using the key cache by the amount specified here, then prefer the key
cache method.  This is mainly used to force long character keys in large
tables to use the slower key cache method to create the index.
@strong{Note} that this parameter is given in megabytes before 4.0.3 and
in bytes beginning with this version.

@item @code{myisam_repair_threads}.
If this value is greater than one, MyISAM table indexes during
@code{Repair by sorting} process will be created in parallel -
each index in its own thread. @strong{Note:} Multi-threaded repair
is still @strong{alpha} quality code.

@item @code{myisam_max_sort_file_size}
The maximum size of the temporary file MySQL is allowed to use
while recreating the index (during @code{REPAIR}, @code{ALTER TABLE}
or @code{LOAD DATA INFILE}.  If the file-size would be bigger than this,
the index will be created through the key cache (which is slower).
@strong{Note} that this parameter is given in megabytes before 4.0.3 and
in bytes beginning with this version.

@item @code{net_buffer_length}
The communication buffer is reset to this size between queries. This
should not normally be changed, but if you have very little memory, you
can set it to the expected size of a query.  (That is, the expected length of
SQL statements sent by clients.  If statements exceed this length, the buffer
is automatically enlarged, up to @code{max_allowed_packet} bytes.)

@item @code{net_read_timeout}
Number of seconds to wait for more data from a connection before aborting
the read.  Note that when we don't expect data from a connection, the timeout
is defined by @code{write_timeout}. See also @code{slave_net_timeout}.

@item @code{net_retry_count}
If a read on a communication port is interrupted, retry this many times
before giving up.  This value should be quite high on @code{FreeBSD} as
internal interrupts are sent to all threads.

@item @code{net_write_timeout}
Number of seconds to wait for a block to be written to a connection before
aborting the write.

@item @code{open_files_limit}
Number of files the system allows mysqld to open.  This is the real
value given for the system and may be different from the value you
gave mysqld as a startup parameter.  This is 0 on systems where MySQL
can't change the number of open files.

@item @code{pid_file}
The value of the @code{--pid-file} option.

@item @code{port}
The value of the @code{--port} option.

@item @code{protocol_version}
The protocol version used by the MySQL server.

@item @code{query_alloc_block_size}
Size of memory allocation blocks that are allocated for objects
created during query parsing and execution. If you have problem with
memory fragmentation, it may help to increase this a bit.
This variable was added in MySQL 4.0.16.

@item @code{query_cache_limit}
Don't cache results that are bigger than this. (Default 1M).

@item @code{query_cache_size}
The memory allocated to store results from old queries.
If this is 0, the query cache is disabled (default).

@item @code{query_cache_type}
This may be set (only numeric) to
@multitable @columnfractions .09 .14 .72
@item @strong{Value} @tab @strong{Alias} @tab @strong{Comment}
@item 0 @tab OFF @tab Don't cache or retrieve results.
@item 1 @tab ON @tab Cache all results except @code{SELECT SQL_NO_CACHE ...} queries.
@item 2 @tab DEMAND @tab Cache only @code{SELECT SQL_CACHE ...} queries.
@end multitable

@item @code{query_prealloc_size}
Size of the persistent buffer used for query parsing and execution.
This buffer is not freed between queries.
If you are running complex queries, a larger @code{query_prealloc_size} value
may be helpful in improving performance, because it can reduce the need for
the server to perform memory allocation during query execution operations.
@c It won't necessarily eliminate allocation completely; server *may* still
@c allocate memory in some situations, e.g., transaction-related or sp-related
@c ops.
This variable was added in MySQL 4.0.16.

@item @code{range_alloc_block_size}
The size of blocks that are allocated when doing range optimization.
This variable was added in MySQL 4.0.16.

@item @code{read_buffer_size}
Each thread that does a sequential scan allocates a buffer of this
size for each table it scans. If you do many sequential scans, you might
want to increase this value.
This option used to be named @code{record_buffer}.

@item @code{read_rnd_buffer_size}
When reading rows in sorted order after a sort, the rows are read
through this buffer to avoid disk seeks.  Can improve @code{ORDER BY}
by a lot if set to a high value.  As this is a thread-specific variable,
one should not set this big globally, but just change this when running
some specific big queries.
This option used to be named @code{record_rnd_buffer}.

@item @code{safe_show_database}
Don't show databases for which the user doesn't have any database or
table privileges. This can improve security if you're concerned about
people being able to see what databases other users have. See also
@code{skip_show_database}.

If the MySQL server has been started with the @code{--secure-auth} option,
it will block all all connections from users with passwords stored in old 
(pre-4.1) format. In that case, the value of the variable is @code{ON}, 
otherwise it is @code{OFF}. Note, that the server start will fail with an error 
if this option has been enabled and the privilege tables are in pre-4.1 format.
When used as a client-side option, the client will refuse connecting to
a server if the server requires passwords in old format for this user/host
combination. You should enable this option if you want to prevent all usage 
of passwords in old format (and hence insecure communication over the network).
Available as of MySQL 4.1.1.

@item @code{server_id}
The value of the @code{--server-id} option.

@item @code{skip_locking}
Is OFF if @code{mysqld} uses external locking.

@item @code{skip_networking}
Is ON if we only allow local (socket) connections.

@item @code{skip_show_database}
This prevents people from doing @code{SHOW DATABASES} if they don't have
the @code{PROCESS} privilege. This can improve security if you're
concerned about people being able to see what databases other users
have. See also @code{safe_show_database}.

@item @code{slave_net_timeout}
Number of seconds to wait for more data from a master/slave connection
before aborting the read.

@item @code{slow_launch_time}
If creating the thread takes longer than this value (in seconds), the
@code{Slow_launch_threads} counter will be incremented.

@item @code{socket}
The Unix socket used by the server.

@item @code{sort_buffer_size}
Each thread that needs to do a sort allocates a buffer of this
size. Increase this value for faster @code{ORDER BY} or @code{GROUP BY}
operations.
@xref{Temporary files}.

@item @code{sql_mode}
The current SQL mode.
@xref{SQL mode}.

@item @code{table_cache}
The number of open tables for all threads. Increasing this value
increases the number of file descriptors that @code{mysqld} requires.
You can check if you need to increase the table cache by checking the
@code{Opened_tables} variable.
@xref{SHOW STATUS, , @code{Opened_tables}}.
If this variable
is big and you don't do @code{FLUSH TABLES} a lot (which just forces all
tables to be closed and reopenend), then you should increase the value of this
variable.

For more information about the table cache, see @ref{Table cache}.

@item @code{table_type}
The default table type.

@item @code{thread_cache_size}
How many threads we should keep in a cache for reuse.  When a
client disconnects, the client's threads are put in the cache if there
aren't more than @code{thread_cache_size} threads from before.  All new
threads are first taken from the cache, and only when the cache is empty
is a new thread created.  This variable can be increased to improve
performance if you have a lot of new connections. (Normally this doesn't
give a notable performance improvement if you have a good
thread implementation.)  By examing the difference between
the @code{Connections} and @code{Threads_created} status variables 
(@pxref{SHOW STATUS, , @code{SHOW STATUS}} for details) you can see how efficient  
thread cache is.

@item @code{thread_concurrency}
On Solaris, @code{mysqld} will call @code{thr_setconcurrency()} with
this value.  @code{thr_setconcurrency()} permits the application to give
the threads system a hint for the desired number of threads that should
be run at the same time.

@item @code{thread_stack}
The stack size for each thread.  Many of the limits detected by the
@code{crash-me} test are dependent on this value. The default is
large enough for normal operation.  @xref{MySQL Benchmarks}.

@item @code{timezone}
The time zone for the server.  This is set from the @code{TZ} environment
variable when @code{mysqld} is started.  This can also be given as a
@code{--timezone} argument to @code{mysqld_safe}. @xref{Timezone problems}.

@item @code{tmp_table_size}
If an in-memory temporary table exceeds this size, MySQL
automaticallys convert it to an on-disk @code{MyISAM} table.
Increase the value of @code{tmp_table_size} if you do many advanced
@code{GROUP BY} queries and you have lots of memory.

@item @code{tmpdir}
The directory used for temporary files and temporary tables.
Starting from MySQL 4.1, it can be set to a list of paths
separated by colon @code{:} (semicolon @code{;} on Windows). They
will be used in round-robin fashion. This feature can be used to
spread load between several physical disks.
It is possible to set @code{tmpdir} to point to a memory-based filesystem,
except if the MySQL server is a slave. If it is a slave, it needs some
of its temporary files (for replication of temporary tables or of
@code{LOAD DATA INFILE}) to survive a machine's reboot, so a
memory-based @code{tmpdir} which is cleared when the machine reboots is not
suitable; a disk-based @code{tmpdir} is necessary.

@item @code{transaction_alloc_block_size}
Size of memory allocation blocks that are allocated for storing queries
that are part of a transaction that are to be stored in the binary log
when doing a commit.
This variable was added in MySQL 4.0.16.

@item @code{transaction_prealloc_size}
Persistent buffer for @code{transaction_alloc_blocks} that is not
freed between queries. By making this big enough to fit all queries in
a common transaction you can avoid a lot of @code{malloc()} calls.
This variable was added in MySQL 4.0.16.

@item @code{version}
The version number for the server.

@item @code{wait_timeout}
The number of seconds the server waits for activity on a not interactive
connection before closing it.

On thread startup @code{SESSION.WAIT_TIMEOUT} is initialized from
@code{GLOBAL.WAIT_TIMEOUT} or @code{GLOBAL.INTERACTIVE_TIMEOUT} depending
on the type of client (as defined by the @code{CLIENT_INTERACTIVE} connect
option). See also @code{interactive_timeout}.
@end itemize

The manual section that describes tuning MySQL contains some
information of how to tune the above variables. @xref{Server parameters}.


@node SHOW LOGS, SHOW PROCESSLIST, SHOW VARIABLES, SHOW
@subsubsection @code{SHOW [BDB] LOGS}

@code{SHOW LOGS} shows you status information about existing log
files.  It currently only displays information about Berkeley DB log
files, so an alias for it (available as of MySQL 4.1.1) is @code{SHOW BDB LOGS}.

@itemize @bullet
@item @code{File} shows the full path to the log file
@item @code{Type} shows the type of the log file (@code{BDB} for Berkeley
DB log files)
@item @code{Status} shows the status of the log file (@code{FREE} if the
file can be removed, or @code{IN USE} if the file is needed by the transaction
subsystem)
@end itemize


@node SHOW PROCESSLIST, SHOW GRANTS, SHOW LOGS, SHOW
@subsubsection @code{SHOW PROCESSLIST}

@findex threads
@findex PROCESSLIST
@findex SHOW PROCESSLIST

@cindex threads, display
@cindex processes, display

@code{SHOW [FULL] PROCESSLIST} shows you which threads are running.
You can also get this information using the @code{mysqladmin processlist}
command.  If you have the @code{SUPER} privilege, you can see all
threads.  Otherwise, you can see only your own threads.
@xref{KILL, ,@code{KILL}}.
If you don't use the @code{FULL} option, only the first 100
characters of each query are shown.

Starting from 4.0.12, MySQL reports the hostname for TCP/IP connections
in @code{hostname:client_port} format to make it easier to find out which client
is doing what.

This command is very useful if you get the 'too many connections' error
message and want to find out what's going on. MySQL reserves
one extra connection for a client with the @code{SUPER} privilege
to ensure that you should always be able to log in and check the system
(assuming you are not giving this privilege to all your users).

Some states commonly seen in @code{mysqladmin processlist}

@itemize @bullet
@item @code{Checking table}
The thread is performing [automatic] checking of the table.
@item @code{Closing tables}
Means that the thread is flushing the changed table data to disk and
closing the used tables. This should be a fast operation.  If not, then
you should check that you don't have a full disk or that the disk is not
in very heavy use.
@item @code{Connect Out}
Slave connecting to master.
@item @code{Copying to tmp table on disk}
The temporary result set was larger than @code{tmp_table_size} and the
thread is now changing the in memory-based temporary table to a disk
based one to save memory.
@item @code{Creating tmp table}
The thread is creating a temporary table to hold a part of the result for
the query.
@item @code{deleting from main table}
When executing the first part of a multiple-table delete and we are only
deleting from the first table.
@item @code{deleting from reference tables}
When executing the second part of a multiple-table delete and we are deleting
the matched rows from the other tables.
@item @code{Flushing tables}
The thread is executing @code{FLUSH TABLES} and is waiting for all
threads to close their tables.
@item @code{Killed}
Someone has sent a kill to the thread and it should abort next time it
checks the kill flag.  The flag is checked in each major loop in MySQL,
but in some cases it may still take a short time for the thread to die.
If the thread is locked by some other thread, the kill will take effect
as soon as the other thread releases its lock.
@item @code{Sending data}
The thread is processing rows for a @code{SELECT} statement and is
also sending data to the client.
@item @code{Sorting for group}
The thread is doing a sort to satisfy a @code{GROUP BY}.
@item @code{Sorting for order}
The thread is doing a sort to satisfy a @code{ORDER BY}.
@item @code{Opening tables}
This simply means that the thread is trying to open a table. This is
should be very fast procedure, unless something prevents opening. For
example an @code{ALTER TABLE} or a @code{LOCK TABLE} can prevent opening
a table until the command is finished.
@item @code{Removing duplicates}
The query was using @code{SELECT DISTINCT} in such a way that MySQL
couldn't optimize that distinct away at an early stage. Because of this
MySQL has to do an extra stage to remove all duplicated rows before
sending the result to the client.
@item @code{Reopen table}
The thread got a lock for the table, but noticed after getting the lock
that the underlying table structure changed. It has freed the lock,
closed the table and is now trying to reopen it.
@item @code{Repair by sorting}
The repair code is using sorting to create indexes.
@item @code{Repair with keycache}
The repair code is using creating keys one by one through the key cache.
This is much slower than @code{Repair by sorting}.
@item @code{Searching rows for update}
The thread is doing a first phase to find all matching rows before
updating them.  This has to be done if the @code{UPDATE} is changing
the index that is used to find the involved rows.
@item @code{Sleeping}
The thread is wating for the client to send a new command to it.
@item @code{System lock}
The thread is waiting for getting to get a external system lock for the
table. If you are not using multiple mysqld servers that are accessing
the same tables, you can disable system locks with the
@code{--skip-external-locking} option.
@item @code{Upgrading lock}
The @code{INSERT DELAYED} handler is trying to get a lock for the table
to insert rows.
@item @code{Updating}
The thread is searching for rows to update and updating them.
@item @code{User Lock}
The thread is waiting on a @code{GET_LOCK()}.
@item @code{Waiting for tables}
The thread got a notification that the underlying structure for a table
has changed and it needs to reopen the table to get the new structure.
To be able to reopen the table it must however wait until all other
threads have closed the table in question.

This notification happens if another thread has used @code{FLUSH TABLES}
or one of the following commands on the table in question: @code{FLUSH
TABLES table_name}, @code{ALTER TABLE}, @code{RENAME TABLE},
@code{REPAIR TABLE}, @code{ANALYZE TABLE} or @code{OPTIMIZE TABLE}.
@item @code{waiting for handler insert}
The @code{INSERT DELAYED} handler has processed all inserts and are
waiting to get new ones.
@end itemize

Most states are very quick operations. If threads last in any of these
states for many seconds, there may be a problem around that needs to be
investigated.

There are some other states that are not mentioned previously, but most of
these are useful only to find bugs in @code{mysqld}.

@node SHOW GRANTS, SHOW CREATE TABLE, SHOW PROCESSLIST, SHOW
@subsubsection @code{SHOW GRANTS}

@cindex privileges, display
@findex GRANTS
@findex SHOW GRANTS

@code{SHOW GRANTS FOR user} lists the grant commands that must be issued to
duplicate the grants for a user.

@example
mysql> SHOW GRANTS FOR root@@localhost;
+---------------------------------------------------------------------+
| Grants for root@@localhost                                           |
+---------------------------------------------------------------------+
| GRANT ALL PRIVILEGES ON *.* TO 'root'@@'localhost' WITH GRANT OPTION |
+---------------------------------------------------------------------+
@end example

To list grants for the current session, you can find out what user the
session was authenticated as by selecting the value
of the @code{CURRENT_USER()} function (new in version 4.0.6).
Then use that value in the @code{SHOW GRANTS} statement.
@xref{Miscellaneous functions, ,@code{CURRENT_USER()}}.

@node SHOW CREATE TABLE, SHOW WARNINGS, SHOW GRANTS, SHOW
@subsubsection @code{SHOW CREATE TABLE}

@findex SHOW CREATE TABLE

Shows a @code{CREATE TABLE} statement that will create the given table:

@example
mysql> SHOW CREATE TABLE t\G
*************************** 1. row ***************************
       Table: t
Create Table: CREATE TABLE t (
  id INT(11) default NULL auto_increment,
  s char(60) default NULL,
  PRIMARY KEY (id)
) TYPE=MyISAM

@end example

@code{SHOW CREATE TABLE} quotes table and column names according to
the value of the @code{SQL_QUOTE_SHOW_CREATE} option.
@ref{SET OPTION, , @code{SET SQL_QUOTE_SHOW_CREATE}}.


@node SHOW WARNINGS, SHOW TABLE TYPES, SHOW CREATE TABLE, SHOW
@subsubsection @code{SHOW WARNINGS | ERRORS}

@findex SHOW WARNINGS

@example
SHOW WARNINGS [LIMIT row_count]
SHOW ERRORS [LIMIT row_count]
@end example

This command is implemented in MySQL 4.1.0.

It shows the errors, warnings and notes that one got for the last command.
The errors/warnings are reset for each new command that uses a table.

The MySQL server sends back the total number of warnings and errors you
got for the last commend; This can be retrieved by calling
@code{mysql_warning_count()}.

Up to @code{max_error_count} messages are stored (Global and thread
specific variable).

You can retrieve the number of errors from @code{@@error_count} and
warnings from @code{@@warning_count}.

@code{SHOW WARNINGS} shows all errors, warnings and notes you got for
the last command while @code{SHOW ERRORS} only shows you the errors.

@example
mysql> DROP TABLE IF EXISTS no_such_table;
mysql> SHOW WARNINGS;

+-------+------+-------------------------------+
| Level | Code | Message                       |
+-------+------+-------------------------------+
| Note  | 1051 | Unknown table 'no_such_table' |
+-------+------+-------------------------------+
@end example

Note that in MySQL 4.1.0 we have just added the frame work for warnings
and not many MySQL command do yet generate warnings.  4.1.1 supports all
kind of warnings for @code{LOAD DATA INFILE} and DML statements such as
@code{INSERT}, @code{UPDATE} and @code{ALTER} commands.

For example, here is a simple case which produces conversion warnings
for a insert statement.

@example
mysql> create table t1(a tinyint NOT NULL, b char(4));
Query OK, 0 rows affected (0.00 sec)

mysql> insert into t1 values(10,'mysql'),(NULL,'test'),(300,'open source');
Query OK, 3 rows affected, 4 warnings (0.15 sec)
Records: 3  Duplicates: 0  Warnings: 4

mysql> show warnings;
+---------+------+---------------------------------------------------------------+
| Level   | Code | Message                                                       |
+---------+------+---------------------------------------------------------------+
| Warning | 1263 | Data truncated for column 'b' at row 1                        |
| Warning | 1261 | Data truncated, NULL supplied to NOT NULL column 'a' at row 2 |
| Warning | 1262 | Data truncated, out of range for column 'a' at row 3          |
| Warning | 1263 | Data truncated for column 'b' at row 3                        |
+---------+------+---------------------------------------------------------------+
4 rows in set (0.00 sec)
@end example


Maximum number of warnings can be specified using the server variable
@code{'max_error_count'}, @code{SET max_error_count=[count]}; By default
it is 64. In case to disable warnings, simply reset this variable to
'0'. In case if @code{max_error_count} is 0, then still the warning
count represents how many warnings have occurred, but none of the messages
are stored.

For example, consider the following @code{ALTER} table statement for the
above example, which returns only one warning message even though total
warnings occurred is 3 when you set max_error_count=1.

@example
mysql> show variables like 'max_error_count';
+-----------------+-------+
| Variable_name   | Value |
+-----------------+-------+
| max_error_count | 64    |
+-----------------+-------+
1 row in set (0.00 sec)

mysql> set max_error_count=1;
Query OK, 0 rows affected (0.00 sec)

mysql> alter table t1 modify b char;
Query OK, 3 rows affected, 3 warnings (0.00 sec)
Records: 3  Duplicates: 0  Warnings: 3

mysql> show warnings;
+---------+------+----------------------------------------+
| Level   | Code | Message                                |
+---------+------+----------------------------------------+
| Warning | 1263 | Data truncated for column 'b' at row 1 |
+---------+------+----------------------------------------+
1 row in set (0.00 sec)

mysql>
@end example



@node SHOW TABLE TYPES, SHOW PRIVILEGES, SHOW WARNINGS, SHOW
@subsubsection @code{SHOW TABLE TYPES}

@findex SHOW TABLE TYPES

@example
SHOW TABLE TYPES
@end example

This command is implemented in MySQL 4.1.0.

@code{SHOW TABLE TYPES} shows you status information about the table
types. This is particulary useful for checking if a table type is supported;
or to see what is the default table type is.

@example
mysql> SHOW TABLE TYPES;

+--------+---------+-----------------------------------------------------------+
| Type   | Support | Comment                                                   |
+--------+---------+-----------------------------------------------------------+
| MyISAM | DEFAULT | Default type from 3.23 with great performance             |
| HEAP   | YES     | Hash based, stored in memory, useful for temporary tables |
| MERGE  | YES     | Collection of identical MyISAM tables                     |
| ISAM   | YES     | Obsolete table type; Is replaced by MyISAM                |
| InnoDB | YES     | Supports transactions, row-level locking and foreign keys |
| BDB    | NO      | Supports transactions and page-level locking              |
+--------+---------+-----------------------------------------------------------+
6 rows in set (0.00 sec)
@end example

The 'Support' option @code{DEFAULT} indicates whether the particular table
type is supported, and which is the default type. If the server is started with
@code{--default-table-type=InnoDB}, then the InnoDB 'Support' field will
have the value @code{DEFAULT}.


@node SHOW PRIVILEGES,  , SHOW TABLE TYPES, SHOW
@subsubsection @code{SHOW PRIVILEGES}

@findex SHOW PRIVILEGES

@example
SHOW PRIVILEGES
@end example

This command is implemented in MySQL 4.1.0.

@code{SHOW PRIVILEGES} shows the list of system privileges that the underlying 
MySQL server supports.

@example
mysql> show privileges;
+------------+-------------------------
-+-------------------------------------------------------+
| Privilege  | Context                  | Comment                                               |
+------------+--------------------------+-------------------------------------------------------+
| Select     | Tables                   | To retrieve rows from table                           |
| Insert     | Tables                   | To insert data into tables                            |
| Update     | Tables                   | To update existing rows                               |
| Delete     | Tables                   | To delete existing rows                               |
| Index      | Tables                   | To create or drop indexes                             |
| Alter      | Tables                   | To alter the table                                    |
| Create     | Databases,Tables,Indexes | To create new databases and tables                    |
| Drop       | Databases,Tables         | To drop databases and tables                          |
| Grant      | Databases,Tables         | To give to other users those privileges you possess   |
| References | Databases,Tables         | To have references on tables                          |
| Reload     | Server Admin             | To reload or refresh tables, logs and privileges      |
| Shutdown   | Server Admin             | To shutdown the server                                |
| Process    | Server Admin             | To view the plain text of currently executing queries |
| File       | File access on server    | To read and write files on the server                 |
+------------+--------------------------+-------------------------------------------------------+
14 rows in set (0.00 sec)
@end example


@node Other administrative SQL,  , SHOW, Database Administration
@subsection Other Administrative Statements

@menu
* CACHE INDEX::                 @code{CACHE INDEX} Syntax
* FLUSH::                       @code{FLUSH} Syntax
* KILL::                        @code{KILL} Syntax
* LOAD INDEX::                  @code{LOAD INDEX INTO CACHE} Syntax
* PURGE LOGS::                  @code{PURGE MASTER LOGS} Syntax
* RESET::                       @code{RESET} Syntax
@end menu


@node CACHE INDEX, FLUSH, Other administrative SQL, Other administrative SQL
@subsubsection @code{CACHE INDEX} Syntax

@findex CACHE INDEX

@cindex key cache, assigning indexes to
@cindex indexes, assigning to key cache

@c TODO: change [INDEX] to [INDEX|KEY] when 4.1.2 comes out

@c example_for_help_topic CACHE INDEX
@example
CACHE INDEX
  table_index_list [, table_index_list] ...
  IN key_cache_name

table_index_list:
  table_name
    [[INDEX] (index_name[, index_name] ...)]
@end example

@c description_for_help_topic CACHE INDEX
The @code{CACHE INDEX} statement assigns table indexes to a specific key
cache. It is used only for @code{MyISAM} tables.

The following statement assigns indexes from the tables @code{t1},
@code{t2}, and @code{t3} to the key cache named @code{hot_cache}:

@example
mysql> CACHE INDEX t1, t2, t3 IN hot_cache;
+---------+--------------------+----------+----------+
| Table   | Op                 | Msg_type | Msg_text |
+---------+--------------------+----------+----------+
| test.t1 | assign_to_keycache | status   | OK       |
| test.t2 | assign_to_keycache | status   | OK       |
| test.t3 | assign_to_keycache | status   | OK       |
+---------+--------------------+----------+----------+
@end example
@c end_description_for_help_topic

The syntax of @code{CACHE INDEX} allows you to specify that only particular
indexes from a table should be assigned to the cache.  However, the current
implementation assigns all the table's indexes to the cache, so there is no
reason to specify anything other than the table name.

The key cache referred to in a @code{CACHE INDEX} statement can be created
by setting its size with a parameter setting statement or in the server
parameter settings. For example:

@example
mysql> SET GLOBAL keycache1.key_buffer_size=128*1024;
@end example

Key cache parameters can be accessed as members of a structured system
variable.
@xref{Structured System Variables}.

A key cache must exist before you can assign indexes to it:

mysql> CACHE INDEX t1 in non_existent_cache;
ERROR 1283 (HY000): Unknown key cache 'non_existent_cache'

By default, table indexes are assigned to the main (default) key cache
created at the server start-up. When a key cache is destroyed, all
indexes assigned to it become assigned to the default key cache again.

Index assignment affects the server globally: If one client
assigns an index to a given cache, this cache is used for all queries
involving the index, no matter what client issues the queries.

@code{CACHE INDEX} was added in MySQL 4.1.1.


@node FLUSH, KILL, CACHE INDEX, Other administrative SQL
@subsubsection @code{FLUSH} Syntax

@findex FLUSH

@cindex @code{mysqladmin}
@cindex clearing, caches
@cindex caches, clearing

@c example_for_help_topic FLUSH
@example
FLUSH [LOCAL | NO_WRITE_TO_BINLOG] flush_option [,flush_option] ...
@end example

@c description_for_help_topic FLUSH  LOCAL NO_WRITE_TO_BINLOG DES_KEY_FILE USER_RESOURCES
You should use the @code{FLUSH} command if you want to clear some of the
internal caches MySQL uses.  To execute @code{FLUSH}, you must have
the @code{RELOAD} privilege.
@c end_description_for_help_topic

@code{flush_option} can be any of the following:

@multitable @columnfractions .25 .75
@item @strong{Option} @tab @strong{Description}

@item @code{HOSTS}  @tab Empties the host cache tables.  You should flush the
host tables if some of your hosts change IP number or if you get the
error message @code{Host ... is blocked}.  When more than
@code{max_connect_errors} errors occur in a row for a given host while
connection to the MySQL server, MySQL assumes
something is wrong and blocks the host from further connection requests.
Flushing the host tables allows the host to attempt to connect
again. @xref{Blocked host}. You can start @code{mysqld} with
@code{-O max_connect_errors=999999999} to avoid this error message.

@item @code{DES_KEY_FILE} @tab Reloads the DES keys from the file that was
specified with the @code{--des-key-file} option at server startup time.

@item @code{LOGS} @tab Closes and reopens all log files.
If you have specified an update log file or a binary log file without
an extension, the extension number of the log file will be incremented
by one relative to the previous file. If you have used an extension in
the file name, MySQL will close and reopen the update log file.
@xref{Update log}. This is the same thing as sending the @code{SIGHUP}
signal to the @code{mysqld} server.

@item @code{PRIVILEGES} @tab Reloads the privileges from the grant tables in
the @code{mysql} database.

@item @code{QUERY CACHE} @tab Defragment the query cache to better utilize its
memory.  This command will not remove any queries from the cache, unlike
@code{RESET QUERY CACHE}.

@item @code{TABLES} @tab Closes all open tables and force all tables in use to be closed. This also flushes the query cache.

@item @code{[TABLE | TABLES] tbl_name [,tbl_name...]} @tab Flushes only the given tables.

@item @code{TABLES WITH READ LOCK} @tab Closes all open tables and locks all tables for all databases with a read lock until you execute @code{UNLOCK TABLES}. This is very convenient way to get backups if you have a filesystem, like Veritas, that can take snapshots in time.

@item @code{STATUS} @tab Resets most status variables to zero. This is something you should use only when debugging a query. @xref{Bug reports}.

@item @code{USER_RESOURCES} @tab Resets all user resources to zero. This will enable blocked users to log in again. @xref{User resources}.
@end multitable

Before MySQL 4.1.1, @code{FLUSH} commands are not written
to the binary log. Since MySQL 4.1.1 they are written to the binary
log unless the optional @code{NO_WRITE_TO_BINLOG} keyword 
(or its alias @code{LOCAL}) was used, or
unless the command contained one of these arguments: @code{LOGS},
@code{MASTER}, @code{SLAVE}, @code{TABLES WITH READ LOCK}, because any
of these arguments may cause problems if replicated to a slave.

You can also access some of the commands shown above with the @code{mysqladmin}
utility, using the @code{flush-hosts}, @code{flush-logs}, @code{flush-privileges},
@code{flush-status} or @code{flush-tables} commands.

Take also a look at the @code{RESET} command used with replication.
@xref{RESET, , @code{RESET}}.


@node KILL, LOAD INDEX, FLUSH, Other administrative SQL
@subsubsection @code{KILL} Syntax

@findex KILL

@cindex @code{mysqladmin}

@c example_for_help_topic KILL
@example
KILL thread_id
KILL CONNECTION thread_id
KILL QUERY thread_id
@end example

@c description_for_help_topic KILL
Each connection to @code{mysqld} runs in a separate thread.  You can see
which threads are running with the @code{SHOW PROCESSLIST} command and kill
a thread with the @code{KILL thread_id} command.

As of MySQL 5.0.0, @code{KILL} allows the optional @code{CONNECTION} or
@code{QUERY} modifiers:

@itemize @bullet

@item
@code{KILL CONNECTION} is the same as @code{KILL} with no modifier:
It terminates the connection associated with the given @code{thread_id}.

@item
@code{KILL QUERY} terminates the statement that the connection is executing,
but leaves the connection intact.

@end itemize

If you have the @code{PROCESS} privilege, you can see all threads.
If you have the @code{SUPER} privilege, you can kill all threads and
statements.  Otherwise, you can only see and kill your own threads and
statements.

You can also use the @code{mysqladmin processlist} and @code{mysqladmin kill}
commands to examine and kill threads.

@emph{Note:} You currently cannot use @code{KILL} with the Embedded MySQL
Server library, because the embedded server merely runs inside the threads
of the host application, it does not create connection threads of its own.

When you do a @code{KILL}, a thread-specific @code{kill flag} is set for
the thread.
@c end_description_for_help_topic

In most cases it may take some time for the thread to die, as the kill
flag is only checked at specific intervals.

@itemize @bullet
@item
In @code{SELECT}, @code{ORDER BY} and @code{GROUP BY} loops, the flag is
checked after reading a block of rows. If the kill flag is set, the
statement is aborted.
@item
When doing an @code{ALTER TABLE} the kill flag is checked before each block of
rows are read from the original table. If the kill flag was set the command
is aborted and the temporary table is deleted.
@item
When doing an @code{UPDATE} or @code{DELETE}, the kill flag
is checked after each block read and after each updated or deleted
row. If the kill flag is set, the statement is aborted.  Note that if you
are not using transactions, the changes will not be rolled back!
@item
@code{GET_LOCK()} will abort with @code{NULL}.
@item
An @code{INSERT DELAYED} thread will quickly flush all rows it has in
memory and die.
@item
If the thread is in the table lock handler (state: @code{Locked}),
the table lock will be quickly aborted.
@item
If the thread is waiting for free disk space in a @code{write} call, the
write is aborted with an disk full error message.
@end itemize


@node LOAD INDEX, PURGE LOGS, KILL, Other administrative SQL
@subsubsection @code{LOAD INDEX INTO CACHE} Syntax

@c TODO: change [INDEX] to [INDEX|KEY] when 4.1.2 comes out

@c example_for_help_topic LOAD INDEX
@example
LOAD INDEX INTO CACHE
  table_index_list [, table_index_list] ...

table_index_list:
  table_name
    [[INDEX] (index_name[, index_name] ...)]
    [IGNORE LEAVES]
@end example

@c description_for_help_topic LOAD INDEX
The @code{LOAD INDEX INTO CACHE} statement preloads a table index into the
key cache to which it has been assigned by an explicit @code{CACHE INDEX}
statement, or into the default key cache otherwise.  @code{LOAD INDEX INTO
CACHE} is used only for @code{MyISAM} tables.

The @code{IGNORE LEAVES} modifier causes only blocks for the non-leaf
nodes of the index to be preloaded.
@c end_description_for_help_topic

The following statement preloads nodes (index blocks) of indexes of the
tables @code{t1} and @code{t2}:

@example
mysql> LOAD INDEX INTO CACHE t1, t2 IGNORE LEAVES;
+---------+--------------+----------+----------+
| Table   | Op           | Msg_type | Msg_text |
+---------+--------------+----------+----------+
| test.t1 | preload_keys | status   | OK       |
| test.t2 | preload_keys | status   | OK       |
+---------+--------------+----------+----------+
@end example

This statement preloads all index blocks from @code{t1}. It preloads only
blocks for the non-leaf nodes from @code{t2}.

The syntax of @code{LOAD INDEX INTO CACHE} allows you to specify that only
particular indexes from a table should be preloaded.  However, the current
implementation preloads all the table's indexes into the cache, so there is
no reason to specify anything other than the table name.

@code{LOAD INDEX INTO CACHE} was added in MySQL 4.1.1.


@node PURGE LOGS, RESET, LOAD INDEX, Other administrative SQL
@subsubsection @code{PURGE MASTER LOGS} Syntax

@c example_for_help_topic PURGE LOGS
@example
PURGE @{MASTER|BINARY@} LOGS TO binlog_name
PURGE @{MASTER|BINARY@} LOGS BEFORE date
@end example

@c description_for_help_topic PURGE LOGS
This statement is used to delete all binary logs strictly prior to the
specified binlog or date. @xref{Replication Master SQL}.

@code{PURGE BINARY LOGS} is available as a synonym for @code{PURGE MASTER
LOGS} as of MySQL 4.1.1.
@c end_description_for_help_topic


@node RESET,  , PURGE LOGS, Other administrative SQL
@subsubsection @code{RESET} Syntax

@c example_for_help_topic RESET
@example
RESET reset_option [,reset_option] ...
@end example

@c description_for_help_topic RESET
The @code{RESET} statement is used to clear things. It also acts as a stronger
version of the @code{FLUSH} command.  @xref{FLUSH, , @code{FLUSH}}.
@c end_description_for_help_topic

To execute @code{RESET}, you must have the @code{RELOAD} privilege.

@multitable @columnfractions .25 .75
@item @strong{Option} @tab @strong{Description}

@item @code{MASTER} @tab Deletes all binary logs listed in the index file, resetting the binlog
index file to be empty. Previously named @code{FLUSH MASTER}.
@xref{Replication Master SQL}.

@item @code{SLAVE} @tab Makes the slave forget its replication position in the master
binlogs.  Previously named @code{FLUSH SLAVE}. @xref{Replication Slave SQL}.

@item @code{QUERY CACHE} @tab Removes all query results from the query cache.
@end multitable


@node Replication SQL, Fulltext Search, Database Administration, SQL Syntax
@section Replication Statements

This section describes replication-related SQL statements.
One group of statements is used for controlling master servers.
The other is used for controlling slave servers.

@menu
* Replication Master SQL::      SQL Statements for Controlling Master Servers
* Replication Slave SQL::       SQL Statements for Controlling Slave Servers
@end menu

@node Replication Master SQL, Replication Slave SQL, Replication SQL, Replication SQL
@subsection SQL Statements for Controlling Master Servers

@cindex SQL commands, replication masters
@cindex commands, replication masters
@cindex replication masters, commands

Replication can be controlled through the SQL interface. This section
discusses statements for managing master replication servers.
@ref{Replication Slave SQL} discusses statements for managing slave servers.

@menu
* PURGE MASTER LOGS::           @code{PURGE MASTER LOGS}
* RESET MASTER::                @code{RESET MASTER}
* SET SQL_LOG_BIN::             @code{SET SQL_LOG_BIN}
* SHOW BINLOG EVENTS::          @code{SHOW BINLOG EVENTS}
* SHOW MASTER STATUS::          @code{SHOW MASTER STATUS}
* SHOW MASTER LOGS::            @code{SHOW MASTER LOGS}
* SHOW SLAVE HOSTS::            @code{SHOW SLAVE HOSTS}
@end menu

@node PURGE MASTER LOGS, RESET MASTER, Replication Master SQL, Replication Master SQL
@subsubsection @code{PURGE MASTER LOGS}

@findex PURGE MASTER LOGS

@c description_for_help_topic PURGE MASTER LOGS BEFORE TO
@example
PURGE @{MASTER|BINARY@} LOGS TO 'log_name'
PURGE @{MASTER|BINARY@} LOGS BEFORE 'date'
@end example

Deletes all the binary logs listed in the log
index that are strictly prior to the specified log or date.
The logs also are removed from this list recorded in the log index file,
so that the given log now becomes the first. 
@c end_description_for_help_topic

Example:

@c example_for_help_topic PURGE
@example
PURGE MASTER LOGS TO 'mysql-bin.010';
PURGE MASTER LOGS BEFORE '2003-04-02 22:46:26';
@end example

The @code{BEFORE} variant is available in MySQL 4.1; its date argument
can be in @code{'YYYY-MM-DD hh:mm:ss'} format.
@code{MASTER} and @code{BINARY} are synonyms, though @code{BINARY} can be used
only as of MySQL 4.1.1.

If you have an active slave that is currently reading one of the logs you
are trying to delete, this command does nothing and fails with an error.
However, if you have a dormant slave, and happen to purge one of
the logs it wants to read, the slave will be unable to replicate once it
comes up.  The command is safe to run while slaves are replicating. You
do not need to stop them.

@c TODO: make this a numbered list rather than a single run-on sentence.

You must first check all the slaves with @code{SHOW SLAVE STATUS} to
see which log they are reading, then do a listing of the logs on the
master with @code{SHOW MASTER LOGS}, find the earliest log among all
the slaves (if all the slaves are up to date, this will be the
last log on the list), backup all the logs you are about to delete
(optional) and purge up to the target log.

@node RESET MASTER, SET SQL_LOG_BIN, PURGE MASTER LOGS, Replication Master SQL
@subsubsection @code{RESET MASTER}

@findex RESET MASTER

@c description_for_help_topic RESET MASTER  RESET MASTER
@example
RESET MASTER
@end example

Deletes all binary logs listed in the index file, resetting the binlog
index file to be empty.

This statement was named @code{FLUSH MASTER} before MySQL 3.23.26.
@c end_description_for_help_topic

@node SET SQL_LOG_BIN, SHOW BINLOG EVENTS, RESET MASTER, Replication Master SQL
@subsubsection @code{SET SQL_LOG_BIN}

@findex SET SQL_LOG_BIN

@c description_for_help_topic SET SQL_LOG_BIN  SET SQL_LOG_BIN
@example
SET SQL_LOG_BIN = @{0|1@}
@end example

Disables or enables binary logging for the current connection 
(@code{SQL_LOG_BIN} is a session variable)
if the client connects using an account that has the @code{SUPER} privilege.
The statement is ignored if the client does not have that privilege.
@c end_description_for_help_topic

@node SHOW BINLOG EVENTS, SHOW MASTER STATUS, SET SQL_LOG_BIN, Replication Master SQL
@subsubsection @code{SHOW BINLOG EVENTS}

@findex SHOW BINLOG EVENTS

@c description_for_help_topic SHOW BINLOG  SHOW BINLOG EVENTS LIMIT FROM IN
@example
SHOW BINLOG EVENTS [ IN 'log_name' ] [ FROM pos ] [ LIMIT [offset,] row_count ]
@end example

@c TODO: ask if the LIMIT args have same meaning as for SELECT

Shows the events in the binary log. 
If you do not specify @code{'log_name'}, the first binary log will be displayed.
@c end_description_for_help_topic

This statement is available as of MySQL 4.0

@node SHOW MASTER STATUS, SHOW MASTER LOGS, SHOW BINLOG EVENTS, Replication Master SQL
@subsubsection @code{SHOW MASTER STATUS}

@findex SHOW MASTER STATUS

@c description_for_help_topic SHOW MASTER STATUS  SHOW MASTER STATUS
@example
SHOW MASTER STATUS
@end example

Provides status information on the binlog of the master.
@c end_description_for_help_topic

@node SHOW MASTER LOGS, SHOW SLAVE HOSTS, SHOW MASTER STATUS, Replication Master SQL
@subsubsection @code{SHOW MASTER LOGS}

@findex SHOW MASTER LOGS

@c description_for_help_topic SHOW MASTER LOGS  SHOW MASTER LOGS
@example
SHOW MASTER LOGS
@end example

Lists the binary logs on the master. You should use this
command before using @code{PURGE MASTER LOGS} to find out how far you
should go.
@c end_description_for_help_topic

@node SHOW SLAVE HOSTS,  , SHOW MASTER LOGS, Replication Master SQL
@subsubsection @code{SHOW SLAVE HOSTS}

@findex SHOW SLAVE HOSTS

@c description_for_help_topic SHOW SLAVE HOSTS  SHOW SLAVE HOSTS
@example
SHOW SLAVE HOSTS
@end example

Displays a list of slaves currently registered with the master. 
Note that slaves not started with the @code{--report-host=slave_name} 
option will not be visible in that list.
@c end_description_for_help_topic


@node Replication Slave SQL,  , Replication Master SQL, Replication SQL
@subsection SQL Statements for Controlling Slave Servers

@cindex SQL commands, replication slaves
@cindex commands, replication slaves
@cindex replication slaves, commands

Replication can be controlled through the SQL interface. This section
discusses statements for managing slave replication servers.
@ref{Replication Master SQL} discusses statements for managing master servers.

@menu
* CHANGE MASTER TO::            @code{CHANGE MASTER TO}
* LOAD DATA FROM MASTER::       @code{LOAD DATA FROM MASTER}
* LOAD TABLE FROM MASTER::      @code{LOAD TABLE tbl_name FROM MASTER}
* MASTER_POS_WAIT::             @code{MASTER_POS_WAIT()}
* RESET SLAVE::                 @code{RESET SLAVE}
* SET GLOBAL SQL_SLAVE_SKIP_COUNTER::  @code{SET GLOBAL SQL_SLAVE_SKIP_COUNTER}
* SHOW SLAVE STATUS::           @code{SHOW SLAVE STATUS}
* START SLAVE::                 @code{START SLAVE}
* STOP SLAVE::                  @code{STOP SLAVE}
@end menu


@node CHANGE MASTER TO, LOAD DATA FROM MASTER, Replication Slave SQL, Replication Slave SQL
@subsubsection @code{CHANGE MASTER TO}

@findex CHANGE MASTER TO

@c description_for_help_topic CHANGE MASTER TO  CHANGE MASTER TO MASTER_HOST MASTER_USER MASTER_PASSWORD MASTER_PORT MASTER_LOG_FILE MASTER_LOG_POS MASTER_CONNECT_RETRY RELAY_LOG_POS RELAY_LOG_FILE MASTER_SSL MASTER_SSL_CA MASTER_SSL_CERT MASTER_SSL_KEY MASTER_SSL_CIPHER

@example
CHANGE MASTER TO master_def [, master_def] ...

master_def =
      MASTER_HOST = 'host_name'
    | MASTER_USER = 'user_name'
    | MASTER_PASSWORD = 'password'
    | MASTER_PORT = port_num
    | MASTER_CONNECT_RETRY = count
    | MASTER_LOG_FILE = 'master_log_name'
    | MASTER_LOG_POS = master_log_pos
    | RELAY_LOG_FILE = 'relay_log_name'
    | RELAY_LOG_POS = relay_log_pos
    | MASTER_SSL = @{0|1@}
    | MASTER_SSL_CA = 'ca_file_name'
    | MASTER_SSL_CAPATH = 'ca_directory_name'
    | MASTER_SSL_CERT = 'cert_file_name'
    | MASTER_SSL_KEY = 'key_file_name'
    | MASTER_SSL_CIPHER = 'cipher_list'
@end example

Changes the parameters that the slave server uses for connecting to and
communicating with the master server.
The possible @code{master_def} values are shown above.

The relay log options
(@code{RELAY_LOG_FILE} and @code{RELAY_LOG_POS}) are available beginning with
MySQL 4.0.

The SSL options
(@code{MASTER_SSL},
@code{MASTER_SSL_CA},
@code{MASTER_SSL_CAPATH},
@code{MASTER_SSL_CERT},
@code{MASTER_SSL_KEY},
and
@code{MASTER_SSL_CIPHER})
are available beginning with MySQL 4.1.1.
You can change these options even on slaves that are compiled without SSL
support. They will be saved to the @file{master.info} file but ignored until
you use a server that has SSL support enabled.

For example:

@example
mysql> CHANGE MASTER TO
    ->     MASTER_HOST='master2.mycompany.com',
    ->     MASTER_USER='replication',
    ->     MASTER_PASSWORD='bigs3cret',
    ->     MASTER_PORT=3306,
    ->     MASTER_LOG_FILE='master2-bin.001',
    ->     MASTER_LOG_POS=4,
    ->     MASTER_CONNECT_RETRY=10;
mysql> CHANGE MASTER TO
    ->     RELAY_LOG_FILE='slave-relay-bin.006',
    ->     RELAY_LOG_POS=4025;
@end example
@c end_description_for_help_topic

@code{MASTER_USER}, @code{MASTER_PASSWORD},
@code{MASTER_SSL}, @code{MASTER_SSL_CA},
@code{MASTER_SSL_CAPATH}, @code{MASTER_SSL_CERT}, @code{MASTER_SSL_KEY},
and @code{MASTER_SSL_CIPHER} are information for the slave to be able to
connect to its master. If you don't specify some of these
informations, the non-specified informations will keep their old
value. For example, if the password to connect to your MySQL master has
changed, you just need to issue
@example
mysql> STOP SLAVE; -- if replication was running
mysql> CHANGE MASTER TO MASTER_PASSWORD='new3cret';
mysql> START SLAVE; -- if you want to restart replication
@end example
to tell the slave about the new password; no need to specify the
information which did not change (host, port, user etc).

@code{MASTER_HOST}, @code{MASTER_PORT} are the hostname or IP adress of
the master host, and its TCP port. Note that if @code{MASTER_HOST} is
equal to @code{localhost}, then, like in other parts of MySQL, the port
may be ignored (if Unix socket files can be used for example).

If you specify @code{MASTER_HOST} or @code{MASTER_PORT},
the slave will assume that the master server is different than
before (even if you specify a host or port value value that is
the same as the current value.) In this case, the old values of master
binlog name and position are considered no longer applicable, so if you
do not specify @code{MASTER_LOG_FILE} and @code{MASTER_LOG_POS} in the
command, @code{MASTER_LOG_FILE=''} and @code{MASTER_LOG_POS=4} are
silently appended to it. 

@code{MASTER_LOG_FILE} and @code{MASTER_LOG_POS} are the coordinates
at which the slave I/O thread should begin reading from the master the
next time the thread starts.
If you specify any of them, you can't specify @code{RELAY_LOG_FILE} or
@code{RELAY_LOG_POS}.
If none of @code{MASTER_LOG_FILE} and @code{MASTER_LOG_POS} was
specified, then the last coordinates of the @strong{slave SQL thread}
before @code{CHANGE MASTER} was issued, are used. This ensures that
replication has no discontinuity, even if the slave SQL thread was late
compared to the slave I/O thread, when you just want to change, say, the
password to use. This safe behavior was introduced starting from MySQL
4.0.17 and 4.1.1. (Before these versions, the used coordinates were 
the last coordinates of the slave I/O thread before @code{CHANGE MASTER}
was issued, which caused the SQL thread to sometimes lose some events
from the master, thus breaking replication.)

@code{CHANGE MASTER} @strong{deletes all relay logs} (and starts
a new one), unless you specified @code{RELAY_LOG_FILE} or
@code{RELAY_LOG_POS} (in that case relay logs will be kept;
since MySQL 4.1.1 the @code{RELAY_LOG_PURGE} global variable
will silently be set to 0).
@code{CHANGE MASTER TO} updates @file{master.info} and
@file{relay-log.info}.

@code{CHANGE MASTER} is useful for setting up a slave when you have the snapshot of
the master and have recorded the log and the offset on the master that the
snapshot corresponds to. You can run
 @code{CHANGE MASTER TO MASTER_LOG_FILE='log_name_on_master',
 MASTER_LOG_POS=log_offset_on_master} on the slave after restoring the
snapshot.

The first example above 
(@code{CHANGE MASTER TO MASTER_HOST='master2.mycompany.com' etc})
changes the master and master's binlog
coordinates. This is when you want the slave to replicate the master.
The second example, less frequently used, is when the slave has relay logs which, for some
reason, you want the slave to execute again; to do this the master
needn't be reachable, you just have to do @code{CHANGE MASTER TO}
and start the SQL thread (@code{START SLAVE SQL_THREAD}). 
You can even use this out of a replication setup, on a standalone,
slave-of-nobody server, to recover after a crash.
Suppose your server has crashed and you have restored a backup. 
You want to replay the server's own binlogs (not relay logs, but regular binary
logs), supposedly named @file{myhost-bin.*}. First make a backup copy of
these binlogs in some safe place, in case you don't exactly follow the
procedure below and accidentally have the server purge the binlogs.
If using MySQL 4.1.1 or newer, do @code{SET GLOBAL RELAY_LOG_PURGE=0}
for additional safety.
Then start the server without @code{log-bin}, with a new
(different from before) server ID, with @code{relay-log=myhost-bin}
(to make the server believe that these regular binlogs are relay
logs) and @code{skip-slave-start},
then issue these statements:

@example
mysql> CHANGE MASTER TO
    ->     RELAY_LOG_FILE='myhost-bin.153',
    ->     RELAY_LOG_POS=410,
    ->     MASTER_HOST='some_dummy_string';
mysql> START SLAVE SQL_THREAD;
@end example

Then the server will read and execute its own binlogs, thus achieving
crash recovery.
Once the recovery is finished, run @code{STOP SLAVE}, shutdown the
server, delete @file{master.info} and @file{relay-log.info},
and restart the server with its original options.
For the moment, specifying @code{MASTER_HOST} (even with a dummy value) is compulsory
to make the server think it is a slave, and giving the server a new,
different from before, server ID is also compulsory otherwise the
server will see events with its ID and think it is in a circular
replication setup and skip the events, which is unwanted. In the
future we plan to add options to get rid of these small constraints.

@node LOAD DATA FROM MASTER, LOAD TABLE FROM MASTER, CHANGE MASTER TO, Replication Slave SQL
@subsubsection @code{LOAD DATA FROM MASTER}

@findex LOAD DATA FROM MASTER

@c description_for_help_topic LOAD DATA FROM MASTER  LOAD DATA FROM MASTER
@example
LOAD DATA FROM MASTER
@end example

Takes a snapshot of the master and copies it to the slave.
Updates the values of @code{MASTER_LOG_FILE} and
@code{MASTER_LOG_POS} so that the slave will start replicating from the
correct position. Will honor table and database exclusion rules
specified with @code{replicate-*} options.

Use of this statement is subject to the following conditions:

@itemize @bullet

@item
It works only with @code{MyISAM} tables.

@item
It acquires a global read lock on the master while taking the snapshot,
which prevents updates on the master during the load operation.

@end itemize

In the future, it is planned to make this statement work with
@code{InnoDB} tables and to remove the need for global read lock by using
the non-blocking online backup feature.

If you are loading big tables, you may have to increase the values
of @code{net_read_timeout} and @code{net_write_timeout}
on both your master and slave.
See @ref{SHOW VARIABLES, , @code{SHOW VARIABLES}}.

Note that @code{LOAD DATA FROM MASTER} does @strong{NOT} copy any
tables from the @code{mysql} database.  This is to make it easy to have
different users and privileges on the master and the slave.

This statement
requires that the replication account that is used to connect to the master
have @code{RELOAD} and @code{SUPER} privileges on the master,
@code{SELECT} privileges on all master's tables you want to load. All
master's tables on which the user has no @code{SELECT} privilege will
be ignored by @code{LOAD DATA FROM MASTER}; this is because the
master will hide them to the user: @code{LOAD DATA FROM MASTER} calls
@code{SHOW DATABASES} to know the master databases to load, but
@code{SHOW DATABASES} returns only databases on which the user has
some privilege.
See @ref{Show database info}.
On the slave's side, the user which issues @code{LOAD DATA FROM MASTER} should
have grants to drop and create the involved databases and tables.
@c end_description_for_help_topic

@node LOAD TABLE FROM MASTER, MASTER_POS_WAIT, LOAD DATA FROM MASTER, Replication Slave SQL
@subsubsection @code{LOAD TABLE tbl_name FROM MASTER}

@findex LOAD TABLE FROM MASTER

@c description_for_help_topic LOAD TABLE FROM MASTER  LOAD TABLE FROM MASTER
@example
LOAD TABLE tbl_name FROM MASTER
@end example

Downloads a copy of the table from master to the slave. This statement is
implemented mainly for debugging of @code{LOAD DATA FROM MASTER}.
Requires that the account used for connecting to the master server have
@code{RELOAD} and @code{SUPER} privileges on the master, and
@code{SELECT} on the master table to load.
On the slave's side, the user which issues @code{LOAD TABLE FROM MASTER} should
have grants to drop and create the table.
Please read the timeout notes in the description of @code{LOAD DATA
FROM MASTER} above; they apply here, too. Please also read the
limitations of @code{LOAD DATA FROM MASTER} above, they apply too (for
example, @code{LOAD TABLE FROM MASTER} works only for @code{MyISAM}
tables).
@c end_description_for_help_topic

@node MASTER_POS_WAIT, RESET SLAVE, LOAD TABLE FROM MASTER, Replication Slave SQL
@subsubsection @code{MASTER_POS_WAIT()}

@findex MASTER_POS_WAIT()

@c help_category Miscellaneous Functions@Functions
@c example_for_help_topic MASTER_POS_WAIT
@example
SELECT MASTER_POS_WAIT('master_log_file', master_log_pos)
@end example
@c help_category Administration

This is a function, not a command. It is used to ensure that the slave
has reached (read and executed up to) a given position in the master's binlog.
See @ref{Miscellaneous functions} for a full description.
@c end_description_for_help_topic

@node RESET SLAVE, SET GLOBAL SQL_SLAVE_SKIP_COUNTER, MASTER_POS_WAIT, Replication Slave SQL
@subsubsection @code{RESET SLAVE}

@findex RESET SLAVE

@c description_for_help_topic RESET SLAVE  RESET SLAVE
@example
RESET SLAVE
@end example

Makes the slave forget its replication position in the master's binlogs.
This statement is meant to be used for a clean start: it
deletes the @file{master.info} and
@file{relay-log.info} files, all the relay logs, and starts a new relay log.
@strong{Note:} All relay logs are deleted, even if they had not been
totally executed by the slave SQL thread.
(This is a condition likely to exist on a replication slave that is
highly loaded, or if you have issued a @code{STOP SLAVE} statement.)
Connection information stored in the @file{master.info} file is
immediately reset to the values specified in the corresponding startup
options, if they were specified. 
This information includes values such as
master host, master port, master user, and master password.
If the slave SQL thread was in the middle of replicating temporary
tables when it was stopped, and @code{RESET SLAVE} is issued, these
replicated temporary tables are deleted on the slave.

This statement was named @code{FLUSH SLAVE} before MySQL 3.23.26.
@c end_description_for_help_topic

@node SET GLOBAL SQL_SLAVE_SKIP_COUNTER, SHOW SLAVE STATUS, RESET SLAVE, Replication Slave SQL
@subsubsection @code{SET GLOBAL SQL_SLAVE_SKIP_COUNTER}

@findex SET GLOBAL SQL_SLAVE_SKIP_COUNTER

@c description_for_help_topic SET GLOBAL SQL_SLAVE_SKIP_COUNTER  SET GLOBAL SQL_SLAVE_SKIP_COUNTER  
@example
SET GLOBAL SQL_SLAVE_SKIP_COUNTER = n
@end example

Skip the next @code{n} events from the master. This is
useful for recovering from replication stops caused by a statement.

This statement is valid only when the slave thread is not running.
Otherwise, it produces an error.

Before MySQL 4.0, omit the @code{GLOBAL} keyword from the statement.
@c end_description_for_help_topic

@node SHOW SLAVE STATUS, START SLAVE, SET GLOBAL SQL_SLAVE_SKIP_COUNTER, Replication Slave SQL
@subsubsection @code{SHOW SLAVE STATUS}

@findex SHOW SLAVE STATUS

@c description_for_help_topic SHOW SLAVE STATUS  SHOW SLAVE STATUS
@example
SHOW SLAVE STATUS
@end example

Provides status information on
essential parameters of the slave threads. If you issue this statement using
the
@code{mysql} client, you can use a @code{\G} statement terminator rather than
semicolon to get a more readable vertical layout:

@example
mysql> SHOW SLAVE STATUS\G
*************************** 1. row ***************************
       Slave_IO_State: Waiting for master to send event
          Master_Host: localhost
          Master_User: root
          Master_Port: 3306
        Connect_Retry: 3
      Master_Log_File: gbichot-bin.005
  Read_Master_Log_Pos: 79
       Relay_Log_File: gbichot-relay-bin.005
        Relay_Log_Pos: 548
Relay_Master_Log_File: gbichot-bin.005
     Slave_IO_Running: Yes
    Slave_SQL_Running: Yes
      Replicate_Do_DB:
  Replicate_Ignore_DB:
           Last_Errno: 0
           Last_Error:
         Skip_Counter: 0
  Exec_Master_Log_Pos: 79
      Relay_Log_Space: 552
      Until_Condition: None
       Until_Log_File:
        Until_Log_Pos: 0
   Master_SSL_Allowed: No
   Master_SSL_CA_File:
   Master_SSL_CA_Path:
      Master_SSL_Cert:
    Master_SSL_Cipher:
       Master_SSL_Key:
Seconds_Behind_Master: 8
@end example
@c end_description_for_help_topic

Depending on your version of MySQL, you may not see all the fields just
shown. In particular, several fields are present only as of MySQL 4.1.1.

The fields displayed by @code{SHOW SLAVE STATUS} have the following meanings:

@table @code

@item Slave_IO_State
A copy of the @code{State} column of
the output of @code{SHOW PROCESSLIST} for the slave I/O thread; will
tell you if this thread is trying to connect to the master, waiting
for events from the master, reconnecting to the master, etc. Possible
states are listed in @ref{Replication Implementation Details}. Looking at
this column is necessary because, for example, the thread can be running
but unsuccessfully trying to connect to the master: only this column
will make you aware of the connection problem.
On the opposite, the state of the SQL thread is not copied, because
things are simpler for this thread: if it's running, there is no
problem; if it's not, you will find the error in the
@code{Last_Error} column (described below). 

This field is present beginning with MySQL 4.1.1.

@item Master_Host
The current master host.

@item Master_User
The current user used to connect to the master.

@item Master_Port
The current master port.

@item Connect_Retry
The current value of @code{master-connect-retry}.

@item Master_Log_File
The name of the master's binlog file from which the I/O thread is
currently reading.

@item Read_Master_Log_Pos
The position which the I/O thread has read up to in this master's binlog.

@item Relay_Log_File
The name of the relay log file from which the SQL thread is currently
reading and executing.

@item Relay_Log_Pos
The position which the SQL thread has read and executed up to in this relay log.

@item Relay_Master_Log_File
The name of the master's binlog file that contains the
last event executed by the SQL thread.

@item Slave_IO_Running
Tells whether or not the I/O thread is started.

@item Slave_SQL_Running
Tells whether or not the SQL thread is started.

@item Replicate_Do_DB, Replicate_Ignore_DB
The lists of the databases that were specified with the
@code{--replicate-do-db} and @code{--replicate-ignore-db} options, if any

@item Replicate_Do_Table, Replicate_Ignore_Table, Replicate_Wild_Do_Table, Replicate_Wild_Ignore_Table

The lists of tables that were specified with the
@code{--replicate-do-table},
@code{--replicate-ignore-table},
@code{--replicate-wild-do-table},
and
@code{--replicate-wild-ignore_table}
options, if any

These fields are present beginning with MySQL 4.1.1.

@item Last_Errno
The error number returned by the most recently executed query.
A value of 0 means ``no error''.

@item Last_Error
The error message returned by the most recently executed query.
For example:

@example
Last_Errno: 1051
Last_Error: error 'Unknown table 'z'' on query 'drop table z'
@end example

The message indicates that
the table @code{z} existed on the master and was dropped there, but it
did not exist on the slave, so @code{DROP TABLE} failed on the slave.
(This might occur if you forgot to copy the table to the
slave when setting up replication.)

The empty string means ``no error''.
If the @code{Last_Error} value is not empty, it will also appear as a
message in the slave's error log.

@item Skip_Counter
The last used value for @code{SQL_SLAVE_SKIP_COUNTER}.

@item Exec_Master_Log_Pos
The position in the master's binlog (@code{Relay_Master_Log_File})
of the last event executed by the SQL thread.
((@code{Relay_Master_Log_File},@code{Exec_Master_Log_Pos}) in the
master's binlog corresponds to
(@code{Relay_Log_File},@code{Relay_Log_Pos})
in the relay log).

@item Relay_Log_Space
The total combined size of all existing relay logs.

@item Until_Condition, Until_Log_File, Until_Log_Pos

The values specified in the @code{UNTIL} clause of the @code{START SLAVE}
statement.

@code{Until_Condition} has these values:

@itemize @bullet
@item
@code{None} if no @code{UNTIL} clause was specified
@item
@code{Master} if the slave is reading until a given position in the master's
binlogs
@item
@code{Relay} if the slave is reading until a given position in its relay logs
@end itemize

@code{Until_Log_File} and @code{Until_Log_Pos} indicate the log filename and
position values that define the point at which the SQL thread will stop
executing.

These fields are present beginning with MySQL 4.1.1.

@item Master_SSL_Allowed, Master_SSL_CA_File, Master_SSL_CA_Path, Master_SSL_Cert, Master_SSL_Cipher, Master_SSL_Key

These fields show the
The SSL parameters used by the slave to connect to the master, if any.

@code{Master_SSL_Allowed} has these values:

@itemize @bullet
@item
@code{Yes} if an SSL connection to the master is allowed
@item
@code{No} if an SSL connection to the master is not allowed
@item
@code{Ignored} if an SSL connection is allowed by the slave server does not
have SSL support enabled
@end itemize

The values of the other fields correspond to the values of the
@code{--master-ca},
@code{--master-capath},
@code{--master-cert},
@code{--master-cipher},
and
@code{--master-key}
options.

These fields are present beginning with MySQL 4.1.1.

@item Seconds_Behind_Master
The number of seconds that have elapsed since the timestamp of the last
master's event executed by the slave SQL thread. Will be @code{NULL}
when no event has been executed yet, or after @code{CHANGE MASTER} and
@code{RESET SLAVE}. This column can be used to know how ``late'' your slave
is. It will work even though your master and slave don't have identical
clocks.

This field is present beginning with MySQL 4.1.1.

@end table

@node START SLAVE, STOP SLAVE, SHOW SLAVE STATUS, Replication Slave SQL
@subsubsection @code{START SLAVE}

@findex START SLAVE

@c description_for_help_topic START SLAVE  START SLAVE IO_THREAD SQL_THREAD
@example
START SLAVE [thread_name [, thread_name] ... ]
START SLAVE [SQL_THREAD] UNTIL
    MASTER_LOG_FILE = 'log_name', MASTER_LOG_POS = log_pos
START SLAVE [SQL_THREAD] UNTIL
    RELAY_LOG_FILE = 'log_name', RELAY_LOG_POS = log_pos

thread_name = IO_THREAD | SQL_THREAD
@end example

@code{START SLAVE} with no options starts both of the slave threads.
The I/O thread reads queries from the master server and stores them in the
relay log.  The SQL thread reads the relay log and executes the
queries.
Note that if @code{START SLAVE} succeeds in starting the slave threads it
will return without any error. But even in that case it might be that slave
threads start and then later stop (because they don't manage to
connect to the master or read his binlogs or any other
problem). @code{START SLAVE} will not warn you about this. You must
check your slave's error log for error messages generated by
the slave threads, or check that these are running fine with @code{SHOW
SLAVE STATUS}.

@code{START SLAVE} requires the @code{SUPER} privilege.
@c end_description_for_help_topic

As of MySQL 4.0.2, you can add @code{IO_THREAD} or @code{SQL_THREAD}
options to the statement to name which of the threads to start.

As of MySQL 4.1.1, an @code{UNTIL} clause may be added to specify that
the slave should start until the SQL thread reaches a given point in
the master binlogs or in the slave relay logs. When the SQL thread reaches
that point, it stops.  If the @code{SQL_THREAD} option is specified in the
statement, it starts only the SQL thread.  Otherwise, it starts both slave
threads.  If the SQL thread is already running, the @code{UNTIL} clause is
ignored and a warning is issued.

With an @code{UNTIL} clause, you must specify both a log filename and
position. Do not mix master and relay log options.

Any @code{UNTIL} condition is reset by a subsequent @code{STOP SLAVE}
statement, or a @code{START SLAVE} statement that includes no @code{UNTIL}
clause, or a server restart.

The @code{UNTIL} clause can be useful for debugging replication, or to
cause replication to proceed until just before the point where you want
to avoid having the slave replicated a statement. For example, if an unwise
@code{DROP TABLE} statement was executed on the master, you can use
@code{UNTIL} to tell the slave to execute up to that point but no farther.
To find what the event is, use @code{mysqlbinlog} with the master logs or
relay logs, or by using a @code{SHOW BINLOG EVENTS} statement.

If you are using @code{UNTIL} to have the slave process replicated queries in
sections, it is recommended that you start the slave with the
@code{--skip-slave-start} option to prevent the SQL thread from running
when the slave starts.  It's probably best to use this option in an option
file rather than on the command line, so that an unexpected server restart does
not cause it to be forgotten.

The @code{SHOW SLAVE STATUS} statement includes output fields that display
the current values of the @code{UNTIL} condition.

This command is called @code{SLAVE START} before MySQL 4.0.5.
For the moment, @code{SLAVE START} is still accepted for backward
compatibility, but is deprecated.

@node STOP SLAVE,  , START SLAVE, Replication Slave SQL
@subsubsection @code{STOP SLAVE}

@findex STOP SLAVE

@c description_for_help_topic STOP SLAVE  STOP SLAVE IO_THREAD SQL_THREAD
@example
STOP SLAVE [thread_name [, thread_name] ... ]

thread_name = IO_THREAD | SQL_THREAD
@end example

Stops the slave threads.
@code{STOP SLAVE} requires the @code{SUPER} privilege.

Like @code{START SLAVE}, this statement
may be used with the @code{IO_THREAD} and @code{SQL_THREAD} options to name
the thread or threads to stop.

@c end_description_for_help_topic

This command is called @code{SLAVE STOP} before MySQL 4.0.5.
For the moment, @code{SLAVE STOP} is still accepted for backward
compatibility, but is deprecated.

@c DISABLED UNTIL IT WORKS (OR UNTIL WE GIVE THIS STRATEGY UP ?)
@c @node SHOW NEW MASTER, PURGE MASTER LOGS, SHOW BINLOG EVENTS, Replication SQL
@c @subsubsection @code{SHOW NEW MASTER FOR SLAVE}

@c @code{SHOW NEW MASTER FOR SLAVE
@c WITH MASTER_LOG_FILE='logfile' AND MASTER_LOG_POS=pos AND
@c MASTER_LOG_SEQ=log_seq AND MASTER_SERVER_ID=server_id}
@c
@c This command is used when a slave of a possibly dead/unavailable master
@c needs to be switched to replicate off another slave that has been
@c replicating the same master. The command will return recalculated
@c replication coordinates (the slave's current binary log file
@c name and position within that file). The output can be used in a subsequent
@c @code{CHANGE MASTER TO} command. Normal users should never need to run
@c this command. It is primarily reserved for internal use by the fail-safe
@c replication code. We may later change the syntax if we find a more
@c intuitive way to describe this operation.


@c TODO: change node name to use "Full-text"; by convention, we use a dash

@node Fulltext Search, Query Cache, Replication SQL, SQL Syntax
@section MySQL Full-text Search

@cindex searching, full-text
@cindex full-text search
@cindex FULLTEXT

@example
MATCH (col1,col2,...) AGAINST (expr [IN BOOLEAN MODE | WITH QUERY EXPANSION] )
@end example

As of Version 3.23.23, MySQL has support for full-text indexing
and searching.  Full-text indexes in MySQL are an index of type
@code{FULLTEXT}.  @code{FULLTEXT} indexes are used with @code{MyISAM} tables
only and can be created from @code{CHAR}, @code{VARCHAR},
or @code{TEXT} columns at @code{CREATE TABLE} time or added later with
@code{ALTER TABLE} or @code{CREATE INDEX}.  For large datasets, it will be
much faster to load your data into a table that has no @code{FULLTEXT}
index, then create the index with @code{ALTER TABLE} (or
@code{CREATE INDEX}).  Loading data into a table that already has a
@code{FULLTEXT} index could be significantly slower.

Full-text searching is performed with the @code{MATCH()} function.

@example
mysql> CREATE TABLE articles (
    ->   id INT UNSIGNED AUTO_INCREMENT NOT NULL PRIMARY KEY,
    ->   title VARCHAR(200),
    ->   body TEXT,
    ->   FULLTEXT (title,body)
    -> );
Query OK, 0 rows affected (0.00 sec)

mysql> INSERT INTO articles VALUES
    -> (NULL,'MySQL Tutorial', 'DBMS stands for DataBase ...'),
    -> (NULL,'How To Use MySQL Efficiently', 'After you went through a ...'),
    -> (NULL,'Optimizing MySQL','In this tutorial we will show ...'),
    -> (NULL,'1001 MySQL Tricks','1. Never run mysqld as root. 2. ...'),
    -> (NULL,'MySQL vs. YourSQL', 'In the following database comparison ...'),
    -> (NULL,'MySQL Security', 'When configured properly, MySQL ...');
Query OK, 6 rows affected (0.00 sec)
Records: 6  Duplicates: 0  Warnings: 0

mysql> SELECT * FROM articles
    ->          WHERE MATCH (title,body) AGAINST ('database');
+----+-------------------+------------------------------------------+
| id | title             | body                                     |
+----+-------------------+------------------------------------------+
|  5 | MySQL vs. YourSQL | In the following database comparison ... |
|  1 | MySQL Tutorial    | DBMS stands for DataBase ...             |
+----+-------------------+------------------------------------------+
2 rows in set (0.00 sec)
@end example

The @code{MATCH()} function performs a natural language search for a string
against a text collection (a set of one or more columns included in
a @code{FULLTEXT} index).  The search string is given as the argument to
@code{AGAINST()}.  The search is performed in case-insensitive fashion.
For every row in the table, @code{MATCH()} returns a relevance value,
that is, a similarity measure between the search string and the text in
that row in the columns named in the @code{MATCH()} list.

When @code{MATCH()} is used in a @code{WHERE} clause (see example above)
the rows returned are automatically sorted with highest relevance first.
Relevance values are non-negative floating-point numbers.  Zero relevance
means no similarity.  Relevance is computed based on the number of words
in the row, the number of unique words in that row, the total number of
words in the collection, and the number of documents (rows) that contain
a particular word.

It is also possible to perform a boolean mode search.  This is explained
later in the section.

The preceding example is a basic illustration showing how to use the
@code{MATCH()} function. Rows are returned in order of decreasing
relevance.

The next example shows how to retrieve the relevance values explicitly.
As neither @code{WHERE} nor @code{ORDER BY} clauses are present, returned
rows are not ordered.

@example
mysql> SELECT id,MATCH (title,body) AGAINST ('Tutorial') FROM articles;
+----+-----------------------------------------+
| id | MATCH (title,body) AGAINST ('Tutorial') |
+----+-----------------------------------------+
|  1 |                        0.64840710366884 |
|  2 |                                       0 |
|  3 |                        0.66266459031789 |
|  4 |                                       0 |
|  5 |                                       0 |
|  6 |                                       0 |
+----+-----------------------------------------+
6 rows in set (0.00 sec)
@end example

The following example is more complex.  The query returns the relevance
and still sorts the rows in order of decreasing relevance. To achieve
this result, you should specify @code{MATCH()} twice. This will cause no
additional overhead, because the MySQL optimizer will notice that the
two @code{MATCH()} calls are identical and invoke the full-text search
code only once.

@c help_category String Functions@Functions
@c example_for_help_topic MATCH AGAINST
@example
mysql> SELECT id, body, MATCH (title,body) AGAINST
    -> ('Security implications of running MySQL as root') AS score
    -> FROM articles WHERE MATCH (title,body) AGAINST
    -> ('Security implications of running MySQL as root');
+----+-------------------------------------+-----------------+
| id | body                                | score           |
+----+-------------------------------------+-----------------+
|  4 | 1. Never run mysqld as root. 2. ... | 1.5055546709332 |
|  6 | When configured properly, MySQL ... |   1.31140957288 |
+----+-------------------------------------+-----------------+
2 rows in set (0.00 sec)
@end example

As of Version 4.1.1, full-text search supports query expansion (in particular,
its variant ``blind query expansion''). It is generally useful when a search
phrase is too short, which often means that the user is relying on implied
knowledge that the full-text search engine usually lacks. For example, a user
searching for ``database'' may really mean that ``MySQL'', ``Oracle'',
``DB2'', and ``RDBMS'' all are phrases that should match
``databases'' and should be returned, too. This is implied knowledge.
Blind query expansion (also known as automatic relevance feedback) works by
performing the search twice, where the search phrase for the second search is
the original search phrase concatenated with the few top found documents from
the first search.  Thus, if one of these documents contained the word
``databases'' and the word ``MySQL'', then the second search will find the
documents that contain the word ``MySQL'' but not ``database''.  Another
example could be searching for books by Georges Simenon about Maigret, when
a user is not sure how to spell ``Maigret''. Then, searching for ``Megre and
the reluctant witnesses'' will find only ``Maigret and the Reluctant Witnesses''
without query expansion, but all books with the word ``Maigret'' on the second
pass of a search with query expansion.  Note: Because blind query expansion
tends to
increase noise significantly, by returning non-relevant documents, it's only
meaningful to use when a search phrase is rather short.

MySQL uses a very simple parser to split text into words.  A ``word''
is any sequence of characters consisting of letters, digits, @samp{'},
and @samp{_}.  Any ``word'' that is present in the stopword list or is just
too short is ignored.  The default minimum length of words that will be found
by full-text searches is four characters. This can be changed as described in
@ref{Fulltext Fine-tuning}.

Every correct word in the collection and in the query is weighted
according to its significance in the query or collection.  This way, a
word that is present in many documents will have lower weight (and may
even have a zero weight), because it has lower semantic value in this
particular collection.  Otherwise, if the word is rare, it will receive a
higher weight.  The weights of the words are then combined to compute the
relevance of the row.

Such a technique works best with large collections (in fact, it was
carefully tuned this way).  For very small tables, word distribution
does not reflect adequately their semantic value, and this model
may sometimes produce bizarre results.

@example
mysql> SELECT * FROM articles WHERE MATCH (title,body) AGAINST ('MySQL');
Empty set (0.00 sec)
@end example

The search for the word @code{MySQL} produces no results in the above
example, because that word is present in more than half the rows.  As such,
it is effectively treated as a stopword (that is, a word with zero semantic
value).  This is the most desirable behavior --- a natural language query
should not return every second row from a 1 GB table.

A word that matches half of rows in a table is less likely to locate relevant
documents.  In fact, it will most likely find plenty of irrelevant documents.
We all know this happens far too often when we are trying to find something on
the Internet with a search engine.  It is with this reasoning that such rows
have been assigned a low semantic value in @strong{this particular dataset}.

As of Version 4.0.1, MySQL can also perform boolean full-text searches using
the @code{IN BOOLEAN MODE} modifier.

@example
mysql> SELECT * FROM articles WHERE MATCH (title,body)
    ->     AGAINST ('+MySQL -YourSQL' IN BOOLEAN MODE);
+----+------------------------------+-------------------------------------+
| id | title                        | body                                |
+----+------------------------------+-------------------------------------+
|  1 | MySQL Tutorial               | DBMS stands for DataBase ...        |
|  2 | How To Use MySQL Efficiently | After you went through a ...        |
|  3 | Optimizing MySQL             | In this tutorial we will show ...   |
|  4 | 1001 MySQL Tricks            | 1. Never run mysqld as root. 2. ... |
|  6 | MySQL Security               | When configured properly, MySQL ... |
+----+------------------------------+-------------------------------------+
@end example

This query retrieved all the rows that contain the word @code{MySQL}
(note: the 50% threshold is not used), but that do @strong{not} contain
the word @code{YourSQL}.  Note that a boolean mode search does not
automatically sort rows in order of decreasing relevance.  You can
see this from result of the preceding query, where the row with the
highest relevance (the one that contains @code{MySQL} twice) is listed
last, not first.  A boolean full-text search can also work even without
a @code{FULLTEXT} index, although it would be @strong{slow}.

The boolean full-text search capability supports the following operators:

@table @code

@item +
A leading plus sign indicates that this word @strong{must be}
present in every row returned.
@item -
A leading minus sign indicates that this word @strong{must not be}
present in any row returned.
@item
By default (when neither plus nor minus is specified) the word is optional,
but the rows that contain it will be rated higher. This mimicks the
behavior of @code{MATCH() ... AGAINST()} without the @code{IN BOOLEAN
MODE} modifier.
@item < >
These two operators are used to change a word's contribution to the
relevance value that is assigned to a row.  The @code{<} operator
decreases the contribution and the @code{>} operator increases it.
See the example below.
@item ( )
Parentheses are used to group words into subexpressions.
@item ~
A leading tilde acts as a negation operator, causing the word's
contribution to the row relevance to be negative. It's useful for marking
noise words. A row that contains such a word will be rated lower than
others, but will not be excluded altogether, as it would be with the
@code{-} operator.
@item *
An asterisk is the truncation operator. Unlike the other operators, it
should be @strong{appended} to the word, not prepended.
@item "
The phrase, that is enclosed in double quotes @code{"}, matches only
rows that contain this phrase @strong{literally, as it was typed}.

@end table

And here are some examples:

@table @code
@item apple banana
find rows that contain at least one of these words.
@item +apple +juice
... both words.
@item +apple macintosh
... word ``apple'', but rank it higher if it also contain ``macintosh''.
@item +apple -macintosh
... word ``apple'' but not ``macintosh''.
@item +apple +(>turnover <strudel)
... ``apple'' and ``turnover'', or ``apple'' and ``strudel'' (in any
order), but rank ``apple pie'' higher than ``apple strudel''.
@item apple*
... ``apple'', ``apples'', ``applesauce'', and ``applet''.
@item "some words"
... ``some words of wisdom'', but not ``some noise words''.
@end table

@menu
* Fulltext Restrictions::       Full-text Restrictions
* Fulltext Fine-tuning::        Fine-tuning MySQL Full-text Search
* Fulltext TODO::               Full-text Search TODO
@end menu

@node Fulltext Restrictions, Fulltext Fine-tuning, Fulltext Search, Fulltext Search
@subsection Full-text Restrictions

@itemize @bullet
@item
Full-text searches are supported for @code{MyISAM} tables only.
@item
Full-text searches cannot be used with UCS-2 (but it works with UTF8 as of
MySQL 4.1.1).
@item
All parameters to the @code{MATCH()} function must be columns from the
same table that is part of the same @code{FULLTEXT} index, unless the
@code{MATCH()} is @code{IN BOOLEAN MODE}.
@item
All columns in the @code{FULLTEXT} index must have the same character set.
@item
The @code{MATCH()} column list must exactly match the column list in some
@code{FULLTEXT} index definition for the table, unless this @code{MATCH()}
is @code{IN BOOLEAN MODE}.
@item
The argument to @code{AGAINST()} must be a constant string.
@end itemize


@node Fulltext Fine-tuning, Fulltext TODO, Fulltext Restrictions, Fulltext Search
@subsection Fine-tuning MySQL Full-text Search

Unfortunately, full-text search has few user-tunable parameters yet,
although adding some is very high on the TODO. If you have a
MySQL source distribution (@pxref{Installing source}), you can
exert more control over full-text searching behavior.

Note that full-text search was carefully tuned for the best searching
effectiveness.  Modifying the default behavior will, in most cases,
only make the search results worse.  Do not alter the MySQL sources
unless you know what you are doing!

The full-text variables described in the following list must be set
at server startup time. You cannot modify them dynamically while the
server is running.

@itemize @bullet

@item
The minimum length of words to be indexed is defined by the MySQL
variable @code{ft_min_word_len}.
@xref{SHOW VARIABLES, , @code{ft_min_word_len}}.
(This variable is only available from MySQL version 4.0.)
The default value is four characters.
Change it to the value you prefer, and rebuild your @code{FULLTEXT} indexes.
For example, if you want three-character words to be searchable, you can set
this variable by putting the following lines in an option file:

@example
[mysqld]
ft_min_word_len=3
@end example

Then restart the server and rebuild your @code{FULLTEXT} indexes.

@item
The stopword list can be loaded from the file specified by the
@code{ft_stopword_file} variable.
@xref{SHOW VARIABLES, , @code{ft_stopword_file}}.
Rebuild your @code{FULLTEXT} indexes after modifying the stopword list.
(This variable is only available from MySQL version 4.0.10 and onwards)

@item
The 50% threshold is determined by the particular weighting scheme chosen.
To disable it, change the following line in @file{myisam/ftdefs.h}:
@example
#define GWS_IN_USE GWS_PROB
@end example
To:
@example
#define GWS_IN_USE GWS_FREQ
@end example
Then recompile MySQL.
There is no need to rebuild the indexes in this case.
@strong{Note:} By doing this you @strong{severely} decrease MySQL's ability
to provide adequate relevance values for the @code{MATCH()} function.
If you really need to search for such common words, it would be better to
search using @code{IN BOOLEAN MODE} instead, which does not observe the 50%
threshold.

@item
Sometimes the search engine maintainer would like to change the operators used
for boolean full-text searches. These are defined by the
@code{ft_boolean_syntax} variable.
@xref{SHOW VARIABLES, , @code{ft_boolean_syntax}}.
Still, this variable is read-only; its value is set in
@file{myisam/ft_static.c}.

@end itemize

For full-text changes that require you to rebuild your @code{FULLTEXT} indexes,
the easiest way to do so for a @code{MyISAM} table is to use the following
statement, which rebuilds the index file:

@example
mysql> REPAIR TABLE tbl_name QUICK;
@end example

@node Fulltext TODO,  , Fulltext Fine-tuning, Fulltext Search
@subsection Full-text Search TODO

@itemize @bullet
@item Make all operations with @code{FULLTEXT} index @strong{faster}.
@item Proximity operators
@item Support for "always-index words". They could be any strings
the user wants to treat as words, examples are "C++", "AS/400", "TCP/IP", etc.
@item Support for full-text search in @code{MERGE} tables.
@item Support for UCS-2.
@item Make stopword list to depend of the language of the data.
@item Stemming (dependent of the language of the data).
@item Generic user-suppliable UDF preparser.
@item Make the model more flexible (by adding some adjustable
parameters to @code{FULLTEXT} in @code{CREATE/ALTER TABLE}).
@end itemize


@node Query Cache,  , Fulltext Search, SQL Syntax
@section MySQL Query Cache

@cindex Query Cache
@cindex @code{SELECT}, Query Cache

From version 4.0.1, @code{MySQL server} features a @code{Query Cache}.
When in use, the query cache stores the text of a @code{SELECT} query
together with the corresponding result that was sent to the client.
If an identical query is later received, the server will retrieve
the results from the query cache rather than parsing and executing the
same query again.

@strong{NOTE:} The query cache does not return stale data. When data
is modified, any relevant entries in the query cache are flushed.

The query cache is extremely useful in an environment where (some)
tables don't change very often and you have a lot of identical queries.
This is a typical situation for many web servers that use a lot of
dynamic content.

Below is some performance data for the query cache. (These results were 
generated by running the MySQL benchmark suite on a Linux Alpha
2 x 500 MHz with 2 GB RAM and a 64 MB query cache):

@itemize @bullet
@item
If all of the queries you're performing are simple (such as selecting a
row from a table with one row); but still differ so that the queries can
not be cached, the overhead for having the query cache active is 13%.
This could be regarded as the worst case scenario. However, in real life,
queries are much more complicated than our simple example so the overhead
is normally significantly lower.
@item
Searches after one row in a one row table is 238% faster.
This can be regarded as close to the minimum speedup to be expected for
a query that is cached.
@item
If you want to disable the query cache code set @code{query_cache_size=0}.
By disabling the query cache code there is no noticeable overhead.
(query cache can be excluded from code with help of configure option
@code{--without-query-cache})
@end itemize

@menu
* Query Cache How::             How the Query Cache Operates
* Query Cache Configuration::   Query Cache Configuration
* Query Cache in SELECT::       Query Cache Options in @code{SELECT}
* Query Cache Status and Maintenance::  Query Cache Status and Maintenance
@end menu


@node Query Cache How, Query Cache Configuration, Query Cache, Query Cache
@subsection How the Query Cache Operates

Queries are compared before parsing, thus

@example
SELECT * FROM tbl_name
@end example

and

@example
Select * from tbl_name
@end example

are regarded as different queries for query cache, so queries need
to be exactly the same (byte for byte) to be seen as identical.
In addition, a query may be seen as different if for instance one
client is using a new communication protocol format or another
character set than another client.

Queries that uses different databases, uses different protocol versions
or the uses different default character sets are considered different
queries and cached separately.

The cache does work for @code{SELECT SQL_CALC_FOUND_ROWS ...} and
@code{SELECT FOUND_ROWS() ...} type queries because the number of
found rows is also stored in the cache.

If query result was returned from query cache then status variable
@code{Com_select} will not be increased, but @code{Qcache_hits} will be. 
@xref{Query Cache Status and Maintenance}.

If a table changes (@code{INSERT}, @code{UPDATE}, @code{DELETE},
@code{TRUNCATE}, @code{ALTER} or @code{DROP TABLE|DATABASE}),
then all cached queries that used this table (possibly through a
@code{MRG_MyISAM} table!) become invalid and are removed from the cache.

Transactional @code{InnoDB} tables that have been changed will be invalidated
when a @code{COMMIT} is performed.

In MySQL 4.0, the query cache is disabled inside of transactions (it does
not return results). Beginning with MySQL 4.1.1, the query cache will also
work inside of transactions when using @code{InnoDB} tables (it will use the
table version number to detect if the data is still current or not).

Before MySQL 5.0, a query that begins with a leading comment might be cached,
but could not be fetched from the cache. This problem is fixed in MySQL 5.0.

A query cannot be cached if it contains one of the functions:
@multitable @columnfractions .33 .33 .34
@item @strong{Function}
 @tab @strong{Function}
 @tab @strong{Function}
@item @code{User-Defined Functions}
 @tab @code{CONNECTION_ID}
 @tab @code{FOUND_ROWS}
@item @code{GET_LOCK}
 @tab @code{RELEASE_LOCK}
 @tab @code{LOAD_FILE}
@item @code{MASTER_POS_WAIT}
 @tab @code{NOW}
 @tab @code{SYSDATE}
@item @code{CURRENT_TIMESTAMP}
 @tab @code{CURDATE}
 @tab @code{CURRENT_DATE}
@item @code{CURTIME}
 @tab @code{CURRENT_TIME}
 @tab @code{DATABASE}
@item @code{ENCRYPT} (with one parameter)
 @tab @code{LAST_INSERT_ID}
 @tab @code{RAND}
@item @code{UNIX_TIMESTAMP} (without parameters)
 @tab @code{USER}
 @tab @code{BENCHMARK}
@end multitable

Nor can a query be cached if it contains user variables,
references the mysql system database,
is of the form @code{SELECT ... IN SHARE MODE},
@code{SELECT ... INTO OUTFILE ...},
@code{SELECT ... INTO DUMPFILE ...} or
of the form @code{SELECT * FROM AUTOINCREMENT_FIELD IS NULL}
(to retrieve last insert ID - ODBC work around).

However, @code{FOUND_ROWS()} will return the correct value,
even if the preceding query was fetched from the cache.

In case a query does not use any tables, or uses temporary tables,
or if the user has a column privilege for any of the involved tables,
that query will not be cached.

Before a query is fetched from the query cache, MySQL will check that
the user has SELECT privilege to all the involved databases and
tables. If this is not the case, the cached result will not be used.

@node Query Cache Configuration, Query Cache in SELECT, Query Cache How, Query Cache
@subsection Query Cache Configuration

The query cache adds a few @code{MySQL} system variables for
@code{mysqld} which may be set in a configuration file, on the
command-line when starting @code{mysqld}.

@itemize @bullet
@item @code{query_cache_limit}
Don't cache results that are bigger than this. (Default 1M).

@item @code{query_cache_min_res_unit}

This variable is present from version 4.1.

The result of a query (the data that is also sent to the client) is stored
in the query cache during result retrieval. Therefore the data is usually
not handled in one big chunk. The query cache allocates blocks for storing
this data on demand, so when one block is filled, a new block is allocated.
Because memory allocation operation is costly (time wise), the query cache
allocates blocks with a minimum size of @code{query_cache_min_res_unit}.
When a query is executed, the last result block is trimmed to the actual
data size, so that unused memory is freed.
@itemize @bullet
@item
The default value of @code{query_cache_min_res_unit} is 4 KB which should
be adequate for most cases.
@item
If you have a lot of queries with small results, the default block size may
lead to memory fragmentation (indicated by a large number of free blocks
(@code{Qcache_free_blocks}), which can cause the query cache to have to
delete queries from the cache due to lack of memory
(@code{Qcache_lowmem_prunes})). In this case you should decrease
@code{query_cache_min_res_unit}.
@item
If you mostly have queres with big results (see @code{Qcache_total_blocks}
and @code{Qcache_queries_in_cache}), you can increase performance by
increasing @code{query_cache_min_res_unit}. However, be careful to not
make it to large (see the previous point).
@end itemize

@item @code{query_cache_size}
The amount of memory (specified in bytes) allocated to store results from
old queries. If this is 0, the query cache is disabled (default).

@item @code{query_cache_type}
This may be set (only numeric) to
@multitable @columnfractions .10 .75
@item @strong{Option} @tab @strong{Description}
@item 0 @tab (OFF, don't cache or retrieve results)
@item 1 @tab (ON, cache all results except @code{SELECT SQL_NO_CACHE ...} queries)
@item 2 @tab (DEMAND, cache only @code{SELECT SQL_CACHE ...} queries)
@end multitable
@end itemize

Inside a thread (connection), the behavior of the query cache can be
changed from the default. The syntax is as follows:

@code{QUERY_CACHE_TYPE = OFF | ON | DEMAND}
@code{QUERY_CACHE_TYPE = 0   | 1  | 2}

@multitable @columnfractions .20 .70
@item @strong{Option} @tab @strong{Description}
@item 0 or OFF @tab Don't cache or retrieve results
@item 1 or ON @tab Cache all results except @code{SELECT SQL_NO_CACHE ...} queries
@item 2 or DEMAND @tab Cache only @code{SELECT SQL_CACHE ...} queries
@end multitable


@node Query Cache in SELECT, Query Cache Status and Maintenance, Query Cache Configuration, Query Cache
@subsection Query Cache Options in @code{SELECT}

There are two possible query cache related parameters that may be
specified in a @code{SELECT} query:

@findex SQL_CACHE
@findex SQL_NO_CACHE

@multitable @columnfractions .20 .80
@item @strong{Option} @tab @strong{Description}
@item @code{SQL_CACHE}
 @tab If @code{QUERY_CACHE_TYPE} is @code{DEMAND}, allow the query to be cached.
 If @code{QUERY_CACHE_TYPE} is @code{ON}, this is the default.
 If @code{QUERY_CACHE_TYPE} is @code{OFF}, do nothing.
@item @code{SQL_NO_CACHE}
 @tab Make this query non-cachable, don't allow this query to be stored in the cache.
@end multitable


@node Query Cache Status and Maintenance,  , Query Cache in SELECT, Query Cache
@subsection Query Cache Status and Maintenance

@c help_category Administration

@c description_for_help_topic FLUSH QUERY CACHE  CACHE QUERY FLUSH RESET
With the @code{FLUSH QUERY CACHE} command you can defragment the query
cache to better utilize its memory. This command will not remove any
queries from the cache.
@code{FLUSH TABLES} also flushes the query cache.

The @code{RESET QUERY CACHE} command removes all query results from the
query cache.
@c end_description_for_help_topic
You can check whether the query cache is present in your MySQL version:

@example
mysql> SHOW VARIABLES LIKE 'have_query_cache';
+------------------+-------+
| Variable_name    | Value |
+------------------+-------+
| have_query_cache | YES   |
+------------------+-------+
1 row in set (0.00 sec)
@end example

You can monitor query cache performance in @code{SHOW STATUS}:

@multitable @columnfractions .30 .50
@item @strong{Variable} @tab @strong{Description}
@item @code{Qcache_queries_in_cache}
 @tab Number of queries registered in the cache.
@item @code{Qcache_inserts}
 @tab Number of queries added to the cache.
@item @code{Qcache_hits}
 @tab Number of cache hits.
@item @code{Qcache_lowmem_prunes}
 @tab Number of queries that were deleted from cache because of low memory.
@item @code{Qcache_not_cached}
 @tab Number of non-cached queries
 (not cachable, or due to @code{QUERY_CACHE_TYPE}).
@item @code{Qcache_free_memory}
 @tab Amount of free memory for query cache.
@item @code{Qcache_free_blocks}
 @tab Number of free memory blocks in query cache.
@item @code{Qcache_total_blocks}
 @tab Total number of blocks in query cache.
@end multitable

Total number of queries =
@code{Qcache_inserts} + @code{Qcache_hits} + @code{Qcache_not_cached}.

The query cache uses variable length blocks, so @code{Qcache_total_blocks}
and @code{Qcache_free_blocks} may indicate query cache memory fragmentation.
After @code{FLUSH QUERY CACHE} only a single (big) free block remains.

Note: Every query needs a minimum of two blocks (one for the query text
and one or more for the query results). Also, every table that is used
by a query needs one block, but if two or more queries use same table
only one block needs to be allocated.

You can use the @code{Qcache_lowmem_prunes} status variable to tune the query
cache size. It counts the number of queries that have been removed from the
cache to free up memory for caching new queries. The query cache uses a
@code{least recently used} (@code{LRU}) strategy to decide which queries to
remove from the cache.


@node Table types, MaxDB, SQL Syntax, Top
@chapter MySQL Table Types

@cindex table types, choosing
@cindex @code{BDB} table type
@cindex @code{BerkeleyDB} table type
@cindex @code{HEAP} table type
@cindex @code{ISAM} table type
@cindex @code{InnoDB} table type
@cindex @code{MERGE} table type
@cindex MySQL table types
@cindex @code{MyISAM} table type
@cindex types, of tables

@c We should update this listing. Note that ISAM is deprecated,
@c update the version number, list InnoDB as one of the preferred table 
@c types and include DYNAMIC and MERGE type tables. Perhaps when 4.0 goes
@c production would be the best time to do this?

As of MySQL Version 3.23.6, you can choose between three basic
table formats (@code{ISAM}, @code{HEAP} and @code{MyISAM}).  Newer
versions of MySQL support additional table types (@code{InnoDB},
or @code{BDB}), depending on how you compile it. A database may contain
tables of different types.

When you create a new table, you can tell MySQL what type of table to create.
The default table type is usually @code{MyISAM}.

@c We should consider removing this or making a new section 'What happens when a
@c table is created'. Currently it seems a bit out of place and not that
@c helpful.

MySQL will always create a @file{.frm} file to hold the table and column
definitions. The table's index and data will be stored in one or more other
files, depending on the table type.

If you try to use a table type that is not compiled-in or activated,
MySQL will instead create a table of type @code{MyISAM}.  This behavior
is convenient when you want to copy tables between MySQL servers that
support different table types. (Perhaps your master server supports
transactional storage engines for increased safety, while the slave servers use
only non-transactional storage engines for greater speed.)

This automatic change of table types can be confusing for new MySQL users.  We
plan to fix this by introducing warnings in the new client/server protocol in
version 4.1 and generating a warning when a table type is automatically changed.

You can convert tables between different types with the @code{ALTER
TABLE} statement. @xref{ALTER TABLE, , @code{ALTER TABLE}}.

Note that MySQL supports two different kinds of
tables: transaction-safe tables (@code{InnoDB} and @code{BDB})
and not transaction-safe tables (@code{HEAP}, @code{ISAM},
@code{MERGE}, and @code{MyISAM}).

Advantages of transaction-safe tables (TST):

@itemize @bullet
@item
Safer. Even if MySQL crashes or you get hardware problems, you
can get your data back, either by automatic recovery or from a backup
+ the transaction log.
@item
You can combine many statements and accept these all in one go with
the @code{COMMIT} command.
@item
You can execute @code{ROLLBACK} to ignore your changes (if you are not
running in auto-commit mode).
@item
If an update fails, all your changes will be restored. (With NTST tables all
changes that have taken place are permanent)
@item
Can provide better concurrency if the table gets many updates concurrently
with reads.
@end itemize

Note that to use @code{InnoDB} tables you have to use at least the
@code{innodb_data_file_path} startup option. @xref{InnoDB start}.

Advantages of not transaction-safe tables (NTST):

@itemize @bullet
@item
Much faster as there is no transaction overhead.
@item
Will use less disk space as there is no overhead of transactions.
@item
Will use less memory to do updates.
@end itemize

You can combine TST and NTST tables in the same statements to get the best
of both worlds.

@menu
* MyISAM::                      @code{MyISAM} Tables
* MERGE::                       @code{MERGE} Tables
* HEAP::                        @code{HEAP} Tables
* InnoDB::                      @code{InnoDB} Tables
* BDB::                         @code{BDB} or @code{BerkeleyDB} Tables
* ISAM::                        @code{ISAM} Tables
@end menu


@node MyISAM, MERGE, Table types, Table types
@section @code{MyISAM} Tables

@code{MyISAM} is the default table type in MySQL Version 3.23. It's
based on the @code{ISAM} code and has a lot of useful extensions.

The index is stored in a file with the @file{.MYI} (MYIndex) extension,
and the data is stored in a file with the @file{.MYD} (MYData) extension.
You can check/repair @code{MyISAM} tables with the @code{myisamchk}
utility. @xref{Crash recovery}. You can compress @code{MyISAM} tables with
@code{myisampack} to take up much less space.
@xref{myisampack, , @code{myisampack}}.

The following is new in @code{MyISAM}:

@itemize @bullet
@item
There is a flag in the @code{MyISAM} file that indicates whether
the table was closed correctly.  If @code{mysqld} is started with
@code{--myisam-recover}, @code{MyISAM} tables are automatically
checked and/or repaired on open if the table wasn't closed properly.
@item
You can @code{INSERT} new rows in a table that doesn't have free blocks
in the middle of the datafile, at the same time other threads are
reading from the table (concurrent insert).  A free block can come from
an update of a dynamic length row with much data to a row with less data
or when deleting rows. When all free blocks are used up, all future
inserts will be concurrent again.
@item
Support for big files (63-bit) on filesystems/operating systems that
support big files.
@item
All data is stored with the low byte first. This makes the data machine
and OS independent. The only requirement for binary portability
is that the machine uses
two's-complement signed integers (as every machine for the last 20 years
has) and IEEE floating-point format (also totally dominant among
mainstream machines). The only area of machines that may not support
binary compatibility are embedded systems (because they sometimes have
peculiar processors).

There is no big speed penalty in storing data low byte first; the bytes
in a table row is normally unaligned and it doesn't take that much more
power to read an unaligned byte in order than in reverse order.  The
actual fetch-column-value code is also not time critical compared to
other code.
@item
All number keys are stored with high byte first to give better index
compression.
@item
Internal handling of one @code{AUTO_INCREMENT} column. @code{MyISAM}
will automatically update this on @code{INSERT/UPDATE}. The
@code{AUTO_INCREMENT} value can be reset with @code{myisamchk}. This
will make @code{AUTO_INCREMENT} columns faster (at least 10%) and old
numbers will not be reused as with the old @code{ISAM}. Note that when an
@code{AUTO_INCREMENT} is defined on the end of a multi-part-key the old
behavior is still present.
@item
When inserted in sorted order (as when you are using an @code{AUTO_INCREMENT}
column) the key tree will be split so that the high node only contains one
key. This will improve the space utilization in the key tree.
@item
@code{BLOB} and @code{TEXT} columns can be indexed.
@item
@code{NULL} values are allowed in indexed columns.  This takes 0-1
bytes/key.
@item
Maximum key length is 500 bytes by default (can be changed by
recompiling).  In cases of keys longer than 250 bytes, a bigger key
block size than the default of 1024 bytes is used for this key.
@item
Maximum number of keys/table is 32 as default. This can be enlarged to 64
without having to recompile @code{myisamchk}.
@item
@code{myisamchk} will mark tables as checked if one runs it with
@code{--update-state}. @code{myisamchk --fast} will check only those
tables that don't have this mark.
@item
@code{myisamchk -a} stores statistics for key parts (and not only for
whole keys as in @code{ISAM}).
@item
Dynamic size rows will now be much less fragmented when mixing deletes
with updates and inserts.  This is done by automatically combining adjacent
deleted blocks and by extending blocks if the next block is deleted.
@item
@code{myisampack} can pack @code{BLOB} and @code{VARCHAR} columns.
@item
You can use put the datafile and index file on different directories
to get more speed (with the @code{DATA/INDEX DIRECTORY="path"} option to
@code{CREATE TABLE}). @xref{CREATE TABLE}.
@end itemize

@code{MyISAM} also supports the following things, which MySQL
will be able to use in the near future:

@itemize @bullet
@item
Support for a true @code{VARCHAR} type; a @code{VARCHAR} column starts
with a length stored in 2 bytes.
@item
Tables with @code{VARCHAR} may have fixed or dynamic record length.
@item
@code{VARCHAR} and @code{CHAR} may be up to 64K.
All key segments have their own language definition. This will enable
MySQL to have different language definitions per column.
@item
A hashed computed index can be used for @code{UNIQUE}. This will allow
you to have @code{UNIQUE} on any combination of columns in a table. (You
can't search on a @code{UNIQUE} computed index, however.)
@end itemize

Note that index files are usually much smaller with @code{MyISAM} than with
@code{ISAM}. This means that @code{MyISAM} will normally use less
system resources than @code{ISAM}, but will need more CPU time when inserting
data into a compressed index.

The following options to @code{mysqld} can be used to change the behavior of
@code{MyISAM} tables. @xref{SHOW VARIABLES}.

@multitable @columnfractions .40 .60
@item @strong{Option} @tab @strong{Description}
@item @code{--myisam-recover=#} @tab Automatic recovery of crashed tables.
@item @code{-O myisam_sort_buffer_size=#} @tab Buffer used when recovering tables.
@item @code{--delay-key-write=ALL} @tab Don't flush key buffers between writes for any MyISAM table
@item @code{-O myisam_max_extra_sort_file_size=#} @tab Used to help MySQL to decide when to use the slow but safe key cache index create method. @strong{Note} that this parameter is given in megabytes before 4.0.3 and in bytes beginning with this version.
@item @code{-O myisam_max_sort_file_size=#} @tab Don't use the fast sort index method to created index if the temporary file would get bigger than this.  @strong{Note} that this parameter is given in megabytes before 4.0.3 and in bytes beginning with this version.
@item @code{-O bulk_insert_buffer_size=#} @tab Size of tree cache used in bulk insert optimization. @strong{Note} that this is a limit @strong{per thread}!
@end multitable

The automatic recovery is activated if you start @code{mysqld} with
@code{--myisam-recover=#}. @xref{Server options}.
On open, the table is checked if it's marked as crashed or if the open
count variable for the table is not 0 and you are running with
@code{--skip-external-locking}.  If either of the above is true the following
happens.

@itemize @bullet
@item
The table is checked for errors.
@item
If we found an error, try to do a fast repair (with sorting and without
re-creating the datafile) of the table.
@item
If the repair fails because of an error in the datafile (for example a
duplicate key error), we try again, but this time we re-create the datafile.
@item
If the repair fails, retry once more with the old repair option method
(write row by row without sorting) which should be able to repair any
type of error with little disk requirements..
@end itemize

If the recover wouldn't be able to recover all rows from a previous
completed statement and you didn't specify @code{FORCE} as an option to
@code{myisam-recover}, then the automatic repair will abort with an error
message in the error file:

@example
Error: Couldn't repair table: test.g00pages
@end example

If you in this case had used the @code{FORCE} option you would instead have got
a warning in the error file:

@example
Warning: Found 344 of 354 rows when repairing ./test/g00pages
@end example

Note that if you run automatic recovery with the @code{BACKUP} option,
you should have a @code{cron} script that automatically moves file with names
like @file{tablename-datetime.BAK} from the database directories to a
backup media.

@xref{Server options}.

@menu
* Key space::                   Space Needed for Keys
* MyISAM table formats::        @code{MyISAM} Table Formats
* MyISAM table problems::       @code{MyISAM} Table Problems
@end menu


@node Key space, MyISAM table formats, MyISAM, MyISAM
@subsection Space Needed for Keys

@cindex key space, MyISAM

MySQL can support different index types, but the normal type is
ISAM or MyISAM.  These use a B-tree index, and you can roughly calculate
the size for the index file as @code{(key_length+4)/0.67}, summed over
all keys.  (This is for the worst case when all keys are inserted in
sorted order and we don't have any compressed keys.)

String indexes are space compressed. If the first index part is a
string, it will also be prefix compressed.  Space compression makes the
index file smaller than the above figures if the string column has a lot
of trailing space or is a @code{VARCHAR} column that is not always used
to the full length. Prefix compression is used on keys that start
with a string.  Prefix compression helps if there are many strings
with an identical prefix.

In @code{MyISAM} tables, you can also prefix compress numbers by specifying
@code{PACK_KEYS=1} when you create the table.  This helps when you have
many integer keys that have an identical prefix when the numbers are stored
high-byte first.


@node MyISAM table formats, MyISAM table problems, Key space, MyISAM
@subsection @code{MyISAM} Table Formats

@code{MyISAM} supports 3 different table types. Two of them are chosen
automatically depending on the type of columns you are using. The third,
compressed tables, can only be created with the @code{myisampack} tool.

When you @code{CREATE} or @code{ALTER} a table that doesn't have
@code{BLOB} values, you can force the table format to @code{DYNAMIC} or
@code{FIXED} with the @code{ROW_FORMAT=#} table option.  In the future
you will be able to compress/decompress tables by specifying
@code{ROW_FORMAT=compressed | default} to @code{ALTER TABLE}.
@xref{CREATE TABLE}.

@menu
* Static format::               Static (Fixed-length) Table Characteristics
* Dynamic format::              Dynamic Table Characteristics
* Compressed format::           Compressed Table Characteristics
@end menu


@node Static format, Dynamic format, MyISAM table formats, MyISAM table formats
@subsubsection Static (Fixed-length) Table Characteristics

This is the default format. It's used when the table contains no
@code{VARCHAR}, @code{BLOB}, or @code{TEXT} columns.

This format is the simplest and most secure format. It is also the
fastest of the on-disk formats. The speed comes from the easy way data
can be found on disk. When looking up something with an index and static
format it is very simple. Just multiply the row number by the row length.

Also, when scanning a table it is very easy to read a constant number of
records with each disk read.

The security is evidenced if your computer crashes when writing to a
fixed-size MyISAM file, in which case @code{myisamchk} can easily figure out where each
row starts and ends. So it can usually reclaim all records except the
partially written one. Note that in MySQL all indexes can always be
reconstructed:

@itemize @bullet
@item
All @code{CHAR}, @code{NUMERIC}, and @code{DECIMAL} columns are space-padded
to the column width.
@item
Very quick.
@item
Easy to cache.
@item
Easy to reconstruct after a crash, because records are located in fixed
positions.
@item
Doesn't have to be reorganized (with @code{myisamchk}) unless a huge number of
records are deleted and you want to return free disk space to the operating
system.
@item
Usually requires more disk space than dynamic tables.
@end itemize


@node Dynamic format, Compressed format, Static format, MyISAM table formats
@subsubsection Dynamic Table Characteristics

@cindex dynamic table characteristics
@cindex tables, dynamic

This format is used if the table contains any @code{VARCHAR}, @code{BLOB},
or @code{TEXT} columns or if the table was created with
@code{ROW_FORMAT=dynamic}.

This format is a little more complex because each row has to have a header
that says how long it is. One record can also end up at more than one
location when it is made longer at an update.

@cindex tables, defragment
You can use @code{OPTIMIZE table} or @code{myisamchk} to defragment a
table. If you have static data that you access/change a lot in the same
table as some @code{VARCHAR} or @code{BLOB} columns, it might be a good
idea to move the dynamic columns to other tables just to avoid
fragmentation:

@itemize @bullet
@item
All string columns are dynamic (except those with a length less than 4).
@item
Each record is preceded by a bitmap indicating which columns are empty
(@code{''}) for string columns, or zero for numeric columns. (This isn't
the same as columns containing @code{NULL} values.) If a string column
has a length of zero after removal of trailing spaces, or a numeric
column has a value of zero, it is marked in the bit map and not saved to
disk.  Non-empty strings are saved as a length byte plus the string
contents.
@item
Usually takes much less disk space than fixed-length tables.
@item
Each record uses only as much space as is required. If a record becomes
larger, it is split into as many pieces as are required.  This results in record
fragmentation.
@item
If you update a row with information that extends the row length, the
row will be fragmented.  In this case, you may have to run @code{myisamchk
-r} from time to time to get better performance.  Use @code{myisamchk -ei
tbl_name} for some statistics.
@item
Not as easy to reconstruct after a crash, because a record may be fragmented
into many pieces and a link (fragment) may be missing.
@item
The expected row length for dynamic sized records is:

@example
3
+ (number of columns + 7) / 8
+ (number of char columns)
+ packed size of numeric columns
+ length of strings
+ (number of NULL columns + 7) / 8
@end example

There is a penalty of 6 bytes for each link. A dynamic record is linked
whenever an update causes an enlargement of the record. Each new link will be
at least 20 bytes, so the next enlargement will probably go in the same link.
If not, there will be another link. You may check how many links there are
with @code{myisamchk -ed}. All links may be removed with @code{myisamchk -r}.
@end itemize


@node Compressed format,  , Dynamic format, MyISAM table formats
@subsubsection Compressed Table Characteristics

@cindex tables, compressed format
@cindex compressed tables
@cindex MyISAM, compressed tables
@cindex @code{myisampack}

This is a read-only type that is generated with the optional
@code{myisampack} tool (@code{pack_isam} for @code{ISAM} tables):

@itemize @bullet
@item
All MySQL distributions, even those that existed before MySQL
went @code{GPL}, can read tables that were compressed with @code{myisampack}.
@item
Compressed tables take very little disk space. This minimises disk usage, which
is very nice when using slow disks (such as CD-ROMs).
@item
Each record is compressed separately (very little access overhead).  The
header for a record is fixed (1-3 bytes) depending on the biggest record in the
table.  Each column is compressed differently. Some of the compression types
are:
@itemize @minus
@item
There is usually a different Huffman table for each column.
@item
Suffix space compression.
@item
Prefix space compression.
@item
Numbers with value @code{0} are stored using 1 bit.
@item
If values in an integer column have a small range, the column is stored using
the smallest possible type. For example, a @code{BIGINT} column (8 bytes) may
be stored as a @code{TINYINT} column (1 byte) if all values are in the range
@code{0} to @code{255}.
@item
If a column has only a small set of possible values, the column type is
converted to @code{ENUM}.
@item
A column may use a combination of the above compressions.
@end itemize
@item
Can handle fixed- or dynamic-length records.
@item
Can be uncompressed with @code{myisamchk}.
@end itemize


@node MyISAM table problems,  , MyISAM table formats, MyISAM
@subsection @code{MyISAM} Table Problems

The file format that MySQL uses to store data has been extensively
tested, but there are always circumstances that may cause database tables
to become corrupted.

@menu
* Corrupted MyISAM tables::     Corrupted @code{MyISAM} Tables
* MyISAM table close::          Clients is using or hasn't closed the table properly
@end menu


@node Corrupted MyISAM tables, MyISAM table close, MyISAM table problems, MyISAM table problems
@subsubsection Corrupted @code{MyISAM} Tables

Even if the MyISAM table format is very reliable (all changes to a table
is written before the SQL statements returns) , you can still get
corrupted tables if some of the following things happens:

@itemize @bullet
@item
The @code{mysqld} process being killed in the middle of a write.
@item
Unexpected shutdown of the computer (for example, if the computer is turned
off).
@item
A hardware error.
@item
You are using an external program (such as @code{myisamchk}) on a live table.
@item
A software bug in the MySQL or MyISAM code.
@end itemize

Typial typical symptoms for a corrupt table is:

@itemize @bullet
@item
You get the error @code{Incorrect key file for table: '...'. Try to repair it}
while selecting data from the table.
@item
Queries doesn't find rows in the table or returns incomplete data.
@end itemize

You can check if a table is ok with the command @code{CHECK
TABLE}. @xref{CHECK TABLE}.

You can repair a corrupted table with @code{REPAIR TABLE}. @xref{REPAIR TABLE}.
You can also repair a table, when @code{mysqld} is not running with
the @code{myisamchk} command. @code{myisamchk syntax}.

If your tables get corrupted a lot you should try to find the reason for
this! @xref{Crashing}.

In this case the most important thing to know is if the table got
corrupted if the @code{mysqld} died (one can easily verify this by
checking if there is a recent row @code{restarted mysqld} in the mysqld
error file).  If this isn't the case, then you should try to make a test
case of this.  @xref{Reproduceable test case}.


@node MyISAM table close,  , Corrupted MyISAM tables, MyISAM table problems
@subsubsection Clients is using or hasn't closed the table properly

Each @code{MyISAM} @file{.MYI} file has in the header a counter that can
be used to check if a table has been closed properly.

If you get the following warning from @code{CHECK TABLE} or @code{myisamchk}:

@example
# clients is using or hasn't closed the table properly
@end example

this means that this counter has come out of sync.  This doesn't mean
that the table is corrupted, but means that you should at least do a
check on the table to verify that it's okay.

The counter works as follows:

@itemize @bullet
@item
The first time a table is updated in MySQL, a counter in the
header of the index files is incremented.
@item
The counter is not changed during further updates.
@item
When the last instance of a table is closed (because of a @code{FLUSH} or
because there isn't room in the table cache) the counter is
decremented if the table has been updated at any point.
@item
When you repair the table or check the table and it was okay,
the counter is reset to 0.
@item
To avoid problems with interaction with other processes that may do a
check on the table, the counter is not decremented on close if it was 0.
@end itemize

In other words, the only ways this can go out of sync are:

@itemize @bullet
@item
The @code{MyISAM} tables are copied without a @code{LOCK} and
@code{FLUSH TABLES}.
@item
MySQL has crashed between an update and the final close.
(Note that the table may still be okay, as MySQL always issues writes
for everything between each statement.)
@item
Someone has done a @code{myisamchk --recover} or @code{myisamchk
--update-state}on a table that was in use by @code{mysqld}.
@item
Many @code{mysqld} servers are using the table and one has done a
@code{REPAIR} or @code{CHECK} of the table while it was in use by
another server.  In this setup the @code{CHECK} is safe to do (even if
you will get the warning from other servers), but @code{REPAIR} should
be avoided as it currently replaces the datafile with a new one, which
is not signaled to the other servers.
@end itemize


@node MERGE, HEAP, MyISAM, Table types
@section @code{MERGE} Tables

@cindex tables, merging
@cindex MERGE tables, defined
@cindex tables, partitioning
@c description_for_help_topic MERGE
@code{MERGE} tables were introduced in MySQL Version 3.23.25. The code
is now reasonably stable.

A @code{MERGE} table (also known as a @code{MRG_MyISAM} table) is a
collection of identical @code{MyISAM} tables that can be used as one.
You can only @code{SELECT}, @code{DELETE}, and @code{UPDATE} from the
collection of tables.  If you @code{DROP} the @code{MERGE} table, you
are only dropping the @code{MERGE} specification.
@c end_description_for_help_topic

Note that @code{DELETE FROM merge_table} used without a @code{WHERE}
will clear only the mapping for the table, not delete everything in the
mapped tables. (We plan to fix this in 4.1).

With identical tables we mean that all tables are created with identical
column and key information.  You can't merge tables in which the
columns are packed differently, doesn't have exactly the same columns,
or have the keys in different order.  However, some of the tables can be
compressed with @code{myisampack}.  @xref{myisampack, , @code{myisampack}}.

When you create a @code{MERGE} table, you will get a @file{.frm} table
definition file and a @file{.MRG} table list file.  The @file{.MRG} just
contains a list of the index files (@file{.MYI} files) that should
be used as one.  Before 4.1.1 all used tables had to be in the same
database as the @code{MERGE} table itself.

For the moment, you need to have @code{SELECT}, @code{UPDATE}, and
@code{DELETE} privileges on the tables you map to a @code{MERGE} table.

@code{MERGE} tables can help you solve the following problems:

@itemize @bullet
@item
Easily manage a set of log tables. For example, you can put data from
different months into separate files, compress some of them with
@code{myisampack}, and then create a @code{MERGE} to use these as one.
@item
Give you more speed. You can split a big read-only table based on some
criteria and then put the different table part on different disks.
A @code{MERGE} table on this could be much faster than using
the big table. (You can also use a RAID to get the same
kind of benefits.)
@item
Do more efficient searches. If you know exactly what you are looking
after, you can search in just one of the split tables for some queries
and use a @code{MERGE} table for others.  You can even have many
different @code{MERGE} tables active, with possible overlapping files.
@item
More efficient repairs. It's easier to repair the individual files that
are mapped to a @code{MERGE} file than trying to repair a really big file.
@item
Instant mapping of many files as one. A @code{MERGE} table uses the
index of the individual tables. It doesn't need to maintain an index of
its one.  This makes @code{MERGE} table collections VERY fast to make or
remap.  Note that you must specify the key definitions when you create
a @code{MERGE} table!.
@item
If you have a set of tables that you join to a big table on demand or
batch, you should instead create a @code{MERGE} table on them on demand.
This is much faster and will save a lot of disk space.
@item
Go around the file-size limit for the operating system.
@item
You can create an alias/synonym for a table by just using @code{MERGE}
over one table. There shouldn't be any really notable performance
impacts of doing this (only a couple of indirect calls and @code{memcpy()}
calls for each read).
@end itemize

The disadvantages with @code{MERGE} tables are:

@itemize @bullet
@item
You can only use identical @code{MyISAM} tables for a @code{MERGE} table.
@item
@code{REPLACE} doesn't work.
@item
@code{MERGE} tables uses more file descriptors. If you are using a
@code{MERGE} table that maps over 10 tables and 10 users are using this, you
are using 10*10 + 10 file descriptors.  (10 datafiles for 10 users
and 10 shared index files.)
@item
Key reads are slower. When you do a read on a key, the @code{MERGE}
storage engine will need to issue a read on all underlying tables to check
which one most closely matches the given key.  If you then do a "read-next"
then the @code{MERGE} storage engine will need to search the read buffers
to find the next key. Only when one key buffer is used up, the storage engine
will need to read the next key block. This makes @code{MERGE} keys much slower
on @code{eq_ref} searches, but not much slower on @code{ref} searches.
@xref{EXPLAIN}.
@item
You can't do
@code{DROP TABLE},
@code{ALTER TABLE},
@code{DELETE FROM table_name} without a @code{WHERE} clause,
@code{REPAIR TABLE},
@code{TRUNCATE TABLE},
@code{OPTIMIZE TABLE}, or
@code{ANALYZE TABLE}
on any of the table that is
mapped by a @code{MERGE} table that is "open".  If you do this, the
@code{MERGE} table may still refer to the original table and you will
get unexpected results. The easiest way to get around this deficiency
is to issue the @code{FLUSH TABLES} command, ensuring no @code{MERGE}
tables remain "open".
@end itemize

When you create a @code{MERGE} table you have to specify with
@code{UNION=(list-of-tables)} which tables you want to use as
one. Optionally you can specify with @code{INSERT_METHOD} if you want
insert for the @code{MERGE} table to happen in the first or last table
in the @code{UNION} list. If you don't specify @code{INSERT_METHOD} or
specify @code{NO}, then all @code{INSERT} commands on the @code{MERGE}
table will return an error.

The following example shows you how to use @code{MERGE} tables:

@c example_for_help_topic MERGE
@example
CREATE TABLE t1 (a INT NOT NULL AUTO_INCREMENT PRIMARY KEY, message CHAR(20));
CREATE TABLE t2 (a INT NOT NULL AUTO_INCREMENT PRIMARY KEY, message CHAR(20));
INSERT INTO t1 (message) VALUES ("Testing"),("table"),("t1");
INSERT INTO t2 (message) VALUES ("Testing"),("table"),("t2");
CREATE TABLE total (a INT NOT NULL AUTO_INCREMENT, message CHAR(20), KEY(a))
             TYPE=MERGE UNION=(t1,t2) INSERT_METHOD=LAST;
SELECT * FROM total;
@end example

Note that we didn't create a @code{UNIQUE} or @code{PRIMARY KEY} in the
@code{total} table as the key isn't going to be unique in the @code{total}
table.

Note that you can also manipulate the @file{.MRG} file directly from
the outside of the MySQL server:

@example
shell> cd /mysql-data-directory/current-database
shell> ls -1 t1.MYI t2.MYI > total.MRG
shell> mysqladmin flush-tables
@end example

Now you can do things like:

@example
mysql> SELECT * FROM total;
+---+---------+
| a | message |
+---+---------+
| 1 | Testing |
| 2 | table   |
| 3 | t1      |
| 1 | Testing |
| 2 | table   |
| 3 | t2      |
+---+---------+
@end example

Note that the @code{a} column, though declared as @code{PRIMARY KEY},
is not really unique, as @code{MERGE} table cannot enforce uniqueness
over a set of underlying @code{MyISAM} tables.

To remap a @code{MERGE} table you can do one of the following:

@itemize @bullet
@item
@code{DROP} the table and re-create it
@item
Use @code{ALTER TABLE table_name UNION=(...)}
@item
Change the @file{.MRG} file and issue a @code{FLUSH TABLE} on the
@code{MERGE} table and all underlying tables to force the storage engine to
read the new definition file.
@end itemize

If you use @code{ALTER TABLE} to change a @code{MERGE} table to another
table type, the mapping to the underlying tables is lost. Instead, the rows
from the underlying @code{MyISAM} tables are copied into the altered table,
which then is assigned the new type.

@menu
* MERGE table problems::        @code{MERGE} Table Problems
@end menu

@node MERGE table problems,  , MERGE, MERGE
@subsection @code{MERGE} Table Problems

The following are the known problems with @code{MERGE} tables:

@itemize @bullet
@item
A @code{MERGE} table cannot maintain @code{UNIQUE} constraints over the
whole table.  When you do @code{INSERT}, the data goes into the first or
last table (according to @code{INSERT_METHOD=xxx}) and this @code{MyISAM}
table ensures that the data are unique, but it knows nothing about
others @code{MyISAM} tables.
@item
@code{DELETE FROM merge_table} used without a @code{WHERE}
will clear only the mapping for the table, not delete everything in the
mapped tables.
@item
@code{RENAME TABLE} on a table used in an active @code{MERGE} table may
corrupt the table.  This will be fixed in MySQL 4.1.x.
@item
Creation of a table of type @code{MERGE} doesn't check if the underlying
tables are of compatible types or if they exists.  MySQL will do a quick check
if the record length is equal between mapped tables when the @code{MERGE}
table is used, but this is not a fullproof check.

If you use @code{MERGE} tables in this fashion, you are very likely to
run into strange problems.
@item
If you use @code{ALTER TABLE} to first add an @code{UNIQUE} index to a
table used in a @code{MERGE} table and then use @code{ALTER TABLE} to
add a normal index on the @code{MERGE} table, the key order will be
different for the tables if there was an old non-unique key in the
table. This is because @code{ALTER TABLE} puts @code{UNIQUE} keys before
normal keys to be able to detect duplicate keys as early as possible.
@item
@code{DROP TABLE} on a table that is in use by a @code{MERGE} table will
not work on Windows because the @code{MERGE} storage engine does the table
mapping hidden from the upper layer of MySQL.  Because Windows doesn't allow
you to drop files that are open, you first must flush all @code{MERGE}
tables (with @code{FLUSH TABLES}) or drop the @code{MERGE} table before
dropping the table.  We will fix this at the same time we introduce
views.
@end itemize

@node HEAP, InnoDB, MERGE, Table types
@section @code{HEAP} Tables

@cindex tables, @code{HEAP}

@code{HEAP} tables use hashed indexes and are stored in memory.  This
makes them very fast, but if MySQL crashes you will lose all
data stored in them.  @code{HEAP} is very useful for temporary tables!

The MySQL internal @code{HEAP} tables use 100% dynamic hashing
without overflow areas. There is no extra space needed for free lists.
@code{HEAP} tables also don't have problems with delete + inserts, which
normally is common with hashed tables:

@example
mysql> CREATE TABLE test TYPE=HEAP SELECT ip,SUM(downloads) AS down
    ->                   FROM log_table GROUP BY ip;
mysql> SELECT COUNT(ip),AVG(down) FROM test;
mysql> DROP TABLE test;
@end example

Here are some things you should consider when you use @code{HEAP} tables:

@itemize @bullet
@item
You should always use specify @code{MAX_ROWS} in the @code{CREATE} statement
to ensure that you accidentally do not use all memory.
@item
Indexes will be used only with @code{=} and @code{<=>} (but are VERY fast).
@item
@code{HEAP} tables can use only whole keys to search for a row; compare this
to @code{MyISAM} tables where any prefix of the key can be used to find rows.
@item
@code{HEAP} tables use a fixed record length format.
@item
@code{HEAP} doesn't support @code{BLOB}/@code{TEXT} columns.
@item
@code{HEAP} doesn't support @code{AUTO_INCREMENT} columns.
@item
Prior to MySQL 4.0.2, @code{HEAP} doesn't support an index on a @code{NULL}
column.
@item
You can have non-unique keys in a @code{HEAP} table (this isn't common for
hashed tables).
@item
@code{HEAP} tables are shared between all clients (just like any other
table).
@item
You can't search for the next entry in order (that is, to use the index
to do an @code{ORDER BY}).
@item
Data for @code{HEAP} tables are allocated in small blocks. The tables
are 100% dynamic (on inserting). No overflow areas and no extra key
space are needed.  Deleted rows are put in a linked list and are
reused when you insert new data into the table.
@item
You need enough extra memory for all @code{HEAP} tables that you want to use at
the same time.
@item
To free memory, you should execute @code{DELETE FROM heap_table},
@code{TRUNCATE heap_table} or @code{DROP TABLE heap_table}.
@item
MySQL cannot find out approximately how many rows there
are between two values (this is used by the range optimizer to decide which
index to use).  This may affect some queries if you change a @code{MyISAM}
table to a @code{HEAP} table.
@item
To ensure that you accidentally don't do anything foolish, you can't create
@code{HEAP} tables bigger than @code{max_heap_table_size}.
@item
If you have a hash index on a @code{HEAP} table with a high degree of key
duplication (many index entries containing the same value), updates to the
table that affect key values and all deletes will be significantly slower.
The degree of slowdown is proportional to the degree of duplication
(or, inversely proportional to the index cardinality).
As of 4.1, MySQL supports @code{BTREE} indexes on @code{HEAP} tables, which
you can use to avoid this problem.
@item
If you want to populate the @code{HEAP} table when the MySQL server starts, you
can use the @code{init-file} option for this (@pxref{Server options})
(into the file you will for example put a @code{LOAD DATA INFILE} or
@code{INSERT...SELECT} to load the table from some persistent storage
location).
@item
With replication: after the master is shutdown and restarted, the @code{HEAP}
table is empty on master; the slave is not aware of this emptiness, so will
still return out-of-date content if you issue a @code{SELECT} on the table.
But (starting from MySQL 4.0.18) when the @code{HEAP} table is used on
master for the first time since master's startup, a @code{DELETE FROM}
statement will be automatically written to the master's binary log, thus
syncing the slave. Note that even with this, between the master's restart and
the first use of the table on master, the slave still has out-of-date data in
the table. But if you use the @code{init-file} option to populate the
@code{HEAP} table on the master at startup, it ensures that the failing time
interval is zero.
@end itemize

The memory needed for one row in a @code{HEAP} table is:

@example
SUM_OVER_ALL_KEYS(max_length_of_key + sizeof(char*) * 2)
+ ALIGN(length_of_row+1, sizeof(char*))
@end example

@code{sizeof(char*)} is 4 on 32-bit machines and 8 on 64-bit machines.


@node InnoDB, BDB, HEAP, Table types
@section @code{InnoDB} Tables

@menu
* InnoDB overview::             InnoDB Tables Overview
* InnoDB in MySQL 3.23::        InnoDB in MySQL Version 3.23
* InnoDB start::                InnoDB Startup Options
* InnoDB init::                 Creating InnoDB Tablespace
* Using InnoDB tables::         Creating InnoDB Tables
* Adding and removing::         Adding and Removing InnoDB Data and Log Files
* Backing up::                  Backing up and Recovering an InnoDB Database
* Moving::                      Moving an InnoDB Database to Another Machine
* InnoDB transaction model::    InnoDB Transaction Model and Locking
* InnoDB tuning::               Performance Tuning Tips
* Implementation::              Implementation of Multi-versioning
* Table and index::             Table and Index Structures
* File space management::       File Space Management and Disk I/O
* Error handling::              Error Handling
* InnoDB restrictions::         Restrictions on InnoDB Tables
* InnoDB change history::       InnoDB Change History
* InnoDB contact information::  @code{InnoDB} Contact Information
@end menu


@node InnoDB overview, InnoDB in MySQL 3.23, InnoDB, InnoDB
@subsection InnoDB Tables Overview

@cindex transactions, support
@cindex transaction-safe tables
@cindex ACID

@code{InnoDB} provides MySQL with a transaction-safe (@code{ACID} compliant)
storage engine with commit, rollback, and crash recovery capabilities.
InnoDB does locking on row level and also provides an Oracle-style
consistent
non-locking read in @code{SELECT} statements. These features increase
multiuser concurrency and performance. There is no need for
lock escalation in @code{InnoDB},
because row level locks in InnoDB fit in very small space.
@code{InnoDB} is the first storage manager in MySQL to support
@code{FOREIGN KEY} constraints.

@code{InnoDB} has been designed for maximum performance when processing
large data volumes. Its CPU efficiency is probably not
matched by any other disk-based relational database engine.

@code{InnoDB} is used in production at numerous
large database sites requiring high performance.
The famous Internet news site Slashdot.org runs on
@code{InnoDB}. Mytrix, Inc. stores over 1 TB of data in
@code{InnoDB}, and another site handles an average
load of 800 inserts/updates per second in @code{InnoDB}.

Technically, @code{InnoDB} is a complete database backend placed under MySQL.
@code{InnoDB} has its own buffer pool for caching data and indexes in main
memory. @code{InnoDB} stores its tables and indexes in a tablespace, which
may consist of several files (or raw disk partitions).
This is different from, for example,
@code{MyISAM} tables where each table is stored as a separate file.
@code{InnoDB} tables can be of any size even on operating
systems where file-size is limited to 2 GB.

You can find the latest information about @code{InnoDB} at
@uref{http://www.innodb.com/}. The most up-to-date version of the
@code{InnoDB} manual is always placed there.

@code{InnoDB} is published under the same GNU @code{GPL} License Version 2
(of June 1991) as MySQL. If you distribute MySQL/InnoDB, and your application
does not satisfy the restrictions of the GPL license, you have to buy a
commercial
@strong{MySQL Pro} license from @uref{https://order.mysql.com/?sub=pg&pg_no=1}.


@node InnoDB in MySQL 3.23, InnoDB start, InnoDB overview, InnoDB
@subsection InnoDB in MySQL Version 3.23

From MySQL version 4.0, @code{InnoDB} is enabled by default.
The following information only applies to the 3.23 series.

InnoDB tables are included in the MySQL source distribution
starting from 3.23.34a and are activated in the MySQL -Max
binary of the 3.23 series.
For Windows, the MySQL-Max binaries are included in the
standard distribution.

If you have downloaded a binary version of MySQL that includes
support for InnoDB, simply follow the instructions of the
MySQL manual
for installing a binary version of MySQL. If you already have
MySQL-3.23 installed, then the simplest way to install
MySQL -Max is to replace the server executable @file{mysqld}
with the corresponding executable in the -Max distribution.
MySQL and MySQL -Max differ only in the server executable.
@xref{Installing binary}.
@xref{mysqld-max, , @code{mysqld-max}}.

To compile MySQL with InnoDB support,
download MySQL-3.23.34a or newer version from
@uref{http://www.mysql.com/}
and configure MySQL with the
@code{--with-innodb} option. See the
MySQL manual
about installing a MySQL source distribution.
@xref{Installing source}.

@example
cd /path/to/source/of/mysql-3.23.37
./configure --with-innodb
@end example

To use InnoDB tables in MySQL-Max-3.23 you @strong{must} specify
configuration parameters in the @code{[mysqld]} section of the
configuration file @file{my.cnf}, or on Windows optionally in
@file{my.ini}.

At the minimum, in 3.23 you must specify @code{innodb_data_file_path}
where you specify the names and the sizes of datafiles. If you do
not mention @code{innodb_data_home_dir} in @file{my.cnf} the default
is to create these files to the @code{datadir} of MySQL.
If you specify @code{innodb_data_home_dir} as an empty string,
then you can give absolute paths to your datafiles in
@code{innodb_data_file_path}.

The minimal way
to modify it is to add to the @code{[mysqld]} section the line

@example
innodb_data_file_path=ibdata:30M
@end example

but to get good performance it is best that you specify options
as recommended. @xref{InnoDB start}.


@node InnoDB start, InnoDB init, InnoDB in MySQL 3.23, InnoDB
@subsection InnoDB Startup Options

To enable @code{InnoDB} tables in MySQL version 3.23, see
@ref{InnoDB in MySQL 3.23}.

In MySQL-4.0 you are not required to do anything specific to
enable @code{InnoDB} tables.

The default behavior in MySQL-4.0 and MySQL-4.1 is to
create an auto-extending 10 MB file
@file{ibdata1} in the @code{datadir} of MySQL and
two 5 MB @file{ib_logfile} log files to the @code{datadir}.
(In MySQL-4.0.0 and 4.0.1 the datafile is 64 MB and not auto-extending.)

@strong{Note:} To get good performance you @strong{should} explicitly
set the InnoDB parameters listed in the following examples.

If you don't want to use @code{InnoDB} tables, you can add the
@code{skip-innodb} option to your MySQL option file.

Starting from versions 3.23.50 and 4.0.2, @code{InnoDB} allows the last
datafile on the @code{innodb_data_file_path} line
to be specified as @strong{auto-extending}. The syntax for
@code{innodb_data_file_path} is then the following:
@example
pathtodatafile:sizespecification;pathtodatafile:sizespecification;...
...  ;pathtodatafile:sizespecification[:autoextend[:max:sizespecification]]
@end example
If you specify the last datafile with the @code{autoextend} option,
@code{InnoDB}
will extend the last datafile if it runs out of free space in the
tablespace. The increment is 8 MB at a time. An example:
@example
innodb_data_home_dir =
innodb_data_file_path = /ibdata/ibdata1:100M:autoextend
@end example
instructs @code{InnoDB} to create just a single datafile whose initial size is
100 MB and which is extended in 8 MB blocks when space runs out.
If the disk becomes full you may want to add another datafile
to another disk, for example. Then you have to look at the size
of @file{ibdata1}, round the size downward to
the closest multiple of 1024 * 1024 bytes (= 1 MB), and specify
the rounded size of @file{ibdata1} explicitly in
@code{innodb_data_file_path}.
After that you can add another datafile:
@example
innodb_data_home_dir =
innodb_data_file_path = /ibdata/ibdata1:988M;/disk2/ibdata2:50M:autoextend
@end example
Be cautious on filesystems where the maximum file-size is 2 GB.
InnoDB is not aware of the OS maximum file-size. On those filesystems
you might want to specify the max size for the datafile:
@example
innodb_data_home_dir =
innodb_data_file_path = /ibdata/ibdata1:100M:autoextend:max:2000M
@end example

@strong{A simple @file{my.cnf} example.} Suppose you have a computer
with 128 MB RAM and one hard disk. Below is an example of
possible configuration parameters in @file{my.cnf} or
@file{my.ini} for InnoDB. We assume you are running
MySQL-Max-3.23.50 or later, or MySQL-4.0.2 or later.
This example suits most users, both on Unix and Windows,
who do not want to distribute InnoDB datafiles and
log files on several disks. This creates an
auto-extending datafile @file{ibdata1} and two InnoDB log files
@file{ib_logfile0} and @file{ib_logfile1} to the
@code{datadir} of MySQL (typically @file{/mysql/data}).
Also the small archived InnoDB log file
@file{ib_arch_log_0000000000} ends up in the @code{datadir}. 

@example
[mysqld]
# You can write your other MySQL server options here
# ...
#                                  Datafile(s) must be able to
#                                  hold your data and indexes.
#                                  Make sure you have enough
#                                  free disk space.
innodb_data_file_path = ibdata1:10M:autoextend
#                                  Set buffer pool size to
#                                  50 - 80 % of your computer's
#                                  memory
set-variable = innodb_buffer_pool_size=70M
set-variable = innodb_additional_mem_pool_size=10M
#                                  Set the log file size to about
#                                  25 % of the buffer pool size
set-variable = innodb_log_file_size=20M
set-variable = innodb_log_buffer_size=8M
#                                  Set ..flush_log_at_trx_commit
#                                  to 0 if you can afford losing
#                                  some last transactions 
innodb_flush_log_at_trx_commit=1
@end example

@strong{Check that the MySQL server has the rights to create files} in
@code{datadir}. 

Note that datafiles must be < 2 GB in some file systems!
The combined size of the log files must be < 4 GB. The combined
size of datafiles must be >= 10 MB.

When you for the first time create an InnoDB database, it is
best that you start the MySQL server from the command prompt.
Then InnoDB will print the information about the database
creation to the screen, and you see what is happening.
See below next section what the printout should look like.
For example, in Windows you can start @file{mysqld-max.exe} with: 

@example
your-path-to-mysqld\mysqld-max --console
@end example

@strong{Where to put @file{my.cnf} or @file{my.ini} in Windows?}
The rules for Windows are the following:
@itemize @bullet
@item Only one of @file{my.cnf} or @file{my.ini} should be created.
@item The @file{my.cnf} file should be placed in the root
directory of the drive @file{C:}.
@item The @file{my.ini} file should be placed in the WINDIR directory, e.g,
@file{C:\WINDOWS} or @file{C:\WINNT}. You can use the @code{SET}
command of MS-DOS to print the value of WINDIR.
@item  If your PC uses a boot loader where the @file{C:} drive
is not the boot drive, then your only option is to use the @file{my.ini} file.
@end itemize

@strong{Where to specify options in Unix?}
On Unix @file{mysqld} reads options from the following files, if they exist,
in the following order: 
@itemize @bullet
@item @file{/etc/my.cnf}  Global options.  
@item @file{COMPILATION_DATADIR/my.cnf}  Server-specific options.  
@item @file{defaults-extra-file}  The file specified with
@code{--defaults-extra-file=...}.
@item @file{~/.my.cnf} User-specific options.
@end itemize
@file{COMPILATION_DATADIR} is the MySQL data directory which was
specified as a @code{./configure} option when @file{mysqld}
was compiled
(typically @file{/usr/local/mysql/data} for a binary installation or @file{/usr/local/var} for a source installation).

If you are not sure from where @file{mysqld} reads its @file{my.cnf}
or @file{my.ini}, you can give the path as the first command-line
option to the server:
@code{mysqld --defaults-file=your_path_to_my_cnf}.

InnoDB forms the directory path to a datafile by textually catenating
@code{innodb_data_home_dir} to a datafile name or path in
@code{innodb_data_file_path}, adding a possible slash or
backslash in between if needed. If the keyword
@code{innodb_data_home_dir} is not mentioned in
@file{my.cnf} at all, the default for it is the
'dot' directory @file{./} which means the @code{datadir} of MySQL. 

@strong{An advanced @file{my.cnf} example.} Suppose you have a Linux computer
with 2 GB RAM and three 60 GB hard disks
(at directory paths @file{/}, @file{/dr2} and
@file{/dr3}). Below is an example of possible
configuration parameters in @file{my.cnf} for InnoDB. 

@strong{Note that InnoDB does not create directories: you
have to create them yourself.} Use the Unix or MS-DOS
@code{mkdir} command to create the data and log group home directories. 

@example
[mysqld]
# You can write your other MySQL server options here
# ...
innodb_data_home_dir =
#                                  Datafiles must be able to
#                                  hold your data and indexes
innodb_data_file_path = /ibdata/ibdata1:2000M;/dr2/ibdata/ibdata2:2000M:autoextend
#                                  Set buffer pool size to
#                                  50 - 80 % of your computer's
#                                  memory, but make sure on Linux
#                                  x86 total memory usage is
#                                  < 2 GB
set-variable = innodb_buffer_pool_size=1G
set-variable = innodb_additional_mem_pool_size=20M
innodb_log_group_home_dir = /dr3/iblogs
#                                  .._log_arch_dir must be the same
#                                  as .._log_group_home_dir
innodb_log_arch_dir = /dr3/iblogs
set-variable = innodb_log_files_in_group=3
#                                  Set the log file size to about
#                                  15 % of the buffer pool size
set-variable = innodb_log_file_size=150M
set-variable = innodb_log_buffer_size=8M
#                                  Set ..flush_log_at_trx_commit to
#                                  0 if you can afford losing
#                                  some last transactions 
innodb_flush_log_at_trx_commit=1
set-variable = innodb_lock_wait_timeout=50
#innodb_flush_method=fdatasync
#set-variable = innodb_thread_concurrency=5
@end example

Note that we have placed the two datafiles on different disks.
InnoDB will fill the tablespace
formed by the datafiles from bottom up. In some cases it will
improve the performance of the database if all data is not placed
on the same physical disk. Putting log files on a different disk from
data is very often beneficial for performance.
You can also use @strong{raw disk partitions} (raw devices)
as datafiles. In some Unixes
they speed up I/O. See the manual section on InnoDB file space management 
about how to specify them in @file{my.cnf}.

@strong{Warning:} On Linux x86 you must be careful you @strong{do not set memory usage
too high}. glibc will allow the process heap to grow over thread stacks,
which will crash your server. It is a risk if the value of
@example
innodb_buffer_pool_size + key_buffer +
max_connections * (sort_buffer + read_buffer_size) + max_connections * 2 MB
@end example
is close to 2 GB or exceeds 2 GB. Each thread will use a stack
(often 2 MB, but in MySQL AB binaries only 256 KB) and in the worst case also
@code{sort_buffer + read_buffer_size}
additional memory.

@strong{How to tune other @file{mysqld} server parameters?}
Typical values which suit most users are:
@example
skip-locking
set-variable = max_connections=200
set-variable = read_buffer_size=1M
set-variable = sort_buffer=1M
#                                  Set key_buffer to 5 - 50%
#                                  of your RAM depending on how
#                                  much you use MyISAM tables, but
#                                  keep key_buffer + InnoDB
#                                  buffer pool size < 80% of
#                                  your RAM
set-variable = key_buffer=...
@end example

Note that some parameters are given using the numeric @file{my.cnf}
parameter format: @code{set-variable = innodb... = 123}, others
(string and boolean parameters) with another format:
@code{innodb_... = ... }.


The meanings of the configuration parameters are the following:

@multitable @columnfractions .35 .65
@item @strong{Option} @tab @strong{Description}
@item @code{innodb_file_per_table} @tab
Available starting from 4.1.1. This option makes InnoDB to store each
created table into its own @file{.ibd} file. See the section about
multiple tablespaces.
@item @code{innodb_open_files} @tab
Available starting from 4.1.1. This is relevant only if you use multiple
tablespaces in InnoDB. This specifies the maximum how many
@file{.ibd} files InnoDB can keep open at one time. The minimum value
for this is 10. The default is 300. Numeric @file{my.cnf} parameter format.
@item @code{innodb_data_home_dir} @tab
The common part of the directory path for all InnoDB datafiles.
If you do not mentioned this option in @file{my.cnf}
the default is the @code{datadir} of MySQL.
You can specify this also as an empty string, in which case you
can use absolute file paths in @code{innodb_data_file_path}.
@item @code{innodb_data_file_path} @tab
Paths to individual datafiles and their sizes. The full directory path
to each datafile is acquired by concatenating innodb_data_home_dir to
the paths specified here. The file sizes are specified in megabytes,
hence the 'M' after the size specification above.
InnoDB also understands the abbreviation 'G', 1 G meaning 1024 MB.
Starting from
3.23.44 you can set the file-size bigger than 4 GB on those
operating systems which support big files.
On some operating systems files must be < 2 GB.
If you do not specify @code{innodb_data_file_path}, the default
behavior starting from 4.0 is to create a 10 MB auto-extending
datafile @file{ibdata1}.
The sum of the sizes of the files must be at least 10 MB.
@item @code{innodb_mirrored_log_groups} @tab
Number of identical copies of log groups we
keep for the database. Currently this should be set to 1.
@item @code{innodb_log_group_home_dir} @tab
Directory path to InnoDB log files.
If you do not mentioned this option in @file{my.cnf}
the default is the @code{datadir} of MySQL.
@item @code{innodb_log_files_in_group} @tab
Number of log files in the log group. InnoDB writes to the files in a
circular fashion. Value 2 is recommended here. The default is 2.
@item @code{innodb_log_file_size} @tab
Size of each log file in a log group in megabytes. Sensible values range
from 1M to 1/n-th of the size of the buffer pool specified below,
where n is the number of log files in the group. The
larger the value,
the less checkpoint flush activity is needed in the buffer pool,
saving disk I/O. But larger log files also mean that recovery will be
slower in case of a crash. The combined size of log files must
be less than 4 GB on 32-bit computers.
The default is 5M.
@item @code{innodb_log_buffer_size} @tab
The size of the buffer which InnoDB uses to write log to the log files
on disk.  Sensible values range from 1M to 8M.
A big log buffer allows large transactions to run without a need
to write the log to disk until the transaction commit. Thus, if you have
big transactions, making the log buffer big will save disk I/O.
@item @code{innodb_flush_log_at_trx_commit} @tab
Normally you set this to 1, meaning that at a transaction commit, the log
is flushed to disk, and the modifications made by the transaction become
permanent, and survive a database crash. If you are willing to
compromise this safety, and you are running small transactions, you may
set this to 0 or 2 to reduce disk I/O to the logs. Value 0 means
that the log is only written to the log file and the log file flushed to
disk approximately once per second. Value 2 means the log is written
to the log file at each commit, but the log file is only flushed to
disk approximately once per second. The default value is 1 starting from
MySQL-4.0.13; previously it was 0.
@item @code{innodb_log_arch_dir} @tab
The directory where fully written log files would be archived if we used
log archiving.  The value of this parameter should currently be set the
same as @code{innodb_log_group_home_dir}.
@item @code{innodb_log_archive} @tab
This value should currently be set to 0.  As recovery from a backup is
done by MySQL using its own log files, there is currently no need to
archive InnoDB log files.
@item @code{innodb_buffer_pool_size} @tab
The size of the memory buffer InnoDB uses to cache data and indexes of
its tables.  The larger you set this, the less disk I/O is needed to
access data in tables. On a dedicated database server you may set this
parameter up to 80% of the machine physical memory size. Do not set it
too large, though, because competition of the physical memory might cause
paging in the operating system.
@item @code{innodb_buffer_pool_awe_mem_mb} @tab
Size of the buffer pool in MB, if it is placed in the AWE memory of
32-bit Windows. Available starting from 4.1.0 and only relevant in
32-bit Windows. If your 32-bit Windows operating system supports
> 4 GB memory, so-called Address Windowing Extensions, you can
allocate the InnoDB buffer pool into the AWE physical memory using
this parameter. The maximum possible value for this is 64000.
If this parameter is specified, then innodb_buffer_pool_size is
the window in the 32-bit address space of mysqld where InnoDB maps
that AWE memory. A good value for innodb_buffer_pool_size is then
500M.
@item @code{innodb_additional_mem_pool_size} @tab
Size of a memory pool InnoDB uses to store data dictionary information
and other internal data structures. A sensible value for this might be
2M, but the more tables you have in your application the more you will
need to allocate here. If InnoDB runs out of memory in this pool, it
will start to allocate memory from the operating system, and write
warning messages to the MySQL error log.
@item @code{innodb_file_io_threads} @tab
Number of file I/O threads in InnoDB. Normally, this should be 4, but
on Windows disk I/O may benefit from a larger number.
@item @code{innodb_lock_wait_timeout} @tab
Timeout in seconds an InnoDB transaction may wait for a lock before
being rolled back.  InnoDB automatically detects transaction deadlocks
in its own lock table and rolls back the transaction. If you use the
@code{LOCK TABLES} command, or other transaction-safe storage engines
than InnoDB in the same transaction, then a deadlock may arise which
InnoDB cannot notice. In cases like this the timeout is useful to
resolve the situation.
@item @code{innodb_flush_method} @tab
(Available from 3.23.40 up.)
The default value for this is @code{fdatasync}.
Another option is @code{O_DSYNC}.
@item @code{innodb_force_recovery} @tab
Warning: This option should be defined only in an emergency situation
when you want to dump your tables from a corrupt database!
Possible values are 1 - 6. See below at section 'Forcing
recovery' about the meanings of the values.
As a safety measure InnoDB prevents a user from modifying
data when this option is > 0.
This option is
available starting from version 3.23.44.
@end multitable


@node InnoDB init, Using InnoDB tables, InnoDB start, InnoDB
@subsection Creating InnoDB Tablespace

Suppose you have installed MySQL and have edited @file{my.cnf} so that
it contains the necessary InnoDB configuration parameters.
Before starting MySQL you should check that the directories you have
specified for InnoDB datafiles and log files exist and that you have
access rights to those directories. InnoDB
cannot create directories, only files. Check also you have enough disk space
for the data and log files.

When you now start MySQL, InnoDB will start creating your datafiles
and log files. InnoDB will print something like the following:

@example
~/mysqlm/sql > mysqld
InnoDB: The first specified datafile /home/heikki/data/ibdata1
did not exist:
InnoDB: a new database to be created!
InnoDB: Setting file /home/heikki/data/ibdata1 size to 134217728
InnoDB: Database physically writes the file full: wait...
InnoDB: datafile /home/heikki/data/ibdata2 did not exist:
new to be created
InnoDB: Setting file /home/heikki/data/ibdata2 size to 262144000
InnoDB: Database physically writes the file full: wait...
InnoDB: Log file /home/heikki/data/logs/ib_logfile0 did not exist:
new to be created
InnoDB: Setting log file /home/heikki/data/logs/ib_logfile0 size to 5242880
InnoDB: Log file /home/heikki/data/logs/ib_logfile1 did not exist:
new to be created
InnoDB: Setting log file /home/heikki/data/logs/ib_logfile1 size to 5242880
InnoDB: Log file /home/heikki/data/logs/ib_logfile2 did not exist:
new to be created
InnoDB: Setting log file /home/heikki/data/logs/ib_logfile2 size to 5242880
InnoDB: Started
mysqld: ready for connections
@end example

A new InnoDB database has now been created. You can connect to the MySQL
server with the usual MySQL client programs like @code{mysql}.
When you shut down the MySQL server with @file{mysqladmin shutdown},
InnoDB output will be like the following:

@example
010321 18:33:34  mysqld: Normal shutdown
010321 18:33:34  mysqld: Shutdown Complete
InnoDB: Starting shutdown...
InnoDB: Shutdown completed
@end example

You can now look at the datafiles and logs directories and you
will see the files created. The log directory will also contain
a small file named @file{ib_arch_log_0000000000}. That file
resulted from the database creation, after which InnoDB switched off
log archiving.
When MySQL is again started, the output will be like the following:

@example
~/mysqlm/sql > mysqld
InnoDB: Started
mysqld: ready for connections
@end example

@menu
* Error creating InnoDB::       If Something Goes Wrong in Database Creation
@end menu


@node Error creating InnoDB,  , InnoDB init, InnoDB init
@subsubsection If Something Goes Wrong in Database Creation

If InnoDB prints an operating system error in a file operation,
usually the problem is one of the following:

@itemize @bullet
@item You did not create InnoDB data or log directories.
@item @file{mysqld} does not have the rights to create files in those
directories.
@item @file{mysqld} does not read the right @file{my.cnf} or @file{my.ini}
file, and consequently does not see the options you specified.
@item The disk is full or a disk quota is exceeded.
@item You have created a subdirectory whose name is equal to a datafile
you specified.
@item There is a syntax error in @code{innodb_data_home_dir}
or @code{innodb_data_file_path}.
@end itemize

If something goes wrong in an InnoDB database creation, you should
delete all files created by InnoDB. This means all datafiles, all log
files, the small archived log file, and in the case you already did
create some InnoDB tables, delete also the corresponding @file{.frm}
files for these tables from the MySQL database
directories. Then you can try the InnoDB database creation again.


@node Using InnoDB tables, Adding and removing, InnoDB init, InnoDB
@subsection Creating InnoDB Tables

Suppose you have started the MySQL client with the command
@code{mysql test}.
To create a table in the InnoDB format you must specify
@code{TYPE = InnoDB} in the table creation SQL command:

@example
CREATE TABLE CUSTOMER (A INT, B CHAR (20), INDEX (A)) TYPE = InnoDB;
@end example

This SQL command will create a table and an index on column @code{A}
into the InnoDB tablespace consisting of the datafiles you specified
in @file{my.cnf}. In addition MySQL will create a file
@file{CUSTOMER.frm} to the MySQL database directory @file{test}.
Internally, InnoDB will add to its own data dictionary an entry
for table @code{'test/CUSTOMER'}. Thus you can create a table
of the same name @code{CUSTOMER} in another database of MySQL, and
the table names will not collide inside InnoDB.

You can query the amount of free space in the InnoDB tablespace
by issuing the table status command of MySQL for any table you have
created with @code{TYPE = InnoDB}. Then the amount of free
space in the tablespace appears in the table comment section in the
output of @code{SHOW}. An example:

@example
SHOW TABLE STATUS FROM test LIKE 'CUSTOMER'
@end example

Note that the statistics @code{SHOW} gives about InnoDB tables
are only approximate: they are used in SQL optimization. Table and
index reserved sizes in bytes are accurate, though.


@menu
* Converting tables to InnoDB::  Converting MyISAM Tables to InnoDB
* InnoDB foreign key constraints::  @code{FOREIGN KEY} Constraints
* Multiple tablespaces::        Multiple tablespaces - putting each table into its own .ibd file
@end menu

@node Converting tables to InnoDB, InnoDB foreign key constraints, Using InnoDB tables, Using InnoDB tables
@subsubsection Converting MyISAM Tables to InnoDB

InnoDB does not have a special optimization for separate index creation.
Therefore it does not pay to export and import the table and create indexes
afterwards.
The fastest way to alter a table to InnoDB is to do the inserts
directly to an InnoDB table, that is, use @code{ALTER TABLE ... TYPE=INNODB},
or create an empty InnoDB table with identical definitions and insert
the rows with @code{INSERT INTO ... SELECT * FROM ...}.

To get better control over the insertion process, it may be good to insert
big tables in pieces:

@example
INSERT INTO newtable SELECT * FROM oldtable
   WHERE yourkey > something AND yourkey <= somethingelse;
@end example

After all data has been inserted you can rename the tables.

During the conversion of big tables you should set the InnoDB
buffer pool size big
to reduce disk I/O. Not bigger than 80% of the physical memory, though.
You should set InnoDB log files big, and also the log buffer large.

Make sure you do not run out of tablespace: InnoDB tables take a lot
more space than MyISAM tables. If an @code{ALTER TABLE} runs out
of space, it will start a rollback, and that can take hours if it is
disk-bound.
In inserts InnoDB uses the insert buffer to merge secondary index records
to indexes in batches. That saves a lot of disk I/O. In rollback no such
mechanism is used, and the rollback can take 30 times longer than the
insertion.

In the case of a runaway rollback, if you do not have valuable data in your
database,
it is better that you kill the database process and delete all InnoDB
datafiles
and log files and all InnoDB table @file{.frm} files, and start
your job again, rather than wait for millions of disk I/Os to complete.


@node InnoDB foreign key constraints, Multiple tablespaces, Converting tables to InnoDB, Using InnoDB tables
@subsubsection @code{FOREIGN KEY} Constraints

Starting from version 3.23.43b InnoDB features foreign key constraints.
InnoDB is the first MySQL table type which allows you to define foreign key
constraints to guard the integrity of your data.

@c description_for_help_topic CONSTRAINT  FOREIGN KEY REFERENCES NO ACTION ON DELETE CASCADE SET NULL RESTRICT UPDATE
The syntax of a foreign key constraint definition in InnoDB:
@example
[CONSTRAINT [symbol]] FOREIGN KEY (index_col_name, ...)
                  REFERENCES table_name (index_col_name, ...)
                  [ON DELETE @{CASCADE | SET NULL | NO ACTION
                              | RESTRICT@}]
                  [ON UPDATE @{CASCADE | SET NULL | NO ACTION
                              | RESTRICT@}]
@end example
@c end_description_for_help_topic
Both tables have to be InnoDB type,
@strong{in the table there must be an INDEX where the foreign key columns
are listed as the FIRST columns in the same order,} and
@strong{in the referenced table there must be an INDEX where
the referenced columns are listed as the FIRST columns
in the same order.} InnoDB does not auto-create indexes on
foreign keys or referenced keys: you have to create them
explicitly. The indexes are needed for foreign key checks to be fast
and not require a table scan. 

Corresponding columns in the foreign key
and the referenced key must have similar internal datatypes
inside InnoDB so that they can be compared without a type
conversion.
The @strong{size and the signedness of integer types has to be the same}.
The length of string types need not be the same.
If you specify a @code{SET NULL} action, make sure you
have @strong{not declared the columns in the child table}
@code{NOT NULL}.

If MySQL gives the error number 1005 from a @code{CREATE TABLE}
statement, and the error message string refers to errno 150, then
the table creation failed because a foreign key constraint was not
correctly formed.
Similarly, if an @code{ALTER TABLE} fails and it refers to errno
150, that means a foreign key definition would be incorrectly
formed for the altered table. Starting from version 4.0.13,
you can use @code{SHOW INNODB STATUS} to look at a detailed explanation
of the latest InnoDB foreign key error in the server. 

Starting from version 3.23.50, InnoDB does not check foreign key
constraints on those foreign key or referenced key values
which contain a NULL column.

@strong{A deviation from SQL standards:} if in the parent table
there are several rows which have the same referenced key value,
then InnoDB acts in foreign key checks like the other parent
rows with the same key value would not exist. For example,
if you have defined a @code{RESTRICT} type constraint, and there
is a child row with several parent rows, InnoDB does not allow
the deletion of any of those parent rows. 

Starting from version 3.23.50, you can also associate the
@code{ON DELETE CASCADE} or @code{ON DELETE SET NULL} clause with
the foreign key constraint. Corresponding @code{ON UPDATE} options
are available starting from 4.0.8. If @code{ON DELETE CASCADE} is
specified, and a row in the parent table is deleted, then InnoDB
automatically deletes also all those rows in the child table
whose foreign key values are equal to the referenced key value in
the parent row. If @code{ON DELETE SET NULL} is specified, the
child rows are automatically updated so that the columns in the
foreign key are set to the SQL @code{NULL} value. 

@strong{A deviation from SQL standards:} if
@code{ON UPDATE CASCADE} or @code{ON UPDATE SET NULL} recurses to
update the SAME TABLE it has already updated during the cascade,
it acts like @code{RESTRICT}. This is to prevent infinite loops
resulting from cascaded updates. A self-referential @code{ON DELETE
SET NULL}, on the other hand, works starting from 4.0.13.
A self-referential @code{ON DELETE CASCADE} has always worked. 

An example:
@example
CREATE TABLE parent(id INT NOT NULL, PRIMARY KEY (id)) TYPE=INNODB;
CREATE TABLE child(id INT, parent_id INT, INDEX par_ind (parent_id),
             FOREIGN KEY (parent_id) REFERENCES parent(id)
             ON DELETE SET NULL
) TYPE=INNODB;
@end example

A complex example:
@c example_for_help_topic CONSTRAINT
@example
CREATE TABLE product (category INT NOT NULL, id INT NOT NULL,
                      price DECIMAL,
                      PRIMARY KEY(category, id)) TYPE=INNODB;
CREATE TABLE customer (id INT NOT NULL,
                      PRIMARY KEY (id)) TYPE=INNODB;
CREATE TABLE product_order (no INT NOT NULL AUTO_INCREMENT,
                      product_category INT NOT NULL,
                      product_id INT NOT NULL,
                      customer_id INT NOT NULL,
                      PRIMARY KEY(no),
                      INDEX (product_category, product_id),
                      FOREIGN KEY (product_category, product_id)
                        REFERENCES product(category, id)
                        ON UPDATE CASCADE ON DELETE RESTRICT,
                      INDEX (customer_id),
                      FOREIGN KEY (customer_id)
                        REFERENCES customer(id)) TYPE=INNODB;
@end example

Starting from version 3.23.50, InnoDB allows you to add a new
foreign key constraint to a table through
@example
ALTER TABLE yourtablename
ADD [CONSTRAINT [symbol]] FOREIGN KEY (...) REFERENCES anothertablename(...)
[on_delete_and_on_update_actions]
@end example
@strong{Remember to create the required indexes first}, though.

Starting from version 4.0.13, InnoDB supports 
@example
ALTER TABLE yourtablename DROP FOREIGN KEY internally_generated_foreign_key_id
@end example
You have to use @code{SHOW CREATE TABLE} to determine the internally
generated foreign key ID when you want to drop a foreign key. 
                           
In InnoDB versions < 3.23.50 @code{ALTER TABLE}
or @code{CREATE INDEX}
should not be used in connection with tables which have foreign
key constraints or which are referenced in foreign key constraints:
Any @code{ALTER TABLE} removes all foreign key
constraints defined for the table. You should not use
@code{ALTER TABLE} to the referenced table either, but
use @code{DROP TABLE} and @code{CREATE TABLE} to modify the
schema. When MySQL does an @code{ALTER TABLE} it may internally
use @code{RENAME TABLE}, and that will confuse the
foreign key costraints which refer to the table.
A @code{CREATE INDEX} statement is in MySQL
processed as an @code{ALTER TABLE}, and these
restrictions apply also to it.

When doing foreign key checks, InnoDB sets shared row
level locks on child or parent records it has to look at.
InnoDB checks foreign key constraints immediately: the check
is not deferred to transaction commit.

If you want to ignore foreign key constraints during, for example for a
@code{LOAD DATA} operation, you can do @code{SET FOREIGN_KEY_CHECKS=0}.

To make it easier to reload dump files for tables that have foreign key
relationships, @code{mysqldump} includes a statement in the dump output to set
@code{FOREIGN_KEY_CHECKS} to 0. This avoids problems with tables having to be
reloaded in a particular order when the dump is reloaded. @code{mysqldump}
includes this statement as of MySQL 4.1.1. For earlier versions, you can
disable the variable manually within @code{mysql} when loading the dump file
like this:

@example
mysql> SET FOREIGN_KEY_CHECKS = 0;
mysql> SOURCE dump_file_name;
mysql> SET FOREIGN_KEY_CHECKS = 1;
@end example

InnoDB allows you to drop any table even though that
would break the foreign key constraints which reference
the table. When you drop a table the constraints which
were defined in its create statement are also dropped.

If you re-create a table which was dropped, it has to have
a definition which conforms to the foreign key constraints
referencing it. It must have the right column names and types,
and it must have indexes on the referenced keys, as stated above.
If these are not satisfied, MySQL returns error number 1005
and refers to errno 150 in the error message string.

Starting from version 3.23.50 InnoDB returns the foreign key
definitions of a table when you call
@example
SHOW CREATE TABLE yourtablename
@end example
Then also @file{mysqldump} produces correct definitions
of tables to the dump file, and does not forget about the
foreign keys.

You can also list the foreign key constraints for a table
@code{T} with
@example
SHOW TABLE STATUS FROM yourdatabasename LIKE 'T'
@end example
The foreign key constraints are listed in the table comment of
the output.

@node Multiple tablespaces,  , InnoDB foreign key constraints, Using InnoDB tables
@subsubsection Multiple tablespaces - putting each table into its own .ibd file

@strong{IMPORTANT NOTE: if you upgrade to InnoDB-4.1.1 or higher, it is
difficult to downgrade back to 4.0 or 4.1.0! That is because earlier
versions of InnoDB are not aware of multiple tablespaces.}
If you need to downgrade to 4.0, you have to take table dumps and
re-create the whole InnoDB tablespace. If you have not created new
InnoDB tables under >= 4.1.1, and need to downgrade quickly, you
can also do a direct downgrade to the MySQL version 4.0.18, or
later in the 4.0 series. Before doing the direct downgrade to 4.0.xx,
you have to end all connections to >= 4.1.1, and let @file{mysqld} to
run purge and the insert buffer merge to completion, so that
@code{SHOW INNODB STATUS} shows the Main thread in the state
@code{waiting for server activity}. Then you can shut down
@file{mysqld} and start 4.0.18 or later in the 4.0 series.
A direct downgrade is not recommended, however, because it is
not extensively tested.

Starting from MySQL-4.1.1, you can now store each InnoDB table and its
indexes into its own file. This feature is called multiple tablespaces,
because then each table is stored into its own tablespace.

You can enable this feature by putting the line
@example
innodb_file_per_table
@end example
in the @code{[mysqld]} section of @file{my.cnf}. Then InnoDB stores each
table into its own file @file{tablename.ibd} in the database directory where
the table belongs. This is like MyISAM does, but MyISAM divides the table
into a data file @file{tablename.MYD} and the index file
@file{tablename.MYI}. For InnoDB, both the data and the indexes are in the
@file{.ibd} file.

If you remove the line @code{innodb_file_per_table} from @file{my.cnf},
then InnoDB creates tables inside the @file{ibdata} files again. The old
tables you had in the @file{ibdata} files before an upgrade to >= 4.1.1
remain there, they are not converted into @file{.ibd} files.

InnoDB always needs the system tablespace, @file{.ibd} files are not enough.
The system tablespace consists of the familiar @file{ibdata} files. InnoDB
puts there its internal data dictionary and undo logs.

@strong{You CANNOT FREELY MOVE .ibd files around}, like you can MyISAM
tables. This is because the table definition is stored in the InnoDB
system tablespace, and also because InnoDB must preserve the consistency
of transaction id's and log sequence numbers.

You can move an @file{.ibd} file and the associated table from a database
to another (within the same MySQL/InnoDB installation) with the familiar
@code{RENAME} command:
@example
RENAME TABLE olddatabasename.tablename TO newdatabasename.tablename;
@end example

If you have a clean backup of an @file{.ibd} file taken from the SAME
MySQL/InnoDB installation, you can restore it to an InnoDB database with
the commands:
@example
ALTER TABLE tablename DISCARD TABLESPACE; /* CAUTION: deletes the current .ibd file! */
<put the backup .ibd file to the proper place>
ALTER TABLE tablename IMPORT TABLESPACE;
@end example
Clean in this context means:
@itemize @bullet
@item
There are no uncommitted modifications by transactions in the @file{.ibd}
file. 
@item
There are no unmerged insert buffer entries to the @file{.ibd} file.
@item
Purge has removed all delete-marked index records from the @file{.ibd} file. 
@item
@file{mysqld} has flushed all modified pages of the @file{.ibd} file from
the buffer pool to the file. 
@end itemize

You can make such a clean backup @file{.ibd} file with the following method.
@itemize @bullet
@item
Stop all activity from the @file{mysqld} server and commit all transactions.
@item 
Wait that @code{SHOW INNODB STATUS\G} shows that there are no active
transactions in the database, and the main thread of InnoDB is
@code{Waiting for server activity}. Then you can take a copy of the
@file{.ibd} file. 
@end itemize

Another (non-free) method to make such a clean @file{.ibd} file is to
@itemize @bullet
@item
Use InnoDB Hot Backup to backup the InnoDB installation. 
@item
Start a second @file{mysqld} server on the backup and let it clean up
the @file{.ibd} files in the backup. 
@end itemize

It is in the TODO to allow moving clean @file{.ibd} files also to another
MySQL/InnoDB installation. That requires resetting of trx id's and
log sequence numbers in the @file{.ibd} file.


@node Adding and removing, Backing up, Using InnoDB tables, InnoDB
@subsection Adding and Removing InnoDB Data and Log Files

From version 3.23.50 and 4.0.2 you can specify the last InnoDB datafile
to @code{autoextend}. Alternatively, you can increase to your tablespace
by specifying an additional datafile. To do this you have to shut down
the MySQL server, edit the @file{my.cnf} file adding a new datafile
to the @strong{end} of @code{innodb_data_file_path}, and then start
the MySQL server again.

Currently you cannot remove a datafile from InnoDB. To decrease the
size of your database you have to use @file{mysqldump} to dump
all your tables, create a new database, and import your tables to the
new database.

If you want to change the number or the size of your InnoDB log files,
you have to shut down MySQL and make sure that it shuts down without errors.
Then copy the old log files into a safe place just in case something
went wrong in the shutdown and you will need them to recover the
database. Delete then the old log files from the log file directory,
edit @file{my.cnf}, and start MySQL again. InnoDB will tell
you at the startup that it is creating new log files.


@node Backing up, Moving, Adding and removing, InnoDB
@subsection Backing up and Recovering an InnoDB Database

The key to safe database management is taking regular backups.

InnoDB Hot Backup is an online backup tool you can use to
backup your InnoDB database while it is running. InnoDB
Hot Backup does not require you to shut down your database
and it does not set any locks or disturb your normal
database processing. InnoDB Hot Backup is a non-free
additional tool which is not included in the standard
MySQL distribution. See the InnoDB Hot Backup homepage
@uref{http://www.innodb.com/manual.php}
for detailed information and screenshots. 

If you are able to shut down your MySQL server, then to take
a 'binary' backup of your database you have to do the following: 

@itemize @bullet
@item
Shut down your MySQL database and make sure it shuts down without errors.
@item
Copy all your datafiles into a safe place.
@item
Copy all your InnoDB log files to a safe place.
@item
Copy your @file{my.cnf} configuration file or files to a safe place.
@item
Copy all the @file{.frm} files for your InnoDB tables into a
safe place.
@end itemize

In addition to taking the binary backups described above,
you should also regularly take dumps of your tables with
@file{mysqldump}. The reason to this is that a binary file
may be corrupted without you noticing it. Dumped tables are stored
into text files which are human-readable and much simpler than
database binary files. Seeing table corruption from dumped files
is easier, and since their format is simpler, the chance for
serious data corruption in them is smaller.

A good idea is to take the dumps at the same time you take a binary
backup of your database. You have to shut out all clients from your
database to get a consistent snapshot of all your tables into your
dumps. Then you can take the binary backup, and you will then have
a consistent snapshot of your database in two formats.

To be able to recover your InnoDB database to the present from the
binary backup described above, you have to run your MySQL database
with the general logging and log archiving of MySQL switched on. Here
by the general logging we mean the logging mechanism of the MySQL server
which is independent of InnoDB logs.

To recover from a crash of your MySQL server process, the only thing
you have to do is to restart it. InnoDB will automatically check the
logs and perform a roll-forward of the database to the present.
InnoDB will automatically roll back uncommitted transactions which were
present at the time of the crash. During recovery, InnoDB will print
out something like the following:

@example
~/mysqlm/sql > mysqld
InnoDB: Database was not shut down normally.
InnoDB: Starting recovery from log files...
InnoDB: Starting log scan based on checkpoint at
InnoDB: log sequence number 0 13674004
InnoDB: Doing recovery: scanned up to log sequence number 0 13739520
InnoDB: Doing recovery: scanned up to log sequence number 0 13805056
InnoDB: Doing recovery: scanned up to log sequence number 0 13870592
InnoDB: Doing recovery: scanned up to log sequence number 0 13936128
...
InnoDB: Doing recovery: scanned up to log sequence number 0 20555264
InnoDB: Doing recovery: scanned up to log sequence number 0 20620800
InnoDB: Doing recovery: scanned up to log sequence number 0 20664692
InnoDB: 1 uncommitted transaction(s) which must be rolled back
InnoDB: Starting rollback of uncommitted transactions
InnoDB: Rolling back trx no 16745
InnoDB: Rolling back of trx no 16745 completed
InnoDB: Rollback of uncommitted transactions completed
InnoDB: Starting an apply batch of log records to the database...
InnoDB: Apply batch completed
InnoDB: Started
mysqld: ready for connections
@end example

If your database gets corrupted or your disk fails, you have
to do the recovery from a backup. In the case of corruption, you should
first find a backup which is not corrupted. From a backup do the recovery
from the general log files of MySQL according to instructions in the
MySQL manual.

@menu
* Forcing recovery::            Forcing recovery
* InnoDB checkpoints::          Checkpoints
@end menu


@node Forcing recovery, InnoDB checkpoints, Backing up, Backing up
@subsubsection Forcing recovery

If there is database page corruption, you may want to dump
your tables from the database with @code{SELECT INTO OUTFILE},
and usually most of the data
is intact and correct. But the corruption may cause
@code{SELECT * FROM table}, or InnoDB
background operations to crash or assert, or even the InnoDB
roll-forward recovery to crash. Starting from the InnoDB
version 3.23.44, there is a @file{my.cnf} option with which
you can force
InnoDB to start up, and you can also prevent background operations
from running, so that
you will be able to dump your tables. For example, you can set
@example
set-variable = innodb_force_recovery = 4
@end example
in @file{my.cnf}.

The alternatives for @code{innodb_force_recovery} follow.
The database must not otherwise be used with these options!
As a safety measure InnoDB prevents a user from doing @code{INSERT},
@code{UPDATE}, or @code{DELETE} when this option is > 0.

Starting from version 3.23.53 and 4.0.4, you are allowed to
@code{DROP} or @code{CREATE} a table even if
forced recovery is used. If you know that a certain table is causing
a crash in rollback, you can drop it.
You can use this also to stop a runaway rollback
caused by a failing mass import or @code{ALTER TABLE}.
You can kill the mysqld process and
use the @file{my.cnf} option @code{innodb_force_recovery=3}
to bring your database up without the rollback.
Then @code{DROP} the table which is causing the runaway rollback.

A bigger number below
means that all precautions of lower numbers are included. If you are
able to dump your tables with an option at most 4, then you are
relatively safe that only some data on corrupt individual pages
is lost. Option 6 is more dramatic, because database pages are left
in an obsolete state, which in turn may introduce more corruption
into B-trees and other database structures.

@itemize @bullet
@item 1 (SRV_FORCE_IGNORE_CORRUPT) let the server run even if it detects a
                                corrupt page; try to make
                                @code{SELECT * FROM table}
                                jump over corrupt index records and pages,
                                which helps in dumping tables;
@item 2 (SRV_FORCE_NO_BACKGROUND) prevent the main thread from
                                running: if a crash would occur
                                in purge, this prevents it;
@item 3 (SRV_FORCE_NO_TRX_UNDO) do not run transaction rollbacks
                                after recovery;
@item 4 (SRV_FORCE_NO_IBUF_MERGE) prevent also insert buffer merge operations:
                                if they would cause a crash, better
                                not do them; do not calculate table statistics;
@item 5 (SRV_FORCE_NO_UNDO_LOG_SCAN) do not look at undo logs when
                                starting the database: InnoDB will
                                treat even incomplete transactions
                                as committed;
@item 6 (SRV_FORCE_NO_LOG_REDO)   do not do the log roll-forward
                                in connection with recovery.
@end itemize


@node InnoDB checkpoints,  , Forcing recovery, Backing up
@subsubsection Checkpoints

InnoDB implements a checkpoint mechanism called a fuzzy
checkpoint. InnoDB will flush modified database pages from the buffer
pool in small batches, there is no need to flush the buffer pool
in one single batch, which would in practice stop processing
of user SQL statements for a while.

In crash recovery InnoDB looks for a checkpoint label written
to the log files. It knows that all modifications to the database
before the label are already present on the disk image of the database.
Then InnoDB scans the log files forward from the place of the checkpoint
applying the logged modifications to the database.

InnoDB writes to the log files in a circular fashion.
All committed modifications which make the database pages in the buffer
pool different from the images on disk must be available in the log files
in case InnoDB has to do a recovery. This means that when InnoDB starts
to reuse a log file in the circular fashion, it has to make sure that the
database page images on disk already contain the modifications
logged in the log file InnoDB is going to reuse. In other words, InnoDB
has to make a checkpoint and often this involves flushing of
modified database pages to disk.

The above explains why making your log files very big may save
disk I/O in checkpointing. It can make sense to set
the total size of the log files as big as the buffer pool or even bigger.
The drawback in big log files is that crash recovery can last longer
because there will be more log to apply to the database.


@node Moving, InnoDB transaction model, Backing up, InnoDB
@subsection Moving an InnoDB Database to Another Machine

On Windows InnoDB stores the database names and table names
internally always in lowercase. To move databases in a binary format 
from Unix to Windows or from Windows to Unix you should have all table
and database names in lowercase. A convenient way to accomplish this
is to add on Unix the line 
@example
set-variable=lower_case_table_names=1
@end example
to the @code{[mysqld]} section of your @file{my.cnf} before you start
creating your tables. On Windows the setting 1 is the default. 

InnoDB data and log files are binary-compatible on all platforms
if the floating-point number format on the machines is the same.
You can move an InnoDB database simply by copying all the relevant
files, which we already listed in the previous section on backing up
a database. If the floating-point formats on the machines are
different but you have not used @code{FLOAT} or @code{DOUBLE}
datatypes in your tables then the procedure is the same: just copy
the relevant files. If the formats are different and your tables
contain floating-point data, you have to use @file{mysqldump}
and @file{mysqlimport} to move those tables.

A performance tip is to switch off auto-commit mode when you import
data into your database, assuming your tablespace has enough space for
the big rollback segment the big import transaction will generate.
Do the commit only after importing a whole table or a segment of
a table.


@node InnoDB transaction model, InnoDB tuning, Moving, InnoDB
@subsection InnoDB Transaction Model and Locking

In the @code{InnoDB} transaction model the goal has been to combine the best
properties of a multi-versioning database to traditional two-phase locking.
InnoDB does locking on row level and runs queries by default
as non-locking consistent reads, in the style of Oracle.
The lock table in @code{InnoDB} is stored so space-efficiently that lock
escalation is not needed: typically several users are allowed
to lock every row in the database, or any random subset of the rows,
without @code{InnoDB} running out of memory.

In @code{InnoDB} all user activity happens inside transactions. If the
autocommit mode is used in MySQL, then each SQL statement
forms a single transaction.
MySQL always starts a new connection with the autocommit
mode switched on.

If the autocommit mode is
switched off with @code{SET AUTOCOMMIT = 0},
then we can think that a user always has a transaction
open. If he issues
the SQL @code{COMMIT} or @code{ROLLBACK} statement,
it ends the current transaction, and a new one starts. Both statements
will release all @code{InnoDB} locks that were set during the
current transaction. A @code{COMMIT} means that the
changes made in the current transaction are made permanent
and become visible to other users. A @code{ROLLBACK} statement,
on the other hand, cancels all modifications made by the current
transaction.

If the connection has @code{AUTOCOMMIT = 1}, then the user
can still perform a multiple-statement transaction by starting it with
@code{START TRANSACTION} or
@code{BEGIN} and ending it with @code{COMMIT}
or @code{ROLLBACK}.

@menu
* InnoDB transaction isolation::  InnoDB and @code{SET ... TRANSACTION ISOLATION LEVEL ...}
* InnoDB consistent read::      Consistent Non-Locking Read
* InnoDB locking reads::        Locking Reads @code{SELECT ... FOR UPDATE} and @code{SELECT ... LOCK IN SHARE MODE}
* InnoDB Next-key locking::     Next-key Locking: Avoiding the Phantom Problem
* InnoDB Locks set::            Locks Set by Different SQL Statements in @code{InnoDB}
* InnoDB Deadlock detection::   Deadlock Detection and Rollback
* InnoDB Consistent read example::  An Example of How the Consistent Read Works in @code{InnoDB}
* Innodb deadlocks::            How to Cope With Deadlocks
@end menu


@node InnoDB transaction isolation, InnoDB consistent read, InnoDB transaction model, InnoDB transaction model
@subsubsection InnoDB and @code{SET ... TRANSACTION ISOLATION LEVEL ...}

In terms of the SQL-92 transaction isolation levels,
the @code{InnoDB} default is @code{REPEATABLE READ}.
Starting from version 4.0.5, @code{InnoDB} offers all 4 different
transaction isolation levels described by the SQL-92 standard.
You can set the default isolation level for all connections
in the @code{[mysqld]} section of @file{my.cnf}:

@example
transaction-isolation = @{READ-UNCOMMITTED | READ-COMMITTED
                         | REPEATABLE-READ | SERIALIZABLE@}

@end example

A user can change the isolation level of a single session or
all new incoming connections with the @code{SET TRANSACTION}
statement. Its syntax is as follows:

@example
SET [SESSION | GLOBAL] TRANSACTION ISOLATION LEVEL
                       @{READ UNCOMMITTED | READ COMMITTED
                        | REPEATABLE READ | SERIALIZABLE@}
@end example

Note that there are no hyphens in level names in the SQL syntax.

The default behavior is to set the isolation level for the next (not
started) transaction.  If you use the @code{GLOBAL} keyword, the statement
sets the default transaction level globally for all new connections
created from that point on (but not existing connections).
You need the @code{SUPER} privilege to do this.  Using the @code{SESSION}
keyword sets the default transaction level for all future transactions
performed on the current connection.  Any client is free to change the
session isolation level (even in the middle of a transaction), or the
isolation level for the next transaction.
In versions earlier than 3.23.50, @code{SET TRANSACTION} had no effect
on @code{InnoDB} tables. In versions < 4.0.5 only @code{REPEATABLE READ}
and @code{SERIALIZABLE} were available.

You can query the global and session transaction isolation levels with:
@example
SELECT @@@@global.tx_isolation;
SELECT @@@@tx_isolation;
@end example

In row level locking @code{InnoDB} uses so-called next-key locking.
That means that besides index records, @code{InnoDB} can also lock
the ``gap'' before an index record to block insertions by other users
immediately before the index record. A next-key lock means
a lock which locks an index record and the gap before it.
A gap lock means a lock which only locks a gap before some
index record.

A detailed description of each isolation level in @code{InnoDB}:

@itemize @bullet
@item
@code{READ UNCOMMITTED} This is also called
``dirty read'': non-locking @code{SELECT} statements are performed
so that we do not look at a possible earlier version of a record; 
thus they are not 'consistent' reads under this isolation level;
otherwise this level works like @code{READ COMMITTED}.
@item
@code{READ COMMITTED}
Somewhat Oracle-like isolation level.
All @code{SELECT ... FOR UPDATE} and
@code{SELECT ... LOCK IN SHARE MODE}
statements
only lock the index records, @strong{not} the gaps before them, and
thus allow free inserting of new records next to locked
records.
@code{UPDATE} and @code{DELETE} which use
a unique index with a unique search condition,
only lock the index record found, not the gap before it.
But still in range type
@code{UPDATE} and @code{DELETE}, @code{InnoDB}
must set next-key or gap locks and block insertions
by other users to the
gaps covered by the range. This is necessary
since ``phantom rows'' have to be blocked for MySQL
replication and recovery to work.
@strong{Consistent reads} behave as in
Oracle: each consistent read, even within the same
transaction, sets and reads its own fresh snapshot.
@item
@code{REPEATABLE READ} This is the default isolation level of
@code{InnoDB}.
@code{SELECT ... FOR UPDATE}, @code{SELECT ... LOCK IN SHARE MODE},
@code{UPDATE}, and @code{DELETE}
which use
a unique index with a unique search condition,
only lock the index record found, not the gap before it.
Otherwise these operations employ next-key locking, locking
the index range scanned with next-key or gap locks, and
block new insertions by other users.
In @strong{consistent reads} there is an important difference
from the previous isolation level: in this level
all consistent reads within the same transaction read the
same snapshot established by the first read. This convention
means that if you issue several plain @code{SELECT} statements
within the same transaction, these @code{SELECT} statements are
consistent also with respect to each other.
@item
@code{SERIALIZABLE} This level is like
the previous one, but
all plain @code{SELECT} statements are implicitly converted to
@code{SELECT ... LOCK IN SHARE MODE}.
@end itemize


@node InnoDB consistent read, InnoDB locking reads, InnoDB transaction isolation, InnoDB transaction model
@subsubsection Consistent Non-Locking Read

A consistent read means that InnoDB uses its multi-versioning to
present to a query a snapshot of the database at a point in time.
The query will see the changes made by exactly those transactions
that committed before that point of time, and no changes made by
later or uncommitted transactions. The exception to this rule
is that the query will see the changes made by the transaction
itself which issues the query. 

If you are running with the default @code{REPEATABLE READ} isolation level,
then all consistent reads within the same transaction read the snapshot
established by the first such read in that transaction. You can get a
fresher snapshot for your queries by committing the current transaction
and after that issuing new queries. 

Consistent read is the default mode in which InnoDB processes
@code{SELECT} statements in @code{READ COMMITTED} and
@code{REPEATABLE READ} isolation levels. A consistent read
does not set any locks on the tables it accesses, and
therefore other users are free to modify those tables at
the same time a consistent read is being performed on the table. 


@node InnoDB locking reads, InnoDB Next-key locking, InnoDB consistent read, InnoDB transaction model
@subsubsection Locking Reads @code{SELECT ... FOR UPDATE} and @code{SELECT ... LOCK IN SHARE MODE}

A consistent read is not convenient in some circumstances.
Suppose you want to add a new row into your table @code{CHILD},
and make sure that the child already has a parent in table
@code{PARENT}.

Suppose you use a consistent read to read the table @code{PARENT}
and indeed see the parent of the child in the table. Can you now safely
add the child row to table @code{CHILD}? No, because it may
happen that meanwhile some other user has deleted the parent row
from the table @code{PARENT}, and you are not aware of that.

The solution is to perform the @code{SELECT} in a locking
mode, @code{LOCK IN SHARE MODE}.
  
@example
SELECT * FROM PARENT WHERE NAME = 'Jones' LOCK IN SHARE MODE;
@end example

Performing a read in share mode means that we read the latest
available data, and set a shared mode lock on the rows we read.
If the latest data belongs to a yet uncommitted transaction of another
user, we will wait until that transaction commits.
A shared mode lock prevents others from updating or deleting
the row we have read. After we see that the above query returns
the parent @code{'Jones'}, we can safely add his child
to table @code{CHILD}, and commit our transaction.
This example shows how to implement referential
integrity in your application code.

Let us look at another example: we have an integer counter field in
a table @code{CHILD_CODES} which we use to assign
a unique identifier to each child we add to table @code{CHILD}.
Obviously, using a consistent read or a shared mode read
to read the present value of the counter is not a good idea, since
then two users of the database may see the same value for the
counter, and we will get a duplicate key error when we add
the two children with the same identifier to the table.

In this case there are two good ways to implement the
reading and incrementing of the counter: (1) update the counter
first by incrementing it by 1 and only after that read it,
or (2) read the counter first with
a lock mode @code{FOR UPDATE}, and increment after that:

@example
SELECT COUNTER_FIELD FROM CHILD_CODES FOR UPDATE;
UPDATE CHILD_CODES SET COUNTER_FIELD = COUNTER_FIELD + 1;
@end example

A @code{SELECT ... FOR UPDATE} will read the latest
available data setting exclusive locks on each row it reads.
Thus it sets the same locks a searched SQL @code{UPDATE} would set
on the rows.


@node InnoDB Next-key locking, InnoDB Locks set, InnoDB locking reads, InnoDB transaction model
@subsubsection Next-key Locking: Avoiding the Phantom Problem

In row level locking InnoDB uses an algorithm called next-key locking.
InnoDB does the row level locking so that when it searches or
scans an index of a table, it sets shared or exclusive locks
on the index records it encounters. Thus the row level locks are
more precisely called index record locks.

The locks InnoDB sets on index records also affect the 'gap'
before that index record. If a user has a shared or exclusive
lock on record R in an index, then another user cannot insert
a new index record immediately before R in the index order.
This locking of gaps is done to prevent the so-called phantom
problem. Suppose I want to read and lock all children with identifier
bigger than 100 from table @code{CHILD},
and update some field in the selected rows.

@example
SELECT * FROM CHILD WHERE ID > 100 FOR UPDATE;
@end example

Suppose there is an index on table @code{CHILD} on column
@code{ID}. Our query will scan that index starting from
the first record where @code{ID} is bigger than 100.
Now, if the locks set on the index records would not lock out
inserts made in the gaps, a new child might meanwhile be
inserted to the table. If now I in my transaction execute

@example
SELECT * FROM CHILD WHERE ID > 100 FOR UPDATE;
@end example

again, I will see a new child in the result set the query returns.
This is against the isolation principle of transactions:
a transaction should be able to run so that the data
it has read does not change during the transaction. If we regard
a set of rows as a data item, then the new 'phantom' child would break
this isolation principle.

When InnoDB scans an index it can also lock the gap
after the last record in the index. Just that happens in the previous
example: the locks set by InnoDB will prevent any insert to
the table where @code{ID} would be bigger than 100.

You can use next-key locking to implement a uniqueness
check in your application: if you read your data in share mode
and do not see a duplicate for a row you are going to insert,
then you can safely insert your row and know that the next-key
lock set on the successor of your row during the read will prevent
anyone meanwhile inserting a duplicate for your row. Thus the next-key
locking allows you to 'lock' the non-existence of something in your
table.

@node InnoDB Locks set, InnoDB Deadlock detection, InnoDB Next-key locking, InnoDB transaction model
@subsubsection Locks Set by Different SQL Statements in @code{InnoDB}

@itemize @bullet
@item
@code{SELECT ... FROM ...}: this is a consistent read, reading a
snapshot of the database and setting no locks.
@item
@code{SELECT ... FROM ... LOCK IN SHARE MODE}: sets shared next-key locks
on all index records the read encounters.
@item
@code{SELECT ... FROM ... FOR UPDATE}: sets exclusive next-key locks
on all index records the read encounters.
@item
@code{INSERT INTO ... VALUES (...)}: sets an exclusive lock
on the inserted row; note that this lock is not a next-key lock
and does not prevent other users from inserting to the gap before the
inserted row. If a duplicate key error occurs, sets a shared lock
on the duplicate index record.
@item
@code{INSERT INTO T SELECT ... FROM S WHERE ...} sets an exclusive
(non-next-key) lock on each row inserted into @code{T}. Does
the search on @code{S} as a consistent read, but sets shared next-key
locks on @code{S} if the MySQL logging is on. @code{InnoDB} has to set
locks in the latter case because in roll-forward recovery from a
backup every SQL statement has to be executed in exactly the same
way as it was done originally.
@item
@code{CREATE TABLE ... SELECT ...} performs the @code{SELECT}
as a consistent read or with shared locks, like in the previous
item.
@item
@code{REPLACE} is done like an insert if there is no collision
on a unique key. Otherwise, an exclusive next-key lock is placed
on the row which has to be updated.
@item
@code{UPDATE ... SET ... WHERE ...}: sets an exclusive next-key
lock on every record the search encounters.
@item
@code{DELETE FROM ... WHERE ...}: sets an exclusive next-key
lock on every record the search encounters.
@item
If a @code{FOREIGN KEY} constraint is defined on a table,
any insert, update, or delete which requires checking of the constraint
condition sets shared record level locks on the records it
looks at to check the constraint. Also in the case where the
constraint fails, @code{InnoDB} sets these locks.
@item
@code{LOCK TABLES ... }: sets table locks. In the implementation
the MySQL layer of code sets these locks. The automatic deadlock detection
of @code{InnoDB} cannot detect deadlocks where such table locks are involved:
see the following section.
Also, since MySQL does know about row level locks,
it is possible that you
get a table lock on a table where another user currently has row level
locks. But that does not put transaction integrity into danger.
@xref{InnoDB restrictions}.
@end itemize


@node InnoDB Deadlock detection, InnoDB Consistent read example, InnoDB Locks set, InnoDB transaction model
@subsubsection Deadlock Detection and Rollback

@code{InnoDB} automatically detects a deadlock of transactions and rolls back a
transaction or transactions to prevent the deadlock. Starting from
version 4.0.5, @code{InnoDB} will try to pick small transactions to roll
back. The size of a transaction is determined by the number of rows
it has inserted, updated, or deleted. Previous to 4.0.5, @code{InnoDB}
always rolled back the transaction whose lock request was the last
one to build a deadlock, that is, a cycle in the waits-for graph
of transactions. 

@code{InnoDB} cannot detect deadlocks where a lock set by a MySQL
@code{LOCK TABLES} statement is involved, or if a lock set
in another storage engine than @code{InnoDB} is involved. You have to resolve
these situations using @code{innodb_lock_wait_timeout} set in
@file{my.cnf}.

When @code{InnoDB} performs a complete rollback of a transaction, all the
locks of the transaction are released. However, if just a single SQL
statement is rolled back as a result of an error, some of the locks
set by the SQL statement may be preserved. This is because @code{InnoDB}
stores row locks in a format where it cannot afterwards know which was
set by which SQL statement.

@node InnoDB Consistent read example, Innodb deadlocks, InnoDB Deadlock detection, InnoDB transaction model
@subsubsection An Example of How the Consistent Read Works in @code{InnoDB}

Suppose you are running on the default @code{REPEATABLE READ} isolation level.
When you issue a consistent read, that is, an ordinary @code{SELECT}
statement, @code{InnoDB} will give your transaction a timepoint according
to which your query sees the database. Thus, if transaction B deletes
a row and commits after your timepoint was assigned, then you will
not see the row deleted. Similarly with inserts and updates.

You can advance your timepoint by committing your transaction
and then doing another @code{SELECT}.

This is called multi-versioned concurrency control.

@example
                  User A                 User B

              SET AUTOCOMMIT=0;      SET AUTOCOMMIT=0;
time
|             SELECT * FROM t;
|             empty set
|                                    INSERT INTO t VALUES (1, 2);
|
v             SELECT * FROM t;
              empty set
                                     COMMIT;

              SELECT * FROM t;
              empty set;

              COMMIT;

              SELECT * FROM t;
              ---------------------
              |    1    |    2    |
              ---------------------
@end example

Thus user A sees the row inserted by B only when B has committed the
insert, and A has committed his own transaction so that the timepoint
is advanced past the commit of B.

If you want to see the ``freshest'' state of the database, you should
use a locking read:

@example
SELECT * FROM t LOCK IN SHARE MODE;
@end example

@node Innodb deadlocks,  , InnoDB Consistent read example, InnoDB transaction model
@subsubsection How to Cope With Deadlocks

Deadlocks are a classic problem in transactional databases, but they
are not dangerous, unless they are so frequent that you cannot run
certain transactions at all. Normally you have to write your
applications so that they are always prepared to re-issue a
transaction if it gets rolled back because of a deadlock. 

@code{InnoDB} uses automatic row level locking. You can get deadlocks
even in the case of transactions which just insert or delete a
single row. That is because these operations are not really 'atomic':
they automatically set locks on the (possibly several) index
records of the row inserted/deleted. 

You can cope with deadlocks and reduce the
number of them with the following tricks: 

@itemize @bullet
@item
Use @code{SHOW INNODB STATUS} in MySQL versions >= 3.23.52 and >= 4.0.3
to determine the cause of the latest deadlock. That can help you to tune
your application to avoid deadlocks. 
@item
Always be prepared to re-issue a transaction if it fails in a
deadlock. Deadlocks are not dangerous. Just try again. 
@item
Commit your transactions often. Small transactions are less prone to collide. 
@item
If you are using locking reads @code{SELECT ... FOR UPDATE}
or @code{... LOCK IN SHARE MODE}, try using a lower isolation
level @code{READ COMMITTED}. 
@item
Access your tables and rows in a fixed order. Then transactions will
form nice queues, and do not deadlock. 
@item
Add well-chosen indexes to your tables. Then your queries need to
scan fewer index records and consequently set fewer locks.
Use @code{EXPLAIN SELECT} to determine that MySQL picks
appropriate indexes for your queries. 
@item
Use less locking: if you can afford a @code{SELECT} to return data
from an old snapshot, do not add the clause @code{FOR UPDATE}
or @code{LOCK IN SHARE MODE} to it. Using @code{READ COMMITTED}
isolation level is good here, because each consistent read
within the same transaction reads from its own fresh snapshot. 
@item
If nothing helps, serialize your transactions with table
level locks: @code{LOCK TABLES t1 WRITE, t2 READ, ... ;
[do something with tables t1 and t2 here]; UNLOCK TABLES}.
Table level locks make you transactions to queue nicely,
and deadlocks are avoided. Note that @code{LOCK TABLES}
implicitly starts a transaction, just like the command @code{BEGIN},
and @code{UNLOCK TABLES} implicitly ends the transaction in a @code{COMMIT}. 
@item
Another solution to serialize transactions is to create
an auxiliary 'semaphore' table where there is just a
single row. Each transaction updates that row before
accessing other tables. In that way all transactions
happen in a serial fashion. Note that then also the
@code{InnoDB} instant deadlock detection algorithm works,
because the serializing lock is a row level lock.
In MySQL table level locks we have to resort to the timeout method to
resolve a deadlock.
@end itemize

@node InnoDB tuning, Implementation, InnoDB transaction model, InnoDB
@subsection Performance Tuning Tips

@enumerate
@item
If the Unix @file{top} or the Windows @file{Task Manager} shows that
the CPU usage percentage with your workload is less than 70%,
your workload is probably
disk-bound. Maybe you are making too many transaction commits, or the
buffer pool is too small.
Making the buffer pool bigger can help, but do not set
it bigger than 80% of physical memory.

@item
Wrap several modifications into one transaction. @code{InnoDB} must
flush the log to disk at each transaction commit, if that transaction
made modifications to the database. Since the rotation speed of a disk
is typically
at most 167 revolutions/second, that constrains the number of commits
to the same 167/second if the disk does not fool the operating system.

@item
If you can afford the loss of some latest committed transactions, you can
set the @file{my.cnf} parameter @code{innodb_flush_log_at_trx_commit}
to 0. @code{InnoDB} tries to flush the log once per second anyway,
though the flush is not guaranteed.

@item
Make your log files big, even as big as the buffer pool. When @code{InnoDB}
has written the log files full, it has to write the modified contents
of the buffer pool to disk in a checkpoint. Small log files will cause many
unnecessary disk writes. The drawback in big log files is that recovery
time will be longer.

@item
Also the log buffer should be quite big, say 8 MB.

@item
(Relevant from 3.23.39 up.)
In some versions of Linux and Unix, flushing files to disk with the Unix
@code{fdatasync} and other similar methods is surprisingly slow.
The default method @code{InnoDB} uses is the @code{fdatasync} function.
If you are not satisfied with the database write performance, you may
try setting @code{innodb_flush_method} in @file{my.cnf}
to @code{O_DSYNC}, though @code{O_DSYNC} seems to be slower on most systems.

@item
In importing data to @code{InnoDB}, make sure that MySQL does not have
@code{autocommit=1} on. Then every insert requires a log flush to disk.
Put before your plain SQL import file line

@example
SET AUTOCOMMIT=0;
@end example

and after it

@example
COMMIT;
@end example

If you use the @file{mysqldump} option @code{--opt}, you will get dump
files which are fast to import also to an @code{InnoDB} table, even without wrapping
them to the above @code{SET AUTOCOMMIT=0; ... COMMIT;} wrappers.

@item
Beware of big rollbacks of mass inserts: @code{InnoDB} uses the insert buffer
to save disk I/O in inserts, but in a corresponding rollback no such
mechanism is used. A disk-bound rollback can take 30 times the time
of the corresponding insert. Killing the database process will not
help because the rollback will start again at the database startup. The
only way to get rid of a runaway rollback is to increase the buffer pool
so that the rollback becomes CPU-bound and runs fast, or delete the whole
@code{InnoDB} database.

@item
Beware also of other big disk-bound operations.
Use @code{DROP TABLE} or @code{TRUNCATE} (from MySQL-4.0 up) to empty a
table, not @code{DELETE FROM yourtable}.

@item
Use the multi-line @code{INSERT} to reduce
communication overhead between the client and the server if you need
to insert many rows:

@example
INSERT INTO yourtable VALUES (1, 2), (5, 5);
@end example

This tip is valid for inserts into any table type, not just @code{InnoDB}.

@end enumerate

@menu
* InnoDB Monitor::              @code{SHOW INNODB STATUS} and the @code{InnoDB} Monitors
@end menu

@node InnoDB Monitor,  , InnoDB tuning, InnoDB tuning
@subsubsection @code{SHOW INNODB STATUS} and the @code{InnoDB} Monitors

Starting from version 3.23.42, @code{InnoDB} includes InnoDB
Monitors that print information about the @code{InnoDB} internal state.
Starting from versions 3.23.52 and 4.0.3 you can use the SQL
command @code{SHOW INNODB STATUS}
to fetch the output of the standard InnoDB Monitor to the SQL client.
The information is useful in performance tuning. If you are using the
@file{mysql} interactive SQL client, the output is more readable
if you replace the usual semicolon statement terminator by @code{\G}:
@example
SHOW INNODB STATUS\G
@end example

Another way to use InnoDB Monitors is to let them continuosly
write data to the standard output of the server @file{mysqld}
(note: the MySQL client will not print anything).
When switched on, @code{InnoDB} Monitors print data
about once every 15 seconds. If you run @file{mysqld}
as a daemon then this output is usually directed to
the @file{.err} log in the MySQL @code{datadir}.
This data is useful in performance tuning.
On Windows you must start @code{mysqld-max}
from an MS-DOS prompt with the @code{--console}
option if you want to direct the output to the MS-DOS prompt
window.

There is a separate @code{innodb_lock_monitor} which
prints the same information as @code{innodb_monitor}
plus information on locks set by each transaction.

The printed information includes data on:
@itemize @bullet
@item
lock waits of a transactions,
@item
semaphore waits of threads,
@item
pending file I/O requests,
@item
buffer pool statistics, and
@item
purge and insert buffer merge activity of the main thread
of @code{InnoDB}.
@end itemize

You can start InnoDB Monitor through the following
SQL command:

@example
CREATE TABLE innodb_monitor(a INT) type = innodb;
@end example

and stop it by

@example
DROP TABLE innodb_monitor;
@end example

The @code{CREATE TABLE} syntax is just a way to pass a command
to the @code{InnoDB} engine through the MySQL SQL parser: the created
table is not relevant at all for InnoDB Monitor. If you shut down
the database when the monitor is running, and you want to start
the monitor again, you have to drop the
table before you can issue a new @code{CREATE TABLE}
to start the monitor.
This syntax may change in a future release.


A sample output of the InnoDB Monitor:

@example
================================
010809 18:45:06 INNODB MONITOR OUTPUT
================================
--------------------------
LOCKS HELD BY TRANSACTIONS
--------------------------
LOCK INFO:
Number of locks in the record hash table 1294
LOCKS FOR TRANSACTION ID 0 579342744
TABLE LOCK table test/mytable trx id 0 582333343 lock_mode IX

RECORD LOCKS space id 0 page no 12758 n bits 104 table test/mytable index
PRIMARY trx id 0 582333343 lock_mode X
Record lock, heap no 2 PHYSICAL RECORD: n_fields 74; 1-byte offs FALSE;
info bits 0
 0: len 4; hex 0001a801; asc ;; 1: len 6; hex 000022b5b39f; asc ";;
 2: len 7; hex 000002001e03ec; asc ;; 3: len 4; hex 00000001;
...
-----------------------------------------------
CURRENT SEMAPHORES RESERVED AND SEMAPHORE WAITS
-----------------------------------------------
SYNC INFO:
Sorry, cannot give mutex list info in non-debug version!
Sorry, cannot give rw-lock list info in non-debug version!
-----------------------------------------------------
SYNC ARRAY INFO: reservation count 6041054, signal count 2913432
4a239430 waited for by thread 49627477 op. S-LOCK file NOT KNOWN line 0
Mut ex 0 sp 5530989 r 62038708 sys 2155035;
rws 0 8257574 8025336; rwx 0 1121090 1848344
-----------------------------------------------------
CURRENT PENDING FILE I/O'S
--------------------------
Pending normal aio reads:
Reserved slot, messages 40157658 4a4a40b8
Reserved slot, messages 40157658 4a477e28
...
Reserved slot, messages 40157658 4a4424a8
Reserved slot, messages 40157658 4a39ea38
Total of 36 reserved aio slots
Pending aio writes:
Total of 0 reserved aio slots
Pending insert buffer aio reads:
Total of 0 reserved aio slots
Pending log writes or reads:
Reserved slot, messages 40158c98 40157f98
Total of 1 reserved aio slots
Pending synchronous reads or writes:
Total of 0 reserved aio slots
-----------
BUFFER POOL
-----------
LRU list length 8034
Free list length 0
Flush list length 999
Buffer pool size in pages 8192
Pending reads 39
Pending writes: LRU 0, flush list 0, single page 0
Pages read 31383918, created 51310, written 2985115
----------------------------
END OF INNODB MONITOR OUTPUT
============================
010809 18:45:22 InnoDB starts purge
010809 18:45:22 InnoDB purged 0 pages
@end example

Some notes on the output:

@itemize @bullet
@item
If the section LOCKS HELD
BY TRANSACTIONS reports lock waits, then your application
may have lock contention. The output can also help to
trace reasons for transaction deadlocks.
@item
Section SYNC INFO will report reserved semaphores
if you compile InnoDB with @code{UNIV_SYNC_DEBUG}
defined in @file{univ.i}.
@item
Section SYNC ARRAY INFO reports threads waiting
for a semaphore and statistics on how many times
threads have needed a spin or a wait on a mutex or
a rw-lock semaphore. A large number of threads waiting
for semaphores may be a result of disk I/O, or
contention problems inside InnoDB. Contention can be
due to heavy parallelism of queries, or problems in
operating system thread scheduling.
@item
Section CURRENT PENDING FILE I/O'S lists pending
file I/O requests. A large number of these indicates
that the workload is disk I/O-bound.
@item
Section BUFFER POOL gives you statistics
on pages read and written. You can calculate from these
numbers how many datafile I/Os your queries are
currently doing.
@end itemize

@node Implementation, Table and index, InnoDB tuning, InnoDB
@subsection Implementation of Multi-versioning

Since InnoDB is a multi-versioned database, it must keep information
of old versions of rows in the tablespace. This information is stored
in a data structure we call a rollback segment after an analogous
data structure in Oracle.

InnoDB internally adds two fields to each row stored in the database.
A 6-byte field tells the transaction identifier for the last
transaction which inserted or updated the row. Also a deletion
is internally treated as an update where a special bit in the row
is set to mark it as deleted. Each row also contains a 7-byte
field called the roll pointer. The roll pointer points to an
undo log record written to the rollback segment. If the row was
updated, then the undo log record contains the information necessary
to rebuild the content of the row before it was updated.

InnoDB uses the information in the rollback segment to perform the
undo operations needed in a transaction rollback. It also uses the
information to build earlier versions of a row for a consistent
read.

Undo logs in the rollback segment are divided into insert and update
undo logs. Insert undo logs are only needed in transaction rollback
and can be discarded as soon as the transaction commits. Update undo logs
are used also in consistent reads, and they can be discarded only after
there is no transaction present for which InnoDB has assigned
a snapshot that in a consistent read could need the information
in the update undo log to build an earlier version of a database
row.

You must remember to commit your transactions regularly,
also those transactions which only issue consistent reads.
Otherwise
InnoDB cannot discard data from the update undo logs, and the
rollback segment may grow too big, filling up your tablespace.

The physical size of an undo log record in the rollback segment
is typically smaller than the corresponding inserted or updated
row. You can use this information to calculate the space need
for your rollback segment.

In our multi-versioning scheme a row is not physically removed from
the database immediately when you delete it with an SQL statement.
Only  when InnoDB can discard the update undo log record written for
the deletion, it can also physically remove the corresponding row and
its index records from the database. This removal operation is
called a purge, and it is quite fast, usually taking the same order of
time as the SQL statement which did the deletion.


@node Table and index, File space management, Implementation, InnoDB
@subsection Table and Index Structures

MySQL stores its data dictionary information of tables
in @file{.frm}
files in database directories. But every InnoDB type table
also has its own entry in InnoDB internal data dictionaries
inside the tablespace. When MySQL drops a table or a database,
it has to delete both a @file{.frm} file or files, and
the corresponding entries inside the InnoDB data dictionary.
This is the reason why you cannot move InnoDB tables between
databases simply by moving the @file{.frm} files, and why
@code{DROP DATABASE} did not work for InnoDB type tables
in MySQL versions <= 3.23.43.

Every InnoDB table has a special index called the clustered index
where the data of the rows is stored. If you define a
@code{PRIMARY KEY} on your table, then the index of the primary key
will be the clustered index.

If you do not define a primary key for
your table, InnoDB will internally generate a clustered index
where the rows are ordered by the row ID that InnoDB assigns
to the rows in such a table. The row ID is a 6-byte field which
monotonically increases as new rows are inserted. Thus the rows
ordered by the row ID will be physically in the insertion order.

Accessing a row through the clustered index is fast, because
the row data will be on the same page where the index search
leads us. In many databases the data is traditionally stored on a different
page from the index record. If a table is large, the clustered
index architecture often saves a disk I/O when compared to the
traditional solution.

The records in non-clustered indexes (we also call them secondary indexes),
in InnoDB contain the primary key value for the row. InnoDB
uses this primary key value to search for the row from the clustered
index. Note that if the primary key is long, the secondary indexes
will use more space.

@menu
* InnoDB physical structure::   Physical Structure of an Index
* InnoDB Insert buffering::     Insert Buffering
* InnoDB Adaptive hash::        Adaptive Hash Indexes
* InnoDB Physical record::      Physical Record Structure
* InnoDB auto-increment column::  How an @code{AUTO_INCREMENT} Column Works in InnoDB
@end menu

@node InnoDB physical structure, InnoDB Insert buffering, Table and index, Table and index
@subsubsection Physical Structure of an Index

All indexes in InnoDB are B-trees where the index records are
stored in the leaf pages of the tree. The default size of an index
page is 16 KB. When new records are inserted, InnoDB tries to
leave 1 / 16 of the page free for future insertions and updates
of the index records.

If index records are inserted in a sequential (ascending or descending)
order, the resulting index pages will be about 15/16 full.
If records are inserted in a random order, then the pages will be
1/2 - 15/16 full. If the fillfactor of an index page drops below 1/2,
InnoDB will try to contract the index tree to free the page.


@node InnoDB Insert buffering, InnoDB Adaptive hash, InnoDB physical structure, Table and index
@subsubsection Insert Buffering

It is a common situation in a database application that the
primary key is a unique identifier and new rows are inserted in the
ascending order of the primary key. Thus the insertions to the
clustered index do not require random reads from a disk.

On the other hand, secondary indexes are usually non-unique and
insertions happen in a relatively random order into secondary indexes.
This would cause a lot of random disk I/Os without a special mechanism
used in InnoDB.

If an index record should be inserted to a non-unique secondary index,
InnoDB checks if the secondary index page is already in the buffer
pool. If that is the case, InnoDB will do the insertion directly to
the index page. But, if the index page is not found from the buffer
pool, InnoDB inserts the record to a special insert buffer structure.
The insert buffer is kept so small that it entirely fits in the buffer
pool, and insertions can be made to it very fast.

The insert buffer is periodically merged to the secondary index
trees in the database. Often we can merge several insertions on the
same page in of the index tree, and hence save disk I/Os.
It has been measured that the insert buffer can speed up insertions
to a table up to 15 times.


@node InnoDB Adaptive hash, InnoDB Physical record, InnoDB Insert buffering, Table and index
@subsubsection Adaptive Hash Indexes

If a database fits almost entirely in main memory, then the fastest way
to perform queries on it is to use hash indexes. InnoDB has an
automatic mechanism which monitors index searches made to the indexes
defined for a table, and if InnoDB notices that queries could
benefit from building of a hash index, such an index is automatically
built.

But note that the hash index is always built based on an existing
B-tree index on the table. InnoDB can build a hash index on a prefix
of any length of the key defined for the B-tree, depending on
what search pattern InnoDB observes on the B-tree index.
A hash index can be partial: it is not required that the whole
B-tree index is cached in the buffer pool. InnoDB will build
hash indexes on demand to those pages of the index which are
often accessed.

In a sense, through the adaptive hash index mechanism InnoDB adapts itself
to ample main memory, coming closer to the architecture of main memory
databases.


@node InnoDB Physical record, InnoDB auto-increment column, InnoDB Adaptive hash, Table and index
@subsubsection Physical Record Structure

@itemize @bullet
@item
Each index record in InnoDB contains a header of 6 bytes. The header
is used to link consecutive records together, and also in the row level
locking.
@item
Records in the clustered index contain fields for all user-defined
columns. In addition, there is a 6-byte field for the transaction id
and a 7-byte field for the roll pointer.
@item
If the user has not defined a primary key for a table, then each clustered
index record contains also a 6-byte row ID field.
@item
Each secondary index record contains also all the fields defined
for the clustered index key.
@item
A record contains also a pointer to each field of the record.
If the total length of the fields in a record is < 128 bytes, then
the pointer is 1 byte, else 2 bytes.
@end itemize


@node InnoDB auto-increment column,  , InnoDB Physical record, Table and index
@subsubsection How an @code{AUTO_INCREMENT} Column Works in InnoDB

After a database startup, when a user first does an insert to a
table @code{T}
where an auto-increment column has been defined, and the user does not provide
an explicit value for the column, then InnoDB executes @code{SELECT
MAX(auto-inc-column) FROM T}, and assigns that value incremented
by one to the column and the auto-increment counter of the table.
We say that
the auto-increment counter for table @code{T} has been initialized.

InnoDB follows the same procedure in initializing the auto-increment counter
for a freshly created table.

Note that if the user specifies in an insert the value 0 to the auto-increment
column, then InnoDB treats the row like the value would not have been
specified.

After the auto-increment counter has been initialized, if a user inserts
a row where he explicitly specifies the column value, and the value is bigger
than the current counter value, then the counter is set to the specified
column value. If the user does not explicitly specify a value, then InnoDB
increments the counter by one and assigns its new value to the column.

The auto-increment mechanism, when assigning values from the counter,
bypasses locking and transaction handling. Therefore you may also get
gaps in the number sequence if you roll back transactions which have
got numbers from the counter.

The behavior of auto-increment is not defined if a user gives a negative
value to the column or if the value becomes bigger than the maximum
integer that can be stored in the specified integer type.


@node File space management, Error handling, Table and index, InnoDB
@subsection File Space Management and Disk I/O

@menu
* InnoDB Disk I/O::             Disk I/O
* InnoDB File space::           File Space Management
* InnoDB File Defragmenting::   Defragmenting a Table
@end menu


@node InnoDB Disk I/O, InnoDB File space, File space management, File space management
@subsubsection Disk I/O

In disk I/O InnoDB uses asynchronous I/O. On Windows NT
it uses the native asynchronous I/O provided by the operating system.
On Unix, InnoDB uses simulated asynchronous I/O built
into InnoDB: InnoDB creates a number of I/O threads to take care
of I/O operations, such as read-ahead. In a future version we will
add support for simulated aio on Windows NT and native aio on those
versions of Unix which have one.

On Windows NT InnoDB uses non-buffered I/O. That means that the disk
pages InnoDB reads or writes are not buffered in the operating system
file cache. This saves some memory bandwidth.

Starting from 3.23.41 InnoDB uses a novel file flush technique
called doublewrite.
It adds safety to crash recovery after an operating system crash
or a power outage, and improves performance on most Unix flavors
by reducing the need for fsync operations.

Doublewrite means that InnoDB before writing pages to a datafile
first writes them to a contiguous tablespace area called the
doublewrite buffer. Only after the write and the flush to the doublewrite
buffer has completed, InnoDB writes the pages to their proper
positions in the datafile. If the operating system crashes in the
middle of a page write, InnoDB will in recovery find a good
copy of the page from the doublewrite buffer.

Starting from 3.23.41
you can also use a raw disk partition as a datafile, though this has
not been tested yet. When you create a new datafile you have
to put the keyword @code{newraw} immediately after the datafile size
in @code{innodb_data_file_path}. The partition must be at least as large
as the size that you specify. Note that 1M in InnoDB is
1024 x 1024 bytes, while in disk specifications 1 MB usually means
1000 000 bytes.

@example
innodb_data_file_path=/dev/hdd1:5Gnewraw;/dev/hdd2:2Gnewraw
@end example

When you start the database again you @strong{must} change the keyword
to @code{raw}. Otherwise, InnoDB will write over your
partition!

@example
innodb_data_file_path=/dev/hdd1:5Graw;/dev/hdd2:2Graw
@end example

By using a raw disk you can on some versions of Unix perform unbuffered I/O.

When you use raw disk partitions, make sure they have permissions that
allow read and write access to the account used for running the MySQL
server.

There are two read-ahead heuristics in InnoDB: sequential read-ahead
and random read-ahead. In sequential read-ahead InnoDB notices that
the access pattern to a segment in the tablespace is sequential.
Then InnoDB will post in advance a batch of reads of database pages to the
I/O system. In random read-ahead InnoDB notices that some area
in a tablespace seems to be in the process of being
fully read into the buffer pool. Then InnoDB posts the remaining
reads to the I/O system.


@node InnoDB File space, InnoDB File Defragmenting, InnoDB Disk I/O, File space management
@subsubsection File Space Management

The datafiles you define in the configuration file form the tablespace
of InnoDB. The files are simply catenated to form the tablespace,
there is no striping in use.
Currently you cannot define where in the tablespace your tables will be
allocated. However, in a newly created
tablespace, InnoDB will allocate space starting from the low end.

The tablespace consists of database pages whose default size is 16 KB.
The pages are grouped into extents of 64 consecutive pages. The 'files' inside
a tablespace are called segments in InnoDB. The name of the rollback
segment is somewhat misleading because it actually contains many
segments in the tablespace.

For each index in InnoDB we allocate two segments: one is for non-leaf
nodes of the B-tree, the other is for the leaf nodes. The idea here is
to achieve better sequentiality for the leaf nodes, which contain the
data.

When a segment grows inside the tablespace, InnoDB allocates the
first 32 pages to it individually. After that InnoDB starts
to allocate whole extents to the segment.
InnoDB can add to a large segment up to 4 extents at a time to ensure
good sequentiality of data.

Some pages in the tablespace contain bitmaps of other pages, and
therefore a few extents in an InnoDB tablespace cannot be
allocated to segments as a whole, but only as individual pages.

When you issue a query @code{SHOW TABLE STATUS FROM ... LIKE ...}
to ask for available free space in the tablespace, InnoDB will
report the extents which are definitely free in the tablespace.
InnoDB always reserves some extents for clean-up and other internal
purposes; these reserved extents are not included in the free space.

When you delete data from a table, InnoDB will contract the corresponding
B-tree indexes. It depends on the pattern of deletes if that frees
individual pages or extents to the tablespace, so that the freed
space is available for other users. Dropping a table or deleting
all rows from it is guaranteed to release the space to other users,
but remember that deleted rows can be physically removed only in a
purge operation after they are no longer needed in transaction rollback or
consistent read.


@node InnoDB File Defragmenting,  , InnoDB File space, File space management
@subsubsection Defragmenting a Table

If there are random insertions or deletions
in the indexes of a table, the indexes
may become fragmented. By fragmentation we mean that the physical ordering
of the index pages on the disk is not close to the alphabetical ordering
of the records on the pages, or that there are many unused pages in the
64-page blocks which were allocated to the index.

It can speed up index scans if you
periodically use @code{mysqldump} to dump the table to
a text file, drop the table, and reload it from the dump.
Another way to do the defragmenting is to
perform a 'null' alter table operation
@code{ALTER TABLE tablename TYPE=InnoDB}.
That makes @code{MySQL} to rebuild the table.

If the insertions to an index are always ascending and
records are deleted only from the end, then the file space management
algorithm of InnoDB guarantees that fragmentation in the index will
not occur.

@node Error handling, InnoDB restrictions, File space management, InnoDB
@subsection Error Handling

The error handling in InnoDB is not always the same as
specified in the SQL standard. According to SQL-99, any error during
an SQL statement should cause the
rollback of that statement. InnoDB sometimes rolls back only
part of the statement, or the whole transaction.
The following list specifies the error handling of InnoDB.

@itemize @bullet
@item
If you run out of file space in the tablespace,
you will get the MySQL @code{'Table is full'} error
and InnoDB rolls back the SQL statement.
@item
A transaction deadlock or a timeout in a lock wait make InnoDB
to roll back
the whole transaction.
@item
A duplicate key error only rolls back the insert of that particular row,
even in a statement like @code{INSERT INTO ... SELECT ...}.
This will probably change so that the SQL statement will be rolled
back if you have not specified the @code{IGNORE} option in your
statement.
@item
A 'row too long' error rolls back the SQL statement.
@item
Other errors are mostly detected by the MySQL layer of code, and
they roll back the corresponding SQL statement.
@end itemize


@node InnoDB restrictions, InnoDB change history, Error handling, InnoDB
@subsection Restrictions on InnoDB Tables

@itemize @bullet

@item
InnoDB tables do not support full-text indexes.

@item
In Windows, InnoDB stores the database names and table names
internally always in lowercase. To move databases in a binary format
from Unix to Windows or from Windows to Unix you should have all table
and database names in lowercase.

@item
@code{TRUNCATE table_name} doesn't reset any @code{AUTO_INCREMENT} counters.

@item
@strong{Warning:} Do @strong{NOT} convert MySQL system tables from
MyISAM TO InnoDB tables!  This is not supported; if you do this MySQL
will not restart until you restore the old system tables from a backup
or re-generate them with the @code{mysql_install_db} script.

@item
@code{SHOW TABLE STATUS} does not give accurate statistics
on InnoDB tables, except for the physical size reserved by the table.
The row count is only a rough estimate used in SQL optimization.

@item
If you try to create a unique index on a prefix of a column you will get an
error:

@example
CREATE TABLE T (A CHAR(20), B INT, UNIQUE (A(5))) TYPE = InnoDB;
@end example

If you create a non-unique index on a prefix of a column, InnoDB will
create an index over the whole column.
@item
@code{INSERT DELAYED} is not supported for InnoDB tables.
@item
The MySQL @code{LOCK TABLES} operation does not know of InnoDB
row level locks set in already completed SQL statements: this means that
you can get a table lock on a table even if there still exist transactions
of other users which have row level locks on the same table. Thus
your operations on the table may have to wait if they collide with
these locks of other users. Also a deadlock is possible. However,
this does not endanger transaction integrity, because the row level
locks set by InnoDB will always take care of the integrity.
Also, a table lock prevents other transactions from acquiring more
row level locks (in a conflicting lock mode) on the table.
@item
A table cannot contain more than 1000 columns.
@item
@code{DELETE FROM TABLE} does not regenerate the table but instead
deletes all rows, one by one, which is not that fast. In future versions
of MySQL you can use @code{TRUNCATE} which is fast.
@item
The default database page size in InnoDB is 16 KB. By recompiling the
code one can set it from 8 KB to 64 KB.
The maximun row length is slightly less than half of a database page
in versions <= 3.23.40 of InnoDB. Starting from source
release 3.23.41 BLOB and
TEXT columns are allowed to be < 4 GB, the total row length must also be
< 4 GB. InnoDB does not store fields whose size is <= 128 bytes on separate
pages. After InnoDB has modified the row by storing long fields on
separate pages, the remaining length of the row must be less
than half a database page. The maximun key length is 7000 bytes.
@item
On some operating systems datafiles must be < 2 GB. The combined
size of log files must be < 4 GB.
@item
The maximum tablespace size is 4 billion database pages. This is also
the maximum size for a table. The minimum tablespace size is 10 MB.
@item
When you restart the MySQL server, InnoDB may reuse an old value for
an @code{AUTO_INCREMENT} column.
@item
You cannot set the first @code{AUTO_INCREMENT} column value in
InnoDB with @code{CREATE TABLE ... AUTO_INCREMENT=...}
(or @code{ALTER TABLE ...}). To set the value
insert a dummy row with a value one less, and delete that dummy row.
@end itemize

@node InnoDB change history, InnoDB contact information, InnoDB restrictions, InnoDB
@subsection InnoDB Change History

@menu
* InnoDB news-5.0.0::           MySQL/InnoDB-5.0.0, December 24, 2003
* InnoDB news-4.0.17::          MySQL/InnoDB-4.0.17, December 17, 2003
* InnoDB news-4.1.1::           MySQL/InnoDB-4.1.1, December 4, 2003
* InnoDB news-4.0.16::          MySQL/InnoDB-4.0.16, October 22, 2003
* InnoDB news-3.23.58::         MySQL/InnoDB-3.23.58, September 15, 2003
* InnoDB news-4.0.15::          MySQL/InnoDB-4.0.15, September 10, 2003
* InnoDB news-4.0.14::          MySQL/InnoDB-4.0.14, July 22, 2003
* InnoDB news-3.23.57::         MySQL/InnoDB-3.23.57, June 20, 2003 
* InnoDB news-4.0.13::          MySQL/InnoDB-4.0.13, May 20, 2003 
* InnoDB news-4.1.0::           MySQL/InnoDB-4.1.0, April 3, 2003 
* InnoDB news-3.23.56::         MySQL/InnoDB-3.23.56, March 17, 2003 
* InnoDB news-4.0.12::          MySQL/InnoDB-4.0.12, March 18, 2003 
* InnoDB news-4.0.11::          MySQL/InnoDB-4.0.11, February 25, 2003 
* InnoDB news-4.0.10::          MySQL/InnoDB-4.0.10, February 4, 2003 
* InnoDB news-3.23.55::         MySQL/InnoDB-3.23.55, January 24, 2003
* InnoDB news-4.0.9::           MySQL/InnoDB-4.0.9, January 14, 2003
* InnoDB news-4.0.8::           MySQL/InnoDB-4.0.8, January 7, 2003
* InnoDB news-4.0.7::           MySQL/InnoDB-4.0.7, December 26, 2002
* InnoDB news-4.0.6::           MySQL/InnoDB-4.0.6, December 19, 2002
* InnoDB news-3.23.54::         MySQL/InnoDB-3.23.54, December 12, 2002
* InnoDB news-4.0.5::           MySQL/InnoDB-4.0.5, November 18, 2002
* InnoDB news-3.23.53::         MySQL/InnoDB-3.23.53, October 9, 2002
* InnoDB news-4.0.4::           MySQL/InnoDB-4.0.4, October 2, 2002
* InnoDB news-4.0.3::           MySQL/InnoDB-4.0.3, August 28, 2002
* InnoDB news-3.23.52::         MySQL/InnoDB-3.23.52, August 16, 2002
* InnoDB news-4.0.2::           MySQL/InnoDB-4.0.2, July 10, 2002
* InnoDB news-3.23.51::         MySQL/InnoDB-3.23.51, June 12, 2002
* InnoDB news-3.23.50::         MySQL/InnoDB-3.23.50, April 23, 2002
* InnoDB news-3.23.49::         MySQL/InnoDB-3.23.49, February 17, 2002
* InnoDB news-3.23.48::         MySQL/InnoDB-3.23.48, February 9, 2002
* InnoDB news-3.23.47::         MySQL/InnoDB-3.23.47, December 28, 2001
* InnoDB news-4.0.1::           MySQL/InnoDB-4.0.1, December 23, 2001
* InnoDB news-3.23.46::         MySQL/InnoDB-3.23.46, November 30, 2001
* InnoDB news-3.23.45::         MySQL/InnoDB-3.23.45, November 23, 2001
* InnoDB news-3.23.44::         MySQL/InnoDB-3.23.44, November 2, 2001
* InnoDB news-3.23.43::         MySQL/InnoDB-3.23.43, October 4, 2001
* InnoDB news-3.23.42::         MySQL/InnoDB-3.23.42, September 9, 2001
* InnoDB news-3.23.41::         MySQL/InnoDB-3.23.41, August 13, 2001
* InnoDB news-3.23.40::         MySQL/InnoDB-3.23.40, July 16, 2001
* InnoDB news-3.23.39::         MySQL/InnoDB-3.23.39, June 13, 2001
* InnoDB news-3.23.38::         MySQL/InnoDB-3.23.38, May 12, 2001
@end menu


@node InnoDB news-5.0.0, InnoDB news-4.0.17, InnoDB change history, InnoDB change history
@subsubsection MySQL/InnoDB-5.0.0, December 24, 2003

@itemize @bullet
@item
@strong{IMPORTANT NOTE: if you upgrade to InnoDB-4.1.1 or higher,
you cannot downgrade to a version lower than 4.1.1
any more! That is because earlier versions of InnoDB are not aware of
multiple tablespaces.}
@item InnoDB in 5.0.0 is essentially the same as InnoDB-4.1.1 with the
bug fixes of InnoDB-4.0.17 included.
@end itemize

@node InnoDB news-4.0.17, InnoDB news-4.1.1, InnoDB news-5.0.0, InnoDB change history
@subsubsection MySQL/InnoDB-4.0.17, December 17, 2003

@itemize @bullet
@item
Fixed a bug: if you created a column prefix secondary index and updated it
so that the last characters in the column prefix were spaces, InnoDB would
assert in @file{row0upd.c}, line 713. The same assertion failed if you
updated a column in an ordinary secondary index so that the new value was
alphabetically equivalent, but had a different length. This could happen,
for example, in the UTF8 character set if you updated a letter to its
accented or umlaut form. 
@item
Fixed a bug: InnoDB could think that a secondary index record was not
locked though it had been updated to an alphabetically equivalent value,
e.g., 'abc' -> 'aBc'. 
@item
Fixed a bug: if you updated a secondary index column to an alphabetically
equivalent value, and rolled back your update, InnoDB failed to restore
the field in the secondary index to its original value. 
@item
There are still several outstanding non-critical bugs reported in the MySQL
bugs database. Their fixing has been delayed, because resources were
allocated to the 4.1.1 release.
@end itemize

@node InnoDB news-4.1.1, InnoDB news-4.0.16, InnoDB news-4.0.17, InnoDB change history
@subsubsection MySQL/InnoDB-4.1.1, December 4, 2003

@itemize @bullet
@item
@strong{IMPORTANT NOTE: if you upgrade to InnoDB-4.1.1 or higher,
you cannot downgrade to a version lower than 4.1.1
any more! That is because earlier versions of InnoDB are not aware of
multiple tablespaces.}
@item
Multiple tablespaces now available for InnoDB. You can store each InnoDB
type table and its indexes into a separate @file{.ibd} file into a
MySQL database directory, into the same directory where the
@file{.frm} file is stored.
@item
The MySQL query cache now works for InnoDB tables also if
@code{AUTOCOMMIT=0}, or the statements are enclosed inside
@code{BEGIN ... COMMIT}. 
@item
Reduced InnoDB memory consumption by a few megabytes if one sets the buffer
pool size < 8 MB. 
@item
You can use raw disk partitions also in Windows. 
@end itemize

@node InnoDB news-4.0.16, InnoDB news-3.23.58, InnoDB news-4.1.1, InnoDB change history
@subsubsection MySQL/InnoDB-4.0.16, October 22, 2003

@itemize @bullet
@item
Fixed a bug: in contrary to what was said in the manual, in a locking
read InnoDB set two record locks if a unique exact match search
condition was used on a multi-column unique key. For a single column
unique key it worked right. 
@item
Fixed a bug: if one used the rename trick
@code{#sql... -> rsql...} to recover a temporary table, InnoDB asserted in
@code{row_mysql_lock_data_dictionary()}.
@item 
There are several outstanding non-critical bugs reported in the MySQL bugs
database. Their fixing has been delayed, because resources are allocated
to the upcoming 4.1.1 release. 
@end itemize

@node InnoDB news-3.23.58, InnoDB news-4.0.15, InnoDB news-4.0.16, InnoDB change history
@subsubsection MySQL/InnoDB-3.23.58, September 15, 2003

@itemize @bullet
@item
Fixed a bug: InnoDB could make the index page directory corrupt in the
first B-tree page splits after @file{mysqld} startup. A symptom would be
an assertion failure in @file{page0page.c}, in function
@code{page_dir_find_slot()}.
@item
Fixed a bug: InnoDB could in rare cases return an extraneous row if a
rollback, purge, and a @code{SELECT} coincided.
@item 
Fixed a possible hang over the @file{btr0sea.c} latch if
@code{SELECT} was used inside @code{LOCK TABLES}.
@item 
Fixed a bug: if a single @code{DELETE} statement first managed to delete
some rows and then failed in a @code{FOREIGN KEY} error or a
@code{Table is full} error, MySQL did not roll back the whole SQL statement
as it should. 
@end itemize

@node InnoDB news-4.0.15, InnoDB news-4.0.14, InnoDB news-3.23.58, InnoDB change history
@subsubsection MySQL/InnoDB-4.0.15, September 10, 2003

@itemize @bullet
@item
Fixed a bug: if you updated a row so that the 8000 byte maximum length
(without @code{BLOB} and @code{TEXT}) was exceeded, InnoDB simply removed
the record from the clustered index. In a similar insert, InnoDB would
leak reserved file space extents, which would only be freed at the next
mysqld startup. 
@item
Fixed a bug: if you used big @code{BLOB} values, and your log files were
relatively small, InnoDB could in a big @code{BLOB} operation temporarily
write over the log produced after the latest checkpoint. If InnoDB
would crash at that moment, then the crash recovery would fail,
because InnoDB would not be able to scan the log even up to the
latest checkpoint. Starting from this version, InnoDB tries to ensure
the latest checkpoint is young enough. If that is not possible,
InnoDB prints a warning to the @file{.err} log of MySQL and advises
you to make the log files bigger. 
@item
Fixed a bug: setting @code{innodb_fast_shutdown=0} had no effect. 
@item
Fixed a bug introduced in 4.0.13: if a @code{CREATE TABLE} ended in a
comment, that could cause a memory overrun. 
@item
Fixed a bug: If InnoDB printed @code{Operating system error number .. in
a file operation} to the @file{.err} log in Windows, the error number
explanation was wrong. Workaround: look at section 13.2 of
http://www.innodb.com/ibman.php about Windows
error numbers.
@item
Fixed a bug: If you created a column prefix
@code{PRIMARY KEY} like in @code{t(a CHAR(200), PRIMARY KEY (a(10)))}
on a fixed-length @code{CHAR} column, InnoDB would crash even in a
simple @code{SELECT}. C@code{CHECK TABLE} would report the table as
corrupt, also in the case where the created key was not @code{PRIMARY}. 
@end itemize

@node InnoDB news-4.0.14, InnoDB news-3.23.57, InnoDB news-4.0.15, InnoDB change history
@subsubsection MySQL/InnoDB-4.0.14, July 22, 2003

@itemize bullet
@item
InnoDB now supports the @code{SAVEPOINT} and @code{ROLLBACK TO SAVEPOINT}
SQL statements. See http://www.innodb.com/ibman.php#Savepoints for
the syntax.
@item
You can now create column prefix keys like in
@code{CREATE TABLE t (a BLOB, INDEX (a(10)))}.
@item
You can also use @code{O_DIRECT} as the @code{innodb_flush_method} on the
latest versions of Linux and FreeBSD. Beware of possible bugs in those
operating systems, though. 
@item
Fixed the checksum calculation of data pages. Previously most OS file
system corruption went unnoticed. Note that if you downgrade from
version >= 4.0.14 to an earlier version < 4.0.14 then in the first
startup(s) InnoDB will print warnings: 
@example
InnoDB: Warning: An inconsistent page in the doublewrite buffer
InnoDB: space id 2552202359 page number 8245, 127'th page in dblwr buf.
@end example
but that is not dangerous and can be ignored. 
@item
Modified the buffer pool replacement algorithm so that it tries to
flush modified pages if there are no replaceable pages in the last
10 % of the LRU list. This can reduce disk i/o if the workload is
a mixture of reads and writes. 
@item
The buffer pool checkpoint flush algorithm now tries to flush also
close neighbors of the page at the end of the flush list. This can
speed up database shutdown, and can also speed up disk writes if
InnoDB log files are very small compared to the buffer pool size. 
@item
In 4.0.13 we made @code{SHOW INNODB STATUS} to print detailed info
on the latest @code{UNIQUE KEY} error, but storing that info could
slow down @code{REPLACE} significantly. We no longer store or print
the info. 
@item
Fixed a bug: @code{SET FOREIGN_KEY_CHECKS=0} was not replicated properly
in the MySQL replication. The fix will not be backported to 3.23. 
@item
Fixed a bug: the parameter @code{innodb_max_dirty_pages_pct} forgot to
take into account the free pages in the buffer pool. This could lead
to excessive flushing even though there were lots of free pages in
the buffer pool. Workaround: @code{SET GLOBAL
innodb_max_dirty_pages_pct = 100}.
@item
Fixed a bug: if there were big index scans then a file read request
could starve and InnoDB could assert because of a very long semaphore wait. 
@item
Fixed a bug: if @code{AUTOCOMMIT=1} then inside @code{LOCK TABLES} MySQL
failed to do the commit after an updating SQL statement if binlogging was
not on, and for @code{SELECT} statements did not commit regardless of binlogging state. 
@item
Fixed a bug: InnoDB could make the index page directory corrupt in the
first B-tree page splits after a mysqld startup. A symptom would be an
assertion in page0page.c, in function page_dir_find_slot(). 
@item
Fixed a bug: if in a @code{FOREIGN KEY} with an @code{UPDATE CASCADE}
clause the parent column was of a different internal storage length
than the child column, then a cascaded update would make the column
length wrong in the child table and corrupt the child table. Because
of MySQL's 'silent column specification changes' a fixed-length
@code{CHAR} column can change internally to a @code{VARCHAR} and cause
this error. 
@item
Fixed a bug: if a non-@code{latin1} character set was used and if in a
@code{FOREIGN KEY} the parent column was of a different internal storage
length than the child column, then all inserts to the child table would
fail in a foreign key error. 
@item
Fixed a bug: InnoDB could complain that it cannot find the clustered
index record, or in rare cases return an extraneous row if a rollback,
purge, and a @code{SELECT} coincided. 
@item
Fixed a possible hang over the btr0sea.c latch if @code{SELECT} was used
inside @code{LOCK TABLES}. 
@item
Fixed a bug: contrary to what the release note of 4.0.13 said, the
group commit still did not work if the MySQL binlogging was on. 
@item
Fixed a bug: os_event_wait() did not work properly in Unix, which
might have caused starvation in various log operations. 
@item
Fixed a bug: if a single @code{DELETE} statement first managed to delete
some rows and then failed in a @code{FOREIGN KEY} error or a
'Table is full error', MySQL did not roll back the whole SQL statement
as it should, and also wrote the failed statement to the binlog, reporting
there a non-zero error_code. 
@item
Fixed a bug: the maximum allowed number of columns in a table is 1000, but
InnoDB did not check that limit in @code{CREATE TABLE}, and a subsequent
@code{INSERT} or @code{SELECT} from that table could cause an assertion. 
@end itemize

@node InnoDB news-3.23.57, InnoDB news-4.0.13, InnoDB news-4.0.14, InnoDB change history
@subsubsection MySQL/InnoDB-3.23.57, June 20, 2003 

@itemize bullet
@item
Changed the default value of @code{innodb_flush_log_at_trx_commit} from 0
to 1. If you have not specified it explicitly in your @file{my.cnf}, and
your application runs much slower with this new release, it is because the
value 1 causes a log flush to disk at each transaction commit. 
@item
Fixed a bug: InnoDB forgot to call pthread_mutex_destroy() when a table was
dropped. That could cause memory leakage on FreeBSD and other non-Linux
Unixes. 
@item
Fixed a bug: MySQL could erroneously return 'Empty set' if InnoDB estimated
an index range size to 0 records though the range was not empty; MySQL also
failed to do the next-key locking in the case of an empty index range. 
@item
Fixed a bug: @code{GROUP BY} and @code{DISTINCT} could treat NULL values
inequal. 
@end itemize

@node InnoDB news-4.0.13, InnoDB news-4.1.0, InnoDB news-3.23.57, InnoDB change history
@subsubsection MySQL/InnoDB-4.0.13, May 20, 2003 

@itemize bullet
@item
@code{InnoDB} now supports @code{ALTER TABLE DROP FOREIGN KEY}. You have to use
@code{SHOW CREATE TABLE} to find the internally generated foreign key ID
when you want to drop a foreign key. 
@item
@code{SHOW INNODB STATUS} now prints detailed information of the latest
detected @code{FOREIGN KEY} and @code{UNIQUE KEY} errors. If you do not understand
why @code{InnoDB} gives the error 150 from a @code{CREATE TABLE}, you can use
this statement to study the reason. 
@item
@code{ANALYZE TABLE} now works also for @code{InnoDB} type tables. It makes 10
random dives to each of the index trees and updates index cardinality
estimates accordingly. Note that since it is only an estimate,
repeated runs of @code{ANALYZE TABLE} may produce different numbers. MySQL
uses index cardinality estimates only in join optimization. If some
join is not optimized in the right way, you may try using @code{ANALYZE TABLE}. 
@item
@code{InnoDB} group commit capability now works also when MySQL
binlogging is switched on. There have to be > 2 client threads
for the group commit to become active. 
@item
Changed the default value of @code{innodb_flush_log_at_trx_commit} from
0 to 1. If you have not specified it explicitly in your @file{my.cnf},
and your application runs much slower with this new release, it
is because the value 1 causes a log flush to disk at each transaction
commit. 
@item
Added a new global settable MySQL system variable
@code{innodb_max_dirty_pages_pct}. It is an integer in the range 0 - 100.
The default is 90. The main thread in @code{InnoDB} tries to flush pages
from the buffer pool so that at most this many percents are not yet
flushed at any time. 
@item
If @code{innodb_force_recovery=6}, do not let @code{InnoDB} do repair of corrupt
pages based on the doublewrite buffer. 
@item
@code{InnoDB} start-up now happens faster because it does not set the
memory in the buffer pool to zero. 
@item
Fixed a bug: The @code{InnoDB} parser for @code{FOREIGN KEY} definitions was
confused by the keywords 'foreign key' inside MySQL comments. 
@item
Fixed a bug: If you dropped a table to which there was a @code{FOREIGN
KEY} reference, and later created the same table with non-matching
column types, @code{InnoDB} could assert in @file{dict0load.c}, in function
@code{dict_load_table()}. 
@item
Fixed a bug: @code{GROUP BY} and @code{DISTINCT} could treat @code{NULL}
values as not equal.
MySQL also failed to do the next-key locking in the case of an
empty index range. 
@item
Fixed a bug: Do not commit the current transaction when a MyISAM
table is updated; this also makes @code{CREATE TABLE} not to commit an
@code{InnoDB} transaction, even when binlogging is enabled. 
@item
Fixed a bug: We did not allow @code{ON DELETE SET NULL} to modify the same
table where the delete was made; we can allow it because that cannot
produce infinite loops in cascaded operations. 
@item
Fixed a bug: Allow @code{HANDLER PREV} and @code{NEXT} also after positioning
the cursor with a unique search on the primary key.
@item
Fixed a bug: If @code{MIN()} or @code{MAX()} resulted in a deadlock or a lock
wait timeout, MySQL did not return an error, but returned @code{NULL} as the
function value.
@item
Fixed a bug: @code{InnoDB} forgot to call @code{pthread_mutex_destroy()} when
a table was dropped. That could cause memory leakage on FreeBSD
and other non-Linux Unix systems. 
@end itemize


@node InnoDB news-4.1.0, InnoDB news-3.23.56, InnoDB news-4.0.13, InnoDB change history
@subsubsection MySQL/InnoDB-4.1.0, April 3, 2003 

@itemize @bullet
@item
@code{InnoDB} now supports up to 64 GB of buffer pool memory in a
Windows 32-bit Intel computer. This is possible because @code{InnoDB}
can use the AWE extension of Windows to address memory over
the 4 GB limit of a 32-bit process. A new startup variable
@code{innodb_buffer_pool_awe_mem_mb} enables AWE and sets the size
of the buffer pool in megabytes. 
@item
Reduced the size of buffer headers and the lock table. @code{InnoDB} uses
2 % less memory. 
@end itemize


@node InnoDB news-3.23.56, InnoDB news-4.0.12, InnoDB news-4.1.0, InnoDB change history
@subsubsection MySQL/InnoDB-3.23.56, March 17, 2003 

@itemize @bullet
@item
Fixed a major bug in InnoDB query optimization: queries of type
SELECT ... WHERE indexcolumn < x and SELECT ... WHERE
indexcolumn > x could cause a table scan even if the selectivity
would have been very good.
@item 
Fixed a potential bug if MySQL calls store_lock with TL_IGNORE
in the middle of a query. 
@end itemize


@node InnoDB news-4.0.12, InnoDB news-4.0.11, InnoDB news-3.23.56, InnoDB change history
@subsubsection MySQL/InnoDB-4.0.12, March 18, 2003 

@itemize @bullet
@item
In crash recovery InnoDB now prints the progress in percents of a
transaction rollback.
@item
Fixed a bug/feature: if your application program used
mysql_use_result(), and used >= 2 connections to send
SQL queries, it could deadlock on the adaptive hash S-latch
in btr0sea.c. Now mysqld releases the S-latch whenever it
passes data from a SELECT to the client. 
@item
Fixed a bug: MySQL could erroneously return 'Empty set'
if InnoDB estimated an index range size to 0 records though
the range was not empty; MySQL also failed to do the next-key
locking in the case of an empty index range. 
@end itemize


@node InnoDB news-4.0.11, InnoDB news-4.0.10, InnoDB news-4.0.12, InnoDB change history
@subsubsection MySQL/InnoDB-4.0.11, February 25, 2003 

@itemize @bullet
@item
Fixed a bug introduced in 4.0.10: SELECT ... FROM ... ORDER BY ... DESC
could hang in an infinite loop. 
@item
An outstanding bug: SET FOREIGN_KEY_CHECKS=0 is not replicated properly
in the MySQL replication.
@end itemize


@node InnoDB news-4.0.10, InnoDB news-3.23.55, InnoDB news-4.0.11, InnoDB change history
@subsubsection MySQL/InnoDB-4.0.10, February 4, 2003 

@itemize @bullet
@item
In INSERT INTO t1 SELECT ... FROM t2 WHERE ... MySQL previously
set a table level read lock on t2. This lock is now removed. 
@item
Increased SHOW INNODB STATUS max printed length to 200 KB.
@item
Fixed a major bug in InnoDB query optimization: queries of type
SELECT ... WHERE indexcolumn < x and SELECT ... WHERE
indexcolumn > x could cause a table scan even if the
selectivity would have been very good. 
@item
Fixed a bug: purge could cause a hang in a BLOB table where the
primary key index tree was of height 1. Symptom: semaphore waits
caused by an X-latch set in btr_free_externally_stored_field(). 
@item
Fixed a bug: using InnoDB HANDLER commands on a fresh handle
crashed mysqld in ha_innobase::change_active_index(). 
@item
Fixed a bug: if MySQL estimated a query in the middle of a SELECT
statement, InnoDB could hang on the adaptive hash index latch in btr0sea.c. 
@item
Fixed a bug: InnoDB could report table corruption and assert
in page_dir_find_owner_slot() if an adaptive hash index search
coincided with purge or an insert. 
@item
Fixed a bug: some file system snapshot tool in Windows 2000 could
cause an InnoDB file write to fail with error 33 ERROR_LOCK_VIOLATION.
In synchronous writes InnoDB now retries the write 100 times at 1
second intervals. 
@item
Fixed a bug: REPLACE INTO t1 SELECT ... did not work if t1 has an
auto-inc column. 
@item
An outstanding bug: SET FOREIGN_KEY_CHECKS=0 is not replicated properly
in the MySQL replication.
@end itemize


@node InnoDB news-3.23.55, InnoDB news-4.0.9, InnoDB news-4.0.10, InnoDB change history
@subsubsection MySQL/InnoDB-3.23.55, January 24, 2003

@itemize @bullet
@item
In INSERT INTO t1 SELECT ... FROM t2 WHERE ... MySQL previously set
a table level read lock on t2. This lock is now removed.
@item
Fixed a bug: if the combined size of InnoDB log files was >= 2 GB 
in a 32-bit computer, InnoDB would write log in a wrong
position. That could make crash recovery and InnoDB Hot Backup
to fail in log scan. 
@item
Fixed a bug: index cursor restoration could theoretically fail. 
@item
Fixed a bug: an assertion in btr0sea.c, in function
btr_search_info_update_slow could theoretically fail in a race of 3 threads. 
@item
Fixed a bug: purge could cause a hang in a BLOB table where the
primary key index tree was of height 1. Symptom: semaphore waits
caused by an X-latch set in btr_free_externally_stored_field(). 
@item
Fixed a bug: if MySQL estimated a query in the middle of a SELECT statement,
InnoDB could hang on the adaptive hash index latch in btr0sea.c. 
@item
Fixed a bug: InnoDB could report table corruption and assert in
page_dir_find_owner_slot() if an adaptive hash index search
coincided with purge or an insert. 
@item
Fixed a bug: some file system snapshot tool in Windows 2000 could
cause an InnoDB file write to fail with error 33 ERROR_LOCK_VIOLATION.
In synchronous writes InnoDB now retries the write 100 times
at 1 second intervals. 
@item
An outstanding bug: SET FOREIGN_KEY_CHECKS=0 is not replicated properly
in the MySQL replication. The fix will appear in 4.0.11 and will probably
not be backported to 3.23.
@item
Fixed bug in InnoDB page0cur.c in function page_cur_search_with_match
which caused InnoDB to remain on the same page forever.
This bug is evident only in tables with more than one page.
@end itemize


@node InnoDB news-4.0.9, InnoDB news-4.0.8, InnoDB news-3.23.55, InnoDB change history
@subsubsection MySQL/InnoDB-4.0.9, January 14, 2003

@itemize @bullet
@item
Removed the warning message: 'InnoDB: Out of memory in additional memory pool.'
@item
Fixed a bug: if the combined size of InnoDB log files was >= 2 GB in a
32-bit computer, InnoDB would write log in a wrong position. That could
make crash recovery and InnoDB Hot Backup to fail. 
@item
Fixed a bug: index cursor restoration could theoretically fail. 
@end itemize


@node InnoDB news-4.0.8, InnoDB news-4.0.7, InnoDB news-4.0.9, InnoDB change history
@subsubsection MySQL/InnoDB-4.0.8, January 7, 2003

@itemize @bullet
@item
InnoDB now supports also FOREIGN KEY (...) REFERENCES ...(...)
[ON UPDATE CASCADE | ON UPDATE SET NULL | ON UPDATE RESTRICT
| ON UPDATE NO ACTION]. 
@item
Tables and indexes now reserve 4 % less space in the tablespace.
Also existing tables reserve less space. By upgrading to 4.0.8
you will see more free space in "InnoDB free" in SHOW TABLE STATUS. 
@item
Fixed bugs: updating the PRIMARY KEY of a row would generate a
foreign key error on all FOREIGN KEYs which referenced secondary
keys of the row to be updated. Also, if a referencing
FOREIGN KEY constraint only referenced the first columns in an
index, and there were more columns in that index, updating the
additional columns generated a foreign key error. 
@item
Fixed a bug: if an index contains some column twice, and that
column is updated, the table will become corrupt. From now on
InnoDB prevents creation of such indexes. 
@item
Fixed a bug: removed superfluous error 149 and 150 printouts
from the .err log when a locking SELECT caused a deadlock or a
lock wait timeout.
@item
Fixed a bug: an assertion in btr0sea.c, in function
btr_search_info_update_slow could theoretically fail in a race of 3 threads. 
@item
Fixed a bug: one could not switch a session transaction isolation
level back to REPEATABLE READ after setting it to something else.
@end itemize


@node InnoDB news-4.0.7, InnoDB news-4.0.6, InnoDB news-4.0.8, InnoDB change history
@subsubsection MySQL/InnoDB-4.0.7, December 26, 2002

@itemize @bullet
@item
InnoDB in 4.0.7 is essentially the same as in 4.0.6.
@end itemize


@node InnoDB news-4.0.6, InnoDB news-3.23.54, InnoDB news-4.0.7, InnoDB change history
@subsubsection MySQL/InnoDB-4.0.6, December 19, 2002

@itemize @bullet
@item
Since innodb_log_arch_dir has no relevance under MySQL,
there is no need to specify it any more in my.cnf. 
@item
LOAD DATA INFILE in AUTOCOMMIT=1 mode no longer does
implicit commits for each 1 MB of written binlog. 
@item
Fixed a bug introduced in 4.0.4: LOCK TABLES ... READ LOCAL
should not set row locks on the rows read. This caused
deadlocks and lock wait timeouts in mysqldump. 
@item
Fixed two bugs introduced in 4.0.4: in AUTO_INCREMENT,
REPLACE could cause the counter to be left 1 too low.
A deadlock or a lock wait timeout could cause the same problem. 
@item
Fixed a bug: TRUNCATE on a TEMPORARY table crashed InnoDB. 
@item
Fixed a bug introduced in 4.0.5: if binlogging was not switched on,
INSERT INTO ... SELECT ... or CREATE TABLE ... SELECT ... could
cause InnoDB to hang on a semaphore created in btr0sea.c, line 128.
Workaround: switch binlogging on. 
@item
Fixed a bug: in replication issuing SLAVE STOP in the middle of
a multiple-statement transaction could cause that SLAVE START would
only perform a part of the transaction. A similar error could occur
if the slave crashed and was restarted.
@end itemize


@node InnoDB news-3.23.54, InnoDB news-4.0.5, InnoDB news-4.0.6, InnoDB change history
@subsubsection MySQL/InnoDB-3.23.54, December 12, 2002

@itemize @bullet
@item
Fixed a bug: the InnoDB range estimator greatly exaggerated
the size of a short index range if the paths to the endpoints of
the range in the index tree happened to branch already in the root.
This could cause unnecessary table scans in SQL queries. 
@item
Fixed a bug: ORDER BY could fail if you had not created a
primary key to a table, but had defined several indexes
of which at least one was a UNIQUE index with all its
columns declared as NOT NULL. 
@item
Fixed a bug: a lock wait timeout in connection with
ON DELETE CASCADE could cause corruption in indexes. 
@item
Fixed a bug: if a SELECT was done with a unique key
from a primary index, and the search matched to a
delete-marked record, InnoDB could erroneously return the NEXT record. 
@item
Fixed a bug introduced in 3.23.53: LOCK TABLES ... READ LOCAL
should not set row locks on the rows read. This caused deadlocks
and lock wait timeouts in mysqldump. 
@item
Fixed a bug: if an index contains some column twice, and that
column is updated, the table will become corrupt. From now on
InnoDB prevents creation of such indexes. 
@end itemize


@node InnoDB news-4.0.5, InnoDB news-3.23.53, InnoDB news-3.23.54, InnoDB change history
@subsubsection MySQL/InnoDB-4.0.5, November 18, 2002

@itemize @bullet
@item
InnoDB now supports also transaction isolation levels READ COMMITTED
and READ UNCOMMITTED. READ COMMITTED more closely emulates Oracle
and makes porting of applications from Oracle to MySQL easier. 
@item
Deadlock resolution is now selective: we try to pick as victims
transactions with less modified or inserted rows. 
@item
FOREIGN KEY definitions are now aware of the
lower_case_table_names setting in my.cnf. 
@item
SHOW CREATE TABLE does not output the database name
to a FOREIGN KEY definition if the referred table is
in the same database as the table. 
@item
InnoDB does a consistency check to most index pages
before writing them to a datafile. 
@item
If you set innodb_force_recovery > 0, InnoDB tries to
jump over corrupt index records and pages when doing
SELECT * FROM table. This helps in dumping. 
@item
InnoDB now again uses asynchronous unbuffered I/O in
Windows 2000 and XP; only unbuffered simulated async
I/O in NT, 95/98/ME. 
@item
Fixed a bug: the InnoDB range estimator greatly exaggerated
the size of a short index range if the paths to the
endpoints of the range in the index tree happened
to branch already in the root. This could cause
unnecessary table scans in SQL queries.
The fix will also be backported to 3.23.54. 
@item
Fixed a bug present in 3.23.52, 4.0.3, 4.0.4:
InnoDB startup could take very long or even
crash on some Windows 95/98/ME computers. 
@item
Fixed a bug: the AUTO-INC lock was held to the end
of the transaction if it was granted after a
lock wait. This could cause unnecessary deadlocks. 
@item
Fixed a bug: if SHOW INNODB STATUS, innodb_monitor,
or innodb_lock_monitor had to print several hundred
transactions in one report, and the output became
truncated, InnoDB would hang, printing to the error
log many waits for a mutex created at srv0srv.c, line 1621. 
@item
Fixed a bug: SHOW INNODB STATUS on Unix always
reported average file read size as 0 bytes. 
@item
Fixed a potential bug in 4.0.4: InnoDB now
does ORDER BY ... DESC like MyISAM. 
@item
Fixed a bug: DROP TABLE could cause crash or a
hang if there was a rollback concurrently running
on the table. The fix will be backported to 3.23
only if this appears a real problem for users. 
@item
Fixed a bug: ORDER BY could fail if you had not
created a primary key to a table, but had defined
several indexes of which at least one was a UNIQUE
index with all its columns declared as NOT NULL. 
@item
Fixed a bug: a lock wait timeout in connection
with ON DELETE CASCADE could cause corruption in indexes. 
@item
Fixed a bug: if a SELECT was done with a unique
key from a primary index, and the search matched
to a delete-marked record, InnoDB could return the NEXT record. 
@item
Outstanding bugs: in 4.0.4 two bugs were introduced
to AUTO_INCREMENT. REPLACE can cause the counter to
be left 1 too low. A deadlock or a lock wait timeout
can cause the same problem. These will be fixed in 4.0.6.
@end itemize


@node InnoDB news-3.23.53, InnoDB news-4.0.4, InnoDB news-4.0.5, InnoDB change history
@subsubsection MySQL/InnoDB-3.23.53, October 9, 2002

@itemize @bullet
@item
We again use unbuffered disk I/O to datafiles in Windows.
Windows XP and Windows 2000 read performance seems to be
very poor with normal I/O. 
@item
Tuned range estimator so that index range scans are
preferred over full index scans. 
@item
Allow dropping and creating a table even if
innodb_force_recovery is set. One can use this to
drop a table which would cause a crash in rollback
or purge, or if a failed table import causes a runaway rollback in recovery. 
@item
Fixed a bug present in 3.23.52, 4.0.3, 4.0.4: InnoDB startup
could take very long or even crash on some Windows 95/98/ME computers. 
@item
Fixed a bug: fast shutdown (which is the default)
sometimes was slowed down by purge and insert buffer merge. 
@item
Fixed a bug: doing a big SELECT from a table where no
rows were visible in a consistent read could cause a
very long (> 600 seconds) semaphore wait in btr0cur.c line 310. 
@item
Fixed a bug: the AUTO-INC lock was held to the end of
the transaction if it was granted after a lock wait.
This could cause unnecessary deadlocks. 
@item
Fixed a bug: if you created a temporary table
inside LOCK TABLES, and used that temporary table,
that caused an assertion failure in ha_innobase.cc. 
@item
Fixed a bug: if SHOW INNODB STATUS, innodb_monitor,
or innodb_lock_monitor had to print several hundred
transactions in one report, and the output became
truncated, InnoDB would hang, printing to the error
log many waits for a mutex created at srv0srv.c, line 1621. 
@item
Fixed a bug: SHOW INNODB STATUS on Unix always
reported average file read size as 0 bytes.
@end itemize


@node InnoDB news-4.0.4, InnoDB news-4.0.3, InnoDB news-3.23.53, InnoDB change history
@subsubsection MySQL/InnoDB-4.0.4, October 2, 2002

@itemize @bullet
@item
We again use unbuffered disk I/O in Windows. Windows XP and Windows 2000
read performance seems to be very poor with normal I/O.
@item
Increased the max key length of InnoDB tables from 500 to 1024 bytes.
@item
Increased the table comment field in SHOW TABLE STATUS so that
up to 16000 characters of foreign key definitions can be printed there.
@item
The auto-increment counter is no longer incremented if
an insert of a row immediately fails in an error.
@item
Allow dropping and creating a table even if
innodb_force_recovery is set. One can use this to drop
a table which would cause a crash in rollback or purge,
or if a failed table import causes a runaway rollback in recovery.
@item
Fixed a bug: Using ORDER BY primarykey DESC in 4.0.3 causes
an assertion failure in btr0pcur.c, line 203.
@item
Fixed a bug: fast shutdown (which is the default) sometimes
was slowed down by purge and insert buffer merge.
@item
Fixed a bug: doing a big SELECT from a table where
no rows were visible in a consistent read could cause
a very long (> 600 seconds) semaphore wait in btr0cur.c line 310.
@item
Fixed a bug: if the MySQL query cache was used, it did not get
invalidated by a modification done by ON DELETE CASCADE or ...SET NULL.
@item
Fixed a bug: if you created a temporary table inside LOCK TABLES,
and used that temporary table, that caused an assertion failure
in ha_innodb.cc.
@item
Fixed a bug: if you set innodb_flush_log_at_trx_commit to 1, SHOW
VARIABLES would show its value as 16 million.
@end itemize


@node InnoDB news-4.0.3, InnoDB news-3.23.52, InnoDB news-4.0.4, InnoDB change history
@subsubsection MySQL/InnoDB-4.0.3, August 28, 2002

@itemize @bullet
@item
Removed unnecessary deadlocks when inserts have to wait for
a locking read, update, or delete to release its next-key lock.
@item
The MySQL @code{HANDLER} SQL commands now work also for @code{InnoDB}
type tables. @code{InnoDB} does the @code{HANDLER} reads always as
consistent reads. @code{HANDLER} is a direct access path to read
individual indexes of tables. In some cases @code{HANDLER} can be
used as a substitute of server-side cursors.
@item
Fixed a bug in 4.0.2: even a simple insert could crash the
AIX version.
@item
Fixed a bug: if you used in a table name characters whose code is > 127,
in DROP TABLE InnoDB could assert on line 155 of pars0sym.c.
@item
Compilation from source now provides a working version both on
HP-UX-11 and HP-UX-10.20. The source of 4.0.2 worked only on 11,
and the source of 3.23.52 only on 10.20.
@item
Fixed a bug: if compiled on 64-bit Solaris, InnoDB produced a bus error
at startup.
@end itemize


@node InnoDB news-3.23.52, InnoDB news-4.0.2, InnoDB news-4.0.3, InnoDB change history
@subsubsection MySQL/InnoDB-3.23.52, August 16, 2002

@itemize @bullet
@item
The feature set of 3.23 will be frozen from this version on. New features
will go the 4.0 branch, and only bug fixes will be made to the 3.23
branch.
@item
Many CPU-bound join queries now run faster. On Windows also many
other CPU-bound queries run faster.
@item
A new SQL command SHOW INNODB STATUS returns the output of the
InnoDB Monitor to the client. The InnoDB Monitor now prints detailed
information on
the latest detected deadlock.
@item
InnoDB made the SQL query optimizer to avoid too much index-only
range scans and choose full table scans instead. This is now fixed.
@item
@code{BEGIN} and @code{COMMIT} are now added in the binlog around transactions.
The MySQL replication now respects transaction borders:
a user will no longer see half transactions in replication slaves.
@item
A replication slave now prints in crash recovery the last
master binlog position it was able to recover to.
@item
A new setting innodb_flush_log_at_trx_commit=2 makes InnoDB to write
the log to the operating system file cache at each commit. This is
almost as fast as the setting innodb_flush_log_at_trx_commit=0, and
the setting 2 also has the nice feature that in a crash where the
operating system does not crash, no committed transaction is lost.
If the operating system crashes or there is a power outage, then
the setting 2 is no safer than the setting 0.
@item
Added checksum fields to log blocks.
@item
SET FOREIGN_KEY_CHECKS=0 helps in importing tables
in an arbitrary order which does not respect the foreign key rules.
@item
SET UNIQUE_CHECKS=0 speeds up table imports into InnoDB
if you have UNIQUE constraints on secondary indexes.
This flag should be used only if you are certain that the input records
contain no UNIQUE constraint violations.
@item
SHOW TABLE STATUS now lists also possible ON DELETE CASCADE or
ON DELETE SET NULL in the comment field of the table.
@item
When CHECK TABLE is run on any InnoDB type table, it now
checks also the adaptive hash index for all tables.
@item
If you defined ON DELETE CASCADE or SET NULL and updated the
referenced key in the parent row, InnoDB deleted or updated
the child row. This is now changed to conform to SQL-92: you get
the error 'Cannot delete parent row'.
@item
Improved the auto-increment algorithm: now the first insert or
SHOW TABLE STATUS initializes the auto-increment counter for the table.
This removes almost all surprising deadlocks caused by
SHOW TABLE STATUS.
@item
Aligned some buffers used in reading and writing to datafiles.
This allows using unbuffered raw devices as datafiles in Linux.
@item
Fixed a bug: If you updated the primary key of a table so that only the
case of characters changed, that could cause assertion
failures, mostly in page0page.ic line 515.
@item
Fixed a bug: If you delete or update a row referenced in a foreign key
constraint and the foreign key check has to wait for a lock,
then the check may report an erroneous result. This
affects also the ON DELETE... operation.
@item
Fixed a bug: A deadlock or a lock wait timeout error in InnoDB
causes InnoDB to roll back the whole transaction, but MySQL could still
write the earlier SQL statements to the binlog, even though
InnoDB rolled them back. This could, for example, cause replicated
databases to get out-of-sync.
@item
Fixed a bug: If the database happened to crash in the middle of a
commit, then the recovery might leak tablespace pages.
@item
Fixed a bug: If you specified a non-latin1 character set in my.cnf,
then, in contrary to what is stated in the manual, in a foreign key
constraint a string type column had to have the same length specification
in the referencing table and the referenced table.
@item
Fixed a bug: DROP TABLE or DROP DATABASE could fail if there
simultaneously was a CREATE TABLE running.
@item
Fixed a bug: If you configured the buffer pool bigger than 2 GB in
a 32-bit computer, InnoDB would assert in buf0buf.ic line 214.
@item
Fixed a bug: on 64-bit computers updating rows which contained the
SQL NULL in some column could cause the undo log and the ordinary
log to become corrupt.
@item
Fixed a bug: innodb_log_monitor caused a hang if it suppressed
lock prints for a page.
@item
Fixed a bug: in the HP-UX-10.20 version mutexes would leak and cause
race conditions and crashes in any part of InnoDB code.
@item
Fixed a bug: if you ran in the AUTOCOMMIT mode, executed a SELECT,
and immediately after that a RENAME TABLE, then RENAME would fail and
MySQL would complain about error 1192.
@item
Fixed a bug: if compiled on 64-bit Solaris, InnoDB produced a bus error
at startup.
@end itemize


@node InnoDB news-4.0.2, InnoDB news-3.23.51, InnoDB news-3.23.52, InnoDB change history
@subsubsection MySQL/InnoDB-4.0.2, July 10, 2002

@itemize @bullet
@item
InnoDB is essentially the same as InnoDB-3.23.51.
@item
If no innodb_data_file_path is specified, InnoDB at the database creation
now creates a 10 MB auto-extending datafile ibdata1 to the datadir
of MySQL. In 4.0.1 the file was 64 MB and not auto-extending.
@end itemize


@node InnoDB news-3.23.51, InnoDB news-3.23.50, InnoDB news-4.0.2, InnoDB change history
@subsubsection MySQL/InnoDB-3.23.51, June 12, 2002

@itemize @bullet
@item
Fixed a bug: a join could result in a seg fault in copying of a BLOB or
TEXT column if some of the BLOB or TEXT columns in the table contained
SQL NULL values.
@item
Fixed a bug: if you added self-referential foreign key constraints with
ON DELETE CASCADE to tables and a row deletion caused InnoDB
to attempt the deletion of the same row twice because of
a cascading delete, then you got an assertion failure.
@item
Fixed a bug: if you use MySQL 'user level locks' and close
a connection, then InnoDB may assert in ha_innobase.cc, line 302.
@end itemize


@node InnoDB news-3.23.50, InnoDB news-3.23.49, InnoDB news-3.23.51, InnoDB change history
@subsubsection MySQL/InnoDB-3.23.50, April 23, 2002

@itemize @bullet
@item
InnoDB now supports an auto-extending last datafile. You do not need
to preallocate the whole datafile at the database startup.
@item
Made several changes to facilitate the use of the InnoDB Hot Backup
tool. It is a separate non-free tool you can use to take online backups
of your database without shutting down the server or setting
any locks.
@item
If you want to run the InnoDB Hot Backup tool on an auto-extending
datafile you have to upgrade it to version ibbackup-0.35.
@item
The log scan phase in crash recovery will now run much faster.
@item
Starting from this server version, the hot backup tool
truncates unused ends in the backup InnoDB datafiles.
@item
To allow the hot backup tool to work, on Windows we no longer use
unbuffered I/O or native async I/O; instead we use the same simulated
async I/O as on Unix.
@item
You can now define the ON DELETE CASCADE or ON DELETE SET NULL
clause on foreign keys.
@item
FOREIGN KEY constraints now survive ALTER TABLE and CREATE
INDEX.
@item
We suppress the FOREIGN KEY check if any of the column values in the
foreign key or referenced key to be checked is the SQL NULL. This
is compatible with Oracle, for example.
@item
SHOW CREATE TABLE now lists also foreign key constraints. Also
mysqldump no longer forgets about foreign keys in table definitions.
@item
You can now add a new foreign key constraint with
ALTER TABLE ... ADD CONSTRAINT FOREIGN KEY (...) REFERENCES ... (...).
@item
FOREIGN KEY definitions now allow backquotes around table and
column names.
@item
MySQL command
SET TRANSACTION ISOLATION LEVEL ...
has now the following effect on
InnoDB tables: if a transaction is defined as SERIALIZABLE
then InnoDB conceptually adds LOCK IN SHARE MODE
to all consistent reads. If a transaction is defined to have any other
isolation level, then InnoDB obeys its default locking strategy
which is REPEATABLE READ.
@item
SHOW TABLE STATUS no longer sets an x-lock at the end of an
auto-increment index if the auto-increment counter has already
been initialized. This removes in almost all cases the surprising deadlocks
caused by SHOW TABLE STATUS.
@item
Fixed a bug: in a CREATE TABLE statement the string 'foreign'
followed by a non-space character confused the FOREIGN KEY parser
and caused table creation to fail with errno 150.
@end itemize


@node InnoDB news-3.23.49, InnoDB news-3.23.48, InnoDB news-3.23.50, InnoDB change history
@subsubsection MySQL/InnoDB-3.23.49, February 17, 2002

@itemize @bullet
@item
Fixed a bug: if you called DROP DATABASE for a database on which
there simultaneously were running queries, the MySQL server could crash
or hang. Crashes fixed, but a full fix has to wait some changes
in the MySQL layer of code.
@item
Fixed a bug: on Windows one had to put the database name
in lowercase for @code{DROP
DATABASE} to work. Fixed in 3.23.49: case no longer matters
on Windows. On Unix, the database name remains case sensitive.
@item
Fixed a bug: if one defined a non-latin1 character set as
the default character set,
then definition of foreign key constraints could fail
in an assertion failure
in dict0crea.c, reporting an internal error 17.
@end itemize


@node InnoDB news-3.23.48, InnoDB news-3.23.47, InnoDB news-3.23.49, InnoDB change history
@subsubsection MySQL/InnoDB-3.23.48, February 9, 2002

@itemize @bullet
@item
Tuned the SQL optimizer to favor more often index searches
over table scans.
@item
Fixed a performance problem when several large SELECT
queries are run concurrently on a multiprocessor Linux computer.
Large CPU-bound SELECT queries will now also generally run faster on
all platforms.
@item
If MySQL binlogging is used,
InnoDB now prints after crash recovery the latest MySQL binlog
file name and the position in that file (= byte offset)
InnoDB was able to recover to. This is useful, for example,
when resynchronizing a master and a slave database in replication.
@item
Added better error messages to help in installation problems.
@item
One can now recover also MySQL temporary tables which have become
orphaned inside the InnoDB tablespace.
@item
InnoDB now prevents a FOREIGN KEY declaration where the signedness
is not the same in the referencing and referenced integer columns.
@item
Fixed a bug: calling SHOW CREATE TABLE or SHOW TABLE STATUS
could cause memory corruption and make mysqld to crash.
Especially at risk was mysqldump, because it calls frequently
SHOW CREATE TABLE.
@item
Fixed a bug: if on Unix you did an ALTER TABLE to an InnoDB table and
simultaneously did queries to it, mysqld could crash with an assertion
failure in row0row.c, line 474.
@item
Fixed a bug: if inserts to several tables containing an auto-inc column
were wrapped inside one LOCK TABLES, InnoDB asserted in lock0lock.c.
@item
In 3.23.47 we allowed several NULLS in a UNIQUE secondary index.
But CHECK TABLE was not relaxed: it reports the table as corrupt.
CHECK TABLE no longer complains in this situation.
@item
Fixed a bug: on Sparc and other high-endian processors SHOW VARIABLES
showed innodb_flush_log_at_trx_commit and other boolean-valued
startup parameters always OFF even if they were switched on. 
@item
Fixed a bug: if you ran mysqld-max-nt as a service on Windows NT/2000,
the service shutdown did not always wait long enough for the InnoDB shutdown
to finish.
@end itemize


@node InnoDB news-3.23.47, InnoDB news-4.0.1, InnoDB news-3.23.48, InnoDB change history
@subsubsection MySQL/InnoDB-3.23.47, December 28, 2001

@itemize @bullet
@item
Recovery happens now faster, especially in a lightly loaded system,
because background checkpointing has been made more frequent.
@item
InnoDB allows now several similar key values in a UNIQUE secondary index
if those values contain SQL NULLs. Thus the convention is now the same as in
MyISAM tables.
@item
InnoDB gives a better row count estimate for a table which contains BLOBs.
@item
In a FOREIGN KEY constraint InnoDB is now case-insensitive to column
names, and in Windows also to table names.
@item
InnoDB allows a FOREIGN KEY column of CHAR type to refer to a column of
VARCHAR type, and vice versa. MySQL silently changes the type of some
columns between CHAR and VARCHAR, and these silent changes do not hinder
FOREIGN KEY declaration any more.
@item
Recovery has been made more resilient to corruption of log files.
@item
Unnecessary statistics calculation has been removed from queries which
generate a temporary table. Some ORDER BY and DISTINCT queries will now run
much faster.
@item
MySQL now knows that the table scan of an InnoDB table is done through the
primary key. This will save a sort in some ORDER BY queries.
@item
The maximum key length of InnoDB tables is again restricted to 500 bytes.
The MySQL interpreter is not able to handle longer keys.
@item
The default value of innodb_lock_wait_timeout was changed from infinite to
50 seconds, the default value of innodb_file_io_threads from 9
to 4.
@end itemize


@node InnoDB news-4.0.1, InnoDB news-3.23.46, InnoDB news-3.23.47, InnoDB change history
@subsubsection MySQL/InnoDB-4.0.1, December 23, 2001

@itemize @bullet
@item
InnoDB is the same as in 3.23.47.
@item
In 4.0.0 the MySQL interpreter did not know the syntax LOCK IN
SHARE MODE. This has been fixed.
@item
In 4.0.0 multiple-table delete did not work for transactional tables.
This has been fixed.
@end itemize


@node InnoDB news-3.23.46, InnoDB news-3.23.45, InnoDB news-4.0.1, InnoDB change history
@subsubsection MySQL/InnoDB-3.23.46, November 30, 2001

@itemize @bullet
@item
This is the same as 3.23.45.
@end itemize


@node InnoDB news-3.23.45, InnoDB news-3.23.44, InnoDB news-3.23.46, InnoDB change history
@subsubsection MySQL/InnoDB-3.23.45, November 23, 2001

@itemize @bullet
@item
This is a bugfix release.
@item
In versions 3.23.42-.44 when creating a table on Windows you
have to use lowercase letters in the database name to be able to
access the table. Fixed in 3.23.45.
@item
InnoDB now flushes stdout and stderr every 10 seconds: if these
are redirected to files, the file contents can be better viewed with
an editor.
@item
Fixed an assertion failure in .44, in trx0trx.c, line 178
when you drop a table which has
the .frm file but does not exist inside InnoDB.
@item
Fixed a bug in the insert buffer.
The insert buffer tree could get into an inconsistent state, causing a crash,
and also crashing the recovery. This bug could appear especially in
large table imports or alterations.
@item
Fixed a bug in recovery: InnoDB could go into an infinite loop
constantly printing
a warning message that it cannot find free blocks from the buffer pool.
@item
Fixed a bug: when you created a temporary table of the InnoDB type, and then
used ALTER TABLE to it, the MySQL server could crash.
@item
Prevented creation of MySQL system tables 'mysql.user',
'mysql.host', or 'mysql.db', in the
InnoDB type.
@item
Fixed a bug which can cause an assertion failure in 3.23.44 in
srv0srv.c, line 1728.
@end itemize


@node InnoDB news-3.23.44, InnoDB news-3.23.43, InnoDB news-3.23.45, InnoDB change history
@subsubsection MySQL/InnoDB-3.23.44, November 2, 2001

@itemize @bullet
@item
You can define foreign key constraints on InnoDB
tables. An example: FOREIGN KEY (col1) REFERENCES table2(col2).
@item
You can create > 4 GB datafiles in those
file systems that allow it.
@item
Improved InnoDB monitors, including a new innodb_table_monitor
which allows you to print the contents of the InnoDB internal data
dictionary.
@item
DROP DATABASE will now work also for InnoDB tables.
@item
Accent characters in the default character set
latin1 will be ordered according to the MySQL ordering.<br>
NOTE: if you are using latin1 and have inserted characters
whose code is > 127 to an indexed CHAR column, you should run
CHECK TABLE on your table when you upgrade to
3.23.43, and drop and reimport the table if CHECK TABLE
reports an error!
@item
InnoDB will calculate better table cardinality
estimates.
@item
Change in deadlock resolution:
in .43 a deadlock rolls back only the
SQL statement, in .44 it will roll back the whole transaction.
@item
Deadlock, lock wait timeout, and foreign key
constraint violations (no parent row, child rows exist)
now return native MySQL
error codes 1213, 1205, 1216, 1217, respectively.
@item
A new my.cnf parameter innodb_thread_concurrency
helps in performance tuning in high concurrency environments.
@item
A new my.cnf option innodb_force_recovery will
help you in dumping tables from a corrupted database.
@item
A new my.cnf option innodb_fast_shutdown will
speed up shutdown. Normally InnoDB does a full purge
and an insert buffer merge at shutdown.
@item
Raised maximum key length to 7000 bytes from a
previous limit of 500 bytes.
@item
Fixed a bug in replication of auto-inc columns with multiline inserts.
@item
Fixed a bug when the case of letters changes in an update of an indexed
secondary column.
@item
Fixed a hang when there are > 24 datafiles.
@item
Fixed a crash when MAX(col) is selected from an empty table, and col is a
not the first column in a multi-column index.
@item
Fixed a bug in purge which could cause crashes.
@end itemize


@node InnoDB news-3.23.43, InnoDB news-3.23.42, InnoDB news-3.23.44, InnoDB change history
@subsubsection MySQL/InnoDB-3.23.43, October 4, 2001

@itemize @bullet
@item
This is essentially the same as InnoDB-3.23.42.
@end itemize


@node InnoDB news-3.23.42, InnoDB news-3.23.41, InnoDB news-3.23.43, InnoDB change history
@subsubsection MySQL/InnoDB-3.23.42, September 9, 2001

@itemize @bullet
@item
Fixed a bug which corrupted the table if the primary key
of a > 8000-byte row was updated.
@item
There are now 3 types of InnoDB Monitors: innodb_monitor,
innodb_lock_monitor, and innodb_tablespace_monitor.
innodb_monitor now prints also buffer pool hit rate and the total
number of rows inserted, updated, deleted, read.
@item
Fixed a bug in RENAME TABLE.
@item
Fixed a bug in replication with an auto-increment column.
@end itemize


@node InnoDB news-3.23.41, InnoDB news-3.23.40, InnoDB news-3.23.42, InnoDB change history
@subsubsection MySQL/InnoDB-3.23.41, August 13, 2001

@itemize @bullet
@item
Support for < 4 GB rows. The previous limit was
8000 bytes.
@item
Use the doublewrite file flush method.
@item
Raw disk partitions supported as datafiles.
@item
InnoDB Monitor.
@item
Several hang bugs fixed and an @code{ORDER BY}
bug ('Sort aborted') fixed.
@end itemize


@node InnoDB news-3.23.40, InnoDB news-3.23.39, InnoDB news-3.23.41, InnoDB change history
@subsubsection MySQL/InnoDB-3.23.40, July 16, 2001

@itemize @bullet
@item
Only a few rare bugs fixed.
@end itemize


@node InnoDB news-3.23.39, InnoDB news-3.23.38, InnoDB news-3.23.40, InnoDB change history
@subsubsection MySQL/InnoDB-3.23.39, June 13, 2001

@itemize @bullet
@item
@code{CHECK TABLE} now works for @code{InnoDB} tables.
@item
A new @file{my.cnf} parameter @code{innodb_unix_file_flush_method}
introduced. It can be used to tune disk write performance.
@item
An auto-increment column now gets new values past the
transaction mechanism. This saves CPU time and eliminates
transaction deadlocks in new value assignment.
@item
Several bug fixes, most notably the rollback bug in 3.23.38.
@end itemize


@node InnoDB news-3.23.38,  , InnoDB news-3.23.39, InnoDB change history
@subsubsection MySQL/InnoDB-3.23.38, May 12, 2001

@itemize @bullet
@item
The new syntax @code{SELECT ... LOCK IN SHARE MODE} is introduced.
@item
@code{InnoDB} now calls @code{fsync()} after every disk write and calculates
a checksum
for every database page it writes or reads, which will reveal disk defects.
@item
Several bug fixes.
@end itemize

@node InnoDB contact information,  , InnoDB change history, InnoDB
@subsection @code{InnoDB} Contact Information

Contact information of Innobase Oy, producer of the @code{InnoDB} engine.
Web site: @uref{http://www.innodb.com/}.
Email: @email{sales@@innodb.com}

@example
phone: 358-9-6969 3250 (office) 358-40-5617367 (mobile)
Innobase Oy Inc.
World Trade Center Helsinki
Aleksanterinkatu 17
P.O.Box 800
00101 Helsinki
Finland
@end example


@node BDB, ISAM, InnoDB, Table types
@section @code{BDB} or @code{BerkeleyDB} Tables

@cindex tables, @code{BDB}
@cindex tables, @code{Berkeley DB}

@menu
* BDB overview::                Overview of @code{BDB} Tables
* BDB install::                 Installing @code{BDB}
* BDB start::                   @code{BDB} Startup Options
* BDB characteristics::         Characteristics of @code{BDB} Tables
* BDB TODO::                    Things We Need to Fix for @code{BDB} in the Near Future
* BDB portability::             Operating Systems Supported by @code{BDB}
* BDB restrictions::            Restrictions on @code{BDB} Tables
* BDB errors::                  Errors That May Occur When Using @code{BDB} Tables
@end menu

@node BDB overview, BDB install, BDB, BDB
@subsection Overview of @code{BDB} Tables

BerkeleyDB, available at @uref{http://www.sleepycat.com/} has provided
MySQL with a transactional storage engine. Support for this storage engine is
included in the MySQL source distribution starting from version 3.23.34 and is
activated in the MySQL-Max binary. This storage engine is typically called
@code{BDB} for short.

@code{BDB} tables may have a greater chance of surviving crashes and are also
capable of @code{COMMIT} and @code{ROLLBACK} operations on transactions.
The MySQL source distribution comes with a @code{BDB} distribution that has a
couple of small patches to make it work more smoothly with MySQL.
You can't use a non-patched @code{BDB} version with MySQL.

We at MySQL AB are working in close cooperation with Sleepycat to
keep the quality of the MySQL/BDB interface high.

When it comes to supporting @code{BDB} tables, we are committed to help our
users to locate the problem and help creating a reproducible test case
for any problems involving @code{BDB} tables.  Any such test case will be
forwarded to Sleepycat who in turn will help us find and fix the
problem.  As this is a two-stage operation, any problems with @code{BDB} tables
may take a little longer for us to fix than for other storage engines.
However, as the BerkeleyDB code itself has been used by many other
applications than MySQL, we don't envision any big problems with
this.  @xref{Support}.


@node BDB install, BDB start, BDB overview, BDB
@subsection Installing @code{BDB}

If you have downloaded a binary version of MySQL that includes
support for BerkeleyDB, simply follow the instructions for installing a
binary version of MySQL.
@xref{Installing binary}.  @xref{mysqld-max, , @code{mysqld-max}}.

To compile MySQL with Berkeley DB support, download MySQL
Version 3.23.34 or newer and configure @code{MySQL} with the
@code{--with-berkeley-db} option.  @xref{Installing source}.

@example
cd /path/to/source/of/mysql-3.23.34
./configure --with-berkeley-db
@end example

Please refer to the manual provided with the @code{BDB} distribution for
more updated information.

Even though Berkeley DB is in itself very tested and reliable,
the MySQL interface is still considered gamma quality.
We are actively improving and optimizing it to make it stable very
soon.


@node BDB start, BDB characteristics, BDB install, BDB
@subsection @code{BDB} Startup Options

If you are running with @code{AUTOCOMMIT=0} then your changes in @code{BDB}
tables will not be updated until you execute @code{COMMIT}.  Instead of commit
you can execute @code{ROLLBACK} to forget your changes. @xref{COMMIT}.

If you are running with @code{AUTOCOMMIT=1} (the default), your changes
will be committed immediately.  You can start an extended transaction with
the @code{BEGIN WORK} SQL command, after which your changes will not be
committed until you execute @code{COMMIT} (or decide to @code{ROLLBACK}
the changes).

The following options to @code{mysqld} can be used to change the behavior of
@code{BDB} tables:

@multitable @columnfractions .25 .55
@item @strong{Option} @tab @strong{Description}
@item @code{--bdb-home=directory} @tab  Base directory for @code{BDB} tables.  This should be the same directory you use for @code{--datadir}.
@item @code{--bdb-lock-detect=#} @tab  Berkeley lock detection method. One of (@code{DEFAULT}, @code{OLDEST}, @code{RANDOM}, or @code{YOUNGEST}).
@item @code{--bdb-logdir=directory} @tab Berkeley DB log file directory.
@item @code{--bdb-no-sync} @tab Don't synchronously flush logs.
@item @code{--bdb-no-recover} @tab Don't start Berkeley DB in recover mode.
@item @code{--bdb-shared-data} @tab Start Berkeley DB in multi-process mode (Don't use @code{DB_PRIVATE} when initializing Berkeley DB)
@item @code{--bdb-tmpdir=directory} @tab Berkeley DB temporary file directory.
@item @code{--skip-bdb} @tab Disable usage of @code{BDB} tables.
@item @code{-O bdb_max_lock=1000} @tab Set the maximum number of locks possible. @xref{SHOW VARIABLES, , @code{bdb_max_lock}}.
@end multitable

If you use @code{--skip-bdb}, MySQL will not initialize the
Berkeley DB library and this will save a lot of memory.
You cannot use @code{BDB} tables if you are using this option.  If you try
to create a @code{BDB} table, MySQL will instead create a @code{MyISAM} table.

Normally you should start @code{mysqld} without @code{--bdb-no-recover} if you
intend to use @code{BDB} tables.  This may, however, give you problems when you
try to start @code{mysqld} if the @code{BDB} log files are corrupted. @xref{Starting
server}.

With @code{bdb_max_lock} you can specify the maximum number of locks
(10000 by default) you can have active on a @code{BDB} table. You should
increase this if you get errors of type @code{bdb: Lock table is out of
available locks} or @code{Got error 12 from ...}  when you have do long
transactions or when @code{mysqld} has to examine a lot of rows to
calculate the query.

You may also want to change @code{binlog_cache_size} and
@code{max_binlog_cache_size} if you are using big multi-line transactions.
@xref{COMMIT, , @code{COMMIT}}.


@node BDB characteristics, BDB TODO, BDB start, BDB
@subsection Characteristics of @code{BDB} Tables

@itemize @bullet
@item
To be able to rollback transactions, the @code{BDB} storage engine maintains
log files.  For maximum performance you should place these on another disk
than your databases by using the @code{--bdb-logdir} option.
@item
MySQL performs a checkpoint each time a new @code{BDB} log
file is started, and removes any log files that are not needed for
current transactions.  One can also run @code{FLUSH LOGS} at any time
to checkpoint the Berkeley DB tables.

For disaster recovery, one should use table backups plus
MySQL's binary log. @xref{Backup}.

@strong{Warning:} If you delete old log files that are in use, @code{BDB} will
not be able to do recovery at all and you may lose data if something
goes wrong.
@item
MySQL requires a @code{PRIMARY KEY} in each @code{BDB} table to be
able to refer to previously read rows. If you don't create one,
MySQL will create an maintain a hidden @code{PRIMARY KEY} for
you.  The hidden key has a length of 5 bytes and is incremented for each
insert attempt.
@item
If all columns you access in a @code{BDB} table are part of the same index or
part of the primary key, then MySQL can execute the query
without having to access the actual row.  In a @code{MyISAM} table the
above holds only if the columns are part of the same index.
@item
The @code{PRIMARY KEY} will be faster than any other key, as the
@code{PRIMARY KEY} is stored together with the row data.  As the other keys are
stored as the key data + the @code{PRIMARY KEY}, it's important to keep the
@code{PRIMARY KEY} as short as possible to save disk and get better speed.
@item
@code{LOCK TABLES} works on @code{BDB} tables as with other tables.  If
you don't use @code{LOCK TABLE}, MySQL will issue an internal
multiple-write lock on the table to ensure that the table will be
properly locked if another thread issues a table lock.
@item
Internal locking in @code{BDB} tables is done on page level.
@item
@code{SELECT COUNT(*) FROM table_name} is slow as @code{BDB} tables doesn't
maintain a count of the number of rows in the table.
@item
Sequential scanning is slower than with @code{MyISAM} tables as the data in
@code{BDB} tables stored in B-trees and not in a separate datafile.
@item
The application must always be prepared to handle cases where
any change of a @code{BDB} table may make an automatic rollback and any
read may fail with a deadlock error.
@item
Keys are not prefix or suffix-compressed like keys in @code{MyISAM}
tables. In other words, the key information will take a little more
space in @code{BDB} tables compared to @code{MyISAM} tables.
@item
There are often holes in the @code{BDB} table to allow you to insert new rows in
the middle of the key tree.  This makes @code{BDB} tables somewhat larger than
@code{MyISAM} tables.
@item
The optimizer needs to know an approximation of the number of rows in
the table.  MySQL solves this by counting inserts and
maintaining this in a separate segment in each @code{BDB} table.  If you don't
issue a lot of @code{DELETE} or @code{ROLLBACK} statements, this number
should be accurate enough for the MySQL optimizer, but as MySQL
only stores the number on close, it may be incorrect if MySQL dies
unexpectedly. It should not be fatal even if this number is not 100%
correct.  One can update the number of rows by executing @code{ANALYZE
TABLE} or @code{OPTIMIZE TABLE}. @xref{ANALYZE TABLE} . @xref{OPTIMIZE
TABLE}.
@item
If you get full disk with a @code{BDB} table, you will get an error
(probably error 28) and the transaction should roll back.  This is in
contrast with @code{MyISAM} and @code{ISAM} tables where @code{mysqld} will
wait for enough free disk before continuing.
@end itemize


@node BDB TODO, BDB portability, BDB characteristics, BDB
@subsection Things We Need to Fix for @code{BDB} in the Near Future

@itemize @bullet
@item
It's very slow to open many @code{BDB} tables at the same time. If you are
going to use @code{BDB} tables, you should not have a very big table cache
(like >256) and you should use @code{--no-auto-rehash} with the @code{mysql}
client.  We plan to partly fix this in 4.0.
@item
@code{SHOW TABLE STATUS} doesn't yet provide that much information for
@code{BDB}
tables.
@item
Optimize performance.
@item
Change to not use page locks at all when we are scanning tables.
@end itemize


@node BDB portability, BDB restrictions, BDB TODO, BDB
@subsection Operating Systems Supported by @code{BDB}

Currently we know that the @code{BDB} storage engine works with the following
operating systems:

@itemize @bullet
@item
Linux 2.x Intel
@item
Sun Solaris (SPARC and x86)
@item
FreeBSD 4.x/5.x (x86, sparc64)
@item
IBM AIX 4.3.x
@item
SCO OpenServer
@item
SCO UnixWare 7.1.x
@end itemize

It doesn't work with the following operating systems:

@itemize @bullet
@item
Linux 2.x Alpha
@item
Linux 2.x AMD64
@item
Linux 2.x IA64
@item
Linux 2.x s390
@item
Max OS X
@end itemize

Note: The above list is not complete; we will update it as we receive more
information.

If you build MySQL with support for @code{BDB} tables and get
the following error in the log file when you start @code{mysqld}:

@example
bdb: architecture lacks fast mutexes: applications cannot be threaded
Can't init databases
@end example

This means that @code{BDB} tables are not supported for your architecture.
In this case you must rebuild MySQL without @code{BDB} table support.

@node BDB restrictions, BDB errors, BDB portability, BDB
@subsection Restrictions on @code{BDB} Tables

Here follows the restrictions you have when using @code{BDB} tables:

@itemize @bullet
@item
@code{BDB} tables store in the @file{.db} file the path to the file as it was
created.
(This was done to be able to detect locks in a multi-user environment that
supports symlinks).

The effect of this is that @code{BDB} tables are not movable between directories!
@item
When taking backups of @code{BDB} tables, you have to either use
@code{mysqldump} or take a backup of all @code{table_name.db} files and
the @code{BDB} log files.  The @code{BDB} log files are the files in the base
data directory named @code{log.XXXXXXXXXX} (ten digits);
The @code{BDB} storage engine stores unfinished transactions in the log files
and requires these logs to be present when @code{mysqld} starts.
@end itemize

@node BDB errors,  , BDB restrictions, BDB
@subsection Errors That May Occur When Using @code{BDB} Tables

@itemize @bullet
@item
If you get the following error in the @code{hostname.err log} when
starting @code{mysqld}:

@example
bdb:  Ignoring log file: .../log.XXXXXXXXXX: unsupported log version #
@end example
it means that the new @code{BDB} version doesn't support the old log
file format.  In this case you have to delete all @code{BDB} logs
from your database directory (the files with names that have the format
@code{log.XXXXXXXXXX}) and restart @code{mysqld}.  We would also
recommend you to do a @code{mysqldump --opt} of your old @code{BDB}
tables, delete the old tables, and restore the dump.
@item
If you are not running in auto-commit mode and delete a table that is referenced
in another transaction, you may get the following error messages in your MySQL
error log:

@example
001119 23:43:56  bdb:  Missing log fileid entry
001119 23:43:56  bdb:  txn_abort: Log undo failed for LSN:
                       1 3644744: Invalid
@end example

This is not fatal but we don't recommend that you delete tables if you are
not in auto-commit mode, until this problem is fixed (the fix is
not trivial).
@end itemize

@node ISAM,  , BDB, Table types
@section @code{ISAM} Tables

@cindex tables, ISAM

The deprecated @code{ISAM} table type will disappear in MySQL version 5.0.
In MySQL 4.1 it's included in the source but not compiled anymore.
@code{MyISAM} is a better implementation of this table handler and you should
convert all @code{ISAM} tables to @code{MySAM} tables as soon as possible.

@code{ISAM} uses a @code{B-tree} index. The index is stored in a file
with the @file{.ISM} extension, and the data is stored in a file with
the @file{.ISD} extension.
You can check/repair @code{ISAM} tables with the @code{isamchk} utility.
@xref{Crash recovery}.

@code{ISAM} has the following features/properties:

@itemize @bullet
@item Compressed and fixed-length keys
@item Fixed and dynamic record length
@item 16 keys with 16 key parts/key
@item Max key length 256 (default)
@item Data is stored in machine format; this is fast, but is machine/OS dependent.
@end itemize

Most of the things true for @code{MyISAM} tables are also true for @code{ISAM}
tables. @xref{MyISAM, , @code{MyISAM} tables}. The major differences compared
to @code{MyISAM} tables are:

@itemize @bullet
@item @code{ISAM} tables are not binary portable across OS/Platforms.
@item Can't handle tables > 4G.
@item Only support prefix compression on strings.
@item Smaller key limits.
@item Dynamic tables get more fragmented.
@item Tables are compressed with @code{pack_isam} rather than with @code{myisampack}.
@end itemize

If you want to convert an @code{ISAM} table to a @code{MyISAM} table so
that you can use utilities such as @code{mysqlcheck}, use an @code{ALTER
TABLE} statement:

@example
mysql> ALTER TABLE tbl_name TYPE = MYISAM;
@end example

The embedded MySQL versions doesn't support @code{ISAM} tables.

@node MaxDB, Charset, Table types, Top
@chapter Introduction to MaxDB

@c Author: Stefan Hinz
@c Technical Editor / Approved by: Patrik Backman

MaxDB is an enterprise level database. MaxDB is the new name of a database management system formerly called SAP DB.

@menu
* MaxDB History::               History of MaxDB
* MaxDB Licensing::             Licensing and Support
* MaxDB Basics::                Basic Concepts of MaxDB
* MaxDB-MySQL Differences::     Feature Differences between MaxDB and MySQL
* MaxDB-MySQL Interoperability::  Interoperability Features between MaxDB and MySQL
* MaxDB Links::                 MaxDB-related Links
* MaxDB Reserved Words::        Reserved Words in MaxDB
* MaxDB Functions::             Functions
* MaxDB Column Types::          Column Types
@end menu


@node MaxDB History, MaxDB Licensing, MaxDB, MaxDB
@section History of MaxDB

The  history of SAP DB goes back to the early 1980s when it was
developed as a commercial product (Adabas). The database has changed
names several times since then. When SAP AG, a Walldorf, Germany,
based company, took over the development of that database system,
it was called SAP DB.

SAP developed that database system to serve as a storage system
for all heavy-duty SAP applications, namely R/3. SAP DB was meant
to provide an alternative to third-party database systems like
Oracle, Microsoft SQL Server, or DB2 by IBM. In October 2000, SAP
AG released SAP DB under the GNU GPL license (@pxref{GPL license}), 
thus making it open source software. In October 2003, more than 2,000 
customers of SAP AG were using SAP DB as their main database system, 
and more than another 2,000 customers were using it as a separate 
database system besides their main database, as part of the 
APO/LiveCache solution.

In May 2003, a technology partnership was formed between MySQL AB
and SAP AG. That partnership entitles MySQL AB to further develop SAP
DB, rename it, and sell commercial licenses of the renamed SAP DB
to customers who do not want to be bound to the restrictions imposed
to them when using that database system under the GNU GPL (@pxref{GPL
license}). In August 2003, SAP DB was renamed to MaxDB by MySQL AB.

@node MaxDB Licensing, MaxDB Basics, MaxDB History, MaxDB
@section Licensing and Support

MaxDB can be used under the same licenses available for the other
products distributed by MySQL AB (@ref{MySQL licenses}). Thus,
MaxDB will be available under the GNU General Public License
(@ref{GPL license}), and a commercial license (@ref{Licensing
and Support}).

MySQL will offer MaxDB support to non-SAP customers.

The first rebranded version will be MaxDB 7.5.00 that will be
released in late 2003.

@c Licensing needs to be mentioned in 1.4.3 MySQL Licenses in greater detail.

@node MaxDB Basics, MaxDB-MySQL Differences, MaxDB Licensing, MaxDB
@section Basic Concepts of MaxDB

MaxDB operates as a client/server product. It was developed to meet
the demands of installations processing a high volume of online
transactions. Both online backup and expansion of the database are
supported. Microsoft Clustered Server is supported directly for
multiple server implementations; other failover solutions must be
scripted manually. Database management tools are provided in both
Windows and browser-based implementations.

@node MaxDB-MySQL Differences, MaxDB-MySQL Interoperability, MaxDB Basics, MaxDB
@section Feature Differences between MaxDB and MySQL

The following list provides a short summary of the main differences
between MaxDB and MySQL; it is not complete.

@itemize @bullet
@item
MaxDB runs as a client/server system. MySQL can run as a client/server system
or as an embedded system.
@item
MaxDB might not run on all platforms supported by MySQL. For example,
MaxDB does not run on IBM's OS/2.
@item
MaxDB uses a proprietary network protocol for client/server
communication, while MySQL uses either TCP/IP (with or without SSL
encryption), sockets (under Unix-like systems), or named pipes
(under Windows NT-family systems).
@item
MaxDB supports stored procedures. For MySQL, stored procedures are
implemented in version 5.0. MaxDB also supports programming of
triggers through an SQL extension, which is scheduled for MySQL
5.1. MaxDB contains a debugger for stored procedure languages,
can cascade nested triggers, and supports multiple triggers per
action and row.
@item
MaxDB is distributed containing user interfaces that are text-based,
graphical, or web-based. MySQL is distributed with text-based user
interfaces only; a graphical user interface (MySQL Control Center)
is shipped separately from the main distributions. Web-based user
interfaces for MySQL are offered by third parties.
@item
MaxDB supports a number of programming interfaces also supported
by MySQL. However, MaxDB does not support RDO, ADO, or .NET, all of which are
supported by MySQL. MaxDB
supports embedded SQL only with C/C++.
@item
MaxDB contains administrative features that MySQL does not have:
Job scheduling by time, event, and alert, and sending
messages to a database administrator on alert thresholds.
@end itemize

@c Maybe add table showing maxima for MaxDB and MySQL. Might be obtained from crash-me comparison.

@node MaxDB-MySQL Interoperability, MaxDB Links, MaxDB-MySQL Differences, MaxDB
@section Interoperability Features between MaxDB and MySQL

The following features will be included in MaxDB versions to be
released shortly after the first 7.5.00 version. These features
will allow interoperation between MaxDB and MySQL:

@itemize @bullet
@item
There will be a MySQL proxy enabling one to connect to MaxDB using
the MySQL protocol. This makes it possible to use MySQL client
programs for MaxDB, like the @code{mysql} command-line user interface,
the @code{mysqldump} dump utility, or the @code{mysqlimport} import
program. Using @code{mysqldump}, one can easily dump data from one
database system and export (or even pipe) those data to the other
database system.
@c For the utilities mentioned (and maybe for other utitilities as
@c well) it should be noted in the appropriate sections that they can
@c be used to communicate with the MaxDB server.
@item

Replication between MySQL and MaxDB will be supported in both
directions. That is, either MySQL or MaxDB can be used as the master
replication server. The long-range plan is to converge and extend the
replication syntax so that both database systems understand the same syntax.
@xref{Replication Intro}.
@c This item also in subsection 4.10.1 (Introduction to MySQL Replication)
@end itemize

@node MaxDB Links, MaxDB Reserved Words, MaxDB-MySQL Interoperability, MaxDB
@section MaxDB-related Links

The main page for information about MaxDB is
@uref{http://www.mysql.com/maxdb}. Eventually, all information
available at @uref{http://www.sapdb.org} will be moved there.

@node MaxDB Reserved Words, MaxDB Functions, MaxDB Links, MaxDB
@section Reserved Words in MaxDB

Like MySQL, MaxDB has a number of reserved words that have special meanings.
Normally, they cannot be used
as names of identifiers, such as database or table names. The following
table lists reserved words in MaxDB, indicates the context in which
those words are used, and indicates whether or not they have
counterparts in MySQL. If such a counterpart exists, the meaning
in MySQL might be identical, or differing in some aspects. The main
purpose is to list in which respects MaxDB differs from MySQL;
therefore, this list is not complete.

For the list of reserved words in MySQL, see @xref{Reserved words}.

@multitable @columnfractions .20 .30 .50
@item @strong{Reserved in MaxDB}
 @tab @strong{Context of usage in MaxDB}
 @tab @strong{MySQL counterpart}
@item @code{@@}
 @tab May prefix identifier, like ``@@table''
 @tab Not allowed
@item @code{ADDDATE()}
 @tab SQL function
 @tab @code{ADDDATE()}; new in MySQL version 4.1.1
@item @code{ADDTIME()}
 @tab SQL function
 @tab @code{ADDTIME()}; new in MySQL version 4.1.1
@item @code{ALPHA}
 @tab SQL function
 @tab Nothing comparable
@item @code{ARRAY}
 @tab Data type
 @tab Not implemented
@item @code{ASCII()}
 @tab SQL function
 @tab @code{ASCII()}, but implemented with a different meaning
@item @code{AUTOCOMMIT}
 @tab Transactions; @code{ON} by default
 @tab Transactions; @code{OFF} by default
@item @code{BOOLEAN}
 @tab Column types; @code{BOOLEAN} accepts as values only @code{TRUE}, @code{FALSE}, and @code{NULL}
 @tab @code{BOOLEAN} was added in MySQL version 4.1.0; it is a synonym for @code{BOOL} which is mapped to @code{TINYINT(1)}. It accepts integer values in the same range as @code{TINYINT} as well as @code{NULL}. @code{TRUE} and @code{FALSE} can be used as aliases for @code{1} and @code{0}.
@item @code{CHECK}
 @tab @code{CHECK TABLE}
 @tab @code{CHECK TABLE}; similar, but not identical usage
@item @code{COLUMN}
 @tab Column types
 @tab @code{COLUMN}; noise word
@item @code{CHAR()}
 @tab SQL function
 @tab @code{CHAR()}; identical syntax; similar, not identical usage
@item @code{COMMIT}
 @tab Implicit commits of transactions happen when data definition queries are being issued
 @tab Implicit commits of transactions happen when data definition queries are being issued, but also with a number of other queries
@item @code{COSH()}
 @tab SQL function
 @tab Nothing comparable
@item @code{COT()}
 @tab SQL function
 @tab @code{COT()}; identical syntax and implementation
@item @code{CREATE}
 @tab SQL, data definition language
 @tab @code{CREATE}
@item @code{DATABASE}
 @tab SQL function
 @tab @code{DATABASE()}; @code{DATABASE} is used in a different context, for example @code{CREATE DATABASE}
@item @code{DATE()}
 @tab SQL function
 @tab @code{CURRENT_DATE}
@item @code{DATEDIFF()}
 @tab SQL function
 @tab @code{DATEDIFF()}; new in MySQL version 4.1.1
@item @code{DAY()}
 @tab SQL function
 @tab Nothing comparable
@item @code{DAYOFWEEK()}
 @tab SQL function
 @tab @code{DAYOFWEEK()}; the first day (@code{1}) by default is Monday in MaxDB, and Sunday in MySQL
@item @code{DISTINCT}
 @tab SQL functions @code{AVG}, @code{MAX}, @code{MIN}, @code{SUM}
 @tab @code{DISTINCT}; but used in a different context: @code{SELECT DISTINCT}
@item @code{DROP}
 @tab inter alia in @code{DROP INDEX}
 @tab @code{DROP INDEX}; similar, but not identical usage
@item @code{EBCDIC()}
 @tab SQL function
 @tab Nothing comparable
@item @code{EXPAND()}
 @tab SQL function
 @tab Nothing comparable
@item @code{EXPLAIN}
 @tab Optimization
 @tab @code{EXPLAIN}; similar, but not identical usage
@item @code{FIXED()}
 @tab SQL function
 @tab Nothing comparable
@item @code{FLOAT()}
 @tab SQL function
 @tab Nothing comparable
@item @code{HEX()}
 @tab SQL function
 @tab @code{HEX()}; similar, but not identical usage
@item @code{INDEX()}
 @tab SQL function
 @tab @code{INSTR()} or @code{LOCATE()}; similar, but not identical syntaxes and meanings
@item @code{INDEX}
 @tab @code{USE INDEX}, @code{IGNORE INDEX} and similar hints are being used right after @code{SELECT}, like @code{SELECT ... USE INDEX}
 @tab @code{USE INDEX}, @code{IGNORE INDEX} and similar hints are being used in the @code{FROM} clause of a @code{SELECT} query, like in @code{SELECT ... FROM ... USE INDEX}
@item @code{INITCAP()}
 @tab SQL function
 @tab Nothing comparable
@item @code{LENGTH()}
 @tab SQL function
 @tab @code{LENGTH()}; identical syntax, but slightly different implementation
@item @code{LFILL()}
 @tab SQL function
 @tab Nothing comparable
@item @code{LIKE}
 @tab Comparisons
 @tab @code{LIKE}; but the extended @code{LIKE} MaxDB provides rather resembles the MySQL @code{REGEX}
@item @code{LIKE} wildcards
 @tab MaxDB supports ``%'', ``_'', ``ctrl+underline'', ``ctrl+up arrow'', ``*'', and ``?'' as wildcards in a @code{LIKE} comparison
 @tab MySQL supports ``%'', and ``_'' as wildcards in a @code{LIKE} comparison
@item @code{LPAD()}
 @tab SQL function
 @tab @code{LPAD()}; slightly different implementation
@item @code{LTRIM()}
 @tab SQL function
 @tab @code{LTRIM()}; slightly different implementation
@item @code{MAKEDATE()}
 @tab SQL function
 @tab @code{MAKEDATE()}; new in MySQL version 4.1.1
@item @code{MAKETIME()}
 @tab SQL function
 @tab @code{MAKETIME()}; new in MySQL version 4.1.1
@item @code{MAPCHAR()}
 @tab SQL function
 @tab Nothing comparable
@item @code{MICROSECOND()}
 @tab SQL function
 @tab @code{MICROSECOND()}; new in MySQL version 4.1.1
@item @code{NOROUND()}
 @tab SQL function
 @tab Nothing comparable
@item @code{NULL}
 @tab Column types; comparisons
 @tab @code{NULL}; MaxDB supports special @code{NULL} values that are returned by arithmetic operations that lead to an overflow or a division by zero; MySQL does not support such special values
@item @code{PI}
 @tab SQL function
 @tab @code{PI()}; identical syntax and implementation, but parantheses are mandatory
@item @code{REF}
 @tab Data type
 @tab Nothing comparable
@item @code{RFILL()}
 @tab SQL function
 @tab Nothing comparable
@item @code{ROWNO}
 @tab Predicate in @code{WHERE} clause
 @tab Similar to @code{LIMIT} clause
@item @code{RPAD()}
 @tab SQL function
 @tab @code{RPAD()}; slightly different implementation
@item @code{RTRIM()}
 @tab SQL function
 @tab @code{RTRIM()}; slightly different implementation
@item @code{SEQUENCE}
 @tab @code{CREATE SEQUENCE}, @code{DROP SEQUENCE}
 @tab @code{AUTO_INCREMENT}; similar concept, but differing implementation
@item @code{SINH()}
 @tab SQL function
 @tab Nothing comparable
@item @code{SOUNDS()}
 @tab SQL function
 @tab @code{SOUNDEX()}; slightly different syntax
@item @code{STATISTICS}
 @tab @code{UPDATE STATISTICS}
 @tab @code{ANALYZE}; similar concept, but differing implementation
@item @code{SUBSTR()}
 @tab SQL function
 @tab @code{SUBSTRING()}; slightly different implementation
@item @code{SUBTIME()}
 @tab SQL function
 @tab @code{SUBTIME()}; new in MySQL version 4.1.1
@item @code{SYNONYM}
 @tab Data definition language: @code{CREATE [PUBLIC] SYNONYM}, @code{RENAME SYNONYM}, @code{DROP SYNONYM}
 @tab Nothing comparable
@item @code{TANH()}
 @tab SQL function
 @tab Nothing comparable
@item @code{TIME()}
 @tab SQL function
 @tab @code{CURRENT_TIME}
@item @code{TIMEDIFF()}
 @tab SQL function
 @tab @code{TIMEDIFF()}; new in MySQL version 4.1.1
@item @code{TIMESTAMP()}
 @tab SQL function
 @tab @code{TIMESTAMP()}; new in MySQL version 4.1.1
@item @code{TIMESTAMP()} as argument to @code{DAYOFMONTH()} and @code{DAYOFYEAR()}
 @tab SQL function
 @tab Nothing comparable
@item @code{TIMEZONE()}
 @tab SQL function
 @tab Nothing comparable
@item @code{TRANSACTION()}
 @tab Returns the ID of the current transaction
 @tab Nothing comparable
@item @code{TRANSLATE()}
 @tab SQL function
 @tab @code{REPLACE()}; identical syntax and implementation
@item @code{TRIM()}
 @tab SQL function
 @tab @code{TRIM()}; slightly different implementation
@item @code{TRUNC()}
 @tab SQL function
 @tab @code{TRUNCATE()}; slightly different syntax and implementation
@item @code{USE}
 @tab @code{mysql} commandline user interface command
 @tab @code{USE}
@item @code{USER}
 @tab SQL function
 @tab @code{USER()}; identical syntax, but slightly different implementation, and parantheses are mandatory
@item @code{UTC_DIFF()}
 @tab SQL function
 @tab @code{UTC_DATE()}; provides a means to calculate the result of  @code{UTC_DIFF()}
@item @code{VALUE()}
 @tab SQL function, alias for @code{COALESCE()}
 @tab @code{COALESCE()}; identical syntax and implementation
@item @code{VARIANCE()}
 @tab SQL function
 @tab Nothing comparable
@item @code{WEEKOFYEAR()}
 @tab SQL function
 @tab @code{WEEKOFYEAR()}; new in MySQL version 4.1.1
@end multitable

@node MaxDB Functions, MaxDB Column Types, MaxDB Reserved Words, MaxDB
@section Functions

@c Should go to Functions chapter

@node MaxDB Column Types,  , MaxDB Functions, MaxDB
@section Column Types

@c Should go to Column Types chapter


@node Charset, Spatial extensions in MySQL, MaxDB, Top
@chapter National Character Sets and Unicode

@cindex Character sets
@cindex Unicode
@cindex UTF8
@cindex UTF-8
@cindex UCS-2

@c DO:

@c Note: Put credits in contributors section.
@c Add indexing.
@c Add info about how to configure in various charsets
@c ENUM and SET can have character set clauses as well
@c Connection/@{literals,results@} still not defined well; latter never even mentioned

@menu
* Charset-general::             Character Sets and Collations in General
* Charset-MySQL::               Character Sets and Collations in MySQL
* Charset-defaults::            Determining the Default Character Set and Collation
* Charset-operations::          Operations Affected by Character Set Support
* Charset-Unicode::             Unicode Support
* Charset-metadata::            UTF8 for Metadata
* Charset-compatibility::       Compatibility with Other DBMSs
* Charset-config-file::         New Character Set Configuration File format
* Charset-national::            National Character Set
* Charset-upgrading::           Upgrading from MySQL 4.0
* Charset-charsets::            The Character Sets and Collations that MySQL Supports
@end menu

Improved handling of character sets is one of the features added to
MySQL in Version 4.1. This chapter explains:

@itemize @bullet
@item What are character sets and collations
@item The multi-level default system
@item New syntax in MySQL 4.1
@item Affected functions and operations
@item The meaning of each individual character set and collation

@end itemize

The features described here are as implemented in MySQL 4.1.1.
(MySQL 4.1.0 has some but not all of these features, and some of them
are implemented differently.)

Character set support currently is included in the
@code{MySISAM} and @code{MEMORY} (@code{HEAP}) storage engines.
The @code{InnoDB} storage engine does not yet include it.
@code{ISAM} does not; there are no plans to do so.


@node Charset-general, Charset-MySQL, Charset, Charset
@section Character Sets and Collations in General


A @strong{character set} is a set of symbols and encodings. A @strong{collation} is a set of rules for comparing characters in a
character set. Let's make the distinction clear with an example of
an imaginary character set.


Suppose we had an alphabet with four letters: @samp{A}, @samp{B}, @samp{a},
@samp{b}. We give each letter a number: @samp{A} = 0, @samp{B} = 1, @samp{a} =
2, @samp{c} =
3. The letter @samp{A} is a symbol, the number 0 is the @strong{encoding}
for @samp{A}, and the combination of all four letters and their
encodings is a @strong{character set}.


Now, suppose we want to compare two string values, @samp{A} and @samp{B}.
The simplest way to do this is to look at the encodings --- 0 for
@samp{A} and 1 for @samp{B} --- and because 0 is less than 1, we say @samp{A} is less
than @samp{B}. Now, what we've just done is apply a collation to our
character set. The collation is a set of rules (only one rule in
this case): ``compare the encodings''. We call this simplest of all
possible collations a @strong{binary} collation.


But what if we want to say that the lowercase and uppercase
letters are equivalent? Then we would have at least two rules: (1)
treat the lowercase letters @samp{a} and @samp{b} as equivalent to @samp{A} and
@samp{B}; (2) then compare the encodings. We call this a @strong{case
insensitive} collation. It's a little more complex than a binary
collation.


In real life, most character sets have many characters: not just
@samp{A} and @samp{B} but whole alphabets, sometimes multiple alphabets or
eastern writing systems with thousands of characters, along with
many special symbols and punctuation marks. Also in real life, most
collations have many rules: not just case insensitivity but also
accent insensitivity (an ``accent'' is a mark attached to a character
as in German @samp{@"O}) and multiple-character mappings (such as the
rule that @samp{@"O} = @samp{OE} in one of the two German collations).

MySQL 4.1 can do these things for you:

@itemize @bullet
@item Store strings using a variety of character sets
@item Compare strings using a variety of collations
@item Mix strings with different character sets or collations in the
same server, the same database, or even the same table
@item Allow specification of character set and collation at any
level

@end itemize

In these respects, not only is MySQL 4.1 far more flexible than
MySQL 4.0, it also is far ahead of other DBMSs. However, to use the
new features effectively, you will need to learn what character
sets and collations are available, how to change their defaults,
and what the various string operators do with them.

@node Charset-MySQL, Charset-defaults, Charset-general, Charset
@section Character Sets and Collations in MySQL

A character set always has at least one collation. It may have
several collations.

For example, character set @code{latin1} (``ISO-8859-1 West
European'') has the following collations:

@multitable @columnfractions .4 .6

@item @strong{Collation} @tab @strong{Meaning}
@item @code{latin1_bin} @tab Binary according to @code{latin1} encoding
@item @code{latin1_danish_ci} @tab Danish/Norwegian
@item @code{latin1_german1_ci} @tab German DIN-1
@item @code{latin1_german2_ci} @tab German DIN-2
@item @code{latin1_spanish_ci} @tab Modern Spanish
@item @code{latin1_swedish_ci} @tab Swedish/Finnish
@item @code{latin1_general_ci} @tab Multilingual

@end multitable

Notes:

@itemize @bullet
@item Two different character sets can't have the same
collation.
@item Each character set has one collation that is the @emph{default
collation}. For example, the default collation for @code{latin1} is
@code{latin1_swedish_ci}.

@end itemize

Notice that there is a convention for collation names: They start
with the name of the character set they are associated with, they
usually include a language name, and they end with @code{_ci} (case
insensitive), @code{_cs} (case sensitive), or @code{_bin} (binary).


@node Charset-defaults, Charset-operations, Charset-MySQL, Charset
@section Determining the Default Character Set and Collation

@menu
* Charset-server::              Server Character Set and Collation
* Charset-database::            Database Character Set and Collation
* Charset-table::               Table Character Set and Collation
* Charset-column::              Column Character Set and Collation
* Charset-examples::            Examples of Character Set and Collation Assignment
* Charset-connection::          Connection Character Sets and Collations
* Charset-literal::             Character String Literal Character Set and Collation
* Charset-collate::             @code{COLLATE} Clause in Various Parts of an SQL Query
* Charset-collate-precedence::  @code{COLLATE} Clause Precedence
* Charset-binary-op::           @code{BINARY} Operator
* Charset-collate-tricky::      Some Special Cases Where the Collation Determination is Tricky
* Charset-collation-charset::   Collations Must Be for the Right Character Set
* Charset-collation-effect::    An example of the Effect of Collation
@end menu

@c TODO: four? There are six levels described in following sections...

There are default settings for character sets and collations at
four levels: server, database, table, connection. The following
description may appear complex, but it's been found in practice
that multi-level defaulting leads to natural and obvious
results.

@node Charset-server, Charset-database, Charset-defaults, Charset-defaults
@subsection Server Character Set and Collation

The MySQL Server has a server character set and a server collation,
which may not be null.

MySQL determines the server character set and server collation
thus:

@itemize @bullet

@item According to the option settings in effect when the server starts.

@end itemize

At this level, the decision is simple. The server character set
and collation depend on the options that you use when you start
@code{mysqld}. You can use @code{--default-character-set=character_set_name}
for the character set, and along with it you can add
@code{--default-collation=collation_name} for the collation. If you
don't specify a character set, that is the same as saying
@code{--default-character-set=latin1}. If you specify only a character
set (for instance, @code{latin1}) but not a collation, that is the same as
saying @code{--default-charset=latin1} @code{--collation=latin1_swedish_ci}
because @code{latin1_swedish_ci} is the default collation for @code{latin1}.
Therefore the following three commands all have the same effect:

@example
shell> mysqld
shell> mysqld --default-character-set=latin1
shell> mysqld --default-character-set=latin1
           --default-collation=latin1_swedish_ci
@end example


One way to change the settings is by recompiling. If you want to
change the default server character set and collation when building
from sources, use: @code{--with-character-set} and @code{--with-collation}
as arguments for @code{configure}. For example:

@example
shell> ./configure --with-character-set=latin1
@end example

or:

@example
shell> ./configure --with-character-set=latin1
           --with-collation=latin1_german1_ci
@end example

Both @code{mysqld} and @code{configure} check that
the character set/collation combination is valid. Each program displays
an error message and terminates if the combination is not valid.

@node Charset-database, Charset-table, Charset-server, Charset-defaults
@subsection Database Character Set and Collation

Every database has a database character set and a database
collation, which may not be null. The @code{CREATE DATABASE} and @code{ALTER
DATABASE} commands now have optional clauses for specifying the
database character set and collation:

@example
CREATE DATABASE db_name
   [DEFAULT CHARACTER SET character_set_name [COLLATE collation_name]]

ALTER DATABASE db_name
    [DEFAULT CHARACTER SET character_set_name [COLLATE collation_name]]
@end example

Example:

@example
CREATE DATABASE db_name
   DEFAULT CHARACTER SET latin1 COLLATE latin1_swedish_ci;
@end example

MySQL chooses the database character set and database collation
thus:

@itemize @bullet
@item If both @code{CHARACTER SET X} and @code{COLLATE Y} were specified, then
character set @code{X} and collation @code{Y}.
@item If @code{CHARACTER SET X} was specified without @code{COLLATE}, then
character set @code{X} and its default collation.
@item Otherwise, the server character set and server collation.

@end itemize


MySQL's @code{CREATE DATABASE ... DEFAULT CHARACTER SET ...} syntax is
analogous to the standard-SQL @code{CREATE SCHEMA ... CHARACTER SET ...}
syntax. Because of this, it is possible to create databases with
different character sets and collations, on the same MySQL
server.


The database character set and collation are used as default
values if the table character set and collation are not specified
in @code{CREATE TABLE} statements. They have no other purpose.

@node Charset-table, Charset-column, Charset-database, Charset-defaults
@subsection Table Character Set and Collation

Every table has a table character set and a table collation, which
may not be null. The @code{CREATE TABLE} and @code{ALTER TABLE} statements now
have optional clauses for specifying the table character set and
collation:

@example
CREATE TABLE table_name ( column_list )
   [DEFAULT CHARACTER SET character_set_name [COLLATE collation_name]]

ALTER TABLE table_name
   [DEFAULT CHARACTER SET character_set_name] [COLLATE collation_name]
@end example

Example:

@example
CREATE TABLE t1 ( ... ) DEFAULT CHARACTER SET latin1 COLLATE latin1_danish_ci;
@end example


MySQL chooses the table character set and collation thus:

@itemize @bullet
@item If both @code{CHARACTER SET X} and @code{COLLATE Y} were specified, then
character set @code{X} and collation @code{Y}.
@item If @code{CHARACTER SET X} was specified without @code{COLLATE}, then
character set @code{X} and its default collation.
@item Otherwise, the database character set and collation.

@end itemize



The table character set and collation are used as default
values, if the column character set and collation are not specified
in individual column definitions. The table character set and
collation are MySQL extensions; there are no such things in
standard SQL.

@node Charset-column, Charset-examples, Charset-table, Charset-defaults
@subsection Column Character Set and Collation

Every ``character'' column (that is, a column of type @code{CHAR},
@code{VARCHAR}, or @code{TEXT}) has a column character set and a column
collation, which may not be null. Column definition syntax now has optional
clauses for specifying the column character set and collation:

@example
column_name @{CHAR | VARCHAR | TEXT@} (column_length)
    [CHARACTER SET character_set_name [COLLATE collation_name]]
@end example

Example:

@example
CREATE TABLE Table1
(
   column1 VARCHAR(5) CHARACTER SET latin1 COLLATE latin1_german1_ci
);
@end example


MySQL chooses the column character set and collation thus:

@itemize @bullet
@item If both @code{CHARACTER SET X} and @code{COLLATE Y} were specified, then
character set @code{X} and collation @code{Y}.
@item If @code{CHARACTER SET X} was specified without @code{COLLATE}, then
character set @code{X} and its default collation.
@item Otherwise, the table character set and collation.

@end itemize

The @code{CHARACTER SET} and @code{COLLATE} clauses are standard SQL.

@node Charset-examples, Charset-connection, Charset-column, Charset-defaults
@subsection Examples of Character Set and Collation Assignment

The following examples show how MySQL determines default character set and
collation values.

@subsubheading Example 1: Table + Column Definition

@example
CREATE TABLE t1
(
  c1 CHAR(10) CHARACTER SET latin1 COLLATE latin1_german1_ci
) DEFAULT CHARACTER SET latin2 COLLATE latin2_bin;
@end example

Here you have a column with a @code{latin1} character set
and a @code{latin1_german1_ci} collation. The definition is explicit, so
that's straightforward. Notice that there's no problem storing a
@code{latin1} column in a @code{latin2} table.

@subsubheading Example 2: Table + Column Definition

@example
CREATE TABLE t1
(
   c1 CHAR(10) CHARACTER SET latin1
) DEFAULT CHARACTER SET latin1 COLLATE latin1_danish_ci;
@end example

This time we have a column with a @code{latin1} character
set and a default collation. Now, although it might seem natural,
the default collation is not taken from the table level. Instead,
because the default collation for @code{latin1} is always
@code{latin1_swedish_ci},
column @code{c1} will have a collation of @code{latin1_swedish_ci} (not
@code{latin1_danish_ci}).

@subsubheading Example 3: Table + Column Definition


@example
CREATE TABLE t1
(
   c1 CHAR(10)
) DEFAULT CHARACTER SET latin1 COLLATE latin1_danish_ci;
@end example

We have a column with a default character set and
a default collation. In this circumstance, MySQL looks up to the
table level for inspiration in determining the column character set and
collation. So the character set for column @code{c1} is
@code{latin1} and its collation is @code{latin1_danish_ci}.

@subsubheading Example 4: Database + Table + Column Definition

@example
CREATE DATABASE d1 DEFAULT CHARACTER SET latin2 COLLATE latin2_czech_ci;
USE d1;
CREATE TABLE t1
(
   c1 CHAR(10)
);
@end example

We create a column without specifying its
character set and collation. We're also not specifying a character
set and a collation at the table level. In this circumstance, MySQL
looks up to the database level for inspiration. (The database's
settings become the table's settings, and thereafter become the
column's setting.) So the character set for column @code{c1} is @code{latin2}
and its collation is @code{latin2_czech_ci}.

@node Charset-connection, Charset-literal, Charset-examples, Charset-defaults
@subsection Connection Character Sets and Collations

Every connection has connection character sets and connection
collations, which may not be null. There are actually two
connection character sets, which we will call ``connection/literals'' and
``connection/results'' when it is necessary to distinguish them.

Consider what a ``connection'' is: It's what you make when you
connect to the server. The client sends SQL statements, such as queries, over the
connection to the server. The server sends responses, such as
result sets, over the connection back to the client. This leads to
several questions, such as: (a) what character set is the query
in when it leaves the client? (b) what character set should the
server translate a query to after receiving it? (c) what character
set should the server translate to before shipping result sets or
error messages back to the client? You can fine-tune the setting
for these things, or you can depend on the defaults (in which case,
you can skip this section).


There are two statements that affect the connection character
sets:

@example
SET NAMES 'character_set_name'
SET CHARACTER SET character_set_name
@end example

@code{SET NAMES} indicates what is in the SQL statement that the client
sends. Thus, @code{SET NAMES 'cp1251'} tells the server ``future
incoming messages from this client will be in character set @code{cp1251}''
and the server is free to translate to its own character set, if
appropriate.


@code{SET CHARACTER SET} indicates what is in the SQL statement that
the client sends, and also what is in the result set that the
server sends back to the client. Thus, @code{SET CHARACTER SET} includes
@code{SET NAMES}, and also specifies what character set the column values
will have if, for example, you use a @code{SELECT} statement.


EXAMPLE: Suppose that @code{column1} is defined as @code{CHAR(5)
CHARACTER SET latin2}.  If you do not say @code{SET CHARACTER SET},
then for @code{SELECT column1 FROM t} the server will send back all
the values for @code{column1} using character set @code{latin2}. If on
the other hand you say @code{SET CHARACTER SET latin1} then the server
will, just before sending back, convert the @code{latin2} values to
@code{latin1}. Such conversion is slow and may be lossy.


When you execute @code{SET NAMES} or @code{SET CHARACTER SET}, you are also
changing the ``connection collation''. However, the connection
collation exists for consistency only. Usually its value doesn't
matter.


With the @code{mysql} client, it is not necessary to
execute @code{SET NAMES} every time you start up. You can add the
@code{--default-character-set}  option
setting to your @code{mysql} statement line, or in your option file.
For example, the following option file setting will change the connection
character set each time you run @code{mysql}:

@example
[mysql]
default-character-set=character_set_name
@end example

@node Charset-literal, Charset-collate, Charset-connection, Charset-defaults
@subsection Character String Literal Character Set and Collation

Every character string literal has a character set and a collation,
which may not be null.

A character string literal may have an optional character set
introducer and @code{COLLATE} clause:

@example
[_character_set_name]'string' [COLLATE collation_name]
@end example

Examples:
@example
SELECT 'string';
SELECT _latin1'string';
SELECT _latin1'string' COLLATE latin1_danish_ci;
@end example

The simple statement @code{SELECT 'string'} uses the
connection/literal character set.

The @code{_character_set_name} expression is formally called
an @emph{introducer}. It tells the parser,
``the string that is about to follow is in character set @code{X}.''
Because this has confused people in the past, we emphasize
that an introducer does not cause any conversion, it is strictly a
signal that does not change the string's value. An introducer is
also legal before standard hex literal and numeric hex literal notation
(@code{x'literal'} and @code{0xnnnn}), and before @code{?} (parameter
substitution when using prepared statements within a programming language
interface).

Examples:

@example
SELECT _latin1 x'AABBCC';
SELECT _latin1 0xAABBCC;
SELECT _latin1 ?;
@end example

MySQL determines a literal's character set and collation thus:

@itemize @bullet
@item If both @code{_X} and @code{COLLATE Y} were specified then the literal
character set is @code{X} and the literal collation is @code{Y}
@item If @code{_X} is specified but @code{COLLATE} is not specified, then the
literal character set is @code{X} and the literal collation is @code{X}'s default
collation
@item Otherwise, the connection/literals character set and collation.

@end itemize

Examples:

@itemize @bullet
@item
A string with @code{latin1} character set and @code{latin1_german1_ci}
collation:

@example
SELECT _latin1'M@"uller' COLLATE latin1_german1_ci;
@end example

@item
A string with @code{latin1} character set and its default collation, that is,
@code{latin1_swedish_ci}:

@example
SELECT _latin1'M@"uller';
@end example

@item
A string with the connection/literals character set and collation:

@example
SELECT 'M@"uller';
@end example

@end itemize

Character set introducers and the @code{COLLATE} clause are implemented
according to standard-SQL specifications.

@node Charset-collate, Charset-collate-precedence, Charset-literal, Charset-defaults
@subsection @code{COLLATE} Clause in Various Parts of an SQL Query

With the @code{COLLATE} clause you can override whatever the default
collation is for a comparison. @code{COLLATE} may be used in
various parts of SQL queries.  Here are some examples:

@itemize @bullet

@item With @code{ORDER BY}:

@example
SELECT k
FROM t1
ORDER BY k COLLATE latin1_german2_ci;
@end example

@item With @code{AS}:

@example
SELECT k COLLATE latin1_german2_ci AS k1
FROM t1
ORDER BY k1;
@end example

@item With @code{GROUP BY}:

@example
SELECT k
FROM t1
GROUP BY k COLLATE latin1_german2_ci;
@end example

@item With aggregate functions:

@example
SELECT MAX(k COLLATE latin1_german2_ci)
FROM t1;
@end example

@item With @code{DISTINCT}:

@example
SELECT DISTINCT k COLLATE latin1_german2_ci
FROM t1;
@end example

@item With @code{WHERE}:

@example
SELECT *
FROM t1
WHERE _latin1 'M@"uller' COLLATE latin1_german2_ci = k;
@end example

@item With @code{HAVING}:

@example
SELECT k
FROM t1
GROUP BY k
HAVING k = _latin1 'M@"uller' COLLATE latin1_german2_ci;
@end example

@end itemize

@node Charset-collate-precedence, Charset-binary-op, Charset-collate, Charset-defaults
@subsection @code{COLLATE} Clause Precedence

The @code{COLLATE} clause has high precedence (higher than ||), so the expression

@example
x || y COLLATE z
@end example

is equivalent to:
@example
x || (y COLLATE z)
@end example

@node Charset-binary-op, Charset-collate-tricky, Charset-collate-precedence, Charset-defaults
@subsection @code{BINARY} Operator

The @code{BINARY} operator is a shorthand for a @code{COLLATE} clause. For
example, @code{BINARY 'x'} is equivalent to @code{'x' COLLATE y}, where
@code{y} is the
name of an appropriate binary collation. For example, assuming that
column @code{a} is of character set @code{latin1}, these two queries have the
same effect:

@example
SELECT * FROM t1 ORDER BY BINARY a;
SELECT * FROM t1 ORDER BY a COLLATE latin1_bin;
@end example

Note: Every character set has a binary collation.

@node Charset-collate-tricky, Charset-collation-charset, Charset-binary-op, Charset-defaults
@subsection Some Special Cases Where the Collation Determination is Tricky

In the great majority of queries, it is obvious what collation
MySQL uses to resolve a comparison operation. For example, in the
following cases it should be clear that the collation will be ``the
column collation of column @code{x}'':

@example
SELECT x FROM T ORDER BY x;
SELECT x FROM T WHERE x = x;
SELECT DISTINCT x FROM T;
@end example

However, when multiple operands are involved, there can be
ambiguity. For example:

@example
SELECT x FROM T WHERE x = 'Y';
@end example

Should this query use the collation of the column @code{x}, or of the
string literal @code{'Y'}?

Standard SQL resolves such questions using what used to be
called ``coercibility'' rules. The essence is: Because @code{x} and @code{'Y'}
both have collations, whose collation takes precedence? It's complex,
but these rules would take care of most situations:

@itemize @bullet

@item An explicit @code{COLLATE} clause has a coercibility of 0.
(Not coercible at all.)

@item A concatenation of two strings with different collations has
a coercibility of 1.

@item A column's collation has a coercibility of 2.

@item A literal's collation has a coercibility of 3.

@end itemize

Those rules resolve ambiguities thus:

@itemize @bullet

@item Use the collation with the lowest coercibility value.

@item If both sides have the same coercibility, then it's an error if
the collations aren't the same.

@end itemize

Examples:

@multitable @columnfractions .5 .5

@item @code{column1 = 'A'} @tab Use collation of @code{column1}
@item @code{column1 = 'A' COLLATE x} @tab Use collation of @code{'A'}
@item @code{column1 COLLATE x = 'A' COLLATE y} @tab Error

@end multitable

The @code{COERCIBILITY()} function can be used to determine the coercibility
of a string expression:

@example
mysql> SELECT COERCIBILITY('A' COLLATE latin1_swedish_ci);
        -> 0
mysql> SELECT COERCIBILITY('A');
        -> 3
@end example

@xref{Information functions}.


@node Charset-collation-charset, Charset-collation-effect, Charset-collate-tricky, Charset-defaults
@subsection Collations Must Be for the Right Character Set

Recall that each character set has one or more
collations, and each collation is associated with one and only one
character set. Therefore, the following statement
causes an error message because the @code{latin2_bin} collation is not
legal with the @code{latin1} character set:

@example
mysql> SELECT _latin1 'x' COLLATE latin2_bin;
ERROR 1251: COLLATION 'latin2_bin' is not valid
for CHARACTER SET 'latin1'
@end example

@node Charset-collation-effect,  , Charset-collation-charset, Charset-defaults
@subsection An example of the Effect of Collation

Suppose column @code{X} in table @code{T} has these @code{latin1} column values:

@example
Muffler
M@"uller
MX Systems
MySQL
@end example

And suppose that the column values are retrieved using the following
statement:

@example
SELECT X FROM T ORDER BY X COLLATE collation_name;
@end example

The resulting order of the values for different collations is shown in this
table:

@multitable @columnfractions .33 .33 .33
@item @code{latin1_swedish_ci} @tab @code{latin1_german1_ci} @tab @code{latin1_german2_ci}
@item Muffler @tab Muffler @tab M@"uller
@item MX Systems @tab M@"uller @tab Muffler
@item M@"uller @tab MX Systems @tab MX Systems
@item MySQL @tab MySQL @tab MySQL
@end multitable

The table is an example that shows what the effect would
be if we used different collations in an @code{ORDER BY} clause. The
character that's causing the trouble in this example is the U with
two dots over it, which the Germans call U-umlaut, but we'll call
it U-diaeresis.

The first column shows the result of the @code{SELECT} using the
Swedish/Finnish collating rule, which says that U-diaeresis sorts
with Y.

The second column shows the result of the @code{SELECT} using the
German DIN-1 rule, which says that U-diaeresis sorts with U.

The third column shows the result of the @code{SELECT} using the German
DIN-2 rule, which says that U-diaeresis sorts with UE.


Three different collations, three different results. That's what
MySQL is here to handle. By using the appropriate collation, you can choose
the sort order you want.

@node Charset-operations, Charset-Unicode, Charset-defaults, Charset
@section Operations Affected by Character Set Support

@menu
* Charset-result::              Result Strings
* Charset-CONVERT::             @code{CONVERT()}
* Charset-CAST::                @code{CAST()}
* Charset-SHOW-CHARSET::        @code{SHOW CHARACTER SET}
* Charset-SHOW-COLLATION::      @code{SHOW COLLATION}
* Charset-SHOW-CREATE-DB::      @code{SHOW CREATE DATABASE}
* Charset-SHOW-COLUMNS::        @code{SHOW FULL COLUMNS}
@end menu

This section describes operations that take character set information
into account now.

@node Charset-result, Charset-CONVERT, Charset-operations, Charset-operations
@subsection Result Strings

MySQL has many operators and functions that return a string.
This section answers the question: What is the character set
and collation of such a string?

For simple functions that take a string input and return a
string result as output, the output's character set and collation are the
same as the principal input's. For example, @code{UPPER(X)} returns a
string whose character string and collation are the same as that of @code{X}.
The same applies for:
@code{INSTR()},
@code{LCASE()},
@code{LOWER()},
@code{LTRIM()},
@code{MID()},
@code{REPEAT()},
@code{REPLACE()},
@code{REVERSE()},
@code{RIGHT()},
@code{RPAD()},
@code{RTRIM()},
@code{SOUNDEX()},
@code{SUBSTRING()},
@code{TRIM()},
@code{UCASE()},
@code{UPPER()}.
(Also note: the @code{REPLACE()} function, unlike all other functions,
ignores the collation of the string input and performs a
case-insensitive comparison every time.)

For operations that combine multiple string inputs and return a
single string output, SQL-99's ``aggregation rules'' apply.
They are:

@itemize @bullet
@item If explicit @code{COLLATE X} occurs, then use @code{X}
@item If explicit @code{COLLATE X} and @code{COLLATE Y} occur, then error
@item Otherwise, if all collations are @code{X}, then use @code{X}
@item Otherwise, the result has no collation

@end itemize

For example, with @code{CASE ... WHEN a THEN b WHEN b THEN c COLLATE X
END}, the resultant collation is @code{X}. The same applies for:
@code{CONCAT()},
@code{GREATEST()},
@code{IF()},
@code{LEAST()},
@code{CASE},
@code{UNION},
@code{||},
@code{ELT()}.

For operations that convert to character data, the result
string's character set and collation are in the @i{connection/literals
character set} and have the @i{connection/literals collation}.
This applies for:
@code{CHAR()},
@code{CAST()},
@code{CONV()},
@code{FORMAT()}.
@code{HEX()},
@code{SPACE()}.

@node Charset-CONVERT, Charset-CAST, Charset-result, Charset-operations
@subsection @code{CONVERT()}

@code{CONVERT()} provides a way to convert data between different
character sets. The syntax is:

@example
CONVERT(expr USING transcoding_name)
@end example

In MySQL, transcoding names are the same as the
corresponding character set names.

Examples:

@example
SELECT CONVERT(_latin1'M@"uller' USING utf8);
INSERT INTO utf8table (utf8column)
   SELECT CONVERT(latin1field USING utf8) FROM latin1table;
@end example

@code{CONVERT(... USING ...)} is implemented according to the SQL-99
specification.

@node Charset-CAST, Charset-SHOW-CHARSET, Charset-CONVERT, Charset-operations
@subsection @code{CAST()}

You may also use @code{CAST()} to convert a string to a different character
set. The new format is:

@example
CAST ( character_string AS character_data_type
    CHARACTER SET character_set_name )
@end example

Example:

@example
SELECT CAST(_latin1'test' AS CHAR CHARACTER SET utf8);
@end example

You may not use a @code{COLLATE} clause inside a @code{CAST()}, but you may use
it outside, that is, @code{CAST(... COLLATE ...)} is illegal but
@code{CAST(...) COLLATE ...} is legal.

Example:

@example
SELECT CAST(_latin1'test' AS CHAR CHARACTER SET utf8) COLLATE utf8_bin;
@end example

If you use @code{CAST()} without specifying @code{CHARACTER SET}, then the
resulting character set and collation are the connection/literal
character set and its default collation. If you use @code{CAST()} with
@code{CHARACTER SET X}, then the resulting character set is @code{X} and the
resulting collation is @code{X}'s default collation.

@node Charset-SHOW-CHARSET, Charset-SHOW-COLLATION, Charset-CAST, Charset-operations
@subsection @code{SHOW CHARACTER SET}

The @code{SHOW CHARACTER SET} command shows all available character sets.
It takes an optional @code{LIKE} clause that indicates which character set
names to match.

For example:

@example
mysql> SHOW CHARACTER SET LIKE 'latin%';
+---------+-----------------------------+-------------------+--------+
| Charset | Description                 | Default collation | Maxlen |
+---------+-----------------------------+-------------------+--------+
| latin1  | ISO 8859-1 West European    | latin1_swedish_ci |      1 |
| latin2  | ISO 8859-2 Central European | latin2_general_ci |      1 |
| latin5  | ISO 8859-9 Turkish          | latin5_turkish_ci |      1 |
| latin7  | ISO 8859-13 Baltic          | latin7_general_ci |      1 |
+---------+-----------------------------+-------------------+--------+
4 rows in set (0.00 sec)
@end example

Notes about the preceding listing:

@itemize @bullet
@item The @code{Maxlen} column shows the maximum number of bytes used to
store one character.

@end itemize

@node Charset-SHOW-COLLATION, Charset-SHOW-CREATE-DB, Charset-SHOW-CHARSET, Charset-operations
@subsection @code{SHOW COLLATION}

The output from @code{SHOW COLLATION} includes all available character
sets.
It takes an optional @code{LIKE} clause that indicates which collation
names to match.

@example
mysql> SHOW COLLATION LIKE 'latin1%';
+-------------------+---------+----+---------+----------+---------+
| Collation         | Charset | Id | Default | Compiled | Sortlen |
+-------------------+---------+----+---------+----------+---------+
| latin1_german1_ci | latin1  |  5 |         |          |       0 |
| latin1_swedish_ci | latin1  |  8 | Yes     | Yes      |       0 |
| latin1_danish_ci  | latin1  | 15 |         |          |       0 |
| latin1_german2_ci | latin1  | 31 |         | Yes      |       2 |
| latin1_bin        | latin1  | 47 |         | Yes      |       0 |
| latin1_general_ci | latin1  | 48 |         |          |       0 |
| latin1_general_cs | latin1  | 49 |         |          |       0 |
| latin1_spanish_ci | latin1  | 94 |         |          |       0 |
+-------------------+---------+----+---------+----------+---------+
7 rows in set (0.00 sec)
@end example

The @code{Default} column indicates whether a collation is the
default for its character set.
@code{Compiled} indicates whether or not the character set is
compiled into the server.
@code{Sortlen} is related to the amount of memory required to sort strings
expressed in the character set.

@node Charset-SHOW-CREATE-DB, Charset-SHOW-COLUMNS, Charset-SHOW-COLLATION, Charset-operations
@subsection @code{SHOW CREATE DATABASE}

The following query shows a @code{CREATE DATABASE} statement that will
create the given database. The result includes all database
options. @code{DEFAULT CHARACTER SET} and @code{COLLATE} are supported. All
database options are stored in a text file that can be found in
the database directory.

@c TODO: REFORMAT THIS

@example
mysql> SHOW CREATE DATABASE a;
+----------+---------------------------------------------------------------------------------+
| Database | Create Database
|
+----------+---------------------------------------------------------------------------------+
| a        | CREATE DATABASE `a` /*!40100 DEFAULT CHARACTER SET macce
COLLATE macce_ci_ai */ |
+----------+---------------------------------------------------------------------------------+
1 row in set (0.00 sec)
@end example

@node Charset-SHOW-COLUMNS,  , Charset-SHOW-CREATE-DB, Charset-operations
@subsection @code{SHOW FULL COLUMNS}

The @code{SHOW COLUMNS} statement now displays the collations of a table's
columns, when invoked as @code{SHOW FULL COLUMNS}.
Columns with @code{CHAR}, @code{VARCHAR}, or @code{TEXT} datatypes have
non-@code{NULL} collations. Numeric and other non-character types have
@code{NULL} collations. For example:

@example
mysql> SHOW FULL COLUMNS FROM a;
+-------+---------+-------------------+------+-----+---------+-------+
| Field | Type    | Collation         | Null | Key | Default | Extra |
+-------+---------+-------------------+------+-----+---------+-------+
| a     | char(1) | latin1_swedish_ci | YES  |     | NULL    |       |
| b     | int(11) | NULL              | YES  |     | NULL    |       |
+-------+---------+-------------------+------+-----+---------+-------+
2 rows in set (0.02 sec)
@end example

The character set is not part of the display.

@node Charset-Unicode, Charset-metadata, Charset-operations, Charset
@section Unicode Support

There are two new (as of MySQL version 4.1) character sets for storing 
Unicode data:
@code{ucs2} (the
UCS-2 Unicode character set) and @code{utf8} (the
UTF8 encoding of the Unicode character set).

@itemize @bullet
@item In UCS-2 (binary Unicode representation) every character is
represented by a two-byte Unicode code with the most significant
byte first. For example: "LATIN CAPITAL LETTER A" has the code
0x0041 and it's stored as a two byte sequence: 0x00 0x41. "CYRILLIC
SMALL LETTER YERU" (Unicode 0x044B) is stored as a two byte
sequence: 0x04 0x4B. For Unicode characters and their codes please
refer to the @uref{http://www.unicode.org/,Unicode Home Page}.

Temporary restriction: UCS-2 can't (yet) be used as a client
character set. That means that @code{SET NAMES 'ucs2'} will not work.

@item The UTF8 character set (transform Unicode representation) is an
alternative way to store Unicode data. It is implemented according
to RFC2279. The idea of the UTF8 character set is that various
Unicode characters fit into byte sequences of different
lengths.

@itemize @bullet
@item Basic Latin letters, digits, and punctuation signs use one
byte.
@item Most European and Middle East script letters fit into a two-byte
sequence: extended Latin letters (with tilde, macron, acute,
grave and other accents), Cyrillic, Greek, Armenian, Hebrew,
Arabic, Syriac, and others.
@item Korean, Chinese and Japanese ideographs use three-byte
sequences.
@item Currently, MySQL UTF8 support does not include four-byte sequences.

@end itemize


Tip: To save space with UTF8, use @code{VARCHAR} instead of @code{CHAR}.
Otherwise, MySQL has to reserve 30 bytes for a @code{CHAR(10) CHARACTER
SET utf8} column, because that's the maximum possible length.

@end itemize

@node Charset-metadata, Charset-compatibility, Charset-Unicode, Charset
@section UTF8 for Metadata

The metadata is the data about the data. Anything that
describes the database, as opposed to being the contents of the
database, is metadata. Thus column names, database names, user
names, version names, and most of the string results from @code{SHOW}, are
metadata.


All metadata must be in the same character set. (Otherwise, @code{SHOW}
wouldn't work properly because different rows in the same column
would be in different character sets.) On the other hand, metadata
must include all characters in all languages. (Otherwise, users
wouldn't be able to name columns and tables in their own
languages.) In order to allow for both of these objectives, MySQL
stores metadata in a Unicode character set, namely UTF8. This will
not cause any disruption if you never use accented characters. But
if you do, you should be aware that metadata is in UTF8.


This means that @code{USER()} (and its synonyms,
@code{SESSION_USER()} and @code{SYSTEM_USER()}), @code{CURRENT_USER()},
and @code{VERSION()}
functions will have the UTF8 character set by default.


This does NOT mean that the headers of columns and the results
of @code{DESCRIBE} functions will be in the UTF8 character set by default.
(When you say @code{SELECT column1 FROM t} the name @code{column1} itself will
be returned from the server to the client in the client's character
set as determined by the @code{SET NAMES} statement.)


If you want the server to pass metadata results back in a
non-UTF8 character set, then use @code{SET CHARACTER SET} to force the
server to convert (@pxref{Charset-connection}),
or set the client to do the conversion. It is
always more efficient to set the client to do the conversion, but
this option will not be available for many clients until late in
the MySQL 4.x product cycle.


If you are just using, for example, the @code{USER()} function for
comparison or assignment within a single statement ... don't worry.
MySQL will do some automatic conversion for you.

@example
SELECT * FROM Table1 WHERE USER() = latin1_column;
@end example

This will work, because the contents of @code{latin1_column} are
automatically converted to UTF8 before the comparison.

@example
INSERT INTO Table1 (latin1_column) SELECT USER();
@end example

This will work, becaues the contents of @code{USER()} are automatically
converted to @code{latin1} before the assignment.
Automatic conversion is not fully implemented yet, but should work
correctly in a later version.


Although automatic conversion is not in the SQL standard, the
SQL standard document does say that every character set is (in
terms of supported characters) a ``subset'' of Unicode. Since it is a
well-known principle that ``what applies to a superset can apply to
a subset,'' we believe that a collation for Unicode can apply for
comparisons with non-Unicode strings.


@c VERSION 4.1.1 NOTE: The @file{errmsg.txt} files will all be in UTF8
@c after this point. Conversion to the client character set will be
@c automatic, as for metadata. Also: We may change the default
@c behavior for passing back result set metadata in the near
@c future.

@node Charset-compatibility, Charset-config-file, Charset-metadata, Charset
@section Compatibility with Other DBMSs

For SAP DB compatibility these two statements are the same:
@example
CREATE TABLE t1 (f1 CHAR(n) UNICODE);
CREATE TABLE t1 (f1 CHAR(n) CHARACTER SET ucs2);
@end example


@node Charset-config-file, Charset-national, Charset-compatibility, Charset
@section New Character Set Configuration File format

In MySQL 4.1, character set configuration is stored in XML
files, one file per character set. (In previous versions, this information
was stored in @file{.conf} files.)

@node Charset-national, Charset-upgrading, Charset-config-file, Charset
@section National Character Set

In MySQL-4.x and earlier, @code{NCHAR} and @code{CHAR} were synonymous. ANSI
defines @code{NCHAR} or @code{NATIONAL CHAR} as a way to define that a
@code{CHAR}
column should use some predefined character set. MySQL uses @code{utf8} as
that predefined character set. For example, these column type declarations
are equivalent:

@example
CHAR(10) CHARACTER SET utf8
NATIONAL CHARACTER(10)
NCHAR(10)
@end example

As are these:

@example
VARCHAR(10) CHARACTER SET utf8
NATIONAL VARCHAR(10)
NCHAR VARCHAR(10)
NATIONAL CHARACTER VARYING(10)
NATIONAL CHAR VARYING(10)
@end example

You can use @code{N'literal'} to create a string in
national character set.

These two statements are equivalent:

@example
SELECT N'some text';
SELECT _utf8'some text';
@end example


@node Charset-upgrading, Charset-charsets, Charset-national, Charset
@section Upgrading from MySQL 4.0

@menu
* Charset-map::                 4.0 Character Sets and Corresponding 4.1 Character Set/Collation Pairs 
@end menu

Now, what about upgrading from older versions of MySQL? MySQL 4.1
is almost upward compatible with MySQL 4.0 and earlier for the
simple reason that almost all of the features are new, so there's
nothing in earlier versions to conflict with. However, there are
some differences and a few things to be aware of.

Most important: The ``MySQL 4.0 character set'' has the properties
of both ``MySQL 4.1 character sets'' and ``MySQL 4.1 collations.'' You
will have to unlearn this. Henceforth we will not bundle character
set / collation properties in the same conglomerate object.

There is a special treatment of national character sets in MySQL
4.1. @code{NCHAR} is not the same as @code{CHAR}, and @code{N'...'} literals
are not the same as @code{'...'} literals.

Finally, there is a different file format for storing information
about character sets and collations. Make sure you have reinstalled the
@file{/share/mysql/charsets/} directory containing the new configuration files.

If you want to start @code{mysqld} from a 4.1.x distribution with data
created by MySQL 4.0, you should start the server with the same
character set and collation. In this case you won't need to reindex
your data.

There are two ways to do so:

@example
shell> ./configure --with-character-set=... --with-collation=...
shell> ./mysqld --default-character-set=... --default-collation=...
@end example

If you used @code{mysql} with, for example, the MySQL 4.0 @code{danish}
character set, you should now use the @code{latin1} character set and
the @code{latin1_danish_ci} collation:

@example
shell> ./configure --with-character-set=latin1
           --with-collation=latin1_danish_ci
shell> ./mysqld --default-character-set=latin1
           --default-collation=latin1_danish_ci
@end example

Use the table shown in the next section to find old 4.0 character set
names and their 4.1 character set/collation pair equivalents.

@node Charset-map,  , Charset-upgrading, Charset-upgrading
@subsection 4.0 Character Sets and Corresponding 4.1 Character Set/Collation Pairs 

@multitable @columnfractions .10 .25 .25 .35
@item @strong{ID} @tab @strong{4.0 Character Set} @tab @strong{4.1 Character Set} @tab @strong{4.1 Collation}
@item 1 @tab @code{big5} @tab @code{big5} @tab @code{big5_chinese_ci}
@item 2 @tab @code{czech} @tab @code{latin2} @tab @code{latin2_czech_ci}
@item 3 @tab @code{dec8} @tab @code{dec8} @tab @code{dec8_swedish_ci}
@item 4 @tab @code{dos} @tab @code{cp850} @tab @code{cp850_general_ci}
@item 5 @tab @code{german1} @tab @code{latin1} @tab @code{latin1_german1_ci}
@item 6 @tab @code{hp8} @tab @code{hp8} @tab @code{hp8_english_ci}
@item 7 @tab @code{koi8_ru} @tab @code{koi8r} @tab @code{koi8r_general_ci}
@item 8 @tab @code{latin1} @tab @code{latin1} @tab @code{latin1_swedish_ci}
@item 9 @tab @code{latin2} @tab @code{latin2} @tab @code{latin2_general_ci}
@item 10 @tab @code{swe7} @tab @code{swe7} @tab @code{swe7_swedish_ci}
@item 11 @tab @code{usa7} @tab @code{ascii} @tab @code{ascii_general_ci}
@item 12 @tab @code{ujis} @tab @code{ujis} @tab @code{ujis_japanese_ci}
@item 13 @tab @code{sjis} @tab @code{sjis} @tab @code{sjis_japanese_ci}
@item 14 @tab @code{cp1251} @tab @code{cp1251} @tab @code{cp1251_bulgarian_ci}
@item 15 @tab @code{danish} @tab @code{latin1} @tab @code{latin1_danish_ci}
@item 16 @tab @code{hebrew} @tab @code{hebrew} @tab @code{hebrew_general_ci}
@item 17 @tab @code{win1251} @tab @code{(removed)} @tab @code{(removed)}
@item 18 @tab @code{tis620} @tab @code{tis620} @tab @code{tis620_thai_ci}
@item 19 @tab @code{euc_kr} @tab @code{euckr} @tab @code{euckr_korean_ci}
@item 20 @tab @code{estonia} @tab @code{latin7} @tab @code{latin7_estonian_ci}
@item 21 @tab @code{hungarian} @tab @code{latin2} @tab @code{latin2_hungarian_ci}
@item 22 @tab @code{koi8_ukr} @tab @code{koi8u} @tab @code{koi8u_ukrainian_ci}
@item 23 @tab @code{win1251ukr} @tab @code{cp1251} @tab @code{cp1251_ukrainian_ci}
@item 24 @tab @code{gb2312} @tab @code{gb2312} @tab @code{gb2312_chinese_ci}
@item 25 @tab @code{greek} @tab @code{greek} @tab @code{greek_general_ci}
@item 26 @tab @code{win1250} @tab @code{cp1250} @tab @code{cp1250_general_ci}
@item 27 @tab @code{croat} @tab @code{latin2} @tab @code{latin2_croatian_ci}
@item 28 @tab @code{gbk} @tab @code{gbk} @tab @code{gbk_chinese_ci}
@item 29 @tab @code{cp1257} @tab @code{cp1257} @tab @code{cp1257_lithuanian_ci}
@item 30 @tab @code{latin5} @tab @code{latin5} @tab @code{latin5_turkish_ci}
@item 31 @tab @code{latin1_de} @tab @code{latin1} @tab @code{latin1_german2_ci}
@end multitable

@node Charset-charsets,  , Charset-upgrading, Charset
@section The Character Sets and Collations that MySQL Supports

@menu
* Charset-Unicode-sets::        The Unicode Character Sets
* Charset-platform-sets::       Platform Specific Character Sets
* Charset-se-me-sets::          Character Sets for South Europe and Middle East
* Charset-asian-sets::          The Asian Character Sets
* Charset-baltic-sets::         The Baltic Character Sets
* Charset-cyrillic-sets::       The Cyrillic Character Sets
* Charset-ce-sets::             The Central European Character Sets
* Charset-we-sets::             The West European Character Sets
@end menu

Here is an annotated list of character sets and collations that
MySQL supports. Because options and installation settings differ,
some sites will not have all items in the list, and some sites will
have items that are not on the list because defining new character
sets or collations is straightforward.


MySQL supports 70+ collations for 30+ character sets.

@example
mysql> SHOW CHARACTER SET;
+----------+-----------------------------+---------------------+--------+
| Charset  | Description                 | Default collation   | Maxlen |
+----------+-----------------------------+---------------------+--------+
| big5     | Big5 Traditional Chinese    | big5_chinese_ci     |      2 |
| dec8     | DEC West European           | dec8_swedish_ci     |      1 |
| cp850    | DOS West European           | cp850_general_ci    |      1 |
| hp8      | HP West European            | hp8_english_ci      |      1 |
| koi8r    | KOI8-R Relcom Russian       | koi8r_general_ci    |      1 |
| latin1   | ISO 8859-1 West European    | latin1_swedish_ci   |      1 |
| latin2   | ISO 8859-2 Central European | latin2_general_ci   |      1 |
| swe7     | 7bit Swedish                | swe7_swedish_ci     |      1 |
| ascii    | US ASCII                    | ascii_general_ci    |      1 |
| ujis     | EUC-JP Japanese             | ujis_japanese_ci    |      3 |
| sjis     | Shift-JIS Japanese          | sjis_japanese_ci    |      2 |
| cp1251   | Windows Cyrillic            | cp1251_bulgarian_ci |      1 |
| hebrew   | ISO 8859-8 Hebrew           | hebrew_general_ci   |      1 |
| tis620   | TIS620 Thai                 | tis620_thai_ci      |      1 |
| euckr    | EUC-KR Korean               | euckr_korean_ci     |      2 |
| koi8u    | KOI8-U Ukrainian            | koi8u_general_ci    |      1 |
| gb2312   | GB2312 Simplified Chinese   | gb2312_chinese_ci   |      2 |
| greek    | ISO 8859-7 Greek            | greek_general_ci    |      1 |
| cp1250   | Windows Central European    | cp1250_general_ci   |      1 |
| gbk      | GBK Simplified Chinese      | gbk_chinese_ci      |      2 |
| latin5   | ISO 8859-9 Turkish          | latin5_turkish_ci   |      1 |
| armscii8 | ARMSCII-8 Armenian          | armscii8_general_ci |      1 |
| utf8     | UTF-8 Unicode               | utf8_general_ci     |      3 |
| ucs2     | UCS-2 Unicode               | ucs2_general_ci     |      2 |
| cp866    | DOS Russian                 | cp866_general_ci    |      1 |
| keybcs2  | DOS Kamenicky Czech-Slovak  | keybcs2_general_ci  |      1 |
| macce    | Mac Central European        | macce_general_ci    |      1 |
| macroman | Mac West European           | macroman_general_ci |      1 |
| cp852    | DOS Central European        | cp852_general_ci    |      1 |
| latin7   | ISO 8859-13 Baltic          | latin7_general_ci   |      1 |
| cp1256   | Windows Arabic              | cp1256_general_ci   |      1 |
| cp1257   | Windows Baltic              | cp1257_general_ci   |      1 |
| binary   | Binary pseudo charset       | binary              |      1 |
+----------+-----------------------------+---------------------+--------+
33 rows in set (0.01 sec)
@end example

NB: ALL CHARACTER SETS HAVE A BINARY COLLATION. WE HAVE NOT
INCLUDED THE BINARY COLLATION IN ALL THE DESCRIPTIONS THAT FOLLOW.

@node Charset-Unicode-sets, Charset-platform-sets, Charset-charsets, Charset-charsets
@subsection The Unicode Character Sets

There are our two Unicode character sets. You can store
texts in about 650 languages using these character sets. We have
not added a large number of collations for these two new sets yet,
but that will be happening soon. Now they have default
case-insensitive accent-insensitive collations, plus the binary
collation.
@example
+---------+-----------------+-------------------+--------+
| Charset | Description     | Default collation | Maxlen |
+---------+-----------------+-------------------+--------+
| utf8    | UTF-8 Unicode   | utf8_general_ci   |      3 |
| ucs2    | UCS-2 Unicode   | ucs2_general_ci   |      2 |
+---------+-----------------+-------------------+--------+
@end example


@node Charset-platform-sets, Charset-se-me-sets, Charset-Unicode-sets, Charset-charsets
@subsection Platform Specific Character Sets

@example
+----------+-----------------------------+---------------------+--------+
| Charset  | Description                 | Default collation   | Maxlen |
+----------+-----------------------------+---------------------+--------+
| dec8     | DEC West European           | dec8_swedish_ci     |      1 |
| hp8      | HP West European            | hp8_english_ci      |      1 |
+----------+-----------------------------+---------------------+--------+
@end example


@node Charset-se-me-sets, Charset-asian-sets, Charset-platform-sets, Charset-charsets
@subsection Character Sets for South Europe and Middle East

@example
+----------+-----------------------------+---------------------+--------+
| Charset  | Description                 | Default collation   | Maxlen |
+----------+-----------------------------+---------------------+--------+
| armscii8 | ARMSCII-8 Armenian          | armscii8_general_ci |      1 |
| cp1256   | Windows Arabic              | cp1256_general_ci   |      1 |
| hebrew   | ISO 8859-8 Hebrew           | hebrew_general_ci   |      1 |
| greek    | ISO 8859-7 Greek            | greek_general_ci    |      1 |
| latin5   | ISO 8859-9 Turkish          | latin5_turkish_ci   |      1 |
| geostd8  | Georgian                    | geostd8_general_ci  |      1 |
+----------+-----------------------------+---------------------+--------+
@end example


@node Charset-asian-sets, Charset-baltic-sets, Charset-se-me-sets, Charset-charsets
@subsection The Asian Character Sets

The Asian character sets that we support include Chinese, Japanese,
Korean, and Thai. These can be complicated. For example, the Chinese
sets have to allow for thousands of different characters.
@example
+----------+-----------------------------+---------------------+--------+
| Charset  | Description                 | Default collation   | Maxlen |
+----------+-----------------------------+---------------------+--------+
| big5     | Big5 Traditional Chinese    | big5_chinese_ci     |      2 |
| gb2312   | GB2312 Simplified Chinese   | gb2312_chinese_ci   |      2 |
| gbk      | GBK Simplified Chinese      | gbk_chinese_ci      |      2 |
| euckr    | EUC-KR Korean               | euckr_korean_ci     |      2 |
| ujis     | EUC-JP Japanese             | ujis_japanese_ci    |      3 |
| sjis     | Shift-JIS Japanese          | sjis_japanese_ci    |      2 |
| tis620   | TIS620 Thai                 | tis620_thai_ci      |      1 |
+----------+-----------------------------+---------------------+--------+
@end example

@node Charset-baltic-sets, Charset-cyrillic-sets, Charset-asian-sets, Charset-charsets
@subsection The Baltic Character Sets

The Baltic character sets cover Estonian, Latvian, and Lithuanian
languages. There are two Baltic character sets currently supported:

@itemize @bullet
@item @code{latin7} (ISO 8859-13 Baltic):
@example
+----------------------+----------+----+---------+----------+---------+
| Collation            | Charset  | Id | Default | Compiled | Sortlen |
+----------------------+----------+----+---------+----------+---------+
| latin7_estonian_cs   | latin7   | 20 |         |          |       0 |
| latin7_general_ci    | latin7   | 41 | Yes     |          |       0 |
| latin7_general_cs    | latin7   | 42 |         |          |       0 |
| latin7_bin           | latin7   | 79 |         |          |       0 |
+----------------------+----------+----+---------+----------+---------+
@end example

@item @code{cp1257} (Windows Baltic):
@example
+----------------------+----------+----+---------+----------+---------+
| Collation            | Charset  | Id | Default | Compiled | Sortlen |
+----------------------+----------+----+---------+----------+---------+
| cp1257_lithuanian_ci | cp1257   | 29 |         |          |       0 |
| cp1257_bin           | cp1257   | 58 |         |          |       0 |
| cp1257_general_ci    | cp1257   | 59 | Yes     |          |       0 |
+----------------------+----------+----+---------+----------+---------+
@end example

@end itemize

@node Charset-cyrillic-sets, Charset-ce-sets, Charset-baltic-sets, Charset-charsets
@subsection The Cyrillic Character Sets

Here are the Cyrillic character sets and collations for use with
Belarusian, Bulgarian, Russian, Ukrainian languages.

@c -- It might seem
@c odd that we seem to have a general Cyrillic collation which is
@c supposed to fit all the Cyrillic alphabets except Ukrainian, and one
@c for Ukrainian. The difference only comes up for one character, the
@c soft sign.--

@itemize @bullet
@item @code{cp1251} (Windows Cyrillic):
@example
+----------------------+----------+----+---------+----------+---------+
| Collation            | Charset  | Id | Default | Compiled | Sortlen |
+----------------------+----------+----+---------+----------+---------+
| cp1251_bulgarian_ci  | cp1251   | 14 |         |          |       0 |
| cp1251_ukrainian_ci  | cp1251   | 23 |         |          |       0 |
| cp1251_bin           | cp1251   | 50 |         |          |       0 |
| cp1251_general_ci    | cp1251   | 51 | Yes     |          |       0 |
| cp1251_general_cs    | cp1251   | 52 |         |          |       0 |
+----------------------+----------+----+---------+----------+---------+
@end example

@item @code{cp866} (DOS Russian):
@example
+----------------------+----------+----+---------+----------+---------+
| Collation            | Charset  | Id | Default | Compiled | Sortlen |
+----------------------+----------+----+---------+----------+---------+
| cp866_general_ci     | cp866    | 36 | Yes     |          |       0 |
| cp866_bin            | cp866    | 68 |         |          |       0 |
+----------------------+----------+----+---------+----------+---------+
@end example

@item @code{koi8r} (KOI8-R Relcom Russian, primarily used in Russia on Unix):
@example
+----------------------+----------+----+---------+----------+---------+
| Collation            | Charset  | Id | Default | Compiled | Sortlen |
+----------------------+----------+----+---------+----------+---------+
| koi8r_general_ci     | koi8r    |  7 | Yes     |          |       0 |
| koi8r_bin            | koi8r    | 74 |         |          |       0 |
+----------------------+----------+----+---------+----------+---------+
@end example

@item @code{koi8u} (KOI8-U Ukrainian, primarily used in Ukraine on Unix):
@example
+----------------------+----------+----+---------+----------+---------+
| Collation            | Charset  | Id | Default | Compiled | Sortlen |
+----------------------+----------+----+---------+----------+---------+
| koi8u_general_ci     | koi8u    | 22 | Yes     |          |       0 |
| koi8u_bin            | koi8u    | 75 |         |          |       0 |
+----------------------+----------+----+---------+----------+---------+
@end example

@end itemize

@node Charset-ce-sets, Charset-we-sets, Charset-cyrillic-sets, Charset-charsets
@subsection The Central European Character Sets

We have some support for character sets used in The Czech Republic,
Slovakia, Hungary, Romania, Slovenia, Croatia, and Poland.

@itemize @bullet
@item @code{cp1250} (Windows Central European):
@example
+----------------------+----------+----+---------+----------+---------+
| Collation            | Charset  | Id | Default | Compiled | Sortlen |
+----------------------+----------+----+---------+----------+---------+
| cp1250_general_ci    | cp1250   | 26 | Yes     |          |       0 |
| cp1250_czech_ci      | cp1250   | 34 |         | Yes      |       2 |
| cp1250_bin           | cp1250   | 66 |         |          |       0 |
+----------------------+----------+----+---------+----------+---------+
@end example

@item @code{cp852} (DOS Central European):
@example
+----------------------+----------+----+---------+----------+---------+
| Collation            | Charset  | Id | Default | Compiled | Sortlen |
+----------------------+----------+----+---------+----------+---------+
| cp852_general_ci     | cp852    | 40 | Yes     |          |       0 |
| cp852_bin            | cp852    | 81 |         |          |       0 |
+----------------------+----------+----+---------+----------+---------+
@end example

@item @code{macce} (Mac Central European):
@example
+----------------------+----------+----+---------+----------+---------+
| Collation            | Charset  | Id | Default | Compiled | Sortlen |
+----------------------+----------+----+---------+----------+---------+
| macce_general_ci     | macce    | 38 | Yes     |          |       0 |
| macce_bin            | macce    | 43 |         |          |       0 |
+----------------------+----------+----+---------+----------+---------+
@end example

@item @code{latin2} (ISO 8859-2 Central European):
@example
+----------------------+----------+----+---------+----------+---------+
| Collation            | Charset  | Id | Default | Compiled | Sortlen |
+----------------------+----------+----+---------+----------+---------+
| latin2_czech_ci      | latin2   |  2 |         | Yes      |       4 |
| latin2_general_ci    | latin2   |  9 | Yes     |          |       0 |
| latin2_hungarian_ci  | latin2   | 21 |         |          |       0 |
| latin2_croatian_ci   | latin2   | 27 |         |          |       0 |
| latin2_bin           | latin2   | 77 |         |          |       0 |
+----------------------+----------+----+---------+----------+---------+
@end example

@item @code{keybcs2} (DOS Kamenicky Czech-Slovak):
@example
+----------------------+----------+----+---------+----------+---------+
| Collation            | Charset  | Id | Default | Compiled | Sortlen |
+----------------------+----------+----+---------+----------+---------+
| keybcs2_general_ci   | keybcs2  | 37 | Yes     |          |       0 |
| keybcs2_bin          | keybcs2  | 73 |         |          |       0 |
+----------------------+----------+----+---------+----------+---------+
@end example

@end itemize


@node Charset-we-sets,  , Charset-ce-sets, Charset-charsets
@subsection The West European Character Sets

West European Character Sets cover most West European languages,
such as French, Spanish, Catalan, Basque, Portuguese, Italian,
Albanian, Dutch, German, Danish, Swedish, Norwegian, Finnish,
Faroese, Icelandic, Irish, Scottish, and English.

@itemize @bullet
@item @code{latin1} (ISO 8859-1 West European):
@example
+----------------------+----------+----+---------+----------+---------+
| Collation            | Charset  | Id | Default | Compiled | Sortlen |
+----------------------+----------+----+---------+----------+---------+
| latin1_german1_ci    | latin1   |  5 |         |          |       0 |
| latin1_swedish_ci    | latin1   |  8 | Yes     | Yes      |       0 |
| latin1_danish_ci     | latin1   | 15 |         |          |       0 |
| latin1_german2_ci    | latin1   | 31 |         | Yes      |       2 |
| latin1_bin           | latin1   | 47 |         | Yes      |       0 |
| latin1_general_ci    | latin1   | 48 |         |          |       0 |
| latin1_general_cs    | latin1   | 49 |         |          |       0 |
| latin1_spanish_ci    | latin1   | 94 |         |          |       0 |
+----------------------+----------+----+---------+----------+---------+
@end example

The @code{latin1_swedish_ci} collation is the default that probably is
used by the majority of MySQL customers. It is constantly stated
that this is based on the Swedish/Finnish collation rules, but you
will find Swedes and Finns who disagree with that statement.

The @code{latin1_german1_ci} and @code{latin1_german2_ci}
collations are based on the DIN-1 and DIN-2 standards,
where DIN stands for Deutsches Institut f@"ur Normung (that is,
the German answer to ANSI).
DIN-1 is called the dictionary collation and DIN-2 is called the
phone-book collation.

@itemize @bullet

@item @code{latin1_german1_ci} (dictionary) rules:

@display
@samp{@"A} = @samp{A}, @samp{@"O} = @samp{O}, @samp{@"U} = @samp{U}, @samp{@ss{}} = @samp{s}
@end display

@item @code{latin1_german2_ci} (phone-book) rules:

@display
@samp{@"A} = @samp{AE}, @samp{@"O} = @samp{OE}, @samp{@"U} = @samp{UE}, @samp{@ss{}} = @samp{ss}
@end display

@end itemize

In the @code{latin1_spanish_ci} collation, @samp{@~N} (N-tilde) is a
separate letter between @samp{N} and @samp{O}.

@item @code{macroman} (Mac West European):
@example
+----------------------+----------+----+---------+----------+---------+
| Collation            | Charset  | Id | Default | Compiled | Sortlen |
+----------------------+----------+----+---------+----------+---------+
| macroman_general_ci  | macroman | 39 | Yes     |          |       0 |
| macroman_bin         | macroman | 53 |         |          |       0 |
+----------------------+----------+----+---------+----------+---------+
@end example

@item @code{cp850} (DOS West European):
@example
+----------------------+----------+----+---------+----------+---------+
| Collation            | Charset  | Id | Default | Compiled | Sortlen |
+----------------------+----------+----+---------+----------+---------+
| cp850_general_ci     | cp850    |  4 | Yes     |          |       0 |
| cp850_bin            | cp850    | 80 |         |          |       0 |
+----------------------+----------+----+---------+----------+---------+
@end example

@end itemize

@node Spatial extensions in MySQL, Stored Procedures, Charset, Top
@chapter Spatial Extensions in MySQL
@cindex GIS

@c TODO: alphabetize function listings in each section

@c help_category Geographic features

MySQL 4.1 introduces spatial extensions to allow the
generation, storage, and analysis of geographic features.
Currently, these features are available for MyISAM tables only.

This chapter covers the following topics:

@itemize @bullet

@item
The basis of these spatial extensions in the OpenGIS geometry model

@item
Data formats for representing spatial data

@item
How to use spatial data in MySQL

@item
Use of indexing for spatial data

@item
MySQL differences from the OpenGIS specification

@end itemize

@menu
* GIS introduction::            Introduction
* OpenGIS geometry model::      The OpenGIS Geometry Model
* Supported spatial data formats::  Supported Spatial Data Formats
* Creating a spatially enabled MySQL database::  Creating a Spatially Enabled MySQL Database
* Analysing spatial information::  Analyzing Spatial Information
* Optimising spatial analysis::  Optimizing Spatial Analysis
* MySQL GIS conformance and compatibility::  MySQL Conformance and Compatibility
@end menu


@node GIS introduction, OpenGIS geometry model, Spatial extensions in MySQL, Spatial extensions in MySQL
@section Introduction

@cindex Spatial Extensions in MySQL

@cindex GIS
@cindex OpenGIS

MySQL implements spatial extensions following the specification of
the @code{Open GIS Consortium} (OGC). This is an international consortium
of more than 250 companies, agencies, and universities participating
in the development of publicly available conceptual solutions that can be
useful with all kinds of applications that manage spatial data.
The OGC maintains a web site at @uref{http://www.opengis.org/}.

In 1997, the Open GIS Consortium published the
@cite{OpenGIS (R) Simple Features Specifications For SQL}, a document that
proposes several conceptual ways for extending an SQL RDBMS to support spatial
data. This specification is available from the Open GIS web site at
@url{http://www.opengis.org/docs/99-049.pdf}.
It contains additional information relevant to this chapter.

MySQL implements a subset of the @strong{SQL with Geometry Types}
environment proposed by OGC.
This term refers to an SQL environment that has been extended with a
set of geometry types. A geometry-valued SQL column is implemented as
a column that has a geometry type. The specifications describe a set of SQL
geometry types, as well as functions on those types to create and
analyze geometry values.

@cindex geographic feature

A @strong{geographic feature} is anything in the world that has a location.
A feature can be:

@itemize @bullet
@item
An entity. For example, a mountain, a pond, a city.
@item
A space. For example, a postcode area, the tropics.
@item
A definable location. For example, a crossroad,
as a particular place where two streets intersect.
@end itemize

@cindex geospatial feature

You can also find documents that use the term @strong{geospatial feature} to
refer to geographic features.

@cindex geometry

@strong{Geometry} is another word that denotes a geographic feature.
Originally the word @strong{geometry} means measurement of the earth.
Another meaning comes from cartography, referring to the geometric
features that cartographers use to map the world.

This chapter uses all of these terms synonymously:
@strong{geographic feature}, @strong{geospatial feature},
@strong{feature}, or @strong{geometry}.
The term most commonly used here is @strong{geometry}.

Let's define a @strong{geometry} as @emph{a point or an aggregate of
points representing anything in the world that has a location}.


@node OpenGIS geometry model, Supported spatial data formats, GIS introduction, Spatial extensions in MySQL
@section The OpenGIS Geometry Model

The set of geometry types proposed by OGC's @strong{SQL with Geometry Types}
environment is based on the @strong{OpenGIS Geometry Model}. In this model,
each geometric object has the following general properties:

@itemize @bullet
@item
It is associated with a Spatial Reference System, which describes the
coordinate space in which the object is defined.
@item
It belongs to some geometry class.
@end itemize


@menu
* GIS geometry class hierarchy::  The Geometry Class Hierarchy
* GIS class geometry::          Class @code{Geometry}
* GIS class point::             Class @code{Point}
* GIS class curve::             Class @code{Curve}
* GIS class linestring::        Class @code{LineString}
* GIS class surface::           Class @code{Surface}
* GIS class polygon::           Class @code{Polygon}
* GIS class geometrycollection::  Class @code{GeometryCollection}
* GIS class multipoint::        Class @code{MultiPoint}
* GIS class multicurve::        Class @code{MultiCurve}
* GIS class multilinestring::   Class @code{MultiLineString}
* GIS class multisurface::      Class @code{MultiSurface}
* GIS class multipolygon::      Class @code{MultiPolygon}
@end menu


@node GIS geometry class hierarchy, GIS class geometry, OpenGIS geometry model, OpenGIS geometry model
@subsection The Geometry Class Hierarchy

The geometry classes define a hierarchy as follows:

@itemize @bullet
@item @code{Geometry} (non-instantiable)
  @itemize @bullet
  @item @code{Point} (instantiable)

  @item @code{Curve} (non-instantiable)
    @itemize @bullet
    @item @code{LineString} (instantiable)
      @itemize @bullet
      @item @code{Line}
      @item @code{LinearRing}
      @end itemize
    @end itemize

  @item @code{Surface} (non-instantiable)
    @itemize @bullet
    @item @code{Polygon} (instantiable)
    @end itemize

  @item @code{GeometryCollection} (instantiable)
    @itemize @bullet
    @item @code{MultiPoint} (instantiable)
    @item @code{MultiCurve} (non-instantiable)
      @itemize @bullet
      @item @code{MultiLineString} (instantiable)
      @end itemize
    @item @code{MultiSurface} (non-instantiable)
      @itemize @bullet
      @item @code{MultiPolygon} (instantiable)
      @end itemize
    @end itemize

  @end itemize
@end itemize

It is not possible to create objects in non-instantiable classes.
It is possible to create objects in instantiable classes.
All classes have properties, and instantiable classes may also
have assertions (rules that define valid class instances).

@c help_category Geographic features
@c description_for_help_topic Geometry hierarchy
@code{Geometry} is the base class. It's an abstract class.
The instantiable subclasses of @code{Geometry} are restricted to zero-, one-,
and two-dimensional geometric objects that exist in
two-dimensional coordinate space. All instantiable geometry classes are
defined so that valid instances of a geometry class are topologically closed
(that is, all defined geometries include their boundary).

The base @code{Geometry} class has subclasses for @code{Point},
@code{Curve}, @code{Surface} and @code{GeometryCollection}:

@itemize @bullet

@item
@code{Point} represents zero-dimensional objects.

@item
@code{Curve} represents one-dimensional objects, and has subclass
@code{LineString}, with sub-subclasses @code{Line} and @code{LinearRing}.

@item
@code{Surface} is designed for two-dimensional objects and
has subclass @code{Polygon}.

@item
@code{GeometryCollection}
has specialized zero-, one-, and two-dimensional collection classes named
@code{MultiPoint}, @code{MultiLineString}, and @code{MultiPolygon}
for modelling geometries corresponding to collections of
@code{Points}, @code{LineStrings}, and @code{Polygons}, respectively.
@code{MultiCurve} and @code{MultiSurface} are introduced as abstract superclasses
that generalize the collection interfaces to handle @code{Curves} and @code{Surfaces}.

@end itemize

@code{Geometry}, @code{Curve}, @code{Surface}, @code{MultiCurve},
and @code{MultiSurface} are defined as non-instantiable classes.
They define a common set of methods for their subclasses and
are included for extensibility.

@code{Point}, @code{LineString}, @code{Polygon}, @code{GeometryCollection},
@code{MultiPoint}, @code{MultiLineString}, and
@code{MultiPolygon} are instantiable classes.
@c end_description_for_help_topic

@node GIS class geometry, GIS class point, GIS geometry class hierarchy, OpenGIS geometry model
@subsection Class @code{Geometry}

@code{Geometry} is the root class of the hierarchy.  It is a
non-instantiable class but has a number of properties that are common to
all geometry values created from any of the @code{Geometry} subclasses.
These properties are described in the following list.  (Particular
subclasses have their own specific properties, described later.)


@subheading Geometry properties

A geometry value has the following properties:

@itemize @bullet

@item
Its @strong{type}.
Each geometry belongs to one of the instantiable classes in the hierarchy.

@item
Its @strong{SRID}, or Spatial Reference Identifier. This value identifies
the geometry's associated Spatial Reference System that describes the
coordinate space in which the geometry object is defined.

@item
Its @strong{coordinates} in its Spatial Reference System,
represented as double-precision (8-byte) numbers. All non-empty geometries
include at least one pair of (X,Y) coordinates. Empty geometries contain
no coordinates.

Coordinates are related to the SRID.
For example, in different coordinate systems, the distance between two objects
may differ even when objects have the same coordinates, because the distance
on the @strong{planar} coordinate system and the distance on the @strong{geocentric}
system (coordinates on the Earth's surface) are different things.

@item
Its @strong{interior}, @strong{boundary}, and @strong{exterior}.
@c help_category MBR@Geographic features
@c description_for_help_topic MBR definition
Every geometry occupies some position in space. The exterior of
a geometry is all space not occupied by the geometry. The interior
is the space occupied by the geometry. The boundary is the
interface between the geometry's interior and exterior.

@item
Its @strong{MBR} (Minimum Bounding Rectangle), or Envelope.
This is the bounding geometry, formed by the minimum and maximum (X,Y)
coordinates:
@c end_description_for_help_topic

@c example_for_help_topic MBR definition
@example
((MINX MINY, MAXX MINY, MAXX MAXY, MINX MAXY, MINX MINY))
@end example

@item
The quality of being @strong{simple} or @strong{non-simple}.
Geometry values of types (@code{LineString}, @code{MultiPoint},
@code{MultiLineString})
are either simple or non-simple. Each type determines its own assertions
for being simple or non-simple.

@item
The quality of being @strong{closed} or @strong{not closed}.
Geometry values of types (@code{LineString}, @code{MultiString}) are
either closed
or not closed. Each type determines its own assertions for being closed
or not closed.

@item
The quality of being @strong{empty} or @strong{not empty}
A geometry is empty if it does not have any points.
Exterior, interior and boundary of an empty geometry
are not defined (that is, they are represented by a @code{NULL} value).
An empty geometry is defined to be always simple and has an area of 0.

@item
Its @strong{dimension}. A geometry can have a dimension of @minus{}1, 0, 1,
or 2:

@itemize @bullet

@item @minus{}1 for empty geometry.

@item 0 for geometry with no length and no area.

@item 1 for geometry with non-zero length and zero area.

@item 2 for geometry with non-zero area.

@end itemize

@code{Point} objects have a dimension of zero.  @code{LineString}
objects have a dimension of 1. @code{Polygon} objects have a
dimension of 2.  The dimensions of @code{MultiPoint},
@code{MultiLineString}, and @code{MultiPolygon} objects are the
same as the dimensions of the elements they consist of.

@end itemize


@node GIS class point, GIS class curve, GIS class geometry, OpenGIS geometry model
@subsection Class @code{Point}

A @code{Point} is a geometry that represents a single
location in coordinate space.

@subheading @code{Point} Examples

@itemize @bullet

@item
Imagine a large-scale map of the world with many cities.
A point could represent each city.

@item
On a city map, a Point could represent a bus stop.
@end itemize

@subheading @code{Point} Properties

@itemize @bullet

@item
X-coordinate value.

@item
Y-coordinate value.

@item
@code{Point} is defined as a zero-dimensional geometry.

@item
The boundary of a @code{Point} is the empty set.
@end itemize


@node GIS class curve, GIS class linestring, GIS class point, OpenGIS geometry model
@subsection Class @code{Curve}

A @code{Curve} is a one-dimensional geometry, usually represented by a sequence
of points. Particular subclasses of @code{Curve} define the type of
interpolation between points. @code{Curve} is a non-instantiable class.

@subheading @code{Curve} Properties

@itemize @bullet

@item
A @code{Curve} has the coordinates of its points.

@item
A @code{Curve} is defined as a one-dimensional geometry.

@item
A @code{Curve} is simple if it does not pass through the same point twice.

@item
A @code{Curve} is closed if its start point is equal to its end point.

@item
The boundary of a closed @code{Curve} is empty.

@item
The boundary of a non-closed @code{Curve} consists of its two end points.

@item
A @code{Curve} that is simple and closed is a @code{LinearRing}.

@end itemize


@node GIS class linestring, GIS class surface, GIS class curve, OpenGIS geometry model
@subsection Class @code{LineString}

A @code{LineString} is a @code{Curve} with linear interpolation between points.

@subheading @code{LineString} Examples

@itemize @bullet

@item
On a world map, @code{LineString} objects could represent rivers.

@item
In a city map, @code{LineString} objects could represent streets.

@end itemize

@subheading @code{LineString} Properties

@itemize @bullet

@item
A @code{LineString} has coordinates of segments, defined by each consecutive pair of points.

@item
A @code{LineString} is a @code{Line} if it consists of exactly two points.

@item
A @code{LineString} is a @code{LinearRing} if it's both closed and simple.

@end itemize


@node GIS class surface, GIS class polygon, GIS class linestring, OpenGIS geometry model
@subsection Class @code{Surface}

@c TODO: need examples

A @code{Surface} is a two-dimensional geometry. It is a non-instantiable
class. Its only instantiable subclass is @code{Polygon}.

@c Simple surfaces in three-dimensional space are isomorphic to planar surfaces.
@c Polyhedral surfaces are formed by 'stitching' together simple surfaces along
@c their boundaries, polyhedral surfaces in three-dimensional space may not be
@c planar as a whole.

@subheading @code{Surface} Properties

@itemize @bullet

@item
A @code{Surface} is defined as a two-dimensional geometry.

@item
The OpenGIS specification defines a simple @code{Surface} as a geometry that
consists of a single ``patch'' that is associated with a single exterior
boundary and zero or more interior boundaries.

@item
The boundary of a simple @code{Surface} is the set of closed curves
corresponding to its exterior and interior boundaries.

@end itemize


@node GIS class polygon, GIS class geometrycollection, GIS class surface, OpenGIS geometry model
@subsection Class @code{Polygon}

A @code{Polygon} is a planar @code{Surface} representing a multisided
geometry. It is defined by a single exterior boundary and zero or more
interior boundaries, where
each interior boundary defines a hole in the @code{Polygon}.

@subheading @code{Polygon} Examples

@itemize @bullet

@item
On a region map, @code{Polygon} objects could represent forests, districts, etc.

@end itemize

@subheading @code{Polygon} Assertions

@itemize @bullet

@item
The boundary of a @code{Polygon} consists of a set of @code{LinearRing} objects
(that is, @code{LineString} objects that are both simple and closed) that make up its
exterior and interior boundaries.

@item
A @code{Polygon} has no rings which cross. The rings in the boundary of a
@code{Polygon} may intersect at a @code{Point}, but only as a tangent.

@item
A @code{Polygon} has no lines, spikes, or punctures.

@item
A @code{Polygon} has an interior which is a connected point set.

@item
A @code{Polygon} may have holes.
The exterior of a @code{Polygon} with holes is not connected.
Each hole defines a connected component of the exterior.

@end itemize

The above assertions make a @code{Polygon} a simple geometry.

@c Interior, Closure and Exterior have the standard topological definitions.
@c The combination of 1 and 3 make a Polygon a Regular Closed point set.


@node GIS class geometrycollection, GIS class multipoint, GIS class polygon, OpenGIS geometry model
@subsection Class @code{GeometryCollection}

A @code{GeometryCollection} is a geometry that is a collection of one or more
geometries of any class.

All the elements in a @code{GeometryCollection} must be in
the same Spatial Reference System (that is, in the same coordinate system).
There are no other constraints on the elements of a @code{GeometryCollection},
although the
subclasses of @code{GeometryCollection} described in the following sections
may restrict membership. Retrictions may be based on:

@itemize @bullet

@item
Element type (for example, a @code{MultiPoint} may contain only @code{Point}
elements)

@item
Dimension

@item
Constraints on the degree of spatial overlap between elements

@end itemize


@node GIS class multipoint, GIS class multicurve, GIS class geometrycollection, OpenGIS geometry model
@subsection Class @code{MultiPoint}

A @code{MultiPoint} is a geometry collection composed of
@code{Point} elements. The points are not connected or ordered
in any way.

@subheading @code{MultiPoint} Examples

@itemize @bullet

@item
On a world map, a @code{Multipoint} could represent a chain of small islands.

@item
On a city map, a @code{Multipoint} could represent the outlets for a ticket
office.

@end itemize

@subheading @code{MultiPoint} Properties

@itemize @bullet

@item
A @code{MultiPoint} is a zero-dimensional geometry.

@item
A @code{MultiPoint} is simple if no two of its @code{Point} values are
equal (have identical coordinate values).

@item
A @code{MultiPoint}'s boundary is the empty set.

@end itemize


@node GIS class multicurve, GIS class multilinestring, GIS class multipoint, OpenGIS geometry model
@subsection Class @code{MultiCurve}

A @code{MultiCurve} is a geometry collection composed of
@code{Curve} elements. @code{MultiCurve} is a non-instantiable class.

@subheading @code{MultiCurve} Properties

@itemize @bullet

@item
A @code{MultiCurve} is a one-dimensional geometry.

@item
A @code{MultiCurve} is simple if and only if all of its elements are simple,
the only intersections between any two elements occur at points that are
on the boundaries of both elements.

@item
A @code{MultiCurve} boundary is obtained by applying the ``mod 2 union
rule'' (also known as the odd-even rule):
A point is in the boundary of a @code{MultiCurve} if it is in the
boundaries of an odd number of @code{MultiCurve} elements.

@item
A @code{MultiCurve} is closed if all of its elements are closed.

@item
A closed @code{MultiCurve}'s boundary is always empty.

@end itemize


@node GIS class multilinestring, GIS class multisurface, GIS class multicurve, OpenGIS geometry model
@subsection Class @code{MultiLineString}

A @code{MultiLineString} is a @code{MultiCurve} geometry collection composed
of @code{LineString} elements.

@subheading @code{MultiLineString} Examples

@itemize @bullet

@item
On a region map, a @code{MultiLineString} could represent a river system or
a highway system.

@end itemize


@node GIS class multisurface, GIS class multipolygon, GIS class multilinestring, OpenGIS geometry model
@subsection Class @code{MultiSurface}

A @code{MultiSurface} is a geometry collection composed of surface elements.
@code{MultiSurface} is a non-instantiable class. Its only instantiable
subclass is @code{MultiPolygon}.

@subheading @code{MultiSurface} Assertions

@itemize @bullet

@item
Two @code{MultiSurface} surfaces have no interiors which intersect.

@item
Two @code{MultiSurface} elements have boundries which
intersect at most at a finite number of points.

@end itemize


@node GIS class multipolygon,  , GIS class multisurface, OpenGIS geometry model
@subsection Class @code{MultiPolygon}

A @code{MultiPolygon} is a @code{MultiSurface} object composed of
@code{Polygon} elements.

@subheading @code{MultiPolygon} Examples

@itemize @bullet

@item
On a region map, a @code{MultiPolygon} could represent a system of lakes.

@end itemize

@subheading @code{MultiPolygon} Assertions

@itemize @bullet

@item
A @code{MultiPolygon} has no two @code{Polygon} elements with interiors
that intersect.

@item
A @code{MultiPolygon} has no two @code{Polygon} elements that cross
(crossing is also forbidden by the previous assertion), or that
touch at an infinite number of points.

@item
A @code{MultiPolygon} may not have cut lines, spikes or punctures. A
@code{MultiPolygon} is a regular, closed point set.

@item
A @code{MultiPolygon} which has more than one @code{Polygon} has an
interior which is not connected. The number of connected components of the interior
of a @code{MultiPolygon} is equal to the number of @code{Polygon} values in
the @code{MultiPolygon}.

@end itemize

@subheading @code{MultiPolygon} Properties

@itemize @bullet

@item
A @code{MultiPolygon} is a two-dimensional geometry.

@item
A @code{MultiPolygon} boundary is a set of closed curves
(@code{LineString} values) corresponding to the boundaries of its
@code{Polygon} elements.

@item
Each @code{Curve} in the boundary of the @code{MultiPolygon} is in the
boundary of exactly one @code{Polygon} element.

@item
Every @code{Curve} in the boundary of an @code{Polygon} element is
in the boundary of the @code{MultiPolygon}.

@end itemize


@node Supported spatial data formats, Creating a spatially enabled MySQL database, OpenGIS geometry model, Spatial extensions in MySQL
@section Supported Spatial Data Formats

This section describes the standard spatial data formats that are used
to represent geometry objects in queries.
They are:

@itemize @bullet

@item Well-Known Text (WKT) format

@item Well-Known Binary (WKB) format

@end itemize

Internally, MySQL stores geometry values in a format that is not identical
to either WKT or WKB format.


@menu
* GIS WKT format::              Well-Known Text (WKT) Format
* GIS WKB format::              Well-Known Binary (WKB) Format
@end menu


@node GIS WKT format, GIS WKB format, Supported spatial data formats, Supported spatial data formats
@subsection Well-Known Text (WKT) Format

@cindex WKT
@cindex Well-Known Text format

@c help_category WKT@Geographic features
@c description_for_help_topic WKT definition
The Well-Known Text (WKT) representation of Geometry is designed to
exchange geometry data in ASCII form.
@c end_description_for_help_topic

@c TODO: should explain the notation better, for example, to note the
@c absence of comma between X and Y coordinates.

Examples of WKT representations of geometry objects are:

@itemize @bullet

@item
A @code{Point}:

@example
POINT(15 20)
@end example

Note that point coordinates are specified with no separating comma.

@item
A @code{LineString} with four points:

@example
LINESTRING(0 0, 10 10, 20 25, 50 60)
@end example

@item
A @code{Polygon} with one exterior ring and one interior ring:

@example
POLYGON((0 0,10 0,10 10,0 10,0 0),(5 5,7 5,7 7,5 7, 5 5))
@end example

@item
A @code{MultiPoint} with three @code{Point} values:

@example
MULTIPOINT(0 0, 20 20, 60 60)
@end example

@item
@c TODO: change this example
A @code{MultiLineString} with two @code{LineString} values:

@example
MULTILINESTRING((10 10, 20 20), (15 15, 30 15))
@end example

@item
@c TODO: change this example
A @code{MultiPolygon} with two @code{Polygon} values:

@example
MULTIPOLYGON(((0 0,10 0,10 10,0 10,0 0)),((5 5,7 5,7 7,5 7, 5 5)))
@end example

@item
@c TODO: change this example
A @code{GeometryCollection} consisting of two @code{Point} values and one
@code{LineString}:

@example
GEOMETRYCOLLECTION(POINT(10 10), POINT(30 30), LINESTRING(15 15, 20 20))
@end example

@end itemize

A Backus-Naur grammar that specifies the formal production rules for writing
WKT values may be found in the OGC specification document referenced near the
beginning of this chapter.

@node GIS WKB format,  , GIS WKT format, Supported spatial data formats
@subsection Well-Known Binary (WKB) Format

@cindex WKB
@cindex Well-Known Binary format

The Well-Known Binary (WKB) representation for geometric values is defined by
the OpenGIS specifications.
It is also defined in the ISO ``SQL/MM Part 3: Spatial'' standard.

WKB is used to exchange geometry data as binary streams represented by
@code{BLOB} values containing geometric WKB information.

WKB uses 1-byte unsigned integers, 4-byte unsigned integers, and 8-byte
double-precision numbers (IEEE 754 format). A byte is 8 bits.

For example, a WKB value that corresponds to @code{POINT(1 1)} consists of
this sequence of 21 bytes (each represented here by two hex digits):

@example
0101000000000000000000F03F000000000000F03F
@end example

The sequence may be broken down into these components:

@example
Byte order : 01
WKB type   : 01000000
X          : 000000000000F03F
Y          : 000000000000F03F
@end example

Component representation is as follows:

@itemize @bullet

@item
The byte order may be either 0 or 1 to indicate little-endian or big-endian
storage. The little-endian and big-endian byte orders are also known as
Network Data Representation (NDR) and External Data Representation (XDR),
respectively.

@item
The WKB type is a code that indicates the geometry type. Values from 1 through
7 indicate
@code{Point},
@code{LineString},
@code{Polygon},
@code{MultiPoint},
@code{MultiLineString},
@code{MultiPolygon},
and
@code{GeometryCollection}.

@item
A @code{Point} value has X and Y coordinates, each represented as a
double-precision value.

@end itemize

WKB values for more complex geometry values are represented by more complex
data structures, as detailed in the OpenGIS specification.

@node Creating a spatially enabled MySQL database, Analysing spatial information, Supported spatial data formats, Spatial extensions in MySQL
@section Creating a Spatially Enabled MySQL Database

@c TODO: It would be useful to have a simple example here of table creation
@c and row insertion, to give the reader a taste of what is to come

@c TODO: This section has examples of use, but it also contains function
@c descriptions that may be better placed in an API section.

This section describes the datatypes you can use for representing
spatial data in MySQL, and the functions available for creating and retrieving
spatial values.

@menu
* MySQL spatial datatypes::     MySQL Spatial Datatypes
* Creating spatial values::     Creating Spatial Values
* Creating spatial columns::    Creating Spatial Columns
* Populating spatial columns::  Populating Spatial Columns
* Fetching spatial data::       Fetching Spatial Data
@end menu


@node MySQL spatial datatypes, Creating spatial values, Creating a spatially enabled MySQL database, Creating a spatially enabled MySQL database
@subsection MySQL Spatial Datatypes

@tindex GEOMETRY
@tindex POINT
@tindex LINESTRING
@tindex POLYGON
@tindex MULTIPOINT
@tindex MULTILINESTRING
@tindex MULTIPOLYGON
@tindex GEOMETRYCOLLECTION

MySQL has datatypes that correspond to OpenGIS classes.
Some of these types hold single geometry values:

@itemize @bullet
@item @code{GEOMETRY}
@item @code{POINT}
@item @code{LINESTRING}
@item @code{POLYGON}
@end itemize

@code{GEOMETRY} can store geometry values of any type.
The other single-value types,
@code{POINT} and @code{LINESTRING} and @code{POLYGON},
restrict their values to a particular geometry type.

The other datatypes hold collections of values:

@itemize @bullet
@item @code{MULTIPOINT}
@item @code{MULTILINESTRING}
@item @code{MULTIPOLYGON}
@item @code{GEOMETRYCOLLECTION}
@end itemize

@code{GEOMETRYCOLLECTION} can store a collection of objects
of any type. The other collection types,
@code{MULTIPOINT} and @code{MULTILINESTRING} and @code{MULTIPOLYGON} and @code{GEOMETRYCOLLECTION},
restrict collection members to those having a particular geometry type.


@node Creating spatial values, Creating spatial columns, MySQL spatial datatypes, Creating a spatially enabled MySQL database
@subsection Creating Spatial Values

This section describes how to create spatial values using Well-Known Text
and Well-Known Binary functions that are defined in the OpenGIS standard,
and using MySQL-specific functions.

@menu
* GIS WKT Functions::           Creating Geometry Values Using WKT Functions
* GIS WKB Functions::           Creating Geometry Values Using WKB Functions
* GIS MySQL-Specific Functions::  Creating Geometry Values Using MySQL-Specific Functions
@end menu


@node GIS WKT Functions, GIS WKB Functions, Creating spatial values, Creating spatial values
@subsubsection Creating Geometry Values Using WKT Functions

MySQL provides a number of functions that take as input parameters a
Well-Known Text representation (and, optionally, a spatial reference
system identifier (SRID)), and return the corresponding geometry.

@code{GeomFromText()} accepts a WKT of any geometry type as its first
argument.  An implementation also provides type-specific construction
functions for construction of geometry values of each geometry type.

@c help_category WKT@Geographic features

@table @code

@findex GeomFromText()
@findex GeometryFromText()
@c description_for_help_topic GeomFromText  GeometryFromText
@item GeomFromText(wkt[,srid])
@itemx GeometryFromText(wkt[,srid])
Constructs a geometry value of any type using its WKT representation and SRID.
@c end_description_for_help_topic

@findex PointFromText()
@c description_for_help_topic PointFromText
@item PointFromText(wkt[,srid])
Constructs a @code{POINT} value using its WKT representation and SRID.
@c end_description_for_help_topic

@findex LineFromText()
@findex LineStringFromText()
@c description_for_help_topic LineFromText  LineStringFromText.
@item LineFromText(wkt[,srid])
@itemx LineStringFromText(wkt[,srid])
Constructs a @code{LINESTRING} value using its WKT representation and SRID.
@c end_description_for_help_topic

@findex PolyFromText()
@findex PolygonFromText()
@c description_for_help_topic PolyFromText  PolygonFromText
@item PolyFromText(wkt[,srid])
@itemx PolygonFromText(wkt[,srid])
Constructs a @code{POLYGON} value using its WKT representation and SRID.
@c end_description_for_help_topic

@findex MPointFromText()
@findex MultiPointFromText()
@c description_for_help_topic MPointFromText  MultiPointFromText
@item MPointFromText(wkt[,srid])
@itemx MultiPointFromText(wkt[,srid])
Constructs a @code{MULTIPOINT} value using its WKT representation and SRID.
@c end_description_for_help_topic

@findex MLineFromText()
@findex MultiLineStringFromText()
@c description_for_help_topic MLineFromText  MultiLineStringFromText
@item MLineFromText(wkt[,srid])
@itemx MultiLineStringFromText(wkt[,srid])
Constructs a @code{MULTILINESTRING} value using its WKT representation and SRID.
@c end_description_for_help_topic

@findex MPolyFromText()
@findex MultiPolygonFromText()
@c description_for_help_topic MPolyFromText  MultiPolygonFromText
@item MPolyFromText(wkt[,srid])
@itemx MultiPolygonFromText(wkt[,srid])
Constructs a @code{MULTIPOLYGON} value using its WKT representation and SRID.
@c end_description_for_help_topic

@findex GeomCollFromText()
@findex GeometryCollectionFromText()
@c description_for_help_topic GeomCollFromText  GEOMETRYCOLLECTIONFROMTEXT
@item GeomCollFromText(wkt[,srid])
@itemx GeometryCollectionFromText(wkt[,srid])
Constructs a @code{GEOMETRYCOLLECTION} value using its WKT representation and SRID.
@c end_description_for_help_topic

@end table

The OpenGIS specification also describes optional functions for constructing
@code{Polygon} or @code{MultiPolygon} values based on the WKT representation
of a collection of rings or closed @code{LineString} values. These values
may intersect.  MySQL does not implement these functions:

@table @code

@findex BdPolyFromText()
@item BdPolyFromText(wkt,srid)
Constructs a @code{Polygon} value from a
@code{MultiLineString} value in WKT format containing
an arbitrary collection of closed @code{LineString} values.

@findex BdMPolyFromText()
@item BdMPolyFromText(wkt,srid)
Constructs a @code{MultiPolygon} value from a
@code{MultiLineString} value in WKT format containing
an arbitrary collection of closed @code{LineString} values.

@end table


@node GIS WKB Functions, GIS MySQL-Specific Functions, GIS WKT Functions, Creating spatial values
@subsubsection Creating Geometry Values Using WKB Functions

MySQL provides a number of functions that take as input parameters a
@code{BLOB} containing a Well-Known Binary representation
(and, optionally, a spatial reference
system identifier (SRID)), and return the corresponding geometry.

@code{GeomFromWKT()} accepts a WKB of any geometry type as its first
argument.  An implementation also provides type-specific construction
functions for construction of geometry values of each geometry type.

@c help_category WKB@Geographic features

@table @code


@findex GeomFromWKB()
@findex GeometryFromWKB()
@c description_for_help_topic GeomFromWKB  GeometryFromWKB
@item GeomFromWKB(wkb[,srid])
@itemx GeometryFromWKB(wkt[,srid])
Constructs a geometry value of any type using its WKB representation and SRID.
@c end_description_for_help_topic

@findex PointFromWKB()
@c description_for_help_topic PointFromWKB
@item PointFromWKB(wkb[,srid])
Constructs a @code{POINT} value using its WKB representation and SRID.
@c end_description_for_help_topic

@findex LineFromWKB()
@findex LineStringFromWKB()
@c description_for_help_topic LineFromWKB  LineStringFromWKB
@item LineFromWKB(wkb[,srid])
@itemx LineStringFromWKB(wkb[,srid])
Constructs a @code{LINESTRING} value using its WKB representation and SRID.
@c end_description_for_help_topic

@findex PolyFromWKB()
@findex PolygonFromWKB()
@c description_for_help_topic PolyFromWKB  PolygonFromWKB
@item PolyFromWKB(wkb[,srid])
@itemx PolygonFromWKB(wkb[,srid])
Constructs a @code{POLYGON} value using its WKB representation and SRID.
@c end_description_for_help_topic

@findex MPointFromWKB()
@findex MultiPointFromWKB()
@c description_for_help_topic MPointFromWKB  MultiPointFromWKB
@item MPointFromWKB(wkb[,srid])
@itemx MultiPointFromWKB(wkb[,srid])
Constructs a @code{MULTIPOINT} value using its WKB representation and SRID.
@c end_description_for_help_topic

@findex MLineFromWKB()
@findex MultiLineStringFromWKB()
@c description_for_help_topic MLineFromWKB  MultiLineStringFromWKB
@item MLineFromWKB(wkb[,srid])
@itemx MultiLineStringFromWKB(wkb[,srid])
Constructs a @code{MULTILINESTRING} value using its WKB representation and SRID.
@c end_description_for_help_topic

@findex MPolyFromWKB()
@findex MultiPolygonFromWKB()
@c description_for_help_topic MPolyFromWKB  MultiPolygonFromWKB
@item MPolyFromWKB(wkb[,srid])
@itemx MultiPolygonFromWKB(wkb[,srid])
Constructs a @code{MULTIPOLYGON} value using its WKB representation and SRID.
@c end_description_for_help_topic

@findex GeomCollFromWKB()
@findex GeometryCollectionFromWKB()
@c description_for_help_topic GeomCollFromWKB  GeometryCollectionFromWKB
@item GeomCollFromWKB(wkb[,srid])
@itemx GeometryCollectionFromWKB(wkt[,srid])
Constructs a @code{GEOMETRYCOLLECTION} value using its WKB representation and SRID.
@c end_description_for_help_topic

@end table

The OpenGIS specification also describes optional functions for constructing
@code{Polygon} or @code{MultiPolygon} values based on the WKB representation
of a collection of rings or closed @code{LineString} values. These values
may intersect.  MySQL does not implement these functions:

@table @code

@findex BdPolyFromWKB()
@item BdPolyFromWKB(wkb,srid)
Constructs a @code{Polygon} value from a
@code{MultiLineString} value in WKB format containing
an arbitrary collection of closed @code{LineString} values.

@findex BdMPolyFromWKB()
@item BdMPolyFromWKB(wkb,srid)
Constructs a @code{MultiPolygon} value from a
@code{MultiLineString} value in WKB format containing
an arbitrary collection of closed @code{LineString} values.

@end table


@node GIS MySQL-Specific Functions,  , GIS WKB Functions, Creating spatial values
@subsubsection Creating Geometry Values Using MySQL-Specific Functions

@strong{Note:} MySQL does not implement the functions listed in this
section.

MySQL provides a set of useful functions for creating geometry WKB
representations. The functions described in this section are MySQL
extensions to the OpenGIS specifications. The results of these
functions are @code{BLOB} values containing WKB representations of geometry
values with no SRID.
The results of these functions can be substituted as the first argument
for any function in the @code{GeomFromWKB()} function family.

@table @code

@c help_category Geometry constructors@Geographic features

@findex Point()
@c description_for_help_topic POINT
@item Point(x,y)
Constructs a WKB @code{Point} using its coordinates.
@c end_description_for_help_topic

@findex MultiPoint()
@c description_for_help_topic MULTIPOINT
@item MultiPoint(pt1,pt2,...)
Constructs a WKB @code{MultiPoint} value using WKB @code{Point} arguments.
If any argument is not a @code{WKBPoint}, the return value is @code{NULL}.
@c end_description_for_help_topic

@findex LineString()
@c description_for_help_topic LINESTRING
@item LineString(pt1,pt2,...)
Constructs a WKB @code{LineString} value from a number of WKB @code{Point}
arguments.  If any argument is not a WKB @code{Point}, the return value
is @code{NULL}.  If the number of @code{Point} arguments is less than two,
the return value is @code{NULL}.
@c end_description_for_help_topic

@findex MultiLineString()
@c description_for_help_topic MULTILINESTRING
@item MultiLineString(ls1,ls2,...)
Constructs a WKB @code{MultiLineString} value using using WBK @code{LineString}
arguments.  If any argument is not a @code{LineString}, the return
value is @code{NULL}.
@c end_description_for_help_topic

@findex Polygon()
@c description_for_help_topic POLYGON
@item Polygon(ls1,ls2,...)
Constructs a WKB @code{Polygon} value from a number of WKB @code{LineString}
arguments. If any argument does not represent the WKB of a @code{LinearRing}
(that is, not a closed and simple @code{LineString}) the return value
is @code{NULL}.
@c end_description_for_help_topic

@findex MultiPolygon()
@c description_for_help_topic MULTIPOLYGON
@item MultiPolygon(poly1,poly2,...)
Constructs a WKB @code{MultiPolygon} value from a set of WKB @code{Polygon}
arguments.
If any argument is not a WKB @code{Polygon}, the rerurn value is @code{NULL}.
@c end_description_for_help_topic

@findex GeometryCollection()
@c description_for_help_topic GEOMETRYCOLLECTION
@item GeometryCollection(g1,g2,...)
Constucts a WKB @code{GeometryCollection}. If any argument is not a
well-formed WKB representation of a geometry, the return value is
@code{NULL}.
@c end_description_for_help_topic

@end table


@node Creating spatial columns, Populating spatial columns, Creating spatial values, Creating a spatially enabled MySQL database
@subsection Creating Spatial Columns

@c help_category Geographic features

@c description_for_help_topic GEOMETRY
MySQL provides a standard way of creating spatial columns for
geometry types, for example, with @code{CREATE TABLE} or @code{ALTER TABLE}.
Currently, spatial columns are supported only for @code{MyISAM} tables.
@c end_description_for_help_topic

@itemize @bullet

@item
Use the @code{CREATE TABLE} statement to create a table with a spatial column:

@c example_for_help_topic GEOMETRY
@example
mysql> CREATE TABLE geom (g GEOMETRY);
Query OK, 0 rows affected (0.02 sec)
@end example

@item
Use the @code{ALTER TABLE} statement to add or drop a spatial column to or
from an existing table:

@example
mysql> ALTER TABLE geom ADD pt POINT;
Query OK, 0 rows affected (0.00 sec)
Records: 0  Duplicates: 0  Warnings: 0
mysql> ALTER TABLE geom DROP pt;
Query OK, 0 rows affected (0.00 sec)
Records: 0  Duplicates: 0  Warnings: 0
@end example

@end itemize


@node Populating spatial columns, Fetching spatial data, Creating spatial columns, Creating a spatially enabled MySQL database
@subsection Populating Spatial Columns

After you have created spatial columns, you can populate them
with spatial data.

Values should be stored in internal geometry format, but you can convert them
to that format from either Well-Known Text (WKT) or Well-Known Binary (WKB)
format. The following examples demonstrate how to insert geometry values into
a table by converting WKT values into internal geometry format.

You can perform the conversion directly in the @code{INSERT} statement:

@example
INSERT INTO geom VALUES (GeomFromText('POINT(1 1)'));

SET @@g = 'POINT(1 1)';
INSERT INTO geom VALUES (GeomFromText(@@g));
@end example

Or you can perform the conversion prior to the @code{INSERT}:

@example
SET @@g = GeomFromText('POINT(1 1)');
INSERT INTO geom VALUES (@@g);
@end example

The following examples insert more complex geometries into the table:

@example
SET @@g = 'LINESTRING(0 0,1 1,2 2)';
INSERT INTO geom VALUES (GeomFromText(@@g));

SET @@g = 'POLYGON((0 0,10 0,10 10,0 10,0 0),(5 5,7 5,7 7,5 7, 5 5))';
INSERT INTO geom VALUES (GeomFromText(@@g));

SET @@g = 'GEOMETRYCOLLECTION(POINT(1 1),LINESTRING(0 0,1 1,2 2,3 3,4 4))';
INSERT INTO geom VALUES (GeomFromText(@@g));
@end example

The preceding examples all use @code{GeomFromText()} to create geometry
values.  You can also use type-specific functions:

@example
SET @@g = 'POINT(1 1)';
INSERT INTO geom VALUES (PointFromText(@@g));

SET @@g = 'LINESTRING(0 0,1 1,2 2)';
INSERT INTO geom VALUES (LineStringFromText(@@g));

SET @@g = 'POLYGON((0 0,10 0,10 10,0 10,0 0),(5 5,7 5,7 7,5 7, 5 5))';
INSERT INTO geom VALUES (PolygonFromText(@@g));

SET @@g = 'GEOMETRYCOLLECTION(POINT(1 1),LINESTRING(0 0,1 1,2 2,3 3,4 4))';
INSERT INTO geom VALUES (GeomCollFromText(@@g));
@end example

Note that if a client application program wants to use WKB representations
of geometry values, it is responsible for sending correctly formed WKB in
queries to the server. However, there are several ways of satisfying this
requirement. For example:

@itemize @bullet

@item Inserting a @code{POINT(1 1)} value with hex literal syntax:
@example
mysql> INSERT INTO geom VALUES
    -> (GeomFromWKB(0x0101000000000000000000F03F000000000000F03F));
@end example

@item An ODBC application can send a WKB representation, binding it to a
placeholder using an argument of @code{BLOB} type:
@example
INSERT INTO geom VALUES (GeomFromWKB(?))
@end example

Other programming interfaces may support a similar placeholder mechanism.

@item In a C program, you can escape a binary value using
@code{mysql_real_escape_string()} and include the result in a query string
that is sent to the server.
@xref{mysql_real_escape_string, , @code{mysql_real_escape_string()}}.

@end itemize


@node Fetching spatial data,  , Populating spatial columns, Creating a spatially enabled MySQL database
@subsection Fetching Spatial Data

Geometry values stored in a table can be fetched in internal
format. You can also convert them into WKT or WKB format.

@menu
* Fetching spatial data in internal format::  Fetching Spatial Data in Internal Format
* Fetching spatial data in WKT format::  Fetching Spatial Data in WKT Format
* Fetching spatial data in WKB format::  Fetching Spatial Data in WKB Format
@end menu


@node Fetching spatial data in internal format, Fetching spatial data in WKT format, Fetching spatial data, Fetching spatial data
@subsubsection Fetching Spatial Data in Internal Format

Fetching geometry values using internal format can be useful in
table-to-table transfers:

@example
CREATE TABLE geom2 (g GEOMETRY) SELECT g FROM geom;
@end example


@node Fetching spatial data in WKT format, Fetching spatial data in WKB format, Fetching spatial data in internal format, Fetching spatial data
@subsubsection Fetching Spatial Data in WKT Format

The @code{AsText()} function converts a geometry from internal format into a WKT string.

@c help_category WKT@Geographic features

@c example_for_help_topic AsText
@example
mysql> SELECT AsText(g) FROM geom;
+-------------------------+
| AsText(p1)              |
+-------------------------+
| POINT(1 1)              |
| LINESTRING(0 0,1 1,2 2) |
+-------------------------+
@end example


@node Fetching spatial data in WKB format,  , Fetching spatial data in WKT format, Fetching spatial data
@subsubsection Fetching Spatial Data in WKB Format

The @code{AsBinary()} function converts a geometry from internal format into a @code{BLOB} containing
the WKB value.

@c help_category WKB@Geographic features
@c example_for_help_topic AsBinary
@example
SELECT AsBinary(g) FROM geom;
@end example


@node Analysing spatial information, Optimising spatial analysis, Creating a spatially enabled MySQL database, Spatial extensions in MySQL
@section Analyzing Spatial Information


@menu
* Functions to convert geometries between formats::  Geometry Format Conversion Functions
* Geometry property functions::  @code{Geometry} Functions
* Functions that create new geometries from existing ones::  Functions That Create New Geometries from Existing Ones
* Functions for testing spatial relations between geometric objects::  Functions for Testing Spatial Relations Between Geometric Objects
* Relations on geometry MBR::   Relations on Geometry Minimal Bounding Rectangles (MBRs)
* Functions that test spatial relationships between geometries::  Functions That Test Spatial Relationships Between Geometries
@end menu


After populating spatial columns with values, you are ready to
query and analyze them.  MySQL provides a set of functions to
perform various operations on spatial data. These functions can be
grouped into four major categories according to the type of operation
they perform:

@itemize @bullet

@item
Functions that convert geometries between various formats

@item
Functions that provide access to qualitative or quantitative properties of a geometry

@item
Functions that describe relations between two geometries

@item
Functions that create new geometries from existing ones

@end itemize

Spatial analysis functions can be used in many contexts, such as:

@itemize @bullet

@item
Any interactive SQL program, like @code{mysql} or @code{MySQLCC}

@item
Application programs written in any language that supports a MySQL client API

@end itemize


@node Functions to convert geometries between formats, Geometry property functions, Analysing spatial information, Analysing spatial information
@subsection Geometry Format Conversion Functions

MySQL supports the following functions for converting geometry values between
internal format and either WKT or WKB format:

@table @code

@findex GeomFromText()
@item GeomFromText(wkt[,srid])
Converts a string value from its WKT representation into internal geometry
format and returns the result.
A number of type-specific functions are also supported, such as
@code{PointFromText()} and @code{LineFromText()}; see
@ref{GIS WKT Functions}.

@findex GeomFromWKB()
@item GeomFromWKB(wkb[,srid])
Converts a binary value from its WKB representation into internal geometry
format and returns the result.
A number of type-specific functions are also supported, such as
@code{PointFromWKB()} and @code{LineFromWKB()}; see
@ref{GIS WKB Functions}.

@findex AsText()
@c help_category WKT@Geographic features
@c description_for_help_topic AsText
@item AsText(g)
Converts a value in internal geometry format to its WKT representation
and returns the string result.
@c end_description_for_help_topic

@example
mysql> SET @@g = 'LineString(1 1,2 2,3 3)';
mysql> SELECT AsText(GeomFromText(@@g));
+--------------------------+
| AsText(GeomFromText(@@G)) |
+--------------------------+
| LINESTRING(1 1,2 2,3 3)  |
+--------------------------+
@end example

@findex AsBinary()
@c help_category WKB@Geographic features
@c description_for_help_topic AsBinary
@item AsBinary(g)
Converts a value in internal geometry format to its WKB representation
and returns the binary result.
@c end_description_for_help_topic

@end table


@node Geometry property functions, Functions that create new geometries from existing ones, Functions to convert geometries between formats, Analysing spatial information
@subsection @code{Geometry} Functions

Each function that belongs to this group takes a geometry value as its
argument and returns some quantitive or qualitive property of the
geometry. Some functions restrict their argument type. Such functions
return @code{NULL} if the argument is of an incorrect geometry
type.  For example, @code{Area()} returns @code{NULL} if the object
type is neither @code{Polygon} nor @code{MultiPolygon}.


@menu
* General geometry property functions::  General Geometry Functions
* Point property functions::    @code{Point} Functions
* Linestring property functions::  @code{LineString} Functions
* Multilinestring property functions::  @code{MultiLineString} Functions
* Polygon property functions::  @code{Polygon} Functions
* Multipolygon property functions::  @code{MultiPolygon} Functions
* Geometrycollection property functions::  @code{GeometryCollection} Functions
@end menu


@node General geometry property functions, Point property functions, Geometry property functions, Geometry property functions
@subsubsection General Geometry Functions

The functions listed in this ssection do not restrict their argument and
accept a geometry value of any type.

@table @code

@c help_category Geometry properties@Geographic features

@findex GeometryType()
@c description_for_help_topic GeometryType
@item GeometryType(g)
Returns as a string the name of the geometry type of which
the geometry instance @code{g} is a member.
The name will correspond to one of the instantiable @code{Geometry} subclasses.
@c end_description_for_help_topic

@c example_for_help_topic GeometryType
@example
mysql> SELECT GeometryType(GeomFromText('POINT(1 1)'));
+------------------------------------------+
| GeometryType(GeomFromText('POINT(1 1)')) |
+------------------------------------------+
| POINT                                    |
+------------------------------------------+
@end example

@findex Dimension()
@c description_for_help_topic Dimension
@item Dimension(g)
Returns the inherent dimension of the geometry value @code{g}. The result
can be @minus{}1, 0, 1, or 2. (The meaning of these values is given in
@ref{GIS class geometry}.)
@c end_description_for_help_topic

@c example_for_help_topic Dimension
@example
mysql> SELECT Dimension(GeomFromText('LineString(1 1,2 2)'));
+------------------------------------------------+
| Dimension(GeomFromText('LineString(1 1,2 2)')) |
+------------------------------------------------+
|                                              1 |
+------------------------------------------------+
@end example

@findex SRID()
@c description_for_help_topic SRID
@item SRID(g)
Returns an integer indicating the Spatial Reference System ID for the geometry
value @code{g}.
@c end_description_for_help_topic

@c example_for_help_topic SRID
@example
mysql> SELECT SRID(GeomFromText('LineString(1 1,2 2)',101));
+-----------------------------------------------+
| SRID(GeomFromText('LineString(1 1,2 2)',101)) |
+-----------------------------------------------+
|                                           101 |
+-----------------------------------------------+
@end example

@findex Envelope()
@c description_for_help_topic Envelope
@item Envelope(g)
Returns the Minimum Bounding Rectangle (MBR) for the geometry value @code{g}.
The result is returned as a polygon value.

@c example_for_help_topic Envelope
@example
mysql> SELECT AsText(Envelope(GeomFromText('LineString(1 1,2 2)')));
+-------------------------------------------------------+
| AsText(Envelope(GeomFromText('LineString(1 1,2 2)'))) |
+-------------------------------------------------------+
| POLYGON((1 1,2 1,2 2,1 2,1 1))                        |
+-------------------------------------------------------+
@end example

The polygon is defined by the corner points of the bounding box:

@example
POLYGON((MINX MINY, MAXX MINY, MAXX MAXY, MINX MAXY, MINX MINY))
@end example
@c end_description_for_help_topic

@end table


The OpenGIS specification also defines the following functions, which MySQL
does not implement:

@table @code

@findex Boundary()
@c description_for_help_topic Boundary
@item Boundary(g)
Returns a geometry that is the closure of the combinatorial boundary of the
geometry value @code{g}.
@c end_description_for_help_topic

@findex IsEmpty()
@c description_for_help_topic IsEmpty
@item IsEmpty(g)
Returns 1 if the geometry value @code{g} is the empty geometry, 0 if it is not
empty, and @minus{}1 if the argument is @code{NULL}.
If the geometry is empty, it represents the empty point set.
@c end_description_for_help_topic

@findex IsSimple()
@c description_for_help_topic IsSimple
@item IsSimple(g)

Currently, this function is a placeholder and should not be used.
If implemented, its behavior will be as described in the next paragraph.

Returns 1 if the geometry value @code{g} has no anomalous geometric points,
such as self intersection or self tangency. @code{IsSimple()} returns 0 if the
argument is not simple, and @minus{}1 if it is @code{NULL}.

The description of each instantiable geometric class given earlier in
the chapter includes the specific conditions that cause an instance of
that class to be classified as not simple.
@c end_description_for_help_topic

@end table

@c help_category Point properties@Geographic features

@node Point property functions, Linestring property functions, General geometry property functions, Geometry property functions
@subsubsection @code{Point} Functions

A @code{Point} consists of X and Y coordinates, which may be obtained
using the following functions:

@table @code

@findex X()
@c description_for_help_topic X
@item X(p)
Returns the X-coordinate value for the point @code{p} as a double-precision
number.
@c end_description_for_help_topic
@c example_for_help_topic X
@example
mysql> SELECT X(GeomFromText('Point(56.7 53.34)'));
+--------------------------------------+
| X(GeomFromText('Point(56.7 53.34)')) |
+--------------------------------------+
|                                 56.7 |
+--------------------------------------+
@end example

@findex Y()
@c description_for_help_topic Y
@item Y(p)
Returns the Y-coordinate value for the point @code{p} as a double-precision
number.
@c end_description_for_help_topic
@c example_for_help_topic Y
@example
mysql> SELECT Y(GeomFromText('Point(56.7 53.34)'));
+--------------------------------------+
| Y(GeomFromText('Point(56.7 53.34)')) |
+--------------------------------------+
|                                53.34 |
+--------------------------------------+
@end example

@end table


@node Linestring property functions, Multilinestring property functions, Point property functions, Geometry property functions
@subsubsection @code{LineString} Functions

A @code{LineString} consists of @code{Point} values. You can extract
particular points of a @code{LineString}, count the number of points that it
contains, or obtain its length.

@c help_category LineString properties@Geographic features

@table @code

@findex EndPoint()
@c description_for_help_topic EndPoint
@item EndPoint(ls)
Returns the @code{Point} that is the end point of the @code{LineString} value
@code{ls}.
@c end_description_for_help_topic

@c example_for_help_topic EndPoint
@example
mysql> SELECT AsText(EndPoint(GeomFromText('LineString(1 1,2 2,3 3)')));
+------------------------------------------------------------+
| AsText(EndPoint(GeomFromText('LineString(1 1,2 2,3 3)')))  |
+------------------------------------------------------------+
| POINT(3 3)                                                 |
+------------------------------------------------------------+
@end example

@findex GLength()
@c description_for_help_topic GLength
@item GLength(ls)
Returns as a double-precision number the length of the @code{LineString}
value @code{ls} in its associated spatial reference.
@c end_description_for_help_topic

@c example_for_help_topic GLength
@example
mysql> SELECT GLength(GeomFromText('LineString(1 1,2 2,3 3)'));
+--------------------------------------------------+
| GLength(GeomFromText('LineString(1 1,2 2,3 3)')) |
+--------------------------------------------------+
|                                  2.8284271247462 |
+--------------------------------------------------+
@end example

@findex IsClosed()
@c description_for_help_topic IsClosed
@item IsClosed(ls)
Returns 1 if the @code{LineString} value @code{ls} is closed
(that is, its @code{StartPoint()} and @code{EndPoint()} values are the same).
Returns 0 if @code{ls} is not closed, and @minus{}1 if it is @code{NULL}.
@c end_description_for_help_topic

@c example_for_help_topic IsClosed
@example
mysql> SELECT IsClosed(GeomFromText('LineString(1 1,2 2,3 3)'));
+---------------------------------------------------+
| IsClosed(GeomFromText('LineString(1 1,2 2,3 3)')) |
+---------------------------------------------------+
|                                                 0 |
+---------------------------------------------------+
@end example

@findex NumPoints()
@c description_for_help_topic NumPoints
@item NumPoints(ls)
Returns the number of points in the @code{LineString} value @code{ls}.
@c end_description_for_help_topic

@c example_for_help_topic NumPoints
@example
mysql> SELECT NumPoints(GeomFromText('LineString(1 1,2 2,3 3)'));
+----------------------------------------------------+
| NumPoints(GeomFromText('LineString(1 1,2 2,3 3)')) |
+----------------------------------------------------+
|                                                  3 |
+----------------------------------------------------+
@end example

@findex PointN()
@c description_for_help_topic PointN
@item PointN(ls,n)
Returns the @code{n}-th point in the @code{Linestring} value @code{ls}.
Point numbers begin at 1.
@c end_description_for_help_topic

@c example_for_help_topic PointN
@example
mysql> SELECT AsText(PointN(GeomFromText('LineString(1 1,2 2,3 3)'),2));
+-----------------------------------------------------------+
| AsText(PointN(GeomFromText('LineString(1 1,2 2,3 3)'),2)) |
+-----------------------------------------------------------+
| POINT(2 2)                                                |
+-----------------------------------------------------------+
@end example

@findex StartPoint()
@c description_for_help_topic StartPoint
@item StartPoint(ls)
Returns the @code{Point} that is the start point of the @code{LineString} value
@code{ls}.
@c end_description_for_help_topic

@c example_for_help_topic StartPoint
@example
mysql> SELECT AsText(StartPoint(GeomFromText('LineString(1 1,2 2,3 3)')));
+-------------------------------------------------------------+
| AsText(StartPoint(GeomFromText('LineString(1 1,2 2,3 3)'))) |
+-------------------------------------------------------------+
| POINT(1 1)                                                  |
+-------------------------------------------------------------+
@end example

@end table


The OpenGIS specification also defines the following function, which MySQL
does not implement:

@table @code

@findex IsRing()
@item IsRing(ls)
Returns 1 if the @code{LineString} value @code{ls} is closed
(that is, its @code{StartPoint()} and @code{EndPoint()} values are the same)
and is simple (does not pass through the same point more than once).
Returns 0 if @code{ls} is not a ring, and @minus{}1 if it is @code{NULL}.

@end table


@node Multilinestring property functions, Polygon property functions, Linestring property functions, Geometry property functions
@subsubsection @code{MultiLineString} Functions

@c TODO: Add introductory descriptive sentence.

@table @code

@findex GLength()
@item GLength(mls)
Returns as a double-precision number
the length of the @code{MultiLineString} value @code{mls}. The length of
@code{mls} is equal to the sum of the lengths of its elements.

@example
mysql> SELECT GLength(GeomFromText('MultiLineString((1 1,2 2,3 3),(4 4,5 5))'));
+-------------------------------------------------------------------+
| GLength(GeomFromText('MultiLineString((1 1,2 2,3 3),(4 4,5 5))')) |
+-------------------------------------------------------------------+
|                                                   4.2426406871193 |
+-------------------------------------------------------------------+
@end example

@findex IsClosed()
@item IsClosed(mls)
Returns 1 if the @code{MultiLineString} value @code{mls} is closed
(that is, the @code{StartPoint()} and @code{EndPoint()} values are the same
for each @code{LineString} in @code{mls}).
Returns 0 if @code{mls} is not closed, and @minus{}1 if it is @code{NULL}.

@example
mysql> SELECT IsClosed(GeomFromText('MultiLineString((1 1,2 2,3 3),(4 4,5 5))'));
+--------------------------------------------------------------------+
| IsClosed(GeomFromText('MultiLineString((1 1,2 2,3 3),(4 4,5 5))')) |
+--------------------------------------------------------------------+
|                                                                  0 |
+--------------------------------------------------------------------+
@end example

@end table


@node Polygon property functions, Multipolygon property functions, Multilinestring property functions, Geometry property functions
@subsubsection @code{Polygon} Functions

@c TODO: Add introductory descriptive sentence.

@c help_category Polygon properties@Geographic features

@table @code

@findex Area()
@c description_for_help_topic Area
@item Area(poly)
Returns as a double-precision number the area of the @code{Polygon} value
@code{poly}, as measured in its spatial reference system.
@c end_description_for_help_topic

@c example_for_help_topic Area
@example
mysql> SELECT Area(GeomFromText('Polygon((0 0,0 3,3 3,3 0,0 0),(1 1,1 2,2 2,2 1,1 1))'));
+----------------------------------------------------------------------------+
| Area(GeomFromText('Polygon((0 0,0 3,3 3,3 0,0 0),(1 1,1 2,2 2,2 1,1 1))')) |
+----------------------------------------------------------------------------+
|                                                                          8 |
+----------------------------------------------------------------------------+
@end example

@findex NumInteriorRings()
@c description_for_help_topic NumInteriorRings
@item NumInteriorRings(poly)
Returns the number of interior rings in the @code{Polygon} value @code{poly}.
@c end_description_for_help_topic
@c example_for_help_topic NumInteriorRings
@example
mysql> SELECT NumInteriorRings(GeomFromText('Polygon((0 0,0 3,3 3,3 0,0 0),(1 1,1 2,2 2,2 1,1 1))'));
+----------------------------------------------------------------------------------------+
| NumInteriorRings(GeomFromText('Polygon((0 0,0 3,3 3,3 0,0 0),(1 1,1 2,2 2,2 1,1 1))')) |
+----------------------------------------------------------------------------------------+
|                                                                                      1 |
+----------------------------------------------------------------------------------------+
@end example

@findex ExteriorRing()
@c description_for_help_topic ExteriorRing
@item ExteriorRing(poly)
Returns the exterior ring of the @code{Polygon} value @code{poly}
as a @code{LineString}.
@c end_description_for_help_topic
@c example_for_help_topic ExteriorRing
@example
mysql> SELECT AsText(ExteriorRing(GeomFromText('Polygon((0 0,0 3,3 3,3 0,0 0),(1 1,1 2,2 2,2 1,1 1))')));
+--------------------------------------------------------------------------------------------+
| AsText(ExteriorRing(GeomFromText('Polygon((0 0,0 3,3 3,3 0,0 0),(1 1,1 2,2 2,2 1,1 1))'))) |
+--------------------------------------------------------------------------------------------+
| LINESTRING(0 0,0 3,3 3,3 0,0 0)                                                            |
+--------------------------------------------------------------------------------------------+
@end example

@findex InteriorRingN()
@c description_for_help_topic InteriorRingN
@item InteriorRingN(poly,n)
Returns the @code{n}-th interior ring for the @code{Polygon} value
@code{poly} as a @code{LineString}.
Ring numbers begin at 1.
@c end_description_for_help_topic
@c example_for_help_topic InteriorRingN
@example
mysql> SELECT AsText(InteriorRingN(GeomFromText('Polygon((0 0,0 3,3 3,3 0,0 0),(1 1,1 2,2 2,2 1,1 1))'),1));
+-----------------------------------------------------------------------------------------------+
| AsText(InteriorRingN(GeomFromText('Polygon((0 0,0 3,3 3,3 0,0 0),(1 1,1 2,2 2,2 1,1 1))'),1)) |
+-----------------------------------------------------------------------------------------------+
| LINESTRING(1 1,1 2,2 2,2 1,1 1)                                                               |
+-----------------------------------------------------------------------------------------------+
@end example

@end table

@node Multipolygon property functions, Geometrycollection property functions, Polygon property functions, Geometry property functions
@subsubsection @code{MultiPolygon} Functions

@c TODO: Add introductory descriptive sentence.

@table @code

@findex Area()
@item Area(mpoly)

Returns as a double-precision number the area of the @code{MultiPolygon}
value @code{mpoly}, as measured in its spatial reference system.

@example
mysql> SELECT Area(GeomFromText('MultiPolygon(((0 0,0 3,3 3,3 0,0 0),(1 1,1 2,2 2,2 1,1 1)))'));
+-----------------------------------------------------------------------------------+
| Area(GeomFromText('MultiPolygon(((0 0,0 3,3 3,3 0,0 0),(1 1,1 2,2 2,2 1,1 1)))')) |
+-----------------------------------------------------------------------------------+
|                                                                                 8 |
+-----------------------------------------------------------------------------------+
@end example

@end table


The OpenGIS specification also defines the following functions, which MySQL
does not implement:

@table @code

@findex Centroid()
@item Centroid(mpoly)
Returns the mathematical centroid for the @code{MultiPolygon} value
@code{mpoly} as a @code{Point}.  The result is not guaranteed to be on
the @code{MultiPolygon}.

@findex PointOnSurface()
@item PointOnSurface(mpoly)
Returns a @code{Point} value that is guaranteed to be on the
@code{MultiPolygon} value @code{mpoly}.

@end table

@c help_category GeometryCollection properties@Geographic features

@node Geometrycollection property functions,  , Multipolygon property functions, Geometry property functions
@subsubsection @code{GeometryCollection} Functions

@c TODO: Add introductory descriptive sentence.

@table @code

@findex NumGeometries()
@c description_for_help_topic NumGeometries
@item NumGeometries(gc)
Returns the number of geometries in the @code{GeometryCollection} value
@code{gc}.
@c end_description_for_help_topic

@c example_for_help_topic NumGeometries
@example
mysql> SELECT NumGeometries(GeomFromText('GeometryCollection(Point(1 1),LineString(2 2, 3 3))'));
+------------------------------------------------------------------------------------+
| NumGeometries(GeomFromText('GeometryCollection(Point(1 1),LineString(2 2, 3 3))')) |
+------------------------------------------------------------------------------------+
|                                                                                  2 |
+------------------------------------------------------------------------------------+
@end example

@findex GeometryN()
@c description_for_help_topic GeometryN
@item GeometryN(gc,n)
Returns the @code{n}-th geometry in the @code{GeometryCollection} value
@code{gc}.  Geometry numbers begin at 1.
@c end_description_for_help_topic

@c example_for_help_topic GeometryN
@example
mysql> SELECT AsText(GeometryN(GeomFromText('GeometryCollection(Point(1 1),LineString(2 2, 3 3))'),1));
+------------------------------------------------------------------------------------------+
| AsText(GeometryN(GeomFromText('GeometryCollection(Point(1 1),LineString(2 2, 3 3))'),1)) |
+------------------------------------------------------------------------------------------+
| POINT(1 1)                                                                               |
+------------------------------------------------------------------------------------------+
@end example

@end table


@node Functions that create new geometries from existing ones, Functions for testing spatial relations between geometric objects, Geometry property functions, Analysing spatial information
@subsection Functions That Create New Geometries from Existing Ones

@c TODO: Add introductory descriptive sentence.


@menu
* Functions that produce new geometries::  Geometry Functions That Produce New Geometries
* Spatial operators::           Spatial Operators
@end menu

@node Functions that produce new geometries, Spatial operators, Functions that create new geometries from existing ones, Functions that create new geometries from existing ones
@subsubsection Geometry Functions That Produce New Geometries

In the section @ref{Geometry property functions},
we've already discussed some functions that can construct new geometries
from the existing ones:

@itemize @bullet
@item @code{Envelope(g)}
@item @code{StartPoint(ls)}
@item @code{EndPoint(ls)}
@item @code{PointN(ls,n)}
@item @code{ExteriorRing(poly)}
@item @code{InteriorRingN(poly,n)}
@item @code{GeometryN(gc,n)}
@end itemize


@node Spatial operators,  , Functions that produce new geometries, Functions that create new geometries from existing ones
@subsubsection Spatial Operators

OpenGIS proposes a number of other functions that can produce
geometries. They are designed to implement Spatial Operators.

These functions are not implemented in MySQL.
They may appear in future releases.

@table @code

@findex Intersection()
@item Intersection(g1,g2)
Returns a geometry that represents the point set intersection of the geometry
values @code{g1} with @code{g2}.

@findex Union()
@item Union(g1,g2)
Returns a geometry that represents the point set union of the geometry values
@code{g1} and @code{g2}.

@findex Difference()
@item Difference(g1,g2)
Returns a geometry that represents the point set difference of the geometry
value @code{g1} with @code{g2}.

@findex SymDifference()
@item SymDifference(g1,g2)
Returns a geometry that represents the point set symmetric difference of the
geometry value @code{g1} with @code{g2}.

@findex Buffer()
@item Buffer(g,d)
Returns a geometry that represents all points whose distance from the geometry
value @code{g} is less than or equal to a distance of @code{d}.

@findex ConvexHull()
@item ConvexHull(g)
Returns a geometry that represents the convex hull of the geometry value
@code{g}.

@end table


@node Functions for testing spatial relations between geometric objects, Relations on geometry MBR, Functions that create new geometries from existing ones, Analysing spatial information
@subsection Functions for Testing Spatial Relations Between Geometric Objects

The functions described in these sections take two geometries as input
parameters and return a qualitive or quantitive relation between them.

@node Relations on geometry MBR, Functions that test spatial relationships between geometries, Functions for testing spatial relations between geometric objects, Analysing spatial information
@subsection Relations on Geometry Minimal Bounding Rectangles (MBRs)

@cindex MBR
@cindex Minimum Bounding Rectangle

@c help_category MBR@Geographic features

MySQL provides some functions that can test relations
between mininal bounding rectangles of two geometries @code{g1} and @code{g2}.
They include:

@table @code

@findex MBRContains()
@c description_for_help_topic MBRContains
@item MBRContains(g1,g2)
Returns 1 or 0 to indicate whether or not the Minimum Bounding Rectangle of
@code{g1} contains the Minimum Bounding Rectangle of @code{g2}.
@c end_description_for_help_topic

@c example_for_help_topic MBRContains
@example
mysql> SET @@g1 = GeomFromText('Polygon((0 0,0 3,3 3,3 0,0 0))');
mysql> SET @@g2 = GeomFromText('Point(1 1)');
mysql> SELECT MBRContains(@@g1,@@g2), MBRContains(@@g2,@@g1);
----------------------+----------------------+
| MBRContains(@@g1,@@g2) | MBRContains(@@g2,@@g1) |
+----------------------+----------------------+
|                    1 |                    0 |
+----------------------+----------------------+
@end example

@findex MBRWithin()
@c description_for_help_topic MBRWithin
@item MBRWithin(g1,g2)
Returns 1 or 0 to indicate whether or not the Minimum Bounding Rectangle
of @code{g1} is within the Minimum Bounding Rectangle of @code{g2}.
@c end_description_for_help_topic

@c example_for_help_topic MBRWithin
@example
mysql> SET @@g1 = GeomFromText('Polygon((0 0,0 3,3 3,3 0,0 0))');
mysql> SET @@g2 = GeomFromText('Polygon((0 0,0 5,5 5,5 0,0 0))');
mysql> SELECT MBRWithin(@@g1,@@g2), MBRWithin(@@g2,@@g1);
+--------------------+--------------------+
| MBRWithin(@@g1,@@g2) | MBRWithin(@@g2,@@g1) |
+--------------------+--------------------+
|                  1 |                  0 |
+--------------------+--------------------+
@end example

@findex MBRDisjoint()
@c description_for_help_topic MBRDisjoint
@item MBRDisjoint(g1,g2)
Returns 1 or 0 to indicate whether or not the Minimum Bounding Rectangles of
the two geometries @code{g1} and @code{g2} are disjoint (do not intersect).
@c end_description_for_help_topic

@findex MBREquals()
@c description_for_help_topic MBREquals
@item MBREquals(g1,g2)
Returns 1 or 0 to indicate whether or not the Minimum Bounding Rectangles of
the two geometries @code{g1} and @code{g2} are the same.
@c end_description_for_help_topic

@findex MBRIntersects()
@c description_for_help_topic MBRIntersects
@item MBRIntersects(g1,g2)
Returns 1 or 0 to indicate whether or not the Minimum Bounding Rectangles of
the two geometries @code{g1} and @code{g2} intersect.
@c end_description_for_help_topic

@findex MBROverlaps()
@c description_for_help_topic MBROverlaps
@item MBROverlaps(g1,g2)
Returns 1 or 0 to indicate whether or not the Minimum Bounding Rectangles of
the two geometries @code{g1} and @code{g2} overlap.
@c end_description_for_help_topic

@findex MBRTouches()
@c description_for_help_topic MBRTouches
@item MBRTouches(g1,g2)
Returns 1 or 0 to indicate whether or not the Minimum Bounding Rectangles of
the two geometries @code{g1} and @code{g2} touch.
@c end_description_for_help_topic

@end table


@node Functions that test spatial relationships between geometries,  , Relations on geometry MBR, Analysing spatial information
@subsection Functions That Test Spatial Relationships Between Geometries

The OpenGIS specification defines the following functions, which MySQL
does not implement. They may appear in future releases.
If implemented, they will provide full support for
spatial analysis, not just MBR-based support.

The functions operate on two geometry values @code{g1} and @code{g2}.

@table @code

@c help_category Geometry relations@Geographic features

@findex Contains()
@c description_for_help_topic Contains
@item Contains(g1,g2)
Returns 1 or 0 to indicate whether or not @code{g1} completely contains
@code{g2}.
@c end_description_for_help_topic

@findex Crosses()
@c description_for_help_topic Crosses
@item Crosses(g1,g2)
Returns 1 if @code{g1} spatially crosses @code{g2}.
Returns @code{NULL} if @code{g1} is a @code{Polygon} or a @code{MultiPolygon},
or if @code{g2} is a @code{Point} or a @code{MultiPoint}.
Otherwise, returns 0.

The term @strong{spatially crosses} denotes a spatial relation between two given
geometries that has the following properties:

@itemize @bullet

@item
The two geometries intersect

@item
Their intersection results in a geometry that has
a dimension that is one less than the maximum dimension of the two given
geometries

@item
Their intersection is not equal to either of the two given geometries

@end itemize
@c end_description_for_help_topic

@findex Disjoint()
@c description_for_help_topic Disjoint
@item Disjoint(g1,g2)
Returns 1 or 0 to indicate whether or not @code{g1} is spatially disjoint
from (does not intersect) @code{g2}.
@c end_description_for_help_topic

@findex Equals()
@c description_for_help_topic Equals
@item Equals(g1,g2)
Returns 1 or 0 to indicate whether or not @code{g1} is spatially equal to
@code{g2}.
@c end_description_for_help_topic

@findex Intersects()
@c description_for_help_topic Intersects
@item Intersects(g1,g2)
Returns 1 or 0 to indicate whether or not @code{g1} spatially intersects
@code{g2}.
@c end_description_for_help_topic

@findex Overlaps()
@c description_for_help_topic Overlaps
@item Overlaps(g1,g2)
Returns 1 or 0 to indicate whether or not @code{g1} spatially overlaps
@code{g2}.
The term @code{spatially overlaps} is used if two
geometries intersect and their intersection results in a geometry of the
same dimension but not equal to either of the given geometries.
@c end_description_for_help_topic

@findex Touches()
@c description_for_help_topic Touches
@item Touches(g1,g2)
Returns 1 or 0 to indicate whether or not @code{g1} spatially touches
@code{g2}. Two geometries @strong{spatially touch} if the interiors of
the geometries do not intersect, but the boundary of one of the geometries
intersects either the boundary or the interior of the other.
@c end_description_for_help_topic

@findex Within()
@c description_for_help_topic Within
@item Within(g1,g2)
Returns 1 or 0 to indicate whether or not @code{g1} is spatially within
@code{g2}.
@c end_description_for_help_topic

@findex Distance()
@item Distance(g1,g2)
Returns as a double-precision number
the shortest distance between any two points in the two geometries.

@findex Related()
@item Related(g1,g2,pattern_matrix)
Returns 1 or 0 to indicate whether or not the spatial relationship specified
by @code{pattern_matrix} exists between @code{g1} and @code{g2}.
Returns @minus{}1 if the arguments are @code{NULL}.
The pattern matrix is a string. Its specification will be noted here if this
function is implemented.

@end table


@node Optimising spatial analysis, MySQL GIS conformance and compatibility, Analysing spatial information, Spatial extensions in MySQL
@section Optimizing Spatial Analysis

Search operations in non-spatial databases can be optimized
using indexes. This is true for spatial databases as well.
With the help of a great variety of multi-dimensional indexing methods that
have already been designed, it's possible to optimize
spatial searches. The most typical of these are:

@itemize @bullet

@item Point queries that search for all objects that contain a given point

@item Region queries that search for all objects that overlap a given region

@end itemize

MySQL uses @strong{R-Trees with quadratic splitting} to index
spatial columns. A spatial index is built using the MBR of a geometry.
For most geometries, the MBR is a minimum rectangle that
surrounds the geometries. For a horizontal or a vertical
linestring, the MBR is a rectangle degenerated into the linestring.
For a point, the MBR is a rectangle degenerated into the point.


@menu
* Creating spatial indexes::    Creating Spatial Indexes
* Using a spatial index::       Using a Spatial Index
@end menu

@node Creating spatial indexes, Using a spatial index, Optimising spatial analysis, Optimising spatial analysis
@subsection Creating Spatial Indexes

@c help_category Geographic features
@c description_for_help_topic SPATIAL  INDEX TABLE ALTER CREATE ADD KEY
MySQL can create spatial indexes using syntax similar to that for creating
regular indexes, but extended with the @code{SPATIAL} keyword.
Spatial columns that are indexed currently must be declared @code{NOT NULL}.
The following examples demonstrate how to create spatial indexes.

@itemize @bullet

@item With @code{CREATE TABLE}:

@example
mysql> CREATE TABLE geom (g GEOMETRY NOT NULL, SPATIAL INDEX(g));
@end example

@item With @code{ALTER TABLE}:

@example
mysql> ALTER TABLE geom ADD SPATIAL INDEX(g);
@end example

@item With @code{CREATE INDEX}:

@example
mysql> CREATE SPATIAL INDEX sp_index ON geom (g);
@end example

@end itemize

To drop spatial indexes, use @code{ALTER TABLE} or @code{DROP INDEX}:

@itemize @bullet

@item With @code{ALTER TABLE}:

@example
mysql> ALTER TABLE geom DROP INDEX g;
@end example

@item With @code{DROP INDEX}:

@example
mysql> DROP INDEX sp_index ON geom;
@end example

@end itemize

Example: Suppose that a table @code{geom} contains more than 32000 geometries,
which are stored in the column @code{g} of type @code{GEOMETRY}.
The table also has an @code{AUTO_INCREMENT} column @code{fid} for storing
object ID values.
@c end_description_for_help_topic

@example
mysql> SHOW FIELDS FROM geom;
+-------+----------+------+-----+---------+----------------+
| Field | Type     | Null | Key | Default | Extra          |
+-------+----------+------+-----+---------+----------------+
| fid   | int(11)  |      | PRI | NULL    | auto_increment |
| g     | geometry |      |     |         |                |
+-------+----------+------+-----+---------+----------------+
2 rows in set (0.00 sec)

mysql> SELECT COUNT(*) FROM geom;
+----------+
| count(*) |
+----------+
|    32376 |
+----------+
1 row in set (0.00 sec)
@end example


To add a spatial index on the column @code{g}, use this statement:
@example
mysql> ALTER TABLE geom ADD SPATIAL INDEX(g);
Query OK, 32376 rows affected (4.05 sec)
Records: 32376  Duplicates: 0  Warnings: 0
@end example


@node Using a spatial index,  , Creating spatial indexes, Optimising spatial analysis
@subsection Using a Spatial Index

The optimizer investigates whether available spatial indexes can
be involved in the search for queries that use a function such as
@code{MBRContains()} or @code{MBRWithin()} in the @code{WHERE} clause.
For example, let's say we want to find all objects that are in the
given rectangle:

@example
mysql> SELECT fid,AsText(g) FROM geom WHERE
mysql> MBRContains(GeomFromText('Polygon((30000 15000,31000 15000,31000 16000,30000 16000,30000 15000))'),g);
+-----+-----------------------------------------------------------------------------+
| fid | AsText(g)                                                                   |
+-----+-----------------------------------------------------------------------------+
|  21 | LINESTRING(30350.4 15828.8,30350.6 15845,30333.8 15845,30333.8 15828.8)     |
|  22 | LINESTRING(30350.6 15871.4,30350.6 15887.8,30334 15887.8,30334 15871.4)     |
|  23 | LINESTRING(30350.6 15914.2,30350.6 15930.4,30334 15930.4,30334 15914.2)     |
|  24 | LINESTRING(30290.2 15823,30290.2 15839.4,30273.4 15839.4,30273.4 15823)     |
|  25 | LINESTRING(30291.4 15866.2,30291.6 15882.4,30274.8 15882.4,30274.8 15866.2) |
|  26 | LINESTRING(30291.6 15918.2,30291.6 15934.4,30275 15934.4,30275 15918.2)     |
| 249 | LINESTRING(30337.8 15938.6,30337.8 15946.8,30320.4 15946.8,30320.4 15938.4) |
|   1 | LINESTRING(30250.4 15129.2,30248.8 15138.4,30238.2 15136.4,30240 15127.2)   |
|   2 | LINESTRING(30220.2 15122.8,30217.2 15137.8,30207.6 15136,30210.4 15121)     |
|   3 | LINESTRING(30179 15114.4,30176.6 15129.4,30167 15128,30169 15113)           |
|   4 | LINESTRING(30155.2 15121.4,30140.4 15118.6,30142 15109,30157 15111.6)       |
|   5 | LINESTRING(30192.4 15085,30177.6 15082.2,30179.2 15072.4,30194.2 15075.2)   |
|   6 | LINESTRING(30244 15087,30229 15086.2,30229.4 15076.4,30244.6 15077)         |
|   7 | LINESTRING(30200.6 15059.4,30185.6 15058.6,30186 15048.8,30201.2 15049.4)   |
|  10 | LINESTRING(30179.6 15017.8,30181 15002.8,30190.8 15003.6,30189.6 15019)     |
|  11 | LINESTRING(30154.2 15000.4,30168.6 15004.8,30166 15014.2,30151.2 15009.8)   |
|  13 | LINESTRING(30105 15065.8,30108.4 15050.8,30118 15053,30114.6 15067.8)       |
| 154 | LINESTRING(30276.2 15143.8,30261.4 15141,30263 15131.4,30278 15134)         |
| 155 | LINESTRING(30269.8 15084,30269.4 15093.4,30258.6 15093,30259 15083.4)       |
| 157 | LINESTRING(30128.2 15011,30113.2 15010.2,30113.6 15000.4,30128.8 15001)     |
+-----+-----------------------------------------------------------------------------+
20 rows in set (0.00 sec)
@end example


Now let's check the way this query is executed, using @code{EXPLAIN}:
@example
mysql> EXPLAIN SELECT fid,AsText(g) FROM geom WHERE
mysql> MBRContains(GeomFromText('Polygon((30000 15000,31000 15000,31000 16000,30000 16000,30000 15000))'),g);
+----+-------------+-------+-------+---------------+------+---------+------+------+-------------+
| id | select_type | table | type  | possible_keys | key  | key_len | ref  | rows | Extra       |
+----+-------------+-------+-------+---------------+------+---------+------+------+-------------+
|  1 | SIMPLE      | geom  | range | g             | g    |      32 | NULL |   50 | Using where |
+----+-------------+-------+-------+---------------+------+---------+------+------+-------------+
1 row in set (0.00 sec)
@end example


Now let's check what would happen if we didn't have a spatial index:
@example
mysql> EXPLAIN SELECT fid,AsText(g) FROM g IGNORE INDEX (g) WHERE
mysql> MBRContains(GeomFromText('Polygon((30000 15000,31000 15000,31000 16000,30000 16000,30000 15000))'),g);
+----+-------------+-------+------+---------------+------+---------+------+-------+-------------+
| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows  | Extra       |
+----+-------------+-------+------+---------------+------+---------+------+-------+-------------+
|  1 | SIMPLE      | geom  | ALL  | NULL          | NULL |    NULL | NULL | 32376 | Using where |
+----+-------------+-------+------+---------------+------+---------+------+-------+-------------+
1 row in set (0.00 sec)
@end example


Let's execute the above query, ignoring the spatial key we have:

@example
mysql> SELECT fid,AsText(g) FROM geom IGNORE INDEX (g) WHERE
mysql> MBRContains(GeomFromText('Polygon((30000 15000,31000 15000,31000 16000,30000 16000,30000 15000))'),g);
+-----+-----------------------------------------------------------------------------+
| fid | AsText(g)                                                                   |
+-----+-----------------------------------------------------------------------------+
|   1 | LINESTRING(30250.4 15129.2,30248.8 15138.4,30238.2 15136.4,30240 15127.2)   |
|   2 | LINESTRING(30220.2 15122.8,30217.2 15137.8,30207.6 15136,30210.4 15121)     |
|   3 | LINESTRING(30179 15114.4,30176.6 15129.4,30167 15128,30169 15113)           |
|   4 | LINESTRING(30155.2 15121.4,30140.4 15118.6,30142 15109,30157 15111.6)       |
|   5 | LINESTRING(30192.4 15085,30177.6 15082.2,30179.2 15072.4,30194.2 15075.2)   |
|   6 | LINESTRING(30244 15087,30229 15086.2,30229.4 15076.4,30244.6 15077)         |
|   7 | LINESTRING(30200.6 15059.4,30185.6 15058.6,30186 15048.8,30201.2 15049.4)   |
|  10 | LINESTRING(30179.6 15017.8,30181 15002.8,30190.8 15003.6,30189.6 15019)     |
|  11 | LINESTRING(30154.2 15000.4,30168.6 15004.8,30166 15014.2,30151.2 15009.8)   |
|  13 | LINESTRING(30105 15065.8,30108.4 15050.8,30118 15053,30114.6 15067.8)       |
|  21 | LINESTRING(30350.4 15828.8,30350.6 15845,30333.8 15845,30333.8 15828.8)     |
|  22 | LINESTRING(30350.6 15871.4,30350.6 15887.8,30334 15887.8,30334 15871.4)     |
|  23 | LINESTRING(30350.6 15914.2,30350.6 15930.4,30334 15930.4,30334 15914.2)     |
|  24 | LINESTRING(30290.2 15823,30290.2 15839.4,30273.4 15839.4,30273.4 15823)     |
|  25 | LINESTRING(30291.4 15866.2,30291.6 15882.4,30274.8 15882.4,30274.8 15866.2) |
|  26 | LINESTRING(30291.6 15918.2,30291.6 15934.4,30275 15934.4,30275 15918.2)     |
| 154 | LINESTRING(30276.2 15143.8,30261.4 15141,30263 15131.4,30278 15134)         |
| 155 | LINESTRING(30269.8 15084,30269.4 15093.4,30258.6 15093,30259 15083.4)       |
| 157 | LINESTRING(30128.2 15011,30113.2 15010.2,30113.6 15000.4,30128.8 15001)     |
| 249 | LINESTRING(30337.8 15938.6,30337.8 15946.8,30320.4 15946.8,30320.4 15938.4) |
+-----+-----------------------------------------------------------------------------+
20 rows in set (0.46 sec)
@end example

When the index is not used, the execution time for this query rises from
0.00 seconds to 0.46 seconds.

In future releases, spatial indexes may also be used for optimizing
other functions.
@xref{Functions for testing spatial relations between geometric objects}.


@node MySQL GIS conformance and compatibility,  , Optimising spatial analysis, Spatial extensions in MySQL
@section MySQL Conformance and Compatibility

@c TODO: Add introductory descriptive sentence.

@menu
* GIS features that are not yet implemented::  GIS Features That Are Not Yet Implemented
@end menu

@node GIS features that are not yet implemented,  , MySQL GIS conformance and compatibility, MySQL GIS conformance and compatibility
@subsection GIS Features That Are Not Yet Implemented

@table @asis

@item Additional Metadata Views
OpenGIS specifications propose several additional metadata views.
For example, a system view named @code{GEOMETRY_COLUMNS} contains a
description of geometry columns, one row for each geometry column
in the database.

@c @item Functions to add/drop spatial columns
@c OpenGIS assumes that columns can be added or dropped using special
@c @code{AddGeometryColumn()} and @code{DropGeometryColumn()}
@c functions. In MySQL, this is done using the @code{ALTER TABLE},
@c @code{CREATE INDEX}, and @code{DROP INDEX} statements instead.

@c @item Factors related to Spatial Reference Systems and their IDs (SRIDs):

@c @itemize @bullet

@c @item
@c Functions like @code{Length()} and @code{Area()} assume a planar
@c coordinate system.

@c @item
@c All objects currently are considered to be in the same planar
@c coordinate system.

@c @end itemize

@item The OpenGIS function @code{Length()} on @code{LineString} and @code{MultiLineString} currently should be called in MySQL as @code{GLength()}
The problem is that there is an existing SQL function
@code{Length()} which calculates the length of string values,
and sometimes it's not possible to distinguish whether the function is
called in a textual or spatial context. We need either to solve this
somehow, or decide on another function name.
@end table


@c @node GIS writing a GIS application
@c @section Writing a GIS Application


@c @node GIS Java GIS Object Model
@c @section Java GIS Object Model
@c for Mark!


@node Stored Procedures, Clients, Spatial extensions in MySQL, Top
@chapter Stored Procedures and Functions

@cindex stored procedures
@cindex procedures, stored

Stored procedures and functions are a new feature in MySQL version 5.0.
A stored procedure is a set of SQL commands that can be stored in the server.
Once this has been done, clients don't need to keep re-issuing the individual
commands but can refer to the stored procedure instead.

Stored procedures can provide improved performance as less information needs
to be sent between the server and the client. The trade-off is that this
does increase the load on the database server system, as more of
the work is done on the server side and less on the client (application)
side. And often, there are multiple client machines (such as web servers)
but only one or a few database servers.

Stored procedures also allow you to have libraries of functions in the
database server. However, modern application languages
already allow such design internally with for instance classes, and using
these client application language features is beneficial for the programmer
even outside the scope of database use.

Situations where using stored procedures makes sense:
@itemize @bullet
@item
When multiple client applications are written in different languages or work
on different platforms, but need to perform the same database operations.
@item
When security is paramount. Banks, for instance, use stored procedures for
all common operations. This provides a consistent and secure environment,
and procedures can ensure that each operation is properly logged.
In such a setup, applications and users would not get any access to the
database tables directly, but may only execute specific stored procedures.
@end itemize

MySQL follows the SQL:2003 syntax for stored procedures, which is also used
by IBM's DB2. Compatibility support for other stored procedure languages
(PL/SQL, T-SQL) may be added later.

The MySQL implementation of stored procedures is still in progress. All
syntax described in this chapter is supported and any limitations and
extensions are documented where appropriate.

Stored procedures require the @code{proc} table in the @code{mysql} database.
This table is created during the MySQL 5.0 installation procedure.
If you are upgrading to MySQL 5.0 from an earlier version, be sure to update
your grant tables to make sure the @code{proc} table exists.
@xref{Upgrading-grant-tables}.


@menu
* Stored Procedure Syntax::     Stored Procedure Syntax
@end menu

@node Stored Procedure Syntax,  , Stored Procedures, Stored Procedures
@section Stored Procedure Syntax

Stored procedures and functions are routines that are created with
@code{CREATE PROCEDURE} and @code{CREATE FUNCTION} statements.
A procedure is invoked using a @code{CALL} statement, and can only
pass back values using output variables.  Functions may return a
scalar value and can be called from inside a statement just like any other
function (that is, by invoking the function's name).
Stored routines may call other stored routines. A routine is either a
procedure or a function.

At present, MySQL only preserves context for the default database. That is,
if you say @code{USE dbname} within a procedure, the original default
database is restored upon routine exit.
A routine inherits the default database from the caller, so generally routines
should either issue a @code{USE dbname} statement, or specify all tables
with an explicit database reference, e.g. @code{dbname.tablename}.

MySQL supports the very useful extension that allows the use of regular
@code{SELECT} statements (that is, without using cursors or local variables)
inside a stored procedure. The result set of such a query is simply sent
directly to the client.
Multiple @code{SELECT} statements generate multiple result sets, so the client
must use a MySQL client library that supports multiple result sets. This means
the client must use a client library from a version of MySQL at least as
recent as 4.1.

This following section describes the syntax used to create, alter, drop, and
query stored procedures and functions.

@menu
* Maintaining Stored Procedures::  Maintaining Stored Procedures
* SHOW PROCEDURE STATUS::       @code{SHOW PROCEDURE STATUS} and @code{SHOW FUNCTION STATUS}
* CALL::                        @code{CALL}
* BEGIN END::                   @code{BEGIN ... END} Compound Statement
* DECLARE::                     @code{DECLARE} Statement
* Variables in Stored Procedures::  Variables in Stored Procedures
* Conditions and Handlers::     Conditions and Handlers
* Cursors::                     Cursors
* Flow Control Constructs::     Flow Control Constructs
@end menu

@node Maintaining Stored Procedures, SHOW PROCEDURE STATUS, Stored Procedure Syntax, Stored Procedure Syntax
@subsection Maintaining Stored Procedures



@menu
* CREATE PROCEDURE::            @code{CREATE PROCEDURE} and @code{CREATE FUNCTION}
* ALTER PROCEDURE::             @code{ALTER PROCEDURE} and @code{ALTER FUNCTION}
* DROP PROCEDURE::              @code{DROP PROCEDURE} and @code{DROP FUNCTION}
* SHOW CREATE PROCEDURE::       @code{SHOW CREATE PROCEDURE} and @code{SHOW CREATE FUNCTION}
@end menu

@node CREATE PROCEDURE, ALTER PROCEDURE, Maintaining Stored Procedures, Maintaining Stored Procedures
@subsubsection @code{CREATE PROCEDURE} and @code{CREATE FUNCTION}

@findex CREATE PROCEDURE
@findex CREATE FUNCTION

@example
CREATE PROCEDURE sp_name ([parameter[,...]])
[characteristic ...] routine_body

CREATE FUNCTION sp_name ([parameter[,...]])
[RETURNS type]
[characteristic ...] routine_body

parameter:
  [ IN | OUT | INOUT ] param_name type

type:
  Any valid MySQL data type

characteristic:
    LANGUAGE SQL
  | [NOT] DETERMINISTIC
  | SQL SECURITY @{DEFINER | INVOKER@}
  | COMMENT string

routine_body:
  Valid SQL procedure statement(s)
@end example

The @code{RETURNS} clause may be specified for a only @code{FUNCTION}.
It is used to indicate the return type of the function, and the function
body must contain a @code{RETURN value} statement.

The parameter list enclosed within parentheses must always be present.
If there are no parameters, an empty parameter list of @code{()} should
be used.  Each parameter is an @code{IN} parameter by default. To specify
otherwise for a parameter, use the keyword @code{OUT} or @code{INOUT} before
the parameter name. Specifying @code{IN}, @code{OUT}, or @code{INOUT} is only
valid for a @code{PROCEDURE}.

The @code{CREATE FUNCTION} statement is used in
earlier versions of MySQL to support UDFs (User Defined Functions).
@xref{Adding functions}.
UDFs continue to be supported, even with the existence of stored functions.
A UDF can be regarded as an external stored function.  However, do
note that stored functions share their namespace with @code{UDF}s.

A framework for external stored procedures will be introduced in the near
future. This will allow you to write stored procedures in languages other
than SQL.
Most likely, one of the first languages to be supported will be PHP, as the
core PHP engine is small, thread-safe, and can easily be embedded. As the
framework will be public, it is expected that many other languages will also
be supported.

A function is considered ``deterministic'' if it always returns the same
result for the same input parameters, and ``not deterministic'' otherwise.
Currently, the @code{DETERMINISTIC} characteristic is accepted, but not yet
used by the optimizer.

The @code{SQL SECURITY} characteristic can be used to specify whether the
routine should be executed using the permissions of the user who creates
the routine, or the user who invokes it.
The default value is @code{DEFINER}.
This feature is new in SQL:2003.

MySQL does not yet use the @code{GRANT EXECUTE} privilege. So for now, if a
procedure @code{p1()} mentions table @code{t1}, the caller must have
privileges on table @code{t1} in order to call procedure @code{p1()}
successfully.

MySQL stores the @code{sql_mode} settings in effect at the time a routine
is created, and will always execute routines with these settings in force.

The @code{COMMENT} clause is a MySQL extension, and may be used to describe
the stored procedure. This information is displayed by the
@code{SHOW CREATE PROCEDURE} and @code{SHOW CREATE FUNCTION} statements.

MySQL allows routines to contain DDL statements (such as @code{CREATE} and
 @code{DROP}) and SQL transaction statements (such as @code{COMMIT}). This is
not required by the standard and is therefore implementation-specific.

@strong{NOTE:}
Currently, stored @code{FUNCTION}s may not contain references to tables.
Please note that this includes some @code{SET} statements, but excludes some
@code{SELECT} statements.
This limitation will be lifted as soon as possible.

The following is an example of a simple stored procedure that uses
an @code{OUT} parameter.
The example uses the @code{mysql} client @code{delimiter} command to change
the statement delimiter prior to defining the procedure.
This allows the @samp{;} delimiter used in the procedure body to be passed
through to the server rather than being interpreted by @code{mysql} itself.

@example
mysql> delimiter |

mysql> CREATE PROCEDURE simpleproc (OUT param1 INT)
    -> BEGIN
    ->   SELECT COUNT(*) INTO param1 FROM t;
    -> END
    -> |
Query OK, 0 rows affected (0.00 sec)

mysql> CALL simpleproc(@@a)|
Query OK, 0 rows affected (0.00 sec)

mysql> SELECT @@a|
+------+
| @@a   |
+------+
| 3    |
+------+
1 row in set (0.00 sec)
@end example


The following is an example of a function that takes a parameter,
performs an operation using an SQL function, and returns the result:

@example
mysql> delimiter |

mysql> CREATE FUNCTION hello (s CHAR(20)) RETURNS CHAR(50)
    -> RETURN CONCAT('Hello, ',s,'!');
    -> |
Query OK, 0 rows affected (0.00 sec)

mysql> SELECT hello('world')|
+----------------+
| hello('world') |
+----------------+
| Hello, world!  |
+----------------+
1 row in set (0.00 sec)
@end example


@node ALTER PROCEDURE, DROP PROCEDURE, CREATE PROCEDURE, Maintaining Stored Procedures
@subsubsection @code{ALTER PROCEDURE} and @code{ALTER FUNCTION}

@findex ALTER PROCEDURE
@findex ALTER FUNCTION

@example
ALTER @{PROCEDURE | FUNCTION@} sp_name [characteristic ...]

characteristic:
    NAME newname
  | SQL SECURITY @{DEFINER | INVOKER@}
  | COMMENT string
@end example

This command can be used to rename a stored procedure or function, and to
change its characteristics. More than one change may be specified in an
@code{ALTER PROCEDURE} or @code{ALTER FUNCTION} statement.


@node DROP PROCEDURE, SHOW CREATE PROCEDURE, ALTER PROCEDURE, Maintaining Stored Procedures
@subsubsection @code{DROP PROCEDURE} and @code{DROP FUNCTION}

@findex DROP PROCEDURE
@findex DROP FUNCTION

@example
DROP @{PROCEDURE | FUNCTION@} [IF EXISTS] sp_name
@end example

This command is used to delete a stored procedure or function. That is, the
specified routine is removed from the server.

The @code{IF EXISTS} clause is a MySQL extension.
It prevents an error from occurring if the procedure or function does not
exist. A warning is produced that can be viewed with @code{SHOW WARNINGS}.


@node SHOW CREATE PROCEDURE,  , DROP PROCEDURE, Maintaining Stored Procedures
@subsubsection @code{SHOW CREATE PROCEDURE} and @code{SHOW CREATE FUNCTION}

@findex SHOW CREATE PROCEDURE
@findex SHOW CREATE FUNCTION

@example
SHOW CREATE @{PROCEDURE | FUNCTION@} sp_name
@end example

This command is a MySQL extension. Similar to @code{SHOW CREATE TABLE}, it
returns the exact string that can be used to re-create the named routine.


@node SHOW PROCEDURE STATUS, CALL, Maintaining Stored Procedures, Stored Procedure Syntax
@subsection @code{SHOW PROCEDURE STATUS} and @code{SHOW FUNCTION STATUS}

@findex SHOW PROCEDURE STATUS
@findex SHOW FUNCTION STATUS

@example
SHOW @{PROCEDURE | FUNCTION@} STATUS [LIKE pattern]
@end example

This command is a MySQL extension. It returns characteristics of routines,
such as the name, type, creator, creation and modification dates. If no
pattern is specified, the information for all stored procedures or all stored
functions is listed, depending on which statement you use.


@node CALL, BEGIN END, SHOW PROCEDURE STATUS, Stored Procedure Syntax
@subsection @code{CALL}

@findex CALL

@example
CALL sp_name([parameter[,...]])
@end example

The @code{CALL} command is used to invoke a routine that was defined
previously with @code{CREATE PROCEDURE}.


@node BEGIN END, DECLARE, CALL, Stored Procedure Syntax
@subsection @code{BEGIN ... END} Compound Statement

@findex BEGIN
@findex END

@example
[begin_label:] BEGIN
 statement(s)
END [end_label]
@end example

Stored routines may contain multiple statements, using a
@code{BEGIN ... END} compound statement.

@code{begin_label} and @code{end_label} must be the same, if both are
specified.

Please note that the optional @code{[NOT] ATOMIC} clause is not yet
supported. This means that no transactional savepoint is set at the start of
the instruction block and the @code{BEGIN} clause used in this context has
no effect on the current transaction.

Multiple statements requires that a client is able to send query strings
containing @samp{;}. This is handled in the mysql command-line client
with the @code{delimiter} command. Changing the @samp{;} end-of-query delimiter
(for example, to @samp{|}) allows @samp{;} to be used in a routine body.


@node DECLARE, Variables in Stored Procedures, BEGIN END, Stored Procedure Syntax
@subsection @code{DECLARE} Statement

@findex DECLARE

The @code{DECLARE} statement is used to define various items local to a
routine:
local variables (@pxref{Variables in Stored Procedures}),
conditions and handlers (@pxref{Conditions and Handlers}) and
cursors (@pxref{Cursors}).
@code{SIGNAL} and @code{RESIGNAL} statements are not currently supported.

@code{DECLARE} may only be used inside a @code{BEGIN ... END} compound
statement and must be at its start, before any other statements.


@node Variables in Stored Procedures, Conditions and Handlers, DECLARE, Stored Procedure Syntax
@subsection Variables in Stored Procedures

You may declare and use variables within a routine.


@menu
* DECLARE Local Variables::     @code{DECLARE} Local Variables
* SET Statement::               Variable @code{SET} Statement
* SELECT INTO Statement::       @code{SELECT ... INTO} Statement
@end menu

@node DECLARE Local Variables, SET Statement, Variables in Stored Procedures, Variables in Stored Procedures
@subsubsection @code{DECLARE} Local Variables

@example
DECLARE var_name[,...] type [DEFAULT value]
@end example

This command is used to declare local variables. The scope of a variable is
within the @code{BEGIN ... END} block.


@node SET Statement, SELECT INTO Statement, DECLARE Local Variables, Variables in Stored Procedures
@subsubsection Variable @code{SET} Statement

@findex SET

@example
SET variable = expression [,...]
@end example

The @code{SET} statement in stored procedures is an extended version of
the general @code{SET} command. Referenced variables may be ones declared
inside a routine, or global server variables.

The @code{SET} statement in stored procedures is implemented as part of the
pre-existing @code{SET} syntax. This allows an extended syntax of
@code{SET a=x, b=y, ...} where different variable types (locally declared
variables, server variables, and global and session server variables) can be
mixed. This also allows combinations of local variables and some options
that only make sense for global/system variables; in that case the options
are accepted but ignored.


@node SELECT INTO Statement,  , SET Statement, Variables in Stored Procedures
@subsubsection @code{SELECT ... INTO} Statement

@findex SELECT INTO

@example
SELECT column[,...] INTO variable[,...] table_expression
@end example

This @code{SELECT} syntax stores selected columns directly into variables.
Therefore, only a single row may be retrieved. This statement is also
extremely useful when used in combination with cursors.

@example
SELECT id,data INTO x,y FROM test.t1 LIMIT 1;
@end example


@node Conditions and Handlers, Cursors, Variables in Stored Procedures, Stored Procedure Syntax
@subsection Conditions and Handlers

Certain conditions may require specific handling. These conditions can relate
to errors, as well as general flow control inside a routine.


@menu
* DECLARE Conditions::          @code{DECLARE} Conditions
* DECLARE Handlers::            @code{DECLARE} Handlers
@end menu

@node DECLARE Conditions, DECLARE Handlers, Conditions and Handlers, Conditions and Handlers
@subsubsection @code{DECLARE} Conditions

@cindex Conditions

@example
DECLARE condition_name CONDITION FOR condition_value

condition_value:
    SQLSTATE [VALUE] sqlstate_value
  | mysql_error_code
@end example

This statement specifies conditions that will need
specific handling. It associates a name with a specified error
condition. The name can subsequently be used in a
@code{DECLARE HANDLER} statement. @xref{DECLARE Handlers}.

In addition to SQLSTATE values, MySQL error codes are also supported.


@node DECLARE Handlers,  , DECLARE Conditions, Conditions and Handlers
@subsubsection @code{DECLARE} Handlers

@cindex Handlers

@example
DECLARE handler_type HANDLER FOR condition_value[,...] sp_statement

handler_type:
    CONTINUE
  | EXIT
  | UNDO

condition_value:
    SQLSTATE [VALUE] sqlstate_value
  | condition_name
  | SQLWARNING
  | NOT FOUND
  | SQLEXCEPTION
  | mysql_error_code
@end example

This statement specifies handlers that each may deal with
one or more conditions. If one of these conditions occurs, the specified
statement is executed.

For a @code{CONTINUE} handler, execution of the current routine continues
after execution of the handler statement. For an @code{EXIT} handler,
execution of the current routine is terminated. The @code{UNDO}
@code{handler_type} is not yet supported. @code{UNDO} currently behaves like
@code{CONTINUE}.

@itemize @asis
@item @code{SQLWARNING} is shorthand for all SQLSTATE codes that begin with 01.
@item @code{NOT FOUND} is shorthand for all SQLSTATE codes that begin with 02.
@item @code{EXCEPTION} is shorthand for all SQLSTATE codes not caught by
@code{SQLWARNING} or @code{NOT FOUND}.
@end itemize

In addition to SQLSTATE values, MySQL error codes are also supported.


For example:

@example
mysql> CREATE TABLE test.t (s1 int,primary key (s1));
Query OK, 0 rows affected (0.00 sec)

mysql> delimiter |

mysql> CREATE PROCEDURE handlerdemo ()
    -> BEGIN
    ->   DECLARE CONTINUE HANDLER FOR '23000' SET @@x2 = 1;
    ->   set @@x = 1;
    ->   INSERT INTO test.t VALUES (1);
    ->   set @@x = 2;
    ->   INSERT INTO test.t VALUES (1);
    ->   SET @@x = 3;
    -> END;
    -> |
Query OK, 0 rows affected (0.00 sec)

mysql> CALL handlerdemo()|
Query OK, 0 rows affected (0.00 sec)

mysql> SELECT @@x|
    +------+
    | @@x   |
    +------+
    | 3    |
    +------+
    1 row in set (0.00 sec)
@end example

Notice that @code{@@x} is 3, which shows that MySQL executed to the end of
the procedure. If the line
@code{DECLARE CONTINUE HANDLER FOR '23000' SET @@x2 = 1;}
had not been present, MySQL would have taken the default (@code{EXIT}) path
after the second @code{INSERT} failed due to the @code{PRIMARY KEY}
constraint, and @code{SELECT @@x} would have returned 2.


@node Cursors, Flow Control Constructs, Conditions and Handlers, Stored Procedure Syntax
@subsection Cursors

@cindex Cursors

Simple cursors are supported inside stored procedures and functions.
The syntax is as in embedded SQL.
Cursors are currently asensitive, read-only, and non-scrolling.
Asensitive means that the server may or may not make a copy of its result
table.

For example:

@example
CREATE PROCEDURE curdemo()
BEGIN
  DECLARE done INT DEFAULT 0;
  DECLARE CONTINUE HANDLER FOR SQLSTATE '02000' SET done = 1;
  DECLARE cur1 CURSOR FOR SELECT id,data FROM test.t1;
  DECLARE cur2 CURSOR FOR SELECT i FROM test.t2;
  DECLARE a CHAR(16);
  DECLARE b,c INT;

  OPEN cur1;
  OPEN cur2;

  REPEAT
    FETCH cur1 INTO a, b;
    FETCH cur2 INTO c;
    IF NOT done THEN
       IF b < c THEN
          INSERT INTO test.t3 VALUES (a,b);
       ELSE
          INSERT INTO test.t3 VALUES (a,c);
       END IF;
    END IF;
  UNTIL done END REPEAT;

  CLOSE cur1;
  CLOSE cur2;
END
@end example


@menu
* DECLARE Cursors::             Declaring Cursors
* OPEN::                        Cursor @code{OPEN} Statement
* FETCH::                       Cursor @code{FETCH} Statement
* CLOSE::                       Cursor @code{CLOSE} Statement
@end menu

@node DECLARE Cursors, OPEN, Cursors, Cursors
@subsubsection Declaring Cursors

@example
DECLARE cursor_name CURSOR FOR sql_statement
@end example

Multiple cursors may be defined in a routine, but each must have a unique
name.


@node OPEN, FETCH, DECLARE Cursors, Cursors
@subsubsection Cursor @code{OPEN} Statement

@findex OPEN

@example
OPEN cursor_name
@end example

This statement opens a previously declared cursor.


@node FETCH, CLOSE, OPEN, Cursors
@subsubsection Cursor @code{FETCH} Statement

@findex FETCH

@example
FETCH cursor_name
@end example

This statement fetches the next row (if a row exists) using the specified
open cursor, and advances the cursor pointer.


@node CLOSE,  , FETCH, Cursors
@subsubsection Cursor @code{CLOSE} Statement

@findex CLOSE

@example
CLOSE cursor_name
@end example

This statement closes a previously opened cursor.


@node Flow Control Constructs,  , Cursors, Stored Procedure Syntax
@subsection Flow Control Constructs

The @code{IF}, @code{CASE}, @code{LOOP}, @code{WHILE}, @code{ITERATE}, and
@code{LEAVE} constructs are fully implemented.

These constructs may each contain either a single statement, or a block of
statements using the @code{BEGIN ... END} compound statement. Constructs
may be nested.

@code{FOR} loops are not currently supported.


@menu
* IF Statement::                @code{IF} Statement
* CASE Statement::              @code{CASE} Statement
* LOOP Statement::              @code{LOOP} Statement
* LEAVE Statement::             @code{LEAVE} Statement
* ITERATE Statement::           @code{ITERATE} Statement
* REPEAT Statement::            @code{REPEAT} Statement
* WHILE Statement::             @code{WHILE} Statement
@end menu

@node IF Statement, CASE Statement, Flow Control Constructs, Flow Control Constructs
@subsubsection @code{IF} Statement

@findex IF

@example
IF search_condition THEN statement(s)
[ELSEIF search_condition THEN statement(s)]
...
[ELSE statement(s)]
END IF
@end example

@code{IF} implements a basic conditional construct. If the
@code{search_condition} evaluates to true, the corresponding SQL statement is
executed. If no @code{search_condition} matches, the statement in the
@code{ELSE} clause is executed.

Please note that there is also an @code{IF()} function.
@xref{Control flow functions}.


@node CASE Statement, LOOP Statement, IF Statement, Flow Control Constructs
@subsubsection @code{CASE} Statement

@findex CASE

@example
CASE case_value
  WHEN when_value THEN statement
  [WHEN when_value THEN statement ...]
  [ELSE statement]
END CASE
@end example

or

@example
CASE
  WHEN search_condition THEN statement
  [WHEN search_condition THEN statement ...]
  [ELSE statement]
END CASE
@end example

@code{CASE} implements a complex conditional construct. If a
@code{search_condition} evaluates to true, the corresponding SQL statement is executed. If no search condition matches, the statement in the @code{ELSE} clause is executed.

Please note that the syntax of a @code{CASE} statement inside a stored
procedure differs slightly from that of the SQL @code{CASE} expression. The
@code{CASE} statement can not have an @code{ELSE NULL} clause, and the
construct is terminated with @code{END CASE} instead of @code{END}.
@xref{Control flow functions}.


@node LOOP Statement, LEAVE Statement, CASE Statement, Flow Control Constructs
@subsubsection @code{LOOP} Statement

@findex LOOP

@example
[begin_label:] LOOP
  statement(s)
END LOOP [end_label]
@end example

@code{LOOP} implements a simple loop construct, enabling repeated execution
of a particular statement or group of statements. The statements within the
loop are repeated until the loop is exited, usually this is accomplished
with a @code{LEAVE} statement.

@code{begin_label} and @code{end_label} must be the same, if both are
specified.


@node LEAVE Statement, ITERATE Statement, LOOP Statement, Flow Control Constructs
@subsubsection @code{LEAVE} Statement

@findex LEAVE

@example
LEAVE label
@end example

This statement is used to exit any flow control construct.


@node ITERATE Statement, REPEAT Statement, LEAVE Statement, Flow Control Constructs
@subsubsection @code{ITERATE} Statement

@findex ITERATE

@example
ITERATE label
@end example

@code{ITERATE} can only appear within @code{LOOP}, @code{REPEAT}, and
@code{WHILE} statements. @code{ITERATE} means ``do the loop iteration again.''

For example:

@example
CREATE PROCEDURE doiterate(p1 INT)
BEGIN
  label1: LOOP
    SET p1 = p1 + 1;
    IF p1 < 10 THEN ITERATE label1; END IF;
    LEAVE label1;
  END LOOP label1;
  SET @@x = p1;
END
@end example


@node REPEAT Statement, WHILE Statement, ITERATE Statement, Flow Control Constructs
@subsubsection @code{REPEAT} Statement

@findex REPEAT
@findex UNTIL

@example
[begin_label:] REPEAT
  statement(s)
UNTIL search_condition
END REPEAT [end_label]
@end example

The statements within a @code{REPEAT} statement are repeated until the
@code{search_condition} is true.

@code{begin_label} and @code{end_label} must be the same, if both are
specified.

For example:

@example
mysql> delimiter |

mysql> CREATE PROCEDURE dorepeat(p1 INT)
    -> BEGIN
    ->   SET @@x = 0;
    ->   REPEAT SET @@x = @@x + 1; UNTIL @@x > p1 END REPEAT;
    -> END
    -> |
Query OK, 0 rows affected (0.00 sec)

mysql> CALL dorepeat(1000)|
Query OK, 0 rows affected (0.00 sec)

mysql> SELECT @@x|
+------+
| @@x   |
+------+
| 1001 |
+------+
1 row in set (0.00 sec)
@end example


@node WHILE Statement,  , REPEAT Statement, Flow Control Constructs
@subsubsection @code{WHILE} Statement

@findex WHILE

@example
[begin_label:] WHILE search_condition DO
  statement(s)
END WHILE [end_label]
@end example

The statements within a @code{WHILE} statement are repeated as long as the
@code{search_condition} is true.

@code{begin_label} and @code{end_label} must be the same, if both are
specified.

For example:

@example
CREATE PROCEDURE dowhile()
BEGIN
  DECLARE v1 INT DEFAULT 5;

  WHILE v1 > 0 DO
    ...
    SET v1 = v1 - 1;
  END WHILE;
END
@end example


@node Clients, Error-handling, Stored Procedures, Top
@chapter MySQL APIs

@cindex client tools
@cindex APIs
@cindex @code{mysqlclient} library
@cindex buffer sizes, client
@cindex library, @code{mysqlclient}

@menu
* C::                           MySQL C API
* ODBC::                        MySQL ODBC Support
* Java::                        MySQL Java Connectivity (JDBC)
* PHP::                         MySQL PHP API
* Perl::                        MySQL Perl API
* Cplusplus::                   MySQL C++ API
* Python::                      MySQL Python API
* Tcl::                         MySQL Tcl API
* Eiffel::                      MySQL Eiffel Wrapper
@end menu

This chapter describes the APIs available for MySQL, where to get
them, and how to use them.  The C API is the most extensively covered, as it
was developed by the MySQL team, and is the basis for most of the
other APIs.


@node C, ODBC, Clients, Clients
@section MySQL C API

@cindex C API, datatypes
@cindex datatypes, C API

@menu
* C API datatypes::             C API Datatypes
* C API function overview::     C API Function Overview
* C API functions::             C API Function Descriptions
* C API Prepared statements::   C API Prepared Statements
* C API Prepared statement datatypes::  C API Prepared Statement Datatypes
* C API Prepared statement function overview::  C API Prepared Statement Function Overview
* C API Prepared statement functions::  C API Prepared Statement Function Descriptions
* C API multiple queries::      C API Handling of Multiple Query Execution
* C API date handling::         C API Handling of Date and Time Values
* C Thread functions::          C API Threaded Function Descriptions
* C Embedded Server func::      C API Embedded Server Function Descriptions
* C API problems::              Common questions and problems when using the C API
* Building clients::            Building Client Programs
* Threaded clients::            How to Make a Threaded Client
* libmysqld::                   libmysqld, the Embedded MySQL Server Library
@end menu

The C API code is distributed with MySQL. It is included in the
@code{mysqlclient} library and allows C programs to access a database.

Many of the clients in the MySQL source distribution are
written in C.  If you are looking for examples that demonstrate how to
use the C API, take a look at these clients. You can find these in the
@code{clients} directory in the MySQL source distribution.

Most of the other client APIs (all except Connector/J) use the @code{mysqlclient}
library to communicate with the MySQL server. This means that, for
example, you can take advantage of many of the same environment variables
that are used by other client programs, because they are referenced from the
library.  See @ref{Client-Side Scripts}, for a list of these variables.

The client has a maximum communication buffer size. The size of the buffer
that is allocated initially (16K bytes) is automatically increased up to the
maximum size (the maximum is 16M). Because buffer sizes are increased
only as demand warrants, simply increasing the default maximum limit does not
in itself cause more resources to be used. This size check is mostly a check
for erroneous queries and communication packets.

The communication buffer must be large enough to contain a single SQL
statement (for client-to-server traffic) and one row of returned data (for
server-to-client traffic).  Each thread's communication buffer is dynamically
enlarged to handle any query or row up to the maximum limit.  For example, if
you have @code{BLOB} values that contain up to 16M of data, you must have a
communication buffer limit of at least 16M (in both server and client).  The
client's default maximum is 16M, but the default maximum in the server is
1M.  You can increase this by changing the value of the
@code{max_allowed_packet} parameter when the server is started.  @xref{Server
parameters}.

The MySQL server shrinks each communication buffer to
@code{net_buffer_length} bytes after each query.  For clients, the size of
the buffer associated with a connection is not decreased until the connection
is closed, at which time client memory is reclaimed.

For programming with threads, see @ref{Threaded clients}.
For creating a stand-alone application which includes the
"server" and "client" in the same program (and does not
communicate with an external MySQL server), see @ref{libmysqld}.


@node C API datatypes, C API function overview, C, C
@subsection C API Datatypes

@table @code
@tindex MYSQL C type
@item MYSQL
This structure represents a handle to one database connection. It is
used for almost all MySQL functions.

@tindex MYSQL_RES C type
@item MYSQL_RES
This structure represents the result of a query that returns rows
(@code{SELECT}, @code{SHOW}, @code{DESCRIBE}, @code{EXPLAIN}).  The
information returned from a query is called the @emph{result set} in the
remainder of this section.

@tindex MYSQL_ROW C type
@item MYSQL_ROW
This is a type-safe representation of one row of data. It is currently
implemented as an array of counted byte strings.  (You cannot treat these as
null-terminated strings if field values may contain binary data, because such
values may contain null bytes internally.)  Rows are obtained by calling
@code{mysql_fetch_row()}.

@tindex MYSQL_FIELD C type
@item MYSQL_FIELD
This structure contains information about a field, such as the field's
name, type, and size. Its members are described in more detail here.
You may obtain the @code{MYSQL_FIELD} structures for each field by
calling @code{mysql_fetch_field()} repeatedly.  Field values are not part of
this structure; they are contained in a @code{MYSQL_ROW} structure.


@tindex MYSQL_FIELD_OFFSET C type
@item MYSQL_FIELD_OFFSET
This is a type-safe representation of an offset into a MySQL field
list.  (Used by @code{mysql_field_seek()}.)  Offsets are field numbers
within a row, beginning at zero.

@tindex my_ulonglong C type
@tindex my_ulonglong values, printing
@item my_ulonglong
The type used for the number of rows and for @code{mysql_affected_rows()},
@code{mysql_num_rows()}, and @code{mysql_insert_id()}. This type provides a
range of @code{0} to @code{1.84e19}.

On some systems, attempting to print a value of type @code{my_ulonglong}
will not work.  To print such a value, convert it to @code{unsigned long}
and use a @code{%lu} print format.  Example:
@example
printf ("Number of rows: %lu\n", (unsigned long) mysql_num_rows(result));
@end example
@end table

@noindent
The @code{MYSQL_FIELD} structure contains the members listed here:

@table @code
@item char * name
The name of the field, as a null-terminated string.

@item char * table
The name of the table containing this field, if it isn't a calculated field.
For calculated fields, the @code{table} value is an empty string.

@item char * def
The default value of this field, as a null-terminated string.  This is set
only if you use @code{mysql_list_fields()}.

@item enum enum_field_types type
The type of the field.
The @code{type} value may be one of the following:

@multitable @columnfractions .35 .55
@item @strong{Type value}                @tab @strong{Type description}
@item @code{FIELD_TYPE_TINY}            @tab @code{TINYINT} field
@item @code{FIELD_TYPE_SHORT}           @tab @code{SMALLINT} field
@item @code{FIELD_TYPE_LONG}            @tab @code{INTEGER} field
@item @code{FIELD_TYPE_INT24}           @tab @code{MEDIUMINT} field
@item @code{FIELD_TYPE_LONGLONG}        @tab @code{BIGINT} field
@item @code{FIELD_TYPE_DECIMAL}         @tab @code{DECIMAL} or @code{NUMERIC} field
@item @code{FIELD_TYPE_FLOAT}           @tab @code{FLOAT} field
@item @code{FIELD_TYPE_DOUBLE}          @tab @code{DOUBLE} or @code{REAL} field
@item @code{FIELD_TYPE_TIMESTAMP}       @tab @code{TIMESTAMP} field
@item @code{FIELD_TYPE_DATE}            @tab @code{DATE} field
@item @code{FIELD_TYPE_TIME}            @tab @code{TIME} field
@item @code{FIELD_TYPE_DATETIME}        @tab @code{DATETIME} field
@item @code{FIELD_TYPE_YEAR}            @tab @code{YEAR} field
@item @code{FIELD_TYPE_STRING}          @tab @code{CHAR} field
@item @code{FIELD_TYPE_VAR_STRING}      @tab @code{VARCHAR} field
@item @code{FIELD_TYPE_BLOB}            @tab @code{BLOB} or @code{TEXT} field (use @code{max_length} to determine the maximum length)
@item @code{FIELD_TYPE_SET}             @tab @code{SET} field
@item @code{FIELD_TYPE_ENUM}            @tab @code{ENUM} field
@item @code{FIELD_TYPE_NULL}            @tab @code{NULL}-type field
@item @code{FIELD_TYPE_CHAR}            @tab Deprecated; use @code{FIELD_TYPE_TINY} instead
@end multitable

You can use the @code{IS_NUM()} macro to test whether a field has a
numeric type.  Pass the @code{type} value to @code{IS_NUM()} and it
will evaluate to TRUE if the field is numeric:

@example
if (IS_NUM(field->type))
    printf("Field is numeric\n");
@end example

@item unsigned int length
The width of the field, as specified in the table definition.

@item unsigned int max_length
The maximum width of the field for the result set (the length of the longest
field value for the rows actually in the result set). If you use
@code{mysql_store_result()} or @code{mysql_list_fields()}, this contains the
maximum length for the field.  If you use @code{mysql_use_result()}, the
value of this variable is zero.

@item unsigned int flags
Different bit-flags for the field.  The @code{flags} value may have zero
or more of the following bits set:

@multitable @columnfractions .35 .55
@item @strong{Flag value}         @tab @strong{Flag description}
@item @code{NOT_NULL_FLAG}       @tab Field can't be @code{NULL}
@item @code{PRI_KEY_FLAG}        @tab Field is part of a primary key
@item @code{UNIQUE_KEY_FLAG}     @tab Field is part of a unique key
@item @code{MULTIPLE_KEY_FLAG}   @tab Field is part of a non-unique key
@item @code{UNSIGNED_FLAG}       @tab Field has the @code{UNSIGNED} attribute
@item @code{ZEROFILL_FLAG}       @tab Field has the @code{ZEROFILL} attribute
@item @code{BINARY_FLAG}         @tab Field has the @code{BINARY} attribute
@item @code{AUTO_INCREMENT_FLAG} @tab Field has the @code{AUTO_INCREMENT}
attribute
@item @code{ENUM_FLAG}           @tab Field is an @code{ENUM} (deprecated)
@item @code{SET_FLAG}            @tab Field is a @code{SET} (deprecated)
@item @code{BLOB_FLAG}           @tab Field is a @code{BLOB} or @code{TEXT} (deprecated)
@item @code{TIMESTAMP_FLAG}      @tab Field is a @code{TIMESTAMP} (deprecated)
@end multitable

Use of the @code{BLOB_FLAG}, @code{ENUM_FLAG}, @code{SET_FLAG}, and
@code{TIMESTAMP_FLAG} flags is deprecated because they indicate the type of
a field rather than an attribute of its type.  It is preferable to test
@code{field->type} against @code{FIELD_TYPE_BLOB}, @code{FIELD_TYPE_ENUM},
@code{FIELD_TYPE_SET}, or @code{FIELD_TYPE_TIMESTAMP} instead.

@noindent
The following example illustrates a typical use of the @code{flags} value:

@example
if (field->flags & NOT_NULL_FLAG)
    printf("Field can't be null\n");
@end example

You may use the following convenience macros to determine the boolean
status of the @code{flags} value:

@multitable @columnfractions .25 .55
@item @strong{Flag status} @tab @strong{Description}
@item @code{IS_NOT_NULL(flags)} @tab True if this field is defined as @code{NOT NULL}
@item @code{IS_PRI_KEY(flags)}  @tab True if this field is a primary key
@item @code{IS_BLOB(flags)}     @tab True if this field is a @code{BLOB} or @code{TEXT} (deprecated; test @code{field->type} instead)
@end multitable

@item unsigned int decimals
The number of decimals for numeric fields.
@end table


@node C API function overview, C API functions, C API datatypes, C
@subsection C API Function Overview

@cindex C API, functions
@cindex functions, C API

The functions available in the C API are summarized here and described in
greater detail in a later section.
@xref{C API functions}.

@multitable @columnfractions .32 .68
@item @strong{Function} @tab @strong{Description}

@item @strong{mysql_affected_rows()} @tab
Returns the number of rows changed/deleted/inserted by the last @code{UPDATE},
@code{DELETE}, or @code{INSERT} query.

@item @strong{mysql_change_user()} @tab
Changes user and database on an open connection.

@item @strong{mysql_character_set_name()} @tab
Returns the name of the default character set for the connection.

@item @strong{mysql_close()} @tab
Closes a server connection.

@item @strong{mysql_connect()} @tab
Connects to a MySQL server. This function is deprecated; use
@code{mysql_real_connect()} instead.

@item @strong{mysql_create_db()} @tab
Creates a database. This function is deprecated; use the SQL command
@code{CREATE DATABASE} instead.

@item @strong{mysql_data_seek()} @tab
Seeks to an arbitrary row number in a query result set.

@item @strong{mysql_debug()} @tab
Does a @code{DBUG_PUSH} with the given string.

@item @strong{mysql_drop_db()} @tab
Drops a database. This function is deprecated; use the SQL command
@code{DROP DATABASE} instead.

@item @strong{mysql_dump_debug_info()} @tab
Makes the server write debug information to the log.

@item @strong{mysql_eof()} @tab
Determines whether the last row of a result set has been read.
This function is deprecated; @code{mysql_errno()} or @code{mysql_error()}
may be used instead.

@item @strong{mysql_errno()} @tab
Returns the error number for the most recently invoked MySQL function.

@item @strong{mysql_error()} @tab
Returns the error message for the most recently invoked MySQL function.

@item @strong{mysql_escape_string()} @tab
Escapes special characters in a string for use in an SQL statement.

@item @strong{mysql_fetch_field()} @tab
Returns the type of the next table field.

@item @strong{mysql_fetch_field_direct()} @tab
Returns the type of a table field, given a field number.

@item @strong{mysql_fetch_fields()} @tab
Returns an array of all field structures.

@item @strong{mysql_fetch_lengths()} @tab
Returns the lengths of all columns in the current row.

@item @strong{mysql_fetch_row()} @tab
Fetches the next row from the result set.

@item @strong{mysql_field_seek()} @tab
Puts the column cursor on a specified column.

@item @strong{mysql_field_count()} @tab
Returns the number of result columns for the most recent query.

@item @strong{mysql_field_tell()} @tab
Returns the position of the field cursor used for the last
@code{mysql_fetch_field()}.

@item @strong{mysql_free_result()} @tab
Frees memory used by a result set.

@item @strong{mysql_get_client_info()} @tab
Returns client version information as a string.

@item @strong{mysql_get_client_version()} @tab
Returns client version information as an integer.

@item @strong{mysql_get_host_info()} @tab
Returns a string describing the connection.

@item @strong{mysql_get_server_version()} @tab
Returns version number of server as an integer (new in 4.1).

@item @strong{mysql_get_proto_info()} @tab
Returns the protocol version used by the connection.

@item @strong{mysql_get_server_info()} @tab
Returns the server version number.

@item @strong{mysql_info()} @tab
Returns information about the most recently executed query.

@item @strong{mysql_init()} @tab
Gets or initializes a @code{MYSQL} structure.

@item @strong{mysql_insert_id()} @tab
Returns the ID generated for an @code{AUTO_INCREMENT} column by the previous
query.

@item @strong{mysql_kill()} @tab
Kills a given thread.

@item @strong{mysql_list_dbs()} @tab
Returns database names matching a simple regular expression.

@item @strong{mysql_list_fields()} @tab
Returns field names matching a simple regular expression.

@item @strong{mysql_list_processes()} @tab
Returns a list of the current server threads.

@item @strong{mysql_list_tables()} @tab
Returns table names matching a simple regular expression.

@item @strong{mysql_num_fields()} @tab
Returns the number of columns in a result set.

@item @strong{mysql_num_rows()} @tab
Returns the number of rows in a result set.

@item @strong{mysql_options()} @tab
Sets connect options for @code{mysql_connect()}.

@item @strong{mysql_ping()} @tab
Checks whether the connection to the server is working, reconnecting
as necessary.

@item @strong{mysql_query()} @tab
Executes an SQL query specified as a null-terminated string.

@item @strong{mysql_real_connect()} @tab
Connects to a MySQL server.

@item @strong{mysql_real_escape_string()} @tab
Escapes special characters in a string for use in an SQL statement, taking
into account the current charset of the connection.

@item @strong{mysql_real_query()} @tab
Executes an SQL query specified as a counted string.

@item @strong{mysql_reload()} @tab
Tells the server to reload the grant tables.

@item @strong{mysql_row_seek()} @tab
Seeks to a row offset in a result set, using value returned from
@code{mysql_row_tell()}.

@item @strong{mysql_row_tell()} @tab
Returns the row cursor position.

@item @strong{mysql_select_db()} @tab
Selects a database.

@item @strong{mysql_set_server_option()} @tab
Sets an option for the connection (like @code{multi-statements}).

@item @strong{mysql_sqlstate()} @tab
Returns the SQLSTATE error code for the last error.

@item @strong{mysql_shutdown()} @tab
Shuts down the database server.

@item @strong{mysql_stat()} @tab
Returns the server status as a string.

@item @strong{mysql_store_result()} @tab
Retrieves a complete result set to the client.

@item @strong{mysql_thread_id()} @tab
Returns the current thread ID.

@item @strong{mysql_thread_safe()} @tab
Returns 1 if the clients are compiled as thread-safe.

@item @strong{mysql_use_result()} @tab
Initiates a row-by-row result set retrieval.

@item @strong{mysql_warning_count()} @tab
Returns the warning count for the previous SQL statement.

@item @strong{mysql_commit()} @tab
Commits the transaction (new in 4.1).

@item @strong{mysql_rollback()} @tab
Rolls back the transaction (new in 4.1).

@item @strong{mysql_autocommit()} @tab
Toggles autocommit mode on/off (new in 4.1).

@item @strong{mysql_more_results()} @tab
Checks whether any more results exist (new in 4.1).

@item @strong{mysql_next_result()} @tab
Returns/Initiates the next result in multi-query executions (new in 4.1).
@end multitable

To connect to the server, call @code{mysql_init()} to initialize a
connection handler, then call @code{mysql_real_connect()} with that
handler (along with other information such as the hostname, username,
and password).  Upon connection, @code{mysql_real_connect()} sets the
@code{reconnect} flag (part of the MYSQL structure) to a value of
@code{1}. This flag indicates, in the event that a query cannot be
performed because of a lost connection, to try reconnecting to the
server before giving up.  When you are done with the connection, call
@code{mysql_close()} to terminate it.

While a connection is active, the client may send SQL queries to the server
using @code{mysql_query()} or @code{mysql_real_query()}.  The difference
between the two is that @code{mysql_query()} expects the query to be
specified as a null-terminated string whereas @code{mysql_real_query()}
expects a counted string.  If the string contains binary data (which may
include null bytes), you must use @code{mysql_real_query()}.

For each non-@code{SELECT} query (for example, @code{INSERT}, @code{UPDATE},
@code{DELETE}), you can find out how many rows were changed (affected)
by calling @code{mysql_affected_rows()}.

For @code{SELECT} queries, you retrieve the selected rows as a result set.
(Note that some statements are @code{SELECT}-like in that they return rows.
These include @code{SHOW}, @code{DESCRIBE}, and @code{EXPLAIN}.  They should
be treated the same way as @code{SELECT} statements.)

There are two ways for a client to process result sets.  One way is to
retrieve the entire result set all at once by calling
@code{mysql_store_result()}.  This function acquires from the server all the
rows returned by the query and stores them in the client.  The second way is
for the client to initiate a row-by-row result set retrieval by calling
@code{mysql_use_result()}.  This function initializes the retrieval, but does
not actually get any rows from the server.

In both cases, you access rows by calling @code{mysql_fetch_row()}.  With
@code{mysql_store_result()}, @code{mysql_fetch_row()} accesses rows that have
already been fetched from the server.  With @code{mysql_use_result()},
@code{mysql_fetch_row()} actually retrieves the row from the server.
Information about the size of the data in each row is available by
calling @code{mysql_fetch_lengths()}.

After you are done with a result set, call @code{mysql_free_result()}
to free the memory used for it.

The two retrieval mechanisms are complementary.  Client programs should
choose the approach that is most appropriate for their requirements.
In practice, clients tend to use @code{mysql_store_result()} more
commonly.

An advantage of @code{mysql_store_result()} is that because the rows have all
been fetched to the client, you not only can access rows sequentially, you
can move back and forth in the result set using @code{mysql_data_seek()} or
@code{mysql_row_seek()} to change the current row position within the result
set.  You can also find out how many rows there are by calling
@code{mysql_num_rows()}.  On the other hand, the memory requirements for
@code{mysql_store_result()} may be very high for large result sets and you
are more likely to encounter out-of-memory conditions.

An advantage of @code{mysql_use_result()} is that the client requires less
memory for the result set because it maintains only one row at a time (and
because there is less allocation overhead, @code{mysql_use_result()} can be
faster).  Disadvantages are that you must process each row quickly to avoid
tying up the server, you don't have random access to rows within the result
set (you can only access rows sequentially), and you don't know how many rows
are in the result set until you have retrieved them all.  Furthermore, you
@strong{must} retrieve all the rows even if you determine in mid-retrieval that
you've found the information you were looking for.

The API makes it possible for clients to respond appropriately to
queries (retrieving rows only as necessary) without knowing whether or
not the query is a @code{SELECT}.  You can do this by calling
@code{mysql_store_result()} after each @code{mysql_query()} (or
@code{mysql_real_query()}).  If the result set call succeeds, the query
was a @code{SELECT} and you can read the rows.  If the result set call
fails, call @code{mysql_field_count()} to determine whether a
result was actually to be expected.  If @code{mysql_field_count()}
returns zero, the query returned no data (indicating that it was an
@code{INSERT}, @code{UPDATE}, @code{DELETE}, etc.), and was not
expected to return rows.  If @code{mysql_field_count()} is non-zero, the
query should have returned rows, but didn't.  This indicates that the
query was a @code{SELECT} that failed.  See the description for
@code{mysql_field_count()} for an example of how this can be done.

Both @code{mysql_store_result()} and @code{mysql_use_result()} allow you to
obtain information about the fields that make up the result set (the number
of fields, their names and types, etc.).  You can access field information
sequentially within the row by calling @code{mysql_fetch_field()} repeatedly,
or by field number within the row by calling
@code{mysql_fetch_field_direct()}.  The current field cursor position may be
changed by calling @code{mysql_field_seek()}.  Setting the field cursor
affects subsequent calls to @code{mysql_fetch_field()}.  You can also get
information for fields all at once by calling @code{mysql_fetch_fields()}.

For detecting and reporting errors, MySQL provides access to error
information by means of the @code{mysql_errno()} and @code{mysql_error()}
functions.  These return the error code or error message for the most
recently invoked function that can succeed or fail, allowing you to determine
when an error occurred and what it was.


@node C API functions, C API Prepared statements, C API function overview, C
@subsection C API Function Descriptions

@menu
* mysql_affected_rows::         @code{mysql_affected_rows()}
* mysql_change_user::           @code{mysql_change_user()}
* mysql_character_set_name::    @code{mysql_character_set_name()}
* mysql_close::                 @code{mysql_close()}
* mysql_connect::               @code{mysql_connect()}
* mysql_create_db::             @code{mysql_create_db()}
* mysql_data_seek::             @code{mysql_data_seek()}
* mysql_debug::                 @code{mysql_debug()}
* mysql_drop_db::               @code{mysql_drop_db()}
* mysql_dump_debug_info::       @code{mysql_dump_debug_info()}
* mysql_eof::                   @code{mysql_eof()}
* mysql_errno::                 @code{mysql_errno()}
* mysql_error::                 @code{mysql_error()}
* mysql_escape_string::         @code{mysql_escape_string()}
* mysql_fetch_field::           @code{mysql_fetch_field()}
* mysql_fetch_fields::          @code{mysql_fetch_fields()}
* mysql_fetch_field_direct::    @code{mysql_fetch_field_direct()}
* mysql_fetch_lengths::         @code{mysql_fetch_lengths()}
* mysql_fetch_row::             @code{mysql_fetch_row()}
* mysql_field_count::           @code{mysql_field_count()}
* mysql_field_seek::            @code{mysql_field_seek()}
* mysql_field_tell::            @code{mysql_field_tell()}
* mysql_free_result::           @code{mysql_free_result()}
* mysql_get_client_info::       @code{mysql_get_client_info()}
* mysql_get_client_version::    @code{mysql_get_client_version()}
* mysql_get_host_info::         @code{mysql_get_host_info()}
* mysql_get_proto_info::        @code{mysql_get_proto_info()}
* mysql_get_server_info::       @code{mysql_get_server_info()}
* mysql_get_server_version::    @code{mysql_get_server_version()}
* mysql_info::                  @code{mysql_info()}
* mysql_init::                  @code{mysql_init()}
* mysql_insert_id::             @code{mysql_insert_id()}
* mysql_kill::                  @code{mysql_kill()}
* mysql_list_dbs::              @code{mysql_list_dbs()}
* mysql_list_fields::           @code{mysql_list_fields()}
* mysql_list_processes::        @code{mysql_list_processes()}
* mysql_list_tables::           @code{mysql_list_tables()}
* mysql_num_fields::            @code{mysql_num_fields()}
* mysql_num_rows::              @code{mysql_num_rows()}
* mysql_options::               @code{mysql_options()}
* mysql_ping::                  @code{mysql_ping()}
* mysql_query::                 @code{mysql_query()}
* mysql_real_connect::          @code{mysql_real_connect()}
* mysql_real_escape_string::    @code{mysql_real_escape_string()}
* mysql_real_query::            @code{mysql_real_query()}
* mysql_reload::                @code{mysql_reload()}
* mysql_row_seek::              @code{mysql_row_seek()}
* mysql_row_tell::              @code{mysql_row_tell()}
* mysql_select_db::             @code{mysql_select_db()}
* mysql_set_server_option::     @code{mysql_set_server_option()}
* mysql_shutdown::              @code{mysql_shutdown()}
* mysql_sqlstate::              @code{mysql_sqlstate()}
* mysql_ssl_set::               @code{mysql_ssl_set()}
* mysql_stat::                  @code{mysql_stat()}
* mysql_store_result::          @code{mysql_store_result()}
* mysql_thread_id::             @code{mysql_thread_id()}
* mysql_use_result::            @code{mysql_use_result()}
* mysql_warning_count::         @code{mysql_warning_count()}
* mysql_commit::                @code{mysql_commit()}
* mysql_rollback::              @code{mysql_rollback()}
* mysql_autocommit::            @code{mysql_autocommit()}
* mysql_more_results::          @code{mysql_more_results()}
* mysql_next_result::           @code{mysql_next_result()}
@end menu

In the descriptions here, a parameter or return value of @code{NULL} means
@code{NULL} in the sense of the C programming language, not a
MySQL @code{NULL} value.

Functions that return a value generally return a pointer or an integer.
Unless specified otherwise, functions returning a pointer return a
non-@code{NULL} value to indicate success or a @code{NULL} value to indicate
an error, and functions returning an integer return zero to indicate success
or non-zero to indicate an error.  Note that ``non-zero'' means just that.
Unless the function description says otherwise, do not test against a value
other than zero:

@example
if (result)                   /* correct */
    ... error ...

if (result < 0)               /* incorrect */
    ... error ...

if (result == -1)             /* incorrect */
    ... error ...
@end example

When a function returns an error, the @strong{Errors} subsection of the
function description lists the possible types of errors.  You can
find out which of these occurred by calling @code{mysql_errno()}.
A string representation of the error may be obtained by calling
@code{mysql_error()}.


@node mysql_affected_rows, mysql_change_user, C API functions, C API functions
@subsubsection @code{mysql_affected_rows()}

@findex @code{mysql_affected_rows()}

@code{my_ulonglong mysql_affected_rows(MYSQL *mysql)}

@subsubheading Description

Returns the number of rows changed by the last @code{UPDATE}, deleted by
the last @code{DELETE} or inserted by the last @code{INSERT}
statement. May be called immediately after @code{mysql_query()} for
@code{UPDATE}, @code{DELETE}, or @code{INSERT} statements.  For
@code{SELECT} statements, @code{mysql_affected_rows()} works like
@code{mysql_num_rows()}.

@subsubheading Return Values

An integer greater than zero indicates the number of rows affected or
retrieved.  Zero indicates that no records where updated for an
@code{UPDATE} statement, no rows matched the @code{WHERE} clause in the
query or that no query has yet been executed.  @minus{}1 indicates that the
query returned an error or that, for a @code{SELECT} query,
@code{mysql_affected_rows()} was called prior to calling
@code{mysql_store_result()}. Because @code{mysql_affected_rows()}
returns an unsigned value, you can check for @minus{}1 by comparing the
return value to @code{(my_ulonglong)-1} (or to @code{(my_ulonglong)~0},
which is equivalent).

@subsubheading Errors

None.

@subsubheading Example

@example
mysql_query(&mysql,"UPDATE products SET cost=cost*1.25 WHERE group=10");
printf("%ld products updated",(long) mysql_affected_rows(&mysql));
@end example

If one specifies the flag @code{CLIENT_FOUND_ROWS} when connecting to
@code{mysqld}, @code{mysql_affected_rows()} will return the number of
rows matched by the @code{WHERE} statement for @code{UPDATE} statements.

Note that when one uses a @code{REPLACE} command,
@code{mysql_affected_rows()} will return 2 if the new row replaced and
old row.  This is because in this case one row was inserted after the
duplicate was deleted.


@node mysql_change_user, mysql_character_set_name, mysql_affected_rows, C API functions
@subsubsection @code{mysql_change_user()}

@findex @code{mysql_change_user()}

@code{my_bool mysql_change_user(MYSQL *mysql, const char *user, const
char *password, const char *db)}

@subsubheading Description

Changes the user and causes the database specified by @code{db} to
become the default (current) database on the connection specified by
@code{mysql}.  In subsequent queries, this database is the default for
table references that do not include an explicit database specifier.

This function was introduced in MySQL Version 3.23.3.

@code{mysql_change_user()} fails unless the connected user can be
authenticated or if he doesn't have permission to use the database.  In
this case the user and database are not changed

The @code{db} parameter may be set to @code{NULL} if you don't want to have a
default database.

Starting from MySQL 4.0.6 this command will always @code{ROLLBACK} any
active transactions, close all temporary tables, unlock all locked
tables and reset the state as if one had done a new connect.
This will happen even if the user didn't change.

@subsubheading Return Values

Zero for success.  Non-zero if an error occurred.

@subsubheading Errors

The same that you can get from @code{mysql_real_connect()}.

@table @code
@item CR_COMMANDS_OUT_OF_SYNC
Commands were executed in an improper order.
@item CR_SERVER_GONE_ERROR
The MySQL server has gone away.
@item CR_SERVER_LOST
The connection to the server was lost during the query.
@item CR_UNKNOWN_ERROR
An unknown error occurred.
@item ER_UNKNOWN_COM_ERROR
The MySQL server doesn't implement this command (probably an old server).
@item ER_ACCESS_DENIED_ERROR
The user or password was wrong.
@item ER_BAD_DB_ERROR
The database didn't exist.
@item ER_DBACCESS_DENIED_ERROR
The user did not have access rights to the database.
@item ER_WRONG_DB_NAME
The database name was too long.
@end table

@subsubheading Example

@example
if (mysql_change_user(&mysql, "user", "password", "new_database"))
@{
   fprintf(stderr, "Failed to change user.  Error: %s\n",
           mysql_error(&mysql));
@}
@end example


@node mysql_character_set_name, mysql_close, mysql_change_user, C API functions
@subsubsection @code{mysql_character_set_name()}

@findex @code{mysql_character_set_name()}

@code{const char *mysql_character_set_name(MYSQL *mysql)}

@subsubheading Description

Returns the default character set for the current connection.

@subsubheading Return Values

The default character set

@subsubheading Errors
None.


@node mysql_close, mysql_connect, mysql_character_set_name, C API functions
@subsubsection @code{mysql_close()}

@findex @code{mysql_close()}

@code{void mysql_close(MYSQL *mysql)}

@subsubheading Description
Closes a previously opened connection.  @code{mysql_close()} also deallocates
the connection handle pointed to by @code{mysql} if the handle was allocated
automatically by @code{mysql_init()} or @code{mysql_connect()}.

@subsubheading Return Values

None.

@subsubheading Errors

None.


@node mysql_connect, mysql_create_db, mysql_close, C API functions
@subsubsection @code{mysql_connect()}

@findex @code{mysql_connect()}

@code{MYSQL *mysql_connect(MYSQL *mysql, const char *host, const char *user, const char *passwd)}

@subsubheading Description

This function is deprecated.  It is preferable to use
@code{mysql_real_connect()} instead.

@code{mysql_connect()} attempts to establish a connection to a MySQL
database engine running on @code{host}.  @code{mysql_connect()} must complete
successfully before you can execute any of the other API functions, with the
exception of @code{mysql_get_client_info()}.

The meanings of the parameters are the same as for the corresponding
parameters for @code{mysql_real_connect()} with the difference that the
connection parameter may be @code{NULL}. In this case the C API
allocates memory for the connection structure automatically and frees it
when you call @code{mysql_close()}. The disadvantage of this approach is
that you can't retrieve an error message if the connection fails.  (To
get error information from @code{mysql_errno()} or @code{mysql_error()},
you must provide a valid @code{MYSQL} pointer.)

@subsubheading Return Values

Same as for @code{mysql_real_connect()}.

@subsubheading Errors

Same as for @code{mysql_real_connect()}.


@node mysql_create_db, mysql_data_seek, mysql_connect, C API functions
@subsubsection @code{mysql_create_db()}

@findex @code{mysql_create_db()}

@code{int mysql_create_db(MYSQL *mysql, const char *db)}

@subsubheading Description
Creates the database named by the @code{db} parameter.

This function is deprecated.  It is preferable to use @code{mysql_query()}
to issue an SQL @code{CREATE DATABASE} statement instead.

@subsubheading Return Values

Zero if the database was created successfully. Non-zero if an error
occurred.

@subsubheading Errors
@table @code

@item CR_COMMANDS_OUT_OF_SYNC
Commands were executed in an improper order.

@item CR_SERVER_GONE_ERROR
The MySQL server has gone away.

@item CR_SERVER_LOST
The connection to the server was lost during the query.

@item CR_UNKNOWN_ERROR
An unknown error occurred.
@end table

@subsubheading Example

@example
if(mysql_create_db(&mysql, "my_database"))
@{
   fprintf(stderr, "Failed to create new database.  Error: %s\n",
           mysql_error(&mysql));
@}
@end example


@node mysql_data_seek, mysql_debug, mysql_create_db, C API functions
@subsubsection @code{mysql_data_seek()}

@findex @code{mysql_data_seek()}

@code{void mysql_data_seek(MYSQL_RES *result, my_ulonglong offset)}

@subsubheading Description
Seeks to an arbitrary row in a query result set.  The @code{offset}
value is a row number and should be in the range from @code{0} to
@code{mysql_num_rows(stmt)-1}.

This function requires that the result set structure contains the
entire result of the query, so @code{mysql_data_seek()} may be
used only in conjunction with @code{mysql_store_result()}, not with
@code{mysql_use_result()}.

@subsubheading Return Values

None.

@subsubheading Errors
None.


@node mysql_debug, mysql_drop_db, mysql_data_seek, C API functions
@subsubsection @code{mysql_debug()}

@findex @code{mysql_debug()}

@code{void mysql_debug(const char *debug)}

@subsubheading Description
Does a @code{DBUG_PUSH} with the given string. @code{mysql_debug()} uses the
Fred Fish debug library. To use this function, you must compile the client
library to support debugging.
@xref{Debugging server}. @xref{Debugging client}.

@subsubheading Return Values

None.

@subsubheading Errors
None.

@subsubheading Example

The call shown here causes the client library to generate a trace file in
@file{/tmp/client.trace} on the client machine:

@example
mysql_debug("d:t:O,/tmp/client.trace");
@end example


@node mysql_drop_db, mysql_dump_debug_info, mysql_debug, C API functions
@subsubsection @code{mysql_drop_db()}

@findex @code{mysql_drop_db()}

@code{int mysql_drop_db(MYSQL *mysql, const char *db)}

@subsubheading Description
Drops the database named by the @code{db} parameter.

This function is deprecated.  It is preferable to use @code{mysql_query()}
to issue an SQL @code{DROP DATABASE} statement instead.

@subsubheading Return Values

Zero if the database was dropped successfully. Non-zero if an error
occurred.

@subsubheading Errors

@table @code
@item CR_COMMANDS_OUT_OF_SYNC
Commands were executed in an improper order.
@item CR_SERVER_GONE_ERROR
The MySQL server has gone away.
@item CR_SERVER_LOST
The connection to the server was lost during the query.
@item CR_UNKNOWN_ERROR
An unknown error occurred.
@end table

@subsubheading Example

@example
if(mysql_drop_db(&mysql, "my_database"))
  fprintf(stderr, "Failed to drop the database: Error: %s\n",
          mysql_error(&mysql));
@end example


@node mysql_dump_debug_info, mysql_eof, mysql_drop_db, C API functions
@subsubsection @code{mysql_dump_debug_info()}

@findex @code{mysql_dump_debug_info()}

@code{int mysql_dump_debug_info(MYSQL *mysql)}

@subsubheading Description

Instructs the server to write some debug information to the log. For
this to work, the connected user must have the @code{SUPER} privilege.

@subsubheading Return Values

Zero if the command was successful. Non-zero if an error occurred.

@subsubheading Errors
@table @code
@item CR_COMMANDS_OUT_OF_SYNC
Commands were executed in an improper order.
@item CR_SERVER_GONE_ERROR
The MySQL server has gone away.
@item CR_SERVER_LOST
The connection to the server was lost during the query.
@item CR_UNKNOWN_ERROR
An unknown error occurred.
@end table


@node mysql_eof, mysql_errno, mysql_dump_debug_info, C API functions
@subsubsection @code{mysql_eof()}

@findex @code{mysql_eof()}

@code{my_bool mysql_eof(MYSQL_RES *result)}

@subsubheading Description

This function is deprecated.  @code{mysql_errno()} or @code{mysql_error()}
may be used instead.

@code{mysql_eof()} determines whether the last row of a result
set has been read.

If you acquire a result set from a successful call to
@code{mysql_store_result()}, the client receives the entire set in one
operation.  In this case, a @code{NULL} return from
@code{mysql_fetch_row()} always means the end of the result set has been
reached and it is unnecessary to call @code{mysql_eof()}.  When used
with @code{mysql_store_result()}, @code{mysql_eof()} will always return
true.

On the other hand, if you use @code{mysql_use_result()} to initiate a result
set retrieval, the rows of the set are obtained from the server one by one as
you call @code{mysql_fetch_row()} repeatedly.  Because an error may occur on
the connection during this process, a @code{NULL} return value from
@code{mysql_fetch_row()} does not necessarily mean the end of the result set
was reached normally.  In this case, you can use @code{mysql_eof()} to
determine what happened.  @code{mysql_eof()} returns a non-zero value if the
end of the result set was reached and zero if an error occurred.

Historically, @code{mysql_eof()} predates the standard MySQL error
functions @code{mysql_errno()} and @code{mysql_error()}.  Because those error
functions provide the same information, their use is preferred over
@code{mysql_eof()}, which is now deprecated.  (In fact, they provide more
information, because @code{mysql_eof()} returns only a boolean value whereas
the error functions indicate a reason for the error when one occurs.)

@subsubheading Return Values

Zero if no error occurred. Non-zero if the end of the result set has been
reached.

@subsubheading Errors
None.

@subsubheading Example

The following example shows how you might use @code{mysql_eof()}:

@example
mysql_query(&mysql,"SELECT * FROM some_table");
result = mysql_use_result(&mysql);
while((row = mysql_fetch_row(result)))
@{
    // do something with data
@}
if(!mysql_eof(result))  // mysql_fetch_row() failed due to an error
@{
    fprintf(stderr, "Error: %s\n", mysql_error(&mysql));
@}
@end example

However, you can achieve the same effect with the standard MySQL
error functions:

@example
mysql_query(&mysql,"SELECT * FROM some_table");
result = mysql_use_result(&mysql);
while((row = mysql_fetch_row(result)))
@{
    // do something with data
@}
if(mysql_errno(&mysql))  // mysql_fetch_row() failed due to an error
@{
    fprintf(stderr, "Error: %s\n", mysql_error(&mysql));
@}
@end example


@node mysql_errno, mysql_error, mysql_eof, C API functions
@subsubsection @code{mysql_errno()}

@findex @code{mysql_errno()}

@code{unsigned int mysql_errno(MYSQL *mysql)}

@subsubheading Description

For the connection specified by @code{mysql}, @code{mysql_errno()} returns
the error code for the most recently invoked API function that can succeed
or fail.  A return value of zero means that no error occurred. Client error
message numbers are listed in the MySQL @file{errmsg.h} header file.
Server error message numbers are listed in @file{mysqld_error.h}. In the
MySQL source distribution you can find a complete list of
error messages and error numbers in the file @file{Docs/mysqld_error.txt}.
The server error codes also are listed at @ref{Error-returns}.

Note that some functions like @code{mysql_fetch_row()} don't set
@code{mysql_errno()} if they succeed.

A rule of thumb is that all functions that have to ask the server for
information will reset @code{mysql_errno()} if they succeed.

@subsubheading Return Values

An error code value for the last mysql_xxx call, if it failed.
zero means no error occurred.

@subsubheading Errors
None.


@node mysql_error, mysql_escape_string, mysql_errno, C API functions
@subsubsection @code{mysql_error()}

@findex @code{mysql_error()}

@code{const char *mysql_error(MYSQL *mysql)}

@subsubheading Description

For the connection specified by @code{mysql}, @code{mysql_error()}
returns a null-terminated string containing the error message for the
most recently invoked API function that failed. If a function didn't
fail, the return value of @code{mysql_error()} may be the previous error
or an empty string to indicate no error.

A rule of thumb is that all functions that have to ask the server for
information will reset @code{mysql_error()} if they succeed.

For functions that resets @code{mysql_errno}, the following two tests
are equivalent:

@example
if(mysql_errno(&mysql))
@{
    // an error occurred
@}

if(mysql_error(&mysql)[0] != '\0')
@{
    // an error occurred
@}
@end example

The language of the client error messages may be changed by
recompiling the MySQL client library. Currently you can choose
error messages in several different languages.
@xref{Languages}.

@subsubheading Return Values

A null-terminated character string that describes the error.  An empty string
if no error occurred.

@subsubheading Errors
None.


@node mysql_escape_string, mysql_fetch_field, mysql_error, C API functions
@subsubsection @code{mysql_escape_string()}

@findex @code{mysql_escape_string()}

You should use @code{mysql_real_escape_string()} instead!

This function is identical to @code{mysql_real_escape_string()} except
that @code{mysql_real_escape_string()} takes a connection handler as
its first argument and escapes the string according to the current
character set.  @code{mysql_escape_string()} does not take a connection
argument and does not respect the current charset setting.


@node mysql_fetch_field, mysql_fetch_fields, mysql_escape_string, C API functions
@subsubsection @code{mysql_fetch_field()}

@findex @code{mysql_fetch_field()}

@code{MYSQL_FIELD *mysql_fetch_field(MYSQL_RES *result)}

@subsubheading Description

Returns the definition of one column of a result set as a @code{MYSQL_FIELD}
structure. Call this function repeatedly to retrieve information about all
columns in the result set.  @code{mysql_fetch_field()} returns @code{NULL}
when no more fields are left.

@code{mysql_fetch_field()} is reset to return information about the first
field each time you execute a new @code{SELECT} query.  The field returned by
@code{mysql_fetch_field()} is also affected by calls to
@code{mysql_field_seek()}.

If you've called @code{mysql_query()} to perform a @code{SELECT} on a table
but have not called @code{mysql_store_result()}, MySQL returns the
default blob length (8K bytes) if you call @code{mysql_fetch_field()} to ask
for the length of a @code{BLOB} field.  (The 8K size is chosen because
MySQL doesn't know the maximum length for the @code{BLOB}. This
should be made configurable sometime.) Once you've retrieved the result set,
@code{field->max_length} contains the length of the largest value for this
column in the specific query.

@subsubheading Return Values

The @code{MYSQL_FIELD} structure for the current column. @code{NULL}
if no columns are left.

@subsubheading Errors
None.

@subsubheading Example

@example
MYSQL_FIELD *field;

while((field = mysql_fetch_field(result)))
@{
    printf("field name %s\n", field->name);
@}
@end example


@node mysql_fetch_fields, mysql_fetch_field_direct, mysql_fetch_field, C API functions
@subsubsection @code{mysql_fetch_fields()}

@findex @code{mysql_fetch_fields()}

@code{MYSQL_FIELD *mysql_fetch_fields(MYSQL_RES *result)}

@subsubheading Description

Returns an array of all @code{MYSQL_FIELD} structures for a result set.
Each structure provides the field definition for one column of the result
set.

@subsubheading Return Values

An array of @code{MYSQL_FIELD} structures for all columns of a result set.

@subsubheading Errors
None.

@subsubheading Example

@example
unsigned int num_fields;
unsigned int i;
MYSQL_FIELD *fields;

num_fields = mysql_num_fields(result);
fields = mysql_fetch_fields(result);
for(i = 0; i < num_fields; i++)
@{
   printf("Field %u is %s\n", i, fields[i].name);
@}
@end example


@node mysql_fetch_field_direct, mysql_fetch_lengths, mysql_fetch_fields, C API functions
@subsubsection @code{mysql_fetch_field_direct()}

@findex @code{mysql_fetch_field_direct()}

@code{MYSQL_FIELD *mysql_fetch_field_direct(MYSQL_RES *result, unsigned int fieldnr)}

@subsubheading Description

Given a field number @code{fieldnr} for a column within a result set, returns
that column's field definition as a @code{MYSQL_FIELD} structure. You may use
this function to retrieve the definition for an arbitrary column.  The value
of @code{fieldnr} should be in the range from 0 to
@code{mysql_num_fields(result)-1}.

@subsubheading Return Values

The @code{MYSQL_FIELD} structure for the specified column.

@subsubheading Errors
None.

@subsubheading Example

@example
unsigned int num_fields;
unsigned int i;
MYSQL_FIELD *field;

num_fields = mysql_num_fields(result);
for(i = 0; i < num_fields; i++)
@{
    field = mysql_fetch_field_direct(result, i);
    printf("Field %u is %s\n", i, field->name);
@}
@end example


@node mysql_fetch_lengths, mysql_fetch_row, mysql_fetch_field_direct, C API functions
@subsubsection @code{mysql_fetch_lengths()}

@findex @code{mysql_fetch_lengths()}

@code{unsigned long *mysql_fetch_lengths(MYSQL_RES *result)}

@subsubheading Description

Returns the lengths of the columns of the current row within a result set.
If you plan to copy field values, this length information is also useful for
optimization, because you can avoid calling @code{strlen()}.  In addition, if
the result set contains binary data, you @strong{must} use this function to
determine the size of the data, because @code{strlen()} returns incorrect
results for any field containing null characters.

The length for empty columns and for columns containing @code{NULL} values is
zero.  To see how to distinguish these two cases, see the description for
@code{mysql_fetch_row()}.

@subsubheading Return Values

An array of unsigned long integers representing the size of each column (not
including any terminating null characters).
@code{NULL} if an error occurred.

@subsubheading Errors
@code{mysql_fetch_lengths()} is valid only for the current row of the result
set.  It returns @code{NULL} if you call it before calling
@code{mysql_fetch_row()} or after retrieving all rows in the result.

@subsubheading Example

@example
MYSQL_ROW row;
unsigned long *lengths;
unsigned int num_fields;
unsigned int i;

row = mysql_fetch_row(result);
if (row)
@{
    num_fields = mysql_num_fields(result);
    lengths = mysql_fetch_lengths(result);
    for(i = 0; i < num_fields; i++)
    @{
         printf("Column %u is %lu bytes in length.\n", i, lengths[i]);
    @}
@}
@end example


@node mysql_fetch_row, mysql_field_count, mysql_fetch_lengths, C API functions
@subsubsection @code{mysql_fetch_row()}

@findex @code{mysql_fetch_row()}

@code{MYSQL_ROW mysql_fetch_row(MYSQL_RES *result)}

@subsubheading Description

Retrieves the next row of a result set. When used after
@code{mysql_store_result()}, @code{mysql_fetch_row()} returns @code{NULL}
when there are no more rows to retrieve.  When used after
@code{mysql_use_result()}, @code{mysql_fetch_row()} returns @code{NULL} when
there are no more rows to retrieve or if an error occurred.

The number of values in the row is given by @code{mysql_num_fields(result)}.
If @code{row} holds the return value from a call to @code{mysql_fetch_row()},
pointers to the values are accessed as @code{row[0]} to
@code{row[mysql_num_fields(result)-1]}.  @code{NULL} values in the row are
indicated by @code{NULL} pointers.

The lengths of the field values in the row may be obtained by calling
@code{mysql_fetch_lengths()}.  Empty fields and fields containing
@code{NULL} both have length 0; you can distinguish these by checking
the pointer for the field value.  If the pointer is @code{NULL}, the field
is @code{NULL}; otherwise, the field is empty.

@subsubheading Return Values

A @code{MYSQL_ROW} structure for the next row.  @code{NULL} if
there are no more rows to retrieve or if an error occurred.

@subsubheading Errors

Note that error is not reset between calls to @code{mysql_fetch_row()}

@table @code
@item CR_SERVER_LOST
The connection to the server was lost during the query.
@item CR_UNKNOWN_ERROR
An unknown error occurred.
@end table

@subsubheading Example

@example
MYSQL_ROW row;
unsigned int num_fields;
unsigned int i;

num_fields = mysql_num_fields(result);
while ((row = mysql_fetch_row(result)))
@{
   unsigned long *lengths;
   lengths = mysql_fetch_lengths(result);
   for(i = 0; i < num_fields; i++)
   @{
       printf("[%.*s] ", (int) lengths[i], row[i] ? row[i] : "NULL");
   @}
   printf("\n");
@}
@end example


@node mysql_field_count, mysql_field_seek, mysql_fetch_row, C API functions
@subsubsection @code{mysql_field_count()}

@findex @code{mysql_field_count()}

@code{unsigned int mysql_field_count(MYSQL *mysql)}

If you are using a version of MySQL earlier than Version 3.22.24, you
should use @code{unsigned int mysql_num_fields(MYSQL *mysql)} instead.

@subsubheading Description

Returns the number of columns for the most recent query on the connection.

The normal use of this function is when @code{mysql_store_result()}
returned @code{NULL} (and thus you have no result set pointer).
In this case, you can call @code{mysql_field_count()} to
determine whether @code{mysql_store_result()} should have produced a
non-empty result.  This allows the client program to take proper action
without knowing whether the query was a @code{SELECT} (or
@code{SELECT}-like) statement.  The example shown here illustrates how this
may be done.

@xref{NULL mysql_store_result, , @code{NULL mysql_store_result()}}.

@subsubheading Return Values

An unsigned integer representing the number of fields in a result set.

@subsubheading Errors
None.

@subsubheading Example

@example
MYSQL_RES *result;
unsigned int num_fields;
unsigned int num_rows;

if (mysql_query(&mysql,query_string))
@{
    // error
@}
else // query succeeded, process any data returned by it
@{
    result = mysql_store_result(&mysql);
    if (result)  // there are rows
    @{
        num_fields = mysql_num_fields(result);
        // retrieve rows, then call mysql_free_result(result)
    @}
    else  // mysql_store_result() returned nothing; should it have?
    @{
        if(mysql_field_count(&mysql) == 0)
        @{
            // query does not return data
            // (it was not a SELECT)
            num_rows = mysql_affected_rows(&mysql);
        @}
        else // mysql_store_result() should have returned data
        @{
            fprintf(stderr, "Error: %s\n", mysql_error(&mysql));
        @}
    @}
@}
@end example

An alternative is to replace the @code{mysql_field_count(&mysql)} call with
@code{mysql_errno(&mysql)}.  In this case, you are checking directly for an
error from @code{mysql_store_result()} rather than inferring from the value
of @code{mysql_field_count()} whether the statement was a
@code{SELECT}.


@node mysql_field_seek, mysql_field_tell, mysql_field_count, C API functions
@subsubsection @code{mysql_field_seek()}

@findex @code{mysql_field_seek()}

@code{MYSQL_FIELD_OFFSET mysql_field_seek(MYSQL_RES *result, MYSQL_FIELD_OFFSET offset)}

@subsubheading Description

Sets the field cursor to the given offset.   The next call to
@code{mysql_fetch_field()} will retrieve the field definition of the column
associated with that offset.

To seek to the beginning of a row, pass an @code{offset} value of zero.

@subsubheading Return Values

The previous value of the field cursor.

@subsubheading Errors
None.


@node mysql_field_tell, mysql_free_result, mysql_field_seek, C API functions
@subsubsection @code{mysql_field_tell()}

@findex @code{mysql_field_tell()}

@code{MYSQL_FIELD_OFFSET mysql_field_tell(MYSQL_RES *result)}

@subsubheading Description

Returns the position of the field cursor used for the last
@code{mysql_fetch_field()}. This value can be used as an argument to
@code{mysql_field_seek()}.

@subsubheading Return Values

The current offset of the field cursor.

@subsubheading Errors
None.


@node mysql_free_result, mysql_get_client_info, mysql_field_tell, C API functions
@subsubsection @code{mysql_free_result()}

@findex @code{mysql_free_result()}

@code{void mysql_free_result(MYSQL_RES *result)}

@subsubheading Description

Frees the memory allocated for a result set by @code{mysql_store_result()},
@code{mysql_use_result()}, @code{mysql_list_dbs()}, etc.  When you are done
with a result set, you must free the memory it uses by calling
@code{mysql_free_result()}.

Do not attempt to access a result set after freeing it.

@subsubheading Return Values

None.

@subsubheading Errors
None.


@node mysql_get_client_info, mysql_get_client_version, mysql_free_result, C API functions
@subsubsection @code{mysql_get_client_info()}

@findex @code{mysql_get_client_info()}

@code{char *mysql_get_client_info(void)}

@subsubheading Description

Returns a string that represents the client library version.

@subsubheading Return Values

A character string that represents the MySQL client library version.

@subsubheading Errors
None.


@node mysql_get_client_version, mysql_get_host_info, mysql_get_client_info, C API functions
@subsubsection @code{mysql_get_client_version()}

@findex @code{mysql_get_client_version()}

@code{unsigned long mysql_get_client_version(void)}

@subsubheading Description

Returns an integer that represents the client library version.
The value has the format @code{XYYZZ} where @code{X} is the major
version, @code{YY} is the release level, and @code{ZZ} is the version
number within the release level. For example, a value of @code{40102}
represents a client library version of @code{4.1.2}.

@subsubheading Return Values

An integer that represents the MySQL client library version.

@subsubheading Errors
None.

@node mysql_get_host_info, mysql_get_proto_info, mysql_get_client_version, C API functions
@subsubsection @code{mysql_get_host_info()}

@findex @code{mysql_get_host_info()}

@code{char *mysql_get_host_info(MYSQL *mysql)}

@subsubheading Description

Returns a string describing the type of connection in use, including the
server hostname.

@subsubheading Return Values

A character string representing the server hostname and the connection type.

@subsubheading Errors
None.


@node mysql_get_proto_info, mysql_get_server_info, mysql_get_host_info, C API functions
@subsubsection @code{mysql_get_proto_info()}

@findex @code{mysql_get_proto_info()}

@code{unsigned int mysql_get_proto_info(MYSQL *mysql)}

@subsubheading Description

Returns the protocol version used by current connection.

@subsubheading Return Values

An unsigned integer representing the protocol version used by the current
connection.

@subsubheading Errors
None.


@node mysql_get_server_info, mysql_get_server_version, mysql_get_proto_info, C API functions
@subsubsection @code{mysql_get_server_info()}

@findex @code{mysql_get_server_info()}

@code{char *mysql_get_server_info(MYSQL *mysql)}

@subsubheading Description

Returns a string that represents the server version number.

@subsubheading Return Values

A character string that represents the server version number.

@subsubheading Errors
None.


@node mysql_get_server_version, mysql_info, mysql_get_server_info, C API functions
@subsubsection @code{mysql_get_server_version()}

@findex @code{mysql_get_server_version()}

@code{unsigned long mysql_get_server_version(MYSQL *mysql)}

@subsubheading Description

Returns version number of server as an integer (new in 4.1).

@subsubheading Return Values

A number that represents the MySQL server version in format:

main_version*10000 + minor_version *100 + sub_version

For example, 4.1.0 is returned as 40100.

This is useful to quickly determine the version of the server in a
client program to know if some capability exits.

@subsubheading Errors
None.


@node mysql_info, mysql_init, mysql_get_server_version, C API functions
@subsubsection @code{mysql_info()}

@findex @code{mysql_info()}

@code{char *mysql_info(MYSQL *mysql)}

@subsubheading Description

Retrieves a string providing information about the most recently executed
query, but only for the statements listed here.  For other statements,
@code{mysql_info()} returns @code{NULL}.  The format of the string varies
depending on the type of query, as described here.  The numbers are
illustrative only; the string will contain values appropriate for the query.

@table @code
@item INSERT INTO ... SELECT ...
String format: @code{Records: 100 Duplicates: 0 Warnings: 0}
@item INSERT INTO ... VALUES (...),(...),(...)...
String format: @code{Records: 3  Duplicates: 0  Warnings: 0}
@item LOAD DATA INFILE ...
String format: @code{Records: 1 Deleted: 0 Skipped: 0 Warnings: 0}
@item ALTER TABLE
String format: @code{Records: 3 Duplicates: 0 Warnings: 0}
@item UPDATE
String format: @code{Rows matched: 40 Changed: 40 Warnings: 0}
@end table

Note that @code{mysql_info()} returns a non-@code{NULL} value for
@code{INSERT ... VALUES} only for the multiple-row form
of the statement (that is, only if multiple value lists are
specified).

@subsubheading Return Values

A character string representing additional information about the most
recently executed query.  @code{NULL} if no information is available for the
query.

@subsubheading Errors
None.


@node mysql_init, mysql_insert_id, mysql_info, C API functions
@subsubsection @code{mysql_init()}

@findex @code{mysql_init()}

@code{MYSQL *mysql_init(MYSQL *mysql)}

@subsubheading Description

Allocates or initializes a @code{MYSQL} object suitable for
@code{mysql_real_connect()}.  If @code{mysql} is a @code{NULL} pointer, the
function allocates, initializes, and returns a new object.  Otherwise, the
object is initialized and the address of the object is returned.  If
@code{mysql_init()} allocates a new object, it will be freed when
@code{mysql_close()} is called to close the connection.

@subsubheading Return Values

An initialized @code{MYSQL*} handle.  @code{NULL} if there was
insufficient memory to allocate a new object.

@subsubheading Errors
In case of insufficient memory, @code{NULL} is returned.


@node mysql_insert_id, mysql_kill, mysql_init, C API functions
@subsubsection @code{mysql_insert_id()}

@findex @code{mysql_insert_id()}

@code{my_ulonglong mysql_insert_id(MYSQL *mysql)}

@subsubheading Description

Returns the value generated for an @code{AUTO_INCREMENT} column by the
previous @code{INSERT} or @code{UPDATE} query.  Use this function after
you have performed an @code{INSERT} query into a table that contains an
@code{AUTO_INCREMENT} field.

Note that @code{mysql_insert_id()} returns @code{0} if the previous query
does not use an @code{AUTO_INCREMENT} value.  If you need to save
the value for later, be sure to call @code{mysql_insert_id()} immediately
after the query that generates the value.

If the previous query returned an error, the value of @code{mysql_insert_id()}
is undefined.

@code{mysql_insert_id()} is updated after:

@itemize @bullet
@item
@code{INSERT} statements that sets or generates an @code{AUTO_INCREMENT} value.
In case of multi-row @code{INSERT} statement @code{mysql_insert_id()} returns
the @strong{FIRST} generated @code{AUTO_INCREMENT} value or the @code{LAST}
set @code{AUTO_INCREMENT} value if there was no generated value.
@item
@code{UPDATE} statements that generate an @code{AUTO_INCREMENT} value.
@item
@code{INSERT} or @code{UPDATE} statements that set a column value to
@code{LAST_INSERT_ID(expr)}.
@end itemize

@xref{Miscellaneous functions}.

Also note that the value of the SQL @code{LAST_INSERT_ID()} function always
contains the most recently generated @code{AUTO_INCREMENT} value, and is
not reset between queries because the value of that function is maintained
in the server.  Another difference is that @code{LAST_INSERT_ID()} is not
updated if you set an @code{AUTO_INCREMENT} column to a specific value.

The reason for the difference between @code{LAST_INSERT_ID()} and
@code{mysql_insert_id()} is that @code{LAST_INSERT_ID()} is made easy to
use in scripts while @code{mysql_insert_id()} tries to provide a little
more exact information of what happens to the auto_increment column.

@subsubheading Return Values

The value of the @code{AUTO_INCREMENT} field that was updated by the previous
query.  Returns zero if there was no previous query on the connection or if
the query did not update an @code{AUTO_INCREMENT} value.

@subsubheading Errors
None.


@node mysql_kill, mysql_list_dbs, mysql_insert_id, C API functions
@subsubsection @code{mysql_kill()}

@findex @code{mysql_kill()}

@code{int mysql_kill(MYSQL *mysql, unsigned long pid)}

@subsubheading Description

Asks the server to kill the thread specified by @code{pid}.

@subsubheading Return Values

Zero for success.  Non-zero if an error occurred.

@subsubheading Errors

@table @code
@item CR_COMMANDS_OUT_OF_SYNC
Commands were executed in an improper order.
@item CR_SERVER_GONE_ERROR
The MySQL server has gone away.
@item CR_SERVER_LOST
The connection to the server was lost during the query.
@item CR_UNKNOWN_ERROR
An unknown error occurred.
@end table


@node mysql_list_dbs, mysql_list_fields, mysql_kill, C API functions
@subsubsection @code{mysql_list_dbs()}

@findex @code{mysql_list_dbs()}

@code{MYSQL_RES *mysql_list_dbs(MYSQL *mysql, const char *wild)}

@subsubheading Description

Returns a result set consisting of database names on the server that match
the simple regular expression specified by the @code{wild} parameter.
@code{wild} may contain the wildcard characters @samp{%} or @samp{_}, or may
be a @code{NULL} pointer to match all databases.  Calling
@code{mysql_list_dbs()} is similar to executing the query @code{SHOW
databases [LIKE wild]}.

You must free the result set with @code{mysql_free_result()}.

@subsubheading Return Values

A @code{MYSQL_RES} result set for success.  @code{NULL} if an error occurred.

@subsubheading Errors

@table @code
@item CR_COMMANDS_OUT_OF_SYNC
Commands were executed in an improper order.
@item CR_OUT_OF_MEMORY
Out of memory.
@item CR_SERVER_GONE_ERROR
The MySQL server has gone away.
@item CR_SERVER_LOST
The connection to the server was lost during the query.
@item CR_UNKNOWN_ERROR
An unknown error occurred.
@end table


@node mysql_list_fields, mysql_list_processes, mysql_list_dbs, C API functions
@subsubsection @code{mysql_list_fields()}

@findex @code{mysql_list_fields()}

@code{MYSQL_RES *mysql_list_fields(MYSQL *mysql, const char *table, const char *wild)}

@subsubheading Description

Returns a result set consisting of field names in the given table that match
the simple regular expression specified by the @code{wild} parameter.
@code{wild} may contain the wildcard characters @samp{%} or @samp{_}, or may
be a @code{NULL} pointer to match all fields.  Calling
@code{mysql_list_fields()} is similar to executing the query @code{SHOW
COLUMNS FROM tbl_name [LIKE wild]}.

Note that it's recommended that you use @code{SHOW COLUMNS FROM tbl_name}
instead of @code{mysql_list_fields()}.

You must free the result set with @code{mysql_free_result()}.

@subsubheading Return Values

A @code{MYSQL_RES} result set for success.  @code{NULL} if an error occurred.

@subsubheading Errors

@table @code
@item CR_COMMANDS_OUT_OF_SYNC
Commands were executed in an improper order.
@item CR_SERVER_GONE_ERROR
The MySQL server has gone away.
@item CR_SERVER_LOST
The connection to the server was lost during the query.
@item CR_UNKNOWN_ERROR
An unknown error occurred.
@end table


@node mysql_list_processes, mysql_list_tables, mysql_list_fields, C API functions
@subsubsection @code{mysql_list_processes()}

@findex @code{mysql_list_processes()}

@code{MYSQL_RES *mysql_list_processes(MYSQL *mysql)}

@subsubheading Description

Returns a result set describing the current server threads.  This is the same
kind of information as that reported by @code{mysqladmin processlist} or
a @code{SHOW PROCESSLIST} query.

You must free the result set with @code{mysql_free_result()}.

@subsubheading Return Values

A @code{MYSQL_RES} result set for success.  @code{NULL} if an error occurred.

@subsubheading Errors

@table @code
@item CR_COMMANDS_OUT_OF_SYNC
Commands were executed in an improper order.
@item CR_SERVER_GONE_ERROR
The MySQL server has gone away.
@item CR_SERVER_LOST
The connection to the server was lost during the query.
@item CR_UNKNOWN_ERROR
An unknown error occurred.
@end table


@node mysql_list_tables, mysql_num_fields, mysql_list_processes, C API functions
@subsubsection @code{mysql_list_tables()}

@findex @code{mysql_list_tables()}

@code{MYSQL_RES *mysql_list_tables(MYSQL *mysql, const char *wild)}

@subsubheading Description

Returns a result set consisting of table names in the current database that
match the simple regular expression specified by the @code{wild} parameter.
@code{wild} may contain the wildcard characters @samp{%} or @samp{_}, or may
be a @code{NULL} pointer to match all tables.  Calling
@code{mysql_list_tables()} is similar to executing the query @code{SHOW
tables [LIKE wild]}.

You must free the result set with @code{mysql_free_result()}.

@subsubheading Return Values

A @code{MYSQL_RES} result set for success.  @code{NULL} if an error occurred.

@subsubheading Errors

@table @code
@item CR_COMMANDS_OUT_OF_SYNC
Commands were executed in an improper order.
@item CR_SERVER_GONE_ERROR
The MySQL server has gone away.
@item CR_SERVER_LOST
The connection to the server was lost during the query.
@item CR_UNKNOWN_ERROR
An unknown error occurred.
@end table


@node mysql_num_fields, mysql_num_rows, mysql_list_tables, C API functions
@subsubsection @code{mysql_num_fields()}

@findex @code{mysql_num_fields()}
@findex @code{mysql_field_count()}

@code{unsigned int mysql_num_fields(MYSQL_RES *result)}

or:

@code{unsigned int mysql_num_fields(MYSQL *mysql)}

The second form doesn't work on MySQL Version 3.22.24 or newer.  To pass a
@code{MYSQL*} argument, you must use
@code{unsigned int mysql_field_count(MYSQL *mysql)} instead.

@subsubheading Description

Returns the number of columns in a result set.

Note that you can get the number of columns either from a pointer to a result
set or to a connection handle.  You would use the connection handle if
@code{mysql_store_result()} or @code{mysql_use_result()} returned
@code{NULL} (and thus you have no result set pointer).  In this case, you can
call @code{mysql_field_count()} to determine whether
@code{mysql_store_result()} should have produced a non-empty result.  This
allows the client program to take proper action without knowing whether or
not the query was a @code{SELECT} (or @code{SELECT}-like) statement.  The
example shown here illustrates how this may be done.

@xref{NULL mysql_store_result, , @code{NULL mysql_store_result()}}.

@subsubheading Return Values

An unsigned integer representing the number of fields in a result set.

@subsubheading Errors
None.

@subsubheading Example

@example
MYSQL_RES *result;
unsigned int num_fields;
unsigned int num_rows;

if (mysql_query(&mysql,query_string))
@{
    // error
@}
else // query succeeded, process any data returned by it
@{
    result = mysql_store_result(&mysql);
    if (result)  // there are rows
    @{
        num_fields = mysql_num_fields(result);
        // retrieve rows, then call mysql_free_result(result)
    @}
    else  // mysql_store_result() returned nothing; should it have?
    @{
        if (mysql_errno(&mysql))
        @{
           fprintf(stderr, "Error: %s\n", mysql_error(&mysql));
        @}
        else if (mysql_field_count(&mysql) == 0)
        @{
            // query does not return data
            // (it was not a SELECT)
            num_rows = mysql_affected_rows(&mysql);
        @}
    @}
@}
@end example

An alternative (if you know that your query should have returned a result set)
is to replace the @code{mysql_errno(&mysql)} call with a check if
@code{mysql_field_count(&mysql)} is = 0.  This will happen only if something
went wrong.


@node mysql_num_rows, mysql_options, mysql_num_fields, C API functions
@subsubsection @code{mysql_num_rows()}

@findex @code{mysql_num_rows()}

@code{my_ulonglong mysql_num_rows(MYSQL_RES *result)}

@subsubheading Description

Returns the number of rows in the result set.

The use of @code{mysql_num_rows()} depends on whether you use
@code{mysql_store_result()} or @code{mysql_use_result()} to return the result
set.  If you use @code{mysql_store_result()}, @code{mysql_num_rows()} may be
called immediately.  If you use @code{mysql_use_result()},
@code{mysql_num_rows()} will not return the correct value until all the rows
in the result set have been retrieved.

@subsubheading Return Values

The number of rows in the result set.

@subsubheading Errors
None.


@node mysql_options, mysql_ping, mysql_num_rows, C API functions
@subsubsection @code{mysql_options()}

@findex @code{mysql_options()}

@code{int mysql_options(MYSQL *mysql, enum mysql_option option, const char *arg)}

@subsubheading Description

Can be used to set extra connect options and affect behavior for a connection.
This function may be called multiple times to set several options.

@code{mysql_options()} should be called after @code{mysql_init()} and before
@code{mysql_connect()} or @code{mysql_real_connect()}.

The @code{option} argument is the option that you want to set; the @code{arg}
argument is the value for the option. If the option is an integer, then
@code{arg} should point to the value of the integer.

Possible options values:

@multitable @columnfractions .42 .20 .38
@item @strong{Option} @tab @strong{Argument type} @tab @strong{Function}
@item @code{MYSQL_OPT_CONNECT_TIMEOUT} @tab @code{unsigned int *} @tab Connect timeout in seconds.
@item @code{MYSQL_OPT_READ_TIMEOUT} @tab @code{unsigned int *} @tab Timeout for reads from server (works currently only on Windows on TCP/IP connections)
@item @code{MYSQL_OPT_WRITE_TIMEOUT} @tab @code{unsigned int *} @tab Timeout for writes to server (works currently only on Windows on TCP/IP connections)
@item @code{MYSQL_OPT_COMPRESS} @tab Not used @tab Use the compressed client/server protocol.
@item @code{MYSQL_OPT_LOCAL_INFILE} @tab optional pointer to uint @tab If no pointer is given or if pointer points to an @code{unsigned int != 0} the command @code{LOAD LOCAL INFILE} is enabled.
@item @code{MYSQL_OPT_NAMED_PIPE} @tab Not used @tab Use named pipes to connect to a MySQL server on NT.
@item @code{MYSQL_INIT_COMMAND} @tab @code{char *} @tab Command to execute when connecting to the MySQL server. Will automatically be re-executed when reconnecting.
@item @code{MYSQL_READ_DEFAULT_FILE} @tab @code{char *} @tab Read options from the named option file instead of from @file{my.cnf}.
@item @code{MYSQL_READ_DEFAULT_GROUP} @tab @code{char *} @tab Read options from the named group from @file{my.cnf} or the file specified with @code{MYSQL_READ_DEFAULT_FILE}.
@item @code{MYSQL_OPT_PROTOCOL} @tab @code{unsigned int *} @tab Type of protocol to use. Should be one of the enum values of @code{mysql_protocol_type} defined in @file{mysql.h}.
@item @code{MYSQL_SHARED_MEMORY_BASE_NAME} @tab @code{char*} @tab Named of of chared memory object for communication to server. Should be same as the option @code{-shared-memory-base-name} used for the mysqld server you want's to connect to.
@end multitable

Note that the group @code{client} is always read if you use
@code{MYSQL_READ_DEFAULT_FILE} or @code{MYSQL_READ_DEFAULT_GROUP}.

The specified group in the option file may contain the following options:

@multitable @columnfractions .25 .60
@item @strong{Option} @tab @strong{Description}
@item @code{connect-timeout} @tab Connect timeout in seconds. On Linux this timeout is also used for waiting for the first answer from the server.
@item @code{compress} @tab Use the compressed client/server protocol.
@item @code{database} @tab Connect to this database if no database was specified in the connect command.
@item @code{debug} @tab Debug options.
@item @code{disable-local-infile} @tab Disable use of @code{LOAD DATA LOCAL}.
@item @code{host} @tab Default hostname.
@item @code{init-command} @tab Command to execute when connecting to MySQL server. Will automatically be re-executed when reconnecting.
@item @code{interactive-timeout} @tab Same as specifying @code{CLIENT_INTERACTIVE} to @code{mysql_real_connect()}. @xref{mysql_real_connect}.
@item @code{local-infile[=(0|1)]} @tab If no argument or argument != 0 then enable use of @code{LOAD DATA LOCAL}.
@item @code{max_allowed_packet} @tab Max size of packet client can read from server.
@item @code{password} @tab Default password.
@item @code{pipe} @tab Use named pipes to connect to a MySQL server on NT.
@item @code{protocol=(TCP | SOCKET | PIPE | MEMORY)} @tab Which protocol to use when connecting to server (New in 4.1)
@item @code{port} @tab Default port number.
@item @code{return-found-rows} @tab Tell @code{mysql_info()} to return found rows instead of updated rows when using @code{UPDATE}.
@item @code{shared-memory-base-name=name} @tab Shared memory name to use to connect to server (default is "MySQL"). New in MySQL 4.1.
@item @code{socket} @tab Default socket number.
@item @code{user} @tab Default user.
@end multitable

Note that @code{timeout} has been replaced by @code{connect-timeout}, but
@code{timeout} will still work for a while.

For more information about option files, see @ref{Option files}.

@subsubheading Return Values

Zero for success.  Non-zero if you used an unknown option.

@subsubheading Example

@example
MYSQL mysql;

mysql_init(&mysql);
mysql_options(&mysql,MYSQL_OPT_COMPRESS,0);
mysql_options(&mysql,MYSQL_READ_DEFAULT_GROUP,"odbc");
if (!mysql_real_connect(&mysql,"host","user","passwd","database",0,NULL,0))
@{
    fprintf(stderr, "Failed to connect to database: Error: %s\n",
          mysql_error(&mysql));
@}
@end example

The above requests the client to use the compressed client/server protocol and
read the additional options from the @code{odbc} section in the @file{my.cnf}
file.


@node mysql_ping, mysql_query, mysql_options, C API functions
@subsubsection @code{mysql_ping()}

@findex @code{mysql_ping()}

@code{int mysql_ping(MYSQL *mysql)}

@subsubheading Description

Checks whether the connection to the server is working. If it has gone
down, an automatic reconnection is attempted.

This function can be used by clients that remain idle for a long while,
to check whether the server has closed the connection and reconnect
if necessary.

@subsubheading Return Values

Zero if the server is alive. Non-zero if an error occurred.

@subsubheading Errors

@table @code
@item CR_COMMANDS_OUT_OF_SYNC
Commands were executed in an improper order.
@item CR_SERVER_GONE_ERROR
The MySQL server has gone away.
@item CR_UNKNOWN_ERROR
An unknown error occurred.
@end table


@node mysql_query, mysql_real_connect, mysql_ping, C API functions
@subsubsection @code{mysql_query()}

@findex @code{mysql_query()}

@code{int mysql_query(MYSQL *mysql, const char *query)}

@subsubheading Description
Executes the SQL query pointed to by the null-terminated string @code{query}.
The query must consist of a single SQL statement.  You should not add
a terminating semicolon (@samp{;}) or @code{\g} to the statement.

@code{mysql_query()} cannot be used for queries that contain binary data; you
should use @code{mysql_real_query()} instead.  (Binary data may contain the
@samp{\0} character, which @code{mysql_query()} interprets as the end of the
query string.)

If you want to know if the query should return a result set or not, you can
use @code{mysql_field_count()} to check for this.
@xref{mysql_field_count, , @code{mysql_field_count()}}.

@subsubheading Return Values

Zero if the query was successful. Non-zero if an error occurred.

@subsubheading Errors

@table @code
@item CR_COMMANDS_OUT_OF_SYNC
Commands were executed in an improper order.
@item CR_SERVER_GONE_ERROR
The MySQL server has gone away.
@item CR_SERVER_LOST
The connection to the server was lost during the query.
@item CR_UNKNOWN_ERROR
An unknown error occurred.
@end table


@node mysql_real_connect, mysql_real_escape_string, mysql_query, C API functions
@subsubsection @code{mysql_real_connect()}

@findex @code{mysql_real_connect()}

@code{MYSQL *mysql_real_connect(MYSQL *mysql, const char *host,
                 const char *user, const char *passwd, const char *db,
                 unsigned int port, const char *unix_socket,
                 unsigned long client_flag)}

@subsubheading Description

@code{mysql_real_connect()} attempts to establish a connection to a
MySQL database engine running on @code{host}.
@code{mysql_real_connect()} must complete successfully before you can execute
any of the other API functions, with the exception of
@code{mysql_get_client_info()}.

The parameters are specified as follows:

@itemize @bullet
@item
The first parameter should be the address of an existing @code{MYSQL}
structure.  Before calling @code{mysql_real_connect()} you must call
@code{mysql_init()} to initialize the @code{MYSQL} structure. You can
change a lot of connect options with the @code{mysql_options()}
call.  @xref{mysql_options, @code{mysql_options()}}.

@item
The value of @code{host} may be either a hostname or an IP address.  If
@code{host} is @code{NULL} or the string @code{"localhost"}, a connection to
the local host is assumed. If the OS supports sockets (Unix) or named pipes
(Windows), they are used instead of TCP/IP to connect to the server.

@item
The @code{user} parameter contains the user's MySQL login ID.  If
@code{user} is @code{NULL} or the empty string @code{""}, the current
user is assumed.  Under Unix, this is the current login name.  Under
Windows ODBC, the current username must be specified explicitly.
@xref{ODBC administrator}.

@item
The @code{passwd} parameter contains the password for @code{user}.  If
@code{passwd} is @code{NULL}, only entries in the @code{user} table for the
user that have a blank (empty) password field will be checked for a match. This
allows the database administrator to set up the MySQL privilege
system in such a way that users get different privileges depending on whether
or not they have specified a password.

Note: Do not attempt to encrypt the password before calling
@code{mysql_real_connect()}; password encryption is handled automatically by
the client API.

@item
@code{db} is the database name.
If @code{db} is not @code{NULL}, the connection will set the default
database to this value.

@item
If @code{port} is not 0, the value will be used as the port number
for the TCP/IP connection.  Note that the @code{host} parameter
determines the type of the connection.

@item
If @code{unix_socket} is not @code{NULL}, the string specifies the
socket or named pipe that should be used.  Note that the @code{host}
parameter determines the type of the connection.

@item
The value of @code{client_flag} is usually 0, but can be set to a combination
of the following flags in very special circumstances:

@multitable @columnfractions .30 .65
@item @strong{Flag name}       @tab @strong{Flag description}
@item @code{CLIENT_COMPRESS}   @tab Use compression protocol.
@item @code{CLIENT_FOUND_ROWS} @tab Return the number of found (matched) rows, not the number of affected rows.
@item @code{CLIENT_IGNORE_SPACE} @tab Allow spaces after function names. Makes all functions names reserved words.
@item @code{CLIENT_INTERACTIVE} @tab Allow @code{interactive_timeout} seconds (instead of @code{wait_timeout} seconds) of inactivity before closing the connection. The client's session @code{wait_timeout} variable will be set to the value of the session @code{interactive_timeout} variable.
@item @code{CLIENT_LOCAL_FILES} @tab Enable @code{LOAD DATA LOCAL} handling.
@item @code{CLIENT_MULTI_STATEMENTS} @tab Tell the server that the client may send multi-row-queries (separated with @samp{;}). If this flag is not set, multi-row-queries are disabled. New in 4.1.
@item @code{CLIENT_MULTI_RESULTS} @tab Tell the server that the client can handle multiple-result sets from multi-queries or stored procedures.  This is automatically set if @code{CLIENT_MULTI_STATEMENTS} is set. New in 4.1.
@item @code{CLIENT_NO_SCHEMA}  @tab Don't allow the @code{db_name.tbl_name.col_name} syntax.  This is for ODBC. It causes the parser to generate an error if you use that syntax, which is useful for trapping bugs in some ODBC programs.
@item @code{CLIENT_ODBC}       @tab The client is an ODBC client. This changes @code{mysqld} to be more ODBC-friendly.
@item @code{CLIENT_SSL}         @tab Use SSL (encrypted protocol). This option should not be set by application programs; it is set internally in the client library.
@end multitable
@end itemize

@subsubheading Return Values

A @code{MYSQL*} connection handle if the connection was successful,
@code{NULL} if the connection was unsuccessful.  For a successful connection,
the return value is the same as the value of the first parameter.

@subsubheading Errors

@table @code
@item CR_CONN_HOST_ERROR
Failed to connect to the MySQL server.

@item CR_CONNECTION_ERROR
Failed to connect to the local MySQL server.

@item CR_IPSOCK_ERROR
Failed to create an IP socket.

@item CR_OUT_OF_MEMORY
Out of memory.

@item CR_SOCKET_CREATE_ERROR
Failed to create a Unix socket.

@item CR_UNKNOWN_HOST
Failed to find the IP address for the hostname.

@item CR_VERSION_ERROR
A protocol mismatch resulted from attempting to connect to a server with a
client library that uses a different protocol version.  This can happen if you
use a very old client library to connect to a new server that wasn't started
with the @code{--old-protocol} option.

@item CR_NAMEDPIPEOPEN_ERROR
Failed to create a named pipe on Windows.

@item CR_NAMEDPIPEWAIT_ERROR
Failed to wait for a named pipe on Windows.

@item CR_NAMEDPIPESETSTATE_ERROR
Failed to get a pipe handler on Windows.

@item CR_SERVER_LOST
If @code{connect_timeout} > 0 and it took longer than @code{connect_timeout}
seconds to connect to the server or if the server died while executing the
@code{init-command}.

@end table

@subsubheading Example

@example
MYSQL mysql;

mysql_init(&mysql);
mysql_options(&mysql,MYSQL_READ_DEFAULT_GROUP,"your_prog_name");
if (!mysql_real_connect(&mysql,"host","user","passwd","database",0,NULL,0))
@{
    fprintf(stderr, "Failed to connect to database: Error: %s\n",
          mysql_error(&mysql));
@}
@end example

By using @code{mysql_options()} the MySQL library will read the
@code{[client]} and @code{[your_prog_name]} sections in the @file{my.cnf}
file which will ensure that your program will work, even if someone has
set up MySQL in some non-standard way.

Note that upon connection, @code{mysql_real_connect()} sets the @code{reconnect}
flag (part of the @code{MYSQL} structure) to a value of @code{1}. This
flag indicates, in the event that a query cannot be performed because
of a lost connection, to try reconnecting to the server before giving up.


@node mysql_real_escape_string, mysql_real_query, mysql_real_connect, C API functions
@subsubsection @code{mysql_real_escape_string()}

@findex @code{mysql_real_escape_string()}

@code{unsigned long mysql_real_escape_string(MYSQL *mysql, char *to, const char *from, unsigned long length)}

@subsubheading Description

This function is used to create a legal SQL string that you can use in a
SQL statement. @xref{String syntax}.

The string in @code{from} is encoded to an escaped SQL string, taking
into account the current character set of the connection. The result is placed
in @code{to} and a terminating null byte is appended.  Characters
encoded are @code{NUL} (ASCII 0), @samp{\n}, @samp{\r}, @samp{\},
@samp{'}, @samp{"}, and Control-Z (@pxref{Literals}).
(Strictly speaking, MySQL requires only that backslash and the quote
character used to quote the string in the query be escaped.  This function
quotes the other characters to make them easier to read in log files.)

The string pointed to by @code{from} must be @code{length} bytes long.  You
must allocate the @code{to} buffer to be at least @code{length*2+1} bytes
long.  (In the worst case, each character may need to be encoded as using two
bytes, and you need room for the terminating null byte.)  When
@code{mysql_real_escape_string()} returns, the contents of @code{to} will be a
null-terminated string.  The return value is the length of the encoded
string, not including the terminating null character.

@subsubheading Example

@example
char query[1000],*end;

end = strmov(query,"INSERT INTO test_table values(");
*end++ = '\'';
end += mysql_real_escape_string(&mysql, end,"What's this",11);
*end++ = '\'';
*end++ = ',';
*end++ = '\'';
end += mysql_real_escape_string(&mysql, end,"binary data: \0\r\n",16);
*end++ = '\'';
*end++ = ')';

if (mysql_real_query(&mysql,query,(unsigned int) (end - query)))
@{
   fprintf(stderr, "Failed to insert row, Error: %s\n",
           mysql_error(&mysql));
@}
@end example

The @code{strmov()} function used in the example is included in the
@code{mysqlclient} library and works like @code{strcpy()} but returns a
pointer to the terminating null of the first parameter.

@subsubheading Return Values

The length of the value placed into @code{to}, not including the
terminating null character.

@subsubheading Errors
None.


@node mysql_real_query, mysql_reload, mysql_real_escape_string, C API functions
@subsubsection @code{mysql_real_query()}

@findex @code{mysql_real_query()}

@code{int mysql_real_query(MYSQL *mysql, const char *query, unsigned long length)}

@subsubheading Description

Executes the SQL query pointed to by @code{query}, which should be a string
@code{length} bytes long.  The query must consist of a single SQL statement.
You should not add a terminating semicolon (@samp{;}) or @code{\g} to the
statement.

You @strong{must} use @code{mysql_real_query()} rather than
@code{mysql_query()} for queries that contain binary data, because binary data
may contain the @samp{\0} character.  In addition, @code{mysql_real_query()}
is faster than @code{mysql_query()} because it does not call @code{strlen()} on
the query string.

If you want to know if the query should return a result set or not, you can
use @code{mysql_field_count()} to check for this.
@xref{mysql_field_count, @code{mysql_field_count()}}.

@subsubheading Return Values

Zero if the query was successful. Non-zero if an error occurred.

@subsubheading Errors

@table @code
@item CR_COMMANDS_OUT_OF_SYNC
Commands were executed in an improper order.
@item CR_SERVER_GONE_ERROR
The MySQL server has gone away.
@item CR_SERVER_LOST
The connection to the server was lost during the query.
@item CR_UNKNOWN_ERROR
An unknown error occurred.
@end table


@node mysql_reload, mysql_row_seek, mysql_real_query, C API functions
@subsubsection @code{mysql_reload()}

@findex @code{mysql_reload()}

@code{int mysql_reload(MYSQL *mysql)}

@subsubheading Description

Asks the MySQL server to reload the grant tables. The
connected user must have the @code{RELOAD} privilege.

This function is deprecated.  It is preferable to use @code{mysql_query()}
to issue an SQL @code{FLUSH PRIVILEGES} statement instead.

@subsubheading Return Values

Zero for success.  Non-zero if an error occurred.

@subsubheading Errors

@table @code
@item CR_COMMANDS_OUT_OF_SYNC
Commands were executed in an improper order.
@item CR_SERVER_GONE_ERROR
The MySQL server has gone away.
@item CR_SERVER_LOST
The connection to the server was lost during the query.
@item CR_UNKNOWN_ERROR
An unknown error occurred.
@end table


@node mysql_row_seek, mysql_row_tell, mysql_reload, C API functions
@subsubsection @code{mysql_row_seek()}

@findex @code{mysql_row_seek()}

@code{MYSQL_ROW_OFFSET mysql_row_seek(MYSQL_RES *result, MYSQL_ROW_OFFSET offset)}

@subsubheading Description
Sets the row cursor to an arbitrary row in a query result set.
The @code{offset} value is a row offset that should be a value returned
from @code{mysql_row_tell()} or from @code{mysql_row_seek()}.
This value is not a row number; if you want to seek to a row within a
result set by number, use @code{mysql_data_seek()} instead.

This function requires that the result set structure contains the
entire result of the query, so @code{mysql_row_seek()} may be used
only in conjunction with @code{mysql_store_result()}, not with
@code{mysql_use_result()}.

@subsubheading Return Values

The previous value of the row cursor.  This value may be passed to a
subsequent call to @code{mysql_row_seek()}.

@subsubheading Errors
None.


@node mysql_row_tell, mysql_select_db, mysql_row_seek, C API functions
@subsubsection @code{mysql_row_tell()}

@findex @code{mysql_row_tell()}

@code{MYSQL_ROW_OFFSET mysql_row_tell(MYSQL_RES *result)}

@subsubheading Description

Returns the current position of the row cursor for the last
@code{mysql_fetch_row()}. This value can be used as an argument to
@code{mysql_row_seek()}.

You should use @code{mysql_row_tell()} only after @code{mysql_store_result()},
not after @code{mysql_use_result()}.

@subsubheading Return Values

The current offset of the row cursor.

@subsubheading Errors
None.

@node mysql_select_db, mysql_set_server_option, mysql_row_tell, C API functions
@subsubsection @code{mysql_select_db()}

@findex @code{mysql_select_db()}

@code{int mysql_select_db(MYSQL *mysql, const char *db)}

@subsubheading Description

Causes the database specified by @code{db} to become the default (current)
database on the connection specified by @code{mysql}.  In subsequent queries,
this database is the default for table references that do not include an
explicit database specifier.

@code{mysql_select_db()} fails unless the connected user can be authenticated
as having permission to use the database.

@subsubheading Return Values

Zero for success.  Non-zero if an error occurred.

@subsubheading Errors

@table @code
@item CR_COMMANDS_OUT_OF_SYNC
Commands were executed in an improper order.
@item CR_SERVER_GONE_ERROR
The MySQL server has gone away.
@item CR_SERVER_LOST
The connection to the server was lost during the query.
@item CR_UNKNOWN_ERROR
An unknown error occurred.
@end table

@node mysql_set_server_option, mysql_shutdown, mysql_select_db, C API functions
@subsubsection @code{mysql_set_server_option()}

@findex @code{mysql_set_sever_option()}

@code{int mysql_set_server_option(MYSQL *mysql, enum enum_mysql_set_option option)}

@subsubheading Description

Enables or disables an option for the connection. @code{option} can have one
of the following values:

@multitable @columnfractions .30 .65
@item MYSQL_OPTION_MULTI_STATEMENTS_ON @tab Enable multi statement support.
@item MYSQL_OPTION_MULTI_STATEMENTS_OFF @tab Disable multi statement support.
@end multitable

@subsubheading Return Values

Zero for success.  Non-zero if an error occurred.

@subsubheading Errors

@table @code
@item CR_COMMANDS_OUT_OF_SYNC
Commands were executed in an improper order.
@item CR_SERVER_GONE_ERROR
The MySQL server has gone away.
@item CR_SERVER_LOST
The connection to the server was lost during the query.
@item ER_UNKNOWN_COM_ERROR
The server didn't support @code{mysql_set_server_option()} (which is the
case that the server is older than 4.1.1) or the server didn't support
the option one tried to set.
@end table


@node mysql_shutdown, mysql_sqlstate, mysql_set_server_option, C API functions
@subsubsection @code{mysql_shutdown()}

@findex @code{mysql_shutdown()}

@code{int mysql_shutdown(MYSQL *mysql)}

@subsubheading Description

Asks the database server to shut down. The connected user must have
@code{SHUTDOWN} privileges.

@subsubheading Return Values

Zero for success.  Non-zero if an error occurred.

@subsubheading Errors

@table @code
@item CR_COMMANDS_OUT_OF_SYNC
Commands were executed in an improper order.
@item CR_SERVER_GONE_ERROR
The MySQL server has gone away.
@item CR_SERVER_LOST
The connection to the server was lost during the query.
@item CR_UNKNOWN_ERROR
An unknown error occurred.
@end table

@node mysql_sqlstate, mysql_ssl_set, mysql_shutdown, C API functions
@subsubsection @code{mysql_sqlstate()}

@findex @code{mysql_sqlstate()}

@code{const char *mysql_sqlstate(MYSQL *mysql)}

@subsubheading Description

Returns a null-terminated string containing the SQLSTATE error code for the
last error.  The error code consists of five characters.
@code{'00000'} means ``no error''.
The values are specified by ANSI SQL and ODBC.
For a list of possible values, see @ref{Error-returns}.

Note that not all MySQL errors are yet mapped to SQLSTATE's.
The value @code{'HY000'} (general error) is used
for unmapped errors.

This function was added to MySQL 4.1.1.

@subsubheading Return Values

A null-terminated character string containing the SQLSTATE error code.

@subsubheading See Also

@xref{mysql_errno}.
@xref{mysql_error}.
@xref{mysql_stmt_sqlstate}.


@node mysql_ssl_set, mysql_stat, mysql_sqlstate, C API functions
@subsubsection @code{mysql_ssl_set()}

@findex @code{mysql_ssl_set()}

@code{int mysql_ssl_set(MYSQL *mysql, const char *key,
                 const char *cert, const char *ca,
                 const char *capath, const char *cipher)}

@subsubheading Description

@code{mysql_ssl_set()} is used for establishing secure connections using
SSL. It must be called before @code{mysql_real_connect()}.

@code{mysql_ssl_set()} does nothing unless OpenSSL support is enabled in
the client library.

@code{mysql} is the connection handler returned from @code{mysql_init()}.
The other parameters are specified as follows:

@itemize @bullet
@item
@code{key} is the pathname to the key file.

@item
@code{cert} is the pathname to the certificate file.

@item
@code{ca} is the pathname to the certificate authority file.

@item
@code{capath} is the pathname to a directory that contains trusted 
SSL CA certificates in pem format.

@item
@code{cipher} is a list of allowable ciphers to use for SSL encryption.

@end itemize

Any unused SSL parameters may be given as @code{NULL}.

@subsubheading Return Values

This function always returns @code{0}. If SSL setup is incorrect,
@code{mysql_real_connect()} will return an error when you attempt to connect.

@node mysql_stat, mysql_store_result, mysql_ssl_set, C API functions
@subsubsection @code{mysql_stat()}

@findex @code{mysql_stat()}

@code{char *mysql_stat(MYSQL *mysql)}

@subsubheading Description

Returns a character string containing information similar to that provided by
the @code{mysqladmin status} command.  This includes uptime in seconds and
the number of running threads, questions, reloads, and open tables.

@subsubheading Return Values

A character string describing the server status. @code{NULL} if an
error occurred.

@subsubheading Errors

@table @code
@item CR_COMMANDS_OUT_OF_SYNC
Commands were executed in an improper order.
@item CR_SERVER_GONE_ERROR
The MySQL server has gone away.
@item CR_SERVER_LOST
The connection to the server was lost during the query.
@item CR_UNKNOWN_ERROR
An unknown error occurred.
@end table


@node mysql_store_result, mysql_thread_id, mysql_stat, C API functions
@subsubsection @code{mysql_store_result()}

@findex @code{mysql_store_result()}

@code{MYSQL_RES *mysql_store_result(MYSQL *mysql)}

@subsubheading Description

You must call @code{mysql_store_result()} or @code{mysql_use_result()}
for every query that successfully retrieves data (@code{SELECT},
@code{SHOW}, @code{DESCRIBE}, @code{EXPLAIN}).

You don't have to call @code{mysql_store_result()} or
@code{mysql_use_result()} for other queries, but it will not do any
harm or cause any notable performance if you call @code{mysql_store_result()}
in all cases.  You can detect if the query didn't have a result set by
checking if @code{mysql_store_result()} returns 0 (more about this later one).

If you want to know if the query should return a result set or not, you can
use @code{mysql_field_count()} to check for this.
@xref{mysql_field_count, @code{mysql_field_count()}}.

@code{mysql_store_result()} reads the entire result of a query to the client,
allocates a @code{MYSQL_RES} structure, and places the result into this
structure.

@code{mysql_store_result()} returns a null pointer if the query didn't return
a result set (if the query was, for example, an @code{INSERT} statement).

@code{mysql_store_result()} also returns a null pointer if reading of the
result set failed. You can check if an error occurred by checking if
@code{mysql_error()} returns a non-empty string, if
@code{mysql_errno()} returns non-zero, or if @code{mysql_field_count()}
returns zero.

An empty result set is returned if there are no rows returned.  (An empty
result set differs from a null pointer as a return value.)

Once you have called @code{mysql_store_result()} and got a result back
that isn't a null pointer, you may call @code{mysql_num_rows()} to find
out how many rows are in the result set.

You can call @code{mysql_fetch_row()} to fetch rows from the result set,
or @code{mysql_row_seek()} and @code{mysql_row_tell()} to obtain or
set the current row position within the result set.

You must call @code{mysql_free_result()} once you are done with the result
set.

@xref{NULL mysql_store_result, , @code{NULL mysql_store_result()}}.

@subsubheading Return Values

A @code{MYSQL_RES} result structure with the results. @code{NULL} if
an error occurred.

@subsubheading Errors

@code{mysql_store_result()} resets @code{mysql_error} and
@code{mysql_errno} if it succeeds.

@table @code
@item CR_COMMANDS_OUT_OF_SYNC
Commands were executed in an improper order.
@item CR_OUT_OF_MEMORY
Out of memory.
@item CR_SERVER_GONE_ERROR
The MySQL server has gone away.
@item CR_SERVER_LOST
The connection to the server was lost during the query.
@item CR_UNKNOWN_ERROR
An unknown error occurred.
@end table


@node mysql_thread_id, mysql_use_result, mysql_store_result, C API functions
@subsubsection @code{mysql_thread_id()}

@findex @code{mysql_thread_id()}

@code{unsigned long mysql_thread_id(MYSQL *mysql)}

@subsubheading Description

Returns the thread ID of the current connection.  This value can be used as
an argument to @code{mysql_kill()} to kill the thread.

If the connection is lost and you reconnect with @code{mysql_ping()}, the
thread ID will change.  This means you should not get the thread ID and store
it for later. You should get it when you need it.

@subsubheading Return Values

The thread ID of the current connection.

@subsubheading Errors
None.


@node mysql_use_result, mysql_warning_count, mysql_thread_id, C API functions
@subsubsection @code{mysql_use_result()}

@findex @code{mysql_use_result()}

@code{MYSQL_RES *mysql_use_result(MYSQL *mysql)}

@subsubheading Description

You must call @code{mysql_store_result()} or @code{mysql_use_result()} for
every query that successfully retrieves data (@code{SELECT}, @code{SHOW},
@code{DESCRIBE}, @code{EXPLAIN}).

@code{mysql_use_result()} initiates a result set retrieval but does not
actually read the result set into the client like @code{mysql_store_result()}
does.  Instead, each row must be retrieved individually by making calls to
@code{mysql_fetch_row()}.  This reads the result of a query directly from the
server without storing it in a temporary table or local buffer, which is
somewhat faster and uses much less memory than @code{mysql_store_result()}.
The client will allocate memory only for the current row and a communication
buffer that may grow up to @code{max_allowed_packet} bytes.

On the other hand, you shouldn't use @code{mysql_use_result()} if you are
doing a lot of processing for each row on the client side, or if the output
is sent to a screen on which the user may type a @code{^S} (stop scroll).
This will tie up the server and prevent other threads from updating any
tables from which the data is being fetched.

When using @code{mysql_use_result()}, you must execute
@code{mysql_fetch_row()} until a @code{NULL} value is returned, otherwise, the
unfetched rows will be returned as part of the result set for your next
query. The C API will give the error @code{Commands out of sync; you can't
run this command now} if you forget to do this!

You may not use @code{mysql_data_seek()}, @code{mysql_row_seek()},
@code{mysql_row_tell()}, @code{mysql_num_rows()}, or
@code{mysql_affected_rows()} with a result returned from
@code{mysql_use_result()}, nor may you issue other queries until the
@code{mysql_use_result()} has finished.  (However, after you have fetched all
the rows, @code{mysql_num_rows()} will accurately return the number of rows
fetched.)

You must call @code{mysql_free_result()} once you are done with the result
set.

@subsubheading Return Values

A @code{MYSQL_RES} result structure. @code{NULL} if an error occurred.

@subsubheading Errors

@code{mysql_use_result()} resets @code{mysql_error} and
@code{mysql_errno} if it succeeds.

@table @code
@item CR_COMMANDS_OUT_OF_SYNC
Commands were executed in an improper order.
@item CR_OUT_OF_MEMORY
Out of memory.
@item CR_SERVER_GONE_ERROR
The MySQL server has gone away.
@item CR_SERVER_LOST
The connection to the server was lost during the query.
@item CR_UNKNOWN_ERROR
An unknown error occurred.
@end table


@node mysql_warning_count, mysql_commit, mysql_use_result, C API functions
@subsubsection @code{mysql_warning_count()}

@findex @code{mysql_warning_count()}.

@code{unsigned int mysql_warning_count(MYSQL *mysql)}

@subsubheading Description

Returns the number of warnings generated during execution of the previous
SQL statement.
Available from MySQL 4.1.

@subsubheading Return Values

The warning count.

@subsubheading Errors

None.


@node mysql_commit, mysql_rollback, mysql_warning_count, C API functions
@subsubsection @code{mysql_commit()}

@findex @code{mysql_commit()}.

@code{my_bool mysql_commit(MYSQL *mysql)}

@subsubheading Description

Commits the current transaction.
Available from MySQL 4.1.

@subsubheading Return Values

Zero if successful. Non-zero if an error occurred.

@subsubheading Errors

None.


@node mysql_rollback, mysql_autocommit, mysql_commit, C API functions
@subsubsection @code{mysql_rollback()}

@findex @code{mysql_rollback()}.

@code{my_bool mysql_rollback(MYSQL *mysql)}

@subsubheading Description

Rolls back the current transaction.
Available from MySQL 4.1.

@subsubheading Return Values

Zero if successful. Non-zero if an error occurred.

@subsubheading Errors

None.


@node mysql_autocommit, mysql_more_results, mysql_rollback, C API functions
@subsubsection @code{mysql_autocommit()}

@findex @code{mysql_autocommit()}.

@code{my_bool mysql_autocommit(MYSQL *mysql, my_bool mode)}

@subsubheading Description

Sets autocommit mode on if @code{mode} is 1, off if @code{mode} is 0.
Available from MySQL 4.1.

@subsubheading Return Values

Zero if successful. Non-zero if an error occurred.

@subsubheading Errors

None.


@node mysql_more_results, mysql_next_result, mysql_autocommit, C API functions
@subsubsection @code{mysql_more_results()}

@findex @code{mysql_more_results()}.

@code{my_bool mysql_more_results(MYSQL *mysql)}

@subsubheading Description

Returns true if more results exist from the currently executed query,
and the application must call @code{mysql_next_result()} to fetch the
results.
Available from MySQL 4.1.

@subsubheading Return Values

@code{TRUE} (1) if more results exist. @code{FALSE} (0) if no more results
exist.

Note that in most cases one instead call @code{mysql_next_result()} to
test if more result exists and initiate the next result set if it existed.

@xref{C API multiple queries}.
@xref{mysql_next_result}.

@subsubheading Errors

None.


@node mysql_next_result,  , mysql_more_results, C API functions
@subsubsection @code{mysql_next_result()}

@findex @code{mysql_next_result()}.

@code{int mysql_next_result(MYSQL *mysql)}

@subsubheading Description

If more query results exist, @code{mysql_next_result()} reads the
next query results and returns the status back to application.
Available from MySQL 4.1.

Note that you must call @code{mysql_free_result()} for the preceding
query if it returned a result set.

After calling @code{mysql_next_result()} the state of the connection
is as if you had called @code{mysql_real_query()} for the next query.
This means that you can now call @code{mysql_store_result()},
@code{mysql_warning_count()}, @code{mysql_affected_rows()} ... on the
connection.

If @code{mysql_next_result()} returns an error, no other statements will
be executed and there is no more results to fetch.


@xref{C API multiple queries}.

@subsubheading Return Values

0 if successful and there was more results
-1   if no more results
> 0  if an error occurred.

@subsubheading Errors

@table @code
@item CR_COMMANDS_OUT_OF_SYNC
Commands were executed in an improper order. For example if you didn't call
@code{mysql_use_result()} for a previous result set.
@item CR_SERVER_GONE_ERROR
The MySQL server has gone away.
@item CR_SERVER_LOST
The connection to the server was lost during the query.
@item CR_UNKNOWN_ERROR
An unknown error occurred.
@end table


@node C API Prepared statements, C API Prepared statement datatypes, C API functions, C
@subsection C API Prepared Statements

As of MySQL 4.1, the client/server protocol provides for the use of
prepared statements. This capability uses the
@code{MYSQL_STMT} statement handler data structure.
Prepared execution is an efficient way to execute a statement more than
once. The statement is first parsed to prepare it for execution. Then
it is executed one or more times at a later time, using the statement
handle returned by the prepare function.

Prepared execution is faster than direct execution for statements
executed more than once, primarly because the query is parsed only
once. In the case of direct execution, the query is parsed every
time it is executed. Prepared execution also can provide a reduction of network
traffic because for each execution of the prepared statement,
it is necessary only to send the data for the parameters.

Another advantage of prepared statements is that it uses a binary protocol
that makes data transfer between client and server more efficient.
Prepared statements also can support input and output binding for
multiple query execution.


@node C API Prepared statement datatypes, C API Prepared statement function overview, C API Prepared statements, C
@subsection C API Prepared Statement Datatypes

@strong{Note:} The API for prepared statements is still subject to revision.
This information is provided for early adopters, but please be aware that
the API may change.

Prepared statements mainly use the @code{MYSQL_STMT} and
@code{MYSQL_BIND} data structures. A third structure, @code{MYSQL_TIME},
is used to transfer temporal data.

@table @code
@tindex MYSQL_STMT C type

@item MYSQL_STMT
This structure represents a prepared statement.
A statement is prepared by calling
@code{mysql_prepare()}, which returns a statement handle, that is, a
pointer to a @code{MYSQL_STMT}.
The handle is used for all subsequent statement-related functions. 

The @code{MYSQL_STMT} structure has no members that are for application
use.

Multiple statement handles can be associated with a single connection.
The limit on the number of handles depends on the available system resources.

@tindex MYSQL_BIND C type
@item MYSQL_BIND
This structure is used both for query input (data values sent to the server)
and output (result values returned from the server). For input, it is used with
@code{mysql_bind_param()} to bind parameter data values to buffers
for use by @code{mysql_execute()}. For output, it is used with
@code{mysql_bind_result()} to bind result set buffers for
use in fetching rows with @code{mysql_fetch()}.

@noindent
The @code{MYSQL_BIND} structure contains the following members for
use by application programs.
Each is used both for input and for output, though sometimes for different
purposes depending on the direction of data transfer.

@table @code
@item enum enum_field_types buffer_type
The type of the buffer. The allowable @code{buffer_type} values are listed
later in this section. For input, @code{buffer_type} indicates what type of
value you are binding to a query parameter. For output, it indicates what type
of value you expect to receive in a result buffer.

@item void *buffer
For input, this is a pointer to the buffer in which a query parameter's data
value is stored. For output, it is
a pointer to the buffer in which to return a result set column value.
For numeric column types, @code{buffer} should point to a variable of the proper
C type.
(If you are associating the variable with a column that has the
@code{UNSIGNED} attribute, the variable should be an @code{unsigned} C type.)
For date and time column types, @code{buffer} should point to a
@code{MYSQL_TIME} structure.  For character and binary string column types,
@code{buffer} should point to a character buffer.

@item unsigned long buffer_length
The actual size of @code{*buffer} in bytes. This indicates the maximum amount
of data that can be stored in the buffer. For character and binary C data,
the @code{buffer_length} value specifies the length of @code{*buffer}
when used with @code{mysql_bind_param()},
or the maximum number of data bytes that can be fetched into the buffer
when used with @code{mysql_bind_result()}.

@item unsigned long *length
A pointer to an @code{unsigned long} variable that indicates the actual number
of bytes of data stored in @code{*buffer}.
@code{length} is used for character or binary C data.
For input parameter data binding, @code{length}
points to an @code{unsigned long} variable that indicates the
length of the parameter value stored in @code{*buffer}; this is used by
@code{mysql_execute()}.
If @code{length} is a null pointer, the protocol assumes
that all character and binary data are null-terminated.
For output value binding, @code{mysql_fetch()} places
the length of the column value that is returned
into the variable that @code{length} points to.

@code{length}
is ignored for numeric and temporal datatypes because the length
of the data value is determined by the @code{buffer_type} value.

@item my_bool *is_null
This member points to a @code{my_bool} variable that is true if a value is
@code{NULL}, false if it is not @code{NULL}. For input, set @code{*is_null}
to true to
indicate that you are passing a @code{NULL} value as a query parameter. For
output, this value will be set to true after you fetch a row if the result
value returned from the query is @code{NULL}.
@end table

@tindex MySQL C type
@item MYSQL_TIME
This structure is used to send and receive @code{DATE}, @code{TIME},
@code{DATETIME}, and @code{TIMESTAMP} data directly to and from the server.
This is done by setting the @code{buffer_type} member of a @code{MYSQL_BIND}
structure to one of the temporal types, and setting the @code{buffer} member
to point to a @code{MYSQL_TIME} structure.

@noindent
The @code{MYSQL_TIME} structure contains the following members:

@c TODO: rather than say TIME for the hour item (which doesn't make much
@c sense; don't minute/second apply, too), say for each temporal type
@c which structure members are used for it.

@table @code

@item unsigned int year
The year.

@item unsigned int month
The month of the year.

@item unsigned int day
The day of the month.

@item unsigned int hour
The hour of the day.

@item unsigned int minute
The minute of the hour.

@item unsigned int second
The second of the minute.

@item my_bool neg
A boolean flag to indicate whether the time is negative.

@item unsigned long second_part
The fractional part of the second.
This member currently is unused.

@end table

@c TODO: does neg only to TIME/TIMESTAMP?
@c TODO: second_part probably applies only to TIMESTAMP?

Only those parts of a @code{MYSQL_TIME} structure that apply to a given
type of temporal value are used:
The @code{year}, @code{month}, and @code{day} elements are used for
@code{DATE}, @code{DATETIME}, and @code{TIMESTAMP} values.
The @code{hour}, @code{minute}, and @code{second} elements are used for
@code{TIME}, @code{DATETIME}, and @code{TIMESTAMP} values.
@xref{C API date handling}.

@end table

The following table shows the allowable values that may be specified in the
@code{buffer_type} member of @code{MYSQL_BIND} structures.
The table also shows those SQL types that correspond most closely to each
@code{buffer_type} value, and, for numeric and temporal types, the
corresponding C type.

@c TODO: this table is missing some values

@multitable @columnfractions .33 .33 .33
@item @code{buffer_type} @strong{Value} @tab @strong{SQL Type} @tab @strong{C Type}
@item @code{MYSQL_TYPE_TINY} @tab @code{TINYINT} @tab @code{char}
@item @code{MYSQL_TYPE_SHORT} @tab @code{SMALLINT} @tab @code{short int}
@item @code{MYSQL_TYPE_LONG}   @tab @code{INT} @tab @code{long int}
@item @code{MYSQL_TYPE_LONGLONG} @tab @code{BIGINT} @tab @code{long long int}
@item @code{MYSQL_TYPE_FLOAT} @tab @code{FLOAT} @tab @code{float}
@item @code{MYSQL_TYPE_DOUBLE} @tab @code{DOUBLE} @tab @code{double}
@item @code{MYSQL_TYPE_TIME} @tab @code{TIME} @tab @code{MYSQL_TIME}
@item @code{MYSQL_TYPE_DATE} @tab @code{DATE} @tab @code{MYSQL_TIME}
@item @code{MYSQL_TYPE_DATETIME} @tab @code{DATETIME} @tab @code{MYSQL_TIME}
@item @code{MYSQL_TYPE_TIMESTAMP} @tab @code{TIMESTAMP} @tab @code{MYSQL_TIME}
@item @code{MYSQL_TYPE_STRING} @tab @code{CHAR} @tab
@item @code{MYSQL_TYPE_VAR_STRING} @tab @code{VARCHAR} @tab
@item @code{MYSQL_TYPE_TINY_BLOB} @tab @code{TINYBLOB/TINYTEXT} @tab
@item @code{MYSQL_TYPE_BLOB} @tab @code{BLOB/TEXT} @tab
@item @code{MYSQL_TYPE_MEDIUM_BLOB} @tab @code{MEDIUMBLOB/MEDIUMTEXT} @tab
@item @code{MYSQL_TYPE_LONG_BLOB} @tab @code{LONGBLOB/LONGTEXT} @tab
@end multitable

Implicit type conversion may be performed in both directions.

@c TODO: Explain what that means and give some examples. Need list of
@c allowable/supported conversions


@node C API Prepared statement function overview, C API Prepared statement functions, C API Prepared statement datatypes, C
@subsection C API Prepared Statement Function Overview

@cindex C Prepared statement API, functions
@cindex functions, C Prepared statement API

@strong{Note:} The API for prepared statements is still subject to revision.
This information is provided for early adopters, but please be aware that
the API may change.

The functions available for prepared statement processing are summarized here and
described in greater detail in a later section.
@xref{C API Prepared statement functions}.

@c TODO: missing functions here (that are listed in mysql.h)
@c mysql_fetch_column()
@c mysql_param_result()
@c mysql_stmt_data_seek()
@c mysql_stmt_free_result()
@c mysql_stmt_reset()
@c mysql_stmt_row_seek()

@multitable @columnfractions .32 .68
@item @strong{Function} @tab @strong{Description}

@item @strong{mysql_bind_param()} @tab
Associates application data buffers with the parameter markers in a prepared
SQL statement.

@item @strong{mysql_bind_result()} @tab
Associates application data buffers with columns in the result set.

@item @strong{mysql_execute()} @tab
Executes the prepared statement.

@item @strong{mysql_fetch()} @tab
Fetches the next row of data from the result set and returns data for all bound columns.

@item @strong{mysql_fetch_column()} @tab
Fetch data for one column of the current row of the result set.

@item @strong{mysql_get_metadata()} @tab
Returns prepared statement metadata in the form of a result set.

@item @strong{mysql_param_count()} @tab
Returns the number of parameters in a prepared SQL statement.

@c TODO: This function is not yet implemented?
@item @strong{mysql_param_result()} @tab
Return parameter metadata in the form of a result set.

@item @strong{mysql_prepare()} @tab
Prepares an SQL string for execution.

@item @strong{mysql_send_long_data()} @tab
Sends long data in chunks to server.

@item @strong{mysql_stmt_affected_rows()} @tab
Returns the number of rows changes, deleted, or inserted by the last
@code{UPDATE}, @code{DELETE}, or @code{INSERT} query.

@item @strong{mysql_stmt_close()} @tab
Frees memory used by prepared statement.

@item @strong{mysql_stmt_data_seek()} @tab
Seeks to an arbitrary row number in a statement result set.

@item @strong{mysql_stmt_errno()} @tab
Returns the error number for the last statement execution.

@item @strong{mysql_stmt_error()} @tab
Returns the error message for the last statement execution.

@item @strong{mysql_stmt_free_result()} @tab
Free the resources allocated to the statement handle.

@item @strong{mysql_stmt_num_rows()} @tab
Returns total rows from the statement buffered result set.

@c TODO: this description is not helpful.
@item @strong{mysql_stmt_reset()} @tab
Reset the statement buffers in the server.

@item @strong{mysql_stmt_row_seek()} @tab
Seeks to a row offset in a statement result set, using value returned from
@code{mysql_stmt_row_tell()}.

@item @strong{mysql_stmt_row_tell()} @tab
Returns the statement row cursor position.

@item @strong{mysql_stmt_sqlstate()} @tab
Returns the SQLSTATE error code for the last statement execution.

@item @strong{mysql_stmt_store_result()} @tab
Retrieves the complete result set to the client.

@end multitable

Call @code{mysql_prepare()} to prepare and initialize the statement
handle, @code{mysql_bind_param()} to supply the parameter
data, and @code{mysql_execute()} to execute the query. You can
repeat the @code{mysql_execute()} by changing parameter values in the
respective buffers supplied through @code{mysql_bind_param()}.

If the query is a @code{SELECT} statement or any other query that produces
a result set, @code{mysql_prepare()} will also return the result
set metadata information in the form of a @code{MYSQL_RES } result set 
through @code{mysql_get_metadata()}.

You can supply the result buffers using @code{mysql_bind_result()}, so
that the @code{mysql_fetch()} will automatically return data to these
buffers. This is row-by-row fetching.

@c TODO: I don't understand this para at all.

You can also send the text or binary data in chunks to server using
@code{mysql_send_long_data()}, by specifying the option @code{is_long_data=1}
or @code{length=MYSQL_LONG_DATA} or @code{-2} in the @code{MYSQL_BIND}
structure supplied with @code{mysql_bind_param()}.

When statement execution has been completed, the statement handle must be
closed using @code{mysql_stmt_close()} so that all resources associated
with it can be freed.

If you obtained a @code{SELECT} statement's result set metadata by calling
@code{mysql_get_metadata()}, you should also free it using
@code{mysql_free_result()}.

@subsubheading Execution Steps

To prepare and execute a statement, an application follows these steps:

@enumerate
@item
Call @code{mysql_prepare()} and pass it a string containing the SQL
statement. For a successful prepare operation, @code{mysql_prepare()} returns
a valid statement handle to the application.
@item
If the query produces a result set, call @code{mysql_get_metadata()}
to obtain the result set metadata.  This metadata is itself in the form of
result set, albeit a separate one from the one that contains the rows returned
by the query. The metadata result set indicates how many columns are in the
result and contains information about each column.
@item
Set the values of any parameters using @code{mysql_bind_param()}. All
parameters must be set. Otherwise, query execution will return an error or
produce unexpected results.
@item
Call @code{mysql_execute()} to execute the statement.
@item
If the query produces a result set,
bind the data buffers to use for retrieving the row values by calling
@code{mysql_bind_result()}.
@item
Fetch the data into the buffers row by row by calling @code{mysql_fetch()}
repeatedly until no more rows are found.
@item
Repeat steps 3 through 6 as necessary, by changing the parameter values and
re-executing the statement.

@end enumerate

When @code{mysql_prepare()} is called, the MySQL client/server protocol
performs these actions:

@itemize @bullet
@item
The server parses the query and sends the OK status back to the client by
assigning a statement ID. It also sends total number of parameters,
a column count, and its meta information if it is a result set oriented
query. All syntax and semantics of the query are checked by the server
during this call.
@item
The client uses this statement ID for the further operations, so that the server
can identify the statement from among its pool of statements. The client also
allocates a statement handle with this ID and returns the handle to the
application.
@end itemize

When @code{mysql_execute()} is called, the MySQL client/server protocol
performs these actions:

@itemize @bullet
@item
The client uses the statement handle and sends the parameter data to the
server.
@item
The server identifies the statement using the ID provided by the client,
replaces the parameter markers with the newly supplied data, and executes
the query. If the query produces a result set, the server sends the data back to
the client. Otherwise, it sends an OK status and total number of rows
changed, deleted, or inserted.
@end itemize

When @code{mysql_fetch()} is called, the MySQL client/server protocol
performs these actions:

@itemize @bullet
@item
The client reads the data from the packet row by row and places it into the
application data buffers by doing the necessary conversions. If the
application buffer type is same as that of the field type returned from the
server, the conversions are straightforward.
@end itemize

You can get the statement error code, error message, and SQLSTATE value using
@code{mysql_stmt_errno()}, @code{mysql_stmt_error()}, and
@code{mysql_stmt_sqlstate()}, respectively.


@node C API Prepared statement functions, C API multiple queries, C API Prepared statement function overview, C
@subsection C API Prepared Statement Function Descriptions

To prepare and execute queries, use the following functions.


@menu
* mysql_bind_param::            @code{mysql_bind_param()}
* mysql_bind_result::           @code{mysql_bind_result()}
* mysql_execute::               @code{mysql_execute()}
* mysql_fetch::                 @code{mysql_fetch()}
* mysql_fetch_column::          @code{mysql_fetch_column()}
* mysql_get_metadata::          @code{mysql_get_metadata()}
* mysql_param_count::           @code{mysql_param_count()}
* mysql_param_result::          @code{mysql_param_result()}
* mysql_prepare::               @code{mysql_prepare()}
* mysql_send_long_data::        @code{mysql_send_long_data()}
* mysql_stmt_affected_rows::    @code{mysql_stmt_affected_rows()}
* mysql_stmt_close::            @code{mysql_stmt_close()}
* mysql_stmt_data_seek::        @code{mysql_stmt_data_seek()}
* mysql_stmt_errno::            @code{mysql_stmt_errno()}
* mysql_stmt_error::            @code{mysql_stmt_error()}
* mysql_stmt_free_result::      @code{mysql_stmt_free_result()}
* mysql_stmt_num_rows::         @code{mysql_stmt_num_rows()}
* mysql_stmt_reset::            @code{mysql_stmt_reset()}
* mysql_stmt_row_seek::         @code{mysql_stmt_row_seek()}
* mysql_stmt_row_tell::         @code{mysql_stmt_row_tell()}
* mysql_stmt_sqlstate::         @code{mysql_stmt_sqlstate()}
* mysql_stmt_store_result::     @code{mysql_stmt_store_result()}
@end menu


@node mysql_bind_param, mysql_bind_result, C API Prepared statement functions, C API Prepared statement functions
@subsubsection @code{mysql_bind_param()}

@findex @code{mysql_bind_param()}

@code{my_bool mysql_bind_param(MYSQL_STMT *stmt, MYSQL_BIND *bind)}

@subsubheading Description

@code{mysql_bind_param()} is used to bind data for the parameter markers
in the SQL statement that was passed to @code{mysql_prepare()}. It uses
@code{MYSQL_BIND} structures to supply the data. @code{bind} is the address
of an array of @code{MYSQL_BIND} structures.
The client library expects the array to contain an element for each
@samp{?} parameter marker that is present in the query.

Suppose you prepare the following statment:

@example
INSERT INTO mytbl VALUES(?,?,?)
@end example

When you bind the parameters, the array of @code{MYSQL_BIND} structures must
contain three elements, and can be declared like this:

@example
MYSQL_BIND bind[3];
@end example

The members of each @code{MYSQL_BIND} element that should be set are described
in @ref{C API Prepared statement datatypes}.

@subsubheading Return Values

Zero if the bind was successful. Non-zero if an error occurred.

@subsubheading Errors
@table @code
@item CR_NO_PREPARE_STMT
No prepared statement exists.
@item CR_NO_PARAMETERS_EXISTS
No parameters exist to bind.
@item CR_INVALID_BUFFER_USE
Indicates if the bind is to supply the long data in chunks and if the
buffer type is non string or binary.
@item CR_UNSUPPORTED_PARAM_TYPE
The conversion is not supported. Possibly the @code{buffer_type} value is
illegal or is not one of the supported types.
@item CR_OUT_OF_MEMORY
Out of memory.
@item CR_UNKNOWN_ERROR
An unknown error occurred.
@end table

@subsubheading Example

For the usage of @code{mysql_bind_param()}, refer to the Example from
@ref{mysql_execute, , @code{mysql_execute()}}.


@node mysql_bind_result, mysql_execute, mysql_bind_param, C API Prepared statement functions
@subsubsection @code{mysql_bind_result()}

@findex @code{mysql_bind_result()}

@code{my_bool mysql_bind_result(MYSQL_STMT *stmt, MYSQL_BIND *bind)}

@subsubheading Description

@code{mysql_bind_result()} is used to associate (bind) columns in the
result set to data buffers and length buffers. When @code{mysql_fetch()} is
called to fetch data, the MySQL client/server protocol places the data for the
bound columns into the specified buffers.

Note that all columns must be bound to buffers prior to calling
@code{mysql_fetch()}.
@code{bind} is the address of an array of @code{MYSQL_BIND} structures.
The client library expects the array to contain
an element for each column of the result set.
Otherwise, @code{mysql_fetch()} simply ignores
the data fetch. Also, the buffers should be large enough to hold the
data values, because the protocol doesn't return data values in chunks.

A column can be bound or rebound at any time, even after a result set has been
partially retrieved.  The new binding takes effect the next time
@code{mysql_fetch()} is called. Suppose an application binds
the columns in a result set and calls @code{mysql_fetch()}. The client/server
protocol returns data in the bound buffers. Then suppose the application
binds the columns to a different set of buffers. The protocol does
not place data into the newly bound
buffers until the next call to @code{mysql_fetch()} occurs.

To bind a column, an application calls @code{mysql_bind_result()} and
passes the type, address, and the address of the length buffer.
The members of each @code{MYSQL_BIND} element that should be set are described
in @ref{C API Prepared statement datatypes}.

@subsubheading Return Values

Zero if the bind was successful. Non-zero if an error occurred.

@subsubheading Errors

@table @code
@item CR_NO_PREPARE_STMT
No prepared statement exists.
@item CR_UNSUPPORTED_PARAM_TYPE
The conversion is not supported. Possibly the @code{buffer_type} value is
illegal or is not one of the supported types.
@item CR_OUT_OF_MEMORY
Out of memory.
@item CR_UNKNOWN_ERROR
An unknown error occurred.
@end table

@subsubheading Example

For the usage of @code{mysql_bind_result()}, refer to the Example from
@ref{mysql_fetch, , @code{mysql_fetch()}}.


@node mysql_execute, mysql_fetch, mysql_bind_result, C API Prepared statement functions
@subsubsection @code{mysql_execute()}

@findex @code{mysql_execute()}

@code{int mysql_execute(MYSQL_STMT *stmt)}

@subsubheading Description

@code{mysql_execute()} executes the prepared query associated with the
statement handle. The currently bound parameter marker values are sent
to server during this call, and the server replaces the markers with this newly
supplied data.

@c TODO: what about REPLACE?

If the statement is an @code{UPDATE}, @code{DELETE}, or @code{INSERT},
the total number of
changed, deleted, or inserted rows can be found by calling
@code{mysql_stmt_affected_rows()}. If this is a result set query such as
@code{SELECT}, you
must call @code{mysql_fetch()} to fetch the data prior to calling any
other functions that result in query processing. For more information on
how to fetch the results, refer to
@ref{mysql_fetch, , @code{mysql_fetch()}}.
 
@subsubheading Return Values

Zero if execution was successful. Non-zero if an error occurred.
The error code and message can be obtained by calling @code{mysql_stmt_errno()}
and @code{mysql_stmt_error()}.

@subsubheading Errors

@table @code
@item CR_NO_PREPARE_QUERY
No query prepared prior to execution.
@item CR_ALL_PARAMS_NOT_BOUND
Not all parameter data is supplied.
@item CR_COMMANDS_OUT_OF_SYNC 
Commands were executed in an improper order. 
@item CR_OUT_OF_MEMORY 
Out of memory. 
@item CR_SERVER_GONE_ERROR 
The MySQL server has gone away. 
@item CR_SERVER_LOST 
The connection to the server was lost during the query. 
@item CR_UNKNOWN_ERROR 
An unknown error occurred. 
@end table

@subsubheading Example

The following example demonstrates how to create and populate a table using
@code{mysql_prepare()},
@code{mysql_param_count()}, @code{mysql_bind_param()}, @code{mysql_execute()},
and @code{mysql_stmt_affected_rows()}. The @code{mysql} variable is assumed
to be a valid connection handle.

@example
#define STRING_SIZE 50

#define DROP_SAMPLE_TABLE "DROP TABLE IF EXISTS test_table"
#define CREATE_SAMPLE_TABLE "CREATE TABLE test_table(col1 INT,\
                                                 col2 VARCHAR(40),\
                                                 col3 SMALLINT,\
                                                 col4 TIMESTAMP)"
#define INSERT_SAMPLE "INSERT INTO test_table(col1,col2,col3) VALUES(?,?,?)"

MYSQL_STMT    *stmt;
MYSQL_BIND    bind[3];
my_ulonglong  affected_rows;
int           param_count;
short         small_data;
int           int_data;
char          str_data[STRING_SIZE];
unsigned long str_length;
my_bool       is_null;

if (mysql_query(mysql, DROP_SAMPLE_TABLE))
@{
  fprintf(stderr, " DROP TABLE failed\n");
  fprintf(stderr, " %s\n", mysql_error(mysql));
  exit(0);
@}

if (mysql_query(mysql, CREATE_SAMPLE_TABLE))
@{
  fprintf(stderr, " CREATE TABLE failed\n");
  fprintf(stderr, " %s\n", mysql_error(mysql));
  exit(0);
@}

/* Prepare an INSERT query with 3 parameters */
/* (the TIMESTAMP column is not named; it will */
/* be set to the current date and time) */
stmt = mysql_prepare(mysql, INSERT_SAMPLE, strlen(INSERT_SAMPLE));
if (!stmt)
@{
  fprintf(stderr, " mysql_prepare(), INSERT failed\n");
  fprintf(stderr, " %s\n", mysql_error(mysql));
  exit(0);
@}
fprintf(stdout, " prepare, INSERT successful\n");

/* Get the parameter count from the statement */
param_count= mysql_param_count(stmt);
fprintf(stdout, " total parameters in INSERT: %d\n", param_count);

if (param_count != 3) /* validate parameter count */
@{
  fprintf(stderr, " invalid parameter count returned by MySQL\n");
  exit(0);
@}

/* Bind the data for all 3 parameters */

/* INTEGER PARAM */
/* This is a number type, so there is no need to specify buffer_length */
bind[0].buffer_type= MYSQL_TYPE_LONG;
bind[0].buffer= (char *)&int_data;
bind[0].is_null= 0;
bind[0].length= 0;

/* STRING PARAM */
bind[1].buffer_type= MYSQL_TYPE_VAR_STRING;
bind[1].buffer= (char *)str_data;
bind[1].buffer_length= STRING_SIZE;
bind[1].is_null= 0;
bind[1].length= &str_length;
 
/* SMALLINT PARAM */
bind[2].buffer_type= MYSQL_TYPE_SHORT;
bind[2].buffer= (char *)&small_data;       
bind[2].is_null= &is_null;
bind[2].length= 0;

/* Bind the buffers */
if (mysql_bind_param(stmt, bind))
@{
  fprintf(stderr, " mysql_bind_param() failed\n");
  fprintf(stderr, " %s\n", mysql_stmt_error(stmt));
  exit(0);
@}

/* Specify the data values for the first row */
int_data= 10;             /* integer */
strncpy(str_data, "MySQL", STRING_SIZE); /* string  */
str_length= strlen(str_data);

/* INSERT SMALLINT data as NULL */
is_null= 1;

/* Execute the INSERT statement - 1*/
if (mysql_execute(stmt))
@{
  fprintf(stderr, " mysql_execute(), 1 failed\n");
  fprintf(stderr, " %s\n", mysql_stmt_error(stmt));
  exit(0);
@}
  
/* Get the total number of affected rows */   
affected_rows= mysql_stmt_affected_rows(stmt);
fprintf(stdout, " total affected rows(insert 1): %ld\n", affected_rows);

if (affected_rows != 1) /* validate affected rows */
@{
  fprintf(stderr, " invalid affected rows by MySQL\n");
  exit(0);
@}

/* Specify data values for second row, then re-execute the statement */
int_data= 1000;             
strncpy(str_data, "The most popular open source database", STRING_SIZE); 
str_length= strlen(str_data);
small_data= 1000;         /* smallint */
is_null= 0;               /* reset */

/* Execute the INSERT statement - 2*/
if (mysql_execute(stmt))
@{
  fprintf(stderr, " mysql_execute, 2 failed\n");
  fprintf(stderr, " %s\n", mysql_stmt_error(stmt));
  exit(0);
@}
  
/* Get the total rows affected */   
affected_rows= mysql_stmt_affected_rows(stmt);
fprintf(stdout, " total affected rows(insert 2): %ld\n", affected_rows);

if (affected_rows != 1) /* validate affected rows */
@{
  fprintf(stderr, " invalid affected rows by MySQL\n");
  exit(0);
@}

/* Close the statement */
if (mysql_stmt_close(stmt))
@{
  fprintf(stderr, " failed while closing the statement\n");
  fprintf(stderr, " %s\n", mysql_stmt_error(stmt));
  exit(0);
@}
@end example

@strong{Note:} For complete examples on the use of prepared
statement functions, refer to the file @file{tests/client_test.c}.
This file can be obtained from a MySQL source distribution or from the
BitKeeper source repository.


@node mysql_fetch, mysql_fetch_column, mysql_execute, C API Prepared statement functions
@subsubsection @code{mysql_fetch()}

@findex @code{mysql_fetch()}

@code{int mysql_fetch(MYSQL_STMT *stmt)}

@subsubheading Description

@code{mysql_fetch()} returns the next row in the result set. It can
be called only while the result set exists, that is, after a call to
@code{mysql_execute()} that creates a result set or after
@code{mysql_stmt_store_result()}, which is called after
@code{mysql_execute()} to buffer the entire result set.

@code{mysql_fetch()} returns row data using the buffers bound by
@code{mysql_bind_result()}. It returns
the data in those buffers for all the columns in the current row
set and the lengths are returned to the @code{length} pointer.

Note that all columns must be bound by the application before calling
@code{mysql_fetch()}.

If a fetched data value is a @code{NULL} value, the @code{*is_null}
value of the corresponding @code{MYSQL_BIND} structure contains TRUE
(1). Otherwise, the data and its length are returned in the @code{*buffer}
and @code{*length} elements based on the buffer type specified by the
application. Each numeric and temporal type has a fixed length,
as listed in the following table.
The length of the string types depends on the length of the actual data value,
as indicated by @code{data_length}.


@multitable @columnfractions .40 .40
@item @strong{Type}                 @tab @strong{Length} 
@item @code{MYSQL_TYPE_TINY}        @tab 1
@item @code{MYSQL_TYPE_SHORT}       @tab 2
@item @code{MYSQL_TYPE_LONG}        @tab 4
@item @code{MYSQL_TYPE_LONGLONG}    @tab 8
@item @code{MYSQL_TYPE_FLOAT}       @tab 4
@item @code{MYSQL_TYPE_DOUBLE}      @tab 8
@item @code{MYSQL_TYPE_TIME}        @tab @code{sizeof(MYSQL_TIME)}
@item @code{MYSQL_TYPE_DATE}        @tab @code{sizeof(MYSQL_TIME)}
@item @code{MYSQL_TYPE_DATETIME}    @tab @code{sizeof(MYSQL_TIME)}
@item @code{MYSQL_TYPE_TIMESTAMP}   @tab @code{sizeof(MYSQL_TIME)}
@item @code{MYSQL_TYPE_STRING}      @tab @code{data length}
@item @code{MYSQL_TYPE_VAR_STRING}  @tab @code{data_length}
@item @code{MYSQL_TYPE_TINY_BLOB}   @tab @code{data_length}
@item @code{MYSQL_TYPE_BLOB}        @tab @code{data_length}
@item @code{MYSQL_TYPE_MEDIUM_BLOB} @tab @code{data_length}
@item @code{MYSQL_TYPE_LONG_BLOB}   @tab @code{data_length}
@end multitable

@subsubheading Return Values

@multitable @columnfractions .30 .65
@item @strong{Return Value}         @tab @strong{Description}
@item 0            @tab Successful, the data has been
fetched to application data buffers.
@item 1            @tab Error occurred. Error code and
message can be obtained by calling @code{mysql_stmt_errno()} and @code{mysql_stmt_error()}.
@item @code{MYSQL_NO_DATA}           @tab No more rows/data exists
@end multitable


@subsubheading Errors
@table @code
@item CR_COMMANDS_OUT_OF_SYNC 
Commands were executed in an improper order. 
@item CR_OUT_OF_MEMORY 
Out of memory. 
@item CR_SERVER_GONE_ERROR 
The MySQL server has gone away. 
@item CR_SERVER_LOST 
The connection to the server was lost during the query. 
@item CR_UNKNOWN_ERROR 
An unknown error occurred. 
@item CR_UNSUPPORTED_PARAM_TYPE
The buffer type is
@code{MYSQL_TYPE_DATE},
@code{MYSQL_TYPE_TIME},
@code{MYSQL_TYPE_DATETIME},
or
@code{MYSQL_TYPE_TIMESTAMP},
but the datatype is not @code{DATE}, @code{TIME}, @code{DATETIME}, or
@code{TIMESTAMP}.
@item
All other unsupported conversion errors are returned from
@code{mysql_bind_result()}.
@end table

@c TODO: need to document allowed conversions in both directions

@subsubheading Example

The following example demonstrates how to fetch data from a table using
 @code{mysql_get_metadata()},
@code{mysql_bind_result()}, and @code{mysql_fetch()}.
(This example expects to retrieve the two rows inserted by the example shown
in @ref{mysql_execute, , @code{mysql_execute()}}.)
The @code{mysql} variable is assumed to be a valid connection handle.

@example
#define STRING_SIZE 50

#define SELECT_SAMPLE "SELECT col1, col2, col3, col4 FROM test_table"

MYSQL_STMT    *stmt;
MYSQL_BIND    bind[4];
MYSQL_RES     *prepare_meta_result;
MYSQL_TIME    ts;
unsigned long length[4];
int           param_count, column_count, row_count;
short         small_data;
int           int_data;
char          str_data[STRING_SIZE];
my_bool       is_null[4];

/* Prepare a SELECT query to fetch data from test_table */
stmt = mysql_prepare(mysql, SELECT_SAMPLE, strlen(SELECT_SAMPLE));
if (!stmt)
@{
  fprintf(stderr, " mysql_prepare(), SELECT failed\n");
  fprintf(stderr, " %s\n", mysql_error(mysql));
  exit(0);
@}
fprintf(stdout, " prepare, SELECT successful\n");

/* Get the parameter count from the statement */
param_count= mysql_param_count(stmt);
fprintf(stdout, " total parameters in SELECT: %d\n", param_count);

if (param_count != 0) /* validate parameter count */
@{
  fprintf(stderr, " invalid parameter count returned by MySQL\n");
  exit(0);
@}

/* Fetch result set meta information */
prepare_meta_result = mysql_get_metadata(stmt);
if (!prepare_meta_result)
@{
  fprintf(stderr, " mysql_get_metadata(), returned no meta information\n");
  fprintf(stderr, " %s\n", mysql_stmt_error(stmt));
  exit(0);
@}

/* Get total columns in the query */
column_count= mysql_num_fields(prepare_meta_result);
fprintf(stdout, " total columns in SELECT statement: %d\n", column_count);

if (column_count != 4) /* validate column count */
@{
  fprintf(stderr, " invalid column count returned by MySQL\n");
  exit(0);
@}

/* Execute the SELECT query */
if (mysql_execute(stmt))
@{
  fprintf(stderr, " mysql_execute(), failed\n");
  fprintf(stderr, " %s\n", mysql_stmt_error(stmt));
  exit(0);
@}

/* Bind the result buffers for all 4 columns before fetching them */

/* INTEGER COLUMN */
bind[0].buffer_type= MYSQL_TYPE_LONG;
bind[0].buffer= (char *)&int_data;
bind[0].is_null= &is_null[0];
bind[0].length= &length[0];

/* STRING COLUMN */
bind[1].buffer_type= MYSQL_TYPE_VAR_STRING;
bind[1].buffer= (char *)str_data;
bind[1].buffer_length= STRING_SIZE;
bind[1].is_null= &is_null[1];
bind[1].length= &length[1];
 
/* SMALLINT COLUMN */
bind[2].buffer_type= MYSQL_TYPE_SHORT;
bind[2].buffer= (char *)&small_data;       
bind[2].is_null= &is_null[2];
bind[2].length= &length[2];
 
/* TIMESTAMP COLUMN */
bind[3].buffer_type= MYSQL_TYPE_TIMESTAMP;
bind[3].buffer= (char *)&ts;       
bind[3].is_null= &is_null[3];
bind[3].length= &length[3];

/* Bind the result buffers */
if (mysql_bind_result(stmt, bind))
@{
  fprintf(stderr, " mysql_bind_result() failed\n");
  fprintf(stderr, " %s\n", mysql_stmt_error(stmt));
  exit(0);
@}

/* Now buffer all results to client */
if (mysql_stmt_store_result(stmt))
@{
  fprintf(stderr, " mysql_stmt_store_result() failed\n");
  fprintf(stderr, " %s\n", mysql_stmt_error(stmt));
  exit(0);
@}

/* Fetch all rows */
row_count= 0;
fprintf(stdout, "Fetching results ...\n");
while (!mysql_fetch(stmt))
@{
  row_count++;
  fprintf(stdout, "  row %d\n", row_count);

  /* column 1 */
  fprintf(stdout, "   column1 (integer)  : ");
  if (is_null[0])
    fprintf(stdout, " NULL\n");
  else
    fprintf(stdout, " %d(%ld)\n", int_data, length[0]);

  /* column 2 */
  fprintf(stdout, "   column2 (string)   : ");
  if (is_null[1])
    fprintf(stdout, " NULL\n");
  else
    fprintf(stdout, " %s(%ld)\n", str_data, length[1]);

  /* column 3 */
  fprintf(stdout, "   column3 (smallint) : ");
  if (is_null[2])
    fprintf(stdout, " NULL\n");
  else
    fprintf(stdout, " %d(%ld)\n", small_data, length[2]);

  /* column 4 */
  fprintf(stdout, "   column4 (timestamp): ");
  if (is_null[3])
    fprintf(stdout, " NULL\n");
  else
    fprintf(stdout, " %04d-%02d-%02d %02d:%02d:%02d (%ld)\n",
                                               ts.year, ts.month, ts.day,
                                               ts.hour, ts.minute, ts.second,
                                               length[3]);
  fprintf(stdout, "\n");
@}

/* Validate rows fetched */
fprintf(stdout, " total rows fetched: %d\n", row_count);
if (row_count != 2)
@{
  fprintf(stderr, " MySQL failed to return all rows\n");
  exit(0);
@} 

/* Free the prepared result metadata */
mysql_free_result(prepare_meta_result);


/* Close the statement */
if (mysql_stmt_close(stmt))
@{
  fprintf(stderr, " failed while closing the statement\n");
  fprintf(stderr, " %s\n", mysql_stmt_error(stmt));
  exit(0);
@}
@end example


@node mysql_fetch_column, mysql_get_metadata, mysql_fetch, C API Prepared statement functions
@subsubsection @code{mysql_fetch_column()}

@findex @code{mysql_fetch_column()}

@code{int mysql_fetch_column(MYSQL_STMT *stmt, MYSQL_BIND *bind, unsigned int column, unsigned long offset)}

@c TODO: fill this in
To be added.

@subsubheading Description


@subsubheading Return Values


@subsubheading Errors


@node mysql_get_metadata, mysql_param_count, mysql_fetch_column, C API Prepared statement functions
@subsubsection @code{mysql_get_metadata()}

@findex @code{mysql_get_metadata}.

@code{MYSQL_RES *mysql_get_metadata(MYSQL_STMT *stmt)}

@subsubheading Description

If a statement passed to @code{mysql_prepare()} is one that produces a result
set,
@code{mysql_get_metadata()} returns the result set metadata in the form of a
pointer to a
@code{MYSQL_RES} structure that can be used to process the
meta information such as total number of fields and individual field
information. This result set pointer can be passed as an argument to
any of the field-based API functions that process result set metadata, such
as:

@itemize @bullet
@item @code{mysql_num_fields()}
@item @code{mysql_fetch_field()}
@item @code{mysql_fetch_field_direct()}
@item @code{mysql_fetch_fields()}
@item @code{mysql_field_count()}
@item @code{mysql_field_seek()}
@item @code{mysql_field_tell()}
@item @code{mysql_free_result()}
@end itemize

The result set structure should be freed when you are done with it, which
you can do by passing it to @code{mysql_free_result()}. This is similar
to the way you free a result set obtained from a call to
@code{mysql_store_result()}.

The result set returned by @code{mysql_get_metadata()} contains only
metadata. It does not contain any row results. The rows are obtained by using
the statement handle with @code{mysql_fetch()}.


@subsubheading Return Values

A @code{MYSQL_RES} result structure. @code{NULL} if no meta information exists
for the prepared query.


@subsubheading Errors

@table @code
@item CR_OUT_OF_MEMORY
Out of memory.
@item CR_UNKNOWN_ERROR
An unknown error occurred.
@end table


@subsubheading Example

For the usage of @code{mysql_get_metadata()}, refer to the Example from
@ref{mysql_fetch, , @code{mysql_fetch()}}.


@node mysql_param_count, mysql_param_result, mysql_get_metadata, C API Prepared statement functions
@subsubsection @code{mysql_param_count()}

@findex @code{mysql_param_count()}

@code{unsigned long mysql_param_count(MYSQL_STMT *stmt)}

@subsubheading Description

Returns the number of parameter markers present in the prepared statement.

@subsubheading Return Values

An unsigned long integer representing the number of parameters in a
statement.

@subsubheading Errors

None.

@subsubheading Example

For the usage of @code{mysql_param_count()}, refer to the Example from
@ref{mysql_execute, , @code{mysql_execute()}}.


@node mysql_param_result, mysql_prepare, mysql_param_count, C API Prepared statement functions
@subsubsection @code{mysql_param_result()}

@findex @code{mysql_param_result()}

@code{MYSQL_RES *mysql_param_result(MYSQL_STMT *stmt)}

@c TODO: fill this in
To be added.

@subsubheading Description


@subsubheading Return Values


@subsubheading Errors


@node mysql_prepare, mysql_send_long_data, mysql_param_result, C API Prepared statement functions
@subsubsection @code{mysql_prepare()}

@findex @code{mysql_prepare()}

@code{MYSQL_STMT * mysql_prepare(MYSQL *mysql, const char *query, unsigned
long length)}

@subsubheading Description

Prepares the SQL query pointed to by the null-terminated string
@code{query}, and returns a statement handle to be used for further operations
on the statement. The query must consist of a single SQL statement. You should
not add a terminating semicolon (@samp{;}) or @code{\g} to the statement.

The application can include one or more parameter markers in the SQL
statement by embedding question mark (@samp{?}) characters into the SQL
string at the appropriate positions.

The markers are legal only in certain places in SQL statements. For
example, they are allowed in the @code{VALUES()} list of an @code{INSERT}
statement (to specify column values for a row), or in a comparison with a
column in a @code{WHERE} clause to specify a comparison value.
However, they are not allowed for identifiers (such as table or column
names), in the select list that names the columns to
be returned by a @code{SELECT} statement), or to specify both
operands of a binary operator such as the @code{=} equal sign.
The latter restriction is necessary because it
would be impossible to determine the parameter type. In general,
parameters are legal only in Data Manipulation Languange (DML)
statements, and not in Data Defination Language (DDL) statements.

The parameter markers must be bound to application variables using
@code{mysql_bind_param()} before executing the statement.


@subsubheading Return Values

A pointer to a @code{MYSQL_STMT} structure if the prepare was successful.
@code{NULL} if an error occurred.

@subsubheading Errors

@table @code
@item CR_COMMANDS_OUT_OF_SYNC
Commands were executed in an improper order.
@item CR_OUT_OF_MEMORY
Out of memory.
@item CR_SERVER_GONE_ERROR
The MySQL server has gone away.
@item CR_SERVER_LOST
The connection to the server was lost during the query
@item CR_UNKNOWN_ERROR
An unknown error occurred.
@end table

If the prepare is not successful (that is, @code{mysql_prepare()} returns
@code{NULL}), the error message can be obtained by calling
@code{mysql_error()}. 


@subsubheading Example

For the usage of @code{mysql_prepare()}, refer to the Example from
@ref{mysql_execute, , @code{mysql_execute()}}.


@node mysql_send_long_data, mysql_stmt_affected_rows, mysql_prepare, C API Prepared statement functions
@subsubsection @code{mysql_send_long_data()}

@findex @code{mysql_send_long_data()}.

@code{my_bool mysql_send_long_data(MYSQL_STMT *stmt, unsigned int
parameter_number, const char *data, unsigned long length)}

@subsubheading Description

Allows an application to send parameter data to the server in pieces
(or ``chunks'').
This function can be called multiple times to send the parts of a
character or binary data value for a column, which must be one of the
@code{TEXT} or @code{BLOB} datatypes.

@code{parameter_number} indicates which parameter to associate the data with.
Parameters are numbered beginning with 0.
@code{data} is a pointer to a buffer containing data to be sent, and
@code{length} indicates the number of bytes in the buffer.

@subsubheading Return Values

Zero if the data is sent successfully to server. Non-zero if an error
occurred.

@subsubheading Errors

@table @code
@item CR_INVALID_PARAMETER_NO
Invalid parameter number.
@item CR_COMMANDS_OUT_OF_SYNC
Commands were executed in an improper order.
@item CR_SERVER_GONE_ERROR
The MySQL server has gone away.
@item CR_OUT_OF_MEMORY
Out of memory.
@item CR_UNKNOWN_ERROR
An unknown error occurred.
@end table

@subsubheading Example
The following example demonstrates how to send the data for a
@code{TEXT} column in chunks.  It inserts the data value
@code{'MySQL - The most popular open source database'}
into the @code{text_column} column.
The @code{mysql} variable is assumed to be a valid connection handle.

@c TODO: replace this example?

@example
#define INSERT_QUERY "INSERT INTO test_long_data(text_column) VALUES(?)"
  
MYSQL_BIND bind[1];
long       length;

if (!mysql_prepare(mysql, INSERT_QUERY, strlen(INSERT_QUERY))
@{
  fprintf(stderr, "\n prepare failed");
  fprintf(stderr, "\n %s", mysql_error(mysql));
  exit(0);
@}
 memset(bind, 0, sizeof(bind));
 bind[0].buffer_type= MYSQL_TYPE_STRING;
 bind[0].length= &length;
 bind[0].is_null= 0;

/* Bind the buffers */
if (mysql_bind_param(stmt, bind))
@{
  fprintf(stderr, "\n param bind failed");
  fprintf(stderr, "\n %s", mysql_stmt_error(stmt));
  exit(0);
@}

 /* Supply data in chunks to server */
 if (!mysql_send_long_data(stmt,0,"MySQL",5))
@{
  fprintf(stderr, "\n send_long_data failed");
  fprintf(stderr, "\n %s", mysql_stmt_error(stmt));
  exit(0);
@}

 /* Supply the next piece of data */
 if (mysql_send_long_data(stmt,0," - The most popular open source database",40))
@{
  fprintf(stderr, "\n send_long_data failed");
  fprintf(stderr, "\n %s", mysql_stmt_error(stmt));
  exit(0);
@}

 /* Now, execute the query */
 if (mysql_execute(stmt))
@{
  fprintf(stderr, "\n mysql_execute failed");
  fprintf(stderr, "\n %s", mysql_stmt_error(stmt));
  exit(0);
@}
@end example


@node mysql_stmt_affected_rows, mysql_stmt_close, mysql_send_long_data, C API Prepared statement functions
@subsubsection @code{mysql_stmt_affected_rows()}

@findex @code{mysql_stmt_affected_rows()}

@code{my_ulonglong mysql_stmt_affected_rows(MYSQL_STMT *stmt)}

@subsubheading Description

Returns the total number of rows changed, deleted, or inserted by the last
executed statement. May be called immediatlely after @code{mysql_execute()}
for @code{UPDATE}, @code{DELETE}, or @code{INSERT} statements. For
@code{SELECT} statements, @code{mysql_stmt_affected_rows()} works like
@code{mysql_num_rows()}.

@c TODO: For SELECT, are there any caveats on when you must wait to call
@c this function, such as after all the rows have been fetched or after
@c calling mysql_stmt_store_result()?

@subsubheading Return Values

An integer greater than zero indicates the number of rows affected
or retrieved. Zero indicates that no records were updated for an
@code{UPDATE} statement, no rows matched the @code{WHERE} clause in
the query, or that no query has yet been executed. @minus{}1 indicates that
the query returned an error or that, for a @code{SELECT} query,
@code{mysql_stmt_affected_rows()} was called prior to calling
@code{mysql_stmt_store_result()}.
Because @code{mysql_stmt_affected_rows()}
returns an unsigned value, you can check for @minus{}1 by comparing the
return value to @code{(my_ulonglong)-1} (or to @code{(my_ulonglong)~0},
which is equivalent).

@subsubheading Errors

None.

@subsubheading Example

For the usage of @code{mysql_stmt_affected_rows()}, refer to the Example
from @ref{mysql_execute, , @code{mysql_execute()}}.


@node mysql_stmt_close, mysql_stmt_data_seek, mysql_stmt_affected_rows, C API Prepared statement functions
@subsubsection @code{mysql_stmt_close()}

@findex @code{mysql_stmt_close()}

@code{my_bool mysql_stmt_close(MYSQL_STMT *)}

@subsubheading Description

Closes the prepared statement. @code{mysql_stmt_close()} also
deallocates the statement handle pointed to by @code{stmt}. 

If the current statement has pending or unread results, this function
cancels them so that the next query can be executed.

@subsubheading Return Values

Zero if the statement was freed successfully. Non-zero if an error occurred.

@subsubheading Errors

@table @code
@item CR_SERVER_GONE_ERROR
The MySQL server has gone away.
@item CR_UNKNOWN_ERROR
An unknown error occurred.
@end table

@subsubheading Example

For the usage of @code{mysql_stmt_close()}, refer to the Example from
@ref{mysql_execute, , @code{mysql_execute()}}.


@node mysql_stmt_data_seek, mysql_stmt_errno, mysql_stmt_close, C API Prepared statement functions
@subsubsection @code{mysql_stmt_data_seek()}

@findex @code{mysql_stmt_data_seek()}

@code{void mysql_stmt_data_seek(MYSQL_STMT *stmt, my_ulonglong offset)}

@subsubheading Description
Seeks to an arbitrary row in a statement result set.  The @code{offset}
value is a row number and should be in the range from @code{0} to
@code{mysql_stmt_num_rows(stmt)-1}.

@c TODO: this para may not make sense. It's written in parallel with
@c mysql_data_seek(), but there is no corresponding mysql_stmt_use_result().

This function requires that the statement result set structure
contains the entire result of the last executed query, so
@code{mysql_stmt_data_seek()} may be used only in conjunction with
@code{mysql_stmt_store_result()}.


@subsubheading Return Values

None.

@subsubheading Errors
None.


@node mysql_stmt_errno, mysql_stmt_error, mysql_stmt_data_seek, C API Prepared statement functions
@subsubsection @code{mysql_stmt_errno()}

@findex @code{mysql_stmt_errno()}

@code{unsigned int mysql_stmt_errno(MYSQL_STMT *stmt)}

@subsubheading Description

For the statement specified by @code{stmt}, @code{mysql_stmt_errno()}
returns the error code for the most recently invoked statement API
function that can succeed or fail. A return value of zero means that no
error occurred.  Client error
message numbers are listed in the MySQL @file{errmsg.h} header file.
Server error message numbers are listed in @file{mysqld_error.h}. In the
MySQL source distribution you can find a complete list of
error messages and error numbers in the file @file{Docs/mysqld_error.txt}.
The server error codes also are listed at @ref{Error-returns}.

@subsubheading Return Values

An error code value. Zero if no error occurred.

@subsubheading Errors

None.


@node mysql_stmt_error, mysql_stmt_free_result, mysql_stmt_errno, C API Prepared statement functions
@subsubsection @code{mysql_stmt_error()}

@findex @code{mysql_stmt_error()}.

@code{const char *mysql_stmt_error(MYSQL_STMT *stmt)}

@subsubheading Description

For the statement specified by @code{stmt}, @code{mysql_stmt_error()}
returns a null-terminated string containing the error message for the most recently invoked statement API
function that can succeed or fail. An empty string (@code{""}) is returned
if no error occurred. This means the following two tests are equivalent:

@example

if (mysql_stmt_errno(stmt))
@{
  // an error occurred
@}

if (mysql_stmt_error(stmt)[0])
@{
  // an error occurred
@}
@end example

The language of the client error messages may be changed by recompiling
the MySQL client library. Currently you can choose error messages in
several different languages.

@subsubheading Return Values

A character string that describes the error. An empty string if no error
occurred.

@subsubheading Errors

None.


@node mysql_stmt_free_result, mysql_stmt_num_rows, mysql_stmt_error, C API Prepared statement functions
@subsubsection @code{mysql_stmt_free_result()}

@findex @code{mysql_stmt_free_result()}

@code{my_bool mysql_stmt_free_result(MYSQL_STMT *stmt)}

@c TODO: fill this in
To be added.

@subsubheading Description


@subsubheading Return Values


@subsubheading Errors


@node mysql_stmt_num_rows, mysql_stmt_reset, mysql_stmt_free_result, C API Prepared statement functions
@subsubsection @code{mysql_stmt_num_rows()}

@findex @code{mysql_stmt_num_rows()}

@code{my_ulonglong mysql_stmt_num_rows(MYSQL_STMT *stmt)}

@subsubheading Description

Returns the number of rows in the result set.

The use of @code{mysql_stmt_num_rows()} depends on whether or not you used
@code{mysql_stmt_store_result()} to buffer the entire result set in the
statement handle.

If you use @code{mysql_stmt_store_result()}, @code{mysql_stmt_num_rows()} may be
called immediately.

@c TODO: and otherwise? Only after all rows have been fetched?

@subsubheading Return Values

The number of rows in the result set.

@subsubheading Errors
None.


@node mysql_stmt_reset, mysql_stmt_row_seek, mysql_stmt_num_rows, C API Prepared statement functions
@subsubsection @code{mysql_stmt_reset()}

@findex @code{mysql_stmt_reset()}

@code{my_bool mysql_stmt_reset(MYSQL_STMT *stmt)}

@c TODO: fill this in
To be added.

@subsubheading Description


@subsubheading Return Values


@subsubheading Errors


@node mysql_stmt_row_seek, mysql_stmt_row_tell, mysql_stmt_reset, C API Prepared statement functions
@subsubsection @code{mysql_stmt_row_seek()}

@findex @code{mysql_stmt_row_seek()}

@code{MYSQL_ROW_OFFSET mysql_stmt_row_seek(MYSQL_STMT *stmt, MYSQL_ROW_OFFSET offset)}

@subsubheading Description
Sets the row cursor to an arbitrary row in a statement result set.
The @code{offset} value is a row offset that should be a value returned
from @code{mysql_stmt_row_tell()} or from @code{mysql_stmt_row_seek()}.
This value is not a row number; if you want to seek to a row within a
result set by number, use @code{mysql_stmt_data_seek()} instead.

@c TODO: this para may not make sense. It's written in parallel with
@c mysql_data_seek(), but there is no corresponding mysql_stmt_use_result().

This function requires that the result set structure contains the entire
result of the query, so @code{mysql_stmt_row_seek()} may be used only
in conjunction with @code{mysql_stmt_store_result()}.

@subsubheading Return Values

The previous value of the row cursor.  This value may be passed to a
subsequent call to @code{mysql_stmt_row_seek()}.

@subsubheading Errors
None.


@node mysql_stmt_row_tell, mysql_stmt_sqlstate, mysql_stmt_row_seek, C API Prepared statement functions
@subsubsection @code{mysql_stmt_row_tell()}

@findex @code{mysql_stmt_row_tell()}

@code{MYSQL_ROW_OFFSET mysql_stmt_row_tell(MYSQL_STMT *stmt)}

@subsubheading Description

Returns the current position of the row cursor for the last
@code{mysql_fetch()}. This value can be used as an argument to
@code{mysql_stmt_row_seek()}.

You should use @code{mysql_stmt_row_tell()} only after @code{mysql_stmt_store_result()}.

@subsubheading Return Values

The current offset of the row cursor.

@subsubheading Errors
None.


@node mysql_stmt_sqlstate, mysql_stmt_store_result, mysql_stmt_row_tell, C API Prepared statement functions
@subsubsection @code{mysql_stmt_sqlstate()}

@findex @code{mysql_stmt_sqlstate()}

@code{const char *mysql_stmt_sqlstate(MYSQL_STMT *stmt)}

@subsubheading Description

For the statement specified by @code{stmt}, @code{mysql_stmt_sqlstate()}
returns a null-terminated string containing the SQLSTATE error code for the
most recently invoked prepared statement API function that can succeed or fail.
The error code consists of five characters.
@code{"00000"} means ``no error''.
The values are specified by ANSI SQL and ODBC.
For a list of possible values, see @ref{Error-returns}.

Note that not all MySQL errors are yet mapped to SQLSTATE's.
The value @code{"HY000"} (general error) is used
for unmapped errors.

This function was added to MySQL 4.1.1.

@subsubheading Return Values

A null-terminated character string containing the SQLSTATE error code.


@node mysql_stmt_store_result,  , mysql_stmt_sqlstate, C API Prepared statement functions
@subsubsection @code{mysql_stmt_store_result()}

@findex @code{mysql_stmt_store_result()}

@code{int mysql_stmt_store_result(MYSQL_STMT *stmt)}

@subsubheading Description

You must call @code{mysql_stmt_store_result()} for every query that
successfully produces a result set
(@code{SELECT}, @code{SHOW}, @code{DESCRIBE}, @code{EXPLAIN}), and only
if you want to buffer the complete result set by the client, so that the
subsequent @code{mysql_fetch()} call returns buffered data.

It is unnecessary to call @code{mysql_stmt_store_result()} for other
queries, but if you do, it will not harm or cause any notable performance in all
cases. You can detect whether the query produced a result set by checking
if @code{mysql_get_metadata()} returns @code{NULL}. For more information, refer
to @ref{mysql_get_metadata, , @code{mysql_get_metadata()}}.

@subsubheading Return Values

Zero if the results are buffered successfully.  Non-zero if an error occurred.

@subsubheading Errors

@table @code
@item CR_COMMANDS_OUT_OF_SYNC 
Commands were executed in an improper order. 
@item CR_OUT_OF_MEMORY 
Out of memory. 
@item CR_SERVER_GONE_ERROR 
The MySQL server has gone away. 
@item CR_SERVER_LOST 
The connection to the server was lost during the query. 
@item CR_UNKNOWN_ERROR 
An unknown error occurred. 
@end table


@node C API multiple queries, C API date handling, C API Prepared statement functions, C
@subsection C API Handling of Multiple Query Execution

From version 4.1, MySQL supports the execution of multiple statements
specified in a single query string. To use this capability with a given
connection, you must specify the @code{CLIENT_MULTI_STATEMENTS} option in
the flags parameter of @code{mysql_real_connect()}
when opening the connection.  You can also set this for a connection
by calling @code{mysql_set_server_option(MYSQL_OPTION_MULTI_STATEMENTS_ON)}

By default, @code{mysql_query()} and @code{mysql_real_query()} return
only the first query status and the subsequent queries status can
be processed using @code{mysql_more_results()} and
@code{mysql_next_result()}.

@example

/* Connect to server with option CLIENT_MULTI_STATEMENTS */
mysql_real_connect(..., CLIENT_MULTI_STATEMENTS);

/* Now execute multiple queries */
mysql_query(mysql,"DROP TABLE IF EXISTS test_table;\
                   CREATE TABLE test_table(id INT);\
                   INSERT INTO test_table VALUES(10);\
                   UPDATE test_table SET id=20 WHERE id=10;\
                   SELECT * FROM test_table;\
                   DROP TABLE test_table";
do
@{
  /* Process all results */
  ...
  printf("total affected rows: %lld", mysql_affected_rows(mysql));
  ...
  if (!(result= mysql_store_result(mysql)))
  @{
     printf(stderr, "Got fatal error processing query\n");
     exit(1);
  @}
  process_result_set(result);	/* client function */
  mysql_free_result(result);
@} while (!mysql_next_result(mysql));

@end example


@node C API date handling, C Thread functions, C API multiple queries, C
@subsection C API Handling of Date and Time Values

The new binary protocol available in MySQL 4.1 and above allows you to
send and receive date and time values (@code{DATE}, @code{TIME},
@code{DATETIME}, and @code{TIMESTAMP}), using
the @code{MYSQL_TIME} structure. The members of this structure are described
in @ref{C API Prepared statement datatypes}.

To send temporal data values, you create a prepared statement with
@code{mysql_prepare()}. Then, before calling @code{mysql_execute()} to execute
the statement, use the following procedure to set up each temporal parameter:

@enumerate

@item
In the @code{MYSQL_BIND} structure associated with the data value, set the
@code{buffer_type} member to the type that indicates what kind of temporal
value you're sending. For
@code{DATE},
@code{TIME},
@code{DATETIME},
or
@code{TIMESTAMP}
values, set @code{buffer_type} to
@code{MYSQL_TYPE_DATE},
@code{MYSQL_TYPE_TIME},
@code{MYSQL_TYPE_DATETIME},
or
@code{MYSQL_TYPE_TIMESTAMP},
respectively.

@item
Set the @code{buffer} member of the @code{MYSQL_BIND} structure to the address
of the @code{MYSQL_TIME} structure in which you will pass the temporal value.

@item
Fill in the members of the @code{MYSQL_TIME} structure that are appropriate
for the type of temporal value you're passing.
@end enumerate

Use @code{mysql_bind_param()} to bind the parameter data to the statement.
Then you can call @code{mysql_execute()}.

To retrieve temporal values, the procedure is similar, except that you set
the @code{buffer_type} member to the type of value you expect to receive, and
the @code{buffer} member to the address of a @code{MYSQL_TIME} structure into
which the returned value should be placed.
Use @code{mysql_bind_results()} to bind the buffers to the statement after
calling @code{mysql_execute()} and before fetching the results.

Here is a simple example that inserts @code{DATE}, @code{TIME}, and
@code{TIMESTAMP} data.
The @code{mysql} variable is assumed to be a valid connection handle.

@example

MYSQL_TIME  ts;
MYSQL_BIND  bind[3];
MYSQL_STMT  *stmt;
  
  strmov(query, "INSERT INTO test_table(date_field, time_field,
                                        timestamp_field) VALUES(?,?,?");

  stmt= mysql_prepare(mysql, query, strlen(query))); 

  /* setup input buffers for all 3 parameters */
  bind[0].buffer_type= MYSQL_TYPE_DATE;
  bind[0].buffer= (char *)&ts;  
  bind[0].is_null= 0;
  bind[0].length= 0;
  ..
  bind[1]= bind[2]= bind[0];
  ..

  mysql_bind_param(stmt, bind);

  /* supply the data to be sent is the ts structure */
  ts.year= 2002;
  ts.month= 02;
  ts.day= 03;

  ts.hour= 10;
  ts.minute= 45;
  ts.second= 20;

  mysql_execute(stmt);
  .. 

@end example


@node C Thread functions, C Embedded Server func, C API date handling, C
@subsection C API Threaded Function Descriptions

You need to use the following functions when you want to create a
threaded client. @xref{Threaded clients}.

@menu
* my_init::                     @code{my_init()}
* mysql_thread_init::           @code{mysql_thread_init()}
* mysql_thread_end::            @code{mysql_thread_end()}
* mysql_thread_safe::           @code{mysql_thread_safe()}
@end menu

@node my_init, mysql_thread_init, C Thread functions, C Thread functions
@subsubsection @code{my_init()}

@findex @code{my_init()}

@code{void my_init(void)}

@subsubheading Description

This function needs to be called once in the program before calling any
MySQL function.  This initializes some global variables that MySQL
needs.  If you are using a thread-safe client library, this will also
call @code{mysql_thread_init()} for this thread.

This is automatically called by @code{mysql_init()},
@code{mysql_server_init()} and @code{mysql_connect()}.

@subsubheading Return Values

None.

@node mysql_thread_init, mysql_thread_end, my_init, C Thread functions
@subsubsection @code{mysql_thread_init()}

@findex @code{mysql_thread_init()}

@code{my_bool mysql_thread_init(void)}

@subsubheading Description

This function needs to be called for each created thread to initialize
thread-specific variables.

This is automatically called by @code{my_init()} and @code{mysql_connect()}.

@subsubheading Return Values

Zero if successful. Non-zero if an error occurred.

@node mysql_thread_end, mysql_thread_safe, mysql_thread_init, C Thread functions
@subsubsection @code{mysql_thread_end()}

@findex @code{mysql_thread_end()}

@code{void mysql_thread_end(void)}

@subsubheading Description

This function needs to be called before calling @code{pthread_exit()} to
free memory allocated by @code{mysql_thread_init()}.

Note that this function @strong{is not invoked automatically} by the client
library.  It must be called explicitly to avoid a memory leak.

@subsubheading Return Values

None.

@node mysql_thread_safe,  , mysql_thread_end, C Thread functions
@subsubsection @code{mysql_thread_safe()}

@findex @code{mysql_thread_safe()}

@code{unsigned int mysql_thread_safe(void)}

@subsubheading Description

This function indicates whether the client is compiled as thread-safe.

@subsubheading Return Values

1 is the client is thread-safe, 0 otherwise.

@node C Embedded Server func, C API problems, C Thread functions, C
@subsection C API Embedded Server Function Descriptions

You must use the following functions if you want to allow your
application to be linked against the embedded MySQL server library.
@xref{libmysqld}.

If the program is linked with @code{-lmysqlclient} instead of
@code{-lmysqld}, these functions do nothing.  This makes it
possible to choose between using the embedded MySQL server and
a stand-alone server without modifying any code.

@menu
* mysql_server_init::           @code{mysql_server_init()}
* mysql_server_end::            @code{mysql_server_end()}
@end menu

@node mysql_server_init, mysql_server_end, C Embedded Server func, C Embedded Server func
@subsubsection @code{mysql_server_init()}

@findex @code{mysql_server_init()}

@code{int mysql_server_init(int argc, char **argv, char **groups)}

@subsubheading Description

This function @strong{must} be called once in the program using the
embedded server before calling any other MySQL function.  It starts
the server and initializes any subsystems (@code{mysys}, @code{InnoDB}, etc.) 
that the server uses.  If this function is not called, the program will
crash.  If you are using the DBUG package that comes with MySQL, you
should call this after you have called @code{MY_INIT()}.

The @code{argc} and @code{argv} arguments are analogous to the arguments
to @code{main()}.  The first element of @code{argv} is ignored (it
typically contains the program name).  For convenience, @code{argc} may
be @code{0} (zero) if there are no command-line arguments for the
server.  @code{mysql_server_init()} makes a copy of the arguments so
it's safe to destroy @code{argv} or @code{groups} after the call.

The @code{NULL}-terminated list of strings in @code{groups}
selects which groups in the option files will be active.
@xref{Option files}.  For convenience, @code{groups} may be
@code{NULL}, in which case the @code{[server]} and @code{[emedded]} groups
will be active.

@subsubheading Example

@example
#include <mysql.h>
#include <stdlib.h>

static char *server_args[] = @{
  "this_program",       /* this string is not used */
  "--datadir=.",
  "--key_buffer_size=32M"
@};
static char *server_groups[] = @{
  "embedded",
  "server",
  "this_program_SERVER",
  (char *)NULL
@};

int main(void) @{
  if (mysql_server_init(sizeof(server_args) / sizeof(char *),
                        server_args, server_groups))
    exit(1);

  /* Use any MySQL API functions here */

  mysql_server_end();

  return EXIT_SUCCESS;
@}
@end example

@subsubheading Return Values

0 if okay, 1 if an error occurred.

@node mysql_server_end,  , mysql_server_init, C Embedded Server func
@subsubsection @code{mysql_server_end()}

@findex @code{mysql_server_end()}

@code{void mysql_server_end(void)}

@subsubheading Description

This function @strong{must} be called once in the program after
all other MySQL functions.  It shuts down the embedded server.

@subsubheading Return Values

None.

@node C API problems, Building clients, C Embedded Server func, C
@subsection Common questions and problems when using the C API

@tindex @code{mysql_query()}
@tindex @code{mysql_store_result()}

@menu
* NULL mysql_store_result::     Why @code{mysql_store_result()} Sometimes Returns @code{NULL} After @code{mysql_query()} Returns Success
* Query results::               What Results You Can Get from a Query
* Getting unique ID::           How to Get the Unique ID for the Last Inserted Row
* C API linking problems::      Problems Linking with the C API
@end menu


@node NULL mysql_store_result, Query results, C API problems, C API problems
@subsubsection Why @code{mysql_store_result()} Sometimes Returns @code{NULL} After @code{mysql_query()} Returns Success

It is possible for @code{mysql_store_result()} to return @code{NULL}
following a successful call to @code{mysql_query()}.  When this happens, it
means one of the following conditions occurred:

@itemize @bullet
@item
There was a @code{malloc()} failure (for example, if the result set was too
large).

@item
The data couldn't be read (an error occurred on the connection).

@item
The query returned no data (for example, it was an @code{INSERT},
@code{UPDATE}, or @code{DELETE}).
@end itemize

You can always check whether the statement should have produced a
non-empty result by calling @code{mysql_field_count()}.  If
@code{mysql_field_count()} returns zero, the result is empty and the last
query was a statement that does not return values (for example, an
@code{INSERT} or a @code{DELETE}).  If @code{mysql_field_count()} returns a
non-zero value, the statement should have produced a non-empty result.
See the description of the @code{mysql_field_count()} function for an
example.

You can test for an error by calling @code{mysql_error()} or
@code{mysql_errno()}.

@node Query results, Getting unique ID, NULL mysql_store_result, C API problems
@subsubsection What Results You Can Get from a Query

In addition to the result set returned by a query, you can also get the
following information:

@itemize @bullet
@item
@code{mysql_affected_rows()} returns the number of rows affected by the last
query when doing an @code{INSERT}, @code{UPDATE}, or @code{DELETE}. An
exception is that if @code{DELETE} is used without a @code{WHERE} clause, the
table is re-created empty, which is much faster! In this case,
@code{mysql_affected_rows()} returns zero for the number of records
affected.

@item
@code{mysql_num_rows()} returns the number of rows in a result set.  With
@code{mysql_store_result()}, @code{mysql_num_rows()} may be called as soon as
@code{mysql_store_result()} returns.  With @code{mysql_use_result()},
@code{mysql_num_rows()} may be called only after you have fetched all the
rows with @code{mysql_fetch_row()}.

@item
@code{mysql_insert_id()} returns the ID generated by the last
query that inserted a row into a table with an @code{AUTO_INCREMENT} index.
@xref{mysql_insert_id, , @code{mysql_insert_id()}}.

@item
Some queries (@code{LOAD DATA INFILE ...}, @code{INSERT INTO
... SELECT ...}, @code{UPDATE}) return additional information.  The result is
returned by @code{mysql_info()}.  See the description for @code{mysql_info()}
for the format of the string that it returns.  @code{mysql_info()} returns a
@code{NULL} pointer if there is no additional information.
@end itemize


@node Getting unique ID, C API linking problems, Query results, C API problems
@subsubsection How to Get the Unique ID for the Last Inserted Row

@cindex unique ID
@cindex last row, unique ID
@cindex ID, unique
@cindex tables, unique ID for last row

If you insert a record in a table containing a column that has the
@code{AUTO_INCREMENT} attribute, you can get the most recently generated
ID by calling the @code{mysql_insert_id()} function.

You can also retrieve the ID by using the @code{LAST_INSERT_ID()} function in
a query string that you pass to @code{mysql_query()}.

You can check if an @code{AUTO_INCREMENT} index is used by executing
the following code. This also checks if the query was an @code{INSERT} with
an @code{AUTO_INCREMENT} index:

@example
if (mysql_error(&mysql)[0] == 0 &&
    mysql_num_fields(result) == 0 &&
    mysql_insert_id(&mysql) != 0)
@{
    used_id = mysql_insert_id(&mysql);
@}
@end example

The most recently generated ID is maintained in the server on a
per-connection basis.  It will not be changed by another client. It will not
even be changed if you update another @code{AUTO_INCREMENT} column with a
non-magic value (that is, a value that is not @code{NULL} and not @code{0}).

If you want to use the ID that was generated for one table and insert
it into a second table, you can use SQL statements like this:

@example
INSERT INTO foo (auto,text)
    VALUES(NULL,'text');              # generate ID by inserting NULL
INSERT INTO foo2 (id,text)
    VALUES(LAST_INSERT_ID(),'text');  # use ID in second table
@end example


@node C API linking problems,  , Getting unique ID, C API problems
@subsubsection Problems Linking with the C API

@cindex linking, problems
@cindex C API, linking problems

When linking with the C API, the following errors may occur on some systems:

@example
gcc -g -o client test.o -L/usr/local/lib/mysql -lmysqlclient -lsocket -lnsl

Undefined        first referenced
 symbol          in file
floor            /usr/local/lib/mysql/libmysqlclient.a(password.o)
ld: fatal: Symbol referencing errors. No output written to client
@end example

If this happens on your system, you must include the math library by
adding @code{-lm} to the end of the compile/link line.


@node Building clients, Threaded clients, C API problems, C
@subsection Building Client Programs

@cindex client programs, building
@cindex linking
@cindex building, client programs
@cindex programs, client

If you compile MySQL clients that you've written yourself or that
you obtain from a third-party, they must be linked using the
@code{-lmysqlclient -lz} option on the link command.  You may also need to
specify a @code{-L} option to tell the linker where to find the library.  For
example, if the library is installed in @file{/usr/local/mysql/lib}, use
@code{-L/usr/local/mysql/lib -lmysqlclient -lz} on the link command.

For clients that use MySQL header files, you may need to specify a
@code{-I} option when you compile them (for example,
@code{-I/usr/local/mysql/include}), so the compiler can find the header
files.

To make the above simpler on Unix we have provided the
@code{mysql_config} script for you. @xref{mysql_config, , @code{mysql_config}}.

You can use this to compile a MySQL client by as follows:

@example
CFG=/usr/local/mysql/bin/mysql_config
sh -c "gcc -o progname `$CFG --cflags` progname.c `$CFG --libs`"
@end example

The @code{sh -c} is need to get the shell to not threat the output from
@code{mysql_config} as one word.

@node Threaded clients, libmysqld, Building clients, C
@subsection How to Make a Threaded Client

@cindex clients, threaded
@cindex threaded clients

The client library is almost thread-safe. The biggest problem is
that the subroutines in @file{net.c} that read from sockets are not
interrupt safe.  This was done with the thought that you might want to
have your own alarm that can break a long read to a server.  If you
install interrupt handlers for the @code{SIGPIPE} interrupt,
the socket handling should be thread-safe.

New in 4.0.16: To not abort the program when a connection terminates,
MySQL blocks @code{SIGPIPE} on the first call to
@code{mysql_server_init}(), @code{mysql_init()} or
@code{mysql_connect()}.  If you want to have your own @code{SIGPIPE}
handler, you should first call @code{mysql_server_init()} and then
install your handler. In older versions of MySQL @code{SIGPIPE} was blocked,
but only in the thread safe client library, for every call to
@code{mysql_init()}.

In the older binaries we distribute on our web site
(@uref{http://www.mysql.com/}), the client libraries are not normally
compiled with the thread-safe option (the Windows binaries are by
default compiled to be thread-safe). Newer binary distributions should
have both a normal and a thread-safe client library.

To get a threaded client where you can interrupt the client from other
threads and set timeouts when talking with the MySQL server, you should
use the @code{-lmysys}, @code{-lmystrings}, and @code{-ldbug} libraries and
the @code{net_serv.o} code that the server uses.

If you don't need interrupts or timeouts, you can just compile a
thread-safe client library @code{(mysqlclient_r)} and use this.  @xref{C,,
MySQL C API}.  In this case you don't have to worry about the
@code{net_serv.o} object file or the other MySQL libraries.

When using a threaded client and you want to use timeouts and
interrupts, you can make great use of the routines in the
@file{thr_alarm.c} file.  If you are using routines from the
@code{mysys} library, the only thing you must remember is to call
@code{my_init()} first! @xref{C Thread functions}.

All functions except @code{mysql_real_connect()} are by default
thread-safe.  The following notes describe how to compile a thread-safe
client library and use it in a thread-safe manner.  (The notes below for
@code{mysql_real_connect()} actually apply to @code{mysql_connect()} as
well, but because @code{mysql_connect()} is deprecated, you should be
using @code{mysql_real_connect()} anyway.)

To make @code{mysql_real_connect()} thread-safe, you must recompile the
client library with this command:

@example
shell> ./configure --enable-thread-safe-client
@end example

This will create a thread-safe client library @code{libmysqlclient_r}.
(Assuming your OS has a thread-safe @code{gethostbyname_r()} function.)
This library is thread-safe per connection.  You can let two threads
share the same connection with the following caveats:

@itemize @bullet
@item
Two threads can't send a query to the MySQL server at the same time on
the same connection.  In particular, you have to ensure that between a
@code{mysql_query()} and @code{mysql_store_result()} no other thread is using
the same connection.
@item
Many threads can access different result sets that are retrieved with
@code{mysql_store_result()}.
@item
If you use @code{mysql_use_result}, you have to ensure that no other thread
is using the same connection until the result set is closed.
However, it really is best for threaded clients that share the same
connection to use @code{mysql_store_result()}.
@item
If you want to use multiple threads on the same connection, you must
have a mutex lock around your @code{mysql_query()} and
@code{mysql_store_result()} call combination.  Once
@code{mysql_store_result()} is ready, the lock can be released and other
threads may query the same connection.
@item
If you program with POSIX threads, you can use
@code{pthread_mutex_lock()} and @code{pthread_mutex_unlock()} to
establish and release a mutex lock.
@end itemize

You need to know the following if you have a thread that is calling
MySQL functions which did not create the connection to the
MySQL database:

When you call @code{mysql_init()} or @code{mysql_connect()}, MySQL will
create a thread-specific variable for the thread that is used by the
debug library (among other things).

If you call a MySQL function, before the thread has
called @code{mysql_init()} or @code{mysql_connect()}, the thread will
not have the necessary thread-specific variables in place and you are
likely to end up with a core dump sooner or later.

The get things to work smoothly you have to do the following:

@enumerate
@item
Call @code{my_init()} at the start of your program if it calls
any other MySQL function before calling @code{mysql_real_connect()}.
@item
Call @code{mysql_thread_init()} in the thread handler before calling
any MySQL function.
@item
In the thread, call @code{mysql_thread_end()} before calling
@code{pthread_exit()}.  This will free the memory used by MySQL
thread-specific variables.
@end enumerate

You may get some errors because of undefined symbols when linking your
client with @code{libmysqlclient_r}. In most cases this is because you haven't
included the thread libraries on the link/compile line.

@node libmysqld,  , Threaded clients, C
@subsection libmysqld, the Embedded MySQL Server Library

@cindex libmysqld
@cindex embedded MySQL server library

@menu
* libmysqld overview::          Overview of the Embedded MySQL Server Library
* libmysqld compiling::         Compiling Programs with @code{libmysqld}
* libmysqld restrictions::      Restrictions when using the Embedded MySQL Server
* libmysqld options::           Using Option Files with the Embedded Server
* libmysqld TODO::              Things left to do in Embedded Server (TODO)
* libmysqld example::           A Simple Embedded Server Example
* libmysqld licensing::         Licensing the Embedded Server
@end menu

@node libmysqld overview, libmysqld compiling, libmysqld, libmysqld
@subsubsection Overview of the Embedded MySQL Server Library

The embedded MySQL server library makes it possible to run a
full-featured MySQL server inside a client application.  The
main benefits are increased speed and more simple management for
embedded applications.

The embedded server library is based on the client/server version of MySQL,
which is written in C/C++. Consequently, the embedded server also
is written in C/C++. There is no embedded server available in other
languages.

The API is identical for the embedded MySQL version and the
client/server version.  To change an old threaded application to use the
embedded library, you normally only have to add calls to the following
functions:

@multitable @columnfractions .25 .70
@item @strong{Function} @tab @strong{When to call}
@item @code{mysql_server_init()} @tab Should be called before any other MySQL function is called, preferably early in the @code{main()} function.
@item @code{mysql_server_end()} @tab Should be called before your program exits.
@item @code{mysql_thread_init()} @tab Should be called in each thread you create that will access MySQL.
@item @code{mysql_thread_end()} @tab Should be called before calling @code{pthread_exit()}
@end multitable

Then you must link your code with @file{libmysqld.a} instead of @file{libmysqlclient.a}.

The above @code{mysql_server_xxx} functions are also included in
@file{libmysqlclient.a} to allow you to change between the embedded and the
client/server version by just linking your application with the right
library. @xref{mysql_server_init, , @code{mysql_server_init()}}.


@node libmysqld compiling, libmysqld restrictions, libmysqld overview, libmysqld
@subsubsection Compiling Programs with @code{libmysqld}

To get a @code{libmysqld} library you should configure MySQL with the
@code{--with-embedded-server} option.

When you link your program with @code{libmysqld}, you must also include
the system-specific @code{pthread} libraries and some libraries that
the MySQL server uses.  You can get the full list of libraries by executing
@code{mysql_config --libmysqld-libs}.

The correct flags for compiling and linking a threaded program
must be used, even if you do not directly call any thread
functions in your code.

@node libmysqld restrictions, libmysqld options, libmysqld compiling, libmysqld
@subsubsection Restrictions when using the Embedded MySQL Server

The embedded server has the following limitations:

@itemize @bullet
@item
No support for ISAM tables. (This is mainly done to make the library smaller)
@item
No user-defined functions (UDFs).
@item
No stack trace on core dump.
@item
No internal RAID support. (This is not normally needed as most OS has
nowadays support for big files).
@item
You cannot set this up as a master or a slave (no replication).
@item
You can't connect to an embedded server from an outside process with
sockets or TCP/IP.
@end itemize

Some of these limitations can be changed by editing the @file{mysql_embed.h}
include file and recompiling MySQL.

@node libmysqld options, libmysqld TODO, libmysqld restrictions, libmysqld
@subsubsection Using Option Files with the Embedded Server

@cindex defaults, embedded

The following is the recommended way to use option files to make it easy
to switch between a client/server application and one where MySQL is
embedded. @xref{Option files}.

@itemize @bullet
@item
Put common options in the @code{[server]} section. These will be read by
both MySQL versions.
@item
Put client/server-specific options in the @code{[mysqld]} section.
@item
Put embedded MySQL-specific options in the @code{[embedded]} section.
@item
Put application-specific options in a @code{[ApplicationName_SERVER]}
section.
@end itemize

@node libmysqld TODO, libmysqld example, libmysqld options, libmysqld
@subsubsection Things left to do in Embedded Server (TODO)

@cindex TODO, embedded server

@itemize @bullet
@item
We are going to provide options to leave out some parts of MySQL to make
the library smaller.
@item
There is still a lot of speed optimization to do.
@item
Errors are written to @code{stderr}.  We will add an option to specify a
filename for these.
@item
We have to change @code{InnoDB} to not be so verbose when using in the embedded
version.
@end itemize


@node libmysqld example, libmysqld licensing, libmysqld TODO, libmysqld
@subsubsection A Simple Embedded Server Example

This example program and makefile should work without any
changes on a Linux or FreeBSD system.  For other operating
systems, minor changes will be needed.  This example is
designed to give enough details to understand the problem,
without the clutter that is a necessary part of a real
application.

To try out the example, create an @file{test_libmysqld} directory
at the same level as the mysql-4.0 source directory.  Save
the @file{test_libmysqld.c} source and the @file{GNUmakefile} in the
directory, and run GNU @file{make} from inside the @file{test_libmysqld}
directory.

@file{test_libmysqld.c}
@example
/*
 * A simple example client, using the embedded MySQL server library
 */

#include <mysql.h>
#include <stdarg.h>
#include <stdio.h>
#include <stdlib.h>

MYSQL *db_connect(const char *dbname);
void db_disconnect(MYSQL *db);
void db_do_query(MYSQL *db, const char *query);

const char *server_groups[] = @{
  "test_libmysqld_SERVER", "embedded", "server", NULL
@};

int
main(int argc, char **argv)
@{
  MYSQL *one, *two;

  /* mysql_server_init() must be called before any other mysql
   * functions.
   *
   * You can use mysql_server_init(0, NULL, NULL), and it will
   * initialize the server using groups = @{
   *   "server", "embedded", NULL
   *  @}.
   *
   * In your $HOME/.my.cnf file, you probably want to put:

[test_libmysqld_SERVER]
language = /path/to/source/of/mysql/sql/share/english

   * You could, of course, modify argc and argv before passing
   * them to this function.  Or you could create new ones in any
   * way you like.  But all of the arguments in argv (except for
   * argv[0], which is the program name) should be valid options
   * for the MySQL server.
   *
   * If you link this client against the normal mysqlclient
   * library, this function is just a stub that does nothing.
   */
  mysql_server_init(argc, argv, (char **)server_groups);

  one = db_connect("test");
  two = db_connect(NULL);

  db_do_query(one, "SHOW TABLE STATUS");
  db_do_query(two, "SHOW DATABASES");

  mysql_close(two);
  mysql_close(one);

  /* This must be called after all other mysql functions */
  mysql_server_end();

  exit(EXIT_SUCCESS);
@}

static void
die(MYSQL *db, char *fmt, ...)
@{
  va_list ap;
  va_start(ap, fmt);
  vfprintf(stderr, fmt, ap);
  va_end(ap);
  (void)putc('\n', stderr);
  if (db)
    db_disconnect(db);
  exit(EXIT_FAILURE);
@}

MYSQL *
db_connect(const char *dbname)
@{
  MYSQL *db = mysql_init(NULL);
  if (!db)
    die(db, "mysql_init failed: no memory");
  /*
   * Notice that the client and server use separate group names.
   * This is critical, because the server will not accept the
   * client's options, and vice versa.
   */
  mysql_options(db, MYSQL_READ_DEFAULT_GROUP, "test_libmysqld_CLIENT");
  if (!mysql_real_connect(db, NULL, NULL, NULL, dbname, 0, NULL, 0))
    die(db, "mysql_real_connect failed: %s", mysql_error(db));

  return db;
@}

void
db_disconnect(MYSQL *db)
@{
  mysql_close(db);
@}

void
db_do_query(MYSQL *db, const char *query)
@{
  if (mysql_query(db, query) != 0)
    goto err;

  if (mysql_field_count(db) > 0)
  @{
    MYSQL_RES   *res;
    MYSQL_ROW    row, end_row;
    int num_fields;

    if (!(res = mysql_store_result(db)))
      goto err;
    num_fields = mysql_num_fields(res);
    while ((row = mysql_fetch_row(res)))
    @{
      (void)fputs(">> ", stdout);
      for (end_row = row + num_fields; row < end_row; ++row)
        (void)printf("%s\t", row ? (char*)*row : "NULL");
      (void)fputc('\n', stdout);
    @}
    (void)fputc('\n', stdout);
    mysql_free_result(res);
  @}
  else
    (void)printf("Affected rows: %lld\n", mysql_affected_rows(db));

  return;

err:
  die(db, "db_do_query failed: %s [%s]", mysql_error(db), query);
@}
@end example

@file{GNUmakefile}
@example
# This assumes the MySQL software is installed in /usr/local/mysql
inc      := /usr/local/mysql/include/mysql
lib      := /usr/local/mysql/lib

# If you have not installed the MySQL software yet, try this instead
#inc      := $(HOME)/mysql-4.0/include
#lib      := $(HOME)/mysql-4.0/libmysqld

CC       := gcc
CPPFLAGS := -I$(inc) -D_THREAD_SAFE -D_REENTRANT
CFLAGS   := -g -W -Wall
LDFLAGS  := -static
# You can change -lmysqld to -lmysqlclient to use the
# client/server library
LDLIBS    = -L$(lib) -lmysqld -lz -lm -lcrypt

ifneq (,$(shell grep FreeBSD /COPYRIGHT 2>/dev/null))
# FreeBSD
LDFLAGS += -pthread
else
# Assume Linux
LDLIBS += -lpthread
endif

# This works for simple one-file test programs
sources := $(wildcard *.c)
objects := $(patsubst %c,%o,$(sources))
targets := $(basename $(sources))

all: $(targets)

clean:
        rm -f $(targets) $(objects) *.core
@end example

@node libmysqld licensing,  , libmysqld example, libmysqld
@subsubsection Licensing the Embedded Server

The MySQL source code is covered by the GNU @code{GPL} license
(@pxref{GPL license}).  One result of this is that any program
which includes, by linking with @code{libmysqld}, the MySQL
source code must be released as free software (under a license
compatible with the @code{GPL}).

We encourage everyone to promote free software by releasing
code under the @code{GPL} or a compatible license.  For those who
are not able to do this, another option is to purchase a
commercial license for the MySQL code from MySQL AB.
For details, please see @ref{MySQL licenses}.


@node ODBC, Java, C, Clients
@section MySQL ODBC Support

@cindex ODBC
@cindex Windows
@cindex MyODBC
@cindex Connector/ODBC

@menu
* Installing MyODBC::           How to Install MyODBC
* ODBC administrator::          How to Fill in the Various Fields in the ODBC Administrator Program
* MyODBC connect parameters::   Connect parameters for MyODBC
* ODBC Problems::               How to Report Problems with MyODBC
* MyODBC clients::              Programs Known to Work with MyODBC
* ODBC and last_insert_id::     How to Get the Value of an @code{AUTO_INCREMENT} Column in ODBC
* MyODBC bug report::           Reporting Problems with MyODBC
@end menu


MySQL provides support for ODBC by means of the @code{MyODBC}
program.  This chapter will teach you how to install @code{MyODBC},
and how to use it.  Here, you will also find a list of common programs that
are known to work with @code{MyODBC}.


@node Installing MyODBC, ODBC administrator, ODBC, ODBC
@subsection How to Install MyODBC

@code{MyODBC} 2.50 is a 32-bit ODBC 2.50 specification level 0 (with
level 1 and level 2 features) driver for connecting an ODBC-aware
application to MySQL.  @code{MyODBC} works on Windows 9x/Me/NT/2000/XP
and most Unix platforms.
@code{MyODBC} 3.51 is an enhanced version with ODBC 3.5x specification
level 1 (complete core API + level 2 features).

@code{MyODBC} is @code{Open Source}, and you can find the newest
version at @uref{http://www.mysql.com/downloads/api-myodbc.html}.
Please note that the 2.50.x versions are @code{LGPL} licensed,
whereas the 3.51.x versions are @code{GPL} licensed.

If you have problem with @code{MyODBC} and your program also works
with OLEDB, you should try the OLEDB driver.

Normally you only need to install @code{MyODBC} on Windows machines.
You only need @code{MyODBC} for Unix if you have a program like
ColdFusion that is running on the Unix machine and uses ODBC to connect
to the databases.

If you want to install @code{MyODBC} on a Unix box, you will also need
an ODBC manager.  @code{MyODBC} is known to work with
most of the Unix ODBC managers.

To install @code{MyODBC} on Windows, you should download the
appropriate @code{MyODBC} @file{.zip} file,
unpack it with @code{WinZip} or some similar program,
and execute the @file{SETUP.EXE} file.

On Windows/NT/XP you may get the following error when trying to install
@code{MyODBC}:

@example
An error occurred while copying C:\WINDOWS\SYSTEM\MFC30.DLL. Restart
Windows and try installing again (before running any applications which
use ODBC)
@end example

The problem in this case is that some other program is using ODBC and
because of how Windows is designed, you may not in this case be able to
install a new ODBC drivers with Microsoft's ODBC setup program. In most
cases you can continue by just pressing @code{Ignore} to copy the rest
of the MyODBC files and the final installation should still work.  If
this doesn't work, the solution is to reboot your computer in ``safe
mode`` (Choose this by pressing F8 just before your machine starts
Windows during rebooting), install @code{MyODBC}, and reboot to normal
mode.

@itemize @bullet
@item
To make a connection to a Unix box from a Windows box, with an ODBC
application (one that doesn't support MySQL natively), you must
first install @code{MyODBC} on the Windows machine.
@item
The user and Windows machine must have the access privileges to the
MySQL server on the Unix machine.  This is set up with the
@code{GRANT} command. @xref{GRANT,,@code{GRANT}}.
@item
You must create an ODBC DSN entry as follows:

@itemize @minus
@item
Open the Control Panel on the Windows machine.
@item
Double-click the ODBC Data Sources 32-bit icon.
@item
Click the tab User DSN.
@item
Click the button Add.
@item
Select MySQL in the screen Create New Data Source and click
the Finish button.
@item
The MySQL Driver default configuration screen is shown.
@xref{ODBC administrator}.
@end itemize

@item
Now start your application and select the ODBC driver with the DSN you
specified in the ODBC administrator.
@end itemize

Notice that there are other configuration options on the screen of
MySQL (trace, don't prompt on connect, etc) that you can try if
you run into problems.


@node ODBC administrator, MyODBC connect parameters, Installing MyODBC, ODBC
@subsection How to Fill in the Various Fields in the ODBC Administrator Program

@cindex ODBC, administrator

There are three possibilities for specifying the server name on
Windows95:

@itemize @bullet
@item
Use the IP address of the server.
@item
Add a file @file{\windows\lmhosts} with the following information:

@example
ip hostname
@end example

For example:

@example
194.216.84.21 my_hostname
@end example

@item
Configure the PC to use DNS.
@end itemize

Example of how to fill in the @code{ODBC setup}:
@example
Windows DSN name:   test
Description:        This is my test database
MySQL Database:     test
Server:             194.216.84.21
User:               monty
Password:           my_password
Port:
@end example

The value for the @code{Windows DSN name} field is any name that is unique
in your Windows ODBC setup.

You don't have to specify values for the @code{Server}, @code{User},
@code{Password}, or @code{Port} fields in the ODBC setup screen.
However, if you do, the values will be used as the defaults later when
you attempt to make a connection.  You have the option of changing the
values at that time.

If the port number is not given, the default port (@value{defaultport})
is used.

If you specify the option @code{Read options from C:\my.cnf}, the groups
@code{client} and @code{odbc} will be read from the @file{C:\my.cnf} file.
You can use all options that are usable by @code{mysql_options()}.
@xref{mysql_options, , @code{mysql_options()}}.


@node MyODBC connect parameters, ODBC Problems, ODBC administrator, ODBC
@subsection Connect parameters for MyODBC

One can specify the following parameters for @code{MyODBC} on
the @code{[Servername]} section of an @file{ODBC.INI} file or
through  the @code{InConnectionString} argument in the
@code{SQLDriverConnect()} call.

@multitable @columnfractions .15 .20 .65
@item @strong{Parameter} @tab @strong{Default value} @tab @strong{Comment}
@item user @tab ODBC (on Windows) @tab The username used to connect to MySQL.
@item server @tab localhost @tab The hostname of the MySQL server.
@item database @tab @tab The default database.
@item option @tab 0 @tab A integer by which you can specify how @code{MyODBC} should work. See below.
@item port @tab 3306 @tab The TCP/IP port to use if @code{server} is not @code{localhost}.
@item stmt @tab @tab A statement that will be executed when connecting to @code{MySQL}.
@item password @tab @tab The password for the @code{server} @code{user} combination.
@item socket @tab @tab The socket or Windows pipe to connect to.
@end multitable

The option argument is used to tell @code{MyODBC} that the client isn't 100%
ODBC compliant. On Windows, one normally sets the option flag by
toggling the different options on the connection screen but one can also
set this in the option argument. The following options are listed in the
same order as they appear in the @code{MyODBC} connect screen:

@multitable @columnfractions .10 .90
@item @strong{Bit} @tab @strong{Description}
@item 1 @tab The client can't handle that @code{MyODBC} returns the real width of a column.
@item 2 @tab  The client can't handle that MySQL returns the true value of affected rows.  If this flag is set then MySQL returns 'found rows' instead.  One must have MySQL 3.21.14 or newer to get this to work.
@item 4 @tab Make a debug log in c:\myodbc.log.  This is the same as putting @code{MYSQL_DEBUG=d:t:O,c::\myodbc.log} in @file{AUTOEXEC.BAT}
@item 8  @tab Don't set any packet limit for results and parameters.
@item 16 @tab Don't prompt for questions even if driver would like to prompt
@item 32 @tab Simulate a ODBC 1.0 driver in some context.
@item 64 @tab Ignore use of database name in 'database.table.column'.
@item 128 @tab Force use of ODBC manager cursors (experimental).
@item 256 @tab Disable the use of extended fetch (experimental).
@item 512 @tab Pad CHAR fields to full column length.
@item 1024 @tab SQLDescribeCol() will return fully qualified column names
@item 2048 @tab Use the compressed server/client protocol
@item 4096 @tab Tell server to ignore space after function name and before @code{'('} (needed by PowerBuilder).  This will make all function names keywords!
@item 8192 @tab Connect with named pipes to a @code{mysqld} server running on NT.
@item 16384 @tab Change LONGLONG columns to INT columns (some applications can't handle LONGLONG).
@item 32768 @tab Return 'user' as Table_qualifier and Table_owner from SQLTables (experimental)
@item 65536 @tab Read parameters from the @code{client} and @code{odbc} groups from @file{my.cnf}
@item 131072 @tab Add some extra safety checks (should not bee needed but...)
@end multitable

If you want to have many options, you should add the above flags!  For
example setting option to 12 (4+8) gives you debugging without package
limits!

The default @file{MYODBC.DLL} is compiled for optimal performance.  If
you want to debug @code{MyODBC} (for example to enable tracing),
you should instead use @file{MYODBCD.DLL}.  To install this file, copy
@file{MYODBCD.DLL} over the installed @file{MYODBC.DLL} file.


@node ODBC Problems, MyODBC clients, MyODBC connect parameters, ODBC
@subsection How to Report Problems with MyODBC

@code{MyODBC} has been tested with Access, Admndemo.exe, C++-Builder,
Borland Builder 4, Centura Team Developer (formerly Gupta SQL/Windows),
ColdFusion (on Solaris and NT with svc pack 5), Crystal Reports,
DataJunction, Delphi, ERwin, Excel, iHTML, FileMaker Pro, FoxPro, Notes
4.5/4.6, SBSS, Perl DBD-ODBC, Paradox, Powerbuilder, Powerdesigner 32
bit, VC++, and Visual Basic.

If you know of any other applications that work with @code{MyODBC}, please
send mail to the @code{myodbc} mailing list about this!
@xref{Mailing-list}.

With some programs you may get an error like:
@code{Another user has modifies the record that you have modified}. In most
cases this can be solved by doing one of the following things:

@itemize @bullet
@item
Add a primary key for the table if there isn't one already.
@item
Add a timestamp column if there isn't one already.
@item
Only use double float fields. Some programs may fail when they compare
single floats.
@end itemize

If the above doesn't help, you should do a @code{MyODBC} trace file and
try to figure out why things go wrong.


@node MyODBC clients, ODBC and last_insert_id, ODBC Problems, ODBC
@subsection Programs Known to Work with MyODBC

Most programs should work with @code{MyODBC}, but for each of those
listed here, we have tested it ourselves or received confirmation from
some user that it works:

@table @asis
@item @strong{Program}
@strong{Comment}
@cindex Access program

@item Access
To make Access work:
@itemize @bullet
@item
If you are using Access 2000, you should get and install the newest
(version 2.6 or above) Microsoft MDAC (@code{Microsoft Data Access
Components}) from @uref{http://www.microsoft.com/data/}.  This will fix
the following bug in Access: when you export data to MySQL, the
table and column names aren't specified.  Another way to around this bug
is to upgrade to MyODBC Version 2.50.33 and MySQL Version
3.23.x, which together provide a workaround for this bug!

You should also get and apply the Microsoft Jet 4.0 Service Pack 5 (SP5)
which can be found here
@uref{http://support.microsoft.com/support/kb/articles/Q 239/1/14.ASP}.
This will fix some cases where columns are marked as @code{#deleted#}
in Access.

Note that if you are using MySQL Version 3.22, you must to apply the
MDAC patch and use MyODBC 2.50.32 or 2.50.34 and above to go around
this problem.
@item
For all Access versions, you should enable the MyODBC option flag
@code{Return matching rows}. For Access 2.0, you should additionally enable
@code{Simulate ODBC 1.0}.
@item
You should have a timestamp in all tables you want to be able to update.
For maximum portability @code{TIMESTAMP(14)} or simple @code{TIMESTAMP}
is recommended instead of other @code{TIMESTAMP(X)} variations.
@item
You should have a primary key in the table. If not, new or updated rows
may show up as @code{#DELETED#}.
@item
Only use @code{DOUBLE} float fields. Access fails when comparing with
single floats.  The symptom usually is that new or updated rows may show
up as @code{#DELETED#} or that you can't find or update rows.
@item
If you are linking a table through MyODBC, which has @code{BIGINT} as
one of the column, then the results will be displayed as @code{#DELETED}. The
work around solution is:
@itemize @bullet
@item
Have one more dummy column with @code{TIMESTAMP} as the datatype, preferably
@code{TIMESTAMP(14)}.
@item
Check the @code{'Change BIGINT columns to INT'} in connection options dialog in
ODBC DSN Administrator
@item
Delete the table link from access and re-create it.
@end itemize

It still displays the previous records as @code{#DELETED#}, but newly
added/updated records will be displayed properly.
@item
If you still get the error @code{Another user has changed your data} after
adding a @code{TIMESTAMP} column, the following trick may help you:

Don't use @code{table} data sheet view. Create instead a form with the
fields you want, and use that @code{form} data sheet view.  You should
set the @code{DefaultValue} property for the @code{TIMESTAMP} column to
@code{NOW()}.  It may be a good idea to hide the @code{TIMESTAMP} column
from view so your users are not confused.
@item
In some cases, Access may generate illegal SQL queries that
MySQL can't understand. You can fix this by selecting
@code{"Query|SQLSpecific|Pass-Through"} from the Access menu.
@item
Access on NT will report @code{BLOB} columns as @code{OLE OBJECTS}. If
you want to have @code{MEMO} columns instead, you should change the
column to @code{TEXT} with @code{ALTER TABLE}.
@item
Access can't always handle @code{DATE} columns properly. If you have a problem
with these, change the columns to @code{DATETIME}.
@item
If you have in Access a column defined as @code{BYTE}, Access will try
to export this as @code{TINYINT} instead of @code{TINYINT UNSIGNED}.
This will give you problems if you have values > 127 in the column!
@end itemize

@cindex ADO program
@item ADO
When you are coding with the ADO API and @code{MyODBC} you need to put
attention in some default properties that aren't supported by the
MySQL server.  For example, using the @code{CursorLocation
Property} as @code{adUseServer} will return for the @code{RecordCount
Property} a result of -1. To have the right value, you need to set this
property to @code{adUseClient}, like is showing in the VB code here:

@example
Dim myconn As New ADODB.Connection
Dim myrs As New Recordset
Dim mySQL As String
Dim myrows As Long

myconn.Open "DSN=MyODBCsample"
mySQL = "SELECT * from user"
myrs.Source = mySQL
Set myrs.ActiveConnection = myconn
myrs.CursorLocation = adUseClient
myrs.Open
myrows = myrs.RecordCount

myrs.Close
myconn.Close
@end example

Another workaround is to use a @code{SELECT COUNT(*)} statement
for a similar query to get the correct row count.

@item Active server pages (ASP)
You should use the option flag @code{Return matching rows}.

@item BDE applications
To get these to work, you should set the option flags
@code{Don't optimize column widths} and @code{Return matching rows}.

@cindex Borland Builder 4 program
@item Borland Builder 4
When you start a query you can use the property @code{Active} or use the
method @code{Open}.  Note that @code{Active} will start by automatically
issuing a @code{SELECT * FROM ...} query that may not be a good thing if
your tables are big!
@item ColdFusion (On Unix)
The following information is taken from the ColdFusion documentation:

Use the following information to configure ColdFusion Server for Linux
to use the unixODBC driver with @code{MyODBC} for MySQL data
sources.  Allaire has verified that @code{MyODBC} Version 2.50.26
works with MySQL Version 3.22.27 and ColdFusion for Linux. (Any
newer version should also work.) You can download @code{MyODBC} at
@uref{http://www.mysql.com/downloads/api-myodbc.html}

@cindex ColdFusion program
ColdFusion Version 4.5.1 allows you to us the ColdFusion Administrator
to add the MySQL data source. However, the driver is not
included with ColdFusion Version 4.5.1. Before the MySQL driver
will appear in the ODBC datasources drop-down list, you must build and
copy the @code{MyODBC} driver to
@file{/opt/coldfusion/lib/libmyodbc.so}.

The Contrib directory contains the program @file{mydsn-xxx.zip} which allows
you to build and remove the DSN registry file for the MyODBC driver
on Coldfusion applications.

@cindex DataJunction
@item DataJunction
You have to change it to output @code{VARCHAR} rather than @code{ENUM}, as
it exports the latter in a manner that causes MySQL grief.
@cindex Excel
@item Excel
Works. A few tips:
@itemize @bullet
@item
If you have problems with dates, try to select them as strings using the
@code{CONCAT()} function. For example:
@example
select CONCAT(rise_time), CONCAT(set_time)
    from sunrise_sunset;
@end example
Values retrieved as strings this way should be correctly recognized
as time values by Excel97.

The purpose of @code{CONCAT()} in this example is to fool ODBC into thinking
the column is of ``string type''. Without the @code{CONCAT()}, ODBC knows the
column is of time type, and Excel does not understand that.

Note that this is a bug in Excel, because it automatically converts a
string to a time. This would be great if the source was a text file, but
is plain stupid when the source is an ODBC connection that reports
exact types for each column.
@end itemize
@cindex Word program
@item Word

To retrieve data from MySQL to Word/Excel documents, you need to
use the @code{MyODBC} driver and the Add-in Microsoft Query help.

For example, create a db with a table containing 2 columns of text:

@itemize @bullet
@item
Insert rows using the @code{mysql} client command-line tool.
@item
Create a DSN file using the ODBC manager, for example, @file{my} for the db above.
@item
Open the Word application.
@item
Create a blank new documentation.
@item
Using the tool bar called Database, press the button insert database.
@item
Press the button Get Data.
@item
At the right hand of the screen Get Data, press the button Ms Query.
@item
In the Ms Query create a New Data Source using the DSN file my.
@item
Select the new query.
@item
Select the columns that you want.
@item
Make a filter if you want.
@item
Make a Sort if you want.
@item
Select Return Data to Microsoft Word.
@item
Click Finish.
@item
Click Insert data and select the records.
@item
Click OK and you see the rows in your Word document.
@end itemize

@cindex odbcadmin program
@item odbcadmin
Test program for ODBC.
@cindex Delphi program
@item Delphi
You must use BDE Version 3.2 or newer.  Set the @code{Don't optimize column width}
option field when connecting to MySQL.

Also, here is some potentially useful Delphi code that sets up both an
ODBC entry and a BDE entry for @code{MyODBC} (the BDE entry requires a BDE
Alias Editor that is free at a Delphi Super Page near
you. (Thanks to Bryan Brunton @email{bryan@@flesherfab.com} for this):

@example
fReg:= TRegistry.Create;
  fReg.OpenKey('\Software\ODBC\ODBC.INI\DocumentsFab', True);
  fReg.WriteString('Database', 'Documents');
  fReg.WriteString('Description', ' ');
  fReg.WriteString('Driver', 'C:\WINNT\System32\myodbc.dll');
  fReg.WriteString('Flag', '1');
  fReg.WriteString('Password', '');
  fReg.WriteString('Port', ' ');
  fReg.WriteString('Server', 'xmark');
  fReg.WriteString('User', 'winuser');
  fReg.OpenKey('\Software\ODBC\ODBC.INI\ODBC Data Sources', True);
  fReg.WriteString('DocumentsFab', 'MySQL');
  fReg.CloseKey;
  fReg.Free;

  Memo1.Lines.Add('DATABASE NAME=');
  Memo1.Lines.Add('USER NAME=');
  Memo1.Lines.Add('ODBC DSN=DocumentsFab');
  Memo1.Lines.Add('OPEN MODE=READ/WRITE');
  Memo1.Lines.Add('BATCH COUNT=200');
  Memo1.Lines.Add('LANGDRIVER=');
  Memo1.Lines.Add('MAX ROWS=-1');
  Memo1.Lines.Add('SCHEMA CACHE DIR=');
  Memo1.Lines.Add('SCHEMA CACHE SIZE=8');
  Memo1.Lines.Add('SCHEMA CACHE TIME=-1');
  Memo1.Lines.Add('SQLPASSTHRU MODE=SHARED AUTOCOMMIT');
  Memo1.Lines.Add('SQLQRYMODE=');
  Memo1.Lines.Add('ENABLE SCHEMA CACHE=FALSE');
  Memo1.Lines.Add('ENABLE BCD=FALSE');
  Memo1.Lines.Add('ROWSET SIZE=20');
  Memo1.Lines.Add('BLOBS TO CACHE=64');
  Memo1.Lines.Add('BLOB SIZE=32');

  AliasEditor.Add('DocumentsFab','MySQL',Memo1.Lines);
@end example

@cindex C++ Builder
@item C++ Builder
Tested with BDE Version 3.0. The only known problem is that when the table
schema changes, query fields are not updated. BDE, however, does not seem
to recognize primary keys, only the index PRIMARY, though this has not
been a problem.

@item Vision
You should use the option flag @code{Return matching rows}.

@cindex Visual Basic
@item Visual Basic
To be able to update a table, you must define a primary key for the table.

Visual Basic with ADO can't handle big integers. This means that some queries
like @code{SHOW PROCESSLIST} will not work properly.  The fix is to set
the option @code{OPTION=16384} in the ODBC connect string or to set
the @code{Change BIGINT columns to INT} option in the MyODBC connect screen.
You may also want to set the @code{Return matching rows} option.

@item VisualInterDev
If you get the error @code{[Microsoft][ODBC Driver Manager] Driver does
not support this parameter} the reason may be that you have a
@code{BIGINT} in your result.  Try setting the @code{Change BIGINT
columns to INT} option in the MyODBC connect screen.

@item Visual Objects
You should use the option flag @code{Don't optimize column widths}.
@end table


@node ODBC and last_insert_id, MyODBC bug report, MyODBC clients, ODBC
@subsection How to Get the Value of an @code{AUTO_INCREMENT} Column in ODBC

@cindex AUTO-INCREMENT, ODBC

A common problem is how to get the value of an automatically generated ID
from an @code{INSERT}. With ODBC, you can do something like this (assuming
that @code{auto} is an @code{AUTO_INCREMENT} field):

@example
INSERT INTO foo (auto,text) VALUES(NULL,'text');
SELECT LAST_INSERT_ID();
@end example

Or, if you are just going to insert the ID into another table, you can do this:

@example
INSERT INTO foo (auto,text) VALUES(NULL,'text');
INSERT INTO foo2 (id,text) VALUES(LAST_INSERT_ID(),'text');
@end example

@xref{Getting unique ID}.

For the benefit of some ODBC applications (at least Delphi and Access),
the following query can be used to find a newly inserted row:
@example
SELECT * FROM tbl_name WHERE auto IS NULL;
@end example


@node MyODBC bug report,  , ODBC and last_insert_id, ODBC
@subsection Reporting Problems with MyODBC

@cindex reporting, MyODBC problems
@cindex problems, ODBC
@cindex MyODBC, reporting problems

If you encounter difficulties with MyODBC, you should start by
making a log file from the ODBC manager (the log you get when requesting
logs from ODBCADMIN) and a MyODBC log.

To get a MyODBC log, you need to do the following:

@enumerate
@item
Ensure that you are using @file{myodbcd.dll} and not @file{myodbc.dll}.
The easiest way to do this is to get @file{myodbcd.dll} from the MyODBC
distribution and copy it over the @file{myodbc.dll}, which is probably
in your @file{C:\windows\system32} or @file{C:\winnt\system32} directory.

Note that you probably want to restore the old @file{myodbc.dll} file when you
have finished testing, as it is a lot faster than @file{myodbcd.dll}.
@item
Select the ``Trace MyODBC'' option in the @code{MyODBC} connect/configure
screen.  The log will be written to the file @file{C:\myodbc.log}.

If the trace option is not remembered the next time you visit this screen,
it means that you are not using the @code{myodbcd.dll}
driver. Reread the previous step to verify that you have installed
@file{myodbcd.dll}.
@item
Start your application and try to get it to fail.
@end enumerate

Check the MyODBC trace file, to find out what could be wrong.
You should be able to determine what statements were issued by searching for
the string @code{>mysql_real_query} in the @file{myodbc.log} file.

You should also try issuing the statements from the @code{mysql} client
program or from @code{admndemo}. This will help you determine whether the
error is in MyODBC or MySQL.

If you find out something is wrong, please only send the relevant rows
(max 40 rows) to the @code{myodbc} mailing list.
@xref{Mailing-list}.
Please never send the whole MyODBC or ODBC log file!

If you are unable to find out what's wrong, the last option is to
make an archive in @code{tar} or ZIP format that contains a MyODBC trace file,
the ODBC log file, and a @file{README} file that explains the problem.  You can send this
to @uref{ftp://support.mysql.com/pub/mysql/secret/}.  Only we at
MySQL AB will have access to the files you upload, and we will
be very discreet with the data!

If you can create a program that also demonstrates the problem, please include
it in the archive as well.

If the program works with some other SQL server, you should include an ODBC log
file where you do exactly the same thing in the other SQL server.

Remember that the more information you can supply to us, the more
likely it is that we can fix the problem!


@node Java, PHP, ODBC, Clients
@section MySQL Java Connectivity (JDBC)

@cindex Java connectivity
@cindex Connector/J
@cindex JDBC

There are 2 supported JDBC drivers for MySQL:

@itemize @bullet
@item
@code{MySQL Connector/J} from MySQL AB, implemented in 100% native Java.
This product was formerly known as the @code{mm.mysql} driver.
You can download @code{MySQL Connector/J} from
@uref{http://www.mysql.com/products/connector-j/}.
@item
The Resin JDBC driver, which can be found at
@uref{http://www.caucho.com/projects/jdbc-mysql/index.xtp}.
@end itemize

For more information, consult any general JDBC documentation, plus each
driver's own documentation for MySQL-specific features.

Documentation for @code{MySQL Connector/J} is available online at the
MySQL AB web site at @uref{http://www.mysql.com/documentation/}.


@node PHP, Perl, Java, Clients
@section MySQL PHP API

@cindex PHP API

PHP is a server-side, HTML-embedded scripting language that may be used to
create dynamic web pages.  It contains support for accessing several
databases, including MySQL.  PHP may be run as a separate program
or compiled as a module for use with the Apache web server.

The distribution and documentation are available at the PHP web site
(@uref{http://www.php.net/}).

@menu
* PHP problems::                Common Problems with MySQL and PHP
@end menu

@node PHP problems,  , PHP, PHP
@subsection Common Problems with MySQL and PHP

@itemize @bullet
@item Error: "Maximum Execution Time Exceeded"
This is a PHP limit; go into the @file{php.ini} file and set the maximum
execution time up from 30 seconds to something higher, as needed.
It is also not a bad idea to double the RAM allowed per script to 16 MB instead of
8 MB.
@item Error: "Fatal error: Call to unsupported or undefined function mysql_connect() in .."
This means that your PHP version isn't compiled with MySQL support.
You can either compile a dynamic MySQL module and load it into PHP or
recompile PHP with built-in MySQL support.  This is described in
detail in the PHP manual.
@item Error: "undefined reference to `uncompress'"
This means that the client library is compiled with support for a compressed
client/server protocol. The fix is to add @code{-lz} last when linking
with @code{-lmysqlclient}.
@end itemize


@node Perl, Cplusplus, PHP, Clients
@section MySQL Perl API

@cindex APIs, Perl
@cindex Perl API
@cindex @code{DBI} interface
@cindex @code{DBI/DBD} interface


The Perl @code{DBI} module provides a generic interface for database access.
You can write a DBI script that works with many different database engines
without change. To use DBI, you must install the @code{DBI} module, as well
as a DataBase Driver (DBD) module for each type of server you want to access.
For MySQL, this driver is the @code{DBD::mysql} module.

Perl DBI is now the recommended Perl interface. It replaces an older
interface called @code{mysqlperl}, which should be considered obsolete.

Installation instructions for Perl DBI support are given in
@ref{Perl support}.

DBI information is available at the command line, online, or in printed form:

@itemize @bullet
@item
Once you have the @code{DBI} and @code{DBD::mysql} modules installed, you can
get information about them at the command line with the @code{perldoc} command:

@example
shell> perldoc DBI
shell> perldoc DBI::FAQ
shell> perldoc DBD::mysql
@end example

You can also use @code{pod2man}, @code{pod2html}, and so forth to translate
this information into other formats.

@item
For online information about Perl DBI, visit the DBI web site,
@uref{http://dbi.perl.org/}.

@item
For printed information, the official DBI book is @cite{Programming the Perl
DBI} (Alligator Descartes and Tim Bunce, O'Reilly & Associates, 2000).
Information about the book is available at the DBI web site,
@uref{http://dbi.perl.org/}.

For information that focuses specifically on using DBI with MySQL, see
@cite{MySQL and Perl for the Web} (Paul DuBois, New Riders, 2001). This
book's web site is @uref{http://www.kitebird.com/mysql-perl/}.

@end itemize


@node Cplusplus, Python, Perl, Clients
@section MySQL C++ API

@menu
* Borland C++::                 Borland C++
@end menu


@cindex MySQL++
@cindex C++ APIs

@code{MySQL++} is the MySQL API for C++. More
information can be found at @uref{http://www.mysql.com/products/mysql++/}.


@node Borland C++,  , Cplusplus, Cplusplus
@subsection Borland C++

@cindex Borland C++ compiler

You can compile the MySQL Windows source with Borland C++ 5.02.
(The Windows source includes only projects for Microsoft VC++, for
Borland C++ you have to do the project files yourself.)

One known problem with Borland C++ is that it uses a different structure
alignment than VC++.  This means that you will run into problems if you
try to use the default @code{libmysql.dll} libraries (that was compiled
with VC++) with Borland C++. You can do one of the following to avoid
this problem.

@itemize @bullet
@item
You can use the static MySQL libraries for Borland C++ that you
can find on @uref{http://www.mysql.com/downloads/os-win32.html}.
@item
Only call @code{mysql_init()} with @code{NULL} as an argument, not a
pre-allocated @code{MYSQL} structure.
@end itemize


@node Python, Tcl, Cplusplus, Clients
@section MySQL Python API

@cindex Python API

@code{MySQLdb} provides MySQL support for Python, compliant with the
Python DB API version 2.0. It can be found at
@uref{http://sourceforge.net/projects/mysql-python/}.


@node Tcl, Eiffel, Python, Clients
@section MySQL Tcl API

@cindex Tcl API

@code{MySQLtcl} is a simple API for accessing a MySQL database server from the Tcl
programming language. It can be found at @uref{http://www.xdobry.de/mysqltcl/}.

@node Eiffel,  , Tcl, Clients
@section MySQL Eiffel Wrapper

@cindex Eiffel Wrapper
@cindex wrappers, Eiffel

Eiffel MySQL is an interface to the MySQL database server using the Eiffel
programming language, written by Michael Ravits. It can be found at
@uref{http://efsa.sourceforge.net/archive/ravits/mysql.htm}.


@node Error-handling, Extending MySQL, Clients, Top
@chapter Error Handling in MySQL

This chapter describes how MySQL handles errors.


@menu
* Error-returns::               Error Returns
@end menu

@node Error-returns,  , Error-handling, Error-handling
@section Error Returns

Following are error codes that may appear
when you call MySQL from any host language.

The @code{Name} and @code{Error Code} columns correspond to
definitions in the MySQL source code file:
@file{include/mysqld_error.h}

The @code{SQLSTATE} column corresponds to definitions
in the MySQL source code file:
@file{include/sql_state.h}

The SQLSTATE error code will appear only if
you use MySQL version 4.1. SQLSTATE codes
were added for compatibility with X/Open / ANSI / ODBC
behavior.

A suggested text for each error code can be found
in the error-message file:
@file{share/english/errmsg.sys}

Because updates are frequent, it is possible that
the above sources will contain additional error codes.

@multitable @columnfractions .50 .15 .15

@item @strong{Name} @tab @strong{Error Code} @tab @strong{SQLSTATE}

@item ER_HASHCHK                     @tab 1000       @tab HY000
@item ER_NISAMCHK                    @tab 1001       @tab HY000
@item ER_NO                          @tab 1002       @tab HY000
@item ER_YES                         @tab 1003       @tab HY000
@item ER_CANT_CREATE_FILE            @tab 1004       @tab HY000
@item ER_CANT_CREATE_TABLE           @tab 1005       @tab HY000
@item ER_CANT_CREATE_DB              @tab 1006       @tab HY000
@item ER_DB_CREATE_EXISTS            @tab 1007       @tab HY000
@item ER_DB_DROP_EXISTS              @tab 1008       @tab HY000
@item ER_DB_DROP_DELETE              @tab 1009       @tab HY000
@item ER_DB_DROP_RMDIR               @tab 1010       @tab HY000
@item ER_CANT_DELETE_FILE            @tab 1011       @tab HY000
@item ER_CANT_FIND_SYSTEM_REC        @tab 1012       @tab HY000
@item ER_CANT_GET_STAT               @tab 1013       @tab HY000
@item ER_CANT_GET_WD                 @tab 1014       @tab HY000
@item ER_CANT_LOCK                   @tab 1015       @tab HY000
@item ER_CANT_OPEN_FILE              @tab 1016       @tab HY000
@item ER_FILE_NOT_FOUND              @tab 1017       @tab HY000
@item ER_CANT_READ_DIR               @tab 1018       @tab HY000
@item ER_CANT_SET_WD                 @tab 1019       @tab HY000
@item ER_CHECKREAD                   @tab 1020       @tab HY000
@item ER_DISK_FULL                   @tab 1021       @tab HY000
@item ER_DUP_KEY                     @tab 1022       @tab 23000
@item ER_ERROR_ON_CLOSE              @tab 1023       @tab HY000
@item ER_ERROR_ON_READ               @tab 1024       @tab HY000
@item ER_ERROR_ON_RENAME             @tab 1025       @tab HY000
@item ER_ERROR_ON_WRITE              @tab 1026       @tab HY000
@item ER_FILE_USED                   @tab 1027       @tab HY000
@item ER_FILSORT_ABORT               @tab 1028       @tab HY000
@item ER_FORM_NOT_FOUND              @tab 1029       @tab HY000
@item ER_GET_ERRNO                   @tab 1030       @tab HY000
@item ER_ILLEGAL_HA                  @tab 1031       @tab HY000
@item ER_KEY_NOT_FOUND               @tab 1032       @tab HY000
@item ER_NOT_FORM_FILE               @tab 1033       @tab HY000
@item ER_NOT_KEYFILE                 @tab 1034       @tab HY000
@item ER_OLD_KEYFILE                 @tab 1035       @tab HY000
@item ER_OPEN_AS_READONLY            @tab 1036       @tab HY000
@item ER_OUTOFMEMORY                 @tab 1037       @tab HY001
@item ER_OUT_OF_SORTMEMORY           @tab 1038       @tab HY001
@item ER_UNEXPECTED_EOF              @tab 1039       @tab HY000
@item ER_CON_COUNT_ERROR             @tab 1040       @tab 08004
@item ER_OUT_OF_RESOURCES            @tab 1041       @tab 08004
@item ER_BAD_HOST_ERROR              @tab 1042       @tab 08S01
@item ER_HANDSHAKE_ERROR             @tab 1043       @tab 08S01
@item ER_DBACCESS_DENIED_ERROR       @tab 1044       @tab 42000
@item ER_ACCESS_DENIED_ERROR         @tab 1045       @tab 42000
@item ER_NO_DB_ERROR                 @tab 1046       @tab 42000
@item ER_UNKNOWN_COM_ERROR           @tab 1047       @tab 08S01
@item ER_BAD_NULL_ERROR              @tab 1048       @tab 23000
@item ER_BAD_DB_ERROR                @tab 1049       @tab 42000
@item ER_TABLE_EXISTS_ERROR          @tab 1050       @tab 42S01
@item ER_BAD_TABLE_ERROR             @tab 1051       @tab 42S02
@item ER_NON_UNIQ_ERROR              @tab 1052       @tab 23000
@item ER_SERVER_SHUTDOWN       @tab 1053       @tab 08S01
@item ER_BAD_FIELD_ERROR             @tab 1054       @tab 42S22
@item ER_WRONG_FIELD_WITH_GROUP      @tab 1055       @tab 42000
@item ER_WRONG_GROUP_FIELD           @tab 1056       @tab 42000
@item ER_WRONG_SUM_SELECT            @tab 1057       @tab 42000
@item ER_WRONG_VALUE_COUNT           @tab 1058       @tab 21S01
@item ER_TOO_LONG_IDENT              @tab 1059       @tab 42000
@item ER_DUP_FIELDNAME               @tab 1060       @tab 42S21
@item ER_DUP_KEYNAME                 @tab 1061       @tab 42000
@item ER_DUP_ENTRY                   @tab 1062       @tab 23000
@item ER_WRONG_FIELD_SPEC            @tab 1063       @tab 42000
@item ER_PARSE_ERROR                 @tab 1064       @tab 42000
@item ER_EMPTY_QUERY                 @tab 1065       @tab 42000
@item ER_NONUNIQ_TABLE               @tab 1066       @tab 42000
@item ER_INVALID_DEFAULT             @tab 1067       @tab 42000
@item ER_MULTIPLE_PRI_KEY            @tab 1068       @tab 42000
@item ER_TOO_MANY_KEYS               @tab 1069       @tab 42000
@item ER_TOO_MANY_KEY_PARTS          @tab 1070       @tab 42000
@item ER_TOO_LONG_KEY                @tab 1071       @tab 42000
@item ER_KEY_COLUMN_DOES_NOT_EXITS   @tab 1072       @tab 42000
@item ER_BLOB_USED_AS_KEY            @tab 1073       @tab 42000
@item ER_TOO_BIG_FIELDLENGTH         @tab 1074       @tab 42000
@item ER_WRONG_AUTO_KEY              @tab 1075       @tab 42000
@item ER_READY                       @tab 1076       @tab 00000
@item ER_NORMAL_SHUTDOWN             @tab 1077       @tab 00000
@item ER_GOT_SIGNAL                  @tab 1078       @tab 00000
@item ER_SHUTDOWN_COMPLETE           @tab 1079       @tab 00000
@item ER_FORCING_CLOSE               @tab 1080       @tab 08S01
@item ER_IPSOCK_ERROR                @tab 1081       @tab 08S01
@item ER_NO_SUCH_INDEX               @tab 1082       @tab 42S12
@item ER_WRONG_FIELD_TERMINATORS     @tab 1083       @tab 42000
@item ER_BLOBS_AND_NO_TERMINATED     @tab 1084       @tab 42000
@item ER_TEXTFILE_NOT_READABLE       @tab 1085       @tab HY000
@item ER_FILE_EXISTS_ERROR           @tab 1086       @tab HY000
@item ER_LOAD_INFO                   @tab 1087       @tab HY000
@item ER_ALTER_INFO            @tab 1088       @tab HY000
@item ER_WRONG_SUB_KEY               @tab 1089       @tab HY000
@item ER_CANT_REMOVE_ALL_FIELDS      @tab 1090       @tab 42000
@item ER_CANT_DROP_FIELD_OR_KEY      @tab 1091       @tab 42000
@item ER_INSERT_INFO                 @tab 1092       @tab HY000
@item ER_UPDATE_TABLE_USED           @tab 1093       @tab HY000
@item ER_NO_SUCH_THREAD              @tab 1094       @tab HY000
@item ER_KILL_DENIED_ERROR           @tab 1095       @tab HY000
@item ER_NO_TABLES_USED              @tab 1096       @tab HY000
@item ER_TOO_BIG_SET                 @tab 1097       @tab HY000
@item ER_NO_UNIQUE_LOGFILE           @tab 1098       @tab HY000
@item ER_TABLE_NOT_LOCKED_FOR_WRITE  @tab 1099       @tab HY000
@item ER_TABLE_NOT_LOCKED            @tab 1100       @tab HY000
@item ER_BLOB_CANT_HAVE_DEFAULT      @tab 1101       @tab 42000
@item ER_WRONG_DB_NAME               @tab 1102       @tab 42000
@item ER_WRONG_TABLE_NAME            @tab 1103       @tab 42000
@item ER_TOO_BIG_SELECT              @tab 1104       @tab 42000
@item ER_UNKNOWN_ERROR               @tab 1105       @tab HY000
@item ER_UNKNOWN_PROCEDURE           @tab 1106       @tab 42000
@item ER_WRONG_PARAMCOUNT_TO_PROCEDURE @tab 1107     @tab 42000
@item ER_WRONG_PARAMETERS_TO_PROCEDURE @tab 1108     @tab HY000
@item ER_UNKNOWN_TABLE               @tab 1109       @tab 42S02
@item ER_FIELD_SPECIFIED_TWICE       @tab 1110       @tab 42000
@item ER_INVALID_GROUP_FUNC_USE      @tab 1111       @tab 42000
@item ER_UNSUPPORTED_EXTENSION       @tab 1112       @tab 42000
@item ER_TABLE_MUST_HAVE_COLUMNS     @tab 1113       @tab 42000
@item ER_RECORD_FILE_FULL            @tab 1114       @tab HY000
@item ER_UNKNOWN_CHARACTER_SET @tab 1115       @tab 42000
@item ER_TOO_MANY_TABLES             @tab 1116       @tab HY000
@item ER_TOO_MANY_FIELDS             @tab 1117       @tab HY000
@item ER_TOO_BIG_ROWSIZE             @tab 1118       @tab 42000
@item ER_STACK_OVERRUN               @tab 1119       @tab HY000
@item ER_WRONG_OUTER_JOIN      @tab 1120       @tab 42000
@item ER_NULL_COLUMN_IN_INDEX        @tab 1121       @tab 42000
@item ER_CANT_FIND_UDF               @tab 1122       @tab HY000
@item ER_CANT_INITIALIZE_UDF         @tab 1123       @tab HY000
@item ER_UDF_NO_PATHS                @tab 1124       @tab HY000
@item ER_UDF_EXISTS                  @tab 1125       @tab HY000
@item ER_CANT_OPEN_LIBRARY           @tab 1126       @tab HY000
@item ER_CANT_FIND_DL_ENTRY          @tab 1127       @tab HY000
@item ER_FUNCTION_NOT_DEFINED        @tab 1128       @tab HY000
@item ER_HOST_IS_BLOCKED             @tab 1129       @tab HY000
@item ER_HOST_NOT_PRIVILEGED         @tab 1130       @tab HY000
@item ER_PASSWORD_ANONYMOUS_USER     @tab 1131       @tab 42000
@item ER_PASSWORD_NOT_ALLOWED        @tab 1132       @tab 42000
@item ER_PASSWORD_NO_MATCH           @tab 1133       @tab 42000
@item ER_UPDATE_INFO                 @tab 1134       @tab HY000
@item ER_CANT_CREATE_THREAD          @tab 1135       @tab HY000
@item ER_WRONG_VALUE_COUNT_ON_ROW    @tab 1136       @tab 21S01
@item ER_CANT_REOPEN_TABLE           @tab 1137       @tab HY000
@item ER_INVALID_USE_OF_NULL         @tab 1138       @tab 42000
@item ER_REGEXP_ERROR                @tab 1139       @tab 42000
@item ER_MIX_OF_GROUP_FUNC_AND_FIELDS @tab 1140      @tab 42000
@item ER_NONEXISTING_GRANT           @tab 1141       @tab 42000
@item ER_TABLEACCESS_DENIED_ERROR    @tab 1142       @tab 42000
@item ER_COLUMNACCESS_DENIED_ERROR   @tab 1143       @tab 42000
@item ER_ILLEGAL_GRANT_FOR_TABLE     @tab 1144       @tab 42000
@item ER_GRANT_WRONG_HOST_OR_USER    @tab 1145       @tab 42000
@item ER_NO_SUCH_TABLE               @tab 1146       @tab 42S02
@item ER_NONEXISTING_TABLE_GRANT     @tab 1147       @tab 42000
@item ER_NOT_ALLOWED_COMMAND         @tab 1148       @tab 42000
@item ER_SYNTAX_ERROR                @tab 1149       @tab 42000
@item ER_DELAYED_CANT_CHANGE_LOCK    @tab 1150       @tab HY000
@item ER_TOO_MANY_DELAYED_THREADS    @tab 1151       @tab HY000
@item ER_ABORTING_CONNECTION         @tab 1152       @tab 08S01
@item ER_NET_PACKET_TOO_LARGE        @tab 1153       @tab 08S01
@item ER_NET_READ_ERROR_FROM_PIPE    @tab 1154       @tab 08S01
@item ER_NET_FCNTL_ERROR             @tab 1155       @tab 08S01
@item ER_NET_PACKETS_OUT_OF_ORDER    @tab 1156       @tab 08S01
@item ER_NET_UNCOMPRESS_ERROR        @tab 1157       @tab 08S01
@item ER_NET_READ_ERROR              @tab 1158       @tab 08S01
@item ER_NET_READ_INTERRUPTED        @tab 1159       @tab 08S01
@item ER_NET_ERROR_ON_WRITE          @tab 1160       @tab 08S01
@item ER_NET_WRITE_INTERRUPTED       @tab 1161       @tab 08S01
@item ER_TOO_LONG_STRING             @tab 1162       @tab 42000
@item ER_TABLE_CANT_HANDLE_BLOB      @tab 1163       @tab 42000
@item ER_TABLE_CANT_HANDLE_AUTO_INCREMENT @tab 1164  @tab 42000
@item ER_DELAYED_INSERT_TABLE_LOCKED @tab 1165       @tab HY000
@item ER_WRONG_COLUMN_NAME           @tab 1166       @tab 42000
@item ER_WRONG_KEY_COLUMN            @tab 1167       @tab 42000
@item ER_WRONG_MRG_TABLE             @tab 1168       @tab HY000
@item ER_DUP_UNIQUE                  @tab 1169       @tab 23000
@item ER_BLOB_KEY_WITHOUT_LENGTH     @tab 1170       @tab 42000
@item ER_PRIMARY_CANT_HAVE_NULL      @tab 1171       @tab 42000
@item ER_TOO_MANY_ROWS               @tab 1172       @tab 42000
@item ER_REQUIRES_PRIMARY_KEY        @tab 1173       @tab 42000
@item ER_NO_RAID_COMPILED            @tab 1174       @tab HY000
@item ER_UPDATE_WITHOUT_KEY_IN_SAFE_MODE @tab 1175   @tab HY000
@item ER_KEY_DOES_NOT_EXITS          @tab 1176       @tab HY000
@item ER_CHECK_NO_SUCH_TABLE         @tab 1177       @tab 42000
@item ER_CHECK_NOT_IMPLEMENTED       @tab 1178       @tab 42000
@item ER_CANT_DO_THIS_DURING_AN_TRANSACTION @tab 1179 @tab 25000
@item ER_ERROR_DURING_COMMIT         @tab 1180       @tab HY000
@item ER_ERROR_DURING_ROLLBACK       @tab 1181       @tab HY000
@item ER_ERROR_DURING_FLUSH_LOGS     @tab 1182       @tab HY000
@item ER_ERROR_DURING_CHECKPOINT     @tab 1183       @tab HY000
@item ER_NEW_ABORTING_CONNECTION     @tab 1184       @tab 08S01
@item ER_DUMP_NOT_IMPLEMENTED        @tab 1185       @tab HY000
@item ER_FLUSH_MASTER_BINLOG_CLOSED  @tab 1186       @tab HY000
@item ER_INDEX_REBUILD               @tab 1187       @tab HY000
@item ER_MASTER                      @tab 1188       @tab HY000
@item ER_MASTER_NET_READ       @tab 1189       @tab 08S01
@item ER_MASTER_NET_WRITE      @tab 1190       @tab 08S01
@item ER_FT_MATCHING_KEY_NOT_FOUND   @tab 1191       @tab HY000
@item ER_LOCK_OR_ACTIVE_TRANSACTION  @tab 1192       @tab HY000
@item ER_UNKNOWN_SYSTEM_VARIABLE     @tab 1193       @tab HY000
@item ER_CRASHED_ON_USAGE            @tab 1194       @tab HY000
@item ER_CRASHED_ON_REPAIR           @tab 1195       @tab HY000
@item ER_WARNING_NOT_COMPLETE_ROLLBACK @tab 1196     @tab HY000
@item ER_TRANS_CACHE_FULL            @tab 1197       @tab HY000
@item ER_SLAVE_MUST_STOP             @tab 1198       @tab HY000
@item ER_SLAVE_NOT_RUNNING           @tab 1199       @tab HY000
@item ER_BAD_SLAVE                   @tab 1200       @tab HY000
@item ER_MASTER_INFO           @tab 1201       @tab HY000
@item ER_SLAVE_THREAD                @tab 1202       @tab HY000
@item ER_TOO_MANY_USER_CONNECTIONS   @tab 1203 @tab 42000
@item ER_SET_CONSTANTS_ONLY          @tab 1204       @tab HY000
@item ER_LOCK_WAIT_TIMEOUT           @tab 1205       @tab HY000
@item ER_LOCK_TABLE_FULL             @tab 1206       @tab HY000
@item ER_READ_ONLY_TRANSACTION       @tab 1207       @tab 25000
@item ER_DROP_DB_WITH_READ_LOCK      @tab 1208       @tab HY000
@item ER_CREATE_DB_WITH_READ_LOCK    @tab 1209       @tab HY000
@item ER_WRONG_ARGUMENTS             @tab 1210       @tab HY000
@item ER_NO_PERMISSION_TO_CREATE_USER @tab 1211      @tab 42000
@item ER_UNION_TABLES_IN_DIFFERENT_DIR @tab 1212     @tab HY000
@item ER_LOCK_DEADLOCK               @tab 1213       @tab 40001
@item ER_TABLE_CANT_HANDLE_FULLTEXT  @tab 1214       @tab HY000
@item ER_CANNOT_ADD_FOREIGN          @tab 1215       @tab HY000
@item ER_NO_REFERENCED_ROW           @tab 1216       @tab 23000
@item ER_ROW_IS_REFERENCED           @tab 1217       @tab 23000
@item ER_CONNECT_TO_MASTER           @tab 1218       @tab 08S01
@item ER_QUERY_ON_MASTER             @tab 1219       @tab HY000
@item ER_ERROR_WHEN_EXECUTING_COMMAND @tab 1220      @tab HY000
@item ER_WRONG_USAGE                 @tab 1221       @tab HY000
@item ER_WRONG_NUMBER_OF_COLUMNS_IN_SELECT @tab 1222 @tab 21000
@item ER_CANT_UPDATE_WITH_READLOCK   @tab 1223       @tab HY000
@item ER_MIXING_NOT_ALLOWED          @tab 1224       @tab HY000
@item ER_DUP_ARGUMENT                @tab 1225       @tab HY000
@item ER_USER_LIMIT_REACHED    @tab 1226       @tab 42000
@item ER_SPECIFIC_ACCESS_DENIED_ERROR @tab 1227      @tab HY000
@item ER_LOCAL_VARIABLE              @tab 1228       @tab HY000
@item ER_GLOBAL_VARIABLE             @tab 1229       @tab HY000
@item ER_NO_DEFAULT                  @tab 1230       @tab 42000
@item ER_WRONG_VALUE_FOR_VAR         @tab 1231       @tab 42000
@item ER_WRONG_TYPE_FOR_VAR          @tab 1232       @tab 42000
@item ER_VAR_CANT_BE_READ            @tab 1233       @tab HY000
@item ER_CANT_USE_OPTION_HERE        @tab 1234       @tab 42000
@item ER_NOT_SUPPORTED_YET           @tab 1235       @tab 42000
@item ER_MASTER_FATAL_ERROR_READING_BINLOG @tab 1236 @tab HY000
@item ER_SLAVE_IGNORED_TABLE         @tab 1237       @tab HY000
@item ER_WRONG_FK_DEF                @tab 1238       @tab 42000
@item ER_KEY_REF_DO_NOT_MATCH_TABLE_REF @tab 1239    @tab HY000
@item ER_CARDINALITY_COL             @tab 1240       @tab 21000
@item ER_SUBSELECT_NO_1_ROW          @tab 1241       @tab 21000
@item ER_UNKNOWN_STMT_HANDLER        @tab 1242       @tab HY000
@item ER_CORRUPT_HELP_DB             @tab 1243       @tab HY000
@item ER_CYCLIC_REFERENCE            @tab 1244       @tab HY000
@item ER_AUTO_CONVERT                @tab 1245       @tab HY000
@item ER_ILLEGAL_REFERENCE           @tab 1246       @tab 42S22
@item ER_DERIVED_MUST_HAVE_ALIAS     @tab 1247       @tab 42000
@item ER_SELECT_REDUCED              @tab 1248       @tab 01000
@item ER_TABLENAME_NOT_ALLOWED_HERE  @tab 1249       @tab 42000
@item ER_NOT_SUPPORTED_AUTH_MODE     @tab 1250       @tab 08004
@item ER_SPATIAL_CANT_HAVE_NULL      @tab 1251       @tab 42000
@item ER_COLLATION_CHARSET_MISMATCH  @tab 1252       @tab 42000
@item ER_SLAVE_WAS_RUNNING           @tab 1253       @tab HY000
@item ER_SLAVE_WAS_NOT_RUNNING       @tab 1254       @tab HY000
@item ER_TOO_BIG_FOR_UNCOMPRESS      @tab 1255       @tab HY000
@item ER_ZLIB_Z_MEM_ERROR            @tab 1256       @tab HY000
@item ER_ZLIB_Z_BUF_ERROR            @tab 1257       @tab HY000
@item ER_ZLIB_Z_DATA_ERROR           @tab 1258       @tab HY000
@item ER_CUT_VALUE_GROUP_CONCAT      @tab 1259       @tab HY000
@item ER_WARN_TOO_FEW_RECORDS        @tab 1260       @tab 01000
@item ER_WARN_TOO_MANY_RECORDS       @tab 1261       @tab 01000
@item ER_WARN_NULL_TO_NOTNULL        @tab 1262       @tab 01000
@item ER_WARN_DATA_OUT_OF_RANGE      @tab 1263       @tab 01000
@item ER_WARN_DATA_TRUNCATED         @tab 1264       @tab 01000
@item ER_WARN_USING_OTHER_HANDLER    @tab 1265 @tab 01000
@item ER_CANT_AGGREGATE_COLLATIONS   @tab 1266       @tab 42000
@item ER_DROP_USER                   @tab 1267       @tab 42000
@item ER_REVOKE_GRANTS               @tab 1268       @tab 42000
@item ER_CANT_AGGREGATE_3COLLATIONS  @tab 1269       @tab 42000
@item ER_CANT_AGGREGATE_NCOLLATIONS  @tab 1270       @tab 42000
@item ER_VARIABLE_IS_NOT_STRUCT      @tab 1271       @tab HY000
@item ER_UNKNOWN_COLLATION           @tab 1272       @tab HY000
@item ER_SLAVE_IGNORED_SSL_PARAMS    @tab 1273       @tab HY000
@item ER_SERVER_IS_IN_SECURE_AUTH_MODE @tab 1274     @tab HY000
@item ER_WARN_FIELD_RESOLVED         @tab 1275       @tab HY000
@item ER_BAD_SLAVE_UNTIL_COND        @tab 1276       @tab HY000
@item ER_MISSING_SKIP_SLAVE          @tab 1277       @tab HY000
@item ER_UNTIL_COND_IGNORED          @tab 1278       @tab HY000

@end multitable


@node Extending MySQL, Problems, Error-handling, Top
@chapter Extending MySQL

@menu
* MySQL internals::             MySQL Internals
* Adding functions::            Adding New Functions to MySQL
* Adding procedures::           Adding New Procedures to MySQL
@end menu


@node MySQL internals, Adding functions, Extending MySQL, Extending MySQL
@section MySQL Internals

@cindex internals
@cindex threads

This chapter describes a lot of things that you need to know when
working on the MySQL code. If you plan to contribute to MySQL
development, want to have access to the bleeding-edge in-between
versions code, or just want to keep track of development, follow the
instructions in @ref{Installing source tree}.
If you are interested in MySQL internals, you should also subscribe
to our @code{internals} mailing list. This list is relatively low
traffic. For details on how to subscribe, please see
@ref{Mailing-list}.
All developers at MySQL AB are on the @code{internals} list and we
help other people who are working on the MySQL code. Feel free to
use this list both to ask questions about the code and to send
patches that you would like to contribute to the MySQL project!

@menu
* MySQL threads::               MySQL Threads
* MySQL test suite::            MySQL Test Suite
@end menu


@node MySQL threads, MySQL test suite, MySQL internals, MySQL internals
@subsection MySQL Threads

The MySQL server creates the following threads:

@itemize @bullet

@item
The TCP/IP connection thread handles all connection requests and
creates a new dedicated thread to handle the authentication and
SQL query processing for each connection.

@item
On Windows NT there is a named pipe handler thread that does the same work as
the TCP/IP connection thread on named pipe connect requests.

@item
The signal thread handles all signals.  This thread also normally handles
alarms and calls @code{process_alarm()} to force timeouts on connections
that have been idle too long.

@item
If @code{mysqld} is compiled with @code{-DUSE_ALARM_THREAD}, a dedicated
thread that handles alarms is created.  This is only used on some systems where
there are problems with @code{sigwait()} or if one wants to use the
@code{thr_alarm()} code in ones application without a dedicated signal
handling thread.

@item
If one uses the @code{--flush_time=#} option, a dedicated thread is created
to flush all tables at the given interval.

@item
Every connection has its own thread.

@item
Every different table on which one uses @code{INSERT DELAYED} gets its
own thread.

@item
If you use @code{--master-host}, a slave replication thread will be
started to read and apply updates from the master.
@end itemize

@code{mysqladmin processlist} only shows the connection, @code{INSERT DELAYED},
and replication threads.


@node MySQL test suite,  , MySQL threads, MySQL internals
@subsection MySQL Test Suite

@cindex mysqltest, MySQL Test Suite
@cindex testing mysqld, mysqltest

Until recently, our main full-coverage test suite was based on proprietary
customer data and for that reason has not been publicly available. The only
publicly available part of our testing process consisted of the @code{crash-me}
test, a Perl DBI/DBD benchmark found in the @code{sql-bench} directory, and
miscellaneous tests located in @code{tests} directory. The lack of a
standardized publicly available test suite has made it difficult for our users,
as well developers, to do regression tests on the MySQL code. To address
this problem, we have created a new test system that is included in
Unix source distributions and binary distributions starting with Version
3.23.29.  The tests can be run under Unix, or on Windows in the Cygwin
environment if the server has been compiled under Cygwin. They cannot be
run in a native Windows environment currently.

The current set of test cases doesn't test everything in MySQL, but it
should catch most obvious bugs in the SQL processing code, OS/library
issues, and is quite thorough in testing replication.  Our eventual goal
is to have the tests cover 100% of the code.  We welcome contributions
to our test suite.  You may especially want to contribute tests that
examine the functionality critical to your system, as this will ensure
that all future MySQL releases will work well with your
applications.

@menu
* running mysqltest::           Running the MySQL Test Suite
* extending mysqltest::         Extending the MySQL Test Suite
* Reporting mysqltest bugs::    Reporting Bugs in the MySQL Test Suite
@end menu


@node running mysqltest, extending mysqltest, MySQL test suite, MySQL test suite
@subsubsection Running the MySQL Test Suite

The test system consist of a test language interpreter
(@code{mysqltest}), a shell script to run all
tests(@code{mysql-test-run}), the actual test cases written in a special
test language, and their expected results.  To run the test suite on
your system after a build, type @code{make test} or
@code{mysql-test/mysql-test-run} from the source root.  If you have
installed a binary distribution, @code{cd} to the install root
(eg. @code{/usr/local/mysql}), and do @code{scripts/mysql-test-run}.
All tests should succeed.  If not, you should try to find out why and
report the problem if this is a bug in MySQL.
@xref{Reporting mysqltest bugs}.

If you have a copy of @code{mysqld} running on the machine where you want to
run the test suite you do not have to stop it, as long as it is not using
ports @code{9306} and @code{9307}.  If one of those ports is taken, you should
edit @code{mysql-test-run} and change the values of the master and/or slave
port to one that is available.

You can run one individual test case with
@code{mysql-test/mysql-test-run test_name}.

If one test fails, you should test running @code{mysql-test-run} with
the @code{--force} option to check if any other tests fails.


@node extending mysqltest, Reporting mysqltest bugs, running mysqltest, MySQL test suite
@subsubsection Extending the MySQL Test Suite

You can use the @code{mysqltest} language to write your own test cases.
Unfortunately, we have not yet written full documentation for it.
You can, however, look at our current test cases and use
them as an example.  The following points should help you get started:

@itemize @bullet
@item
The tests are located in @code{mysql-test/t/*.test}

@item
A test case consists of @code{;} terminated statements and is similar to the
input of @code{mysql} command-line client.  A statement by default is a query
to be sent to MySQL server, unless it is recognized as internal
command (eg. @code{sleep}).

@item
All queries that produce results---for example, @code{SELECT}, @code{SHOW},
@code{EXPLAIN}, etc., must be preceded with @code{@@/path/to/result/file}.  The
file must contain the expected results.  An easy way to generate the result
file is to run @code{mysqltest -r < t/test-case-name.test} from
@code{mysql-test} directory, and then edit the generated result files, if
needed, to adjust them to the expected output.  In that case, be very careful
about not adding or deleting any invisible characters - make sure to only
change the text and/or delete lines.  If you have to insert a line, make sure
the fields are separated with a hard tab, and there is a hard tab at the end.
You may want to use @code{od -c} to make sure your text editor has not messed
anything up during edit.  We hope that you will never have to edit the output
of @code{mysqltest -r} as you only have to do it when you find a bug.

@item
To be consistent with our setup, you should put your result files in
@code{mysql-test/r} directory and name them @code{test_name.result}.  If the
test produces more than one result, you should use @code{test_name.a.result},
@code{test_name.b.result}, etc.

@item
If a statement returns an error, you should on the line before the statement
specify with the @code{--error error-number}.  The error number can be
a list of possible error numbers separated with @code{','}.

@item
If you are writing a replication test case, you should on the first line of
the test file, put @code{source include/master-slave.inc;}.  To switch between
master and slave, use @code{connection master;} and @code{connection slave;}.
If you need to do something on an alternate connection, you can do
@code{connection master1;} for the master, and @code{connection slave1;} for
the slave.

@item
If you need to do something in a loop, you can use something like this:
@example
let $1=1000;
while ($1)
@{
 # do your queries here
 dec $1;
@}
@end example

@item
To sleep between queries, use the @code{sleep} command. It supports fractions
of a second, so you can do @code{sleep 1.3;}, for example, to sleep 1.3
seconds.

@item
To run the slave with additional options for your test case, put them
in the command-line format in @code{mysql-test/t/test_name-slave.opt}. For
the master, put them in @code{mysql-test/t/test_name-master.opt}.

@item
If you have a question about the test suite, or have a test case to contribute,
send an email message to the MySQL internals mailing list.
@xref{Mailing-list}.
As this list does not accept
attachments, you should ftp all the relevant files to:
@uref{ftp://support.mysql.com/pub/mysql/Incoming/}

@end itemize


@node Reporting mysqltest bugs,  , extending mysqltest, MySQL test suite
@subsubsection Reporting Bugs in the MySQL Test Suite

If your MySQL version doesn't pass the test suite you should
do the following:

@itemize @bullet
@item
Don't send a bug report before you have found out as much as possible of
what when wrong!  When you do it, please use the @code{mysqlbug} script
so that we can get information about your system and @code{MySQL}
version. @xref{Bug reports}.
@item
Make sure to include the output of @code{mysql-test-run}, as well as
contents of all @code{.reject} files in @code{mysql-test/r} directory.
@item
If a test in the test suite fails, check if the test fails also when run
by its own:

@example
cd mysql-test
mysql-test-run --local test-name
@end example

If this fails, then you should configure MySQL with
@code{--with-debug} and run @code{mysql-test-run} with the
@code{--debug} option. If this also fails send the trace file
@file{var/tmp/master.trace} to ftp://support.mysql.com/pub/mysql/secret
so that we can examine it. Please remember to also include a full
description of your system, the version of the mysqld binary and how you
compiled it.

@item
Try also to run @code{mysql-test-run} with the @code{--force} option to
see if there is any other test that fails.

@item
If you have compiled MySQL yourself, check our manual for how
to compile MySQL on your platform or, preferable, use one of
the binaries we have compiled for you at
@uref{http://www.mysql.com/downloads/}.  All our standard binaries should
pass the test suite !

@item
If you get an error, like @code{Result length mismatch} or @code{Result
content mismatch} it means that the output of the test didn't match
exactly the expected output. This could be a bug in MySQL or
that your mysqld version produces slight different results under some
circumstances.

Failed test results are put in a file with the same base name as the
result file with the @code{.reject} extension.  If your test case is
failing, you should do a diff on the two files.  If you cannot see how
they are different, examine both with @code{od -c} and also check their
lengths.

@item
If a test fails totally, you should check the logs file in the
@code{mysql-test/var/log} directory for hints of what went wrong.

@item
If you have compiled MySQL with debugging you can try to debug this
by running @code{mysql-test-run} with the @code{--gdb} and/or @code{--debug}
options.
@xref{Making trace files}.

If you have not compiled MySQL for debugging you should probably
do that.  Just specify the @code{--with-debug} options to @code{configure}!
@xref{Installing source}.
@end itemize


@node Adding functions, Adding procedures, MySQL internals, Extending MySQL
@section Adding New Functions to MySQL

@cindex functions, new
@cindex adding, new functions
@cindex user-defined functions, adding
@cindex UDFs, defined
@cindex functions, user-defined

There are two ways to add new functions to MySQL:

@itemize @bullet
@item You can add the function through the user-defined function (UDF)
interface.  User-defined functions are added and removed dynamically using
the @code{CREATE FUNCTION} and @code{DROP FUNCTION} statements.
@xref{CREATE FUNCTION, , @code{CREATE FUNCTION}}.

@item You can add the function as a native (built in) MySQL function.
Native functions are compiled into the @code{mysqld} server and become
available on a permanent basis.
@end itemize

Each method has advantages and disadvantages:

@itemize @bullet
@item
If you write a user-defined function, you must install the object file
in addition to the server itself.  If you compile your function into the
server, you don't need to do that.
@item
You can add UDFs to a binary MySQL distribution.  Native functions
require you to modify a source distribution.
@item
If you upgrade your MySQL distribution, you can continue to use your
previously installed UDFs.  For native functions, you must repeat your
modifications each time you upgrade.
@end itemize

Whichever method you use to add new functions, they may be used just like
native functions such as @code{ABS()} or @code{SOUNDEX()}.

@menu
* CREATE FUNCTION::             @code{CREATE FUNCTION/DROP FUNCTION} Syntax
* Adding UDF::                  Adding a New User-defined Function
* Adding native function::      Adding a New Native Function
@end menu


@node CREATE FUNCTION, Adding UDF, Adding functions, Adding functions
@subsection @code{CREATE FUNCTION/DROP FUNCTION} Syntax

@findex CREATE FUNCTION
@findex DROP FUNCTION
@cindex deleting, function
@cindex function, deleting
@findex UDF functions
@findex User-defined functions
@findex Functions, user-defined

@c help_category Functions
@c example_for_help_topic FUNCTION
@example
CREATE [AGGREGATE] FUNCTION function_name RETURNS @{STRING|REAL|INTEGER@}
       SONAME shared_library_name

DROP FUNCTION function_name
@end example
@c help_category Functions
@c description_for_help_topic FUNCTION  AGGREGATE CREATE FUNCTION DROP STRING REAL INTEGER RETURNS SONAME
A user-defined function (UDF) is a way to extend MySQL with a new
function that works like native (built in) MySQL function such as
@code{ABS()} and @code{CONCAT()}.

@code{AGGREGATE} is a new option for MySQL Version 3.23.  An
@code{AGGREGATE} function works exactly like a native MySQL
@code{GROUP} function like @code{SUM} or @code{COUNT()}.

@code{CREATE FUNCTION} saves the function's name, type, and shared library
name in the @code{mysql.func} system table.  You must have the
@code{INSERT} and @code{DELETE} privileges for the @code{mysql} database
to create and drop functions.
@c end_description_for_help_topic

All active functions are reloaded each time the server starts, unless
you start @code{mysqld} with the @code{--skip-grant-tables} option.  In
this case, UDF initialization is skipped and UDFs are unavailable.
(An active function is one that has been loaded with @code{CREATE FUNCTION}
and not removed with @code{DROP FUNCTION}.)

For instructions on writing user-defined functions, see @ref{Adding
functions}.  For the UDF mechanism to work, functions must be written in C or
C++, your operating system must support dynamic loading and you must have
compiled @code{mysqld} dynamically (not statically).

Note that to make @code{AGGREGATE} work, you must have a
@code{mysql.func} table that contains the column @code{type}.  If you do not
have this table, you should run the script
@code{mysql_fix_privilege_tables} to create it.


@node Adding UDF, Adding native function, CREATE FUNCTION, Adding functions
@subsection Adding a New User-defined Function

@cindex adding, user-defined functions
@cindex user-defined functions, adding
@cindex functions, user-defined, adding

@menu
* UDF calling::                 UDF Calling Sequences for simple functions
* UDF aggr. calling::           UDF Calling Sequences for aggregate functions
* UDF arguments::               Argument Processing
* UDF return values::           Return Values and Error Handling
* UDF compiling::               Compiling and Installing User-defined Functions
@end menu


For the UDF mechanism to work, functions must be written in C or C++ and your
operating system must support dynamic loading.  The MySQL source
distribution includes a file @file{sql/udf_example.cc} that defines 5 new
functions.  Consult this file to see how UDF calling conventions work.

For @code{mysqld} to be able to use UDF functions, you should configure MySQL
with @code{--with-mysqld-ldflags=-rdynamic} The reason is that to on
many platforms (including Linux) you can load a dynamic library (with
@code{dlopen()}) from a static linked program, which you would get if
you are using @code{--with-mysqld-ldflags=-all-static} If you want to
use an UDF that needs to access symbols from @code{mysqld} (like the
@code{metaphone} example in @file{sql/udf_example.cc} that uses
@code{default_charset_info}), you must link the program with
@code{-rdynamic} (see @code{man dlopen}).

If you are using a precompiled version of the server, use MySQL-Max,
which supports dynamic loading.

For each function that you want to use in SQL statements, you should define
corresponding C (or C++) functions.  In the discussion below, the name
``xxx'' is used for an example function name.  To distinguish between SQL and
C/C++ usage, @code{XXX()} (uppercase) indicates an SQL function call, and
@code{xxx()} (lowercase) indicates a C/C++ function call.

The C/C++ functions that you write to implement the interface for
@code{XXX()} are:

@table @asis
@item @code{xxx()} (required)
The main function.  This is where the function result is computed.
The correspondence between the SQL type and return type of your C/C++
function is shown here:

@multitable @columnfractions .15 .15
@item @strong{SQL type} @tab @strong{C/C++ type}
@item @code{STRING}     @tab @code{char *}
@item @code{INTEGER}    @tab @code{long long}
@item @code{REAL}       @tab @code{double}
@end multitable

@item @code{xxx_init()} (optional)
The initialization function for @code{xxx()}.  It can be used to:

@itemize @bullet
@item
Check the number of arguments to @code{XXX()}.
@item
Check that the arguments are of a required type or, alternatively,
tell MySQL to coerce arguments to the types you want when
the main function is called.
@item
Allocate any memory required by the main function.
@item
Specify the maximum length of the result.
@item
Specify (for @code{REAL} functions) the maximum number of decimals.
@item
Specify whether the result can be @code{NULL}.
@end itemize

@item @code{xxx_deinit()} (optional)
The deinitialization function for @code{xxx()}.  It should deallocate any
memory allocated by the initialization function.
@end table

When an SQL statement invokes @code{XXX()}, MySQL calls the
initialization function @code{xxx_init()} to let it perform any required
setup, such as argument checking or memory allocation.  If @code{xxx_init()}
returns an error, the SQL statement is aborted with an error message and the
main and deinitialization functions are not called.  Otherwise, the main
function @code{xxx()} is called once for each row.  After all rows have been
processed, the deinitialization function @code{xxx_deinit()} is called so it
can perform any required cleanup.

For aggregate functions (like @code{SUM()}), you must also provide the
following functions:

@table @asis
@item @code{xxx_reset()} (required)
Reset sum and insert the argument as the initial value for a new group.
@item @code{xxx_add()} (required)
Add the argument to the old sum.
@end table

When using aggregate UDFs, MySQL works the following way:

@enumerate
@item
Call @code{xxx_init()} to let the aggregate function allocate the memory it
will need to store results.
@item
Sort the table according to the @code{GROUP BY} expression.
@item
For the first row in a new group, call the @code{xxx_reset()} function.
@item
For each new row that belongs in the same group, call the
@code{xxx_add()} function.
@item
When the group changes or after the last row has been processed,
call @code{xxx()} to get the result for the aggregate.
@item
Repeat 3-5 until all rows has been processed
@item
Call @code{xxx_deinit()} to let the UDF free any memory it has allocated.
@end enumerate

All functions must be thread-safe (not just the main function,
but the initialization and deinitialization functions as well). This means
that you are not allowed to allocate any global or static variables that
change!  If you need memory, you should allocate it in @code{xxx_init()}
and free it in @code{xxx_deinit()}.


@node UDF calling, UDF aggr. calling, Adding UDF, Adding UDF
@subsubsection UDF Calling Sequences for simple functions

@cindex calling sequences for simple functions, UDF

The main function should be declared as shown here.  Note that the return
type and parameters differ, depending on whether you will declare the SQL
function @code{XXX()} to return @code{STRING}, @code{INTEGER}, or @code{REAL}
in the @code{CREATE FUNCTION} statement:

@noindent
For @code{STRING} functions:

@example
char *xxx(UDF_INIT *initid, UDF_ARGS *args,
          char *result, unsigned long *length,
          char *is_null, char *error);
@end example

@noindent
For @code{INTEGER} functions:

@example
long long xxx(UDF_INIT *initid, UDF_ARGS *args,
              char *is_null, char *error);
@end example

@noindent
For @code{REAL} functions:

@example
double xxx(UDF_INIT *initid, UDF_ARGS *args,
              char *is_null, char *error);
@end example

The initialization and deinitialization functions are declared like this:

@example
my_bool xxx_init(UDF_INIT *initid, UDF_ARGS *args, char *message);

void xxx_deinit(UDF_INIT *initid);
@end example

The @code{initid} parameter is passed to all three functions.  It points to a
@code{UDF_INIT} structure that is used to communicate information between
functions.  The @code{UDF_INIT} structure members follow.  The
initialization function should fill in any members that it wishes to change.
(To use the default for a member, leave it unchanged.):

@table @code
@item my_bool maybe_null
@code{xxx_init()} should set @code{maybe_null} to @code{1} if @code{xxx()}
can return @code{NULL}.  The default value is @code{1} if any of the
arguments are declared @code{maybe_null}.

@item unsigned int decimals
Number of decimals.  The default value is the maximum number of decimals in
the arguments passed to the main function.  (For example, if the function is
passed @code{1.34}, @code{1.345}, and @code{1.3}, the default would be 3,
because @code{1.345} has 3 decimals.

@item unsigned int max_length
The maximum length of the string result.  The default value differs depending
on the result type of the function.  For string functions, the default is the
length of the longest argument.  For integer functions, the default is 21
digits.  For real functions, the default is 13 plus the number of decimals
indicated by @code{initid->decimals}.  (For numeric functions, the length
includes any sign or decimal point characters.)

If you want to return a blob, you can set this to 65K or 16M; this
memory is not allocated but used to decide which column type to use if
there is a need to temporary store the data.

@item char *ptr
A pointer that the function can use for its own purposes.  For example,
functions can use @code{initid->ptr} to communicate allocated memory
between functions.  In @code{xxx_init()}, allocate the memory and assign it
to this pointer:

@example
initid->ptr = allocated_memory;
@end example

In @code{xxx()} and @code{xxx_deinit()}, refer to @code{initid->ptr} to use
or deallocate the memory.
@end table


@node UDF aggr. calling, UDF arguments, UDF calling, Adding UDF
@subsubsection UDF Calling Sequences for aggregate functions

@cindex calling sequences for aggregate functions, UDF

Here follows a description of the different functions you need to define
when you want to create an aggregate UDF function.

Note that the following function is NOT needed or used by MySQL 4.1.1.
You can keep still have define his function if you want to have your
code work with both MySQL 4.0 and MySQL 4.1.1

@example
char *xxx_reset(UDF_INIT *initid, UDF_ARGS *args,
                char *is_null, char *error);
@end example

This function is called when MySQL finds the first row in a new group.
In the function you should reset any internal summary variables and then set
the given argument as the first argument in the group.

In many cases this is implemented internally by reseting all variables
(for example by calling @code{xxx_clear()} and then calling
@code{xxx_add()}.

The following function is only required by MySQL 4.1.1 and above:

@example
char *xxx_clear(UDF_INIT *initid, char *is_null, char *error);
@end example

This function is called when MySQL needs to reset the summary results.
This will be called at the beginning for each new group but can also be
called to reset the values for a query where there was no matching rows.
@code{is_null} will be set to point to @code{CHAR(0)} before calling
@code{xxx_clear()}.

You can use the @code{error} pointer to store a byte if something went
wrong .

@example
char *xxx_add(UDF_INIT *initid, UDF_ARGS *args,
              char *is_null, char *error);
@end example

This function is called for all rows that belongs to the same group,
except for the first row. In this you should add the value in UDF_ARGS
to your internal summary variable.

The @code{xxx()} function should be declared identical as when you
define a simple UDF function. @xref{UDF calling}.

This function is called when all rows in the group has been processed.
You should normally never access the @code{args} variable here but
return your value based on your internal summary variables.

All argument processing in @code{xxx_reset()} and @code{xxx_add()}
should be done identically as for normal UDFs. @xref{UDF arguments}.

The return value handling in @code{xxx()} should be done identically as
for a normal UDF. @xref{UDF return values}.

The pointer argument to @code{is_null} and @code{error} is the same for
all calls to @code{xxx_reset()}, @code{xxx_clear()}, @code{xxx_add()} and
@code{xxx()}.
You can use this to remember that you got an error or if the @code{xxx()}
function should return @code{NULL}. Note that you should not store a string
into @code{*error}!  This is just a 1 byte flag!

@code{is_null} is reset for each group (before calling @code{xxx_clear()}
@code{error} is never reset.

If @code{isnull} or @code{error} are set after @code{xxx()} then MySQL
will return @code{NULL} as the result for the group function.

@node UDF arguments, UDF return values, UDF aggr. calling, Adding UDF
@subsubsection Argument Processing

@cindex argument processing
@cindex processing, arguments

The @code{args} parameter points to a @code{UDF_ARGS} structure that has the
members listed here:

@table @code
@item unsigned int arg_count
The number of arguments.  Check this value in the initialization function
if you want your function to be called with a particular number of arguments.
For example:

@example
if (args->arg_count != 2)
@{
    strcpy(message,"XXX() requires two arguments");
    return 1;
@}
@end example


@item enum Item_result *arg_type
The types for each argument.  The possible type values are
@code{STRING_RESULT}, @code{INT_RESULT}, and @code{REAL_RESULT}.

To make sure that arguments are of a given type and return an
error if they are not, check the @code{arg_type} array in the initialization
function.  For example:

@example
if (args->arg_type[0] != STRING_RESULT ||
    args->arg_type[1] != INT_RESULT)
@{
    strcpy(message,"XXX() requires a string and an integer");
    return 1;
@}
@end example

As an alternative to requiring your function's arguments to be of particular
types, you can use the initialization function to set the @code{arg_type}
elements to the types you want.  This causes MySQL to coerce
arguments to those types for each call to @code{xxx()}.  For example, to
specify coercion of the first two arguments to string and integer, do this in
@code{xxx_init()}:

@example
args->arg_type[0] = STRING_RESULT;
args->arg_type[1] = INT_RESULT;
@end example

@item char **args
@code{args->args} communicates information to the initialization function
about the general nature of the arguments your function was called with.  For a
constant argument @code{i}, @code{args->args[i]} points to the argument
value.  (See below for instructions on how to access the value properly.)
For a non-constant argument, @code{args->args[i]} is @code{0}.
A constant argument is an expression that uses only constants, such as
@code{3} or @code{4*7-2} or @code{SIN(3.14)}.  A non-constant argument is an
expression that refers to values that may change from row to row, such as
column names or functions that are called with non-constant arguments.

For each invocation of the main function, @code{args->args} contains the
actual arguments that are passed for the row currently being processed.

Functions can refer to an argument @code{i} as follows:

@itemize @bullet
@item
An argument of type @code{STRING_RESULT} is given as a string pointer plus a
length, to allow handling of binary data or data of arbitrary length.  The
string contents are available as @code{args->args[i]} and the string length
is @code{args->lengths[i]}.  You should not assume that strings are
null-terminated.

@item
For an argument of type @code{INT_RESULT}, you must cast
@code{args->args[i]} to a @code{long long} value:

@example
long long int_val;
int_val = *((long long*) args->args[i]);
@end example

@item
For an argument of type @code{REAL_RESULT}, you must cast
@code{args->args[i]} to a @code{double} value:

@example
double    real_val;
real_val = *((double*) args->args[i]);
@end example
@end itemize

@item unsigned long *lengths
For the initialization function, the @code{lengths} array indicates the
maximum string length for each argument. You should not change these.
For each invocation of the main function, @code{lengths} contains the
actual lengths of any string arguments that are passed for the row
currently being processed.  For arguments of types @code{INT_RESULT} or
@code{REAL_RESULT}, @code{lengths} still contains the maximum length of
the argument (as for the initialization function).
@end table


@node UDF return values, UDF compiling, UDF arguments, Adding UDF
@subsubsection Return Values and Error Handling

@cindex UDFs, return values
@cindex return values, UDFs
@cindex errors, handling for UDFs
@cindex handling, errors

The initialization function should return @code{0} if no error occurred and
@code{1} otherwise.  If an error occurs, @code{xxx_init()} should store a
null-terminated error message in the @code{message} parameter.  The message
will be returned to the client.  The message buffer is
@code{MYSQL_ERRMSG_SIZE} characters long, but you should try to keep the
message to less than 80 characters so that it fits the width of a standard
terminal screen.

The return value of the main function @code{xxx()} is the function value, for
@code{long long} and @code{double} functions.  A string functions should
return a pointer to the result and store the length of the string in the
@code{length} arguments.

Set these to the contents and length of the return value.  For example:

@example
memcpy(result, "result string", 13);
*length = 13;
@end example

The @code{result} buffer that is passed to the calc function is 255 byte
big. If your result fits in this, you don't have to worry about memory
allocation for results.

If your string function needs to return a string longer than 255 bytes,
you must allocate the space for it with @code{malloc()} in your
@code{xxx_init()} function or your @code{xxx()} function and free it in
your @code{xxx_deinit()} function.  You can store the allocated memory
in the @code{ptr} slot in the @code{UDF_INIT} structure for reuse by
future @code{xxx()} calls.  @xref{UDF calling}.

To indicate a return value of @code{NULL} in the main function, set
@code{is_null} to @code{1}:

@example
*is_null = 1;
@end example

To indicate an error return in the main function, set the @code{error}
parameter to @code{1}:

@example
*error = 1;
@end example

If @code{xxx()} sets @code{*error} to @code{1} for any row, the function
value is @code{NULL} for the current row and for any subsequent rows
processed by the statement in which @code{XXX()} was invoked.  (@code{xxx()}
will not even be called for subsequent rows.) @strong{Note:} In
MySQL versions prior to 3.22.10, you should set both @code{*error}
and @code{*is_null}:

@example
*error = 1;
*is_null = 1;
@end example


@node UDF compiling,  , UDF return values, Adding UDF
@subsubsection Compiling and Installing User-defined Functions

@cindex compiling, user-defined functions
@cindex UDFs, compiling
@cindex installing, user-defined functions

Files implementing UDFs must be compiled and installed on the host where the
server runs.  This process is described below for the example UDF file
@file{udf_example.cc} that is included in the MySQL source
distribution.  This file contains the following functions:

@itemize @bullet
@item
@code{metaphon()} returns a metaphon string of the string argument.
This is something like a soundex string, but it's more tuned for English.
@item
@code{myfunc_double()} returns the sum of the ASCII values of the
characters in its arguments, divided by the sum of the length of its arguments.
@item
@code{myfunc_int()} returns the sum of the length of its arguments.
@item
@code{sequence([const int])} returns an sequence starting from the given
number or 1 if no number has been given.
@item
@code{lookup()} returns the IP number for a hostname.
@item
@code{reverse_lookup()} returns the hostname for an IP number.
The function may be called with a string @code{"xxx.xxx.xxx.xxx"} or
four numbers.
@end itemize

A dynamically loadable file should be compiled as a sharable object file,
using a command something like this:

@example
shell> gcc -shared -o udf_example.so myfunc.cc
@end example

You can easily find out the correct compiler options for your system by
running this command in the @file{sql} directory of your MySQL
source tree:

@example
shell> make udf_example.o
@end example

You should run a compile command similar to the one that @code{make} displays,
except that you should remove the @code{-c} option near the end of the line
and add @code{-o udf_example.so} to the end of the line.  (On some systems,
you may need to leave  the @code{-c} on the command.)

Once you compile a shared object containing UDFs, you must install it and
tell MySQL about it. Compiling a shared object from @file{udf_example.cc}
produces a file named something like @file{udf_example.so} (the exact name
may vary from platform to platform). Copy this file to some directory
searched by the dynamic linker @code{ld}, such as @file{/usr/lib} or add the
directory in which you placed the shared object to the linker configuration
file (for example, @file{/etc/ld.so.conf}).

On many systems, you can also set the @code{LD_LIBRARY} or
@code{LD_LIBRARY_PATH} environment variable to point at the directory where
you have your UDF function files. The @code{dlopen} manual page tells you
which variable you should use on your system. You should set this in
@code{mysql.server} or @code{mysqld_safe} startup scripts and restart
@code{mysqld}.

After the library is installed, notify @code{mysqld} about the new
functions with these commands:

@example
mysql> CREATE FUNCTION metaphon RETURNS STRING SONAME "udf_example.so";
mysql> CREATE FUNCTION myfunc_double RETURNS REAL SONAME "udf_example.so";
mysql> CREATE FUNCTION myfunc_int RETURNS INTEGER SONAME "udf_example.so";
mysql> CREATE FUNCTION lookup RETURNS STRING SONAME "udf_example.so";
mysql> CREATE FUNCTION reverse_lookup
    ->        RETURNS STRING SONAME "udf_example.so";
mysql> CREATE AGGREGATE FUNCTION avgcost
    ->        RETURNS REAL SONAME "udf_example.so";
@end example

Functions can be deleted using @code{DROP FUNCTION}:

@example
mysql> DROP FUNCTION metaphon;
mysql> DROP FUNCTION myfunc_double;
mysql> DROP FUNCTION myfunc_int;
mysql> DROP FUNCTION lookup;
mysql> DROP FUNCTION reverse_lookup;
mysql> DROP FUNCTION avgcost;
@end example

The @code{CREATE FUNCTION} and @code{DROP FUNCTION} statements update the
system table @code{func} in the @code{mysql} database.  The function's name,
type and shared library name are saved in the table.  You must have the
@code{INSERT} and @code{DELETE} privileges for the @code{mysql} database
to create and drop functions.

You should not use @code{CREATE FUNCTION} to add a function that has already
been created.  If you need to reinstall a function, you should remove it with
@code{DROP FUNCTION} and then reinstall it with @code{CREATE FUNCTION}.  You
would need to do this, for example, if you recompile a new version of your
function, so that @code{mysqld} gets the new version.  Otherwise, the server
will continue to use the old version.

Active functions are reloaded each time the server starts, unless you start
@code{mysqld} with the @code{--skip-grant-tables} option.  In this case, UDF
initialization is skipped and UDFs are unavailable.  (An active function is
one that has been loaded with @code{CREATE FUNCTION} and not removed with
@code{DROP FUNCTION}.)


@node Adding native function,  , Adding UDF, Adding functions
@subsection Adding a New Native Function

@cindex adding, native functions
@cindex native functions, adding
@cindex functions, native, adding

The procedure for adding a new native function is described here.  Note
that you cannot add native functions to a binary distribution because
the procedure involves modifying MySQL source code.  You must
compile MySQL yourself from a source distribution.  Also note
that if you migrate to another version of MySQL (for example,
when a new version is released), you will need to repeat the procedure
with the new version.

To add a new native MySQL function, follow these steps:

@enumerate
@item
Add one line to @file{lex.h} that defines the function name in the
@code{sql_functions[]} array.
@item
If the function prototype is simple (just takes zero, one, two or three
arguments), you should in lex.h specify SYM(FUNC_ARG#) (where # is the
number of arguments) as the second argument in the
@code{sql_functions[]} array and add a function that creates a function
object in @file{item_create.cc}.  Take a look at @code{"ABS"} and
@code{create_funcs_abs()} for an example of this.

If the function prototype is complicated (for example takes a variable number
of arguments), you should add two lines to @file{sql_yacc.yy}. One
indicates the preprocessor symbol that @code{yacc} should define (this
should be added at the beginning of the file). Then define the function
parameters and add an ``item'' with these parameters to the
@code{simple_expr} parsing rule.  For an example, check all occurrences
of @code{ATAN} in @file{sql_yacc.yy} to see how this is done.
@item
In @file{item_func.h}, declare a class inheriting from @code{Item_num_func} or
@code{Item_str_func}, depending on whether your function returns a number or a
string.
@item
In @file{item_func.cc}, add one of the following declarations, depending
on whether you are defining a numeric or string function:
@example
double   Item_func_newname::val()
longlong Item_func_newname::val_int()
String  *Item_func_newname::Str(String *str)
@end example

If you inherit your object from any of the standard items (like
@code{Item_num_func}), you probably only have to define one of the above
functions and let the parent object take care of the other functions.
For example, the @code{Item_str_func} class defines a @code{val()} function
that executes @code{atof()} on the value returned by @code{::str()}.

@item
You should probably also define the following object function:
@example
void Item_func_newname::fix_length_and_dec()
@end example
This function should at least calculate @code{max_length} based on the
given arguments. @code{max_length} is the maximum number of characters
the function may return.  This function should also set @code{maybe_null
= 0} if the main function can't return a @code{NULL} value.  The
function can check if any of the function arguments can return
@code{NULL} by checking the arguments @code{maybe_null} variable. You
can take a look at @code{Item_func_mod::fix_length_and_dec} for a
typical example of how to do this.
@end enumerate

All functions must be thread-safe (in other words, don't use any global or
static variables in the functions without protecting them with mutexes).

If you want to return @code{NULL}, from @code{::val()}, @code{::val_int()}
or @code{::str()} you should set @code{null_value} to 1 and return 0.

For @code{::str()} object functions, there are some additional
considerations to be aware of:

@itemize @bullet
@item
The @code{String *str} argument provides a string buffer that may be
used to hold the result. (For more information about the @code{String} type,
take a look at the @file{sql_string.h} file.)
@item
The @code{::str()} function should return the string that holds the result or
@code{(char*) 0} if the result is @code{NULL}.
@item
All current string functions try to avoid allocating any memory unless
absolutely necessary!
@end itemize


@node Adding procedures,  , Adding functions, Extending MySQL
@section Adding New Procedures to MySQL

@cindex procedures, adding
@cindex adding, procedures
@cindex new procedures, adding

In MySQL, you can define a procedure in C++ that can access and
modify the data in a query before it is sent to the client.  The modification
can be done on row-by-row or @code{GROUP BY} level.

We have created an example procedure in MySQL Version 3.23 to
show you what can be done.

Additionally we recommend you to take a look at @code{mylua}.
With this you can use the LUA language to load a procedure at
runtime into @code{mysqld}.

@menu
* procedure analyse::           Procedure Analyse
* Writing a procedure::         Writing a Procedure
@end menu


@node procedure analyse, Writing a procedure, Adding procedures, Adding procedures
@subsection Procedure Analyse

@code{analyse([max elements,[max memory]])}

This procedure is defined in the @file{sql/sql_analyse.cc}.  This
examines the result from your query and returns an analysis of the
results:

@itemize @bullet
@item
@code{max elements} (default 256) is the maximum number of distinct values
@code{analyse} will notice per column.  This is used by @code{analyse} to check if
the optimal column type should be of type @code{ENUM}.
@item
@code{max memory} (default 8192) is the maximum memory @code{analyse} should
allocate per column while trying to find all distinct values.
@end itemize

@example
SELECT ... FROM ... WHERE ... PROCEDURE ANALYSE([max elements,[max memory]])
@end example


@node Writing a procedure,  , procedure analyse, Adding procedures
@subsection Writing a Procedure

For the moment, the only documentation for this is the source.

You can find all information about procedures by examining the following files:

@itemize @bullet
@item @file{sql/sql_analyse.cc}
@item @file{sql/procedure.h}
@item @file{sql/procedure.cc}
@item @file{sql/sql_select.cc}
@end itemize


@node Problems, Credits, Extending MySQL, Top
@appendix Problems and Common Errors

@cindex problems, common errors
@cindex errors, common

@menu
* What is crashing::            How to Determine What Is Causing Problems
* Common errors::               Common Errors When Using MySQL
* Installation Issues::         Installation Related Issues
* Administration Issues::       Administration Related Issues
* Query Issues::                Query Related Issues
* Optimiser Issues::            Optimizer Related Issues
* Table Definition Issues::     Table Definition Related Issues
@end menu

This chapter lists some common problems and error messages that users have
run into.  You will learn how to figure out what the problem is, and what
to do to solve it.  You will also find proper solutions to some common
problems.


@node What is crashing, Common errors, Problems, Problems
@appendixsec How to Determine What Is Causing Problems

When you run into problems, the first thing you should do is to find out
which program / piece of equipment is causing problems:

@itemize @bullet
@item
If you have one of the following symptoms, then it is probably a hardware
(like memory, motherboard, CPU, or hard disk) or kernel problem:
@itemize @minus
@item
The keyboard doesn't work.  This can normally be checked by pressing
Caps Lock. If the Caps Lock light doesn't change you have to replace
your keyboard.  (Before doing this, you should try to reboot
your computer and check all cables to the keyboard.)
@item
The mouse pointer doesn't move.
@item
The machine doesn't answer to a remote machine's pings.
@item
Different, unrelated programs don't behave correctly.
@item
If your system rebooted unexpectedly (a faulty user level program should
@strong{never} be able to take down your system).
@end itemize

In this case you should start by checking all your cables and run some
diagnostic tool to check your hardware!
You should also check if there are any patches, updates, or service
packs for your operating system that could likely solve your problems.
Check also that all your libraries (like glibc) are up to date.

It's always good to use a machine with ECC memory to discover
memory problems early!
@item
If your keyboard is locked up, you may be able to fix this by
logging into your machine from another machine and execute
@code{kbd_mode -a} on it.

@item
Please examine your system log file (/var/log/messages or similar) for
reasons for your problems.  If you think the problem is in MySQL
then you should also examine MySQL's log files. @xref{Binary log}.

@item
If you don't think you have hardware problems, you should try to find
out which program is causing problems.

Try using @code{top}, @code{ps}, @code{taskmanager}, or some similar program,
to check which program is taking all CPU or is locking the machine.

@item
Check with @code{top}, @code{df}, or a similar program if you are out of
memory, disk space, open files, or some other critical resource.

@item
If the problem is some runaway process, you can always try to kill it. If it
doesn't want to die, there is probably a bug in the operating system.
@end itemize

If after you have examined all other possibilities and you have
concluded that it's the MySQL server or a MySQL client
that is causing the problem, it's time to do a bug report for our
mailing list or our support team.  In the bug report, try to give a
very detailed description of how the system is behaving and what you think is
happening. You should also state why you think it's MySQL that
is causing the problems.  Take into consideration all the situations in
this chapter. State any problems exactly how they appear when you
examine your system. Use the 'cut and paste' method for any output
and/or error messages from programs and/or log files!

Try to describe in detail which program is not working and all
symptoms you see!  We have in the past received many bug reports that just
state "the system doesn't work".  This doesn't provide us with any
information about what could be the problem.

If a program fails, it's always useful to know:

@itemize @bullet
@item
Has the program in question made a segmentation fault (core dumped)?
@item
Is the program taking up the whole CPU? Check with @code{top}. Let the
program run for a while, it may be evaluating something heavy.
@item
If it's the @code{mysqld} server that is causing problems, can you
do @code{mysqladmin -u root ping} or @code{mysqladmin -u root processlist}?
@item
What does a client program say (try with @code{mysql}, for example)
when you try to connect to the MySQL server?
Does the client jam?  Do you get any output from the program?
@end itemize

When sending a bug report, you should of follow the outlines
described in this manual. @xref{Asking questions}.


@node Common errors, Installation Issues, What is crashing, Problems
@appendixsec Common Errors When Using MySQL

@cindex errors, list of

@menu
* Error Access denied::         @code{Access denied} Error
* Gone away::                   @code{MySQL server has gone away} Error
* Can not connect to server::   @code{Can't connect to [local] MySQL server} Error
* Old client::                  @code{Client does not support authentication protocol} error
* Blocked host::                @code{Host '...' is blocked} Error
* Too many connections::        @code{Too many connections} Error
* Non-transactional tables::    @code{Some non-transactional changed tables couldn't be rolled back} Error
* Out of memory::               @code{Out of memory} Error
* Packet too large::            @code{Packet too large} Error
* Communication errors::        Communication Errors / Aborted Connection
* Full table::                  @code{The table is full} Error
* Cannot create::               @code{Can't create/write to file} Error
* Commands out of sync::        @code{Commands out of sync} Error in Client
* Ignoring user::               @code{Ignoring user} Error
* Cannot find table::           @code{Table 'xxx' doesn't exist} Error
* Cannot initialize character set::  @code{Can't initialize character set xxx} error
* Not enough file handles::     File Not Found
@end menu


This section lists some errors that users frequently get.  You will find
descriptions of the errors, and how to solve the problem here.


@node Error Access denied, Gone away, Common errors, Common errors
@appendixsubsec @code{Access denied} Error

@cindex errors, access denied
@cindex problems, access denied errors
@cindex access denied errors

@xref{Access denied}.
@xref{Privileges}.


@node Gone away, Can not connect to server, Error Access denied, Common errors
@appendixsubsec @code{MySQL server has gone away} Error

This section also covers the related @code{Lost connection to server
during query} error.

The most common reason for the @code{MySQL server has gone away} error
is that the server timed out and closed the connection. By default, the
server closes the connection after 8 hours if nothing has happened. You
can change the time limit by setting the @code{wait_timeout} variable when
you start @code{mysqld}.

Another common reason to receive the @code{MySQL server has gone away} error
is because you have issued a ``close'' on your MySQL connection
and then tried to run a query on the closed connection.

If you have a script, you just have to issue the query again for the client
to do an automatic reconnection.

You normally can get the following error codes in this case
(which one you get is OS-dependent):

@multitable @columnfractions .35 .65
@item @strong{Error code} @tab @strong{Description}
@item @code{CR_SERVER_GONE_ERROR} @tab The client couldn't send a question to the
server.
@item @code{CR_SERVER_LOST} @tab  The client didn't get an error when writing
to the server, but it didn't get a full answer (or any answer) to the question.
@end multitable

You will also get this error if someone has kills the running thread with
@code{kill #threadid#}.

You can check that the MySQL hasn't died by executing @code{mysqladmin
version} and examining the uptime.  If the problem is that mysqld
crashed you should concentrate one finding the reason for the crash.
You should in this case start by checking if issuing the query again
will kill MySQL again. @xref{Crashing}.

You can also get these errors if you send a query to the server that is
incorrect or too large. If @code{mysqld} gets a packet that is too large
or out of order, it assumes that something has gone wrong with the client and
closes the connection.  If you need big queries (for example, if you are
working with big @code{BLOB} columns), you can increase the query limit by
starting @code{mysqld} with the @code{-O max_allowed_packet=#} option
(default 1M). The extra memory is allocated on demand, so @code{mysqld} will
allocate more memory only when you issue a big query or when @code{mysqld} must
return a big result row!

You will also get a lost connection if you are sending a packet >= 16M
if your client is older than 4.0.8 and your server is 4.0.8 and above, or
the other way around.

If you want to make a bug report regarding this problem, be sure that
you include the following information:

@itemize @bullet
@item
Include information if MySQL died or not. (You can find this in the
@code{hostname.err file}. @xref{Crashing}.
@item
If a specific query kills @code{mysqld} and the involved tables where
checked with @code{CHECK TABLE} before you did the query, can you do
a test case for this? @xref{Reproduceable test case}.
@item
What is the value of the @code{wait_timeout} variable in the MySQL server ?
@code{mysqladmin variables} gives you the value of this
@item
Have you tried to run @code{mysqld} with @code{--log} and check if the
issued query appears in the log ?
@end itemize

@xref{Asking questions}.

@node Can not connect to server, Old client, Gone away, Common errors
@appendixsubsec @code{Can't connect to [local] MySQL server} Error

A MySQL client on Unix can connect to the @code{mysqld} server in two
different ways: Unix socket files, which connect through a file in the file
system (default @file{/tmp/mysqld.sock}) or TCP/IP, which connects
through a port number.  Unix socket files are faster than TCP/IP but can only
be used when connecting to a server on the same computer.  Unix socket files
are used if you don't specify a hostname or if you specify the special
hostname @code{localhost}.

On Windows, if the @code{mysqld} server is running on 9x/Me, you can
connect only via TCP/IP. If the server is running on NT/2000/XP and
mysqld is started with @code{--enable-named-pipe}, you
can also connect with named pipes. The name of the named pipe is MySQL.
If you don't give a hostname when connecting to @code{mysqld}, a MySQL
client will first try to connect to the named pipe, and if this doesn't
work it will connect to the TCP/IP port.  You can force the use of named
pipes on Windows by using @code{.} as the hostname.

The error (2002) @code{Can't connect to ...} normally means that there
isn't a MySQL server running on the system or that you are
using a wrong socket file or TCP/IP port when trying to connect to the
@code{mysqld} server.

Start by checking (using @code{ps} or the task manager on Windows) that
there is a process running named @code{mysqld} on your server!  If there
isn't any @code{mysqld} process, you should start one. @xref{Starting
server}.

If a @code{mysqld} process is running, you can check the server by
trying these different connections (the port number and socket pathname
might be different in your setup):

@example
shell> mysqladmin version
shell> mysqladmin variables
shell> mysqladmin -h `hostname` version variables
shell> mysqladmin -h `hostname` --port=3306 version
shell> mysqladmin -h 'ip for your host' version
shell> mysqladmin --protocol=socket --socket=/tmp/mysql.sock version
@end example

Note the use of backquotes rather than forward quotes with the @code{hostname}
command; these cause the output of @code{hostname} (that is, the current
hostname) to be substituted into the @code{mysqladmin} command.

Here are some reasons the @code{Can't connect to local MySQL server}
error might occur:

@itemize @bullet
@item
@code{mysqld} is not running.
@item
You are running on a system that uses MIT-pthreads.
If you are running on a system that doesn't have native threads,
@code{mysqld} uses the MIT-pthreads package.  @xref{Which OS}.  However,
not all MIT-pthreads versions support Unix socket files. On a system
without sockets support you must always specify the hostname explicitly
when connecting to the server. Try using this command to check the
connection to the server:
@example
shell> mysqladmin -h `hostname` version
@end example
@item
Someone has removed the Unix socket that @code{mysqld} uses (default
@file{/tmp/mysqld.sock}).  You might have a @code{cron} job that removes
the MySQL socket (for example, a job that removes old files
from the @file{/tmp} directory).  You can always run @code{mysqladmin
version} and check that the socket @code{mysqladmin} is trying to use
really exists.  The fix in this case is to change the @code{cron} job to
not remove @file{mysqld.sock} or to place the socket somewhere else.
@xref{Problems with mysql.sock}.
@item
You have started the @code{mysqld} server with
the @code{--socket=/path/to/socket} option.  If you change the socket
pathname for the server, you must also notify the MySQL clients
about the new path. You can do this by providing the socket path
as an argument to the client. @xref{Problems with mysql.sock}.
@item
You are using Linux and one thread has died (core dumped).  In this case
you must kill the other @code{mysqld} threads (for example, with the
@code{mysql_zap} script before you can start a new MySQL
server.  @xref{Crashing}.
@item
You may not have read and write privilege to either the directory that holds
the socket file or privilege to the socket file itself. In this case you
have to either change the privilege for the directory / file or restart
@code{mysqld} so that it uses a directory that you can access.
@end itemize

If you get the error message @code{Can't connect to MySQL server on
some_hostname}, you can try the following things to find out what the
problem is:

@itemize @bullet
@item
Check if the server is up by doing @code{telnet your-host-name
tcp-ip-port-number} and press Enter a couple of times.  If there
is a MySQL server running on this port you should get a
responses that includes the version number of the running MySQL
server.  If you get an error like @code{telnet: Unable to connect to
remote host: Connection refused}, then there is no server running on the
given port.
@item
Try connecting to the @code{mysqld} daemon on the local machine and check
the TCP/IP port that @code{mysqld} it's configured to use (variable @code{port}) with
@code{mysqladmin variables}.
@item
Check that your @code{mysqld} server is not started with the
@code{--skip-networking} option.
@end itemize


@node Old client, Blocked host, Can not connect to server, Common errors
@appendixsubsec @code{Client does not support authentication protocol} error

MySQL 4.1 uses an authentication protocal based on a password hashing
algorithm that is incompatible with that used by older clients.
If you upgrade the server to 4.1, attempts to connect to a it with an
older client may fail with the following message:

@example
shell> mysql
Client does not support authentication protocol requested
by server; consider upgrading MySQL client
@end example

To solve this problem you should do one of the following:

@itemize @bullet
@item
Upgrade all client programs to use the 4.1.1 or newer client library.
@item
Use a user account with an old password when connecting from a pre 4.1 client.
@item
Reset the user that needs a pre-4.1 client to use an old password:
@example
mysql> UPDATE user SET Password = OLD_PASSWORD('mypass')
    -> WHERE Host = 'some_host' AND User = 'some_user';
mysql> FLUSH PRIVILEGES;
@end example
@item
Tell the server to use the older password hashing algorithm:
@enumerate
@item
Start mysqld with @code{--old-passwords}.
@item
Set the password for all users that has a long password. You can find these
users with:

@example
SELECT * FROM mysql.user WHERE LENGTH(password) > 16;
@end example
@end enumerate
@end itemize

For background on password hashing and authentication, see
@ref{Password hashing}.


@node Blocked host, Too many connections, Old client, Common errors
@appendixsubsec @code{Host '...' is blocked} Error

If you get an error like this:

@example
Host 'hostname' is blocked because of many connection errors.
Unblock with 'mysqladmin flush-hosts'
@end example

This means that @code{mysqld} has gotten a lot (@code{max_connect_errors})
of connect requests from the host @code{'hostname'} that have been interrupted
in the middle. After @code{max_connect_errors} failed requests, @code{mysqld}
assumes that something is wrong (like an attack from a cracker), and
blocks the site from further connections until you execute a
@code{mysqladmin flush-hosts} command or issue a @code{FLUSH HOSTS} statement.

By default, @code{mysqld} blocks a host after 10 connection errors.
You can easily adjust this by starting the server like this:

@example
shell> mysqld_safe -O max_connect_errors=10000 &
@end example

Note that if you get this error message for a given host, you should first
check that there isn't anything wrong with TCP/IP connections from that
host.  If your TCP/IP connections aren't working, it won't do you any good to
increase the value of the @code{max_connect_errors} variable!


@node Too many connections, Non-transactional tables, Blocked host, Common errors
@appendixsubsec @code{Too many connections} Error

If you get the error @code{Too many connections} when you try to connect
to MySQL, this means that there is already @code{max_connections}
clients connected to the @code{mysqld} server.

If you need more connections than the default (100), then you should restart
@code{mysqld} with a bigger value for the @code{max_connections} variable.

Note that @code{mysqld} actually allows (@code{max_connections}+1)
clients to connect.  The last connection is reserved for a user with the
@code{SUPER} privilege.  By not giving this privilege to normal
users (they shouldn't need this), an administrator with this privilege
can log in and use @code{SHOW PROCESSLIST} to find out what could be
wrong. @xref{SHOW PROCESSLIST}.

The maximum number of connects MySQL is depending on how good
the thread library is on a given platform. Linux or Solaris should be
able to support 500-1000 simultaneous connections, depending on how much
RAM you have and what your clients are doing.


@node Non-transactional tables, Out of memory, Too many connections, Common errors
@appendixsubsec @code{Some non-transactional changed tables couldn't be rolled back} Error

@cindex Non-transactional tables

If you get the error/warning: @code{Warning: Some non-transactional
changed tables couldn't be rolled back} when trying to do a
@code{ROLLBACK}, this means that some of the tables you used in the
transaction didn't support transactions.  These non-transactional tables
will not be affected by the @code{ROLLBACK} statement.

The most typical case when this happens is when you have tried to create
a table of a type that is not supported by your @code{mysqld} binary.
If @code{mysqld} doesn't support a table type (or if the table type is
disabled by a startup option) , it will instead create the table type
with the table type that is most resembles to the one you requested,
probably @code{MyISAM}.

You can check the table type for a table by doing:

@code{SHOW TABLE STATUS LIKE 'table_name'}. @xref{SHOW TABLE STATUS}.

You can check the extensions your @code{mysqld} binary supports by doing:

@code{show variables like 'have_%'}. @xref{SHOW VARIABLES}.


@node Out of memory, Packet too large, Non-transactional tables, Common errors
@appendixsubsec @code{Out of memory} Error

If you issue a query and get something like the following error:

@example
mysql: Out of memory at line 42, 'malloc.c'
mysql: needed 8136 byte (8k), memory in use: 12481367 bytes (12189k)
ERROR 2008: MySQL client ran out of memory
@end example

note that the error refers to the MySQL client @code{mysql}. The
reason for this error is simply that the client does not have enough memory to
store the whole result.

To remedy the problem, first check that your query is correct. Is it
reasonable that it should return so many rows?  If so,
you can use @code{mysql --quick}, which uses @code{mysql_use_result()}
to retrieve the result set.  This places less of a load on the client (but
more on the server).


@node Packet too large, Communication errors, Out of memory, Common errors
@appendixsubsec @code{Packet too large} Error

When a MySQL client or the @code{mysqld} server gets a packet bigger
than @code{max_allowed_packet} bytes, it issues a @code{Packet too large}
error and closes the connection.

In MySQL 3.23 the biggest possible packet is 16M (due to limits in the
client/server protocol). In MySQL 4.0.1 and up, this is only limited by
the amount on memory you have on your server (up to a theoretical
maximum of 2G).

A communication packet is a single SQL statement sent to the MySQL server
or a single row that is sent to the client.

When a MySQL client or the @code{mysqld} server gets a packet bigger
than @code{max_allowed_packet} bytes, it issues a @code{Packet too
large} error and closes the connection.  With some clients, you may also
get @code{Lost connection to MySQL server during query} error if the
communication packet is too big.

Note that both the client and the server has it's own
@code{max_allowed_packet} variable. If you want to handle big packets,
you have to increase this variable both in the client and in the server.

It's safe to increase this variable as memory is only allocated when
needed; this variable is more a precaution to catch wrong packets
between the client/server and also to ensure that you don't accidentally
use big packets so that you run out of memory.

If you are using the @code{mysql} client, you may specify a bigger
buffer by starting the client with
@code{mysql --set-variable=max_allowed_packet=8M}.
Other clients have different methods to set this variable.
Please note that @code{--set-variable} is deprecated since
MySQL 4.0, just use @code{--max-allowed-packet=8M} instead.
 
You can use the option file to set @code{max_allowed_packet} to a larger
size in @code{mysqld}.  For example, if you are expecting to store the
full length of a @code{MEDIUMBLOB} into a table, you'll need to start
the server with the @code{set-variable=max_allowed_packet=16M} option.

You can also get strange problems with large packets if you are using
big blobs, but you haven't given @code{mysqld} access to enough memory
to handle the query.  If you suspect this is the case, try adding
@code{ulimit -d 256000} to the beginning of the @code{mysqld_safe} script
and restart @code{mysqld}.

@node Communication errors, Full table, Packet too large, Common errors
@appendixsubsec Communication Errors / Aborted Connection

@cindex aborted clients
@cindex aborted connection
@cindex connection, aborted

Starting with @code{MySQL 3.23.40} you only get the @code{Aborted
connection} error of you start @code{mysqld} with @code{--warnings}.

If you find errors like the following in your error log.

@example
010301 14:38:23  Aborted connection 854 to db: 'users' user: 'josh'
@end example

@xref{Error log}.

This means that something of the following has happened:

@itemize @bullet
@item
The client program did not call @code{mysql_close()} before exit.
@item
The client had been sleeping more than @code{wait_timeout} or
@code{interactive_timeout} without doing any requests.
@xref{SHOW VARIABLES, , @code{wait_timeout}}.
@xref{SHOW VARIABLES, , @code{interactive_timeout}}.
@item
The client program ended abruptly in the middle of the transfer.
@end itemize

When the above happens, the server variable @code{Aborted_clients} is
incremented.

The server variable @code{Aborted_connects} is incremented when:

@itemize @bullet
@item
When a connection packet doesn't contain the right information.
@item
When the user didn't have privileges to connect to a database.
@item
When a user uses a wrong password.
@item
When it takes more than @code{connect_timeout} seconds to get
a connect package.
@xref{SHOW VARIABLES, , @code{connect_timeout}}.
@end itemize

Note that the above could indicate that someone is trying to break into
your database!

Other reasons for problems with Aborted clients / Aborted connections.
@itemize @bullet
@item
Usage of Ethernet protocol with Linux, both half and full duplex.
Many Linux Ethernet drivers have this bug. You should test for this
bug by transferring a huge file via ftp between these two machines.
If a transfer goes in burst-pause-burst-pause ... mode then you are
experiencing a Linux duplex syndrome.
The only solution is switching duplex mode for both your network card
and Hub/Switch to either full duplex or to half duplex and testing the
results to decide on the best setting.
@item
Some problem with the thread library that causes interrupts on reads.
@item
Badly configured TCP/IP.
@item
Faulty Ethernets or hubs or switches, cables ... This can be diagnosed
properly only by replacing hardware.
@item
@code{max_allowed_packet} is too small or queries require more memory
than you have allocated for @code{mysqld}. @xref{Packet too large}.
@end itemize


@node Full table, Cannot create, Communication errors, Common errors
@appendixsubsec @code{The table is full} Error

@cindex table is full

There are a couple of different cases when you can get this error:

@itemize @bullet
@item
You are using an older MySQL version (before 3.23.0) when an in-memory
temporary table becomes larger than @code{tmp_table_size} bytes.
To avoid this problem, you can use the @code{-O tmp_table_size=#} option
to make @code{mysqld} increase the temporary table size or use the SQL
option @code{SQL_BIG_TABLES} before you issue the problematic query.
@xref{SET OPTION, ,@code{SET}}.

You can also start @code{mysqld} with the @code{--big-tables} option.
This is exactly the same as using @code{SQL_BIG_TABLES} for all queries.

In MySQL Version 3.23, if an in-memory temporary table becomes larger than
@code{tmp_table_size}, the server automatically converted it to a disk-based
@code{MyISAM} table.
@item
You are using @code{InnoDB} tables and run out of room in the
@code{InnoDB} tablespace. In this case the solution is to extend the
@code{InnoDB} tablespace.
@item
You are using @code{ISAM} or @code{MyISAM} tables on an OS that only
supports files of 2G in size and you have hit this limit for the datafile
or index file.
@item
You are using @code{MyISAM} tables and the needed data or index size is
bigger than what MySQL has allocated pointers for.  (If you don't specify
@code{MAX_ROWS} to @code{CREATE TABLE} MySQL will only allocate pointers
to hold 4G of data).

You can check the maximum data/index sizes by doing
@example
SHOW TABLE STATUS FROM database LIKE 'table_name';
@end example
or using @code{myisamchk -dv database/table_name}.

If this is the problem, you can fix it by doing something like:
@example
ALTER TABLE table_name MAX_ROWS=1000000000 AVG_ROW_LENGTH=nnn;
@end example
You only have to specify @code{AVG_ROW_LENGTH} for tables with
@code{BLOB/TEXT}
fields as in this case MySQL can't optimize the space required based
only on the number of rows.
@end itemize


@node Cannot create, Commands out of sync, Full table, Common errors
@appendixsubsec @code{Can't create/write to file} Error

@cindex can't create/write to file

If you get an error for some queries of type:

@example
Can't create/write to file '\\sqla3fe_0.ism'.
@end example

this means that MySQL can't create a temporary file for the
result set in the given temporary directory. (The above error is a
typical error message on Windows, and the Unix error message is similar.)
The fix is to start @code{mysqld} with @code{--tmpdir=path} or to add to your
option file:

@example
[mysqld]
tmpdir=C:/temp
@end example

assuming that the @file{c:\\temp} directory exists. @xref{Option files}.

Check also the error code that you get with @code{perror}. One reason
may also be a disk full error;

@example
shell> perror 28
Error code  28:  No space left on device
@end example


@node Commands out of sync, Ignoring user, Cannot create, Common errors
@appendixsubsec @code{Commands out of sync} Error in Client

@cindex commands out of sync

If you get @code{Commands out of sync; you can't run this command now}
in your client code, you are calling client functions in the wrong order!

This can happen, for example, if you are using @code{mysql_use_result()} and
try to execute a new query before you have called @code{mysql_free_result()}.
It can also happen if you try to execute two queries that return data without
a @code{mysql_use_result()} or @code{mysql_store_result()} in between.


@node Ignoring user, Cannot find table, Commands out of sync, Common errors
@appendixsubsec @code{Ignoring user} Error

If you get the following error:

@code{Found wrong password for user: 'some_user@@some_host'; ignoring user}

this means that when @code{mysqld} was started or when it reloaded the
permissions tables, it found an entry in the @code{user} table with
an invalid password.  As a result, the entry is simply ignored by the
permission system.

Possible causes of and fixes for this problem:

@itemize @bullet
@item
You may be running a new version of @code{mysqld} with an old
@code{user} table.
You can check this by executing @code{mysqlshow mysql user} to see whether
the password field is shorter than 16 characters. If so, you can correct this
condition by running the @code{scripts/add_long_password} script.

@item
The user has an old password (8 characters long) and you didn't start
@code{mysqld} with the @code{--old-protocol} option.
Update the user in the @code{user} table with a new password or
restart @code{mysqld} with @code{--old-protocol}.

@item
@findex PASSWORD()
You have specified a password in the @code{user} table without using the
@code{PASSWORD()} function.  Use @code{mysql} to update the user in the
@code{user} table with a new password. Make sure to use the @code{PASSWORD()}
function:

@example
mysql> UPDATE user SET password=PASSWORD('your password')
    ->             WHERE user='XXX';
@end example
@end itemize


@node Cannot find table, Cannot initialize character set, Ignoring user, Common errors
@appendixsubsec @code{Table 'xxx' doesn't exist} Error

If you get the error @code{Table 'xxx' doesn't exist} or @code{Can't
find file: 'xxx' (errno: 2)}, this means that no table exists
in the current database with the name @code{xxx}.

Note that as MySQL uses directories and files to store databases and
tables, the database and table names are @strong{case sensitive}!
(On Windows the databases and tables names are not case sensitive, but all
references to a given table within a query must use the same case!)

You can check which tables you have in the current database with
@code{SHOW TABLES}. @xref{SHOW, , @code{SHOW}}.


@node Cannot initialize character set, Not enough file handles, Cannot find table, Common errors
@appendixsubsec @code{Can't initialize character set xxx} error

@cindex multi-byte character sets

If you get an error like:

@example
MySQL Connection Failed: Can't initialize character set xxx
@end example

This means one of the following things:

@itemize @bullet
@item
The character set is a multi-byte character set and you have no support
for the character set in the client.

In this case you need to recompile the client with
@code{--with-charset=xxx} or with @code{--with-extra-charsets=xxx}.
@xref{configure options}.

All standard MySQL binaries are compiled with
@code{--with-extra-character-sets=complex} which will enable support for
all multi-byte character sets. @xref{Character sets}.

@item
The character set is a simple character set which is not compiled into
@code{mysqld} and the character set definition files are not in the place
where the client expects to find them.

In this case you need to:

@itemize @bullet
@item
Recompile the client with support for the character set.
@xref{configure options}.
@item
Specify to the client where the character set definition files are. For many
clients you can do this with the
@code{--character-sets-dir=path-to-charset-dir} option.
@item
Copy the character definition files to the path where the client expects them
to be.
@end itemize
@end itemize


@node Not enough file handles,  , Cannot initialize character set, Common errors
@appendixsubsec File Not Found

If you get @code{ERROR '...' not found (errno: 23)}, @code{Can't open
file: ... (errno: 24)}, or any other error with @code{errno 23} or
@code{errno 24} from MySQL, it means that you haven't allocated
enough file descriptors for MySQL.  You can use the
@code{perror} utility to get a description of what the error number
means:

@example
shell> perror 23
File table overflow
shell> perror 24
Too many open files
shell> perror 11
Resource temporarily unavailable
@end example

The problem here is that @code{mysqld} is trying to keep open too many
files simultaneously.  You can either tell @code{mysqld} not to open so
many files at once or increase the number of file descriptors
available to @code{mysqld}.

To tell @code{mysqld} to keep open fewer files at a time, you can make
the table cache smaller by using the @code{-O table_cache=32} option to
@code{mysqld_safe} (the default value is 64). Reducing the value of
@code{max_connections} will also reduce the number of open files (the
default value is 90).

@tindex ulimit
To change the number of file descriptors available to @code{mysqld}, you
can use the option @code{--open-files-limit=#} to @code{mysqld_safe} or
@code{-O open_files_limit=#} to @code{mysqld}.
@xref{SHOW VARIABLES, , @code{open_files_limit}}.
The easiest way to do that is to add the option to your option file.
@xref{Option files}.  If you have an old @code{mysqld} version that
doesn't support this, you can edit the @code{mysqld_safe} script.  There
is a commented-out line @code{ulimit -n 256} in the script.  You can
remove the @code{'#'} character to uncomment this line, and change the
number 256 to affect the number of file descriptors available to
@code{mysqld}.

@code{ulimit} (and @code{open-files-limit}) can increase the number of
file descriptors, but only up to the limit imposed by the operating
system. There is also a 'hard' limit that can only be overridden if you
start @code{mysqld_safe} or @code{mysqld} as root (just remember that
you need to also use the @code{--user=...} option in this case).  If you
need to increase the OS limit on the number of file descriptors
available to each process, consult the documentation for your operating
system.

Note that if you run the @code{tcsh} shell, @code{ulimit} will not work!
@code{tcsh} will also report incorrect values when you ask for the current
limits!  In this case you should start @code{mysqld_safe} with @code{sh}!


@node Installation Issues, Administration Issues, Common errors, Problems
@appendixsec Installation Related Issues


@menu
* Link errors::                 Problems When Linking with the MySQL Client Library
* Changing MySQL user::         How to Run MySQL As a Normal User
* File permissions::            Problems with File Permissions
@end menu

@node Link errors, Changing MySQL user, Installation Issues, Installation Issues
@appendixsubsec Problems When Linking with the MySQL Client Library

@cindex linking, errors
@cindex errors, linking
@cindex problems, linking

If you are linking your program and you get errors for unreferenced
symbols that start with @code{mysql_}, like the following:

@example
/tmp/ccFKsdPa.o: In function `main':
/tmp/ccFKsdPa.o(.text+0xb): undefined reference to `mysql_init'
/tmp/ccFKsdPa.o(.text+0x31): undefined reference to `mysql_real_connect'
/tmp/ccFKsdPa.o(.text+0x57): undefined reference to `mysql_real_connect'
/tmp/ccFKsdPa.o(.text+0x69): undefined reference to `mysql_error'
/tmp/ccFKsdPa.o(.text+0x9a): undefined reference to `mysql_close'
@end example

you should be able to solve this by adding @code{-Lpath-to-the-mysql-library
-lmysqlclient} @strong{last} on your link line.

If you get @code{undefined reference} errors for the @code{uncompress}
or @code{compress} function, add @code{-lz} @strong{last} on your link
line and try again!

If you get @code{undefined reference} errors for functions that should
exist on your system, like @code{connect}, check the man page for the
function in question, for which libraries you should add to the link
line!

If you get @code{undefined reference} errors for functions that don't
exist on your system, like the following:

@example
mf_format.o(.text+0x201): undefined reference to `__lxstat'
@end example

it usually means that your library is compiled on a system that is not
100% compatible with yours.  In this case you should download the
latest MySQL source distribution and compile this yourself.
@xref{Installing source}.

If you are trying to run a program and you then get errors for
unreferenced symbols that start with @code{mysql_} or that the
@code{mysqlclient} library can't be found, this means that your system
can't find the share @file{libmysqlclient.so} library.

The fix for this is to tell your system to search after shared
libraries where the library is located by one of the following methods:

@itemize @bullet
@item
Add the path to the directory where you have @file{libmysqlclient.so} the
@code{LD_LIBRARY_PATH} environment variable.
@item
Add the path to the directory where you have @file{libmysqlclient.so} the
@code{LD_LIBRARY} environment variable.
@item
Copy @file{libmysqlclient.so} to some place that is searched by your system,
like @file{/lib}, and update the shared library information by executing
@code{ldconfig}.
@end itemize

Another way to solve this problem is to link your program statically, with
@code{-static}, or by removing the dynamic MySQL libraries
before linking your code. In the second case you should be
sure that no other programs are using the dynamic libraries!


@node Changing MySQL user, File permissions, Link errors, Installation Issues
@appendixsubsec How to Run MySQL As a Normal User

@cindex starting, @code{mysqld}
@cindex @code{mysqld}, starting

The MySQL server @code{mysqld} can be started and run by any user.
In order to change @code{mysqld} to run as a Unix user @code{user_name}, you must
do the following:

@enumerate
@item
Stop the server if it's running (use @code{mysqladmin shutdown}).

@item
Change the database directories and files so that @code{user_name} has
privileges to read and write files in them (you may need to do this as
the Unix @code{root} user):

@example
shell> chown -R user_name /path/to/mysql/datadir
@end example

If directories or files within the MySQL data directory are
symlinks, you'll also need to follow those links and change the directories
and files they point to.  @code{chown -R} may not follow symlinks for
you.

@item
Start the server as user @code{user_name}, or, if you are using
MySQL Version 3.22 or later, start @code{mysqld} as the Unix @code{root}
user and use the @code{--user=user_name} option.  @code{mysqld} will switch
to run as the Unix user @code{user_name} before accepting any connections.

@item
To start the server as the given username automatically at system
startup time, add a @code{user} line that specifies the username to
the @code{[mysqld]} group of the @file{/etc/my.cnf} option file or the
@file{my.cnf} option file in the server's data directory. For example:

@example
[mysqld]
user=user_name
@end example
@end enumerate

At this point, your @code{mysqld} process should be running fine and dandy as
the Unix user @code{user_name}. One thing hasn't changed, though: the
contents of the permissions tables. By default (right after running the
permissions table install script @code{mysql_install_db}), the MySQL
user @code{root} is the only user with permission to access the @code{mysql}
database or to create or drop databases.  Unless you have changed those
permissions, they still hold. This shouldn't stop you from accessing
MySQL as the MySQL @code{root} user when you're logged in
as a Unix user other than @code{root}; just specify the @code{-u root} option
to the client program.

Note that accessing MySQL as @code{root}, by supplying @code{-u
root} on the command-line, has @strong{nothing} to do with MySQL running
as the Unix @code{root} user, or, indeed, as another Unix user. The access
permissions and usernames of MySQL are completely separate from
Unix usernames. The only connection with Unix usernames is that if you
don't provide a @code{-u} option when you invoke a client program, the client
will try to connect using your Unix login name as your MySQL user
name.

If your Unix box itself isn't secured, you should probably at least put a
password on the MySQL @code{root} users in the access tables.
Otherwise, any user with an account on that machine can run @code{mysql -u
root db_name} and do whatever he likes.

On Windows, you can install MySQL 4.0.17 and MySQL 4.1.2 as services
as a normal user. (Older MySQL versions required you to have administrator
rights;  This was a bug introduced in MySQL 3.23.54).

@node File permissions,  , Changing MySQL user, Installation Issues
@appendixsubsec Problems with File Permissions

@cindex files, permissions
@cindex error mesaages, can't find file
@cindex files, not found message

If you have problems with file permissions, for example, if @code{mysql}
issues the following error message when you create a table:

@example
ERROR: Can't find file: 'path/with/filename.frm' (Errcode: 13)
@end example

@tindex UMASK environment variable
@tindex Environment variable, UMASK
then the environment variable @code{UMASK} might be set incorrectly when
@code{mysqld} starts.  The default umask value is @code{0660}. You can
change this behavior by starting @code{mysqld_safe} as follows:

@example
shell> UMASK=384  # = 600 in octal
shell> export UMASK
shell> /path/to/mysqld_safe &
@end example

@tindex UMASK_DIR environment variable
@tindex Environment variable, UMASK_DIR
By default MySQL will create database and @code{RAID}
directories with permission type 0700.  You can modify this behavior by
setting the @code{UMASK_DIR} variable. If you set this, new
directories are created with the combined @code{UMASK} and
@code{UMASK_DIR}. For example, if you want to give group access to
all new directories, you can do:

@example
shell> UMASK_DIR=504  # = 770 in octal
shell> export UMASK_DIR
shell> /path/to/mysqld_safe &
@end example

In MySQL Version 3.23.25 and above, MySQL assumes that the
value for @code{UMASK} and @code{UMASK_DIR} is in octal if it starts
with a zero.

@xref{Environment variables}.


@node Administration Issues, Query Issues, Installation Issues, Problems
@appendixsec Administration Related Issues


@menu
* Crashing::                    What To Do If MySQL Keeps Crashing
* Resetting permissions::       How to Reset a Forgotten Root Password
* Full disk::                   How MySQL Handles a Full Disk
* Temporary files::             Where MySQL Stores Temporary Files
* Problems with mysql.sock::    How to Protect or Change the MySQL Socket File @file{/tmp/mysql.sock}
* Timezone problems::           Time Zone Problems
@end menu

@node Crashing, Resetting permissions, Administration Issues, Administration Issues
@appendixsubsec What To Do If MySQL Keeps Crashing

@cindex crash, repeated

All MySQL versions are tested on many platforms before they are
released.  This doesn't mean that there aren't any bugs in
MySQL, but it means if there are bugs, they are very few and can be
hard to find.  If you have a problem, it will always help if you try to
find out exactly what crashes your system, as you will have a much better
chance of getting this fixed quickly.

First, you should try to find out whether the problem is that the
@code{mysqld} daemon dies or whether your problem has to do with your
client.  You can check how long your @code{mysqld} server has been up by
executing @code{mysqladmin version}.  If @code{mysqld} has died, you may
find the reason for this in the file
@file{mysql-data-directory/`hostname`.err}. @xref{Error log}.

On some systems you can find in this file a stack trace of where @code{mysqld}
died that you can resolve with @code{resolve_back_stack}.  @xref{Using
stack trace}. Note that the variable values written in the @code{.err}
file may not always be 100 percent correct.

Many crashes of MySQL are caused by corrupted index files or datafiles.
MySQL will update the data on disk, with the
@code{write()} system call, after every SQL statement and before the
client is notified about the result. (This is not true if you are running
with @code{delay_key_write}, in which case only the data is written.)
This means that the data is safe even if @code{mysqld} crashes, as the OS will
ensure that the not flushed data is written to disk.  You can force
MySQL to sync everything to disk after every SQL command by
starting @code{mysqld} with @code{--flush}.

The above means that normally you shouldn't get corrupted tables unless:

@itemize @bullet
@item
Someone/something killed @code{mysqld} or the machine in the middle
of an update.
@item
You have found a bug in @code{mysqld} that caused it to die in the
middle of an update.
@item
Someone is manipulating the data/index files outside of @strong{mysqld}
without locking the table properly.
@item
If you are running many @code{mysqld} servers on the same data on a
system that doesn't support good filesystem locks (normally handled by
the @code{lockd} daemon ) or if you are running
multiple servers with @code{--skip-external-locking}
@item
You have a crashed index/datafile that contains very wrong data that
got @code{mysqld} confused.
@item
You have found a bug in the data storage code. This isn't that likely,
but it's at least possible.  In this case you can try to change the file
type to another storage engine by using @code{ALTER TABLE} on a
repaired copy of the table!
@end itemize

Because it is very difficult to know why something is crashing, first try to
check whether things that work for others crash for you.  Please try
the following things:

@itemize @bullet
Take down the @code{mysqld} daemon with @code{mysqladmin shutdown}, run
@code{myisamchk --silent --force */*.MYI} on all tables, and restart the
@code{mysqld} daemon.  This will ensure that you are running from a clean
state.  @xref{MySQL Database Administration}.

@item
Use @code{mysqld --log} and try to determine from the information in the log
whether some specific query kills the server. About 95% of all bugs are
related to a particular query!  Normally this is one of the last queries in
the log file just before MySQL restarted. @xref{Query log}.
If you can repeatedly kill MySQL with one of the queries, even
when you have checked all tables just before doing the query, then you
have been able to locate the bug and should do a bug report for this!
@xref{Bug reports}.

@item
Try to make a test case that we can use to reproduce the problem.
@xref{Reproduceable test case}.

@item
Try running the included mysql-test test and the MySQL
benchmarks.  @xref{MySQL test suite}.  They should test MySQL
rather well.  You can also add code to the benchmarks that simulates
your application!  The benchmarks can be found in the @file{bench}
directory in the source distribution or, for a binary distribution, in
the @file{sql-bench} directory under your MySQL installation
directory.

@item
Try @code{fork_test.pl} and @code{fork2_test.pl}.

@item
If you configure MySQL for debugging, it will be much easier to
gather information about possible errors if something goes wrong.
Reconfigure MySQL with the @code{--with-debug} option or
@code{--with-debug=full} to @code{configure} and then recompile.
@xref{Debugging server}.

@item
Configuring MySQL for debugging causes a safe memory allocator to be
included that can find some errors. It also provides a lot of output about
what is happening.

@item
Have you applied the latest patches for your operating system?

@item
Use the @code{--skip-external-locking} option to @code{mysqld}.  On some
systems, the @code{lockd} lock manager does not work properly; the
@code{--skip-external-locking} option tells @code{mysqld} not to use external
locking.  (This means that you cannot run 2 @code{mysqld} servers on the same
data and that you must be careful if you use @code{myisamchk}, but it may be
instructive to try the option as a test.)

@item
Have you tried @code{mysqladmin -u root processlist} when @code{mysqld}
appears to be running but not responding?  Sometimes @code{mysqld} is not
comatose even though you might think so.  The problem may be that all
connections are in use, or there may be some internal lock problem.
@code{mysqladmin processlist} will usually be able to make a connection even
in these cases, and can provide useful information about the current number
of connections and their status.

@item
Run the command @code{mysqladmin -i 5 status} or @code{mysqladmin -i 5
-r status} or in a separate window to produce statistics while you run
your other queries.

@item
Try the following:
@enumerate
@item
Start @code{mysqld} from @code{gdb} (or in another debugger).
@xref{Using gdb on mysqld,  , Using @code{gdb} on @code{mysqld}}.

@item
Run your test scripts.

@item
Print the backtrace and the local variables at the 3 lowest levels. In gdb you
can do this with the following commands when @code{mysqld} has crashed inside
gdb:

@example
backtrace
info local
up
info local
up
info local
@end example

With gdb you can also examine which threads exist with @code{info
threads} and switch to a specific thread with @code{thread #}, where
@code{#} is the thread ID.
@end enumerate

@item
Try to simulate your application with a Perl script to force
MySQL to crash or misbehave.

@item
Send a normal bug report. @xref{Bug reports}. Be even more detailed
than usual.  Because MySQL works for many people, it may be that the
crash results from something that exists only on your computer (for example,
an error that is related to your particular system libraries).
@item
If you have a problem with tables with dynamic-length rows and you are
not using @code{BLOB/TEXT} columns (but only @code{VARCHAR} columns), you
can try to change all @code{VARCHAR} to @code{CHAR} with @code{ALTER
TABLE}.  This will force MySQL to use fixed-size rows.
Fixed-size rows take a little extra space, but are much more tolerant to
corruption!

The current dynamic row code has been in use at MySQL AB for at
least 3 years without any problems, but by nature dynamic-length rows are
more prone to errors, so it may be a good idea to try the above to see whether
it helps!
@end itemize


@node Resetting permissions, Full disk, Crashing, Administration Issues
@appendixsubsec How to Reset a Forgotten Root Password

@cindex passwords, forgotten
@cindex passwords, resetting
@cindex root user, password resetting

If you never set a @code{root} password for MySQL, then the server will
not require a password at all for connecting as @code{root}. It is
recommended to always set a password for each user. @xref{Security guidelines}.

If you have set a @code{root} password, but forgot what it was, you can
set a new password with the following procedure:

@enumerate
@item
Take down the @code{mysqld} server by sending a @code{kill} (not @code{kill
-9}) to the @code{mysqld} server.  The pid is stored in a @file{.pid}
file, which is normally in the MySQL database directory:
@example
shell> kill `cat /mysql-data-directory/hostname.pid`
@end example
You must be either the Unix @code{root} user or the same user @code{mysqld}
runs as to do this.
@item
Restart @code{mysqld} with the @code{--skip-grant-tables} option.
@item
Set a new password with the @code{mysqladmin password} command:
@example
shell> mysqladmin -u root password "mynewpassword"
@end example
@item
Now you can either stop @code{mysqld} and restart it normally,
or just load the privilege tables with:
@example
shell> mysqladmin -h hostname flush-privileges
@end example
@item
After this, you should be able to connect using the new password.
@end enumerate

Alternatively, you can set the new password using the @code{mysql} client:
@enumerate
@item
Take down and restart @code{mysqld} with the @code{--skip-grant-tables}
option as described above.
@item
Connect to the @code{mysqld} server with:
@example
shell> mysql -u root mysql
@end example
@item
Issue the following commands in the @code{mysql} client:
@example
mysql> UPDATE user SET Password=PASSWORD('mynewpassword')
    ->             WHERE User='root';
mysql> FLUSH PRIVILEGES;
@end example
@item
After this, you should be able to connect using the new password.
@item
You can now stop @code{mysqld} and restart it normally.
@end enumerate


@node Full disk, Temporary files, Resetting permissions, Administration Issues
@appendixsubsec How MySQL Handles a Full Disk

@cindex full disk
@cindex disk full

@noindent
When a disk-full condition occurs, MySQL does the following:

@itemize @bullet
@item
It checks once every minute to see whether there is enough space to
write the current row. If there is enough space, it continues as if nothing had
happened.
@item
Every 6 minutes it writes an entry to the log file warning about the disk
full condition.
@end itemize

@noindent
To alleviate the problem, you can take the following actions:

@itemize @bullet
@item
To continue, you only have to free enough disk space to insert all records.
@item
To abort the thread, you must send a @code{mysqladmin kill} to the thread.
The thread will be aborted the next time it checks the disk (in 1 minute).
@item
Note that other threads may be waiting for the table that caused the disk
full condition.  If you have several ``locked'' threads, killing the one
thread that is waiting on the disk-full condition will allow the other
threads to continue.
@end itemize

Exceptions to the above behavior is when you use @code{REPAIR} or
@code{OPTIMIZE} or when the indexes are created in a batch after an
@code{LOAD DATA INFILE} or after an @code{ALTER TABLE} statement.

All of the above commands may use big temporary files that left to
themself would cause big problems for the rest of the system.  If
MySQL gets disk full while doing any of the above operations,
it will remove the big temporary files and mark the table as crashed
(except for @code{ALTER TABLE}, in which the old table will be left
unchanged).


@node Temporary files, Problems with mysql.sock, Full disk, Administration Issues
@appendixsubsec Where MySQL Stores Temporary Files

MySQL uses the value of the @code{TMPDIR} environment variable as
the pathname of the directory in which to store temporary files.  If you don't
have @code{TMPDIR} set, MySQL uses the system default, which is
normally @file{/tmp} or @file{/usr/tmp}.  If the filesystem containing your
temporary file directory is too small, you should edit @code{mysqld_safe} to
set @code{TMPDIR} to point to a directory in a filesystem where you have
enough space!  You can also set the temporary directory using the
@code{--tmpdir} option to @code{mysqld}.

MySQL creates all temporary files as hidden files. This ensures
that the temporary files will be removed if @code{mysqld} is terminated.  The
disadvantage of using hidden files is that you will not see a big temporary
file that fills up the filesystem in which the temporary file directory is
located.

When sorting (@code{ORDER BY} or @code{GROUP BY}), MySQL normally
uses one or two temporary files. The maximum disk-space needed is:

@example
(length of what is sorted + sizeof(database pointer))
* number of matched rows
* 2
@end example

@code{sizeof(database pointer)} is usually 4, but may grow in the future for
really big tables.

For some @code{SELECT} queries, MySQL also creates temporary SQL
tables. These are not hidden and have names of the form @file{SQL_*}.

@code{ALTER TABLE} creates a temporary table in the same directory as
the original table.

If you use MySQL 4.1 or later you can spread load between
several physical disks by setting @code{--tmpdir} to a list of paths
separated by colon @code{:} (semicolon @code{;} on Windows). They
will be used in round-robin fashion.
@strong{Note:} These paths should end up on different @strong{physical} disks,
not different partitions of the same disk.

It is possible to set @code{tmpdir} to point to a memory-based filesystem,
except if the MySQL server is a slave. If it is a slave, it needs some
of its temporary files (for replication of temporary tables or of
@code{LOAD DATA INFILE}) to survive a machine's reboot, so a
memory-based @code{tmpdir} which is cleared when the machine reboots is not
suitable; a disk-based @code{tmpdir} is necessary.

@node Problems with mysql.sock, Timezone problems, Temporary files, Administration Issues
@appendixsubsec How to Protect or Change the MySQL Socket File @file{/tmp/mysql.sock}

@cindex @code{mysql.sock}, protection
@cindex deletion, @code{mysql.sock}

If you have problems with the fact that anyone can delete the
MySQL communication socket @file{/tmp/mysql.sock}, you can,
on most versions of Unix, protect your @file{/tmp} filesystem by setting
the @code{sticky} bit on it.  Log in as @code{root} and do the following:

@example
shell> chmod +t /tmp
@end example

This will protect your @file{/tmp} filesystem so that files can be deleted
only by their owners or the superuser (@code{root}).

You can check if the @code{sticky} bit is set by executing @code{ls -ld /tmp}.
If the last permission bit is @code{t}, the bit is set.

@cindex changing socket location

You can change the place where MySQL uses / puts the socket file the
following ways:

@itemize @bullet
@item
Specify the path in a global or local option file.
For example, put in @code{/etc/my.cnf}:

@example
[client]
socket=path-for-socket-file

[mysqld]
socket=path-for-socket-file
@end example
@xref{Option files}.
@item
Specifying this on the command-line to @code{mysqld_safe} and most
clients with the @code{--socket=path-for-socket-file} option.
@item
Specify the path to the socket in the @code{MYSQL_UNIX_PORT} environment
variable.
@item
Defining the path with the @code{configure} option
@code{--with-unix-socket-path=path-for-socket-file}. @xref{configure options}.
@end itemize

You can test that the socket works with this command:

@example
shell> mysqladmin --socket=/path/to/socket version
@end example

@node Timezone problems,  , Problems with mysql.sock, Administration Issues
@appendixsubsec Time Zone Problems

@cindex time zone problems
@cindex problems, time zone

@tindex TZ environment variable
@tindex Environment variable, TZ

If you have a problem with @code{SELECT NOW()} returning values in GMT and
not your local time, you have to set the @code{TZ} environment variable to
your current time zone.  This should be done for the environment in which
the server runs, for example, in @code{mysqld_safe} or @code{mysql.server}.
@xref{Environment variables}.

The same applies if @code{UNIX_TIMESTAMP()} returns the wrong value.

You can set the time zone for the server by setting the @code{TZ} environment
variable before you start @code{mysqld}.  You can also set it with the
@code{--timezone=timezone_name} argument to @code{mysqld_safe}.

The allowable @code{TZ} values are system-dependent. Consult your
operating system documentation to see what values are acceptable.

@node Query Issues, Optimiser Issues, Administration Issues, Problems
@appendixsec Query Related Issues


@menu
* Case sensitivity::            Case-Sensitivity in Searches
* Using DATE::                  Problems Using @code{DATE} Columns
* Problems with NULL::          Problems with @code{NULL} Values
* Problems with alias::         Problems with @code{alias}
* Deleting from related tables::  Deleting Rows from Related Tables
* No matching rows::            Solving Problems with No Matching Rows
* Problems with float::         Problems with Floating-Point Comparison
@end menu

@node Case sensitivity, Using DATE, Query Issues, Query Issues
@appendixsubsec Case-Sensitivity in Searches

@cindex case sensitivity, in searches
@cindex searching, and case sensitivity
@cindex Chinese
@cindex Big5 Chinese character encoding

By default, MySQL searches are not case sensitive (although there are
some character sets that are never case-insensitive, such as @code{czech}).
That means that if you search with @code{col_name LIKE 'a%'}, you will get all
column values that start with @code{A} or @code{a}. If you want to make this
search case sensitive, use something like @code{INSTR(col_name, "A")=1} to
check a prefix. Or use @code{STRCMP(col_name, "A") = 0} if the column value
must be exactly @code{"A"}.

Simple comparison operations (@code{>=, >, = , < , <=}, sorting and
grouping) are based on each character's ``sort value''. Characters with
the same sort value (like E, e and ) are treated as the same character!

In older MySQL versions @code{LIKE} comparisons were done on
the uppercase value of each character (E == e but E <> ).  In newer
MySQL versions @code{LIKE} works just like the other comparison
operators.

If you want a column always to be treated in case-sensitive fashion,
declare it as @code{BINARY}. @xref{CREATE TABLE, , @code{CREATE TABLE}}.

If you are using Chinese data in the so-called big5 encoding, you want to
make all character columns @code{BINARY}. This works because the sorting
order of big5 encoding characters is based on the order of ASCII codes.


@node Using DATE, Problems with NULL, Case sensitivity, Query Issues
@appendixsubsec Problems Using @code{DATE} Columns

@findex DATE

@cindex DATE columns, problems
@cindex problems, @code{DATE} columns

The format of a @code{DATE} value is @code{'YYYY-MM-DD'}. According to
standard SQL, no other format is allowed. You should use this format in @code{UPDATE}
expressions and in the WHERE clause of @code{SELECT} statements.  For
example:

@example
mysql> SELECT * FROM tbl_name WHERE date >= '1997-05-05';
@end example

As a convenience, MySQL automatically converts a date to a number if
the date is used in a numeric context (and vice versa). It is also smart
enough to allow a ``relaxed'' string form when updating and in a @code{WHERE}
clause that compares a date to a @code{TIMESTAMP}, @code{DATE}, or a
@code{DATETIME} column.  (Relaxed form means that any punctuation character
may be used as the separator between parts. For example, @code{'1998-08-15'}
and @code{'1998#08#15'} are equivalent.) MySQL can also convert a
string containing no separators (such as @code{'19980815'}), provided it
makes sense as a date.

The special date @code{'0000-00-00'} can be stored and retrieved as
@code{'0000-00-00'.} When using a @code{'0000-00-00'} date through
@code{MyODBC}, it will automatically be converted to @code{NULL} in
@code{MyODBC} Version 2.50.12 and above, because ODBC can't handle this kind of
date.

Because MySQL performs the conversions described above, the following
statements work:

@example
mysql> INSERT INTO tbl_name (idate) VALUES (19970505);
mysql> INSERT INTO tbl_name (idate) VALUES ('19970505');
mysql> INSERT INTO tbl_name (idate) VALUES ('97-05-05');
mysql> INSERT INTO tbl_name (idate) VALUES ('1997.05.05');
mysql> INSERT INTO tbl_name (idate) VALUES ('1997 05 05');
mysql> INSERT INTO tbl_name (idate) VALUES ('0000-00-00');

mysql> SELECT idate FROM tbl_name WHERE idate >= '1997-05-05';
mysql> SELECT idate FROM tbl_name WHERE idate >= 19970505;
mysql> SELECT MOD(idate,100) FROM tbl_name WHERE idate >= 19970505;
mysql> SELECT idate FROM tbl_name WHERE idate >= '19970505';
@end example

@noindent
However, the following will not work:

@example
mysql> SELECT idate FROM tbl_name WHERE STRCMP(idate,'19970505')=0;
@end example

@code{STRCMP()} is a string function, so it converts @code{idate} to
a string and performs a string comparison.  It does not convert
@code{'19970505'} to a date and perform a date comparison.

Note that MySQL does very limited checking whether the date is
correct.  If you store an incorrect date, such as @code{'1998-2-31'}, the
wrong date will be stored.

Because MySQL packs dates for storage, it can't store any given date as
it would not fit onto the result buffer. The rules for accepting a date
are:
@itemize @bullet
@item
If MySQL can store and retrieve a given date, the wrong date is accepted
for @code{DATE} and @code{DATETIME} columns.
@item
All days values between 0-31 are accepted for any date.  This makes it
very convenient for web applications where you ask year, month and day
in 3 different fields.
@item
The day or month field may be zero.  This is convenient if you want
to store a birthdate in a @code{DATE} column and you only know part
of the date.
@end itemize

If the date cannot be converted to any reasonable value, a @code{0} is
stored in the @code{DATE} field, which will be retrieved as
@code{0000-00-00}.  This is both a speed and convenience issue as we
believe that the database's responsibility is to retrieve the same date
you stored (even if the data was not logically correct in all cases).
We think it is up to the application to check the dates, and not the server.

@node Problems with NULL, Problems with alias, Using DATE, Query Issues
@appendixsubsec Problems with @code{NULL} Values

@cindex @code{NULL} values, vs. empty values

@tindex NULL

The concept of the @code{NULL} value is a common source of confusion for
newcomers to SQL, who often think that @code{NULL} is the same thing as an
empty string @code{""}.  This is not the case! For example, the following
statements are completely different:

@example
mysql> INSERT INTO my_table (phone) VALUES (NULL);
mysql> INSERT INTO my_table (phone) VALUES ("");
@end example

Both statements insert a value into the @code{phone} column, but the first
inserts a @code{NULL} value and the second inserts an empty string.  The
meaning of the first can be regarded as ``phone number is not known'' and the
meaning of the second can be regarded as ``she has no phone''.

In SQL, the @code{NULL} value is always false in comparison to any
other value, even @code{NULL}.  An expression that contains @code{NULL}
always produces a @code{NULL} value unless otherwise indicated in
the documentation for the operators and functions involved in the
expression. All columns in the following example return @code{NULL}:

@example
mysql> SELECT NULL,1+NULL,CONCAT('Invisible',NULL);
@end example

If you want to search for column values that are @code{NULL}, you
cannot use the @code{=NULL} test. The following statement returns no
rows, because @code{expr = NULL} is FALSE, for any expression:

@example
mysql> SELECT * FROM my_table WHERE phone = NULL;
@end example

To look for @code{NULL} values, you must use the @code{IS NULL} test.
The following shows how to find the @code{NULL} phone number and the
empty phone number:

@example
mysql> SELECT * FROM my_table WHERE phone IS NULL;
mysql> SELECT * FROM my_table WHERE phone = "";
@end example

Note that you can add an index on a column that can have @code{NULL}
values only if you are using MySQL Version 3.23.2 or newer and are using the
@code{MyISAM}, @code{InnoDB}, or @code{BDB} table type.
In earlier versions and with other table types, you must declare such
columns @code{NOT NULL}. This also means you cannot then insert
@code{NULL} into an indexed column.

@findex LOAD DATA INFILE
When reading data with @code{LOAD DATA INFILE}, empty columns are updated
with @code{''}. If you want a @code{NULL} value in a column, you should use
@code{\N} in the text file. The literal word @code{'NULL'} may also be used
under some circumstances.
@xref{LOAD DATA, , @code{LOAD DATA}}.

When using @code{ORDER BY}, @code{NULL} values are presented first, or
last if you specify @code{DESC} to sort in descending order. Exception:
In MySQL versions 4.0.2 through 4.0.10, @code{NULL} values sort first
regardless of sort order.

When using @code{GROUP BY}, all @code{NULL} values are regarded as equal.

Aggregate (summary) functions such as @code{COUNT()}, @code{MIN()}, and
@code{SUM()} ignore @code{NULL} values. The exception to this is
@code{COUNT(*)}, which counts rows and not individual column values.
For example, the following statement would produce two counts.
The first is a count of the number of rows in the table, and the second
is a count of the number of non-@code{NULL} values in the @code{age}
column:

@example
mysql> SELECT COUNT(*), COUNT(age) FROM person;
@end example

To help with @code{NULL} handling, you can use the @code{IS NULL} and
@code{IS NOT NULL} operators and the @code{IFNULL()} function.

@cindex @code{TIMESTAMP}, and @code{NULL} values
@cindex @code{AUTO_INCREMENT}, and @code{NULL} values
@cindex @code{NULL} values, and @code{TIMESTAMP} columns
@cindex @code{NULL} values, and @code{AUTO_INCREMENT} columns
For some column types, @code{NULL} values are handled specially.  If you
insert @code{NULL} into the first @code{TIMESTAMP} column of a table, the
current date and time is inserted.  If you insert @code{NULL} into an
@code{AUTO_INCREMENT} column, the next number in the sequence is inserted.


@node Problems with alias, Deleting from related tables, Problems with NULL, Query Issues
@appendixsubsec Problems with @code{alias}

@tindex alias

You can use an alias to refer to a column in the @code{GROUP BY},
@code{ORDER BY}, or in the @code{HAVING} part.  Aliases can also be used
to give columns better names:

@example
SELECT SQRT(a*b) as rt FROM table_name GROUP BY rt HAVING rt > 0;
SELECT id,COUNT(*) AS cnt FROM table_name GROUP BY id HAVING cnt > 0;
SELECT id AS "Customer identity" FROM table_name;
@end example

Note that standard SQL doesn't allow you to refer to an alias in a
@code{WHERE} clause.  This is because when the @code{WHERE} code is
executed the column value may not yet be determined. For example, the
following query is @strong{illegal}:

@example
SELECT id,COUNT(*) AS cnt FROM table_name WHERE cnt > 0 GROUP BY id;
@end example

The @code{WHERE} statement is executed to determine which rows should
be included in the @code{GROUP BY} part while @code{HAVING} is used to
decide which rows from the result set should be used.


@node Deleting from related tables, No matching rows, Problems with alias, Query Issues
@appendixsubsec Deleting Rows from Related Tables

@cindex deleting, rows
@cindex rows, deleting
@cindex tables, deleting rows

As MySQL doesn't support subqueries (prior to Version 4.1), nor the use of more
than one table in the @code{DELETE} statement (prior to Version 4.0), you
should use the following approach to delete rows from 2 related tables:

@enumerate
@item
@code{SELECT} the rows based on some @code{WHERE} condition in the main table.
@item
@code{DELETE} the rows in the main table based on the same condition.
@item
@code{DELETE FROM related_table WHERE related_column IN (selected_rows)}.
@end enumerate

If the total number of characters in the query with
@code{related_column} is more than 1,048,576 (the default value of
@code{max_allowed_packet}, you should split it into smaller parts and
execute multiple @code{DELETE} statements.  You will probably get the
fastest @code{DELETE} by only deleting 100-1000 @code{related_column}
ids per query if the @code{related_column} is an index.  If the
@code{related_column} isn't an index, the speed is independent of the
number of arguments in the @code{IN} clause.


@node No matching rows, Problems with float, Deleting from related tables, Query Issues
@appendixsubsec Solving Problems with No Matching Rows

@cindex no matching rows
@cindex rows, matching problems

If you have a complicated query that has many tables and that doesn't
return any rows, you should use the following procedure to find out what
is wrong with your query:

@enumerate
@item
Test the query with @code{EXPLAIN} and check if you can find something that is
obviously wrong. @xref{EXPLAIN, , @code{EXPLAIN}}.

@item
Select only those fields that are used in the @code{WHERE} clause.

@item
Remove one table at a time from the query until it returns some rows.
If the tables are big, it's a good idea to use @code{LIMIT 10} with the query.

@item
Do a @code{SELECT} for the column that should have matched a row against
the table that was last removed from the query.

@item
If you are comparing @code{FLOAT} or @code{DOUBLE} columns with numbers that
have decimals, you can't use @code{'='}. This problem is common in most
computer languages because floating-point values are not exact values.
In most cases, changing the @code{FLOAT} to a @code{DOUBLE} will fix this.
@xref{Problems with float}.

@item
If you still can't figure out what's wrong, create a minimal test that can
be run with @code{mysql test < query.sql} that shows your problems.
You can create a test file with @code{mysqldump --quick database tables > query.sql}. Open the file in an editor, remove some insert lines (if there are
too many of these), and add your select statement at the end of the file.

Test that you still have your problem by doing:

@example
shell> mysqladmin create test2
shell> mysql test2 < query.sql
@end example

Post the test file using @code{mysqlbug} to the general MySQL mailing list.
@xref{Mailing-list}.
@end enumerate

@node Problems with float,  , No matching rows, Query Issues
@appendixsubsec Problems with Floating-Point Comparison

floating-point numbers cause confusion sometimes, because these numbers
are not stored as exact values inside computer architecture. What one
can see on the screen usually is not the exact value of the number.

Field types @code{FLOAT}, @code{DOUBLE} and @code{DECIMAL} are such.

@example
CREATE TABLE t1 (i INT, d1 DECIMAL(9,2), d2 DECIMAL(9,2));
INSERT INTO t1 VALUES (1, 101.40, 21.40), (1, -80.00, 0.00),
(2, 0.00, 0.00), (2, -13.20, 0.00), (2, 59.60, 46.40),
(2, 30.40, 30.40), (3, 37.00, 7.40), (3, -29.60, 0.00),
(4, 60.00, 15.40), (4, -10.60, 0.00), (4, -34.00, 0.00),
(5, 33.00, 0.00), (5, -25.80, 0.00), (5, 0.00, 7.20),
(6, 0.00, 0.00), (6, -51.40, 0.00);

mysql> SELECT i, SUM(d1) AS a, SUM(d2) AS b
    -> FROM t1 GROUP BY i HAVING a <> b;
+------+--------+-------+
| i    | a      | b     |
+------+--------+-------+
|    1 |  21.40 | 21.40 |
|    2 |  76.80 | 76.80 |
|    3 |   7.40 |  7.40 |
|    4 |  15.40 | 15.40 |
|    5 |   7.20 |  7.20 |
|    6 | -51.40 |  0.00 |
+------+--------+-------+
@end example

The result is correct. Although the first five records look like they
shouldn't pass the comparison test, they may do so because the
difference between the numbers show up around tenth decimal, or so
depending on computer architecture.

The problem cannot be solved by using ROUND() (or similar function),
because the result is still a floating-point number. Example:

@example
mysql> SELECT i, ROUND(SUM(d1), 2) AS a, ROUND(SUM(d2), 2) AS b
    -> FROM t1 GROUP BY i HAVING a <> b;
+------+--------+-------+
| i    | a      | b     |
+------+--------+-------+
|    1 |  21.40 | 21.40 |
|    2 |  76.80 | 76.80 |
|    3 |   7.40 |  7.40 |
|    4 |  15.40 | 15.40 |
|    5 |   7.20 |  7.20 |
|    6 | -51.40 |  0.00 |
+------+--------+-------+
@end example

This is what the numbers in column 'a' look like:
@example
mysql> SELECT i, ROUND(SUM(d1), 2)*1.0000000000000000 AS a,
    -> ROUND(SUM(d2), 2) AS b FROM t1 GROUP BY i HAVING a <> b;
+------+----------------------+-------+
| i    | a                    | b     |
+------+----------------------+-------+
|    1 |  21.3999999999999986 | 21.40 |
|    2 |  76.7999999999999972 | 76.80 |
|    3 |   7.4000000000000004 |  7.40 |
|    4 |  15.4000000000000004 | 15.40 |
|    5 |   7.2000000000000002 |  7.20 |
|    6 | -51.3999999999999986 |  0.00 |
+------+----------------------+-------+
@end example

Depending on the computer architecture you may or may not see similar results.
Each CPU may evaluate floating-point numbers differently. For example in
some machines you may get 'right' results by multiplying both arguments
with 1, an example follows.

@strong{WARNING: NEVER TRUST THIS METHOD IN YOUR APPLICATION, THIS IS
AN EXAMPLE OF A WRONG METHOD!!!}

@example
mysql> SELECT i, ROUND(SUM(d1), 2)*1 AS a, ROUND(SUM(d2), 2)*1 AS b
    -> FROM t1 GROUP BY i HAVING a <> b;
+------+--------+------+
| i    | a      | b    |
+------+--------+------+
|    6 | -51.40 | 0.00 |
+------+--------+------+
@end example

The reason why the above example seems to be working is that on the
particular machine where the test was done, the CPU floating-point
arithmetics happens to round the numbers to same, but there is no
rule that any CPU should do so, so it cannot be trusted.

The correct way to do floating-point number comparison is to first
decide on what is the wanted tolerance between the numbers and then do
the comparison against the tolerance number. For example, if we agree on
that floating-point numbers should be regarded the same, if they are
same with precision of one of ten thousand (0.0001), the comparison
should be done like this:

@example
mysql> SELECT i, SUM(d1) AS a, SUM(d2) AS b FROM t1
    -> GROUP BY i HAVING ABS(a - b) > 0.0001;
+------+--------+------+
| i    | a      | b    |
+------+--------+------+
|    6 | -51.40 | 0.00 |
+------+--------+------+
1 row in set (0.00 sec)
@end example

And vice versa, if we wanted to get rows where the numbers are the same,
the test would be:

@example
mysql> SELECT i, SUM(d1) AS a, SUM(d2) AS b FROM t1
    -> GROUP BY i HAVING ABS(a - b) < 0.0001;
+------+-------+-------+
| i    | a     | b     |
+------+-------+-------+
|    1 | 21.40 | 21.40 |
|    2 | 76.80 | 76.80 |
|    3 |  7.40 |  7.40 |
|    4 | 15.40 | 15.40 |
|    5 |  7.20 |  7.20 |
+------+-------+-------+
@end example

@node Optimiser Issues, Table Definition Issues, Query Issues, Problems
@appendixsec Optimizer Related Issues

MySQL uses a cost based optimizer to find out the best way to resolve a
query.  In many cases MySQL can calculate the best possible query plan
but in some cases MySQL doesn't have enough information about the data
at hand and have to do some 'educated' guesses about the data.

This manual section is intended for the cases when MySQL doesn't get it
right.

The tools one has available to help MySQL do the 'right' things are:

@itemize @bullet
@item
@code{EXPLAIN}. @xref{EXPLAIN, , @code{EXPLAIN}}.
@item
@code{ANALYZE TABLE}. @xref{ANALYZE TABLE, , @code{ANALYZE TABLE}}.
@item
@code{USE INDEX}, @code{FORCE INDEX} and @code{IGNORE INDEX}. @xref{SELECT}.
@item
Global and table level @code{STRAIGHT JOIN}. @xref{SELECT}.
@item
Setting thread specific variables. @xref{SHOW VARIABLES}.
@end itemize

@menu
* How to avoid table scan::     How to avoid table scan,,,
@end menu

@node How to avoid table scan,  , Optimiser Issues, Optimiser Issues
@appendixsubsec How to avoid table scan,,,

@findex Table scan

@code{EXPLAIN} will show @code{ALL} in the @code{type} column when MySQL
uses a table scan to resolve a query. This happens usually when:

@itemize @bullet
@item
The table is so small that it's faster to do a table scan than a key lookup.
This is a common case for tables with < 10 rows and a short row length.
@item
There is no usable restrictions in the @code{ON} or @code{WHERE} clause
for indexed columns.
@item
You are comparing indexed columns with constants and MySQL has
calculated (based on the index tree) that the constants covers a too big
part of the table and a table scan would be faster. @xref{Where optimisations}.
@item
You are using a key with low cardinality (= many matching rows) through
another column.  MySQL will in this case assume that by using the key it
will probably do a lot of key lookups and in this case the table scan
would be faster.
@end itemize

What you can do to avoid a 'wrong' table scan for big tables are:

@itemize @bullet
@item
Use @code{ANALYZE TABLE} for the scanned table to update key distributions.
@xref{ANALYZE TABLE}.

@item
Use @code{FORCE INDEX} for the scanned table to tell MySQL that table
scans are very expensive compared to use one of the given index. @xref{SELECT}.

@example
SELECT * FROM t1,t2 force index(index_for_column) WHERE t1.column=t2.column;
@end example

@item
Start @code{mysqld} with @code{--max-seeks-for-key=1000} or do @code{SET
MAX_SEEKS_FOR_KEY=1000}  to tell the optimizer that for no key scan will
cause more than 1000 key seeks.
@end itemize

@node Table Definition Issues,  , Optimiser Issues, Problems
@appendixsec Table Definition Related Issues


@menu
* ALTER TABLE problems::        Problems with @code{ALTER TABLE}.
* Change column order::         How To Change the Order of Columns in a Table
* Temporary table problems::    TEMPORARY TABLE problems
@end menu

@node ALTER TABLE problems, Change column order, Table Definition Issues, Table Definition Issues
@appendixsubsec Problems with @code{ALTER TABLE}.

@tindex ALTER TABLE
@cindex changing, table
@cindex table, changing

@code{ALTER TABLE} changes a table to the current character set.
If you get a duplicate key error during @code{ALTER TABLE}, then the cause
is either that the new character sets maps two keys to the same value
or that the table is corrupted, in which case you should run
@code{REPAIR TABLE} on the table.

If @code{ALTER TABLE} dies with an error like this:

@example
Error on rename of './database/name.frm' to './database/B-a.frm' (Errcode: 17)
@end example

the problem may be that MySQL has crashed in a previous @code{ALTER
TABLE} and there is an old table named @file{A-something} or
@file{B-something} lying around.  In this case, go to the MySQL data
directory and delete all files that have names starting with @code{A-} or
@code{B-}.  (You may want to move them elsewhere instead of deleting them.)

@code{ALTER TABLE} works the following way:

@itemize @bullet
@item Create a new table named @file{A-xxx} with the requested changes.
@item All rows from the old table are copied to @file{A-xxx}.
@item The old table is renamed @file{B-xxx}.
@item @file{A-xxx} is renamed to your old table name.
@item @file{B-xxx} is deleted.
@end itemize

If something goes wrong with the renaming operation, MySQL tries to
undo the changes.  If something goes seriously wrong (this shouldn't
happen), MySQL may leave the old table as @file{B-xxx}, but a
simple rename on the system level should get your data back.


@node Change column order, Temporary table problems, ALTER TABLE problems, Table Definition Issues
@appendixsubsec How To Change the Order of Columns in a Table

@cindex reordering, columns
@cindex columns, changing
@cindex changing, column order
@cindex tables, changing column order

The whole point of SQL is to abstract the application from the data
storage format.  You should always specify the order in which you wish to
retrieve your data.  For example:

@example
SELECT col_name1, col_name2, col_name3 FROM tbl_name;
@end example

will return columns in the order @code{col_name1}, @code{col_name2}, @code{col_name3}, whereas:

@example
SELECT col_name1, col_name3, col_name2 FROM tbl_name;
@end example

will return columns in the order @code{col_name1}, @code{col_name3}, @code{col_name2}.

If you want to change the order of columns anyway, you can do it as follows:

@enumerate
@item
Create a new table with the columns in the right order.
@item
Execute
@code{INSERT INTO new_table SELECT fields-in-new_table-order FROM old_table}.
@item
Drop or rename @code{old_table}.
@item
@code{ALTER TABLE new_table RENAME old_table}.
@end enumerate

In an application, you should @strong{never} use @code{SELECT *} and
retrieve the columns based on their position, because the order and
position in which columns are returned will not remain
the same if you add, move, or delete columns. A simple change to your
database structure would then cause your application to fail.
@code{SELECT *} is quite suitable for testing queries.


@node Temporary table problems,  , Change column order, Table Definition Issues
@appendixsubsec TEMPORARY TABLE problems

@cindex temporary tables, problems

The following are a list of the limitations with @code{TEMPORARY TABLES}.

@itemize @bullet
@item
A temporary table can only be of type @code{HEAP}, @code{ISAM},
@code{MyISAM}, @code{MERGE}, or @code{InnoDB}.
@item
You can't use temporary tables more than once in the same query.
For example, the following doesn't work.

@example
mysql> SELECT * FROM temporary_table, temporary_table AS t2;
@end example
@item
You can't use @code{RENAME} on a @code{TEMPORARY} table.
Note that @code{ALTER TABLE org_name RENAME new_name} works!
@end itemize


@node Credits, News, Problems, Top
@appendix Credits

@cindex developers, list of

This appendix lists the developers, contributors, and supporters that have
helped to make MySQL what it is today.

@menu
* Developers::                  Developers at MySQL AB
* Contributors::                Contributors to MySQL
* Documenters/Translators::     Documenters and translators
* Used Libraries::              Libraries used by and included with MySQL
* Packages::                    Packages that support MySQL
* Tools used to create MySQL::  Tools that were used to create MySQL
* Supporters::                  Supporters of MySQL
@end menu


@node Developers, Contributors, Credits, Credits
@appendixsec Developers at MySQL AB

These are the developers that are or have been employed by @code{MySQL AB}
to work on the @code{MySQL} database software, roughly in the order they
started to work with us. Following each developer is a small list of the
tasks that the developer is responsible for, or the accomplishments they
have made. All developers are involved in support.

@c Updated by arjen 2002-08-06
@c Note: This is a non-exhaustive list. It just documents some notable
@c achievements, not each individual task. Nor is it a complete list
@c of past/present job roles (see above). That said, updates welcome!

@table @asis
@item Michael (Monty) Widenius
@itemize @bullet
@item
Lead developer and main author of the MySQL server (@code{mysqld}).
@item
New functions for the string library.
@item
Most of the @code{mysys} library.
@item
The @code{ISAM} and @code{MyISAM} libraries (B-tree index file
handlers with index compression and different record formats).
@item
The @code{HEAP} library. A memory table system with our superior full dynamic
hashing. In use since 1981 and published around 1984.
@item
The @code{replace} program (take a look at it, it's @strong{COOL}!).
@item
@code{MyODBC}, the ODBC driver for Windows95.
@item
Fixing bugs in MIT-pthreads to get it to work for MySQL Server. And
also Unireg, a curses-based application tool with many utilities.
@item
Porting of @code{mSQL} tools like @code{msqlperl}, @code{DBD}/@code{DBI}, and
@code{DB2mysql}.
@item
Most of @code{crash-me} and the foundation for the MySQL benchmarks.
@end itemize

@item David Axmark
@itemize @bullet
@item
Initial main writer of the @strong{Reference Manual},
including enhancements to @code{texi2html}.
@item
Automatic web site updating from the manual.
@item
Initial Autoconf, Automake, and Libtool support.
@item
Licensing.
@item
Parts of all the text files.  (Nowadays only the @file{README} is
left. The rest ended up in the manual.)
@item
Lots of testing of new features.
@item
Our in-house Free Software legal expert.
@item
Mailing list maintainer (who never has the time to do it right...).
@item
Our original portability code (more than 10 years old now). Nowadays
only some parts of @code{mysys} are left.
@item
Someone for Monty to call in the middle of the night when he just got
that new feature to work.
@item
Chief "Open Sourcerer" (MySQL community relations).
@end itemize

@item Jani Tolonen
@itemize @bullet
@item
@code{mysqlimport}
@item
A lot of extensions to the command-line clients.
@item
@code{PROCEDURE ANALYSE()}
@end itemize

@item Sinisa Milivojevic
@itemize @bullet
@item
Compression (with @code{zlib}) in the client/server protocol.
@item
Perfect hashing for the lexical analyzer phase.
@item
Multi-row @code{INSERT}
@item
@code{mysqldump} -e option
@item
@code{LOAD DATA LOCAL INFILE}
@item
@code{SQL_CALC_FOUND_ROWS} @code{SELECT} option
@item
@code{--max-user-connections=...} option
@item
@code{net_read} and @code{net_write_timeout}
@item
@code{GRANT}/@code{REVOKE} and @code{SHOW GRANTS FOR}
@item
New client/server protocol for 4.0
@item
@code{UNION} in 4.0
@item
Multiple-table @code{DELETE}/@code{UPDATE}
@item
Derived tables in 4.1
@item
User resources management
@item
Initial developer of the @code{MySQL++} C++ API and the @code{MySQLGUI} client.
@end itemize

@item Tonu Samuel (past developer)
@itemize @bullet
@item
VIO interface (the foundation for the encrypted client/server protocol).
@item
MySQL Filesystem (a way to use MySQL databases as files
and directories).
@item
The @code{CASE} expression.
@item
The @code{MD5()} and @code{COALESCE()} functions.
@item
@code{RAID} support for @code{MyISAM} tables.
@end itemize

@item Sasha Pachev
@itemize @bullet
@item
Initial implementation of replication (up to version 4.0).
@item
@code{SHOW CREATE TABLE}.
@item
@code{mysql-bench}
@end itemize

@item Matt Wagner
@itemize @bullet
@item
MySQL test suite.
@item
Webmaster (until 2002).
@item
Coordinator of development.
@end itemize

@item Miguel Solorzano
@itemize @bullet
@item
Win32 development and release builds.
@item
Windows NT server code.
@item
WinMySQLAdmin
@end itemize

@item Timothy Smith (past developer)
@itemize @bullet
@item
Dynamic character sets support.
@item
configure, RPMs and other parts of the build system.
@item
Initial developer of @code{libmysqld}, the embedded server.
@end itemize

@item Sergei Golubchik
@itemize @bullet
@item
Full-text search.
@item
Added keys to the @code{MERGE} library.
@end itemize

@item Jeremy Cole
@itemize @bullet
@item
Proofreading and editing this fine manual.
@item
@code{ALTER TABLE ... ORDER BY ...}.
@item
@code{UPDATE ... ORDER BY ...}.
@item
@code{DELETE ... ORDER BY ...}.
@end itemize

@item Indrek Siitan
@itemize @bullet
@item
Designing/programming of our web interface.
@item
Author of our newsletter management system.
@end itemize

@item Jorge del Conde
@itemize @bullet
@item
@code{MySQLCC} (@code{MySQL Control Center})
@item
Win32 development
@item
Initial implementation of the website portals.
@end itemize

@item Venu Anuganti
@itemize @bullet
@item
Connector/ODBC (MyODBC) 3.51
@item
New client/server protocol for 4.1 (for prepared statements).
@item
@end itemize

@item Arjen Lentz
@itemize @bullet
@item
Maintainer of the MySQL Reference Manual.
@item
Preparing the O'Reilly printed edition of the manual.
@end itemize

@item Alexander (Bar) Barkov, Alexey (Holyfoot) Botchkov, and Ramil Kalimullin
@itemize @bullet
@item
Spatial data (GIS) and R-Trees implementation for 4.1
@item
Unicode and character sets for 4.1; documentation for same
@end itemize

@item Oleksandr (Sanja) Byelkin
@itemize @bullet
@item
Query cache in 4.0
@item
Implementation of subqueries (4.1).
@end itemize

@item Aleksey (Walrus) Kishkin and Alexey (Ranger) Stroganov
@itemize @bullet
@item
Benchmarks design and analysis.
@item
Maintenance of the MySQL test suite.
@end itemize

@item Zak Greant
@itemize @bullet
@item
Open Source advocate, MySQL community relations.
@end itemize

@item Carsten Pedersen
@itemize @bullet
@item
The MySQL Certification program.
@end itemize

@item Lenz Grimmer
@itemize @bullet
@item
Production (build and release) engineering.
@end itemize

@item Peter Zaitsev
@itemize @bullet
@item
@code{SHA1()}, @code{AES_ENCRYPT()} and @code{AES_DECRYPT()} functions.
@item
Debugging, cleaning up various features.
@end itemize

@item Alexander (Salle) Keremidarski
@itemize @bullet
@item
Support.
@item
Debugging.
@end itemize

@item Per-Erik Martin
@itemize @bullet
@item
Lead developer for stored procedures (5.0) and triggers.
@end itemize

@item Jim Winstead
@itemize @bullet
@item
Lead web developer.
@end itemize

@item Mark Matthews
@itemize @bullet
@item
Connector/J driver (Java).
@end itemize

@item Peter Gulutzan
@itemize @bullet
SQL-99, SQL:2003 standards compliance.
@item
Documentation of existing MySQL code/algorithms.
@item
Character set documentation.
@end itemize

@item Guilhem Bichot
@itemize @bullet
@item
Replication, from @code{MySQL} version 4.0.
@item
Fixed handling of exponents for @code{DECIMAL}.
@item
Author of @code{mysql_tableinfo}.
@end itemize

@item Antony T. Curtis
@itemize @bullet
@item
Porting of the MySQL Database software to OS/2.
@end itemize

@end table


@node Contributors, Documenters/Translators, Developers, Credits
@appendixsec Contributors to MySQL

@cindex contributors, list of

While @code{MySQL AB} owns all copyrights in the @code{MySQL server}
and the @code{MySQL manual}, we wish to recognize those who have made
contributions of one kind or another to the @code{MySQL distribution}.
Contributors are listed here, in somewhat random order:

@table @asis
@item Gianmassimo Vigazzola @email{qwerg@@mbox.vol.it} or @email{qwerg@@tin.it}
The initial port to Win32/NT.
@item Per Eric Olsson
For more or less constructive criticism and real testing of the dynamic
record format.
@item Irena Pancirov @email{irena@@mail.yacc.it}
Win32 port with Borland compiler.  @code{mysqlshutdown.exe} and
@code{mysqlwatch.exe}
@item David J. Hughes
For the effort to make a shareware SQL database. At TcX, the predecessor
of MySQL AB, we started with @code{mSQL}, but found that it couldn't
satisfy our purposes so instead we wrote an SQL interface to our
application builder Unireg.  @code{mysqladmin} and @code{mysql} client are
programs that were largely influenced by their @code{mSQL} counterparts.
We have put a lot of effort into making the MySQL syntax a superset of
@code{mSQL}. Many of the API's ideas are borrowed from @code{mSQL} to
make it easy to port free @code{mSQL} programs to the MySQL API.
The MySQL software doesn't contain any code from @code{mSQL}.
Two files in the distribution (@file{client/insert_test.c} and
@file{client/select_test.c}) are based on the corresponding (non-copyrighted)
files in the @code{mSQL} distribution, but are modified as examples showing
the changes necessary to convert code from @code{mSQL} to MySQL Server.
(@code{mSQL} is copyrighted David J. Hughes.)
@item Patrick Lynch
For helping us acquire @uref{http://www.mysql.com/}.
@item Fred Lindberg
For setting up qmail to handle the MySQL mailing list and for the
incredible help we got in managing the MySQL mailing lists.
@item Igor Romanenko @email{igor@@frog.kiev.ua}
@code{mysqldump} (previously @code{msqldump}, but ported and enhanced by
Monty).
@item Yuri Dario
For keeping up and extending the MySQL OS/2 port.
@item Tim Bunce
Author of @code{mysqlhotcopy}.
@item Zarko Mocnik @email{zarko.mocnik@@dem.si}
Sorting for Slovenian language.
@item "TAMITO" @email{tommy@@valley.ne.jp}
The @code{_MB} character set macros and the ujis and sjis character sets.
@item Joshua Chamas @email{joshua@@chamas.com}
Base for concurrent insert, extended date syntax, debugging on NT, and
answering on the MySQL mailing list.
@item Yves Carlier @email{Yves.Carlier@@rug.ac.be}
@code{mysqlaccess}, a program to show the access rights for a user.
@item Rhys Jones @email{rhys@@wales.com} (And GWE Technologies Limited)
For one of the early JDBC drivers.
@item Dr Xiaokun Kelvin ZHU @email{X.Zhu@@brad.ac.uk}
Further development of one of the early JDBC drivers and other MySQL-related
Java tools.
@item James Cooper @email{pixel@@organic.com}
For setting up a searchable mailing list archive at his site.
@item Rick Mehalick @email{Rick_Mehalick@@i-o.com}
For @code{xmysql}, a graphical X client for MySQL Server.
@item Doug Sisk @email{sisk@@wix.com}
For providing RPM packages of MySQL for Red Hat Linux.
@item Diemand Alexander V. @email{axeld@@vial.ethz.ch}
For providing RPM packages of MySQL for Red Hat Linux-Alpha.
@item Antoni Pamies Olive @email{toni@@readysoft.es}
For providing RPM versions of a lot of MySQL clients for Intel
and SPARC.
@item Jay Bloodworth @email{jay@@pathways.sde.state.sc.us}
For providing RPM versions for MySQL Version 3.21.
@item David Sacerdote @email{davids@@secnet.com}
Ideas for secure checking of DNS hostnames.
@item Wei-Jou Chen @email{jou@@nematic.ieo.nctu.edu.tw}
Some support for Chinese(BIG5) characters.
@item  Wei He @email{hewei@@mail.ied.ac.cn}
A lot of functionality for the Chinese(GBK) character set.
@item Jan Pazdziora @email{adelton@@fi.muni.cz}
Czech sorting order.
@item Zeev Suraski @email{bourbon@@netvision.net.il}
@code{FROM_UNIXTIME()} time formatting, @code{ENCRYPT()} functions, and
@code{bison} advisor.
Active mailing list member.
@item Luuk de Boer @email{luuk@@wxs.nl}
Ported (and extended) the benchmark suite to @code{DBI}/@code{DBD}. Have
been of great help with @code{crash-me} and running benchmarks. Some new
date functions. The @code{mysql_setpermissions} script.
@item Alexis Mikhailov @email{root@@medinf.chuvashia.su}
User-defined functions (UDFs); @code{CREATE FUNCTION} and
@code{DROP FUNCTION}.
@item Andreas F. Bobak @email{bobak@@relog.ch}
The @code{AGGREGATE} extension to UDF functions.
@item Ross Wakelin @email{R.Wakelin@@march.co.uk}
Help to set up InstallShield for MySQL-Win32.
@item Jethro Wright III @email{jetman@@li.net}
The @file{libmysql.dll} library.
@item James Pereria @email{jpereira@@iafrica.com}
Mysqlmanager, a Win32 GUI tool for administering MySQL Servers.
@item Curt Sampson @email{cjs@@portal.ca}
Porting of MIT-pthreads to NetBSD/Alpha and NetBSD 1.3/i386.
@item Martin Ramsch @email{m.ramsch@@computer.org}
Examples in the MySQL Tutorial.
@item Steve Harvey
For making @code{mysqlaccess} more secure.
@item Konark IA-64 Centre of Persistent Systems Private Limited
@uref{http://www.pspl.co.in/konark/}.  Help with the Win64 port of the
MySQL server.
@item Albert Chin-A-Young.
Configure updates for Tru64, large file support and better TCP wrappers
support.
@item John Birrell
Emulation of @code{pthread_mutex()} for OS/2.
@item Benjamin Pflugmann
Extended @code{MERGE} tables to handle @code{INSERTS}. Active member
on the MySQL mailing lists.
@item Jocelyn Fournier
Excellent spotting and reporting innumerable bugs
(especially in the MySQL 4.1 subquery code).
@item Marc Liyanage
Maintaining the Mac OS X packages and providing invaluable feedback
on how to create Mac OS X PKGs.
@item Robert Rutherford
Providing invaluable information and feedback about the QNX port.
@end table

Other contributors, bugfinders, and testers: James H. Thompson, Maurizio
Menghini, Wojciech Tryc, Luca Berra, Zarko Mocnik, Wim Bonis, Elmar
Haneke, @email{jehamby@@lightside}, @email{psmith@@BayNetworks.com},
@email{duane@@connect.com.au}, Ted Deppner @email{ted@@psyber.com},
Mike Simons, Jaakko Hyvatti.

And lots of bug report/patches from the folks on the mailing list.

A big tribute goes to those that help us answer questions on the
MySQL mailing lists:

@table @asis
@item Daniel Koch @email{dkoch@@amcity.com}
Irix setup.
@item Luuk de Boer @email{luuk@@wxs.nl}
Benchmark questions.
@item Tim Sailer @email{tps@@users.buoy.com}
@code{DBD::mysql} questions.
@item Boyd Lynn Gerber @email{gerberb@@zenez.com}
SCO-related questions.
@item Richard Mehalick @email{RM186061@@shellus.com}
@code{xmysql}-related questions and basic installation questions.
@item Zeev Suraski @email{bourbon@@netvision.net.il}
Apache module configuration questions (log & auth), PHP-related
questions, SQL syntax-related questions and other general questions.
@item Francesc Guasch @email{frankie@@citel.upc.es}
General questions.
@item Jonathan J Smith @email{jsmith@@wtp.net}
Questions pertaining to OS-specifics with Linux, SQL syntax, and other
things that might need some work.
@item David Sklar @email{sklar@@student.net}
Using MySQL from PHP and Perl.
@item Alistair MacDonald @email{A.MacDonald@@uel.ac.uk}
Not yet specified, but is flexible and can handle Linux and maybe HP-UX.
Will try to get user to use @code{mysqlbug}.
@item John Lyon @email{jlyon@@imag.net}
Questions about installing MySQL on Linux systems, using either
@file{.rpm} files or compiling from source.
@item Lorvid Ltd. @email{lorvid@@WOLFENET.com}
Simple billing/license/support/copyright issues.
@item Patrick Sherrill @email{patrick@@coconet.com}
ODBC and VisualC++ interface questions.
@item Randy Harmon @email{rjharmon@@uptimecomputers.com}
@code{DBD}, Linux, some SQL syntax questions.
@end table

@node Documenters/Translators, Used Libraries, Contributors, Credits
@appendixsec Documenters and translators

@cindex Documenters, list of
@cindex Translators, list of

The following people has helped us with writing the MySQL documentation and
translating the documentation or error messages in MySQL.

@table @asis
@item Paul DuBois
Ongoing help with making this manual correct and understandable.
That includes rewriting Monty's and David's attempts at English into
English as other people know it.
@item Kim Aldale
Helped to rewrite Monty's and David's early attempts at English into English.
@item Michael J. Miller Jr. @email{mke@@terrapin.turbolift.com}
For the first MySQL manual. And a lot of spelling/language
fixes for the FAQ (that turned into the MySQL manual a long
time ago).
@item Yan Cailin
First translator of the MySQL Reference Manual into simplified
Chinese in early 2000 on which the Big5 and HK coded
(@uref{http://mysql.hitstar.com/}) versions were
based. @uref{http://linuxdb.yeah.net, Personal home page at
linuxdb.yeah.net}.
@item Jay Flaherty @email{fty@@mediapulse.com}
Big parts of the Perl @code{DBI}/@code{DBD} section in the manual.
@item Paul Southworth @email{pauls@@etext.org}, Ray Loyzaga @email{yar@@cs.su.oz.au}
Proof-reading of the Reference Manual.
@item Therrien Gilbert @email{gilbert@@ican.net}, Jean-Marc Pouyot @email{jmp@@scalaire.fr}
French error messages.
@item Petr Snajdr, @email{snajdr@@pvt.net}
Czech error messages.
@item Jaroslaw Lewandowski @email{jotel@@itnet.com.pl}
Polish error messages.
@item Miguel Angel Fernandez Roiz
Spanish error messages.
@item Roy-Magne Mo @email{rmo@@www.hivolda.no}
Norwegian error messages and testing of Version 3.21.#.
@item Timur I. Bakeyev @email{root@@timur.tatarstan.ru}
Russian error messages.
@item @email{brenno@@dewinter.com} & Filippo Grassilli @email{phil@@hyppo.com}
Italian error messages.
@item Dirk Munzinger @email{dirk@@trinity.saar.de}
German error messages.
@item Billik Stefan @email{billik@@sun.uniag.sk}
Slovak error messages.
@item Stefan Saroiu @email{tzoompy@@cs.washington.edu}
Romanian error messages.
@item Peter Feher
Hungarian error messages.
@item Roberto M. Serqueira
Portuguese error messages.
@item Carsten H. Pedersen
Danish error messages.
@item Arjen G. Lentz
Dutch error messages, completing earlier partial translation
(also work on consistency and spelling).
@end table

@node Used Libraries, Packages, Documenters/Translators, Credits
@appendixsec Libraries used by and included with MySQL

@cindex libraries, list of

The following is a list of the creators of the libraries we have
included with the MySQL server source to make it easy to compile and
install MySQL. We are very thankfully to all individuals that have
created these and it has made our life much easier.

@table @asis
@item Fred Fish
For his excellent C debugging and trace library. Monty has made a number
of smaller improvements to the library (speed and additional options).
@item Richard A. O'Keefe
For his public domain string library.
@item Henry Spencer
For his regex library, used in @code{WHERE column REGEXP regexp}.
@item Chris Provenzano
Portable user level pthreads. From the copyright: This product includes
software developed by Chris Provenzano, the University of California,
Berkeley, and contributors.  We are currently using version 1_60_beta6
patched by Monty (see @file{mit-pthreads/Changes-mysql}).
@item Jean-loup Gailly and Mark Adler
For the zlib library (used on MySQL on Windows).
@item Bjorn Benson
For his safe_malloc (memory checker) package which is used in when you
configure MySQL with @code{--debug}.
@item Free Software Foundation
The @code{readline} library (used by the @code{mysql} command line client).
@item The NetBSD foundation
The @code{libedit} package (optionally used by the @code{mysql} command line
client).
@end table

@node Packages, Tools used to create MySQL, Used Libraries, Credits
@appendixsec Packages that support MySQL

@cindex packages, list of
@cindex API's, list of

The following is a list of creators/maintainers of some of the most
important API/packages/applications that a lot of people use with MySQL.

We can't list every possible package here becasue the list would then be
way to hard to maintain. For other packages, please refer to the
software portal at @uref{http://www.mysql.com/portal/software}.

@table @asis
@item Tim Bunce, Alligator Descartes
For the @code{DBD} (Perl) interface.
@item Andreas Koenig @email{a.koenig@@mind.de}
For the Perl interface for MySQL Server.
@item Jochen Wiedmann @email{wiedmann@@neckar-alb.de}
For maintaining the Perl @code{DBD::mysql} module.
@item Eugene Chan @email{eugene@@acenet.com.sg}
For porting PHP for MySQL Server.
@item Georg Richter
MySQL 4.1 testing and bug hunting.
New PHP 5.0 @code{mysqli} extension (API) for use with MySQL 4.1 and up.
@item Giovanni Maruzzelli @email{maruzz@@matrice.it}
For porting iODBC (Unix ODBC).
@item Xavier Leroy @email{Xavier.Leroy@@inria.fr}
The author of LinuxThreads (used by the MySQL Server on Linux).
@end table

@node Tools used to create MySQL, Supporters, Packages, Credits
@appendixsec Tools that were used to create MySQL

@cindex tools, list of

The following is a list of some of the tools we have used to create MySQL.
We use this to express our thanks to those that has created them as without
these we could not have made MySQL what is is today.

@table @asis
@item Free Software Foundation
From whom we got an excellent compiler (@code{gcc}), an excellent
debugger (@code{gdb} and the @code{libc} library (from which we have
borrowed @file{strto.c} to get some code working in Linux).
@item Free Software Foundation & The XEmacs development team
For a really great editor/environment used by almost everybody at
MySQL AB.
@item Julian Seward
Author of @code{valgrind}, an excellent memory checker tool that has helped
us find a lot of otherwise hard to find bugs in MySQL.
@item Dorothea Ltkehaus and Andreas Zeller
For @code{DDD} (The Data Display Debugger) which is an excellent
graphical frontend to @code{gdb}).
@end table

@node Supporters,  , Tools used to create MySQL, Credits
@appendixsec Supporters of MySQL

@cindex contributing companies, list of

While @code{MySQL AB} owns all copyrights in the @code{MySQL server}
and the @code{MySQL manual}, we wish to recognize the following companies,
which helped us finance the development of the @code{MySQL server},
such as by paying us for developing a new feature or giving us hardware
for development of the @code{MySQL server}.

@table @asis
@item VA Linux / Andover.net
Funded replication.
@item NuSphere
Editing of the MySQL manual.
@item Stork Design studio
The MySQL web site in use between 1998-2000.
@item Intel
Contributed to development on Windows and Linux platforms.
@item Compaq
Contributed to Development on Linux/Alpha.
@item SWSoft
Development on the embedded @code{mysqld} version.
@item FutureQuest
@code{--skip-show-database}
@end table


@node News, Porting, Credits, Top
@appendix MySQL Change History

@cindex ChangeLog
@cindex changes, log
@cindex log, changes

This appendix lists the changes from version to version in the MySQL
source code.

We are now working actively on MySQL 4.1 and 5.0, and will provide
only critical bug fixes for MySQL 4.0 and MySQL 3.23.  We update this section
as we add new features, so that everybody can follow the development.

Our TODO section contains what further plans we have for 4.1 & 5.0.
@xref{TODO}.

Note that we tend to update the manual at the same time we make changes to
MySQL.  If you find a version listed here that you can't
find on the MySQL download page (@uref{http://www.mysql.com/downloads/}),
this means that the version has not yet been released!

The date mentioned with a release version is the date of the last BitKeeper
ChangeSet that this particular release has been based on, not the date when
the packages have been made available. The binaries are usually made
available a few days after the date of the tagged ChangeSet - building and
testing all packages takes some time.

@c Please don't add a new version here without also updating Docs/include.texi!

@menu
* News-5.0.x::                  Changes in release 5.0.x (Development)
* News-4.1.x::                  Changes in release 4.1.x (Alpha)
* News-4.0.x::                  Changes in release 4.0.x (Production)
* News-3.23.x::                 Changes in release 3.23.x (Recent; still supported)
* News-3.22.x::                 Changes in release 3.22.x (Old; discontinued)
* News-3.21.x::                 Changes in release 3.21.x
* News-3.20.x::                 Changes in release 3.20.x
* News-3.19.x::                 Changes in release 3.19.x
@end menu


@node News-5.0.x, News-4.1.x, News, News
@appendixsec Changes in release 5.0.x (Development)

@cindex changes, version 5.0

The following changelog shows what has already been done in the 5.0 tree:

@itemize @bullet
@item
Basic support for stored procedures (SQL:2003 style).
@xref{Stored Procedures}.
@item
Added @code{SELECT INTO list_of_vars}, which can be of mixed,
that is, global and local type.
@xref{SELECT INTO Statement}.
@item
Removed the update log. It is fully replaced by the binary log.
If the MySQL server is started with @code{--log-update}, it will be
translated to @code{--log-bin} (or ignored if the server is explicitly
started with @code{--log-bin}), and a warning message will be written to
the error log. Setting @code{SQL_LOG_UPDATE} will silently set
@code{SQL_LOG_BIN} instead (or do nothing if the server is explicitly
started with @code{--log-bin}).
@item
User variable names are now case insensitive: if you do @code{SET
@@a=10;} then @code{SELECT @@A;} will now return @code{10}.
Case sensitivity of a variable's value depends on the collation of the value.
@end itemize

For a full list of changes, please refer to the changelog sections for
each individual 5.0.x release.

@menu
* News-5.0.1::                  Changes in release 5.0.1 (not released yet)
* News-5.0.0::                  Changes in release 5.0.0 (22 Dec 2003: Alpha)
@end menu

@node News-5.0.1, News-5.0.0, News-5.0.x, News-5.0.x
@appendixsubsec Changes in release 5.0.1 (not released yet)

@c NOTE: References to bug numbers should be written after the sentence
@c NOTE: describing the bugfix, like this:
@c NOTE: This sentence describes the fix. (Bug #nnnn)

Functionality added or changed:
@itemize @bullet
@item
For replication of @code{HEAP} tables:
Made the master automatically write a @code{DELETE FROM} statement
to its binary log when a @code{HEAP} table is opened for the first time since
master's startup. This is for the case where the slave has replicated a
non-empty @code{HEAP} table, then the master is shut down and restarted: the
table is now empty on master; the @code{DELETE FROM} empties it on slave
too. Note that even with this fix, between the master's restart and the first
use of the table on master, the slave still has out-of-date data in the
table. But if you use the @code{init-file} option to populate the @code{HEAP}
table on the master at startup, it ensures that the failing time interval is
zero. (Bug #2477)
@end itemize

Bugs fixed:
@itemize @bullet
@item
@code{ALTER DATABASE} caused the client to hang if the database did not
exist. (Bug #2333)
@item
@code{SLAVE START} (which is a deprecated syntax, @code{START SLAVE} should be
used instead) could crash the slave. (Bug #2516)
@item
Multiple-table @code{DELETE} statements were never replicated by the slave if
there were any @code{replicate-*-table} options. (Bug #2527)
@end itemize


@node News-5.0.0,  , News-5.0.1, News-5.0.x
@appendixsubsec Changes in release 5.0.0 (22 Dec 2003: Alpha)

Functionality added or changed:
@itemize @bullet
@item
The @code{KILL} statement now takes @code{CONNECTION} and @code{QUERY}
variants. The first is the same as @code{KILL} with no modifier (it
kills a given connection thread).  The second kills only the statement
currently being executed by the connection.
@item
Added @code{TIMESTAMPADD()} and @code{TIMESTAMPDIFF()} functions.
@item
Added @code{WEEK} and @code{QUARTER} values as @code{INTERVAL} arguments
for @code{DATE_ADD()} and @code{DATE_SUB()} functions.
@item
New binary log format which enables replication of those session variables:
@code{SQL_MODE}, @code{SQL_AUTO_IS_NULL}, @code{FOREIGN_KEY_CHECKS}
(that one was already replicated since 4.0.14 but here it's done more
efficiently: takes less space in the binary logs), @code{UNIQUE_CHECKS}.
Other variables (like character sets, @code{SQL_SELECT_LIMIT}...) will be
replicated in next 5.0.x releases.
@item
@code{Merge Index} optimization for @code{OR} clauses.
@xref{OR optimizations}.
@item
Basic support for stored procedures (SQL:2003 style).
@xref{Stored Procedures}.
@item
Added @code{SELECT INTO list_of_vars}, which can be of mixed,
that is, global and local type.
@xref{SELECT INTO Statement}.
@item
Easier replication upgrade (5.0.0 masters can read older binary logs,
5.0.0 slaves can read older relay logs; see
@ref{Replication Upgrade} for more details). The format of the binary log and
relay log is changed compared to the one of MySQL 4.1 and older.
@item
@strong{IMPORTANT NOTE:}
If you upgrade to InnoDB-4.1.1 or higher, you cannot downgrade to a version
lower than 4.1.1 any more! That is because earlier versions of InnoDB are
not aware of multiple tablespaces.
@end itemize

Bugs fixed:
@itemize @bullet
@end itemize


@node News-4.1.x, News-4.0.x, News-5.0.x, News
@appendixsec Changes in release 4.1.x (Alpha)

@cindex changes, version 4.1

Version 4.1 of the MySQL server includes many enhancements and new features.
Binaries for this version are available for download at
@uref{http://www.mysql.com/downloads/mysql-4.1.html}.

@itemize @bullet
@item
Subqueries and derived tables (unnamed views).
@xref{Subqueries}.
@item
@code{INSERT ... ON DUPLICATE KEY UPDATE ...} syntax.  This allows you to
@code{UPDATE} an existing row if the insert would cause a duplicate value
in a @code{PRIMARY} or @code{UNIQUE} key. (@code{REPLACE} allows you to
overwrite an existing row, which is something entirely different.)
@xref{INSERT}.
@item
A newly designed @code{GROUP_CONCAT()} aggregate function.
@xref{Group by functions and modifiers}.
@item
Extensive Unicode (UTF8) support.
@item
Character sets can be defined per column, table, and database.
@item
New key cache for @code{MyISAM} tables with many tunable parameters.  You can
have multiple key caches, preload index into caches for batches...
@item
@code{BTREE} index on @code{HEAP} tables.
@item
Support for OpenGIS spatial types (geographical data).
@xref{Spatial extensions in MySQL}.
@item
@code{SHOW WARNINGS} shows warnings for the last command.
@xref{SHOW WARNINGS,  , @code{SHOW WARNINGS}}.
@item
Faster binary protocol with prepared statements and parameter binding.
@xref{C API Prepared statements}.
@item
You can now issue multiple statements with a single C API call and
then read the results in one go.
@xref{C API multiple queries}.
@item
Create Table: @code{CREATE [TEMPORARY] TABLE [IF NOT EXISTS] table2 LIKE
table1}.
@item
Server based @code{HELP} command that can be used in the @code{mysql}
command line client (and other clients) to get help for SQL statements.
@end itemize

For a full list of changes, please refer to the changelog sections for
each individual 4.1.x release.

@menu
* News-4.1.2::                  Changes in release 4.1.2 (not released yet)
* News-4.1.1::                  Changes in release 4.1.1 (01 Dec 2003)
* News-4.1.0::                  Changes in release 4.1.0 (03 Apr 2003: Alpha)
@end menu

@node News-4.1.2, News-4.1.1, News-4.1.x, News-4.1.x
@appendixsubsec Changes in release 4.1.2 (not released yet)

@c NOTE: References to bug numbers should be written after the sentence
@c NOTE: describing the bugfix, like this:
@c NOTE: This sentence describes the fix. (Bug #nnnn)

Functionality added or changed:
@itemize @bullet
@item
@code{mysqlhotcopy} now works on NetWare.
@item
@code{ALTER TABLE DROP PRIMARY KEY} no longer drops the first @code{UNIQUE}
index if there is no primary index. (Bug #2361)
@item
Added @code{latin1_spanish_ci} (Modern Spanish) collation for the @code{latin1}
character set.
@item
@code{ENGINE} is now a synonym for the @code{TYPE} option for
@code{CREATE TABLE} and @code{ALTER TABLE}.
@item
Added @code{init_connect} and @code{init_slave} server variables.
The values should be SQL statements to be executed when each client
connects or each time a slave's SQL thread starts, respectively.
@item
C API enhancement:
@code{SERVER_QUERY_NO_INDEX_USED} and
@code{SERVER_QUERY_NO_GOOD_INDEX_USED} flags are now set
in @code{server_status} field of @code{MYSQL} structure.
It is these flags that make the query to be logged as slow 
if @file{mysqld} was started with @code{--log-slow-queries
--log-queries-not-using-indexes}.
@item
For replication of @code{HEAP} tables:
Made the master automatically write a @code{DELETE FROM} statement
to its binary log when a @code{HEAP} table is opened for the first time since
master's startup. This is for the case where the slave has replicated a
non-empty @code{HEAP} table, then the master is shut down and restarted: the
table is now empty on master; the @code{DELETE FROM} empties it on slave
too. Note that even with this fix, between the master's restart and the first
use of the table on master, the slave still has out-of-date data in the
table. But if you use the @code{init-file} option to populate the @code{HEAP}
table on the master at startup, it ensures that the failing time interval is
zero. (Bug #2477)
@end itemize

Bugs fixed:
@itemize @bullet
@item
Fixed bug when mysqldump didn't quote "tricky" names correctly (Bug #2592)
@item 
Fix for a bug in 4.1.2 that prevented table / column privileges from
being loaded on startup. (Bug #2546)
@item
Fixed bug in replication with @code{CREATE TABLE .. LIKE ..} that resulted
in a statement not being written to the binary log. (Bug #2557)
@item
Fixed memory leak in @code{INSERT ... ON DUPLICATE KEY UPDATE ...}. 
(Bug #2438)
@item
Fixed bug in the parser, making the syntax @code{CONVERT(expression,type)}
legal again.
@item
Fixed parsing of short-form IP addresses in @code{INET_ATON()}. (Bug #2310)
@item
Fixed a bug in @code{CREATE ... SELECT} that sometimes caused a
string column with a multi-byte character set (such as @code{utf8}) to have
insufficient length to hold the data.
@item
Fixed a rare table corruption on adding data (@code{INSERT}, @code{REPLACE},
@code{UPDATE}, etc. but not @code{DELETE}) to a @code{FULLTEXT} index.
(Bug #2417)
@item
Compile the @code{MySQL-client} RPM package against @code{libreadline} instead
of @code{libedit}. (Bug #2289)
@item
Fix for a crashing bug that was caused by not setting
@code{vio_timeout()} virtual function for all protocols. This bug occurred on
Windows. (Bug #2025)
@item
Fix for a bug that caused @code{mysql} client program to erroneously
cache the value of the current database. (Bug #2025)
@item
Fix for a bug that caused client/server communication to be
broken when @code{mysql_set_server_option()} or
@code{mysql_get_server_option()} were invoked.
(Bug #2207)
@item
Fix for a bug that caused wong results when @code{CAST()} was
applied on @code{NULL} to signed or unsigned integer column.
(Bug #2219)
@item
Fix for a crashing bug that occurred in the @code{mysql} client program when
database name was longer then expected.
(Bug #2221)
@item
Fixed a bug in @code{CHECK TABLE} that occasionally resulted in
spurious "Found key at page ... that points to record outside
datafile" error on a table with a @code{FULLTEXT} index. (Bug #2190)
@item
Fixed bug in @code{GRANT} with table-level privilege handling. (Bug #2178)
@item
Fixed bug in @code{ORDER BY} on a small column. (Bug #2147)
@item
Fixed a bug with the @code{INTERVAL()} function when 8 or more 
comparison arguments are provided. (Bug #1561)
@item
Packaging:
Fixed a bug in the Mac OS PKG @code{postinstall} script
(@code{mysql_install_db} was called with an obsolete argument).
@item
Packaging:
Added missing file @file{mysql_create_system_tables} to the server RPM
package. This bug was fixed for the 4.1.1 RPMs by updating the MySQL-server
RPM from @code{MySQL-server-4.1.1-0} to @code{MySQL-server-4.1.1-1}. The
other RPMs were not affected by this change.
@item
Fixed a bug in @file{myisamchk} and @code{CHECK TABLE} that sometimes
resulted in a spurious error @code{Found key at page ..... that points to record
outside datafile} for a table with a @code{FULLTEXT} index. (Bug #1977)
@item
Fixed a hang in full-text indexing of strings in multi-byte (all besides
@code{utf8}) charsets. (Bug #2065)
@item
Fixed a crash in full-text indexing of UTF8 data. (Bug #2033)
@item
Replication:
a rare race condition in the slave SQL thread that could lead to an
incorrect complaint that the relay log is corrupted. (Bug #2011)
@item
Replication:
if an administrative command on a table (@code{OPTIMIZE TABLE}, @code{REPAIR
TABLE} etc) was run on the slave, this could sometimes stop the slave
SQL thread (this did not lead to any corruption; one just had to type
@code{START SLAVE} to get replication going again). (Bug #1858)
@item
Replication:
in the slave SQL thread, a multi-table @code{UPDATE} could produce an
incorrect complaint that some record was not found in one table, if the
@code{UPDATE} was preceded by a @code{INSERT ... SELECT}. (Bug #1701)
@item
Replication: sometimes the master gets a non-fatal error during the execution
of a statement but finally the statements succeeds (for example, a write to a
MyISAM table first receives "no space left on device" but is able to finally
complete, @pxref{Full disk}); the bug was that the master forgot to reset the
error code to 0 after success, so the error code got into its binary log, thus
making the slave giving false alarms like "did not get the same error as on
master". (Bug #2083)
@item
Removed a misleading "check permissions on master.info" from a replication
error message, because the cause of the problem could be different from
permissions. (Bug #2121)
@item
Fixed a crash when the replication slave was unable to create the first relay
log. (Bug #2145)
@item
@code{ALTER DATABASE} caused the client to hang if the database did not
exist. (Bug #2333)
@item
Multi-table @code{DELETE} statements were never replicated by the slave if
there were any @code{replicate-*-table} options. (Bug #2527)
@item
Fixed bug in @code{ALTER TABLE RENAME}, when rename to the table with
the same name in another database silently dropped destination table if
it existed. (Bug #2628)
@end itemize

@node News-4.1.1, News-4.1.0, News-4.1.2, News-4.1.x
@appendixsubsec Changes in release 4.1.1 (01 Dec 2003)

This release includes all fixes in MySQL 4.0.16 and most of the fixes
in MySQL 4.0.17.

Functionality added or changed:
@itemize @bullet
@item
It is now possible to create multiple key caches, assign table indexes to
particular caches, and to preload indexes into caches.
@xref{CACHE INDEX,  , @code{CACHE INDEX}}.
@xref{LOAD INDEX,  , @code{LOAD INDEX}}.
Structured system
variables are introduced as a means of grouping related key cache parameters.
@xref{Structured System Variables}.
@item
New @code{COERCIBILITY()} function to return the collation coercibility of a
string.
@item
@code{mysqldump} now includes a statement in the dump output to set
@code{FOREIGN_KEY_CHECKS} to 0 to avoid problems with tables having to be
reloaded in a particular order when the dump is reloaded. The existing
@code{FOREIGN_KEY_CHECKS} value is saved and restored.
@item
@strong{IMPORTANT NOTE: if you upgrade to InnoDB-4.1.1 or higher,
you cannot downgrade to a version lower than 4.1.1
any more! That is because earlier versions of InnoDB are not aware of
multiple tablespaces.}
@item
One can revoke all privileges from a user with @code{REVOKE ALL
PRIVILEGES, GRANT FROM user_list}.
@item
Added @code{IGNORE} option for @code{DELETE} statement.
@item
The MySQL source distribution now also includes the MySQL Internals
Manual @file{internals.texi}.
@item
Added @code{mysql_set_server_option()} C API client function to allow multiple
statement handling in the server to be enabled or disabled.
@item
The @code{mysql_next_result()} C API function now returns @code{-1} if there
are no more result sets.
@item
Renamed @code{CLIENT_MULTI_QUERIES} connect option flag to
@code{CLIENT_MULTI_STATEMENTS}. To allow for a transition period, the old
option will continue to be recognized for a while.
@item
Require @code{DEFAULT} before table and database default character set.
This enables us to use @code{ALTER TABLE table_name ... CHARACTER SET=...}
to change the character set for all @code{CHAR}, @code{VARCHAR}, and
@code{TEXT} columns in a table.
@item
Added @code{MATCH ... AGAINST( ... WITH QUERY EXPANSION)} and the
@code{ft_query_expansion_limit} server variable.
@item
Removed unused @code{ft_max_word_len_for_sort} server variable.
@item
Full-text search now supports multi-byte character sets and the Unicode
@code{utf8} character set. (The Unicode @code{ucs2} character set is not
yet supported.)
@item
Phrase search in @code{MATCH ... AGAINST ( ... IN BOOLEAN MODE)} no longer
matches partial words.
@item
Added aggregate function @code{BIT_XOR()} for bitwise XOR operations.
@item
Replication over SSL now works.
@item
The @code{START SLAVE} statement now supports an @code{UNTIL} clause for
specifying that the slave SQL thread should be started but run only until it
reaches a given position in the master's binary logs or in the slave's relay logs.
@item
Produce warnings even for single-row @code{INSERT} statements, not just for
multiple-row @code{INSERT} statements. Previously, it was necessary to set
@code{SQL_WARNINGS=1} to generate warnings for single-row statements.
@item
Added @code{delimiter} (@code{\d}) command to the @code{mysql} command-line
client for changing the statement delimiter (terminator).
The default delimiter is semicolon.
@item
@code{CHAR}, @code{VARCHAR}, and @code{TEXT} columns now have lengths measured
in characters rather than in bytes.
The character size depends on the column's character set.
This means, for example, that a @code{CHAR(n)} column
for a multi-byte character set will take more storage than before.
Similarly, index values on such columns are measured in characters, not bytes.
@item
@code{LIMIT} no longer accepts negative arguments
(they used to be treated as very big positive numbers before).
@item
The @code{DATABASE()} function now returns @code{NULL} rather than the empty
string if there is no database selected.
@item
Added @code{--sql-mode=NO_AUTO_VALUE_ON_ZERO} option to suppress the usual
behavior of generating the next sequence number when zero is stored in
an @code{AUTO_INCREMENT} column. With this mode enabled, zero is stored as
zero; only storing @code{NULL} generates a sequence number.
@item
@strong{Warning: Incompatible change!}
Client authentication now is based on 41-byte passwords in the
@code{user} table, not 45-byte passwords as in 4.1.0.
Any 45-byte passwords created for 4.1.0 must be reset after running the
@code{mysql_fix_privilege_tables} script.
@item
Added MySQL Server option and global variable 'secure-auth' that disallows 
authentication for accounts that have old (pre-4.1.1) passwords.
@item
Added MySQL command line client option 'secure-auth'. If this option is set,
client will refuse to send password in old (pre-4.1.1) format.
@item
@strong{Warning: Incompatible change!}
Renamed the C API @code{mysql_prepare_result()} function to
@code{mysql_get_metadata()} as the old name was confusing.
@item
Added @code{DROP USER 'username'@@'hostname'} statement to drop an account
that has no privileges.
@item
The interface to aggregated UDF functions has changed a bit. You must now
declare a @code{xxx_clear()} function for each aggregate function @code{XXX()}.
@item
Added new @code{ADDTIME()}, @code{DATE()}, @code{DATEDIFF()}, @code{LAST_DAY()},
@code{MAKEDATE()}, @code{MAKETIME()}, @code{MICROSECOND()}, @code{SUBTIME()},
@code{TIME()}, @code{TIMEDIFF()}, @code{TIMESTAMP()}, @code{UTC_DATE()},
@code{UTC_TIME()}, @code{UTC_TIMESTAMP()}, and @code{WEEKOFYEAR()}
functions.
@item
Added new syntax for @code{ADDDATE()} and @code{SUBDATE()}.
The second argument now may be a number representing the number of days to
be added to or subtracted from the first date argument.
@item
Added new @code{type} values @code{DAY_MICROSECOND},
@code{HOUR_MICROSECOND}, @code{MINUTE_MICROSECOND},
@code{SECOND_MICROSECOND}, and @code{MICROSECOND}
for @code{DATE_ADD()}, @code{DATE_SUB()}, and @code{EXTRACT()}.
@item
Added new @code{%f} microseconds format specifier for @code{DATE_FORMAT()} and
@code{TIME_FORMAT()}.
@item
All queries in which at least one @code{SELECT} does not use indexes properly
now are written to the slow query log when long log format is used.  
@item
It is now possible to create a @code{MERGE} table from @code{MyISAM} tables in
different databases. Formerly, all the @code{MyISAM} tables had to be in the
same database, and the @code{MERGE} table had to be created in that database
as well.
@item
Added new @code{COMPRESS()}, @code{UNCOMPRESS()}, and
@code{UNCOMPRESSED_LENGTH()} functions.
@item
When doing @code{SET sql_mode='mode'} for a complex mode (like @code{ANSI}), we
now update the @code{sql_mode} variable to include all the individual options
implied by the complex mode.
@item
Added the OLAP (On-Line Analytical Processing) function @code{ROLLUP}, which
provides summary rows for each @code{GROUP BY} level.
@item
Added @code{SQLSTATE} codes for all server errors.
@item
Added @code{mysql_sqlstate()} and @code{mysql_stmt_sqlstate()} C API client
functions that return the @code{SQLSTATE} error code for the last error.
@item
@code{TIME} columns with hour values greater than 24 were returned incorrectly
to the client.
@item
@code{ANALYZE}, @code{OPTIMIZE}, @code{REPAIR}, and @code{FLUSH} statements
are now stored in the binary log and thus replicated to slaves.
This logging does not occur if the optional @code{NO_WRITE_TO_BINLOG} keyword 
(or its alias @code{LOCAL}) is given.  Exceptions are that
@code{FLUSH LOGS}, @code{FLUSH MASTER}, @code{FLUSH SLAVE}, and
@code{FLUSH TABLES WITH READ LOCK} are not logged in any case.
For a syntax example, see @ref{FLUSH, , @code{FLUSH}}.
@item
New global variable @code{RELAY_LOG_PURGE} to enable or disable automatic
relay log purging.
@item
@code{LOAD DATA} now produces warnings that can be fetched with
@code{SHOW WARNINGS}.
@item
Added support for syntax @code{CREATE TABLE table2 (LIKE table1)}
that creates an empty table @code{table2} with a definition that is
exactly the same as @code{table1}, including any indexes.
@item
@code{CREATE TABLE table_name (...) TYPE=storage_engine} now generates a
warning if the named storage engine is not available. The table is still
created as a @code{MyISAM} table, as before.
@item
Most subqueries are now much faster than before.
@item
Added @code{PURGE BINARY LOGS} as an alias for @code{PURGE MASTER LOGS}.
@item
Disabled the @code{PURGE LOGS} statement that was added in in version 4.1.0.
The statement now should be issued as @code{PURGE MASTER LOGS} or
@code{PURGE BINARY LOGS}.
@item
Added @code{SHOW BDB LOGS} as an alias for @code{SHOW LOGS}.
@item
Added @code{SHOW MASTER LOGS} (which had been deleted in version
4.1.0) as an alias for @code{SHOW BINARY LOGS}.
@item
Added @code{Slave_IO_State} and @code{Seconds_Behind_Master} columns
to the output of @code{SHOW SLAVE STATUS}.
@code{Slave_IO_State} indicates the state of the slave I/O thread, and
@code{Seconds_Behind_Master} indicates the number of seconds by
which the slave is late compared to the master.
@item
@code{--lower-case-table-names=1} now also makes aliases case
insensitive. (Bug #534)
@end itemize

Bugs fixed:
@itemize @bullet
@item
Fixed @code{mysql} parser not to erroneously interpret @samp{;} character
within @code{/* ... */} comment as statement terminator.
@item
Fixed merging types and length of result set columns for @code{UNION}
operations. The types and lengths now are determined taking into
account values for all @code{SELECT} statements in the @code{UNION},
not just the first @code{SELECT}.
@item
Fixed a bug in privilege handling that caused connections from
certain IP addresses to be assigned incorrect database-level privileges.
A connection could be assigned the database privileges of the
previous successful authentication from one of those IP addresses,
even if the IP address username and database name were different. (Bug #1636)
@item
Error-handling functions were not called properly when an error resulted
from @code{[CREATE | REPLACE| INSERT] ... SELECT} statements.
@item
@code{HASH}, @code{BTREE}, @code{RTREE}, @code{ERRORS}, and
@code{WARNINGS} no longer are reserved words. (Bug #724)
@item
Fix for bug in @code{ROLLUP} when all tables were @code{const} tables.
(Bug #714)
@item
Fixed a bug in @code{UNION} that prohibited @code{NULL} values from being
inserted into result set columns where the first @code{SELECT} of the
@code{UNION} retrieved @code{NOT NULL} columns. The type and max_length
of the result column is now defined based on all @code{UNION} parts.
@item
Fixed name resolution of columns of reduced subqueries in unions. (Bug #745)
@item
Fixed memory overrun in subqueries in select list with @code{WHERE} clause
bigger than outer query @code{WHERE} clause. (Bug #726)
@item
Fixed a bug that caused @code{MyISAM} tables with @code{FULLTEXT} indexes
created in 4.0.x to be unreadable in 4.1.x.
@item
Fixed a data loss bug in @code{REPAIR TABLE ... USE_FRM} when used
with tables
that contained @code{TIMESTAMP} columns and were created in 4.0.x.
@item
Fixed reduced subquery processing in @code{ORDER BY}/@code{GROUP BY}
clauses. (Bug #442)
@item
Fixed name resolution of outer columns of subquery in
@code{INSERT}/@code{REPLACE} statements. (Bug #446)
@item
Fixed bug in marking columns of reduced subqueries. (Bug #679)
@item
Fixed a bug that made @code{CREATE FULLTEXT INDEX} syntax illegal.
@item
Fixed a crash when a @code{SELECT} that required a temporary table
(marked by @code{Using temporary} in @code{EXPLAIN} output)
was used as a derived table in @code{EXPLAIN} command. (Bug #251)
@item
Fixed a rare table corruption bug in @code{DELETE}
from a big table with
a @strong{new} (created by MySQL-4.1) full-text index.
@item
@code{LAST_INSERT_ID()} now returns 0 if the last @code{INSERT} statement
didn't insert any rows.
@item
Fixed missing last character in function output. (Bug #447)
@item
Fixed a rare replication bug when a transaction spanned two or more
relay logs, and the slave was stopped while executing the part
of the transaction that was in the second or later relay log. Then
replication would resume at the beginning of the second or later
relay log, which was incorrect. (It should resume at @code{BEGIN}, in the
first relay log.) (Bug #53)
@item
@code{CONNECTION_ID()} now is properly replicated. (Bug #177)
@item
The new @code{PASSWORD()} function in 4.1 is now properly replicated.
(Bug #344)
@item
Fixed a bug with double freed memory.
@item
Fixed a crashing bug in @code{UNION} operations that involved temporary tables.
@item
Fixed a crashing bug in @code{DERIVED TABLES} when @code{EXPLAIN} is
used on a @code{DERIVED TABLES} with a join.
@item
Fixed a crashing bug in @code{DELETE} with @code{ORDER BY} and
@code{LIMIT} caused by an uninitialized array of reference pointers.
@item
Fixed a bug in the @code{USER()} function caused by an error in the size of
the allocated string.
@item
Fixed a crashing bug when attempting to create a table containing a spatial
(GIS) column with a storage engine that does not support spatial types. 
@item
Fixed a crashing bug in @code{UNION} caused by the empty select list and
a non-existent column being used in some of the individual @code{SELECT}
statements.
@item
Fixed a replication bug with a 3.23 master and a 4.0 slave: The
slave lost the replicated temporary tables if @code{FLUSH LOGS} was
issued on the master. (Bug #254)
@item
Fixed a security bug: A server compiled without SSL support still allowed
connections by users that had the @code{REQUIRE SSL} option specified for
their accounts.
@item
When an undefined user variable was used in a updating query on the
master (such as @code{INSERT INTO t VALUES(@@a)}, where @code{@@a} had never
been set by this connection before), the slave could replicate the
query incorrectly if a previous transaction on the master used a user
variable of the same name. (Bug #1331)
@item
Fixed bug with prepared statements: Using the @code{?} prepared statement
parameter as the argument to certain functions or statement clauses caused
a server crash when @code{mysql_prepare()} was invoked. (Bug #1500)
@item
Fixed bug with prepared statements: after call to mysql_stmt_prepare
placeholders became allowed in all consequent statements, even if they are 
not prepared (Bug #1946)
@item
@code{SLAVE START} (which is a deprecated syntax, @code{START SLAVE} should be
used instead) could crash the slave. (Bug #2516)
@item
Fixed bug in @code{ALTER TABLE RENAME}, when rename to the table with
the same name in another database silently dropped destination table if
it existed. (Bug #2628)
@end itemize

@node News-4.1.0,  , News-4.1.1, News-4.1.x
@appendixsubsec Changes in release 4.1.0 (03 Apr 2003: Alpha)

Functionality added or changed:
@itemize @bullet
@item
New @code{CHARSET()} and @code{COLLATION()} functions to return the character
set and collation of a string.
@item
Allow index type to be specified explicitly for some storage engines via
@code{USING type_name} syntax in index definition.
@item
New function @code{IS_USED_LOCK()} for determining the connection identifier
of the client that holds a given advisory lock.
@item
New more secure client authentication based on 45-byte passwords in the
@code{user} table.
@item
New @code{CRC32()} function to compute cyclic redundancy check value.
@item
On Windows, we are now using shared memory to communicate between server
and client when they are running on the same machine and you are
connecting to @code{localhost}.
@item
@code{REPAIR} of @code{MyISAM} tables now uses less temporary disk space when
sorting char columns.
@item
@code{DATE}/@code{DATETIME} checking is now a bit stricter to support the 
ability to automatically distinguish between date, datetime, and time
with microseconds. For example, dates of type @code{YYYYMMDD HHMMDD} are no 
longer supported; you must either have separators between each
@code{DATE}/@code{TIME} part or not at all.
@item
Server side help for all MySQL functions. One can now type @code{help
week} in the @code{mysql} client and get help for the @code{week()}
function.
@item
Added new @code{mysql_get_server_version()} C API client function.
@item
Fixed bug in @code{libmysqlclient} that fetched column defaults.
@item
Fixed bug in @file{mysql.cc} client when skipping comments
@item
Added @code{record_in_range()} method to @code{MERGE} tables to be
able to choose the right index when there are many to choose from.
@item
Replication now works with @code{RAND()} and user variables @code{@@var}.
@item
Allow one to change mode for @code{ANSI_QUOTES} on the fly.
@item
@code{EXPLAIN SELECT} now can be killed. @xref{KILL,  , @code{KILL}}.
@item
@code{REPAIR TABLE} now can be killed. @xref{KILL,  , @code{KILL}}.
@item
Allow empty index lists to be specified for @code{USE INDEX},
@code{IGNORE INDEX}, and @code{FORCE INDEX}.
@item
@code{DROP TEMPORARY TABLE} now drops only temporary tables and doesn't
end transactions.
@item
Added support for @code{UNION} in derived tables.
@item
@strong{Warning: Incompatible change!}
@code{TIMESTAMP} is now returned as a string of type
@code{'YYYY-MM-DD HH:MM:SS'} and different timestamp lengths are not supported.

This change was necessary for SQL standards compliance. In a future
version, a further change will be made (backward compatible with this
change), allowing the timestamp length to indicate the desired number
of digits of fractions of a second.
@item
New faster client/server protocol that supports prepared statements,
bound parameters, and bound result columns, binary transfer of data,
warnings.
@item
Added database and real table name (in case of alias) to the
@code{MYSQL_FIELD} structure.
@item
Multi-line queries: You can now issue several queries at once and
then read the results in one go.
@item
In @code{CREATE TABLE foo (a INT not null primary key)} the
@code{PRIMARY} word is now optional.
@item
In @code{CREATE TABLE} the attribute @code{SERIAL} is now an alias for
@code{BIGINT NOT NULL AUTO_INCREMENT UNIQUE}.
@item
@c description_for_help_topic DUAL
@code{SELECT ... FROM DUAL} is an alias for @code{SELECT ...}.
(To be compatible with some other databases).
@c end_description_for_help_topic
@item
If one creates a too long @code{CHAR}/@code{VARCHAR} it's now
automatically changed to @code{TEXT} or @code{BLOB}; One will get a
warning in this case.
@item
One can specify the different @code{BLOB}/@code{TEXT} types with the
syntax @code{BLOB(length)} and @code{TEXT(length)}.  MySQL will
automatically change it to one of the internal @code{BLOB}/@code{TEXT}
types.
@item
@c description_for_help_topic CHAR BYTE  CHAR BYTE
@code{CHAR BYTE} is an alias for @code{CHAR BINARY}.
@c end_description_for_help_topic
@item
@code{VARCHARACTER} is an alias for @code{VARCHAR}.
@item
New operators @code{integer MOD integer} and @code{integer DIV integer}.
@item
@code{SERIAL DEFAULT VALUE} added as an alias for @code{AUTO_INCREMENT}.
@item
@c help_category Functions
@c description_for_help_topic TRUE FALSE  FALSE TRUE
@code{TRUE} and @code{FALSE} added as alias for 1 and 0, respectively.
@c end_description_for_help_topic
@item
Aliases are now forced in derived tables, as per SQL-99.
@item 
Fixed @code{SELECT .. LIMIT 0} to return proper row count for
@code{SQL_CALC_FOUND_ROWS}.
@item
One can specify many temporary directories to be used in a round-robin
fashion with:  @code{--tmpdir=dirname1:dirname2:dirname3}.
@item
Subqueries: @code{SELECT * from t1 where t1.a=(SELECT t2.b FROM t2)}.
@item
Derived tables:
@example
SELECT a.col1, b.col2
       FROM (SELECT MAX(col1) AS col1 FROM root_table) a,
       other_table b
       WHERE a.col1=b.col1;
@end example
@item
Character sets to be defined per column, table and database.
@item
Unicode (UTF8) support.
@item
New @code{CONVERT(... USING ...)} syntax for converting string values between
character sets.
@item
@code{BTREE} index on @code{HEAP} tables.
@item
Faster embedded server (new internal communication protocol).
@item
One can add a comment per column in @code{CREATE TABLE}.
@item
@code{SHOW FULL COLUMNS FROM table_name} shows column comments.
@item
@code{ALTER DATABASE}.
@item
Support for GIS (Geometrical data).
@xref{Spatial extensions in MySQL}.
@item
@code{SHOW [COUNT(*)] WARNINGS} shows warnings from the last command.
@item
One can specify a column type for a colum in @code{CREATE TABLE
... SELECT} by defining the column in the @code{CREATE} part.

@example
CREATE TABLE foo (a tinyint not null) SELECT b+1 AS 'a' FROM bar;
@end example
@item 
@code{expr SOUNDS LIKE expr} same as @code{SOUNDEX(expr)=SOUNDEX(expr)}.
@item
Added new @code{VARIANCE(expr)} function returns the variance of @code{expr}
@item
One can create a table from the existing table using @code{CREATE 
[TEMPORARY] TABLE [IF NOT EXISTS] table (LIKE table)}. The table can 
be either normal or temporary.
@item
New options @code{--reconnect} and @code{--disable-reconnect} for the
@code{mysql} client, to reconnect automatically or not if the
connection is lost.
@item
@code{START SLAVE} (@code{STOP SLAVE}) no longer returns an error
if the slave is already started (stopped); it returns a
warning instead.
@item
@code{SLAVE START} and @code{SLAVE STOP} are no longer accepted by the query
parser; use @code{START SLAVE} and @code{STOP SLAVE} instead.
@end itemize


@node News-4.0.x, News-3.23.x, News-4.1.x, News
@appendixsec Changes in release 4.0.x (Production)

@cindex changes, version 4.0

Version 4.0 of the MySQL server includes many enhancements and new features:

@itemize @bullet
@item
The @code{InnoDB} storage engine is now included in the standard binaries,
adding transactions, row-level locking, and foreign keys.
@xref{InnoDB,  , @code{InnoDB}}.
@item
A query cache, offering vastly increased performance for many applications.
By caching complete result sets, later identical queries can return
instantly.
@xref{Query Cache}.
@item
Improved full-text indexing with boolean mode, truncation, and phrase searching.
@xref{Fulltext Search}.
@item
Enhanced @code{MERGE} tables, now supporting @code{INSERT} statements and
@code{AUTO_INCREMENT}.
@xref{MERGE,  , @code{MERGE}}.
@item
@code{UNION} syntax in @code{SELECT}.
@xref{UNION,  , @code{UNION}}.
@item
Multiple-table @code{DELETE} statements.
@xref{DELETE,  , @code{DELETE}}.
@item
@code{libmysqld}, the embedded server library.
@xref{libmysqld,  , @code{libmysqld}}.
@item
Additional @code{GRANT} privilege options for even tighter control and
security.
@xref{GRANT,  , @code{GRANT}}.
@item
Management of user resources in the @code{GRANT} system, particularly
useful for ISPs and other hosting providers.
@xref{User resources}.
@item
Dynamic server variables, allowing configuration changes to be made
without having to stop and restart the server.
@xref{SET OPTION,  , @code{SET OPTION}}.
@item
Improved replication code and features.
@xref{Replication}.
@item
Numerous new functions and options.
@item
Changes to existing code for enhanced performance and reliability.
@end itemize

For a full list of changes, please refer to the changelog sections for
each individual 4.0.x release.


@menu
* News-4.0.19::                 Changes in release 4.0.19 (not released yet)
* News-4.0.18::                 Changes in release 4.0.18 (to be released soon)
* News-4.0.17::                 Changes in release 4.0.17 (14 Dec 2003)
* News-4.0.16::                 Changes in release 4.0.16 (17 Oct 2003)
* News-4.0.15::                 Changes in release 4.0.15 (03 Sep 2003)
* News-4.0.14::                 Changes in release 4.0.14 (18 Jul 2003)
* News-4.0.13::                 Changes in release 4.0.13 (16 May 2003)
* News-4.0.12::                 Changes in release 4.0.12 (15 Mar 2003: Production)
* News-4.0.11::                 Changes in release 4.0.11 (20 Feb 2003)
* News-4.0.10::                 Changes in release 4.0.10 (29 Jan 2003)
* News-4.0.9::                  Changes in release 4.0.9 (09 Jan 2003)
* News-4.0.8::                  Changes in release 4.0.8 (07 Jan 2003)
* News-4.0.7::                  Changes in release 4.0.7 (20 Dec 2002)
* News-4.0.6::                  Changes in release 4.0.6 (14 Dec 2002: Gamma)
* News-4.0.5::                  Changes in release 4.0.5 (13 Nov 2002)
* News-4.0.4::                  Changes in release 4.0.4 (29 Sep 2002)
* News-4.0.3::                  Changes in release 4.0.3 (26 Aug 2002: Beta)
* News-4.0.2::                  Changes in release 4.0.2 (01 Jul 2002)
* News-4.0.1::                  Changes in release 4.0.1 (23 Dec 2001)
* News-4.0.0::                  Changes in release 4.0.0 (Oct 2001: Alpha)
@end menu

@node News-4.0.19, News-4.0.18, News-4.0.x, News-4.0.x
@appendixsubsec Changes in release 4.0.19 (not released yet)

@c NOTE: References to bug numbers should be written after the sentence
@c NOTE: describing the bugfix, like this:
@c NOTE: This sentence describes the fix. (Bug #nnnn)

Functionality added or changed:
@itemize @bullet
@end itemize

Bugs fixed:
@itemize @bullet
@end itemize

@node News-4.0.18, News-4.0.17, News-4.0.19, News-4.0.x
@appendixsubsec Changes in release 4.0.18 (to be released soon)

Functionality added or changed:
@itemize @bullet
@item
Fixed processing of @code{LOAD DATA} by @code{mysqlbinlog} in remote mode.
(Bug #1378)
@item
New utility program @file{myisam_ftdump} was added to binary
distributions.
@item
@code{mysqlhotcopy} now works on NetWare.
@item
@code{ENGINE} is now a synonym for the @code{TYPE} option for
@code{CREATE TABLE} and @code{ALTER TABLE}.
@item
@code{lower_case_table_names} system variable now can take a value of
@code{2}, to store table names in mixed case on case-insensitive filesystems.
@item
For replication of @code{HEAP} tables:
Made the master automatically write a @code{DELETE FROM} statement
to its binary log when a @code{HEAP} table is opened for the first time since
master's startup. This is for the case where the slave has replicated a
non-empty @code{HEAP} table, then the master is shut down and restarted: the
table is now empty on master; the @code{DELETE FROM} empties it on slave
too. Note that even with this fix, between the master's restart and the first
use of the table on master, the slave still has out-of-date data in the
table. But if you use the @code{init-file} option to populate the @code{HEAP}
table on the master at startup, it ensures that the failing time interval is
zero. (Bug #2477)
@item
Optimizer is now better tuned for the case where the first used key part
(of many) is a constant.  (Bug #1679)
@item
Removed old non-working @code{--old-rpl-compat} server option, which was a
holdover from the very first 4.0.x versions. (Bug #2428)
@end itemize

Bugs fixed:
@itemize @bullet
@item
Fixed bug when --init-file crashes MySQL if contains large select (Bug #2526)
@item
@code{SHOW KEYS} now shows @code{NULL} in @code{Sub_part} column for
@code{FULLTEXT} indexes.
@item
A size of the signal thread's stack is increased to let @file{mysqld}
to run on Debian/ia64 with with TLS-enabled glibc.
(Bug #2599)
@item
Now one need only @code{SELECT} privilege for tables that are only read in
@code{UPDATE} statements with many tables. (Bug #2377).
@item
Give proper error message if one uses @code{LOCK TABLES ... ; INSERT
... SELECT} and one used the same table in the @code{INSERT} and @code{SELECT}
part. (Bug #2296)
@item
@code{SELECT INTO ... DUMPFILE} now deletes the generated file on error.
@item
Fixed foreign key reference handling to allow references to column names that
contain spaces. (Bug #1725)
@item
Fixed problem with index reads on character fields with @code{BDB} tables. The
symptom was that data could be returned in wrong lettercase. (Bug #2509)
@item
Fixed a spurious table corruption problem that could sometimes appear on
tables with indexed @code{TEXT} columns if these columns happened to contain
values having trailing spaces.  This bug was introduced in 4.0.17.
@item
Fixed a problem where some queries could hang if a condition like
@code{indexed_TEXT_column = expr}
was present and the column contained values having trailing spaces.
This bug was introduced in 4.0.17.
@item
Fixed a bug that could cause incorrect results from a query
that involved range conditions on indexed @code{TEXT} columns
that happened to contain values having trailing spaces. This bug was
introduced in 4.0.17. (Bug #2295)
@item
Fixed incorrect path names in some of the manual pages.
(Bug #2270)
@item
Fixed spurious ``table corrupted'' errors in parallel repair operations.
@xref{SHOW VARIABLES, , @code{myisam_repair_threads}}.
@item
Fixed a crashing bug in parallel repair operations.
@xref{SHOW VARIABLES, , @code{myisam_repair_threads}}.
@item
Fixed bug in updating @code{MyISAM} tables for @code{BLOB} values longer
than 16M. (Bug #2159)
@item
Fixed bug in @file{mysqld_safe} when running multiple instances of
MySQL. (Bug #2114)
@item
Fixed a bug in using @code{HANDLER} statement with tables not
from a current database. (Bug #2304)
@item
Fix for a crashing bug that occurred due to the fact that multiple-table
@code{UPDATE} statements did not check that there was only one table
to be updated. (Bug #2103)
@item
Fix for a crashing bug that occurred due to @code{BLOB} column
type index size being calculated incorrectly in @code{MIN()} and @code{MAX()}
optimizations.
(Bug #2189)
@item
Fix for a bug with incorrect syntax for @code{LOCK TABLES} in
@code{mysqldump}. (Bug #2242)
@item
Fixed a bug in @file{mysqld_safe} that caused @file{mysqld} to generate a
warning about duplicate @code{user=xxx} options if this option was specified in
the @code{[mysqld]} or @code{[server]} sections of @file{my.cnf}.
(Bug #2163)
@item
@code{INSERT DELAYED ... SELECT ...} could cause table corruption because
tables were not locked properly.  This is now fixed by ignoring @code{DELAYED}
in this context. (Bug #1983)
@item
Replication: Sometimes the master gets a non-fatal error during the
execution of a statement that does not immediately succeed.  (For example,
a write to a @code{MyISAM} table may first receive ``no space left
on device,'' but later complete when disk space becomes available.
@xref{Full disk}.)  The bug was that the master forgot to reset the error
code to 0 after success, so the error code got into its binary log, thus
causing the slave to issue false alarms such as ``did not get the same
error as on master.'' (Bug #2083)
@item
Removed a misleading ``check permissions on master.info'' from a replication
error message, because the cause of the problem could be something other than
permissions. (Bug #2121)
@item
Fixed a crash when the replication slave was unable to create the first relay
log. (Bug #2145)
@item
Replication of @code{LOAD DATA INFILE} for an empty file from a 3.23 master to a
4.0 slave caused the slave to print an error. (Bug #2452)
@item
When automatically forcing @code{lower_case_table_names} to 1 if the file
system was case insensitive, @code{mysqld} could crash. This bug existed only
in MySQL 4.0.17. (Bug #2481)
@item
Restored ability to specify default values for @code{TIMESTAMP} columns
that was erroneously disabled in previous release. (Bug #2539) Fixed
@code{SHOW CREATE TABLE} to reflect these values. (Bug #1885) Note
that because of the auto-update feature for the first @code{TIMESTAMP}
column in a table, it makes no sense to specify a default value for
the column. Any such default will be silently ignored (unless another
@code{TIMESTAMP} column is added before this one).  Also fixed the meaning
of the @code{DEFAULT} keyword when it is used to specify the value to be
inserted into a @code{TIMESTAMP} column other than the first. (Bug #2464)
@item
Fixed bug for out-of-range arguments on QNX platform that caused
@code{UNIX_TIMESTAMP()} to produce incorrect results or that caused
non-zero values to be inserted into @code{TIMESTAMP} columns.  (Bug #2523)
Also, current time zone now is taken into account when checking if datetime
values satisfy both range boundaries for @code{TIMESTAMP} columns. The
range allowed for a @code{TIMESTAMP} column is time zone-dependant and
equivalent to a range of @code{1970-01-01 00:00:01} UTC to @code{2037-12-31
23:59:59} UTC.
@item
Multi-table @code{DELETE} statements were never replicated by the slave if
there were any @code{replicate-*-table} options. (Bug #2527)
@item
Changes to session counterparts of variables query_prealloc_size,
query_alloc_block_size, trans_prealloc_size, trans_alloc_block_size now 
have effect (Bug #1948)
@item
Fixed bug in @code{ALTER TABLE RENAME}, when rename to the table with
the same name in another database silently dropped destination table if
it existed. (Bug #2628)
@end itemize

@node News-4.0.17, News-4.0.16, News-4.0.18, News-4.0.x
@appendixsubsec Changes in release 4.0.17 (14 Dec 2003)

Functionality added or changed:
@itemize @bullet
@item
@code{mysqldump} no longer dumps data for @code{MERGE} tables. (Bug #1846)
@item
@code{lower_case_table_names} is now forced to 1 if the database directory
is located on a case-insensitive file system. (Bug #1812)
@item
Symlink creation is now disabled on systems where @code{realpath()} doesn't
work. (Before one could use @code{CREATE TABLE .. DATA DIRECTORY=..} even if
@code{HAVE_BROKEN_REALPATH} was defined. This is now disabled to avoid
problems when running @code{ALTER TABLE}).
@item
Inserting a negative @code{AUTO_INCREMENT} value in a @code{MyISAM} table 
no longer updates the @code{AUTO_INCREMENT} counter to a big unsigned value.
(Bug #1366)
@item
Added four new modes to @code{WEEK(..., mode)} function.
@xref{Date and time functions, , @code{WEEK(date,mode)}}.
(Bug #1178)
@item
Allow @code{UNION DISTINCT} syntax.
@item
@code{mysql_server_init()} now returns 1 if it can't initialize the
environment. (Previously @code{mysql_server_init()} called @code{exit(1)}
if it could not create a key with @code{pthread_key_create()}. (Bug #2062)
@item
Allow spaces in Windows service names.
@item
Changed the default Windows service name for @code{mysqld} from @code{MySql}
to @code{MySQL}.
This should not affect usage, because service names are not case sensitive.
@item
When you install @code{mysqld} as a service on Windows systems, @code{mysqld}
will read startup options in option files from the option group with the same
name as the service name.
(Except when the service name is @code{MySQL}).
@end itemize

Bugs fixed:
@itemize @bullet
@item
Sending @code{SIGHUP} to mysqld crashed server if it was running with
@code{--log-bin}. (Bug #2045)
@item
One can now configure MySQL as a Windows service as a normal
user. (Bug #1802). Thanks to Richard Hansen for fixing this.
@item
Database names are now compared in lowercase in @code{ON} clauses
when @code{lower_case_table_names} is set. (Bug #1736)
@item
@code{IGNORE ... LINES} option to @code{LOAD DATA INFILE} didn't work
when used with fixed length rows. (Bug #1704)
@item
Fixed problem with @code{UNIX_TIMESTAMP()} for timestamps close to 0.
(Bug #1998)
@item
Fixed problem with character values greater than 128 in the @code{QUOTE()}
function. (Bug #1868)
@item
Fixed searching of @code{TEXT} with end space. (Bug #1651)
@item
Fixed caching bug in multiple-table updates where same table was used twice.
(Bug #1711)
@item
Fixed directory permissions for the MySQL-server RPM documentation directory.
(Bug #1672)
@item
Fixed server crash when updating an @code{ENUM} column that is set to the
empty string (for example, with @code{REPLACE()}).  (Bug #2023)
@item
@code{mysql} client program now correctly prints connection identifier
returned by @code{mysql_thread_id()} as unsigned integer rather than as signed
integer.  (Bug #1951)
@item
@code{FOUND_ROWS()} could return incorrect number of rows after a query
with an impossible @code{WHERE} condition. (Bug #1468)
@item
@code{SHOW DATABASES} no longer shows @code{.sym} files (on Windows) that
do not point to a valid directory. (Bug #1385)
@item
Fixed a possible memory leak on Mac OS X when using the shared
@code{libmysql.so} library. (from @code{pthread_key_create()}). (Bug #2061)
@item
Fixed bug in @code{UNION} statement with alias @code{*}. (Bug #1249)
@item
Fixed a bug in @code{DELETE ... ORDER BY ... LIMIT} where the rows where not
deleted in the proper order. (Bug #1024, Bug #1697).
@item
Fixed serious problem with multi-threaded programs on Windows that used the
embedded MySQL libraries. (Locks of tables were not handled correctly between
different threads).
@item
Code cleanup: Fixed a few code defects (potential memory leaks, null pointer
dereferences, uninitialized variables). Thanks to Reasoning Inc. for
informing us about these findings.
@item
Fixed a buffer overflow error that occurred with prepended @samp{0} characters
in some columns of type @code{DECIMAL}. (Bug #2128)
@item
Filesort was never shown in @code{EXPLAIN} if query contained an
@code{ORDER BY NULL} clause. (Bug #1335)
@item
Fixed invalidation of whole query cache on @code{DROP DATABASE}. (Bug #1898)
@item
Fixed bug in range optimizer that caused wrong results for some unlikely
@code{AND}/@code{OR} queries. (Bug #1828)
@item
Fixed a crash in @code{ORDER BY} when ordering by expression and identifier.
(Bug #1945)
@item
Fixed a crash in an open @code{HANDLER} when an @code{ALTER TABLE} was
executed in a different connection. (Bug #1826)
@item
Fixed a bug in @code{trunc*} operator of full-text search which
sometimes caused MySQL not to find all matched rows.
@item
Fixed bug in prepending @samp{0} characters to @code{DECIMAL} column values.
@item
Fixed optimizer bug, introduced in 4.0.16, when @code{REF} access plan was
preferred to more efficient @code{RANGE} on another column.
@item
Fixed problem when installing a MySQL server as a Windows service using a
command of the form @code{mysqld --install mysql --defaults-file=path-to-file}.
(Bug #1643)
@item
Fixed an incorrect result from a query that uses only @code{const} tables
(such as one-row tables) and non-constant expression
(such as @code{RAND()}). (Bug #1271)
@item
Fixed bug when the optimizer did not take @code{SQL_CALC_FOUND_ROWS} into
account if @code{LIMIT} clause was present. (Bug #1274)
@item
@code{mysqlbinlog} now asks for a password at the console when the @code{-p}
or @code{--password} option is used with no argument. This is consistent with
the way that other clients such @code{mysqladmin} and @code{mysqldump}
already behave. @strong{Note:} A consequence of this change is that it is no
longer possible to invoke @code{mysqlbinlog} as @code{mysqlbinlog -p
pass_val} (with a space between the @code{-p} option and the following
password value).
(Bug #1595)
@item
Fixed bug accidentally introduced in 4.0.16 where the slave SQL thread
deleted its replicated temporary tables when @code{STOP SLAVE} was
issued.
@item
In a ``chain'' replication setup @code{A->B->C}, if 2 sessions on A
updated temporary tables of the same name at the same time, the binary log
of @code{B} became incorrect, resulting in @code{C} becoming confused.
(Bug #1686)
@item
In a ``chain'' replication setup @code{A->B->C}, if @code{STOP SLAVE}
was issued on @code{B} while it was replicating a temporary table from
@code{A}, then when @code{START SLAVE} was issued on @code{B}, the binary log
of @code{B} became incorrect, resulting in @code{C} becoming confused.
(Bug #1240)
@item
When @code{MASTER_LOG_FILE} and @code{MASTER_LOG_POS} were not
specified, @code{CHANGE MASTER} used the coordinates of the slave I/O
thread to set up replication, which broke replication if the slave SQL
thread lagged behind the slave I/O thread. This caused the slave
SQL thread to lose some events. The new behavior is to use the
coordinates of the slave SQL thread instead.
@xref{CHANGE MASTER TO,  , @code{CHANGE MASTER TO}}.
(Bug #1870)
@item
Now if integer is stored or converted to @code{TIMESTAMP} or
@code{DATETIME} value checks of year, month, day, hour, minute
and second ranges are performed and numbers representing illegal
timestamps are converted to 0 value. This behavior is consistent 
with manual and with behavior of string to 
@code{TIMESTAMP}/@code{DATETIME} conversion. (Bug #1448)
@item
Fixed bug when @code{BIT_AND()} and @code{BIT_OR()} group functions 
returned incorrect value if @code{SELECT} used a temporary table and
no rows were found. (Bug #1790).
@item
@code{BIT_AND()} is now unsigned in all contexts. This means that it will
now return 18446744073709551615 (= 0xffffffffffffffff) instead of -1 if
there were no rows in the result.
@item
Fixed bug with @code{BIT_AND()} still returning signed value for an
empty set in some cases. (Bug #1972)
@item
Fixed bug with @code{^} (XOR) and @code{>>} (bit shift) still returning
signed value in some cases. (Bug #1993)
@item
Replication:
a rare race condition in the slave SQL thread, which could lead to a
wrong complain that the relay log is corrupted. (Bug #2011)
@item
Replication:
if an administrative command on a table (@code{OPTIMIZE TABLE}, @code{REPAIR
TABLE} etc) was run on the slave, this could sometimes stop the slave
SQL thread (this did not led to any corruption; one just had to type
@code{START SLAVE} to get replication going again). (Bug #1858)
@item
Replication:
in the slave SQL thread, a multi-table @code{UPDATE} could produce a
wrong complain that some record was not found in one table, if the
@code{UPDATE} was preceded by a @code{INSERT ... SELECT}. (Bug #1701)
@item
Fixed deficiency in MySQL code which is responsible for scanning 
directories. This deficiency caused @code{SHOW TABLE STATUS} to be 
very slow when a database contained a large number of tables, even if a single 
particular table were specified. (Bug #1952)
@end itemize

@node News-4.0.16, News-4.0.15, News-4.0.17, News-4.0.x
@appendixsubsec Changes in release 4.0.16 (17 Oct 2003)

Functionality added or changed:
@itemize @bullet
@item
Option values in option files now may be quoted. This is useful for values that
contain whitespace or comment characters.
@item
Write memory allocation information to error log when doing
@code{mysqladmin debug}.  This works only on systems that support the
@code{mallinfo()} call (like newer Linux systems).
@item
Added the following new server variables to allow more precise memory
allocation: @code{range_alloc_block_size}, @code{query_alloc_block_size},
@code{query_prealloc_size}, @code{transaction_alloc_block_size}, and
@code{transaction_prealloc_size}.
@item
@code{mysqlbinlog} now reads option files. To make this work one must now
specify @code{--read-from-remote-server} when reading binary logs from
a MySQL server. (Note that using a remote server is deprecated and may
disappear in future @code{mysqlbinlog} versions).
@item
Block @code{SIGPIPE} signals also for non-threaded programs. The blocking is moved
from @code{mysql_init()} to @code{mysql_server_init()}, which is
automatically called on the first call to @code{mysql_init()}.
@item
Added @code{--libs_r} and @code{--include} options to @code{mysql_config}.
@item
New @code{`>} prompt for @code{mysql}. This prompt is similar to the
@code{'>} and @code{">} prompts, but indicates that an identifier
quoted with backticks was begun on an earlier line and the closing backtick
has not yet been seen.
@item
Updated @code{mysql_install_db} to be able to use the local machine's IP
address instead of the hostname when building the initial grant tables if
@code{skip-name-resolve} has been specified. This
option can be helpful on FreeBSD to avoid thread-safety problems with the
FreeBSD resolver libraries. (Thanks to Jeremy Zawodny for the patch.)
@item
A documentation change: Added a note that when backing up a slave, it is
necessary also to back up the @file{master.info} and @file{relay-log.info}
files, as well as any @file{SQL_LOAD-*} files located in the directory
specified by the @code{--slave-load-tmpdir} option.  All these files are
needed when the slave resumes replication after you restore the slave's data.
@end itemize

Bugs fixed:
@itemize @bullet
@item
Fixed a spurious error @code{ERROR 14: Can't change size of file (Errcode: 2)}
on Windows in @code{DELETE FROM table_name} without a @code{WHERE} clause or
@code{TRUNCATE TABLE table_name}, when @code{table_name} is a @code{MyISAM}
table. (Bug #1397)
@item
Fixed a bug that resulted in @code{thr_alarm queue is full} warnings after
increasing the @code{max_connections} variable with @code{SET GLOBAL}.
(Bug #1435)
@item
Made @code{LOCK TABLES} to work when @code{Lock_tables_priv} is granted on the
database level and @code{Select_priv} is granted on the table level.
@item
Fixed crash of @code{FLUSH QUERY CACHE} on queries that use same table
several times (Bug #988).
@item
Fixed core dump bug when setting an enum system variable (such as
@code{SQL_WARNINGS}) to @code{NULL}.
@item
Extended the default timeout value for Windows clients from 30 seconds
to 1 year.  (The timeout that was added in MySQL 4.0.15 was way too
short).  This fixes a bug that caused @code{ERROR 2013: Lost connection
to MySQL server during query} for queries that lasted longer than 30 seconds,
if the client didn't specify a limit with @code{mysql_options()}. Users of
4.0.15 on Windows should upgrade to avoid this problem.
@item
More ``out of memory'' checking in range optimizer.
@item
Fixed and documented a problem when setting and using a user variable within the
same @code{SELECT} statement. (Bug #1194).
@item
Fixed bug in overrun check for @code{BLOB} values with compressed tables.
This was a bug introduced in 4.0.14.  It caused MySQL to regard some
correct tables containing @code{BLOB} values as corrupted.
(Bug #770, Bug #1304, and maybe Bug #1295)
@item
@code{SHOW GRANTS} showed @code{USAGE} instead of the real column-level
privileges when no table-level privileges were given.
@item
When copying a database from the master, @code{LOAD DATA FROM
MASTER} dropped the corresponding database on the slave, thus erroneously
dropping tables that had no counterpart on the master and tables that
may have been excluded from replication using @code{replicate-*-table}
rules. Now @code{LOAD DATA FROM MASTER} no longer drops the database.
Instead, it drops only the tables that have a counterpart on the master
and that match the @code{replicate-*-table}
rules. @code{replicate-*-db} rules can still be used to include or exclude a
database as a whole from @code{LOAD DATA FROM MASTER}. A database will
also be included or excluded as a whole if there are some rules like
@code{replicate-wild-do-table=db1.%} or
@code{replicate-wild-ignore-table=db1.%}, as is already the case for
@code{CREATE DATABASE} and @code{DROP DATABASE} in replication. (Bug
#1248)
@item
Fixed a bug where
@code{mysqlbinlog} crashed with a segmentation fault when used with the
@code{-h} or @code{--host} option. (Bug #1258)
@item
Fixed a bug where @code{mysqlbinlog} crashed with a segmentation fault
when used on a binary log containing only final events for @code{LOAD
DATA}. (Bug #1340)
@item
@code{mysqlbinlog} will not reuse temporary file names from previous runs.
Previously @code{mysqlbinlog} failed if was used several times on the same
binary log file that contained a @code{LOAD DATA} command.
@item
Fixed compilation problem when compiling with OpenSSL 0.9.7 with
disabled old DES support (If @code{OPENSSL_DISABLE_OLD_DES_SUPPORT} 
option was enabled).
@item
Fixed a bug when two (or more) MySQL servers were running on the same machine,
and they were both slaves, and at least one of them was replicating some
@code{LOAD DATA INFILE} command from its master.
The bug was that one slave MySQL server sometimes
deleted the @file{SQL_LOAD-*} files (used for replication of
@code{LOAD DATA INFILE} and located in the @code{slave-load-tmpdir} directory,
which defaults to @code{tmpdir}) belonging to the other slave MySQL server of
this machine, if these slaves had the same @code{slave-load-tmpdir} directory.
When that happened, the other slave could not replicate
@code{LOAD DATA INFILE} and complained about not being able to open some
@code{SQL_LOAD-*} file. (Bug #1357)
@item
If @code{LOAD DATA INFILE} failed for a small file, the master forgot to
write a marker (a @code{Delete_file} event) in its binary log, so the slave
could not delete 2 files (@file{SQL_LOAD-*.info} and
@file{SQL_LOAD-*.data} from its @code{tmpdir}. (Bug #1391)
@item
On Windows, the slave forgot to delete a @code{SQL_LOAD-*.info}
file from @code{tmpdir} after successfully replicating a @code{LOAD DATA
INFILE} command. (Bug #1392)
@item
When a connection terminates, MySQL writes @code{DROP TEMPORARY TABLE}
statements to the binary log for all temporary tables which the
connection had not explicitly dropped. MySQL forgot to backquote the
database and table names in the statement. (Bug #1345)
@item
On some 64-bit machines (some HP-UX and Solaris machines), a slave
installed with the 64-bit MySQL binary could not connect to its master
(it connected to itself instead). (Bug #1256, Bug #1381)
@item
Code was introduced in MySQL 4.0.15 for the slave to detect that the master
had died while writing a transaction to its binary log. This code reported an
error in a legal situation: When the slave I/O thread was stopped while
copying a transaction to the relay log, the slave SQL thread would later
pretend that it found an unfinished transaction. (Bug #1475)
@end itemize

@node News-4.0.15, News-4.0.14, News-4.0.16, News-4.0.x
@appendixsubsec Changes in release 4.0.15 (03 Sep 2003)

@strong{IMPORTANT}:

If you are using this release on Windows, you should upgrade at least your
clients (any program that uses @code{libmysql.lib}) to 4.0.16 or above.  This
is because the 4.0.15 release had a bug in the Windows client library that
causes Windows clients using the library to die with a @code{Lost connection
to MySQL server during query} error for queries that take more than 30
seconds.  This problem is specific to Windows; clients on other platforms are
unaffected.

Functionality added or changed:
@itemize @bullet
@item
@code{mysqldump} now correctly quotes all identifiers when communicating
with the server. This assures that during the dump process, @code{mysqldump}
will never send queries to the server that result in a syntax error.
This problem is @strong{not} related to the
@code{mysqldump} program's output, which was not changed. (Bug #1148)
@item
Change result set metadata information so that @code{MIN()} and @code{MAX()}
report that they can return @code{NULL} (this is true because an
empty set will return @code{NULL}). (Bug #324)
@item
Produce an error message on Windows if a second @code{mysqld} server is
started on the same TCP/IP port as an already running @code{mysqld} server.
@item
The @code{mysqld} server variables @code{wait_timeout},
@code{net_read_timeout}, and @code{net_write_timeout} now work on Windows.
One can now also set timeouts for read and writes in Windows clients with
@code{mysql_options()}.
@item
Added option @code{--sql-mode=NO_DIR_IN_CREATE} to make it possible for
slaves to ignore @code{INDEX DIRECTORY} and
@code{DATA DIRECTORY} options given to @code{CREATE TABLE}.
When this is mode is on, @code{SHOW CREATE TABLE} will not show the
given directories.
@item
@code{SHOW CREATE TABLE} now shows the @code{INDEX DIRECTORY} and
@code{DATA DIRECTORY} options, if they were specified when the table was
created.
@item
The @code{open_files_limit} server variable now shows the real open files limit.
@item
@code{MATCH ... AGAINST()} in natural language mode
now treats words that are present
in more than 2,000,000 rows as stopwords.
@item
The Mac OS X installation disk images now include an additional
@file{MySQLStartupItem.pkg} package that enables the automatic
startup of MySQL on system bootup.
@xref{Mac OS X installation}.
@item
Most of the documentation included in the binary tarball distributions
(@code{.tar.gz}) has been moved into a subdirectory @code{docs}.
@xref{Installation layouts}.
@item
The manual is now included as an additional @code{info} file in the binary
distributions. (Bug #1019)
@item
The binary distributions now include the embedded server library 
(@code{libmysqld.a}) by default. Due to a linking problem with non-gcc
compilers, it was not included in all packages of the initial 4.0.15
release. The affected packages were rebuilt and released as 4.0.15a.
@xref{Nutshell Embedded MySQL}.
@item
MySQL can now use range optimization for @code{BETWEEN} with
non-constant limits. (Bug #991)
@item
Replication error messages now include the default database, so that
users can check which database the failing query was run for.
@item
A documentation change: Added a paragraph about how the
@code{binlog-do-db} and @code{binlog-ignore-db} options are tested
against the database on the master (@pxref{Binary log}), and a
paragraph about how @code{replicate-do-db}, @code{replicate-do-table}
and analogous options are tested against the database and tables on the
slave (@pxref{Replication Options}).
@item
Now the slave does not replicate @code{SET PASSWORD}
if it is configured to exclude the @code{mysql} database from
replication (using for example
@code{replicate-wild-ignore-table=mysql.%}). This was already the
case for @code{GRANT} and @code{REVOKE} since version 4.0.13 (though
there was Bug #980 in 4.0.13 & 4.0.14, which has been fixed in
4.0.15).
@item
Rewrote the information shown in the @code{State} column of @code{SHOW
PROCESSLIST} for replication threads and for @code{MASTER_POS_WAIT()}
and added the most common states for these threads to the
documentation, @pxref{Replication Implementation Details}.
@item
Added a test in replication to detect the case where the master died
in the middle of writing a transaction to the binlog; such unfinished
transactions now trigger an error message on the slave.
@item
A @code{GRANT} command that creates an anonymous user
(that is, an account with an empty username) no longer requires
@code{FLUSH PRIVILEGES} for the account to be recognized by the server.
(Bug #473)
@item
@code{CHANGE MASTER} now flushes @file{relay-log.info}. Previously
this was deferred to the next run of @code{START SLAVE}, so if
@code{mysqld} was shutdown on the slave after @code{CHANGE MASTER}
without having run @code{START SLAVE}, the relay log's name and
position were lost. At restart they were reloaded from
@file{relay-log.info}, thus reverting to their old (incorrect) values from
before @code{CHANGE MASTER} and leading to error messages 
(as the old relay log did not exist any more) and the slave threads
refusing to start. (Bug #858)
@end itemize

Bugs fixed:
@itemize @bullet
@item
Fixed buffer overflow in password handling which could potentially be
exploited by MySQL users with @code{ALTER} privilege on the
@code{mysql.user} table to execute random code or to gain shell access with
the UID of the mysqld process (thanks to Jedi/Sector One for spotting and
reporting this bug).
@item
Fixed server crash on @code{FORCE INDEX} in a query that contained
"Range checked for each record" in the @code{EXPLAIN} output. (Bug #1172)
@item
Fixed table/column grant handling - proper sort order (from most specific
to less specific, @pxref{Request access}) was not honored.
(Bug #928)
@item
Fixed rare bug in MYISAM introduced in 4.0.3 where the index file header
was not updated directly after an @code{UPDATE} of split dynamic rows.
The symptom was that the table had a corrupted delete-link if mysqld
was shut down or the table was checked directly after the update.
@item
Fixed @code{Can't unlock file} error when running
@code{myisamchk --sort-index} on Windows. (Bug #1119)
@item
Fixed possible deadlock when changing @code{key_buffer_size} while
the key cache was actively used. (Bug #1088)
@item
Fixed overflow bug in @code{MyISAM} and @code{ISAM} when a row is updated
in a table with a large number of columns and at least one @code{BLOB/TEXT}
column.
@item
Fixed incorrect result when doing @code{UNION} and @code{LIMIT #,#} when
one didn't use braces around the @code{SELECT} parts.
@item
Fixed incorrect result when doing @code{UNION} and @code{ORDER BY .. LIMIT #}
when one didn't use braces around the @code{SELECT} parts.
@item
Fixed problem with @code{SELECT SQL_CALC_FOUND_ROWS ... UNION ALL ... LIMIT #}
where @code{FOUND_ROWS()} returned incorrect number of rows.
@item
Fixed unlikely stack bug when having a BIG expression of
type @code{1+1-1+1-1...} in certain combinations. (Bug #871)
@item
Fixed the bug that sometimes prevented a table with a @code{FULLTEXT} index
from being marked as "analyzed".
@item
Fixed MySQL so that the column length (in C API) for the second column in
@code{SHOW CREATE TABLE} is always larger than the data length.
The only known application that was affected by the old behavior was
Borland dbExpress, which truncated the output from the command.
(Bug #1064)
@item
Fixed crash in comparisons of strings using the @code{tis620} character
set. (Bug #1116)
@item
Fixed @code{ISAM} bug in @code{MAX()} optimization.
@item
@code{myisamchk --sort-records=N} no longer marks table as crashed if
sorting failed because of an inappropriate key. (Bug #892)
@item
Fixed a minor bug in @code{MyISAM} compressed table handling that sometimes
made it impossible to repair compressed table in "Repair by sort" mode.
"Repair with keycache" (@code{myisamchk --safe-recover}) worked, though.
(Bug #1015)
@item
Fixed bug in propagating the version number to the manual included in
the distribution files. (Bug #1020)
@item
Fixed key sorting problem (a @code{PRIMARY} key declared for a column
that is not explicitly marked @code{NOT NULL} was sorted after a
@code{UNIQUE} key for a @code{NOT NULL} column).
@item
Fixed the result of @code{INTERVAL} when applied to a @code{DATE} value.
(Bug #792)
@item
Fixed compiling of the embedded server library in the RPM spec file.
(Bug #959)
@item
Added some missing files to the RPM spec file and fixed some RPM building
errors that occurred on Red Hat Linux 9. (Bug #998)
@item
Fixed incorrect @code{XOR} evaluation in @code{WHERE} clause. (Bug #992)
@item
Fixed bug with processing in query cache merged tables constructed
from more then 255 tables. (Bug #930) 
@item
Fixed incorrect results from outer join query (e.g. @code{LEFT JOIN})
when @code{ON} condition is always false, and range search in used.  
(Bug #926)
@item
Fixed a bug causing incorrect results from @code{MATCH ... AGAINST()} in some
joins. (Bug #942)
@item
@code{MERGE} tables do not ignore "Using index" (from @code{EXPLAIN} output)
anymore.
@item
Fixed a bug that prevented an empty table from being marked as "analyzed".
(Bug #937)
@item
Fixed @code{myisamchk --sort-records} crash when used on compressed table.
@item
Fixed slow (as compared to 3.23)
@code{ALTER TABLE} and related commands such as @code{CREATE INDEX}.
(Bug #712)
@item
Fixed segmentation fault resulting from @code{LOAD DATA FROM MASTER} when
the master was running without the @code{--log-bin} option. (Bug #934)
@item
Fixed a security bug: A server compiled without SSL support still allowed
connections by users that had the @code{REQUIRE SSL} option specified for
their accounts.
@item
Fixed a random bug: Sometimes the slave would replicate @code{GRANT}
or @code{REVOKE} queries even if it was configured to exclude the
@code{mysql} database from replication (for example, using
@code{replicate-wild-ignore-table=mysql.%}). (Bug #980)
@item
The @code{Last_Errno} and @code{Last_Error} fields in the output of
@code{SHOW SLAVE STATUS} are now cleared by @code{CHANGE MASTER} and
when the slave SQL thread starts. (Bug #986)
@item
A documentation mistake: It said that @code{RESET SLAVE} does not change
connection information  (master host, port, user, and
password), whereas it does. The statement resets these to the startup options
(@code{master-host} etc) if there were some. (Bug #985)
@item
@code{SHOW SLAVE STATUS} now shows correct information (master host,
port, user, and password) after @code{RESET SLAVE}
(that is, it shows the new values, which are copied from the startup
options if there were some). (Bug #985)
@item
Disabled propagation of the original master's log position for events because
this caused unexpected values for @code{Exec_Master_Log_Pos} and problems
with @code{MASTER_POS_WAIT()} in A->B->C replication setup. (Bug #1086)
@item
Fixed a segfault in @code{mysqlbinlog} when
@code{--position=x} was used with @code{x} being between a
@code{Create_file} event and its fellow @code{Append_block},
@code{Exec_load} or @code{Delete_file} events. (Bug #1091)
@item
@code{mysqlbinlog} printed superfluous warnings when using
@code{--database}, which caused syntax errors when piped to
@code{mysql}. (Bug #1092)
@item
Made @code{mysqlbinlog --database} filter @code{LOAD DATA INFILE} too
(previously, it filtered all queries except @code{LOAD DATA
INFILE}). (Bug #1093)
@item
@code{mysqlbinlog} in some cases forgot to put a leading @code{'#'} in
front of the original @code{LOAD DATA INFILE} (this command is
displayed only for information, not to be run; it is later reworked to
@code{LOAD DATA LOCAL} with a different filename, for execution by
@code{mysql}). (Bug #1096)
@item
@code{binlog-do-db} and @code{binlog-ignore-db} incorrectly filtered
@code{LOAD DATA INFILE} (it was half-written to the binary log). This
resulted in a corrupted binary log, which could cause the slave to
stop with an error. (Bug #1100)
@item
When, in a transaction, a transactional table (such as an @code{InnoDB} table)
was updated, and later in the same transaction a
non-transactional table (such as a @code{MyISAM} table) was
updated using the updated content of the transactional table
(with @code{INSERT ... SELECT} for example), the queries were written
to the binary log in an incorrect order. (Bug #873)
@item
When, in a transaction, @code{INSERT ... SELECT} updated a
non-transactional table, and @code{ROLLBACK} was issued, no error was
returned to the client. Now the client is warned that some changes
could not be rolled back, as this was already the case for normal
@code{INSERT}. (Bug #1113)
@item
Fixed a potential bug: When @code{STOP SLAVE} was run while the slave
SQL thread was in the middle of a transaction, and then @code{CHANGE
MASTER} was used to point the slave to some non-transactional
statement, the slave SQL thread could get confused (because it would
still think, from the past, that it was in a transaction).
@end itemize

@node News-4.0.14, News-4.0.13, News-4.0.15, News-4.0.x
@appendixsubsec Changes in release 4.0.14 (18 Jul 2003)

Functionality added or changed:
@itemize @bullet
@item
@code{mysqld} now reads an additional option file group having a name
corresponding to the server's release series:
@code{[mysqld-4.0]} for 4.0.x servers, @code{[mysqld-4.1]} for 4.1.x servers,
and so forth. This allows options to be specified on a series-specific basis.
@item
The @code{CONCAT_WS()} function no longer skips empty strings. (Bug #586).
@item
@code{InnoDB} now supports indexing a prefix of a column. This means, in
particular, that @code{BLOB} and @code{TEXT} columns can be indexed in
@code{InnoDB} tables, which was not possible before.
@item
A documentation change: Function @code{INTERVAL(NULL, ...)} returns @code{-1}.
@item
Enabled @code{INSERT} from @code{SELECT} when the table into which the records
are inserted is also a table listed in the @code{SELECT}.
@item
Allow @code{CREATE TABLE} and @code{INSERT} from any @code{UNION}.
@item
The @code{SQL_CALC_FOUND_ROWS} option now always returns the total number 
of rows for any @code{UNION}.
@item
Removed @code{--table} option from @code{mysqlbinlog} 
to avoid repeating @code{mysqldump} functionality.
@item
Comment lines in option files can now start from the middle of a line, too
(like @code{basedir=c:\mysql # installation directory}).
@item
Changed optimizer slightly to prefer index lookups over full table scans
in some boundary cases.
@item
Added thread-specific @code{max_seeks_for_key} variable that can
be used to force the optimizer to use keys instead of table scans
even if the cardinality of the index is low.
@item
Added optimization that converts @code{LEFT JOIN} to normal join in
some cases.
@item
A documentation change: added a paragraph about failover in
replication (how to use a surviving slave as the new master, how to
resume to the original setup). @xref{Replication FAQ}.
@item
A documentation change: added warning notes about safe use of the
@code{CHANGE MASTER} command. @xref{CHANGE MASTER TO}.
@item
MySQL now issues a warning (not an error, as in 4.0.13)
when it opens a table that was created with MySQL 4.1.
@item
Added @code{--nice} option to @code{mysqld_safe} to allow setting the
niceness of the @code{mysqld} process. (Thanks to Christian Hammers for
providing the initial patch.) (Bug #627)
@item
Added @code{--read-only} option to cause @code{mysqld} to allow no updates
except from slave threads or from users with the @code{SUPER} privilege.
(Original patch from Markus Benning).
@item
@code{SHOW BINLOG EVENTS FROM x} where @code{x} is less than 4 now
silently converts @code{x} to 4 instead of printing an error. The same change
was done for @code{CHANGE MASTER TO MASTER_LOG_POS=x} and 
@code{CHANGE MASTER TO RELAY_LOG_POS=x}.
@item
@code{mysqld} now only adds an interrupt handler for the @code{SIGINT} signal
if you start it with the new @code{--gdb} option.  This is because some
MySQL users encountered strange problems when they accidentally sent @code{SIGINT} to
@code{mysqld} threads.
@item
@code{RESET SLAVE} now clears the @code{Last_Errno} and
@code{Last_Error} fields in the output of @code{SHOW SLAVE STATUS}.
@item
Added @code{max_relay_log_size} variable; the relay log will be rotated
automatically when its size exceeds @code{max_relay_log_size}. But if
@code{max_relay_log_size} is 0 (the default), @code{max_binlog_size}
will be used (as in older versions). @code{max_binlog_size} still
applies to binary logs in any case.
@item
@code{FLUSH LOGS} now rotates relay logs in addition to the other types of
logs it already rotated.
@end itemize

Bugs fixed:
@itemize @bullet
@item
Comparison/sorting for @code{latin1_de} character set was rewritten.
The old algorithm could not handle cases like @code{"s@"a" > "@ss{}a"}.
@xref{German character set}. In rare cases it resulted in table
corruption.
@item
Fixed a problem with the password prompt on Windows. (Bug #683)
@item
@code{ALTER TABLE ... UNION=(...)} for @code{MERGE} table is now allowed
even if some underlying @code{MyISAM} tables are read-only. (Bug #702)
@item
Fixed a problem with @code{CREATE TABLE t1 SELECT x'41'}. (Bug #801)
@item
Removed some incorrect lock warnings from the error log.
@item
Fixed memory overrun when doing @code{REPAIR} on a table with a multi-part
auto_increment key where one part was a packed @code{CHAR}.
@item
Fixed a probable race condition in the replication code that could
potentially lead to @code{INSERT} statements not being replicated in the
event of a @code{FLUSH LOGS} command or when the binary log exceeds
@code{max_binlog_size}. (Bug #791)
@item
Fixed a crashing bug in @code{INTERVAL} and @code{GROUP BY} or 
@code{DISTINCT}. (Bug #807)
@item
Fixed bug in @code{mysqlhotcopy} so it actually aborts for unsuccessful
table copying operations.  Fixed another bug so that it succeeds
when there are thousands of tables to copy. (Bug #812)
@item
Fixed problem with @code{mysqlhotcopy} failing to read options from option
files. (Bug #808)
@item
Fixed bugs in optimizer that sometimes prevented MySQL from using
@code{FULLTEXT} indexes even though it was possible (for example, in
@code{SELECT * FROM t1 WHERE MATCH a,b AGAINST("index") > 0}).
@item
Fixed a bug with ``table is full'' in @code{UNION} operations.
@item
Fixed a security problem that enabled users with no privileges to obtain
information on the list of existing databases by using @code{SHOW TABLES} and
similar commands.
@item
Fixed a stack problem on UnixWare/OpenUnix.
@item
Fixed a configuration problem on UnixWare/OpenUNIX and OpenServer.
@item
Fixed a stack overflow problem in password verification.
@item
Fixed a problem with @code{max_user_connections}.
@item
@code{HANDLER} without an index now works properly when a table has deleted 
rows. (Bug #787)
@item
Fixed a bug with @code{LOAD DATA} in @code{mysqlbinlog}. (Bug #670)
@item
Fixed that @code{SET CHARACTER SET DEFAULT} works. (Bug #462)
@item
Fixed @code{MERGE} table behavior in @code{ORDER BY ... DESC} queries.
(Bug #515)
@item
Fixed server crash on @code{PURGE MASTER LOGS} or @code{SHOW MASTER LOGS}
when the binary log is off. (Bug #733)
@item
Fixed password-checking problem on Windows. (Bug #464)
@item
Fixed the bug in comparison of a @code{DATETIME} column and an integer
constant.  (Bug #504)
@item
Fixed remote mode of @code{mysqlbinlog}. (Bug #672)
@item
Fixed @code{ERROR 1105: Unknown error} that occurred for some @code{SELECT}
queries, where a column that was declared as @code{NOT NULL} was compared
with an expression that took @code{NULL} value.
@item
Changed timeout in @code{mysql_real_connect()} to use @code{poll()} instead of
@code{select()} to work around problem with many open files in the client.
@item
Fixed incorrect results from @code{MATCH ... AGAINST} used with a
@code{LEFT JOIN} query.
@item
Fixed a bug that limited the maximum value for @code{mysqld} variables
to 4294967295 when they are specified on the command line.
@item
Fixed a bug that sometimes caused spurious ``Access denied'' errors
in @code{HANDLER ... READ} statements, when a table is referenced
via an alias.
@item
Fixed portability problem with @code{safe_malloc}, which caused MySQL to
give "Freeing wrong aligned pointer" errors on SCO 3.2.
@item
@code{ALTER TABLE ... ENABLE/DISABLE KEYS} could cause a core dump when
done after an @code{INSERT DELAYED} statement on the same table.
@item
Fixed problem with conversion of localtime to GMT where some times resulted in
different (but correct) timestamps. Now MySQL should use the smallest
possible timestamp value in this case.  (Bug #316)
@item
Very small query cache sizes could crash @code{mysqld}. (Bug #549)
@item
Fixed a bug (accidentally introduced by us but present only in version 4.0.13)
that made @code{INSERT ... SELECT} into an @code{AUTO_INCREMENT} column
not replicate well. This bug is in the master, not in the slave.
(Bug #490)
@item
Fixed a bug: When an @code{INSERT ... SELECT} statement inserted rows into a
non-transactional table, but failed at some point (for example, due to
a ``Duplicate key'' error), the query was not written to the binlog.
Now it is written to the binlog, with its error code, as all other
queries are. About the @code{slave-skip-errors} option for how to
handle partially completed queries in the slave, see @ref{Replication
Options}. (Bug #491)
@item
@code{SET FOREIGN_KEY_CHECKS=0} was not replicated properly.
The fix probably will not be backported to 3.23.
@item
On a slave, @code{LOAD DATA INFILE} which had no @code{IGNORE} or
@code{REPLACE} clause on the master, was replicated with @code{IGNORE}.
While this is not a problem if the master and slave data are identical
(a @code{LOAD} that produces no duplicate conflicts on the master will
produce none on the slave anyway), which is true in normal operation, it
is better for debugging not to silently add the @code{IGNORE}. That way,
you can get an error message on the slave and discover that for some
reason, the data on master and slave are different and investigate why.
(Bug #571)
@item
On a slave, @code{LOAD DATA INFILE} printed an incomplete ``Duplicate entry
'%-.64s' for key %d''' message (the key name and value were not mentioned)
in case of duplicate conflict (which does not happen in normal operation).
(Bug #573)
@item
When using a slave compiled with @code{--debug}, @code{CHANGE MASTER
TO RELAY_LOG_POS} could cause a debug assertion failure. (Bug #576)
@item
When doing a @code{LOCK TABLES WRITE} on an @code{InnoDB} table, commit could
not happen, if the query was not written to the binary log (for example, if
@code{--log-bin} was not used, or @code{binlog-ignore-db} was
used). (Bug #578)
@item
If a 3.23 master had open
temporary tables that had been replicated to a 4.0 slave, and
the binlog got rotated, these temporary tables were immediately 
dropped by the slave (which caused problems if the master used them
subsequently). This bug had been fixed in 4.0.13, but in a manner
which caused an unlikely inconvenience: if the 3.23 master died
brutally (power failure), without having enough time to automatically
write @code{DROP TABLE} statements to its binlog, then the 4.0.13
slave would not notice the temporary tables have to be dropped, until the
slave @code{mysqld} server is restarted. This minor inconvenience is
fixed in 3.23.57 and 4.0.14 (meaning the master must be upgraded to
3.23.57 and the slave to 4.0.14 to remove the inconvenience). (Bug #254)
@item
If @code{MASTER_POS_WAIT()} was waiting, and the slave was idle, and
the slave SQL thread terminated, @code{MASTER_POS_WAIT()} would wait
forever. Now when the slave SQL thread terminates,
@code{MASTER_POS_WAIT()} immediately returns @code{NULL} (``slave
stopped''). (Bug #651)
@item
After @code{RESET SLAVE; START SLAVE;}, the @code{Relay_Log_Space} value
displayed by @code{SHOW SLAVE STATUS} was too big by four bytes. (Bug #763)
@item
If a query was ignored on the slave (because of
@code{replicate-ignore-table} and other similar rules), the slave
still checked if the query got the same error code (0, no error) as on
the master. So if the master had an error on the query (for example,
``Duplicate entry'' in a multiple-row insert), then the slave stopped
and warned that the error codes didn't match. (Bug #797)
@end itemize

@node News-4.0.13, News-4.0.12, News-4.0.14, News-4.0.x
@appendixsubsec Changes in release 4.0.13 (16 May 2003)

Functionality added or changed:
@itemize @bullet
@item
@code{PRIMARY KEY} now implies @code{NOT NULL}. (Bug #390)
@item
The Windows binary packages are now compiled with
@code{--enable-local-infile} to match the Unix build configuration.
@item
Removed timing of tests from @code{mysql-test-run}. @code{time} does not
accept all required parameters on many platforms (for example, QNX) and timing
the tests is not really required (it's not a benchmark anyway).
@item
@code{SHOW MASTER STATUS} and @code{SHOW SLAVE STATUS} required the
@code{SUPER} privilege; now they accept @code{REPLICATION CLIENT} as well.
(Bug #343)
@item 
Added multi-threaded MyISAM repair optimization and
@code{myisam_repair_threads} variable to enable it.
@xref{SHOW VARIABLES, , @code{myisam_repair_threads}}.
@item 
Added @code{innodb_max_dirty_pages_pct} variable which controls amount of
dirty pages allowed in @code{InnoDB} buffer pool.
@item
@code{CURRENT_USER()} and @code{Access denied} error messages now report the
hostname exactly as it was specified in the @code{GRANT} command.
@item
Removed benchmark results from the source and binary distributions. They
are still available in the BK source tree, though.
@item
@code{InnoDB} tables now support @code{ANALYZE TABLE}.
@item
MySQL now issues an error when it opens a table that was created with
MySQL 4.1.
@item
Option @code{--new} now changes binary items (@code{0xFFDF}) to be
treated as binary strings instead of numbers by default. This fixes some
problems with character sets where it's convenient to input the string
as a binary item.  After this change you have to convert the binary
string to @code{INTEGER} with a @code{CAST} if you want to compare two
binary items with each other and know which one is bigger than the other.
@code{SELECT CAST(0xfeff AS UNSIGNED) < CAST(0xff AS UNSIGNED)}.
This will be the default behavior in MySQL 4.1. (Bug #152)
@item
Enabled @code{delayed_insert_timeout} on Linux (most modern @code{glibc}
libraries have a fixed @code{pthread_cond_timedwait()}). (Bug #211)
@item
Don't create more insert delayed threads than given by
@code{max_insert_delayed_threads}. (Bug #211)
@item
Changed @code{UPDATE ... LIMIT} to apply the limit to rows that were matched,
whether or not they actually were changed. Previously the limit was applied
as a restriction on the number of rows changed.
@item
Tuned optimizer to favor clustered index over table scan.
@item
@code{BIT_AND()} and @code{BIT_OR()} now return an unsigned 64-bit value.
@item
Added warnings to error log of why a secure connection failed (when
running with @code{--log-warnings}).
@item
Deprecated options @code{--skip-symlink} and @code{--use-symbolic-links} and
replaced these with @code{--symbolic-links}.
@item
The default option for @code{innodb_flush_log_at_trx_commit} was changed
from 0 to 1 to make @code{InnoDB} tables ACID by default.
@xref{InnoDB start, , @code{InnoDB} start}.
@item
Added a feature to @code{SHOW KEYS} to display keys that are disabled by 
@code{ALTER TABLE DISABLE KEYS} command.
@item
When using a non-existing table type with @code{CREATE TABLE}, first
try if the default table type exists before falling back to @code{MyISAM}.
@item
Added @code{MEMORY} as an alias for @code{HEAP}.
@item
Renamed function @code{rnd} to @code{my_rnd} as the name was too generic
and is an exported symbol in @code{libmysqlclient} (thanks to Dennis Haney
for the initial patch).
@item
Portability fix: renamed @file{include/dbug.h} to
@file{include/my_debug.h}.
@item
@code{mysqldump} no longer silently deletes the binlogs when called with
@code{--master-data} or @code{--first-slave};
while this behavior was convenient for some
users, others may suffer from it. Now one has to explicitly ask for
this deletion with the new @code{--delete-master-logs} option.
@item
If the slave is configured (using for example
@code{replicate-wild-ignore-table=mysql.%})
to exclude @code{mysql.user}, @code{mysql.host}, @code{mysql.db},
@code{mysql.tables_priv} and @code{mysql.columns_priv} from
replication, then @code{GRANT} and @code{REVOKE} will not be replicated.
@end itemize

Bugs fixed:
@itemize @bullet
@item
Logged @code{Access denied} error message had incorrect @code{Using password}
value. (Bug #398)
@item
Fixed bug with @code{NATURAL LEFT JOIN}, @code{NATURAL RIGHT JOIN} and
@code{RIGHT JOIN} when using many joined tables.  The problem was that
the @code{JOIN} method was not always associated with the tables
surrounding the @code{JOIN} method.  If you have a query that uses many
@code{RIGHT JOIN} or @code{NATURAL ... JOINS} you should check that they
work as you expected after upgrading MySQL to this version. (Bug #291)
@item
Fixed @code{mysql} parser not to erroneously interpret @samp{'} or @samp{"}
characters within @code{/* ... */} comment as beginning a quoted string.
@item
@code{mysql} command line client no longer looks for @code{\*} commands
inside backtick-quoted strings.
@item
Fixed @code{Unknown error} when using @code{UPDATE ... LIMIT}. (Bug #373)
@item
Fixed problem with ANSI mode and @code{GROUP BY} with constants. (Bug #387)
@item
Fixed bug with @code{UNION} and @code{OUTER JOIN}. (Bug #386)
@item
Fixed bug if one used a multiple-table @code{UPDATE} and the query required a
temporary table bigger than @code{tmp_table_size}. (Bug #286)
@item
Run @code{mysql_install_db} with the @code{-IN-RPM} option for the Mac OS X
installation to not fail on systems with improperly configured hostname
configurations.
@item
@code{LOAD DATA INFILE} will now read @code{000000} as a zero date instead as
@code{"2000-00-00"}.
@item
Fixed bug that caused @code{DELETE FROM table WHERE const_expression}
always to delete the whole table (even if expression result was false).
(Bug #355)
@item
Fixed core dump bug when using @code{FORMAT('nan',#)}. (Bug #284)
@item
Fixed name resolution bug with @code{HAVING ... COUNT(DISTINCT ...)}.
@item
Fixed incorrect result from truncation operator (@code{*}) in
@code{MATCH ... AGAINST()} in some complex joins.
@item
Fixed a crash in @code{REPAIR ... USE_FRM} command, when used on read-only,
nonexisting table or a table with a crashed index file.
@item
Fixed a crashing bug in mysql monitor program.
It occurred if program was started with @code{--no-defaults}, with a prompt
that contained hostname and connection to non-existing db was requested
@item
Fixed problem when comparing a key for a multi-byte-character set. (Bug #152)
@item
Fixed bug in @code{LEFT}, @code{RIGHT} and @code{MID} when used with
multi-byte character sets and some @code{GROUP BY} queries. (Bug #314)
@item
Fix problem with @code{ORDER BY} being discarded for some
@code{DISTINCT} queries. (Bug #275)
@item
Fixed that @code{SET SQL_BIG_SELECTS=1} works as documented (This corrects
a new bug introduced in 4.0)
@item
Fixed some serious bugs in @code{UPDATE ... ORDER BY}. (Bug #241)
@item
Fixed unlikely problem in optimizing @code{WHERE} clause with constant
expression like in @code{WHERE 1 AND (a=1 AND b=1)}.
@item
Fixed that @code{SET SQL_BIG_SELECTS=1} works again.
@item
Introduced proper backtick quoting for db.table in @code{SHOW GRANTS}.
@item
@code{FULLTEXT} index stopped working after @code{ALTER TABLE}
that converts @code{TEXT} column to @code{CHAR}. (Bug #283)
@item
Fixed a security problem with @code{SELECT} and wildcarded select list,
when user only had partial column @code{SELECT} privileges on the table.
@item
Mark a MyISAM table as "analyzed" only when all the keys are indeed
analyzed.
@item
Only ignore world-writable @file{my.cnf} files that are regular files
(and not, for example, named pipes or character devices).
@item
Fixed few smaller issues with @code{SET PASSWORD}.
@item
Fixed error message which contained deprecated text.
@item
Fixed a bug with two @code{NATURAL JOIN}s in the query.
@item
@code{SUM()} didn't return @code{NULL} when there was no rows in result
or when all values was @code{NULL}.
@item
On Unix symbolic links handling was not enabled by default and there was
no way to turn this on.
@item
Added missing dashes to parameter @code{--open-files-limit} in
@code{mysqld_safe}. (Bug #264)
@item
Fixed incorrect hostname for TCP/IP connections displayed in
@code{SHOW PROCESSLIST}.
@item
Fixed a bug with @code{NAN} in @code{FORMAT(...)} function ...
@item 
Fixed a bug with improperly cached database privileges.
@item
Fixed a bug in @code{ALTER TABLE ENABLE / DISABLE KEYS} which failed to
force a refresh of table data in the cache.
@item 
Fixed bugs in replication of @code{LOAD DATA INFILE} for custom parameters 
(@code{ENCLOSED},  @code{TERMINATED} and so on) and temporary tables.
(Bug #183, Bug #222)
@item
Fixed a replication bug when the master is 3.23 and the slave 4.0: the
slave lost the replicated temporary tables if @code{FLUSH LOGS} was
issued on the master. (Bug #254)
@item
Fixed a bug when doing @code{LOAD DATA INFILE IGNORE}: When reading
the binary log, @code{mysqlbinlog} and the replication code read @code{REPLACE}
instead of @code{IGNORE}. This could make the slave's table
become different from the master's table. (Bug #218)
@item
Fixed a deadlock when @code{relay_log_space_limit} was set to a too
small value. (Bug #79)
@item
Fixed a bug in HAVING clause when an alias is used from the
@strong{select list}. 
@item
Fixed overflow bug in @code{MyISAM} when a row is inserted into a table with a 
large number of columns and at least one @code{BLOB/TEXT} column. Bug was caused
by incorrect calculation of the needed buffer to pack data.
@item
Fixed a bug when @code{SELECT} @strong{@@nonexistent_variable} caused the
error in client - server protocol due to net_printf() being sent to
the client twice.
@item 
Fixed a bug in setting @code{SQL_BIG_SELECTS} option.
@item
Fixed a bug in @code{SHOW PROCESSLIST} which only displayed a localhost
in the @code{"Host"} column. This was caused by a glitch that used only
current thread information instead of information from the linked list of threads.
@item
Removed unnecessary Mac OS X helper files from server RPM. (Bug #144)
@item
Allow optimization of multiple-table update for @code{InnoDB} tables as well.
@item
Fixed a bug in multiple-table updates that caused some rows to be
updated several times.
@item
Fixed a bug in @code{mysqldump} when it was called with
@code{--master-data}: the @code{CHANGE MASTER TO} commands appended to
the SQL dump had incorrect coordinates. (Bug #159)
@item
Fixed a bug when an updating query using @code{USER()} was replicated
on the slave; this caused segfault on the slave. (Bug #178).
@code{USER()} is still badly replicated on the slave (it is
replicated to @code{""}).
@end itemize

@node News-4.0.12, News-4.0.11, News-4.0.13, News-4.0.x
@appendixsubsec Changes in release 4.0.12 (15 Mar 2003: Production)

Functionality added or changed:
@itemize @bullet
@item
@code{mysqld} no longer reads options from world-writable config files.
@item
Integer values between 9223372036854775807 and 9999999999999999999 are now
regarded as unsigned longlongs, not as floats. This makes these values work
similar to values between 10000000000000000000 and 18446744073709551615.
@item
@code{SHOW PROCESSLIST} will now include the client TCP port after the
hostname to make it easier to know from which client the request
originated.
@end itemize

Bugs fixed:
@itemize @bullet
@item
Fixed @code{mysqld} crash on extremely small values of
@code{sort_buffer} variable.
@item
@code{INSERT INTO u SELECT ... FROM t} was written too late to the
binary log if t was very frequently updated during the execution of 
this query. This could cause a problem with @code{mysqlbinlog} or
replication. The master must be upgraded, not the slave. (Bug #136)
@item
Fixed checking of random part of @code{WHERE} clause. (Bug #142)
@item
Fixed a bug with multiple-table updates with @code{InnoDB}
tables. This bug occurred as, in many cases, @code{InnoDB} tables cannot
be updated ``on the fly,'' but offsets to the records have to be stored in
a temporary table. 
@item
Added missing file @code{mysql_secure_installation} to the @code{server}
RPM subpackage. (Bug #141)
@item
Fixed MySQL (and @code{myisamchk}) crash on artificially
corrupted @code{.MYI} files.
@item
Don't allow @code{BACKUP TABLE} to overwrite existing files.
@item
Fixed a bug with multiple-table @code{UPDATE} statements when user had all privileges
on the database where tables are located and there were any entries in
@code{tables_priv} table, that is, @code{grant_option} was true.
@item
Fixed a bug that allowed a user with table or column grants on some table,
@code{TRUNCATE} any table in the same database.
@item
Fixed deadlock when doing @code{LOCK TABLE} followed by @code{DROP
TABLE} in the same thread.  In this case one could still kill the thread
with @code{KILL}.
@item
@code{LOAD DATA LOCAL INFILE} was not properly written to the binary
log (hence not properly replicated). (Bug #82)
@item
@code{RAND()} entries were not read correctly by @code{mysqlbinlog} from
the binary log which caused problems when restoring a table that was
inserted with @code{RAND()}. @code{INSERT INTO t1 VALUES(RAND())}. In
replication this worked ok.
@item
@code{SET SQL_LOG_BIN=0} was ignored for @code{INSERT DELAYED}
queries. (Bug #104)
@item
@code{SHOW SLAVE STATUS} reported too old positions
(columns @code{Relay_Master_Log_File} and @code{Exec_Master_Log_Pos})
for the last executed statement from the master, if this statement
was the @code{COMMIT} of a transaction. The master must be upgraded for that,
not the slave. (Bug #52)
@item
@code{LOAD DATA INFILE} was not replicated by the slave if
@code{replicate_*_table} was set on the slave. (Bug #86)
@item
After @code{RESET SLAVE}, the coordinates displayed by @code{SHOW
SLAVE STATUS} looked un-reset (though they were, but only
internally). (Bug #70)
@item
Fixed query cache invalidation on @code{LOAD DATA}.
@item
Fixed memory leak on @code{ANALYZE} procedure with error.
@item
Fixed a bug in handling @code{CHAR(0)} columns that could cause incorrect
results from the query.
@item
Fixed rare bug with incorrect initialization of @code{AUTO_INCREMENT} column,
as a secondary column in a multi-column key (@pxref{example-AUTO_INCREMENT,
, @code{AUTO_INCREMENT} on secondary column  in a multi-column key}), when
data was inserted with @code{INSERT ... SELECT} or @code{LOAD DATA} into
an empty table.
@item
On Windows, @code{STOP SLAVE} didn't stop the slave until the slave
got one new command from the master (this bug has been fixed for MySQL 4.0.11
by releasing updated 4.0.11a Windows packages, which include this individual
fix on top of the 4.0.11 sources). (Bug #69)
@item 
Fixed a crash when no database was selected and @code{LOAD DATA} command
was issued with full table name specified, including database prefix.
@item
Fixed a crash when shutting down replication on some platforms
(for example, Mac OS X).
@item
Fixed a portability bug with @code{pthread_attr_getstacksize} on
HP-UX 10.20 (Patch was also included in 4.0.11a sources).
@item
Fixed the @code{bigint} test to not fail on some platforms (for example, HP-UX and
Tru64) due to different return values of the @code{atof()} function.
@item
Fixed the @code{rpl_rotate_logs} test to not fail on certain platforms (e.g.
Mac OS X) due to a too long file name (changed @code{slave-master-info.opt}
to @code{.slave-mi}).
@end itemize

@node News-4.0.11, News-4.0.10, News-4.0.12, News-4.0.x
@appendixsubsec Changes in release 4.0.11 (20 Feb 2003)

Functionality added or changed:
@itemize @bullet
@item
@code{NULL} is now sorted @strong{LAST} if you use @code{ORDER BY ... DESC}
(as it was before MySQL 4.0.2).  This change was required to comply
with the SQL-99 standard.  (The original change was made because we thought
that SQL-99 required @code{NULL} to be always sorted at the same position,
but this was incorrect).
@item
Added @code{START TRANSACTION} (SQL-99 syntax) as alias for @code{BEGIN}.
This is recommended to use instead of @code{BEGIN} to start a transaction.
@item
Added @code{OLD_PASSWORD()} as a synonym for @code{PASSWORD()}.
@item
Allow keyword @code{ALL} in group functions.
@item
Added support for some new @code{INNER JOIN} and @code{JOIN} syntaxes.
For example, @code{SELECT * FROM t1 INNER JOIN t2} didn't work before.
@item
Novell NetWare 6.0 porting effort completed, Novell patches merged into
the main source tree.
@end itemize

Bugs fixed:
@itemize @bullet
@item
Fixed problem with multiple-table delete and @code{InnoDB} tables.
@item
Fixed a problem with @code{BLOB NOT NULL} columns used with @code{IS NULL}.
@item
Re-added missing pre- and post(un)install scripts to the Linux RPM packages
(they were missing after the renaming of the server subpackage).
@item
Fixed that table locks are not released with multiple-table updates and 
deletes with @code{InnoDB} storage engine.
@item
Fixed bug in updating @code{BLOB} columns with long strings.
@item
Fixed integer-wraparound when giving big integer (>= 10 digits) to
function that requires an unsigned argument, like @code{CREATE TABLE (...) 
AUTO_INCREMENT=#}.
@item
@code{MIN(key_column)} could in some cases return @code{NULL} on a column
with @code{NULL} and other values.
@item
@code{MIN(key_column)} and @code{MAX(key_column)} could in some cases
return incorrect values when used in @code{OUTER JOIN}.
@item
@code{MIN(key_column)} and @code{MAX(key_column)} could return incorrect
values if one of the tables was empty.
@item
Fixed rare crash in compressed MyISAM tables with blobs.
@item
Fixed bug in using aggregate functions as argument for @code{INTERVAL},
@code{CASE}, @code{FIELD}, @code{CONCAT_WS}, @code{ELT} and
@code{MAKE_SET} functions.
@item
When running with @code{--lower-case-table-names} (default on Windows)
and you had tables or databases with mixed case on disk, then
executing @code{SHOW TABLE STATUS} followed with @code{DROP DATABASE}
or @code{DROP TABLE} could fail with @code{Errcode 13}.
@end itemize

@node News-4.0.10, News-4.0.9, News-4.0.11, News-4.0.x
@appendixsubsec Changes in release 4.0.10 (29 Jan 2003)

Functionality added or changed:
@itemize @bullet
@item
Added option @code{--log-error[=file_name]} to @code{mysqld_safe} and
@code{mysqld}. This option will force all error messages to be put in a
log file if the option @code{--console} is not given. On Windows
@code{--log-error} is enabled as default, with a default name of
@code{host_name.err} if the name is not specified.
@item
Changed some things from @code{Warning:} to @code{Note:} in the log files.
@item
The mysqld server should now compile on NetWare.
@item
Added optimization that if one does @code{GROUP BY ... ORDER BY NULL}
then result is not sorted.
@item
New @code{--ft-stopword-file} command-line option for @code{mysqld} to
replace/disable the built-in stopword list that is used in full-text searches.
@xref{SHOW VARIABLES, , @code{ft_stopword_file}}.
@item
Changed default stack size from 64K to 192K; This fixes a core dump
problem on Red Hat 8.0 and other systems with a @code{glibc} that requires a
stack size larger than 128K
for @code{gethostbyaddr()} to resolve a hostname. You can fix
this for earlier MySQL versions by starting @code{mysqld} with
@code{--thread-stack=192K}.
@item
Added @code{mysql_waitpid} to the binary distribution and the
@code{MySQL-client} RPM subpackage (required for @code{mysql-test-run}).
@item
Renamed the main @code{MySQL} RPM package to @code{MySQL-server}. When
updating from an older version, @code{MySQL-server.rpm} will simply replace
@code{MySQL.rpm}.
@item
If a slave is configured with @code{replicate_wild_do_table=db.%} or
@code{replicate_wild_ignore_table=db.%}, these rules will be applied to
@code{CREATE/DROP DATABASE}, too.
@item
Added timeout value for @code{MASTER_POS_WAIT()}.
@end itemize

Bugs fixed:
@itemize @bullet
@item
Fixed initialization of the random seed for newly created threads to
give a better @code{rand()} distribution from the first call.
@item
Fixed a bug that caused @code{mysqld} to hang when a
table was opened with the @code{HANDLER} command and then
dropped without being closed.
@item
Fixed bug in logging to binary log (which affects replication) a query
that inserts a @code{NULL} in an @code{AUTO_INCREMENT} column and also
uses @code{LAST_INSERT_ID()}.
@item
Fixed an unlikely bug that could cause a memory overrun when using
@code{ORDER BY constant_expression}.
@item
Fixed a table corruption in @code{myisamchk}'s parallel repair mode.
@item
Fixed bug in query cache invalidation on simple table renaming.
@item
Fixed bug in @code{mysqladmin --relative}.
@item
On some 64-bit systems, @code{show status} reported a strange number for
@code{Open_files} and @code{Open_streams}.
@item
Fixed incorrect number of columns in @code{EXPLAIN} on empty table.
@item
Fixed bug in @code{LEFT JOIN} that caused zero rows to be returned in
the case the @code{WHERE} condition was evaluated as @code{FALSE} after
reading @code{const} tables. (Unlikely condition).
@item
@code{FLUSH PRIVILEGES} didn't correctly flush table/column privileges
when @code{mysql.tables_priv} is empty.
@item
Fixed bug in replication when using @code{LOAD DATA INFILE} one a file
that updated an @code{AUTO_INCREMENT} column with @code{NULL} or @code{0}. This
bug only affected MySQL 4.0 masters (not slaves or MySQL 3.23 masters).
@strong{Note:} If you have a slave that has replicated a file with
generated @code{AUTO_INCREMENT} columns then the slave data is corrupted and you
should reinitialize the affected tables from the master.
@item
Fixed possible memory overrun when sending a @code{BLOB} value larger than 16M
to the client.
@item
Fixed incorrect error message when setting a @code{NOT NULL} column to an
expression that returned @code{NULL}.
@item
Fixed core dump bug in @code{str LIKE "%other_str%"} where @code{str} or
@code{other_str} contained characters >= 128.
@item
Fixed bug: When executing on master @code{LOAD DATA} and @code{InnoDB} failed
with @code{table full} error the binary log was corrupted.
@end itemize

@node News-4.0.9, News-4.0.8, News-4.0.10, News-4.0.x
@appendixsubsec Changes in release 4.0.9 (09 Jan 2003)

Functionality added or changed:
@itemize @bullet
@item
@code{OPTIMIZE TABLE} will for MyISAM tables treat all @code{NULL}
values as different when calculating cardinality.  This helps in
optimizing joins between tables where one of the tables has a lot of
@code{NULL} values in a indexed column:
@example
SELECT * from t1,t2 where t1.a=t2.key_with_a_lot_of_null;
@end example
@item
Added join operator @code{FORCE INDEX (key_list)}. This acts likes
@code{USE INDEX (key_list)} but with the addition that a table scan is
assumed to be VERY expensive.  One bad thing with this is that it makes
@code{FORCE} a reserved word.
@item
Reset internal row buffer in MyISAM after each query. This will reduce
memory in the case you have a lot of big blobs in a table.
@end itemize

Bugs fixed:
@itemize @bullet
@item
A security patch in 4.0.8 causes the mysqld server to die if the remote
hostname can't be resolved. This is now fixed.
@item
Fixed crash when replication big @code{LOAD DATA INFILE} statement that
caused log rotation.
@end itemize

@node News-4.0.8, News-4.0.7, News-4.0.9, News-4.0.x
@appendixsubsec Changes in release 4.0.8 (07 Jan 2003)

Functionality added or changed:
@itemize @bullet
@item
Default @code{max_packet_length} for libmysqld.c is now 1024*1024*1024.
@item
One can now specify @code{max_allowed_packet} in a file ready by
@code{mysql_options(MYSQL_READ_DEFAULT_FILE)}.
for clients.
@item
When sending a too big packet to the server with the not compressed
protocol, the client now gets an error message instead of a lost
connection.
@item
We now send big queries/result rows in bigger hunks, which should give a
small speed improvement.
@item
Fixed some bugs with the compressed protocol for rows > 16M.
@item
@code{InnoDB} tables now also support @code{ON UPDATE CASCADE} in
@code{FOREIGN KEY} constraints. See the @code{InnoDB} section in the manual
for the @code{InnoDB} changelog.
@end itemize

Bugs fixed:
@itemize @bullet
@item
Fixed bug in @code{ALTER TABLE} with @code{BDB} tables.
@item
Fixed core dump bug in @code{QUOTE()} function.
@item
Fixed a bug in handling communication packets bigger than
16M. Unfortunately this required a protocol change; If you upgrade the
server to 4.0.8 and above and have clients that uses packets >=
255*255*255 bytes (=16581375) you must also upgrade your clients to at
least 4.0.8.  If you don't upgrade, the clients will hang when sending a
big packet.
@item
Fixed bug when sending blobs longer than 16M to client.
@item
Fixed bug in @code{GROUP BY} when used on BLOB column with @code{NULL} values.
@item
Fixed a bug in handling @code{NULL} values in @code{CASE} ... WHEN ...
@end itemize

@node News-4.0.7, News-4.0.6, News-4.0.8, News-4.0.x
@appendixsubsec Changes in release 4.0.7 (20 Dec 2002)

Functionality added or changed:
@itemize @bullet
@item
@code{mysqlbug} now also reports the compiler version used for building
the binaries (if the compiler supports the option @code{--version}).
@end itemize

Bugs fixed:
@itemize @bullet
@item
Fixed compilation problems on OpenUnix and HPUX 10.20.
@item
Fixed some optimization problems when compiling MySQL with @code{-DBIG_TABLES}
on a 32-bit system.
@item
@code{mysql_drop_db()} didn't check permissions properly so anyone could
drop another users database.  @code{DROP DATABASE} is checked properly.
@end itemize

@node News-4.0.6, News-4.0.5, News-4.0.7, News-4.0.x
@appendixsubsec Changes in release 4.0.6 (14 Dec 2002: Gamma)

Functionality added or changed:

@itemize @bullet
@item
Added syntax support for @code{CHARACTER SET xxx} and @code{CHARSET=xxx}
table options (to be able to read table dumps from 4.1).
@item
Fixed replication bug that caused the slave to loose its position in
some cases when the replication log was rotated.
@item
Fixed that a slave will restart from the start of a transaction if
it's killed in the middle of one.
@item
Moved the manual pages from @file{man} to @file{man/man1} in the
binary distributions.
@item
The default type returned by @code{IFNULL(A,B)} is now set to be the
more 'general' of the types of @code{A} and @code{B}. (The order is
@code{STRING}, @code{REAL} or @code{INTEGER}).
@item
Moved the @code{mysql.server} startup script in the RPM packages from
@file{/etc/rc.d/init.d/mysql} to @file{/etc/init.d/mysql}
(which almost all current Linux distributions support for LSB compliance).
@item
Added @code{Qcache_lowmem_prunes} status variable (number of queries that were
deleted from cache because of low memory).
@item
Fixed @code{mysqlcheck} so it can deal with table names containing dashes.
@item
Bulk insert optimization
(@pxref{SHOW VARIABLES, ,@code{bulk_insert_buffer_size}})
is no longer used when inserting small (less than 100) number of rows.
@item
Optimization added for queries like
@code{SELECT ... FROM merge_table WHERE indexed_column=constant_expr}.
@item
Added functions @code{LOCALTIME} and @code{LOCALTIMESTAMP} as synonyms for
@code{NOW()}.
@item
@code{CEIL} is now an alias for @code{CEILING}.
@item
The @code{CURRENT_USER()} function can be used to get a @code{user@@host}
value as it was matched in the @code{GRANT} system.
@xref{Miscellaneous functions, ,@code{CURRENT_USER()}}.
@item
Fixed @code{CHECK} constraints to be compatible with SQL-99. This made
@code{CHECK} a reserved word. (Checking of @code{CHECK} constraints is
still not implemented).
@item
Added @code{CAST(... as CHAR)}.
@item
Added PostgreSQL compatible @code{LIMIT} syntax:
@code{SELECT ... LIMIT row_count OFFSET offset}
@item
@code{mysql_change_user()} will now reset the connection to the state
of a fresh connect (Ie, @code{ROLLBACK} any active transaction, close
all temporary tables, reset all user variables etc..)
@item
@code{CHANGE MASTER} and @code{RESET SLAVE} now require that slave
threads be both already stopped; these commands will return an error
if at least one of these two threads is running.
@end itemize

Bugs fixed:

@itemize @bullet
@item
Fixed number of found rows returned in @code{multi table updates}
@item
Make @code{--lower-case-table-names} default on Mac OS X as the default
file system (HFS+) is case insensitive.
@xref{Name case sensitivity}.
@item
Transactions in @code{AUTOCOMMIT=0} mode didn't rotate binary log.
@item
A fix for the bug in a @code{SELECT} with joined tables with
@code{ORDER BY} and @code{LIMIT} clause when filesort had to be used.
In that case @code{LIMIT} was applied to filesort of one of the tables,
although it could not be.
This fix also solved problems with @code{LEFT JOIN}.
@item
@code{mysql_server_init()} now makes a copy of all arguments. This fixes
a problem when using the embedded server in C# program.
@item
Fixed buffer overrun in @code{libmysqlclient} library
that allowed a malicious @code{MySQL} server to crash the client
application.
@item
Fixed security-related bug in @code{mysql_change_user()} handling.
All users are strongly recommended to upgrade to version 4.0.6.
@item
Fixed bug that prevented @code{--chroot} command-line option of
@code{mysqld} from working.
@item
Fixed bug in phrase operator @code{"..."} in boolean full-text search.
@item
Fixed bug that caused @code{OPTIMIZE TABLE} to corrupt the table
under some rare circumstances.
@item
Part rewrite of multiple-table-update to optimize it, make it safer and
more bug free.
@item
@code{LOCK TABLES} now works together with multiple-table-update and
multiple-table-delete.
@item
@code{--replicate-do=xxx} didn't work for @code{UPDATE} commands.
(Bug introduced in 4.0.0)
@item
Fixed shutdown problem on Mac OS X.
@item Major @code{InnoDB} bugs in @code{REPLACE, AUTO_INCREMENT,
INSERT INTO ... SELECT ...} were fixed. See the @code{InnoDB} changelog
in the @code{InnoDB} section of the manual.
@item
@code{RESET SLAVE} caused a crash if the slave threads were running.
@end itemize

@node News-4.0.5, News-4.0.4, News-4.0.6, News-4.0.x
@appendixsubsec Changes in release 4.0.5 (13 Nov 2002)

Functionality added or changed:

@itemize @bullet
@item
Port number was added to hostname (if it is known) in @code{SHOW PROCESSLIST}
command
@item
Changed handling of last argument in @code{WEEK()} so that one can get
week number according to the ISO 8601 specification.
(Old code should still work).
@item
Fixed that @code{INSERT DELAYED} threads don't hang on @code{Waiting for
INSERT} when one sends a @code{SIGHUP} to @code{mysqld}.
@item
Change that @code{AND} works according to SQL-99 when it comes to
@code{NULL} handling. In practice, this only affects queries where you
do something like @code{WHERE ... NOT (NULL AND 0)}.
@item
@code{mysqld} will now resolve @code{basedir} to its full path (with
@code{realpath()}). This enables one to use relative symlinks to the
MySQL installation directory.  This will however cause @code{show
variables} to report different directories on systems where there is
a symbolic link in the path.
@item
Fixed that MySQL will not use index scan on index disabled with
@code{IGNORE INDEX} or @code{USE INDEX}.
to be ignored.
@item
Added @code{--use-frm} option to @code{mysqlcheck}. When used with
@code{REPAIR}, it gets the table structure from the @code{.frm} file, so the
table can be repaired even if the @code{.MYI} header is corrupted.
@item
Fixed bug in @code{MAX()} optimization when used with @code{JOIN} and
@code{ON} expressions.
@item
Added support for reading of MySQL 4.1 table definition files.
@item
@code{BETWEEN} behavior changed (@pxref{Comparison Operators}).
Now @code{datetime_col BETWEEN timestamp AND timestamp} should work
as expected.
@item
One can create @code{TEMPORARY} @code{MERGE} tables now.
@item
@code{DELETE FROM myisam_table} now shrinks not only the @file{.MYD} file but
also the @file{.MYI} file.
@item
When one uses the @code{--open-files-limit=#} option to @code{mysqld_safe}
it's now passed on to @code{mysqld}.
@item
Changed output from @code{EXPLAIN} from @code{'where used'} to
@code{'Using where'} to make it more in line with other output.
@item
Removed variable @code{safe_show_database} as it was no longer used.
@item
Updated source tree to be built using @code{automake 1.5} and 
@code{libtool 1.4}.
@item
Fixed an inadvertently changed option (@code{--ignore-space}) back to the
original @code{--ignore-spaces} in @code{mysqlclient}. (Both syntaxes will
work).
@item
Don't require @code{UPDATE} privilege when using @code{REPLACE}.
@item
Added support for @code{DROP TEMPORARY TABLE ...}, to be used to make
replication safer.
@item
When transactions are enabled, all commands that update temporary tables
inside a @code{BEGIN/COMMIT} are now stored in the binary log on
@code{COMMIT} and not stored if one does @code{ROLLBACK}.  This fixes
some problems with non-transactional temporary tables used inside
transactions.
@item
Allow braces in joins in all positions. Formerly, things like
@code{SELECT * FROM (t2 LEFT JOIN t3 USING (a)), t1} worked, but
not @code{SELECT * FROM t1, (t2 LEFT JOIN t3 USING (a))}. Note that
braces are simply removed, they do not change the way the join is
executed.
@item
@code{InnoDB} now supports also isolation levels
@code{READ UNCOMMITTED} and @code{READ COMMITTED}.
For a detailed @code{InnoDB} changelog, see @ref{InnoDB change history}
in this manual. 
@end itemize

Bugs fixed:

@itemize @bullet
@item
Fixed bug in @code{MAX()} optimization when used with @code{JOIN} and
@code{ON} expressions.
@item
Fixed that @code{INSERT DELAY} threads don't hang on @code{Waiting for
INSERT} when one sends a @code{SIGHUP} to @code{mysqld}.
@item
Fixed that MySQL will not use an index scan on an index that has been
disabled with @code{IGNORE INDEX} or @code{USE INDEX}.
@item
Corrected test for @code{root} user in @code{mysqld_safe}.
@item
Fixed error message issued when storage engine cannot do @code{CHECK}
or @code{REPAIR}.
@item
Fixed rare core dump problem in complicated @code{GROUP BY} queries that
didn't return any result.
@item
Fixed @code{mysqlshow} to work properly with wildcarded database names and
with database names that contain underscores.
@item
Portability fixes to get MySQL to compile cleanly with Sun Forte 5.0.
@item
Fixed @code{MyISAM} crash when using dynamic-row tables with huge numbers of
packed fields.
@item
Fixed query cache behavior with @code{BDB} transactions.
@item
Fixed possible floating point exception in @code{MATCH}
relevance calculations.
@item
Fixed bug in full-text search @code{IN BOOLEAN MODE} that made @code{MATCH}
to return incorrect relevance value in some complex joins.
@item
Fixed a bug that limited @code{MyISAM} key length to a value
slightly less that 500. It is exactly 500 now.
@item
Fixed that @code{GROUP BY} on columns that may have a @code{NULL} value
doesn't always use disk based temporary tables.
@item
The filename argument for the @code{--des-key-file} argument to @code{mysqld}
is interpreted relative to the data directory if given as a relative pathname.
@item
Removed a condition that temp table with index on column that can be
@code{NULL} has to be @code{MyISAM}. This was okay for 3.23, but not
needed in 4.*. This resulted in slowdown in many queries since 4.0.2.
@item
Small code improvement in multiple-table updates.
@item
Fixed a newly introduced bug that caused @code{ORDER BY ... LIMIT row_count}
to not return all rows.
@item
Fixed a bug in multiple-table deletes when outer join is used on an empty
table, which gets first to be deleted.
@item
Fixed a bug in multiple-table updates when a single table is updated.
@item
Fixed bug that caused @code{REPAIR TABLE} and @code{myisamchk}
to corrupt @code{FULLTEXT} indexes.
@item
Fixed bug with caching the @code{mysql} grant table database. Now queries
in this database are not cached in the query cache.
@item
Small fix in @code{mysqld_safe} for some shells.
@item
Give error if a @code{MyISAM} @code{MERGE} table has more than 2 ^ 32 rows and
MySQL was not compiled with @code{-DBIG_TABLES}.
@item
Fixed some @code{ORDER BY ... DESC} problems with @code{InnoDB} tables.
@end itemize

@node News-4.0.4, News-4.0.3, News-4.0.5, News-4.0.x
@appendixsubsec Changes in release 4.0.4 (29 Sep 2002)

@itemize @bullet
@item
Fixed bug where @code{GRANT}/@code{REVOKE} failed if hostname was given in
non-matching case.
@item
Don't give warning in @code{LOAD DATA INFILE} when setting a
@code{timestamp} to a string value of @code{'0'}.
@item
Fixed bug in @code{myisamchk -R} mode.
@item
Fixed bug that caused @code{mysqld} to crash on @code{REVOKE}.
@item
Fixed bug in @code{ORDER BY} when there is a constant in the @code{SELECT}
statement.
@item
One didn't get an error message if @code{mysqld} couldn't open the
privilege tables.
@item
@code{SET PASSWORD FOR ...} closed the connection in case of errors (bug
from 4.0.3).
@item
Increased max possible @code{max_allowed_packet} in @code{mysqld} to 1 GB.
@item
Fixed bug when doing a multi-line @code{INSERT} on a table with an
@code{AUTO_INCREMENT} key which was not in the first part of the key.
@item
Changed @code{LOAD DATA INFILE} to not re-create index if the table had
rows from before.
@item
Fixed overrun bug when calling @code{AES_DECRYPT()} with incorrect arguments.
@item
@code{--skip-ssl} can now be used to disable SSL in the MySQL clients,
even if one is using other SSL options in an option file or previously
on the command line.
@item
Fixed bug in @code{MATCH ... AGAINST( ... IN BOOLEAN MODE)}
used with @code{ORDER BY}.
@item
Added @code{LOCK TABLES} and @code{CREATE TEMPORARY TABLES} privilege on
the database level.  One must run the @code{mysql_fix_privilege_tables}
script on old installations to activate these.
@item
In @code{SHOW TABLE ... STATUS}, compressed tables sometimes showed up as
@code{dynamic}.
@item
@code{SELECT @@@@[global|session].var_name} didn't report
@code{global | session} in the result column name.
@item
Fixed problem in replication that @code{FLUSH LOGS} in a circular
replication setup created an infinite number of binary log files.
Now a @code{rotate-binary-log} command in the binary log will not cause slaves
to rotate logs.
@item
Removed @code{STOP EVENT} from binary log when doing @code{FLUSH LOGS}.
@item
Disable the use of @code{SHOW NEW MASTER FOR SLAVE} as this needs to be
completely reworked in a future release.
@item
Fixed a bug with constant expression (for example, field of a one-row table, or field
from a table, referenced by a @code{UNIQUE} key) appeared in @code{ORDER BY}
part of @code{SELECT DISTINCT}.
@item
@code{--log-binary=a.b.c} now properly strips off @code{.b.c}.
@item
@code{FLUSH LOGS} removed numerical extension for all future update logs.
@item
@code{GRANT ... REQUIRE} didn't store the SSL information in the
@code{mysql.user} table if SSL was not enabled in the server.
@item
@code{GRANT ... REQUIRE NONE} can now be used to remove SSL information.
@item
@code{AND} is now optional between @code{REQUIRE} options.
@item
@code{REQUIRE} option was not properly saved, which could cause strange
output in @code{SHOW GRANTS}.
@item
Fixed that @code{mysqld --help} reports correct values for @code{--datadir}
and @code{--bind-address}.
@item
Fixed that one can drop UDFs that didn't exist when @code{mysqld} was started.
@item
Fixed core dump problem with @code{SHOW VARIABLES} on some 64-bit systems
(like Solaris SPARC).
@item
Fixed a bug in @code{my_getopt()}; @code{--set-variable} syntax didn't work for
those options that didn't have a valid variable in the @code{my_option} struct.
This affected at least the @code{default-table-type} option.
@item
Fixed a bug from 4.0.2 that caused @code{REPAIR TABLE} and
@code{myisamchk --recover} to fail on tables with duplicates in a unique
key.
@item
Fixed a bug from 4.0.3 in calculating the default datatype for some
functions. This affected queries of type @code{CREATE TABLE table_name
SELECT expression(),...}
@item
Fixed bug in queries of type
@code{SELECT * FROM table-list GROUP BY ...} and
@code{SELECT DISTINCT * FROM ...}.
@item
Fixed bug with the @code{--slow-log} when logging an administrator command
(like @code{FLUSH TABLES}).
@item
Fixed a bug that @code{OPTIMIZE} of locked and modified table,
reported table corruption.
@item
Fixed a bug in @code{my_getopt()} in handling of special prefixes
(@code{--skip-}, @code{--enable-}). @code{--skip-external-locking} didn't
work and the bug may have affected other similar options.
@item
Fixed bug in checking for output file name of the @code{tee} option.
@item
Added some more optimization to use index for
@code{SELECT ... FROM many_tables .. ORDER BY key limit #}
@item
Fixed problem in @code{SHOW OPEN TABLES} when a user didn't have access
permissions to one of the opened tables.
@end itemize

@node News-4.0.3, News-4.0.2, News-4.0.4, News-4.0.x
@appendixsubsec Changes in release 4.0.3 (26 Aug 2002: Beta)

@itemize @bullet
@item
Fixed problem with types of user variables. (Bug #551)
@item
Fixed problem with @code{configure ... --localstatedir=...}.
@item
Cleaned up @code{mysql.server} script.
@item
Fixed a bug in @code{mysqladmin shutdown} when pid file was modified
while @code{mysqladmin} was still waiting for the previous one to
disappear. This could happen during a very quick restart and caused
@code{mysqladmin} to hang until @code{shutdown_timeout} seconds had
passed.
@item
Don't increment warnings when setting @code{AUTO_INCREMENT} columns to
@code{NULL} in @code{LOAD DATA INFILE}.
@item
Fixed all boolean type variables/options to work with the old syntax,
for example, all of these work: @code{--lower-case-table-names},
@code{--lower-case-table-names=1},
@code{-O lower-case-table-names=1},
@code{--set-variable=lower-case-table-names=1}
@item
Fixed shutdown problem (SIGTERM signal handling) on Solaris. (Bug from 4.0.2).
@item
@code{SHOW MASTER STATUS} now returns an empty set if binary log is not
enabled.
@item
@code{SHOW SLAVE STATUS} now returns an empty set if slave is not initialized.
@item
Don't update MyISAM index file on update if not strictly necessary.
@item
Fixed bug in @code{SELECT DISTINCT ... FROM many_tables ORDER BY
not-used-column}.
@item
Fixed a bug with @code{BIGINT} values and quoted strings.
@item
Added @code{QUOTE()} function that performs SQL quoting to produce values
that can be used as data values in queries.
@item
Changed variable @code{DELAY_KEY_WRITE} to an enum to allow one set
@code{DELAY_KEY_WRITE} for all tables without taking down the server.
@item
Changed behavior of @code{IF(condition,column,NULL)} so that it returns
the value of the column type.
@item
Made @code{safe_mysqld} a symlink to @code{mysqld_safe} in binary distribution.
@item
Fixed security bug when having an empty database name in the @code{user.db}
table.
@item
Fixed some problems with @code{CREATE TABLE ... SELECT function()}.
@item
@code{mysqld} now has the option @code{--temp-pool} enabled by default as this
gives better performance with some operating systems.
@item
Fixed problem with too many allocated alarms on slave when connecting to
master many times (normally not a very critical error).
@item
Fixed hang in @code{CHANGE MASTER TO} if the slave thread died very quickly.
@item
Big cleanup in replication code (less logging, better error messages, etc..)
@item
If the @code{--code-file} option is specified, the server calls
@code{setrlimit()} to set the maximum allowed core file size to unlimited,
so core files can be generated.
@item
Fixed bug in query cache after temporary table creation.
@item
Added @code{--count=N} (@code{-c}) option to @code{mysqladmin}, to make the
program do only @code{N} iterations. To be used with @code{--sleep} (@code{-i}).
Useful in scripts.
@item
Fixed bug in multiple-table @code{UPDATE}: when updating a table,
@code{do_select()} became confused about reading records from a cache.
@item
Fixed bug in multiple-table @code{UPDATE} when several fields were referenced
from a single table
@item
Fixed bug in truncating nonexisting table.
@item
Fixed bug in @code{REVOKE} that caused user resources to be randomly set.
@item
Fixed bug in @code{GRANT} for the new @code{CREATE TEMPORARY TABLE} privilege.
@item
Fixed bug in multiple-table @code{DELETE} when tables are re-ordered in the
table initialization method and ref_lengths are of different sizes.
@item 
Fixed two bugs in @code{SELECT DISTINCT} with large tables.
@item
Fixed bug in query cache initialization with very small query cache size.
@item
Allow @code{DEFAULT} with @code{INSERT} statement.
@item
The startup parameters @code{myisam_max_sort_file_size} and
@code{myisam_max_extra_sort_file_size} are now given in bytes, not megabytes.
@item
External system locking of @code{MyISAM}/@code{ISAM} files is now turned
off by default.  One can turn this on with @code{--external-locking}.
(For most users this is never needed).
@item
Fixed core dump bug with @code{INSERT ... SET db_name.table_name.colname=''}.
@item
Fixed client hangup bug when using some SQL commands with incorrect syntax.
@item
Fixed a timing bug in @code{DROP DATABASE}
@item
New @code{SET [GLOBAL | SESSION]} syntax to change thread-specific and global
server variables at runtime.
@item
Added variable @code{slave_compressed_protocol}.
@item
Renamed variable @code{query_cache_startup_type} to @code{query_cache_type},
@code{myisam_bulk_insert_tree_size} to @code{bulk_insert_buffer_size},
@code{record_buffer} to @code{read_buffer_size} and
@code{record_rnd_buffer} to @code{read_rnd_buffer_size}.
@item
Renamed some SQL variables, but old names will still work until 5.0.
@xref{Upgrading-from-3.23}.
@item
Renamed @code{--skip-locking} to @code{--skip-external-locking}.
@item
Removed unused variable @code{query_buffer_size}.
@item
Fixed a bug that made the pager option in the @code{mysql} client
non-functional.
@item
Added full @code{AUTO_INCREMENT} support to @code{MERGE} tables.
@item
Extended @code{LOG()} function to accept an optional arbitrary base
parameter.
@xref{Mathematical functions}.
@item
Added @code{LOG2()} function (useful for finding out how many bits
a number would require for storage).
@item
Added @code{LN()} natural logarithm function for compatibility with
other databases. It is synonymous with @code{LOG(X)}.
@end itemize


@node News-4.0.2, News-4.0.1, News-4.0.3, News-4.0.x
@appendixsubsec Changes in release 4.0.2 (01 Jul 2002)

@itemize @bullet
@item
Cleaned up @code{NULL} handling for default values in @code{DESCRIBE
table_name}.
@item
Fixed @code{truncate()} to round up negative values to the nearest integer.
@item
Changed @code{--chroot=path} option to execute @code{chroot()} immediately
after all options have been parsed.
@item
Don't allow database names that contain @samp{\}.
@item
@code{lower_case_table_names} now also affects database names.
@item
Added @code{XOR} operator (logical and bitwise @code{XOR}) with @code{^}
as a synonym for bitwise @code{XOR}.
@item
Added function @code{IS_FREE_LOCK("lock_name")}.
Based on code contributed by Hartmut Holzgraefe @email{hartmut@@six.de}.
@item
Removed @code{mysql_ssl_clear()} from C API, as it was not needed.
@item
@code{DECIMAL} and @code{NUMERIC} types can now read exponential numbers.
@item
Added @code{SHA1()} function to calculate 160 bit hash value as described
in RFC 3174 (Secure Hash Algorithm). This function can be considered a
cryptographically more secure equivalent of @code{MD5()}.
@xref{Encryption functions}.
@item
Added @code{AES_ENCRYPT()} and @code{AES_DECRYPT()} functions to perform
encryption according to AES standard (Rijndael).
@xref{Encryption functions}.
@item
Added @code{--single-transaction} option to @code{mysqldump}, allowing a
consistent dump of @code{InnoDB} tables.
@xref{mysqldump}.
@item
Fixed bug in @code{innodb_log_group_home_dir} in @code{SHOW VARIABLES}.
@item
Fixed a bug in optimizer with merge tables when non-unique values are 
used in summing up (causing crashes).
@item
Fixed a bug in optimizer when a range specified makes index grouping
impossible (causing crashes).
@item
Fixed a rare bug when @code{FULLTEXT} index is present and no tables are used.
@item
Added privileges @code{CREATE TEMPORARY TABLES}, @code{EXECUTE},
@code{LOCK TABLES}, @code{REPLICATION CLIENT}, @code{REPLICATION SLAVE},
@code{SHOW DATABASES} and @code{SUPER}. To use these, you must have
run the @code{mysql_fix_privilege_tables} script after upgrading.
@item
Fixed query cache align data bug.
@item
Fixed mutex bug in replication when reading from master fails.
@item
Added missing mutex in @code{TRUNCATE TABLE};  This fixes some core
dump/hangup problems when using @code{TRUNCATE TABLE}.
@item
Fixed bug in multiple-table @code{DELETE} when optimizer uses only indexes.
@item
Fixed that @code{ALTER TABLE table_name RENAME new_table_name} is as fast
as @code{RENAME TABLE}.
@item
Fixed bug in @code{GROUP BY} with two or more fields, where at least one
field can contain @code{NULL} values.
@item
Use @code{Turbo Boyer-Moore} algorithm to speed up @code{LIKE "%keyword%"}
searches.
@item
Fixed bug in @code{DROP DATABASE} with symlink.
@item
Fixed crash in @code{REPAIR ... USE_FRM}.
@item
Fixed bug in @code{EXPLAIN} with @code{LIMIT offset != 0}.
@item
Fixed bug in phrase operator @code{"..."} in boolean full-text search.
@item
Fixed bug that caused duplicated rows when using truncation operator
@code{*} in boolean full-text search.
@item
Fixed bug in truncation operator of boolean full-text search (incorrect results
when there are only @code{+word*}s in the query).
@item
Fixed bug in boolean full-text search that caused a crash when an identical
@code{MATCH} expression that did not use an index appeared twice.
@item
Query cache is now automatically disabled in @code{mysqldump}.
@item
Fixed problem on Windows 98 that made sending of results very slow.
@item
Boolean full-text search weighting scheme changed to something more reasonable.
@item
Fixed bug in boolean full-text search that caused MySQL to ignore queries of
@code{ft_min_word_len} characters.
@item
Boolean full-text search now supports ``phrase searches''.
@item
New configure option @code{--without-query-cache}. 
@item
Memory allocation strategy for ``root memory'' changed. Block size now grows 
with number of allocated blocks.
@item
@code{INET_NTOA()} now returns @code{NULL} if you give it an argument that
is too large (greater than the value corresponding to @code{255.255.255.255}).
@item
Fix @code{SQL_CALC_FOUND_ROWS} to work with @code{UNION}. It will work only
if the first @code{SELECT} has this option and if there is global @code{LIMIT}
for the entire statement. For the moment, this requires using parentheses for
individual @code{SELECT} queries within the statement.
@item
Fixed bug in @code{SQL_CALC_FOUND_ROWS} and @code{LIMIT}.
@item
Don't give an error for @code{CREATE TABLE ...(... VARCHAR(0))}.
@item
Fixed @code{SIGINT} and @code{SIGQUIT} problems in @file{mysql.cc} on Linux
with some @code{glibc} versions.
@item
Fixed bug in @file{convert.cc}, which is caused by having an incorrect
@code{net_store_length()} linked in the @code{CONVERT::store()} method.
@item
@code{DOUBLE} and @code{FLOAT} columns now honor the @code{UNSIGNED} flag
on storage.
@item
@code{InnoDB} now retains foreign key constraints through @code{ALTER TABLE}
and @code{CREATE/DROP INDEX}.
@item
@code{InnoDB} now allows foreign key constraints to be added through the
@code{ALTER TABLE} syntax.
@item
@code{InnoDB} tables can now be set to automatically grow in size (autoextend).
@item
Added @code{--ignore-lines=n} option to @code{mysqlimport}.  This has the
same effect as the @code{IGNORE n LINES} clause for @code{LOAD DATA}.
@item
Fixed bug in @code{UNION} with last offset being transposed to total result
set.
@item
@code{REPAIR ... USE_FRM} added.
@item
Fixed that @code{DEFAULT_SELECT_LIMIT} is always imposed on @code{UNION}
result set.
@item
Fixed that some @code{SELECT} options can appear only in the first
@code{SELECT}.
@item
Fixed bug with @code{LIMIT} with @code{UNION}, where last select is in
the braces.
@item
Fixed that full-text works fine with @code{UNION} operations.
@item
Fixed bug with indexless boolean full-text search.
@item
Fixed bug that sometimes appeared when full-text search was used
with @code{const} tables.
@item
Fixed incorrect error value when doing a @code{SELECT} with an empty
@code{HEAP} table.
@item
Use @code{ORDER BY column DESC} now sorts @code{NULL} values first.
(In other words, @code{NULL} values sort first in all cases, whether or
not @code{DESC} is specified.)  This is changed back in 4.0.10.
@item
Fixed bug in @code{WHERE key_name='constant' ORDER BY key_name DESC}.
@item
Fixed bug in @code{SELECT DISTINCT ... ORDER BY DESC} optimization.
@item
Fixed bug in @code{... HAVING 'GROUP_FUNCTION'(xxx) IS [NOT] NULL}.
@item
Fixed bug in truncation operator for boolean full-text search.
@item
Allow value of @code{--user=#} option for @code{mysqld} to be specified
as a numeric user ID.
@item
Fixed a bug where @code{SQL_CALC_ROWS} returned an incorrect value when used
with one table and @code{ORDER BY} and with @code{InnoDB} tables.
@item
Fixed that @code{SELECT 0 LIMIT 0} doesn't hang thread.
@item
Fixed some problems with @code{USE/IGNORE INDEX} when using
many keys with the same start column.
@item
Don't use table scan with @code{BerkeleyDB} and @code{InnoDB} tables when
we can use an index that covers the whole row.
@item
Optimized @code{InnoDB} sort-buffer handling to take less memory.
@item
Fixed bug in multiple-table @code{DELETE} and @code{InnoDB} tables.
@item
Fixed problem with @code{TRUNCATE} and @code{InnoDB} tables that produced the
error @code{Can't execute the given command because you have active locked
tables or an active transaction}.
@item
Added @code{NO_UNSIGNED_SUBTRACTION} to the set of flags that may be
specified with the @code{--sql-mode} option for @code{mysqld}.  It disables
unsigned arithmetic rules when it comes to subtraction. (This will make
MySQL 4.0 behave more like 3.23 with @code{UNSIGNED} columns).
@item
The result returned for all bit functions (@code{|}, @code{<<}, ...) is now of
type @code{unsigned integer}.
@item
Added detection of @code{nan} values in @code{MyISAM} to make it possible to
repair tables with @code{nan} in float or double columns.
@item
Fixed new bug in @code{myisamchk} where it didn't correctly update number of
``parts'' in the @code{MyISAM} index file.
@item
Changed to use @code{autoconf} 2.52 (from @code{autoconf} 2.13).
@item
Fixed optimization problem where the MySQL Server was in ``preparing'' state
for a long time when selecting from an empty table which had contained
a lot of rows.
@item
Fixed bug in complicated join with @code{const} tables. This fix also
improves performance a bit when referring to another table from a
@code{const} table.
@item
First pre-version of multiple-table @code{UPDATE} statement.
@item
Fixed bug in multiple-table @code{DELETE}.
@item
Fixed bug in @code{SELECT CONCAT(argument_list) ... GROUP BY 1}.
@item
@code{INSERT ... SELECT} did a full rollback in case of an error. Fixed
so that we only roll back the last statement in the current transaction.
@item
Fixed bug with empty expression for boolean full-text search.
@item
Fixed core dump bug in updating full-text key from/to @code{NULL}.
@item
ODBC compatibility: Added @code{BIT_LENGTH()} function.
@item
Fixed core dump bug in @code{GROUP BY BINARY column}.
@item
Added support for @code{NULL} keys in @code{HEAP} tables.
@item
Use index for @code{ORDER BY} in queries of type:
@code{SELECT * FROM t WHERE key_part1=1 ORDER BY key_part1 DESC,key_part2 DESC}
@item
Fixed bug in @code{FLUSH QUERY CACHE}.
@item
Added @code{CAST()} and @code{CONVERT()} functions. The @code{CAST} and
@code{CONVERT} functions are nearly identical and mainly useful when you
want to create a column with a specific type in a @code{CREATE ... SELECT}
statement.  For more information, read @ref{Cast Functions}.
@item
@code{CREATE ... SELECT} on @code{DATE} and @code{TIME} functions now
create columns of the expected type.
@item
Changed order in which keys are created in tables.
@item
Added new columns @code{Null} and @code{Index_type} to @code{SHOW INDEX}
output.
@item
Added @code{--no-beep} and @code{--prompt} options to @code{mysql} command-line client.
@item
New feature: management of user resources.
@example
GRANT ... WITH MAX_QUERIES_PER_HOUR N1
               MAX_UPDATES_PER_HOUR N2
               MAX_CONNECTIONS_PER_HOUR N3;
@end example
@xref{User resources}.

@item
Added @code{mysql_secure_installation} to the @file{scripts/} directory.
@end itemize


@node News-4.0.1, News-4.0.0, News-4.0.2, News-4.0.x
@appendixsubsec Changes in release 4.0.1 (23 Dec 2001)

@itemize @bullet
@item
Added @code{system} command to @code{mysql}.
@item
Fixed bug when @code{HANDLER} was used with some unsupported table type.
@item
@code{mysqldump} now puts @code{ALTER TABLE tbl_name DISABLE KEYS} and
@code{ALTER TABLE tbl_name ENABLE KEYS} in the sql dump.
@item
Added @code{mysql_fix_extensions} script.
@item
Fixed stack overrun problem with @code{LOAD DATA FROM MASTER} on OSF/1.
@item
Fixed shutdown problem on HP-UX.
@item
Added @code{DES_ENCRYPT()} and @code{DES_DECRYPT()} functions.
@item
Added @code{FLUSH DES_KEY_FILE} statement.
@item
Added @code{--des-key-file} option to @code{mysqld}.
@item
@code{HEX(string)} now returns the characters in @code{string} converted to
hexadecimal.
@item
Fixed problem with @code{GRANT} when using @code{lower_case_table_names=1}.
@item
Changed @code{SELECT ... IN SHARE MODE} to
@code{SELECT ... LOCK IN SHARE MODE} (as in MySQL 3.23).
@item
A new query cache to cache results from identical @code{SELECT} queries.
@item
Fixed core dump bug on 64-bit machines when it got an incorrect communication
packet.
@item
@code{MATCH ... AGAINST(... IN BOOLEAN MODE)} can now work
without @code{FULLTEXT} index.
@item
Fixed slave to replicate from 3.23 master.
@item
Miscellaneous replication fixes/cleanup.
@item
Got shutdown to work on Mac OS X.
@item
Added @code{myisam/ft_dump} utility for low-level inspection
of @code{FULLTEXT} indexes.
@item
Fixed bug in @code{DELETE ... WHERE ... MATCH ...}.
@item
Added support for @code{MATCH ... AGAINST(... IN BOOLEAN MODE)}.
@strong{Note: You must rebuild your tables with
@code{ALTER TABLE tablename TYPE=MyISAM} to be
able to use boolean full-text search}.
@item
@code{LOCATE()} and @code{INSTR()} are now case sensitive if either
argument is a binary string.
@item
Changed @code{RAND()} initialization so that @code{RAND(N)} and
@code{RAND(N+1)} are more distinct.
@item
Fixed core dump bug in @code{UPDATE ... ORDER BY}.
@item
In 3.23, @code{INSERT INTO ... SELECT} always had @code{IGNORE} enabled.
Now MySQL will stop (and possibly roll back) by default in case of an error
unless you specify @code{IGNORE}.
@item
Ignore @code{DATA DIRECTORY} and @code{INDEX DIRECTORY} directives on Windows.
@item
Added boolean full-text search code. It should be considered early alpha.
@item
Extended @code{MODIFY} and @code{CHANGE} in @code{ALTER TABLE} to accept
the @code{FIRST} and @code{AFTER} keywords.
@item
Indexes are now used with @code{ORDER BY} on a whole @code{InnoDB} table.
@end itemize


@node News-4.0.0,  , News-4.0.1, News-4.0.x
@appendixsubsec Changes in release 4.0.0 (Oct 2001: Alpha)

@itemize @bullet
@item
Added @code{--xml} option to @code{mysql} for producing XML output.
@item
Added full-text variables @code{ft_min_word_len}, @code{ft_max_word_len}, and
@code{ft_max_word_len_for_sort}.
@item
Added documentation for @code{libmysqld}, the embedded MySQL server
library.  Also added example programs (a @code{mysql} client and
@code{mysqltest} test program) which use @code{libmysqld}.
@item
Removed all Gemini hooks from MySQL server.
@item
Removed @code{my_thread_init()} and @code{my_thread_end()}
from @file{mysql_com.h}, and added @code{mysql_thread_init()} and
@code{mysql_thread_end()} to @file{mysql.h}.
@item
Support for communication packets > 16M.  In 4.0.1 we will extend
@code{MyISAM} to be able to handle these.
@item
Secure connections (with SSL).
@item
Unsigned @code{BIGINT} constants now work. @code{MIN()} and @code{MAX()}
now handle signed and unsigned @code{BIGINT} numbers correctly.
@item
New character set @code{latin1_de} which provides correct German sorting.
@item
@code{STRCMP()} now uses the current character set when doing comparisons,
which means that the default comparison behavior now is case insensitive.
@item
@code{TRUNCATE TABLE} and @code{DELETE FROM tbl_name} are now separate
functions. One bonus is that @code{DELETE FROM tbl_name} now returns
the number of deleted rows, rather than zero.
@item
@code{DROP DATABASE} now executes a @code{DROP TABLE} on all tables in
the database, which fixes a problem with @code{InnoDB} tables.
@item
Added support for @code{UNION}.
@item
Added support for multiple-table @code{DELETE} operations.
@item
A new @code{HANDLER} interface to @code{MyISAM} tables.
@item
Added support for @code{INSERT} on @code{MERGE} tables. Patch from
Benjamin Pflugmann.
@item
Changed @code{WEEK(date,0)} to match the calendar in the USA.
@item
@code{COUNT(DISTINCT)} is about 30% faster.
@item
Speed up all internal list handling.
@item
Speed up @code{IS NULL}, @code{ISNULL()} and some other internal primitives.
@item
Full-text index creation now is much faster.
@item
Tree-like cache to speed up bulk inserts and
@code{myisam_bulk_insert_tree_size} variable.
@item
Searching on packed (@code{CHAR}/@code{VARCHAR}) keys is now much faster.
@item
Optimized queries of type:
@code{SELECT DISTINCT * from tbl_name ORDER by key_part1 LIMIT row_count}.
@item
@code{SHOW CREATE TABLE} now shows all table attributes.
@item
@code{ORDER BY ... DESC} can now use keys.
@item
@code{LOAD DATA FROM MASTER} ``automatically'' sets up a slave.
@item
Renamed @code{safe_mysqld} to @code{mysqld_safe} to make this name more
in line with other MySQL scripts/commands.
@item
Added support for symbolic links to @code{MyISAM} tables. Symlink handling is
now enabled by default for Windows.
@item
Added @code{SQL_CALC_FOUND_ROWS} and @code{FOUND_ROWS()}. This makes it
possible to know how many rows a query would have returned
without a @code{LIMIT} clause.
@item
Changed output format of @code{SHOW OPEN TABLES}.
@item
Allow @code{SELECT expression LIMIT ...}.
@c commented out IDENTITY until someone explains what it means
@c @item
@c Added @code{IDENTITY} as a synonym for @code{AUTO_INCREMENT} (like Sybase).
@item
Added @code{ORDER BY} syntax to @code{UPDATE} and @code{DELETE}.
@item
@code{SHOW INDEXES} is now a synonym for @code{SHOW INDEX}.
@item
Added @code{ALTER TABLE tbl_name DISABLE KEYS} and
@code{ALTER TABLE tbl_name ENABLE KEYS} commands.
@item
Allow use of @code{IN} as a synonym for @code{FROM} in @code{SHOW} commands.
@item
Implemented ``repair by sort'' for @code{FULLTEXT} indexes.
@code{REPAIR TABLE}, @code{ALTER TABLE}, and @code{OPTIMIZE TABLE}
for tables with @code{FULLTEXT} indexes are now up to 100 times faster.
@item
Allow SQL-99 syntax @code{X'hexadecimal-number'}.
@item
Cleaned up global lock handling for @code{FLUSH TABLES WITH READ LOCK}.
@item
Fixed problem with @code{DATETIME = constant} in @code{WHERE} optimization.
@item
Added @code{--master-data} and @code{--no-autocommit} options to
@code{mysqldump}. (Thanks to Brian Aker for this.)
@item
Added script @code{mysql_explain_log.sh} to distribution.
(Thanks to mobile.de).
@end itemize


@node News-3.23.x, News-3.22.x, News-4.0.x, News
@appendixsec Changes in release 3.23.x (Recent; still supported)

@cindex changes, version 3.23

Please note that since release 4.0 is now production level, only critical
fixes are done in the 3.23 release series. You are recommended to upgrade
when possible, to take advantage of all speed and feature improvements in
4.0. @xref{Upgrading-from-3.23}.

The 3.23 release has several major features that are not
present in previous versions.  We have added three new
table types:

@table @asis
@item @code{MyISAM}
A new ISAM library which is tuned for SQL and supports large files.
@item @code{InnoDB}
A transaction-safe storage engine that supports row level locking, and many
Oracle-like features.
@item @code{BerkeleyDB} or @code{BDB}
Uses the Berkeley DB library from Sleepycat Software to implement
transaction-safe tables.
@end table

Note that only @code{MyISAM} is available in the standard binary distribution.

The 3.23 release also includes support for database replication between
a master and many slaves, full-text indexing, and much more.

All new features are being developed in the 4.x version.  Only
bug fixes and minor enhancements to existing features will be
added to 3.23.

The replication code and BerkeleyDB code is still not as tested and as
the rest of the code, so we will probably need to do a couple of future
releases of 3.23 with small fixes for this part of the code. As long as
you don't use these features, you should be quite safe with
MySQL 3.23!

Note that the above doesn't mean that replication or Berkeley DB don't
work.  We have done a lot of testing of all code, including replication
and @code{BDB} without finding any problems.  It only means that not as many
users use this code as the rest of the code and because of this we are
not yet 100% confident in this code.

@menu
* News-3.23.59::                Changes in release 3.23.59 (not released yet)
* News-3.23.58::                Changes in release 3.23.58 (11 Sep 2003)
* News-3.23.57::                Changes in release 3.23.57 (06 Jun 2003)
* News-3.23.56::                Changes in release 3.23.56 (13 Mar 2003)
* News-3.23.55::                Changes in release 3.23.55 (23 Jan 2003)
* News-3.23.54::                Changes in release 3.23.54 (05 Dec 2002)
* News-3.23.53::                Changes in release 3.23.53 (09 Oct 2002)
* News-3.23.52::                Changes in release 3.23.52 (14 Aug 2002)
* News-3.23.51::                Changes in release 3.23.51 (31 May 2002)
* News-3.23.50::                Changes in release 3.23.50 (21 Apr 2002)
* News-3.23.49::                Changes in release 3.23.49
* News-3.23.48::                Changes in release 3.23.48 (07 Feb 2002)
* News-3.23.47::                Changes in release 3.23.47 (27 Dec 2001)
* News-3.23.46::                Changes in release 3.23.46 (29 Nov 2001)
* News-3.23.45::                Changes in release 3.23.45 (22 Nov 2001)
* News-3.23.44::                Changes in release 3.23.44 (31 Oct 2001)
* News-3.23.43::                Changes in release 3.23.43 (04 Oct 2001)
* News-3.23.42::                Changes in release 3.23.42 (08 Sep 2001)
* News-3.23.41::                Changes in release 3.23.41 (11 Aug 2001)
* News-3.23.40::                Changes in release 3.23.40
* News-3.23.39::                Changes in release 3.23.39 (12 Jun 2001)
* News-3.23.38::                Changes in release 3.23.38 (09 May 2001)
* News-3.23.37::                Changes in release 3.23.37 (17 Apr 2001)
* News-3.23.36::                Changes in release 3.23.36 (27 Mar 2001)
* News-3.23.35::                Changes in release 3.23.35 (15 Mar 2001)
* News-3.23.34a::               Changes in release 3.23.34a
* News-3.23.34::                Changes in release 3.23.34 (10 Mar 2001)
* News-3.23.33::                Changes in release 3.23.33 (09 Feb 2001)
* News-3.23.32::                Changes in release 3.23.32 (22 Jan 2001: Production)
* News-3.23.31::                Changes in release 3.23.31 (17 Jan 2001)
* News-3.23.30::                Changes in release 3.23.30 (04 Jan 2001)
* News-3.23.29::                Changes in release 3.23.29 (16 Dec 2000)
* News-3.23.28::                Changes in release 3.23.28 (22 Nov 2000: Gamma)
* News-3.23.27::                Changes in release 3.23.27 (24 Oct 2000)
* News-3.23.26::                Changes in release 3.23.26 (18 Oct 2000)
* News-3.23.25::                Changes in release 3.23.25 (29 Sep 2000)
* News-3.23.24::                Changes in release 3.23.24 (08 Sep 2000)
* News-3.23.23::                Changes in release 3.23.23 (01 Sep 2000)
* News-3.23.22::                Changes in release 3.23.22 (31 Jul 2000)
* News-3.23.21::                Changes in release 3.23.21
* News-3.23.20::                Changes in release 3.23.20
* News-3.23.19::                Changes in release 3.23.19
* News-3.23.18::                Changes in release 3.23.18
* News-3.23.17::                Changes in release 3.23.17
* News-3.23.16::                Changes in release 3.23.16
* News-3.23.15::                Changes in release 3.23.15 (May 2000: Beta)
* News-3.23.14::                Changes in release 3.23.14
* News-3.23.13::                Changes in release 3.23.13
* News-3.23.12::                Changes in release 3.23.12 (07 Mar 2000)
* News-3.23.11::                Changes in release 3.23.11
* News-3.23.10::                Changes in release 3.23.10
* News-3.23.9::                 Changes in release 3.23.9
* News-3.23.8::                 Changes in release 3.23.8 (02 Jan 2000)
* News-3.23.7::                 Changes in release 3.23.7 (10 Dec 1999)
* News-3.23.6::                 Changes in release 3.23.6
* News-3.23.5::                 Changes in release 3.23.5 (20 Oct 1999)
* News-3.23.4::                 Changes in release 3.23.4 (28 Sep 1999)
* News-3.23.3::                 Changes in release 3.23.3
* News-3.23.2::                 Changes in release 3.23.2 (09 Aug 1999)
* News-3.23.1::                 Changes in release 3.23.1
* News-3.23.0::                 Changes in release 3.23.0 (05 Aug 1999: Alpha)
@end menu

@node News-3.23.59, News-3.23.58, News-3.23.x, News-3.23.x
@appendixsubsec Changes in release 3.23.59 (not released yet)

@c NOTE: References to bug numbers should be written after the sentence
@c NOTE: describing the bugfix, like this:
@c NOTE: This sentence describes the fix. (Bug #nnnn)

@itemize @bullet
@item
Fixed bug in @code{ACOS()}, @code{ASIN()}. (Bug #2338)
The cause of the problem is an overly strong optimization done by @code{gcc}
in this case.
@item
Fixed bug in @code{INSERT ... SELECT} statements where, if a @code{NOT NULL}
column is assigned a value of @code{NULL}, the following columns in the row
might be assigned a value of zero.  (Bug #2012)
@item
If a query was ignored on the slave (because of
@code{replicate-ignore-table} and other similar rules), the slave
still checked if the query got the same error code (0, no error) as on
the master. So if the master had an error on the query (for example,
``Duplicate entry'' in a multiple-row insert), then the slave stopped
and warned that the error codes didn't match. This is a backport of the
fix for MySQL 4.0. (Bug #797)
@item
@code{mysqlbinlog} now asks for a password at console when the
@code{-p/--password} option is used with no argument. This is how the
other clients (@code{mysqladmin}, @code{mysqldump}..) already
behave. Note that one now has to use @code{mysqlbinlog -p<my_password>};
@code{mysqlbinlog -p <my_password>} will not work anymore (in other
words, put no space after @code{-p}). (Bug #1595)
@item
On some 64-bit machines (some HP-UX and Solaris machines), a slave
installed with the 64-bit MySQL binary could not connect to its master
(it connected to itself instead). (Bug #1256, #1381)
@item
Fixed a Windows-specific bug present since MySQL version 3.23.57 and
3.23.58, which caused Windows slaves to crash when they started
replication if a @file{master.info} file existed. (Bug #1720)
@item
Fixed bug in @code{ALTER TABLE RENAME}, when rename to the table with
the same name in another database silently dropped destination table if
it existed. (Bug #2628)
@end itemize

@node News-3.23.58, News-3.23.57, News-3.23.59, News-3.23.x
@appendixsubsec Changes in release 3.23.58 (11 Sep 2003)

@itemize @bullet
@item
Fixed buffer overflow in password handling which could potentially be
exploited by MySQL users with @code{ALTER} privilege on the
@code{mysql.user} table to execute random code or to gain shell access with
the UID of the mysqld process (thanks to Jedi/Sector One for spotting and
reporting this bug).
@item
@code{mysqldump} now correctly quotes all identifiers when communicating
with the server. This assures that during the dump process, @code{mysqldump}
will never send queries to the server that result in a syntax error. This
problem is @strong{not} related to the @code{mysqldump} program's output,
which was not changed. (Bug #1148)
@item
Fixed table/column grant handling - proper sort order (from most specific
to less specific, @pxref{Request access}) was not honored. (Bug #928)
@item
Fixed overflow bug in @code{MyISAM} and @code{ISAM} when a row is updated
in a table with a large number of columns and at least one @code{BLOB/TEXT}
column.
@item
Fixed MySQL so that field length (in C API) for the second column in
@code{SHOW CREATE TABLE} is always larger than the data length.
The only known application that was affected by the old behavior was
Borland dbExpress, which truncated the output from the command.
(Bug #1064)
@item
Fixed @code{ISAM} bug in @code{MAX()} optimization.
@item
Fixed @code{Unknown error} when doing @code{ORDER BY} on reference table which
was used with @code{NULL} value on @code{NOT NULL} column. (Bug #479)
@end itemize

@node News-3.23.57, News-3.23.56, News-3.23.58, News-3.23.x
@appendixsubsec Changes in release 3.23.57 (06 Jun 2003)

@itemize @bullet
@item
Fixed problem in alarm handling that could cause problems when getting a
packet that is too large.
@item
Fixed problem when installing MySQL as a service on Windows when one
gave two arguments (option file group name and service name) to @code{mysqld}.
@item
Fixed @code{kill pid-of-mysqld} to work on Mac OS X.
@item
@code{SHOW TABLE STATUS} displayed incorrect @code{Row_format} value for
tables that have been compressed with @code{myisampack}.
(Bug #427)
@item
@code{SHOW VARIABLES LIKE 'innodb_data_file_path'} displayed only the
name of the first datafile. (Bug #468)
@item
Fixed security problem where @code{mysqld} didn't allow one to @code{UPDATE}
rows in a table even if one had a global @code{UPDATE} privilege and a
database @code{SELECT} privilege.
@item
Fixed a security problem with @code{SELECT} and wildcarded select list,
when user only had partial column @code{SELECT} privileges on the table.
@item
Fixed unlikely problem in optimizing @code{WHERE} clause with a constant
expression such as in @code{WHERE 1 AND (a=1 AND b=1)}.
@item
Fixed problem on IA-64 with timestamps that caused @code{mysqlbinlog} to fail.
@item
The default option for @code{innodb_flush_log_at_trx_commit} was changed
from 0 to 1 to make @code{InnoDB} tables ACID by default.
@xref{InnoDB start, , @code{InnoDB} start}.
@item
Fixed problem with too many allocated alarms on slave when connecting to
master many times (normally not a very critical error).
@item
Fixed a bug in replication of temporary tables. (Bug #183)
@item
Fixed 64-bit bug that affected at least AMD hammer systems.
@item
Fixed a bug when doing @code{LOAD DATA INFILE IGNORE}: When reading
the binary log, @code{mysqlbinlog} and the replication code read @code{REPLACE}
instead of @code{IGNORE}. This could make the slave's table
become different from the master's table. (Bug #218)
@item
Fixed overflow bug in @code{MyISAM} when a row is inserted into a table with a 
large number of columns and at least one @code{BLOB/TEXT} column. Bug was caused
by incorrect calculation of the needed buffer to pack data.
@item
The binary log was not locked during @code{TRUNCATE table_name} or
@code{DELETE FROM table_name} statements, which could cause an @code{INSERT} to
@code{table_name} to be written to the log before the
@code{TRUNCATE} or @code{DELETE} statements.
@item
Fixed rare bug in @code{UPDATE} of @code{InnoDB} tables where one row could be
updated multiple times.
@item
Produce an error for empty table and column names.
@item
Changed @code{PROCEDURE ANALYSE()} to report @code{DATE} instead of
@code{NEWDATE}.
@item
Changed @code{PROCEDURE ANALYSE(#)} to restrict the number of values in an
@code{ENUM} column to @code{#} also for string values.
@item
@code{mysqldump} no longer silently deletes the binary logs when invoked with
the @code{--master-data} or @code{--first-slave} option;
while this behavior was convenient for some
users, others may suffer from it. Now one has to explicitly ask for binary
logs to be deleted by using the new @code{--delete-master-logs} option.
@item
Fixed a bug in @code{mysqldump} when it was invoked with the
@code{--master-data} option: The @code{CHANGE MASTER TO} statements that were
appended to the SQL dump had incorrect coordinates. (Bug #159)
@end itemize

@node News-3.23.56, News-3.23.55, News-3.23.57, News-3.23.x
@appendixsubsec Changes in release 3.23.56 (13 Mar 2003)
@itemize @bullet
@item
Fixed @code{mysqld} crash on extremely small values of
@code{sort_buffer} variable.
@item
Fixed a bug in privilege system for @code{GRANT UPDATE} on the column level.
@item
Fixed a rare bug when using a date in @code{HAVING} with @code{GROUP BY}.
@item
Fixed checking of random part of @code{WHERE} clause. (Bug #142)
@item
Fixed MySQL (and @code{myisamchk}) crash on artificially
corrupted @file{.MYI} files.
@item
Security enhancement:
@code{mysqld} no longer reads options from world-writable config files.
@item
Security enhancement:
@code{mysqld} and @code{safe_mysqld} now use only the first @code{--user}
option specified on the command line. (Normally this comes from
@file{/etc/my.cnf})
@item
Security enhancement:
Don't allow @code{BACKUP TABLE} to overwrite existing files.
@item
Fixed unlikely deadlock bug when one thread did a @code{LOCK TABLE} and
another thread did a @code{DROP TABLE}.  In this case one could do
a @code{KILL} on one of the threads to resolve the deadlock.
@item
@code{LOAD DATA INFILE} was not replicated by slave if
@code{replicate_*_table} was set on the slave.
@item
Fixed a bug in handling @code{CHAR(0)} columns that could cause incorrect
results from the query.
@item
Fixed a bug in @code{SHOW VARIABLES} on 64-bit platforms. The bug was
caused by incorrect declaration of variable @code{server_id}.
@item
The Comment column in @code{SHOW TABLE STATUS} now reports that it can
contain @code{NULL} values (which is the case for a crashed @file{.frm} file).
@item
Fixed the @code{rpl_rotate_logs} test to not fail on certain platforms (e.g.
Mac OS X) due to a too long file name (changed @code{slave-master-info.opt}
to @code{.slave-mi}).
@item
Fixed a problem with @code{BLOB NOT NULL} columns used with @code{IS NULL}.
@item
Fixed bug in @code{MAX()} optimization in @code{MERGE} tables.
@item
Better @code{RAND()} initialization for new connections.
@item
Fixed bug with connect timeout. This bug was manifested on OS's with 
@code{poll()} system call, which resulted in timeout the value specified as
it was executed in both @code{select()} and @code{poll()}.
@item
Fixed bug in
@code{SELECT * FROM table WHERE datetime1 IS NULL OR datetime2 IS NULL}.
@item
Fixed bug in using aggregate functions as argument for @code{INTERVAL},
@code{CASE}, @code{FIELD}, @code{CONCAT_WS}, @code{ELT} and
@code{MAKE_SET} functions.
@item
When running with @code{--lower-case-table-names=1} (default on Windows)
and you had tables or databases with mixed case on disk, then
executing @code{SHOW TABLE STATUS} followed with @code{DROP DATABASE}
or @code{DROP TABLE} could fail with @code{Errcode 13}.
@item
Fixed bug in logging to binary log (which affects replication) a query
that inserts a @code{NULL} in an @code{auto_increment} field and also
uses @code{LAST_INSERT_ID()}.
@item
Fixed bug in @code{mysqladmin --relative}.
@item
On some 64-bit systems, @code{show status} reported a strange number for
@code{Open_files} and @code{Open_streams}.
@end itemize

@node News-3.23.55, News-3.23.54, News-3.23.56, News-3.23.x
@appendixsubsec Changes in release 3.23.55 (23 Jan 2003)
@itemize @bullet
@item
Fixed double @code{free}'d pointer bug in @code{mysql_change_user()}
handling, that enabled a specially hacked version of MySQL client
to crash @code{mysqld}. @strong{Note}, that you must log in to the server
by using a valid user account to be able to exploit this bug.
@item
Fixed bug with the @code{--slow-log} when logging an administrator command
(like @code{FLUSH TABLES}).
@item
Fixed bug in @code{GROUP BY} when used on BLOB column with @code{NULL} values.
@item
Fixed a bug in handling @code{NULL} values in @code{CASE ... WHEN ...}.
@item
Bugfix for @code{--chroot} (@pxref{News-3.23.54, @code{--chroot}})
is reverted. Unfortunately, there is no way to make it to work, without
introducing backward-incompatible changes in @file{my.cnf}.
Those who need @code{--chroot} functionality, should upgrade to MySQL 4.0.
(The fix in the 4.0 branch did not break backward-compatibility).
@item
Make @code{--lower-case-table-names} default on Mac OS X as the default
file system (HFS+) is case insensitive.
@item
Fixed a bug in @file{scripts/mysqld_safe.sh} in @code{NOHUP_NICENESS}
testing.
@item
Transactions in @code{AUTOCOMMIT=0} mode didn't rotate binary log.
@item
Fixed a bug in @code{scripts/make_binary_distribution} that resulted in
a remaining @code{@@HOSTNAME@@} variable instead of replacing it with the
correct path to the @code{hostname} binary.
@item
Fixed a very unlikely bug that could cause @code{SHOW PROCESSLIST} to core
dump in pthread_mutex_unlock() if a new thread was connecting.
@item
Forbid @code{SLAVE STOP} if the thread executing the query has locked
tables.  This removes a possible deadlock situation.
@end itemize

@node News-3.23.54, News-3.23.53, News-3.23.55, News-3.23.x
@appendixsubsec Changes in release 3.23.54 (05 Dec 2002)
@itemize @bullet
@item
Fixed a bug, that allowed to crash @code{mysqld}
with a specially crafted packet.
@item
Fixed a rare crash (double @code{free}'d pointer) when altering a
temporary table.
@item
Fixed buffer overrun in @code{libmysqlclient} library
that allowed malicious MySQL server to crash the client
application.
@item
Fixed security-related bug in @code{mysql_change_user()} handling.
All users are strongly recommended to upgrade to the version 3.23.54.
@item
Fixed bug that prevented @code{--chroot} command-line option of @code{mysqld}
from working.
@item
Fixed bug that made @code{OPTIMIZE TABLE} to corrupt the table
under some rare circumstances.
@item
Fixed @code{mysqlcheck} so it can deal with table names containing dashes.
@item
Fixed shutdown problem on Mac OS X.
@item
Fixed bug with comparing an indexed @code{NULL} field with @code{<=> NULL}.
@item
Fixed bug that caused @code{IGNORE INDEX} and @code{USE INDEX} sometimes
to be ignored.
@item
Fixed rare core dump problem in complicated @code{GROUP BY} queries that
didn't return any result.
@item
Fixed a bug where @code{MATCH ... AGAINST () >=0} was treated as if it was
@code{>}.
@item
Fixed core dump in @code{SHOW PROCESSLIST} when running with an
active slave (unlikely timing bug).
@item
Make it possible to use  multiple MySQL servers on Windows (code backported
from 4.0.2).
@item
One can create @code{TEMPORARY} @code{MERGE} tables now.
@item
Fixed that @code{--core-file} works on Linux (at least on kernel 2.4.18).
@item
Fixed a problem with @code{BDB} and @code{ALTER TABLE}.
@item
Fixed reference to freed memory when doing complicated @code{GROUP BY
... ORDER BY} queries.  Symptom was that @code{mysqld} died in function
@code{send_fields}.
@item
Allocate heap rows in smaller blocks to get better memory usage.
@item
Fixed memory allocation bug when storing @code{BLOB} values in internal
temporary tables used for some (unlikely) @code{GROUP BY} queries.
@item
Fixed a bug in key optimizing handling where the expression
@code{WHERE column_name = key_column_name} was calculated as true
for @code{NULL} values.
@item
Fixed core dump bug when doing @code{LEFT JOIN ... WHERE key_column=NULL}.
@item
Fixed @code{MyISAM} crash when using dynamic-row tables with huge numbers of
packed fields.
@item
Updated source tree to be built using @code{automake 1.5} and 
@code{libtool 1.4}.
@end itemize

@node News-3.23.53, News-3.23.52, News-3.23.54, News-3.23.x
@appendixsubsec Changes in release 3.23.53 (09 Oct 2002)
@itemize @bullet
@item
Fixed crash when @code{SHOW INNODB STATUS} was used and @code{skip-innodb}
was defined.
@item
Fixed possible memory corruption bug in binary log file handling when
slave rotated the logs (only affected 3.23, not 4.0).
@item
Fixed problem in @code{LOCK TABLES} on Windows when one connects to a
database that contains uppercase letters.
@item
Fixed that @code{--skip-show-databases} doesn't reset the @code{--port} option.
@item
Small fix in @code{safe_mysqld} for some shells.
@item
Fixed that @code{FLUSH STATUS} doesn't reset @code{delayed_insert_threads}.
@item
Fixed core dump bug when using the @code{BINARY} cast on a @code{NULL} value.
@item
Fixed race condition when someone did a @code{GRANT} at the same time a new
user logged in or did a @code{USE database}.
@item
Fixed bug in @code{ALTER TABLE} and @code{RENAME TABLE} when running with
@code{-O lower_case_table_names=1} (typically on Windows) when giving the
table name in uppercase.
@item
Fixed that @code{-O lower_case_table_names=1} also converts database
names to lowercase.
@item
Fixed unlikely core dump with @code{SELECT ... ORDER BY ... LIMIT}.
@item
Changed @code{AND/OR} to report that they can return NULL. This fixes a
bug in @code{GROUP BY} on @code{AND/OR} expressions that return
@code{NULL}.
@item
Fixed a bug that @code{OPTIMIZE} of locked and modified MyISAM table,
reported table corruption.
@item
Fixed a @code{BDB}-related @code{ALTER TABLE} bug with dropping a column
and shutting down immediately thereafter.
@item
Fixed problem with @code{configure ... --localstatedir=...}.
@item
Fixed problem with @code{UNSIGNED BIGINT} on AIX (again).
@item
Fixed bug in pthread_mutex_trylock() on HPUX 11.0.
@item
Multi-threaded stress tests for @code{InnoDB}.
@end itemize

@node News-3.23.52, News-3.23.51, News-3.23.53, News-3.23.x
@appendixsubsec Changes in release 3.23.52 (14 Aug 2002)
@itemize @bullet
@item
Wrap @code{BEGIN}/@code{COMMIT} around transaction in the binary log.
This makes replication honor transactions.
@item
Fixed security bug when having an empty database name in the @code{user.db}
table.
@item
Changed initialization of @code{RND()} to make it less predicatable.
@item
Fixed problem with @code{GROUP BY} on result with expression that created a
@code{BLOB} field.
@item
Fixed problem with @code{GROUP BY} on columns that have @code{NULL} values.
To solve this we now create an @code{MyISAM} temporary table when doing a
@code{GROUP BY} on a possible @code{NULL} item.
From MySQL 4.0.5 we can use in memory @code{HEAP} tables for this case.
@item
Fixed problem with privilege tables when downgrading from 4.0.2 to 3.23.
@item
Fixed thread bug in @code{SLAVE START}, @code{SLAVE STOP} and automatic repair
of MyISAM tables that could cause table cache to be corrupted.
@item
Fixed possible thread related key-cache-corruption problem with
@code{OPTIMIZE TABLE} and @code{REPAIR TABLE}.
@item
Added name of 'administrator command' logs.
@item
Fixed bug with creating an auto-increment value on second part of a
@code{UNIQUE()} key where first part could contain @code{NULL} values.
@item
Don't write slave-timeout reconnects to the error log.
@item
Fixed bug with slave net read timeouting
@item
Fixed a core-dump bug with @code{MERGE} tables and @code{MAX()} function.
@item
Fixed bug in @code{ALTER TABLE} with @code{BDB} tables.
@item
Fixed bug when logging @code{LOAD DATA INFILE} to binary log with no 
active database.
@item
Fixed a bug in range optimizer (causing crashes).
@item
Fixed possible problem in replication when doing @code{DROP DATABASE} on a
database with @code{InnoDB} tables.
@item
Fixed @code{mysql_info()} to return 0 for @code{Duplicates} value when using
@code{INSERT DELAYED IGNORE}.
@item
Added @code{-DHAVE_BROKEN_REALPATH} to the Mac OS X (darwin) compile
options in @file{configure.in} to fix a failure under high load.
@end itemize

@node News-3.23.51, News-3.23.50, News-3.23.52, News-3.23.x
@appendixsubsec Changes in release 3.23.51 (31 May 2002)

@itemize @bullet
@item
Fix bug with closing tags missing slash for @code{mysqldump} XML output.
@item
Remove end space from @code{ENUM} values. (This fixed a problem with
@code{SHOW CREATE TABLE}.)
@item
Fixed bug in @code{CONCAT_WS()} that cut the result.
@item
Changed name of server variables @code{Com_show_master_stat} to
@code{Com_show_master_status} and @code{Com_show_slave_stat} to
@code{Com_show_slave_status}.
@item
Changed handling of @code{gethostbyname()} to make the client library
thread-safe even if @code{gethostbyname_r} doesn't exist.
@item
Fixed core-dump problem when giving a wrong password string to @code{GRANT}.
@item
Fixed bug in @code{DROP DATABASE} with symlinked directory.
@item
Fixed optimization problem with @code{DATETIME} and value outside
@code{DATETIME} range.
@item
Removed Sleepycat's @code{BDB} doc files from the source tree, as they're not
needed (MySQL covers @code{BDB} in its own documentation).
@item
Fixed MIT-pthreads to compile with @code{glibc} 2.2 (needed for
@code{make dist}).
@item
Fixed the @code{FLOAT(X+1,X)} is not converted to @code{FLOAT(X+2,X)}.
(This also affected @code{DECIMAL}, @code{DOUBLE} and @code{REAL} types)
@item
Fixed the result from @code{IF()} is case in-sensitive if the second and
third arguments are case sensitive.
@item
Fixed core dump problem on OSF/1 in @code{gethostbyname_r}.
@item
Fixed that underflowed decimal fields are not zero filled.
@item
If we get an overflow when inserting @code{'+11111'} for
@code{DECIMAL(5,0) UNSIGNED} columns, we will just drop the sign.
@item
Fixed optimization bug with @code{ISNULL(expression_which_cannot_be_null)} and
@code{ISNULL(constant_expression)}.
@item
Fixed host lookup bug in the @code{glibc} library that we used with the 3.23.50
Linux-x86 binaries.
@end itemize

@node News-3.23.50, News-3.23.49, News-3.23.51, News-3.23.x
@appendixsubsec Changes in release 3.23.50 (21 Apr 2002)

@itemize @bullet
@item
Fixed buffer overflow problem if someone specified a too long datadir
parameter to mysqld
@item
Add missing @code{<row>} tags for @code{mysqldump} XML output.
@item
Fixed problem with @code{crash-me} and @code{gcc} 3.0.4.
@item
Fixed that @code{@@@@unknown_variable} doesn't hang server.
@item
Added @code{@@@@VERSION} as a synonym for @code{VERSION()}.
@item
@code{SHOW VARIABLES LIKE 'xxx'} is now case-insensitive.
@item
Fixed timeout for @code{GET_LOCK()} on HP-UX with DCE threads.
@item
Fixed memory allocation bug in the glibc library used to build Linux
binaries, which caused mysqld to die in 'free()'.
@item
Fixed @code{SIGINT} and @code{SIGQUIT} problems in @code{mysql}.
@item
Fixed bug in character table converts when used with big ( > 64K) strings.
@item
@code{InnoDB} now retains foreign key constraints through @code{ALTER TABLE}
and @code{CREATE/DROP INDEX}.
@item
@code{InnoDB} now allows foreign key constraints to be added through the
@code{ALTER TABLE} syntax.
@item
@code{InnoDB} tables can now be set to automatically grow in size (autoextend).
@item
Our Linux RPMS and binaries are now compiled with @code{gcc} 3.0.4, which
should make them a bit faster.
@item
Fixed some buffer overflow problems when reading startup parameters.
@item
Because of problems on shutdown we have now disabled named pipes on
Windows by default.  One can enable named pipes by starting mysqld with
@code{--enable-named-pipe}.
@item
Fixed bug when using @code{WHERE key_column = 'J' or key_column='j'}.
@item
Fixed core-dump bug when using @code{--log-bin} with @code{LOAD DATA
INFILE} without an active database.
@item
Fixed bug in @code{RENAME TABLE} when used with
@code{lower_case_table_names=1} (default on Windows).
@item
Fixed unlikely core-dump bug when using @code{DROP TABLE} on a table
that was in use by a thread that also used queries on only temporary tables.
@item
Fixed problem with @code{SHOW CREATE TABLE} and @code{PRIMARY KEY} when using
32 indexes.
@item
Fixed that one can use @code{SET PASSWORD} for the anonymous user.
@item
Fixed core dump bug when reading client groups from option files using
@code{mysql_options()}.
@item
Memory leak (16 bytes per every @strong{corrupted} table) closed.
@item
Fixed binary builds to use @code{--enable-local-infile}.
@item
Update source to work with new version of @code{bison}.
@item
Updated shell scripts to now agree with new POSIX standard.
@item
Fixed bug where @code{DATE_FORMAT()} returned empty string when used
with @code{GROUP BY}.
@end itemize

@node News-3.23.49, News-3.23.48, News-3.23.50, News-3.23.x
@appendixsubsec Changes in release 3.23.49

@itemize @bullet
@item
Don't give warning for a statement that is only a comment; this is needed for
@code{mysqldump --disable-keys} to work.
@item
Fixed unlikely caching bug when doing a join without keys. In this case
the last used field for a table always returned @code{NULL}.
@item
Added options to make @code{LOAD DATA LOCAL INFILE} more secure.
@item
MySQL binary release 3.23.48 for Linux contained a new @code{glibc} library,
which has serious problems under high load and Red Hat 7.2.  The 3.23.49 binary
release doesn't have this problem.
@item
Fixed shutdown problem on NT.
@end itemize

@node News-3.23.48, News-3.23.47, News-3.23.49, News-3.23.x
@appendixsubsec Changes in release 3.23.48 (07 Feb 2002)

@itemize @bullet
@item
Added @code{--xml} option to @code{mysqldump} for producing XML output.
@item
Changed to use @code{autoconf} 2.52 (from @code{autoconf} 2.13)
@item
Fixed bug in complicated join with @code{const} tables.
@item
Added internal safety checks for @code{InnoDB}.
@item
Some @code{InnoDB} variables were always shown in @code{SHOW VARIABLES} as
@code{OFF} on high-byte-first systems (like SPARC).
@item
Fixed problem with one thread using an @code{InnoDB} table and another
thread doing an @code{ALTER TABLE} on the same table. Before that,
@code{mysqld} could crash with an assertion failure in @file{row0row.c},
line 474.
@item
Tuned the @code{InnoDB} SQL optimizer to favor index searches more often
over table scans.
@item
Fixed a performance problem with @code{InnoDB} tables when several large
@code{SELECT} queries are run concurrently on a multiprocessor Linux
computer.  Large CPU-bound @code{SELECT} queries will now also generally
run faster on all platforms.
@item
If MySQL binlogging is used, @code{InnoDB} now prints after crash recovery the
latest MySQL binlog name and the offset @code{InnoDB} was able to recover
to. This is useful, for example, when resynchronizing a master and a
slave database in replication.
@item
Added better error messages to help in installation problems of @code{InnoDB}
tables.
@item
It is now possible to recover MySQL temporary tables that have become
orphaned inside the @code{InnoDB} tablespace.
@item
@code{InnoDB} now prevents a @code{FOREIGN KEY} declaration where the
signedness is not the same in the referencing and referenced integer columns.
@item
Calling @code{SHOW CREATE TABLE} or @code{SHOW TABLE STATUS} could cause
memory corruption and make @code{mysqld} crash.  Especially at risk was
@code{mysqldump}, because it frequently calls @code{SHOW CREATE TABLE}.
@item
If inserts to several tables containing an @code{AUTO_INCREMENT} column were
wrapped inside one @code{LOCK TABLES}, @code{InnoDB} asserted in
@file{lock0lock.c}.
@item
In 3.23.47 we allowed several @code{NULL} values in a @code{UNIQUE} secondary
index for an @code{InnoDB} table.  But @code{CHECK TABLE} was not relaxed: it
reports the table as corrupt.  @code{CHECK TABLE} no longer complains in
this situation.
@item
@code{SHOW GRANTS} now shows @code{REFERENCES} instead of @code{REFERENCE}.
@end itemize

@node News-3.23.47, News-3.23.46, News-3.23.48, News-3.23.x
@appendixsubsec Changes in release 3.23.47 (27 Dec 2001)

@itemize @bullet
@item
Fixed bug when using the following construct:
@code{SELECT ... WHERE key=@@var_name OR key=@@var_name2}
@item
Restrict @code{InnoDB} keys to 500 bytes.
@item
@code{InnoDB} now supports @code{NULL} in keys.
@item
Fixed shutdown problem on HP-UX. (Introduced in 3.23.46)
@item
Fixed core dump bug in replication when using @code{SELECT RELEASE_LOCK()}.
@item
Added new command: @code{DO expression,[expression]}
@item
Added @code{slave-skip-errors} option.
@item
Added statistics variables for all MySQL commands. (@code{SHOW STATUS} is
now much longer.)
@item
Fixed default values for @code{InnoDB} tables.
@item
Fixed that @code{GROUP BY expr DESC} works.
@item
Fixed bug when using @code{t1 LEFT JOIN t2 ON t2.key=constant}.
@item
@code{mysql_config} now also works with binary (relocated) distributions.
@end itemize

@node News-3.23.46, News-3.23.45, News-3.23.47, News-3.23.x
@appendixsubsec Changes in release 3.23.46 (29 Nov 2001)

@itemize @bullet
@item
Fixed problem with aliased temporary table replication.
@item
@code{InnoDB} and @code{BDB} tables will now use index when doing an
@code{ORDER BY} on the whole table.
@item
Fixed bug where one got an empty set instead of a DEADLOCK error when using
@code{BDB} tables.
@item
One can now kill @code{ANALYZE}, @code{REPAIR}, and @code{OPTIMIZE TABLE} when
the thread is waiting to get a lock on the table.
@item
Fixed race condition in @code{ANALYZE TABLE}.
@item
Fixed bug when joining with caching (unlikely to happen).
@item
Fixed race condition when using the binary log and @code{INSERT DELAYED}
which could cause the binary log to have rows that were not yet written
to @code{MyISAM} tables.
@item
Changed caching of binary log to make replication slightly faster.
@item
Fixed bug in replication on Mac OS X.
@end itemize

@node News-3.23.45, News-3.23.44, News-3.23.46, News-3.23.x
@appendixsubsec Changes in release 3.23.45 (22 Nov 2001)

@itemize @bullet
@item
@code{(UPDATE|DELETE) ...WHERE MATCH} bugfix.
@item
shutdown should now work on Darwin (Mac OS X).
@item
Fixed core dump when repairing corrupted packed @code{MyISAM} files.
@item
@code{--core-file} now works on Solaris.
@item
Fix a bug which could cause @code{InnoDB} to complain if it cannot find
free blocks from the buffer cache during recovery.
@item
Fixed bug in @code{InnoDB} insert buffer B-tree handling that could cause
crashes.
@item
Fixed bug in @code{InnoDB} lock timeout handling.
@item
Fixed core dump bug in @code{ALTER TABLE} on a @code{TEMPORARY} @code{InnoDB}
table.
@item
Fixed bug in @code{OPTIMIZE TABLE} that reset index cardinality if it
was up to date.
@item
Fixed problem with @code{t1 LEFT_JOIN t2 ... WHERE t2.date_column IS NULL} when
date_column was declared as @code{NOT NULL}.
@item
Fixed bug with @code{BDB} tables and keys on @code{BLOB} columns.
@item
Fixed bug in @code{MERGE} tables on OS with 32-bit file pointers.
@item
Fixed bug in @code{TIME_TO_SEC()} when using negative values.
@end itemize

@node News-3.23.44, News-3.23.43, News-3.23.45, News-3.23.x
@appendixsubsec Changes in release 3.23.44 (31 Oct 2001)

@itemize @bullet
@item
Fixed @code{Rows_examined} count in slow query log.
@item
Fixed bug when using a reference to an @code{AVG()} column in @code{HAVING}.
@item
Fixed that date functions that require correct dates, like
@code{DAYOFYEAR(column)}, will return @code{NULL} for @code{0000-00-00} dates.
@item
Fixed bug in const-propagation when comparing columns of different
types. (@code{SELECT * FROM date_col="2001-01-01" and date_col=time_col})
@item
Fixed bug that caused error message @code{Can't write, because of unique
constraint} with some @code{GROUP BY} queries.
@item
Fixed problem with @code{sjis} character strings used within quoted table
names.
@item
Fixed core dump when using @code{CREATE ... FULLTEXT} keys with other
storage engines than @code{MyISAM}.
@item
Don't use @code{signal()} on Windows because this appears to not be
100% reliable.
@item
Fixed bug when doing @code{WHERE col_name=NULL} on an indexed column
that had @code{NULL} values.
@item
Fixed bug when doing @code{LEFT JOIN ...  ON (col_name = constant) WHERE col_name = constant}.
@item
When using replications, aborted queries that contained @code{%} could cause
a core dump.
@item
@code{TCP_NODELAY} was not used on some systems. (Speed problem.)
@item
Applied portability fixes for OS/2. (Patch by Yuri Dario.)
@end itemize

The following changes are for @code{InnoDB} tables:

@itemize @bullet
@item
Add missing @code{InnoDB} variables to @code{SHOW VARIABLES}.
@item
Foreign keys checking is now done for @code{InnoDB} tables.
@item
@code{DROP DATABASE} now works also for @code{InnoDB} tables.
@item
@code{InnoDB} now supports datafiles and raw disk partitions bigger
than 4 GB on those operating systems that have big files.
@item
@code{InnoDB} calculates better table cardinality estimates for the
MySQL optimizer.
@item
Accent characters in the default character set @code{latin1} are ordered
according to the MySQL ordering.

Note: If you are using @code{latin1} and have inserted characters whose
code is greater than 127 into an indexed @code{CHAR} column, you should
run @code{CHECK TABLE} on your table when you upgrade to 3.23.44, and
drop and reimport the table if @code{CHECK TABLE} reports an error!
@item
A new @file{my.cnf} parameter, @code{innodb_thread_concurrency}, helps in
performance tuning in heavily concurrent environments.
@item
A new @file{my.cnf} parameter, @code{innodb_fast_shutdown}, speeds up
server shutdown.
@item
A new @file{my.cnf} parameter, @code{innodb_force_recovery}, helps to save
your data in case the disk image of the database becomes corrupt.
@item
@code{innodb_monitor} has been improved and a new
@code{innodb_table_monitor} added.
@item
Increased maximum key length from 500 to 7000 bytes.
@item
Fixed a bug in replication of @code{AUTO_INCREMENT} columns with
multiple-line inserts.
@item
Fixed a bug when the case of letters changes in an update of an indexed
secondary column.
@item
Fixed a hang when there are > 24 datafiles.
@item
Fixed a crash when @code{MAX(col)} is selected from an empty table, and
@code{col} is not the first column in a multi-column index.
@item
Fixed a bug in purge which could cause crashes.
@end itemize

@node News-3.23.43, News-3.23.42, News-3.23.44, News-3.23.x
@appendixsubsec Changes in release 3.23.43 (04 Oct 2001)

@itemize @bullet
@item
Fixed a bug in @code{INSERT DELAYED} and @code{FLUSH TABLES} introduced
in 3.23.42.
@item
Fixed unlikely bug, which returned non-matching rows, in @code{SELECT} with
many tables and multi-column indexes and 'range' type.
@item
Fixed an unlikely core dump bug when doing @code{EXPLAIN SELECT} when using
many tables and @code{ORDER BY}.
@item
Fixed bug in @code{LOAD DATA FROM MASTER} when using table with
@code{CHECKSUM=1}.
@item
Added unique error message when one gets a DEADLOCK during a transaction with
@code{BDB} tables.
@item
Fixed problem with @code{BDB} tables and @code{UNIQUE} columns defined
as @code{NULL}.
@item
Fixed problem with @code{myisampack} when using pre-space filled @code{CHAR}
columns.
@item
Applied patch from Yuri Dario for OS/2.
@item
Fixed bug in @code{--safe-user-create}.
@end itemize

@node News-3.23.42, News-3.23.41, News-3.23.43, News-3.23.x
@appendixsubsec Changes in release 3.23.42 (08 Sep 2001)

@itemize @bullet
@item
Fixed problem when using @code{LOCK TABLES} and @code{BDB} tables.
@item
Fixed problem with @code{REPAIR TABLE} on @code{MyISAM} tables with row
lengths in the range from 65517 to 65520 bytes.
@item
Fixed rare hang when doing @code{mysqladmin shutdown} when there was
a lot of activity in other threads.
@item
Fixed problem with @code{INSERT DELAYED} where delayed thread could be
hanging on @code{upgrading locks} for no apparent reason.
@item
Fixed problem with @code{myisampack} and @code{BLOB}.
@item
Fixed problem when one edited @file{.MRG} tables by hand.
(Patch from Benjamin Pflugmann).
@item
Enforce that all tables in a @code{MERGE} table come from the same
database.
@item
Fixed bug with @code{LOAD DATA INFILE} and transactional tables.
@item
Fix bug when using @code{INSERT DELAYED} with wrong column definition.
@item
Fixed core dump during @code{REPAIR} of some particularly broken tables.
@item
Fixed bug in @code{InnoDB} and @code{AUTO_INCREMENT} columns.
@item
Fixed bug in @code{InnoDB} and @code{RENAME TABLE} columns.
@item
Fixed critical bug in @code{InnoDB} and @code{BLOB} columns.  If you have
used @code{BLOB} columns larger than 8000 bytes in an @code{InnoDB}
table, it is necessary to dump the table with @code{mysqldump}, drop it and
restore it from the dump.
@item
Applied large patch for OS/2 from Yuri Dario.
@item
Fixed problem with @code{InnoDB} when one could get the error @code{Can't
execute the given command...} even when no transaction was active.
@item
Applied some minor fixes that concern Gemini.
@item
Use real arithmetic operations even in integer context if not
all arguments are integers. (Fixes uncommon bug in some integer
contexts).
@item
Don't force everything to lowercase on Windows. (To fix problem
with Windows and @code{ALTER TABLE}).  Now @code{--lower_case_table_names}
also works on Unix.
@item
Fixed that automatic rollback is done when thread end doesn't lock
other threads.
@end itemize

@node News-3.23.41, News-3.23.40, News-3.23.42, News-3.23.x
@appendixsubsec Changes in release 3.23.41 (11 Aug 2001)

@itemize @bullet
@item
Added @code{--sql-mode=value[,value[,value]]} option to @code{mysqld}.
@xref{Server options}.
@item
Fixed possible problem with @code{shutdown} on Solaris where the
@file{.pid} file wasn't deleted.
@item
@code{InnoDB} now supports < 4 GB rows. The former limit was 8000 bytes.
@item
The @code{doublewrite} file flush method is used in @code{InnoDB}.
It reduces the need for Unix @code{fsync()} calls to a fraction and
improves performance on most Unix flavors.
@item
You can now use the @code{InnoDB} Monitor to print a lot of @code{InnoDB} state
information, including locks, to the standard output.  This is useful in
performance tuning.
@item
Several bugs which could cause hangs in @code{InnoDB} have been fixed.
@item
Split @code{record_buffer} to @code{record_buffer} and
@code{record_rnd_buffer}.  To make things compatible to previous MySQL
versions, if @code{record_rnd_buffer} is not set, then it takes the
value of @code{record_buffer}.
@item
Fixed optimizing bug in @code{ORDER BY} where some @code{ORDER BY} parts
where wrongly removed.
@item
Fixed overflow bug with @code{ALTER TABLE} and @code{MERGE} tables.
@item
Added prototypes for @code{my_thread_init()} and @code{my_thread_end()} to
@file{mysql_com.h}
@item
Added @code{--safe-user-create} option to @code{mysqld}.
@item
Fixed bug in @code{SELECT DISTINCT ... HAVING} that caused error message
@code{Can't find record in #...}
@end itemize


@node News-3.23.40, News-3.23.39, News-3.23.41, News-3.23.x
@appendixsubsec Changes in release 3.23.40

@itemize @bullet
@item
Fixed problem with @code{--low-priority-updates} and @code{INSERT} statements.
@item
Fixed bug in slave thread when under some rare circumstances it could
get 22 bytes ahead on the offset in the master.
@item
Added @code{slave_net_timeout} for replication.
@item
Fixed problem with @code{UPDATE} and @code{BDB} tables.
@item
Fixed hard bug in @code{BDB} tables when using key parts.
@item
Fixed problem when using @code{GRANT FILE ON database.* ...}; previously
we added the @code{DROP} privilege for the database.
@item
Fixed @code{DELETE FROM tbl_name ... LIMIT 0} and
@code{UPDATE FROM tbl_name ... LIMIT 0}, which acted as though the
@code{LIMIT} clause was not present (they deleted or updated all selected
rows).
@item
@code{CHECK TABLE} now checks if an @code{AUTO_INCREMENT} column contains
the value 0.
@item
Sending a @code{SIGHUP} to @code{mysqld} will now only flush the logs,
not reset the replication.
@item
Fixed parser to allow floats of type @code{1.0e1} (no sign after @code{e}).
@item
Option @code{--force} to @code{myisamchk} now also updates states.
@item
Added option @code{--warnings} to @code{mysqld}. Now @code{mysqld}
prints the error @code{Aborted connection} only if this option is used.
@item
Fixed problem with @code{SHOW CREATE TABLE} when you didn't have a
@code{PRIMARY KEY}.
@item
Properly fixed the rename of @code{innodb_unix_file_flush_method} variable to
@code{innodb_flush_method}.
@item
Fixed bug when converting @code{BIGINT UNSIGNED} to @code{DOUBLE}. This caused
a problem when doing comparisons with @code{BIGINT} values outside of the
signed range.
@item
Fixed bug in @code{BDB} tables when querying empty tables.
@item
Fixed a bug when using @code{COUNT(DISTINCT)} with @code{LEFT JOIN} and
there weren't any matching rows.
@item
Removed all documentation referring to the @code{GEMINI} table
type. @code{GEMINI} is not released under an @code{Open Source} license.
@end itemize


@node News-3.23.39, News-3.23.38, News-3.23.40, News-3.23.x
@appendixsubsec Changes in release 3.23.39 (12 Jun 2001)

@itemize @bullet
@item
The @code{AUTO_INCREMENT} sequence wasn't reset when dropping
and adding an @code{AUTO_INCREMENT} column.
@item
@code{CREATE ... SELECT} now creates non-unique indexes delayed.
@item
Fixed problem where @code{LOCK TABLES tbl_name READ} followed by
@code{FLUSH TABLES} put an exclusive lock on the table.
@item
@code{REAL @@variable} values were represented with only 2 digits when
converted to strings.
@item
Fixed problem that client ``hung'' when @code{LOAD TABLE FROM MASTER} failed.
@item
@code{myisamchk --fast --force} will no longer repair tables
that only had the open count wrong.
@item
Added functions to handle symbolic links to make life easier in 4.0.
@item
We are now using the @code{-lcma} thread library on HP-UX 10.20 so
that MySQL will be more stable on HP-UX.
@item
Fixed problem with @code{IF()} and number of decimals in the result.
@item
Fixed date-part extraction functions to work with dates where day
and/or month is 0.
@item
Extended argument length in option files from 256 to 512 chars.
@item
Fixed problem with shutdown when @code{INSERT DELAYED} was waiting for
a @code{LOCK TABLE}.
@item
Fixed core dump bug in @code{InnoDB} when tablespace was full.
@item
Fixed problem with @code{MERGE} tables and big tables (> 4G) when using
@code{ORDER BY}.
@end itemize


@node News-3.23.38, News-3.23.37, News-3.23.39, News-3.23.x
@appendixsubsec Changes in release 3.23.38 (09 May 2001)

@itemize @bullet
@item
Fixed a bug when @code{SELECT} from @code{MERGE} table
sometimes results in incorrectly ordered rows.
@item
Fixed a bug in @code{REPLACE()} when using the @code{ujis} character set.
@item
Applied Sleepycat @code{BDB} patches 3.2.9.1 and 3.2.9.2.
@item
Added @code{--skip-stack-trace} option to @code{mysqld}.
@item
@code{CREATE TEMPORARY} now works with @code{InnoDB} tables.
@item
@code{InnoDB} now promotes sub keys to whole keys.
@item
Added option @code{CONCURRENT} to @code{LOAD DATA}.
@item
Better error message when slave @code{max_allowed_packet} is too low to
read a very long log event from the master.
@item
Fixed bug when too many rows where removed when using
@code{SELECT DISTINCT ... HAVING}.
@item
@code{SHOW CREATE TABLE} now returns @code{TEMPORARY} for temporary tables.
@item
Added @code{Rows_examined} to slow query log.
@item
Fixed problems with function returning empty string when used together with
a group function and a @code{WHERE} that didn't match any rows.
@item
New program @code{mysqlcheck}.
@item
Added database name to output for administrative commands like @code{CHECK},
@code{REPAIR}, @code{OPTIMIZE}.
@item
Lots of portability fixes for @code{InnoDB}.
@item
Changed optimizer so that queries like
@code{SELECT * FROM tbl_name,tbl_name2 ... ORDER BY key_part1 LIMIT row_count}
will use index on @code{key_part1} instead of @code{filesort}.
@item
Fixed bug when doing
@code{LOCK TABLE to_table WRITE,...; INSERT INTO to_table... SELECT ...}
when @code{to_table} was empty.
@item
Fixed bug with @code{LOCK TABLE} and @code{BDB} tables.
@end itemize


@node News-3.23.37, News-3.23.36, News-3.23.38, News-3.23.x
@appendixsubsec Changes in release 3.23.37 (17 Apr 2001)

@itemize @bullet
@item
Fixed a bug when using @code{MATCH()} in @code{HAVING} clause.
@item
Fixed a bug when using @code{HEAP} tables with @code{LIKE}.
@item
Added @code{--mysql-version} option to @code{safe_mysqld}
@item
Changed @code{INNOBASE} to @code{InnoDB} (because the @code{INNOBASE}
name was already used). All @code{configure} options and @code{mysqld}
start options now use @code{innodb} instead of @code{innobase}. This
means that before upgrading to this version, you have to change any
configuration files where you have used @code{innobase} options!
@item
Fixed bug when using indexes on @code{CHAR(255) NULL} columns.
@item
Slave thread will now be started even if @code{master-host} is not set, as
long as @code{server-id} is set and valid @file{master.info} is present.
@item
Partial updates (terminated with kill) are now logged with a special error
code to the binary log. Slave will refuse to execute them if the error code
indicates the update was terminated abnormally, and will have to be recovered
with @code{SET SQL_SLAVE_SKIP_COUNTER=1; SLAVE START} after a manual sanity
check/correction of data integrity.
@item
Fixed bug that erroneously logged a drop of internal temporary table
on thread termination to the binary log --- this bug affected replication.
@item
Fixed a bug in @code{REGEXP} on 64-bit machines.
@item
@code{UPDATE} and @code{DELETE} with @code{WHERE unique_key_part IS NULL}
didn't update/delete all rows.
@item
Disabled @code{INSERT DELAYED} for tables that support transactions.
@item
Fixed bug when using date functions on @code{TEXT}/@code{BLOB} column
with wrong date format.
@item
UDFs now also work on Windows. (Patch by Ralph Mason.)
@item
Fixed bug in @code{ALTER TABLE} and @code{LOAD DATA INFILE} that disabled
key-sorting. These commands should now be faster in most cases.
@item
Fixed performance bug where reopened tables (tables that had been
waiting for @code{FLUSH} or @code{REPAIR}) would not use indexes for the
next query.
@item
Fixed problem with @code{ALTER TABLE} to @code{InnoDB} tables on FreeBSD.
@item
Added @code{mysqld} variables @code{myisam_max_sort_file_size} and
@code{myisam_max_extra_sort_file_size}.
@item
Initialize signals early to avoid problem with signals in @code{InnoDB}.
@item
Applied patch for the @code{tis620} character set to make comparisons
case-independent and to fix a bug in @code{LIKE} for this character set.
@strong{Note:} All tables that uses the @code{tis620} character set must be
fixed with  @code{myisamchk -r} or @code{REPAIR TABLE} !
@item
Added @code{--skip-safemalloc} option to @code{mysqld}.
@end itemize


@node News-3.23.36, News-3.23.35, News-3.23.37, News-3.23.x
@appendixsubsec Changes in release 3.23.36 (27 Mar 2001)

@itemize @bullet
@item
Fixed a bug that allowed use of database names containing a @samp{.}
character.  This fixes a serious security issue when @code{mysqld} is run
as root.
@item
Fixed bug when thread creation failed (could happen when doing a @strong{lot}
of connections in a short time).
@item
Fixed some problems with @code{FLUSH TABLES} and @code{TEMPORARY} tables.
(Problem with freeing the key cache and error @code{Can't reopen table...}.)
@item
Fixed a problem in @code{InnoDB} with other character sets than @code{latin1}
and another problem when using many columns.
@item
Fixed bug that caused a core dump when using a very complex query involving
@code{DISTINCT} and summary functions.
@item
Added @code{SET TRANSACTION ISOLATION LEVEL ...}
@item
Added @code{SELECT ... FOR UPDATE}.
@item
Fixed bug where the number of affected rows was not returned when MySQL
was compiled without transaction support.
@item
Fixed a bug in @code{UPDATE} where keys weren't always used to find the
rows to be updated.
@item
Fixed a bug in @code{CONCAT_WS()} where it returned incorrect results.
@item
Changed @code{CREATE ... SELECT} and @code{INSERT ... SELECT} to not
allow concurrent inserts as this could make the binary log hard to repeat.
(Concurrent inserts are enabled if you are not using the binary or update log.)
@item
Changed some macros to be able to use fast mutex with @code{glibc} 2.2.
@end itemize


@node News-3.23.35, News-3.23.34a, News-3.23.36, News-3.23.x
@appendixsubsec Changes in release 3.23.35 (15 Mar 2001)

@itemize @bullet
@item
Fixed newly introduced bug in @code{ORDER BY}.
@item
Fixed wrong define @code{CLIENT_TRANSACTIONS}.
@item
Fixed bug in @code{SHOW VARIABLES} when using @code{INNOBASE} tables.
@item
Setting and using user variables in @code{SELECT DISTINCT} didn't work.
@item
Tuned @code{SHOW ANALYZE} for small tables.
@item
Fixed handling of arguments in the benchmark script @code{run-all-tests}.
@end itemize


@node News-3.23.34a, News-3.23.34, News-3.23.35, News-3.23.x
@appendixsubsec Changes in release 3.23.34a

@itemize @bullet
@item
Added extra files to the distribution to allow @code{INNOBASE} support
to be compiled.
@end itemize


@node News-3.23.34, News-3.23.33, News-3.23.34a, News-3.23.x
@appendixsubsec Changes in release 3.23.34 (10 Mar 2001)

@itemize @bullet
@item
Added the @code{INNOBASE} storage engine and the @code{BDB} storage engine
to the MySQL source distribution.
@item
Updated the documentation about @code{GEMINI} tables.
@item
Fixed a bug in @code{INSERT DELAYED} that caused threads to hang when
inserting @code{NULL} into an @code{AUTO_INCREMENT} column.
@item
Fixed a bug in @code{CHECK TABLE} / @code{REPAIR TABLE} that could cause
a thread to hang.
@item
@code{REPLACE} will not replace a row that conflicts with an
@code{AUTO_INCREMENT} generated key.
@item
@code{mysqld} now only sets @code{CLIENT_TRANSACTIONS} in
@code{mysql->server_capabilities} if the server supports a
transaction-safe storage engine.
@item
Fixed @code{LOAD DATA INFILE} to allow numeric values to be read into
@code{ENUM} and @code{SET} columns.
@item
Improved error diagnostic for slave thread exit.
@item
Fixed bug in @code{ALTER TABLE ... ORDER BY}.
@item
Added @code{max_user_connections} variable to @code{mysqld}.
@item
Limit query length for replication by @code{max_allowed_packet}, not the
arbitrary limit of 4 MB.
@item
Allow space around @code{=} in argument to @code{--set-variable}.
@item
Fixed problem in automatic repair that could leave some threads in state
@code{Waiting for table}.
@item
@code{SHOW CREATE TABLE} now displays the @code{UNION=()} for @code{MERGE}
tables.
@item
@code{ALTER TABLE} now remembers the old @code{UNION=()} definition.
@item
Fixed bug when replicating timestamps.
@item
Fixed bug in bidirectional replication.
@item
Fixed bug in the @code{BDB} storage engine that occurred when using an index
on multi-part key where a key part may be @code{NULL}.
@item
Fixed @code{MAX()} optimization on sub-key for @code{BDB} tables.
@item
Fixed problem where garbage results were returned when using @code{BDB}
tables and @code{BLOB} or @code{TEXT} fields when joining many tables.
@item
Fixed a problem with @code{BDB} tables and @code{TEXT} columns.
@item
Fixed bug when using a @code{BLOB} key where a const row wasn't found.
@item
Fixed that @code{mysqlbinlog} writes the timestamp value for each query.
This ensures that one gets same values for date functions like @code{NOW()}
when using @code{mysqlbinlog} to pipe the queries to another server.
@item
Allow @code{--skip-gemini}, @code{--skip-bdb}, and @code{--skip-innodb}
options to be specified when invoking @code{mysqld}, even if these storage
engines are not compiled in to @code{mysqld}.
@item
One can now do @code{GROUP BY ... DESC}.
@item
Fixed a deadlock in the @code{SET} code, when one ran @code{SET @@foo=bar},
where @code{bar} is a column reference, an error was not properly generated.
@end itemize


@node News-3.23.33, News-3.23.32, News-3.23.34, News-3.23.x
@appendixsubsec Changes in release 3.23.33 (09 Feb 2001)

@itemize @bullet
@item
Fixed DNS lookups not to use the same mutex as the hostname
cache.  This will enable known hosts to be quickly resolved even if a
DNS lookup takes a long time.
@item
Added @code{--character-sets-dir} option to @code{myisampack}.
@item
Removed warnings when running @code{REPAIR TABLE ... EXTENDED}.
@item
Fixed a bug that caused a core dump when using @code{GROUP BY} on an alias,
where the alias was the same as an existing column name.
@item
Added @code{SEQUENCE()} as an example UDF function.
@item
Changed @code{mysql_install_db} to use @code{BINARY} for @code{CHAR}
columns in the privilege tables.
@item
Changed @code{TRUNCATE tbl_name} to @code{TRUNCATE TABLE tbl_name}
to use the same syntax as Oracle.  Until 4.0 we will also allow
@code{TRUNCATE tbl_name} to not crash old code.
@item
Fixed ``no found rows'' bug in @code{MyISAM} tables when a @code{BLOB} was
first part of a multi-part key.
@item
Fixed bug where @code{CASE} didn't work with @code{GROUP BY}.
@item
Added @code{--sort-recover} option to @code{myisamchk}.
@item
@code{myisamchk -S} and @code{OPTIMIZE TABLE} now work on Windows.
@item
Fixed bug when using @code{DISTINCT} on results from functions that referred
to a group function, like:
@example
SELECT a, DISTINCT SEC_TO_TIME(SUM(a))
FROM tbl_name GROUP BY a, b;
@end example
@item
Fixed buffer overrun in @code{libmysqlclient} library.
Fixed bug in handling @code{STOP} event after @code{ROTATE} event in
replication.
@item
Fixed another buffer overrun in @code{DROP DATABASE}.
@item
Added @code{Table_locks_immediate} and @code{Table_locks_waited} status
variables.
@item
Fixed bug in replication that broke slave server start with existing
@file{master.info}. This fixes a bug introduced in 3.23.32.
@item
Added @code{SET SQL_SLAVE_SKIP_COUNTER=n} command to recover from
replication glitches without a full database copy.
@item
Added @code{max_binlog_size} variable; the binary log will be rotated
automatically when the size crosses the limit.
@item
Added @code{Last_Error}, @code{Last_Errno}, and @code{Slave_skip_counter}
variables to @code{SHOW SLAVE STATUS}.
@item
Fixed bug in @code{MASTER_POS_WAIT()} function.
@item
Execute core dump handler on @code{SIGILL}, and @code{SIGBUS} in addition to
@code{SIGSEGV}.
@item
On x86 Linux, print the current query and thread (connection) id, if
available, in the core dump handler.
@item
Fixed several timing bugs in the test suite.
@item
Extended @code{mysqltest} to take care of the timing issues in the test
suite.
@item
@code{ALTER TABLE} can now be used to change the definition for a
@code{MERGE} table.
@item
Fixed creation of @code{MERGE} tables on Windows.
@item
Portability fixes for OpenBSD and OS/2.
@item
Added @code{--temp-pool} option to @code{mysqld}.  Using this option
will cause most temporary files created to use a small set of names,
rather than a unique name for each new file.  This is to work around a
problem in the Linux kernel dealing with creating a bunch of new files
with different names.  With the old behavior, Linux seems to "leak"
memory, as it's being allocated to the directory entry cache instead of
the disk cache.
@end itemize


@node News-3.23.32, News-3.23.31, News-3.23.33, News-3.23.x
@appendixsubsec Changes in release 3.23.32 (22 Jan 2001: Production)

@itemize @bullet
@item
Changed code to get around compiler bug in Compaq C++ on OSF/1, that broke
@code{BACKUP}, @code{RESTORE}, @code{CHECK}, @code{REPAIR}, and
@code{ANALYZE TABLE}.
@item
Added option @code{FULL} to @code{SHOW COLUMNS}. Now we show the
privilege list for the columns only if this option is given.
@item
Fixed bug in @code{SHOW LOGS} when there weren't any @code{BDB} logs.
@item
Fixed a timing problem in replication that could delay sending an update
to the client until a new update was done.
@item
Don't convert field names when using @code{mysql_list_fields()}.  This is
to keep this code compatible with @code{SHOW FIELDS}.
@item
@code{MERGE} tables didn't work on Windows.
@item
Fixed problem with @code{SET PASSWORD=...} on Windows.
@item
Added missing @file{my_config.h} to RPM distribution.
@item
@code{TRIM("foo" from "foo")} didn't return an empty string.
@item
Added @code{--with-version-suffix} option to @code{configure}.
@item
Fixed core dump when client aborted connection without @code{mysql_close()}.
@item
Fixed a bug in @code{RESTORE TABLE} when trying to restore from a non-existent
directory.
@item
Fixed a bug which caused a core dump on the slave when replicating
@code{SET PASSWORD}.
@item
Added @code{MASTER_POS_WAIT()}.
@end itemize


@node News-3.23.31, News-3.23.30, News-3.23.32, News-3.23.x
@appendixsubsec Changes in release 3.23.31 (17 Jan 2001)

@itemize @bullet
@item
The test suite now tests all reachable @code{BDB} interface code.  During
testing we found and fixed many errors in the interface code.
@item
Using @code{HAVING} on an empty table could produce one result row when
it shouldn't.
@item
Fixed the MySQL RPM so it no longer depends on Perl5.
@item
Fixed some problems with @code{HEAP} tables on Windows.
@item
@code{SHOW TABLE STATUS} didn't show correct average row length for tables
larger than 4G.
@item
@code{CHECK TABLE ... EXTENDED} didn't check row links for fixed size tables.
@item
Added option @code{MEDIUM} to @code{CHECK TABLE}.
@item
Fixed problem when using @code{DECIMAL()} keys on negative numbers.
@item
@code{HOUR()} (and some other @code{TIME} functions) on a @code{CHAR} column
always returned @code{NULL}.
@item
Fixed security bug in something (please upgrade if you are using an earlier
MySQL 3.23 version).
@item
Fixed buffer overflow bug when writing a certain error message.
@item
Added usage of @code{setrlimit()} on Linux to get
@code{-O --open_files_limit=#} to work on Linux.
@item
Added @code{bdb_version} variable to @code{mysqld}.
@item
Fixed bug when using expression of type:
@example
SELECT ... FROM t1 LEFT JOIN t2 ON (t1.a=t2.a) WHERE t1.a=t2.a
@end example
In this case the test in the @code{WHERE} clause was wrongly optimized away.
@item
Fixed bug in @code{MyISAM} when deleting keys with possible @code{NULL}
values, but the first key-column was not a prefix-compressed text column.
@item
Fixed @code{mysql.server} to read the @code{[mysql.server]} option file group
rather than the @code{[mysql_server]} group.
@item
Fixed @code{safe_mysqld} and @code{mysql.server} to also read the
@code{server} option section.
@item
Added @code{Threads_created} status variable to @code{mysqld}.
@end itemize


@node News-3.23.30, News-3.23.29, News-3.23.31, News-3.23.x
@appendixsubsec Changes in release 3.23.30 (04 Jan 2001)

@itemize @bullet
@item
Added @code{SHOW OPEN TABLES} command.
@item
Fixed that @code{myisamdump} works against old @code{mysqld} servers.
@item
Fixed @code{myisamchk -k#} so that it works again.
@item
Fixed a problem with replication when the binary log file went over 2G
on 32-bit systems.
@item
@code{LOCK TABLES} will now automatically start a new transaction.
@item
Changed @code{BDB} tables to not use internal subtransactions and reuse
open files to get more speed.
@item
Added @code{--mysqld=#} option to @code{safe_mysqld}.
@item
Allow hex constants in the @code{--fields-*-by} and
@code{--lines-terminated-by} options to @code{mysqldump} and
@code{mysqlimport}. By Paul DuBois.
@item
Added @code{--safe-show-database} option to @code{mysqld}.
@item
Added @code{have_bdb}, @code{have_gemini}, @code{have_innobase},
@code{have_raid} and @code{have_openssl} to @code{SHOW VARIABLES} to make it
easy to test for supported extensions.
@item
Added @code{--open-files-limit} option to @code{mysqld}.
@item
Changed @code{--open-files} option to @code{--open-files-limit} in
@code{safe_mysqld}.
@item
Fixed a bug where some rows were not found with @code{HEAP} tables
that had many keys.
@item
Fixed that @code{--bdb-no-sync} works.
@item
Changed @code{--bdb-recover} to @code{--bdb-no-recover} as recover should
be on by default.
@item
Changed the default number of @code{BDB} locks to 10000.
@item
Fixed a bug from 3.23.29 when allocating the shared structure needed
for @code{BDB} tables.
@item
Changed @code{mysqld_multi.sh} to use configure variables. Patch by
Christopher McCrory.
@item
Added fixing of include files for Solaris 2.8.
@item
Fixed bug with @code{--skip-networking} on Debian Linux.
@item
Fixed problem that some temporary files where reported as having the
name @code{UNOPENED} in error messages.
@item
Fixed bug when running two simultaneous @code{SHOW LOGS} queries.
@end itemize


@node News-3.23.29, News-3.23.28, News-3.23.30, News-3.23.x
@appendixsubsec Changes in release 3.23.29 (16 Dec 2000)

@itemize @bullet
@item
Configure updates for Tru64, large file support, and better TCP wrapper
support. By Albert Chin-A-Young.
@item
Fixed bug in @code{<=>} operator.
@item
Fixed bug in @code{REPLACE} with @code{BDB} tables.
@item
@code{LPAD()} and @code{RPAD()} will shorten the result string if it's longer
than the length argument.
@item
Added @code{SHOW LOGS} command.
@item
Remove unused @code{BDB} logs on shutdown.
@item
When creating a table, put @code{PRIMARY} keys first, followed by
@code{UNIQUE} keys.
@item
Fixed a bug in @code{UPDATE} involving multi-part keys where one
specified all key parts both in the update and the @code{WHERE} part. In
this case MySQL could try to update a record that didn't match
the whole @code{WHERE} part.
@item
Changed drop table to first drop the tables and then the @file{.frm} file.
@item
Fixed a bug in the hostname cache which caused @code{mysqld} to report the
hostname as @code{''} in some error messages.
@item
Fixed a bug with @code{HEAP} type tables; the variable
@code{max_heap_table_size} wasn't used. Now either @code{MAX_ROWS} or
@code{max_heap_table_size} can be used to limit the size of a @code{HEAP}
type table.
@item
Changed the default server-id to 1 for masters and 2 for slaves
to make it easier to use the binary log.
@item
Renamed @code{bdb_lock_max} variable to @code{bdb_max_lock}.
@item
Added support for @code{AUTO_INCREMENT} on sub-fields for @code{BDB} tables.
@item
Added @code{ANALYZE} of @code{BDB} tables.
@item
In @code{BDB} tables, we now store the number of rows; this helps to optimize
queries when we need an approximation of the number of rows.
@item
If we get an error in a multi-row statement, we now only roll back the
last statement, not the entire transaction.
@item
If you do a @code{ROLLBACK} when you have updated a non-transactional table
you will get an error as a warning.
@item
Added @code{--bdb-shared-data} option to @code{mysqld}.
@item
Added @code{Slave_open_temp_tables} status variable to @code{mysqld}
@item
Added @code{binlog_cache_size} and @code{max_binlog_cache_size} variables to
@code{mysqld}.
@item
@code{DROP TABLE}, @code{RENAME TABLE}, @code{CREATE INDEX} and
@code{DROP INDEX} are now transaction endpoints.
@item
If you do a @code{DROP DATABASE} on a symbolically linked database, both
the link and the original database are deleted.
@item
Fixed @code{DROP DATABASE} to work on OS/2.
@item
Fixed bug when doing a @code{SELECT DISTINCT ... table1 LEFT JOIN
table2 ...} when @code{table2} was empty.
@item
Added @code{--abort-slave-event-count} and
@code{--disconnect-slave-event-count} options to @code{mysqld} for
debugging and testing of replication.
@item
Fixed replication of temporary tables. Handles everything except
slave server restart.
@item
@code{SHOW KEYS} now shows whether key is @code{FULLTEXT}.
@item
New script @code{mysqld_multi}. @xref{mysqld_multi, , @code{mysqld_multi}}.
@item
Added new script, @code{mysql-multi.server.sh}.  Thanks to
Tim Bunce @email{Tim.Bunce@@ig.co.uk} for modifying @code{mysql.server} to
easily handle hosts running many @code{mysqld} processes.
@item
@code{safe_mysqld}, @code{mysql.server}, and @code{mysql_install_db} have
been modified to use @code{mysql_print_defaults} instead of various hacks
to read the @file{my.cnf} files.  In addition, the handling of various
paths has been made more consistent with how @code{mysqld} handles them
by default.
@item
Automatically remove Berkeley DB transaction logs that no longer are in
use.
@item
Fixed bug with several @code{FULLTEXT} indexes in one table.
@item
Added a warning if number of rows changes on @code{REPAIR}/@code{OPTIMIZE}.
@item
Applied patches for OS/2 by @code{Yuri Dario}.
@item
@code{FLUSH TABLES tbl_name} didn't always flush the index tree
to disk properly.
@item
@code{--bootstrap} is now run in a separate thread. This fixes a problem
that caused @code{mysql_install_db} to core dump on some Linux machines.
@item
Changed @code{mi_create()} to use less stack space.
@item
Fixed bug with optimizer trying to over-optimize @code{MATCH()} when used
with @code{UNIQUE} key.
@item
Changed @code{crash-me} and the MySQL benchmarks to also work
with FrontBase.
@item
Allow @code{RESTRICT} and @code{CASCADE} after @code{DROP TABLE} to make
porting easier.
@item
Reset status variable which could cause problem if one used @code{--slow-log}.
@item
Added @code{connect_timeout} variable to @code{mysql} and @code{mysqladmin}.
@item
Added @code{connect-timeout} as an alias for @code{timeout} for option files
read by @code{mysql_options()}.
@end itemize


@node News-3.23.28, News-3.23.27, News-3.23.29, News-3.23.x
@appendixsubsec Changes in release 3.23.28 (22 Nov 2000: Gamma)

@itemize @bullet
@item
Added new options @code{--pager[=...]}, @code{--no-pager},
@code{--tee=...} and @code{--no-tee} to the @code{mysql} client.  The
new corresponding interactive commands are @code{pager}, @code{nopager},
@code{tee} and @code{notee}. @xref{mysql, , @code{mysql}}, @code{mysql --help}
and the interactive help for more information.
@item
Fixed crash when automatic repair of @code{MyISAM} table failed.
@item
Fixed a major performance bug in the table locking code when one
constantly had a lot of @code{SELECT}, @code{UPDATE} and @code{INSERT}
statements running. The symptom was that the @code{UPDATE} and
@code{INSERT} queries were locked for a long time while new @code{SELECT}
statements were executed before the updates.
@item
When reading @code{options_files} with @code{mysql_options()} the
@code{return-found-rows} option was ignored.
@item
One can now specify @code{interactive-timeout} in the option file that
is read by @code{mysql_options()}. This makes it possible to force
programs that run for a long time (like @code{mysqlhotcopy}) to use the
@code{interactive_timeout} time instead of the @code{wait_timeout} time.
@item
Added to the slow query log the time and the username for each logged
query. If you are using @code{--log-long-format} then also queries that
do not use an index are logged, even if the query takes less than
@code{long_query_time} seconds.
@item
Fixed a problem in @code{LEFT JOIN} which caused all columns in a reference
table to be @code{NULL}.
@item
Fixed a problem when using @code{NATURAL JOIN} without keys.
@item
Fixed a bug when using a multi-part keys where the first part was of type
@code{TEXT} or @code{BLOB}.
@item
@code{DROP} of temporary tables wasn't stored in the update/binary log.
@item
Fixed a bug where @code{SELECT DISTINCT * ... LIMIT row_count} only returned one row.
@item
Fixed a bug in the assembler code in @code{strstr()} for SPARC and cleaned up
the @file{global.h} header file to avoid a problem with bad aliasing with
the compiler submitted with Red Hat 7.0. (Reported by Trond Eivind Glomsr@o{}d)
@item
The @code{--skip-networking} option now works properly on NT.
@item
Fixed a long outstanding bug in the @code{ISAM} tables when a row with a length
of more than 65K was shortened by a single byte.
@item
Fixed a bug in @code{MyISAM} when running multiple updating processes on
the same table.
@item
Allow one to use @code{FLUSH TABLE tbl_name}.
@item
Added @code{--replicate-ignore-table}, @code{--replicate-do-table},
@code{--replicate-wild-ignore-table}, and @code{--replicate-wild-do-table}
options to @code{mysqld}.
@item
Changed all log files to use our own @code{IO_CACHE} mechanism instead of
@code{FILE} to avoid OS problems when there are many files open.
@item
Added @code{--open-files} and @code{--timezone} options to @code{safe_mysqld}.
@item
Fixed a fatal bug in @code{CREATE TEMPORARY TABLE ... SELECT ...}.
@item
Fixed a problem with @code{CREATE TABLE ... SELECT NULL}.
@item
Added variables @code{large_file_support},@code{net_read_timeout},
@code{net_write_timeout} and @code{query_buffer_size} to @code{SHOW VARIABLES}.
@item
Added status variables @code{created_tmp_files} and @code{sort_merge_passes}
to @code{SHOW STATUS}.
@item
Fixed a bug where we didn't allow an index name after the
@code{FOREIGN KEY} definition.
@item
Added @code{TRUNCATE table_name} as a synonym for
@code{DELETE FROM table_name}.
@item
Fixed a bug in a @code{BDB} key compare function when comparing part keys.
@item
Added @code{bdb_lock_max} variable to @code{mysqld}.
@item
Added more tests to the benchmark suite.
@item
Fixed an overflow bug in the client code when using overly long database names.
@item
@code{mysql_connect()} now aborts on Linux if the server doesn't answer in
@code{timeout} seconds.
@item
@code{SLAVE START} did not work if you started with
@code{--skip-slave-start} and had not explicitly run @code{CHANGE MASTER TO}.
@item
Fixed the output of @code{SHOW MASTER STATUS} to be consistent with
@code{SHOW SLAVE STATUS}. (It now has no directory in the log name.)
@item
Added @code{PURGE MASTER LOGS TO}.
@item
Added @code{SHOW MASTER LOGS}.
@item
Added @code{--safemalloc-mem-limit} option to @code{mysqld} to simulate memory
shortage when compiled with the @code{--with-debug=full} option.
@item
Fixed several core dumps in out-of-memory conditions.
@item
@code{SHOW SLAVE STATUS} was using an uninitialized mutex if the slave had
not been started yet.
@item
Fixed bug in @code{ELT()} and @code{MAKE_SET()} when the query used
a temporary table.
@item
@code{CHANGE MASTER TO} without specifying @code{MASTER_LOG_POS} would
set it to 0 instead of 4 and hit the magic number in the master binlog.
@item
@code{ALTER TABLE ... ORDER BY ...} syntax added.  This will create the
new table with the rows in a specific order.
@end itemize


@node News-3.23.27, News-3.23.26, News-3.23.28, News-3.23.x
@appendixsubsec Changes in release 3.23.27 (24 Oct 2000)

@itemize @bullet
@item
Fixed a bug where the automatic repair of @code{MyISAM} tables sometimes failed
when the datafile was corrupt.
@item
Fixed a bug in @code{SHOW CREATE} when using @code{AUTO_INCREMENT} columns.
@item
Changed @code{BDB} tables to use new compare function in Berkeley DB 3.2.3.
@item
You can now use Unix socket files with MIT-pthreads.
@item
Added the @code{latin5} (turkish) character set.
@item
Small portability fixes.
@end itemize


@node News-3.23.26, News-3.23.25, News-3.23.27, News-3.23.x
@appendixsubsec Changes in release 3.23.26 (18 Oct 2000)

@itemize @bullet
@item
Renamed @code{FLUSH MASTER} and @code{FLUSH SLAVE} to @code{RESET MASTER}
and @code{RESET SLAVE}.
@item
Fixed @code{<>} to work properly with @code{NULL}.
@item
Fixed a problem with @code{SUBSTRING_INDEX()} and @code{REPLACE()}.
(Patch by Alexander Igonitchev)
@item
Fix @code{CREATE TEMPORARY TABLE IF NOT EXISTS} not to produce an error
if the table exists.
@item
If you don't create a @code{PRIMARY KEY} in a @code{BDB} table, a hidden
@code{PRIMARY KEY} will be created.
@item
Added read-only-key optimization to @code{BDB} tables.
@item
@code{LEFT JOIN} in some cases preferred a full table scan when there was
no @code{WHERE} clause.
@item
When using @code{--log-slow-queries}, don't count the time waiting for a lock.
@item
Fixed bug in lock code on Windows which could cause the key cache
to report that the key file was crashed even if it was okay.
@item
Automatic repair of @code{MyISAM} tables if you start @code{mysqld} with
@code{--myisam-recover}.
@item
Removed the @code{TYPE=} keyword from @code{CHECK} and
@code{REPAIR}. Allow @code{CHECK} options to be combined. (You can still
use @code{TYPE=}, but this usage is deprecated.)
@item
Fixed mutex bug in the binary replication log --- long update queries could
be read only in part by the slave if it did it at the wrong time, which
was not fatal, but resulted in a performance-degrading reconnect and
a scary message in the error log.
@item
Changed the format of the binary log --- added magic number, server
version, binlog version. Added the server ID and query error code for each
query event.
@item
Replication thread from the slave now will kill all the stale threads
from the same server.
@item
Long replication usernames were not being handled properly.
@item
Added @code{--replicate-rewrite-db} option to @code{mysqld}.
@item
Added @code{--skip-slave-start} option to @code{mysqld}.
@item
Updates that generated an error code (such as @code{INSERT INTO foo(some_key)
values (1),(1)}) erroneously terminated the slave thread.
@item
Added optimization of queries where @code{DISTINCT} is used only on columns
from some of the tables.
@item
Allow floating-point numbers where there is no sign after the exponent
(like @code{1e1}).
@item
@code{SHOW GRANTS} didn't always show all column grants.
@item
Added @code{--default-extra-file=#} option to all MySQL clients.
@item
Columns referenced in @code{INSERT} statements now are initialized properly.
@item
@code{UPDATE} didn't always work when used with a range on a timestamp that
was part of the key that was used to find rows.
@item
Fixed a bug in @code{FULLTEXT} index when inserting a @code{NULL} column.
@item
Changed to use @code{mkstemp()} instead of @code{tempnam()}. Based
on a patch from John Jones.
@end itemize


@node News-3.23.25, News-3.23.24, News-3.23.26, News-3.23.x
@appendixsubsec Changes in release 3.23.25 (29 Sep 2000)

@itemize @bullet
@item
Fixed that @code{databasename} works as second argument to @code{mysqlhotcopy}.
@item
The values for the @code{UMASK} and @code{UMASK_DIR} environment variables
now can be specified in octal by beginning the value with a zero.
@item
Added @code{RIGHT JOIN}. This makes @code{RIGHT} a reserved word.
@item
Added @code{@@@@IDENTITY} as a synonym for @code{LAST_INSERT_ID()}.
(This is for MSSQL compatibility.)
@item
Fixed a bug in @code{myisamchk} and @code{REPAIR} when using @code{FULLTEXT}
index.
@item
@code{LOAD DATA INFILE} now works with FIFOs.
(Patch by Toni L. Harbaugh-Blackford.)
@item
@code{FLUSH LOGS} broke replication if you specified a log name with an
explicit extension as the value of the @code{log-bin} option.
@item
Fixed a bug in @code{MyISAM} with packed multi-part keys.
@item
Fixed crash when using @code{CHECK TABLE} on Windows.
@item
Fixed a bug where @code{FULLTEXT} index always used the @code{koi8_ukr}
character set.
@item
Fixed privilege checking for @code{CHECK TABLE}.
@item
The @code{MyISAM} repair/reindex code didn't use the @code{--tmpdir}
option for its temporary files.
@item
Added @code{BACKUP TABLE} and @code{RESTORE TABLE}.
@item
Fixed core dump on @code{CHANGE MASTER TO} when the slave did not have
the master to start with.
@item
Fixed incorrect @code{Time} in the processlist for @code{Connect} of
the slave thread.
@item
The slave now logs when it connects to the master.
@item
Fixed a core dump bug when doing @code{FLUSH MASTER} if you didn't specify
a filename argument to @code{--log-bin}.
@item
Added missing @file{ha_berkeley.x} files to the MySQL Windows distribution.
@item
Fixed some mutex bugs in the log code that could cause thread blocks if new
log files couldn't be created.
@item
Added lock time and number of selected processed rows to slow query log.
@item
Added @code{--memlock} option to @code{mysqld} to lock @code{mysqld}
in memory on systems with the @code{mlockall()} call (as in Solaris).
@item
@code{HEAP} tables didn't use keys properly. (Bug from 3.23.23.)
@item
Added better support for @code{MERGE} tables (keys, mapping, creation,
documentation...). @xref{MERGE, , @code{MERGE}}.
@item
Fixed bug in @code{mysqldump} from 3.23 which caused some @code{CHAR} columns
not to be quoted.
@item
Merged @code{analyze}, @code{check}, @code{optimize} and repair code.
@item
@code{OPTIMIZE TABLE} is now mapped to @code{REPAIR} with statistics and
sorting of the index tree.  This means that for the moment it only
works on @code{MyISAM} tables.
@item
Added a pre-alloced block to root_malloc to get fewer mallocs.
@item
Added a lot of new statistics variables.
@item
Fixed @code{ORDER BY} bug with @code{BDB} tables.
@item
Removed warning that @code{mysqld} couldn't remove the @file{.pid} file
under Windows.
@item
Changed @code{--log-isam} to log @code{MyISAM} tables instead of isam
tables.
@item
Fixed @code{CHECK TABLE} to work on Windows.
@item
Added file mutexes to make @code{pwrite()} safe on Windows.
@end itemize


@node News-3.23.24, News-3.23.23, News-3.23.25, News-3.23.x
@appendixsubsec Changes in release 3.23.24 (08 Sep 2000)

@itemize @bullet
@item
Added @code{created_tmp_disk_tables} variable to @code{mysqld}.
@item
To make it possible to reliably dump and restore tables with
@code{TIMESTAMP(X)} columns, MySQL now reports columns with @code{X}
other than 14 or 8 to be strings.
@item
Changed sort order for @code{latin1} as it was before MySQL Version 3.23.23.
Any table that was created or modified with 3.23.22 must be repaired if it has
@code{CHAR} columns that may contain characters with ASCII values greater than
128!
@item
Fixed small memory leak introduced from 3.23.22 when creating a
temporary table.
@item
Fixed problem with @code{BDB} tables and reading on a unique (not primary) key.
@item
Restored the @code{win1251} character set (it's now only marked deprecated).
@end itemize


@node News-3.23.23, News-3.23.22, News-3.23.24, News-3.23.x
@appendixsubsec Changes in release 3.23.23 (01 Sep 2000)

@itemize @bullet
@item
Changed sort order for 'German'; all tables created with 'German' sortorder
must be repaired with @code{REPAIR TABLE} or @code{myisamchk} before use!
@item
Added @code{--core-file} option to @code{mysqld} to get a core file on
Linux if @code{mysqld} dies on the @code{SIGSEGV} signal.
@item
MySQL client @code{mysql} now starts with option
@code{--no-named-commands} (@code{-g}) by default. This option can be
disabled with @code{--enable-named-commands} (@code{-G}). This may cause
incompatibility problems in some cases, for example, in SQL scripts that
use named commands without a semicolon, etc.!  Long format commands
still work from the first line.
@item
Fixed a problem when using many pending @code{DROP TABLE} statements at
the same time.
@item
Optimizer didn't use keys properly when using @code{LEFT JOIN} on an
empty table.
@item
Added shorter help text when invoking @code{mysqld} with incorrect options.
@item
Fixed non-fatal @code{free()} bug in @code{mysqlimport}.
@item
Fixed bug in @code{MyISAM} index handling of
@code{DECIMAL}/@code{NUMERIC} keys.
@item
Fixed a bug in concurrent insert in @code{MyISAM} tables.  In some contexts,
usage of @code{MIN(key_part)} or @code{MAX(key_part)} returned an empty set.
@item
Updated @code{mysqlhotcopy} to use the new @code{FLUSH TABLES table_list}
syntax. Only tables which are being backed up are flushed now.
@item
Changed behavior of @code{--enable-thread-safe-client} so
that both non-threaded (@code{-lmysqlclient}) and threaded
(@code{-lmysqlclient_r}) libraries are built.  Users who linked
against a threaded @code{-lmysqlclient} will need to link against
@code{-lmysqlclient_r} now.
@item
Added atomic @code{RENAME TABLE} command.
@item
Don't count @code{NULL} values in @code{COUNT(DISTINCT ...)}.
@item
Changed @code{ALTER TABLE}, @code{LOAD DATA INFILE} on empty tables and
@code{INSERT ... SELECT ...} on empty tables to create non-unique indexes
in a separate batch with sorting. This will make the above calls much
faster when you have many indexes.
@item
@code{ALTER TABLE} now logs the first used insert_id correctly.
@item
Fixed crash when adding a default value to a @code{BLOB} column.
@item
Fixed a bug with @code{DATE_ADD/DATE_SUB} where it returned a datetime instead
of a date.
@item
Fixed a problem with the thread cache which made some threads show up as
@code{***DEAD***} in @code{SHOW PROCESSLIST}.
@item
Fixed a lock in our thr_rwlock code, which could make selects that run
at the same time as concurrent inserts crash. This only affects systems
that don't have the @code{pthread_rwlock_rdlock} code.
@item
When deleting rows with a non-unique key in a @code{HEAP} table, all rows
weren't always deleted.
@item
Fixed bug in range optimizer for @code{HEAP} tables for searches on a part
index.
@item
Fixed @code{SELECT} on part keys to work with @code{BDB} tables.
@item
Fixed @code{INSERT INTO bdb_table ... SELECT} to work with @code{BDB} tables.
@item
@code{CHECK TABLE} now updates key statistics for the table.
@item
@code{ANALYZE TABLE} will now only update tables that have been changed
since the last @code{ANALYZE}. Note that this is a new feature and tables
will not be marked to be analysed until they are updated in any way with
3.23.23 or newer.  For older tables, you have to do @code{CHECK TABLE}
to update the key distribution.
@item
Fixed some minor privilege problems with @code{CHECK}, @code{ANALYZE},
@code{REPAIR} and @code{SHOW CREATE} commands.
@item
Added @code{CHANGE MASTER TO} statement.
@item
Added @code{FAST}, @code{QUICK} @code{EXTENDED} check types to
@code{CHECK TABLES}.
@item
Changed @code{myisamchk} so that @code{--fast} and
@code{--check-only-changed} are also honored with @code{--sort-index} and
@code{--analyze}.
@item
Fixed fatal bug in @code{LOAD TABLE FROM MASTER} that did not lock the
table during index re-build.
@item
@code{LOAD DATA INFILE} broke replication if the database was excluded
from replication.
@item
More variables in @code{SHOW SLAVE STATUS} and @code{SHOW MASTER STATUS}.
@item
@code{SLAVE STOP} now will not return until the slave thread actually exits.
@item
Full-text search via the @code{MATCH()} function and @code{FULLTEXT} index type
(for @code{MyISAM} files).  This makes @code{FULLTEXT} a reserved word.
@end itemize


@node News-3.23.22, News-3.23.21, News-3.23.23, News-3.23.x
@appendixsubsec Changes in release 3.23.22 (31 Jul 2000)

@itemize @bullet
@item
Fixed that @code{lex_hash.h} is created properly for each MySQL
distribution.
@item
Fixed that @code{MASTER} and @code{COLLECTION} are not reserved words.
@item
The log generated by @code{--slow-query-log} didn't contain the whole queries.
@item
Fixed that open transactions in @code{BDB} tables are rolled back if the
connection is closed unexpectedly.
@item
Added workaround for a bug in @code{gcc} 2.96 (intel) and @code{gcc} 2.9
(IA-64) in @code{gen_lex_hash.c}.
@item
Fixed memory leak in the client library when using @code{host=} in the
@file{my.cnf} file.
@item
Optimized functions that manipulate the hours/minutes/seconds.
@item
Fixed bug when comparing the result of @code{DATE_ADD()}/@code{DATE_SUB()}
against a number.
@item
Changed the meaning of @code{-F, --fast} for @code{myisamchk}. Added
@code{-C, --check-only-changed} option to @code{myisamchk}.
@item
Added @code{ANALYZE tbl_name} to update key statistics for tables.
@item
Changed binary items @code{0x...} to be regarded as integers by default.
@item
Fix for SCO and @code{SHOW PROCESSLIST}.
@item
Added @code{auto-rehash} on reconnect for the @code{mysql} client.
@item
Fixed a newly introduced bug in @code{MyISAM}, where the index file couldn't
get bigger than 64M.
@item
Added @code{SHOW MASTER STATUS} and @code{SHOW SLAVE STATUS}.
@end itemize


@node News-3.23.21, News-3.23.20, News-3.23.22, News-3.23.x
@appendixsubsec Changes in release 3.23.21

@itemize @bullet
@item
Added @code{mysql_character_set_name()} function to the
MySQL C API.
@item
Made the update log ASCII 0 safe.
@item
Added the @code{mysql_config} script.
@item
Fixed problem when using @code{<} or @code{>} with a char column that was only
partly indexed.
@item
One would get a core dump if the log file was not readable by the MySQL user.
@item
Changed @code{mysqladmin} to use @code{CREATE DATABASE} and @code{DROP
DATABASE} statements instead of the old deprecated API calls.
@item
Fixed @code{chown} warning in @code{safe_mysqld}.
@item
Fixed a bug in @code{ORDER BY} that was introduced in 3.23.19.
@item
Only optimize the @code{DELETE FROM tbl_name} to do a drop+create of
the table if we are in @code{AUTOCOMMIT} mode (needed for @code{BDB} tables).
@item
Added extra checks to avoid index corruption when the @code{ISAM}/@code{MyISAM}
index files get full during an @code{INSERT}/@code{UPDATE}.
@item
@code{myisamchk} didn't correctly update row checksum when used with
@code{-ro} (this only gave a warning in subsequent runs).
@item
Fixed bug in @code{REPAIR TABLE} so that it works with tables without indexes.
@item
Fixed buffer overrun in @code{DROP DATABASE}.
@item
@code{LOAD TABLE FROM MASTER} is sufficiently bug-free to announce it as
a feature.
@item
@code{MATCH} and @code{AGAINST} are now reserved words.
@end itemize


@node News-3.23.20, News-3.23.19, News-3.23.21, News-3.23.x
@appendixsubsec Changes in release 3.23.20

@itemize @bullet
@item
Fixed bug in 3.23.19; @code{DELETE FROM tbl_name} removed the @file{.frm} file.
@item
Added @code{SHOW CREATE TABLE}.
@end itemize


@node News-3.23.19, News-3.23.18, News-3.23.20, News-3.23.x
@appendixsubsec Changes in release 3.23.19

@itemize @bullet
@item
Changed copyright for all files to @code{GPL} for the server code and utilities and
to LGPL for the client libraries.
See @url{http://www.fsf.org/licenses/}.
@item
Fixed bug where all rows matching weren't updated on a @code{MyISAM} table
when doing update based on key on a table with many keys and some key changed
values.
@item
The Linux MySQL RPMs and binaries are now statically linked with
a linuxthread version that has faster mutex handling when used with
MySQL.
@item
@code{ORDER BY} can now use @code{REF} keys to find subsets of the rows
that need to be sorted.
@item
Changed name of @code{print_defaults} program to @code{my_print_defaults}
to avoid name confusion.
@item
Fixed @code{NULLIF()} to work as required by SQL-99.
@item
Added @code{net_read_timeout} and @code{net_write_timeout} as startup
parameters to @code{mysqld}.
@item
Fixed bug that destroyed index when doing @code{myisamchk --sort-records}
on a table with prefix compressed index.
@item
Added @code{pack_isam} and @code{myisampack} to the standard MySQL
distribution.
@item
Added the syntax @code{BEGIN WORK} (the same as @code{BEGIN}).
@item
Fixed core dump bug when using @code{ORDER BY} on a @code{CONV()} expression.
@item
Added @code{LOAD TABLE FROM MASTER}.
@item
Added @code{FLUSH MASTER} and @code{FLUSH SLAVE}.
@item
Fixed big/little endian problem in the replication.
@end itemize


@node News-3.23.18, News-3.23.17, News-3.23.19, News-3.23.x
@appendixsubsec Changes in release 3.23.18

@itemize @bullet
@item
Fixed a problem from 3.23.17 when choosing character set on the client side.
@item
Added @code{FLUSH TABLES WITH READ LOCK} to make a global lock suitable for
making a copy of MySQL datafiles.
@item
@code{CREATE TABLE ... SELECT ... PROCEDURE} now works.
@item
Internal temporary tables will now use compressed index when using
@code{GROUP BY} on @code{VARCHAR/CHAR} columns.
@item
Fixed a problem when locking the same table with both a @code{READ} and a
@code{WRITE} lock.
@item
Fixed problem with @code{myisamchk} and @code{RAID} tables.
@end itemize


@node News-3.23.17, News-3.23.16, News-3.23.18, News-3.23.x
@appendixsubsec Changes in release 3.23.17

@itemize @bullet
@item
Fixed a bug in @code{FIND_IN_SET()} when the first argument was @code{NULL}.
@item
Added table locks to Berkeley DB.
@item
Fixed a bug with @code{LEFT JOIN} and @code{ORDER BY} where the first
table had only one matching row.
@item
Added 4 sample @file{my.cnf} example files in the @file{support-files}
directory.
@item
Fixed @code{duplicated key} problem when doing big @code{GROUP BY} operations.
(This bug was probably introduced in 3.23.15.)
@item
Changed syntax for @code{INNER JOIN} to match SQL-99.
@item
Added @code{NATURAL JOIN} syntax.
@item
A lot of fixes in the @code{BDB} interface.
@item
Added handling of @code{--no-defaults} and @code{--defaults-file} to
@code{safe_mysqld.sh} and @code{mysql_install_db.sh}.
@item
Fixed bug in reading compressed tables with many threads.
@item
Fixed that @code{USE INDEX} works with @code{PRIMARY} keys.
@item
Added @code{BEGIN} statement to start a transaction in @code{AUTOCOMMIT} mode.
@item
Added support for symbolic links for Windows.
@item
Changed protocol to let client know if the server is in @code{AUTOCOMMIT} mode
and if there is a pending transaction.  If there is a pending transaction,
the client library will give an error before reconnecting to the server to
let the client know that the server did a rollback.
The protocol is still backward-compatible with old clients.
@item
@code{KILL} now works on a thread that is locked on a 'write' to a dead client.
@item
Fixed memory leak in the replication slave thread.
@item
Added new @code{log-slave-updates} option to @code{mysqld}, to allow
daisy-chaining the slaves.
@item
Fixed compile error on FreeBSD and other systems where @code{pthread_t}
is not the same as @code{int}.
@item
Fixed master shutdown aborting the slave thread.
@item
Fixed a race condition in @code{INSERT DELAYED} code when doing
@code{ALTER TABLE}.
@item
Added deadlock detection sanity checks to @code{INSERT DELAYED}.
@end itemize


@node News-3.23.16, News-3.23.15, News-3.23.17, News-3.23.x
@appendixsubsec Changes in release 3.23.16

@itemize @bullet
@item
Added @code{SLAVE START} and @code{SLAVE STOP} statements.
@item
Added @code{TYPE=QUICK} option to @code{CHECK} and to @code{REPAIR}.
@item
Fixed bug in @code{REPAIR TABLE} when the table was in use by other threads.
@item
Added a thread cache to make it possible to debug MySQL with
@code{gdb} when one does a lot of reconnects. This will also improve
systems where you can't use persistent connections.
@item
Lots of fixes in the Berkeley DB interface.
@item
@code{UPDATE IGNORE} will not abort if an update results in a
@code{DUPLICATE_KEY} error.
@item
Put @code{CREATE TEMPORARY TABLE} commands in the update log.
@item
Fixed bug in handling of masked IP numbers in the privilege tables.
@item
Fixed bug with @code{delay_key_write} tables and @code{CHECK TABLE}.
@item
Added @code{replicate-do-db} and @code{replicate-ignore-db} options to
@code{mysqld}, to restrict which databases get replicated.
@item
Added @code{SQL_LOG_BIN} option.
@end itemize


@node News-3.23.15, News-3.23.14, News-3.23.16, News-3.23.x
@appendixsubsec Changes in release 3.23.15 (May 2000: Beta)

@itemize @bullet
@item
To start @code{mysqld} as @code{root}, you must now use the @code{--user=root} option.
@item
Added interface to Berkeley DB. (This is not yet functional; play with it at
your own risk!)
@item
Replication between master and slaves.
@item
Fixed bug that other threads could steal a lock when a thread had
a lock on a table and did a @code{FLUSH TABLES} command.
@item
Added the @code{slow_launch_time} variable and the @code{Slow_launch_threads}
status variable to @code{mysqld}.  These can be examined with
@code{mysqladmin variables} and @code{mysqladmin extended-status}.
@item
Added functions @code{INET_NTOA()} and @code{INET_ATON()}.
@item
The default type of @code{IF()} now depends on the second and
third arguments and not only on the second argument.
@item
Fixed case when @code{myisamchk} could go into a loop when trying to
repair a crashed table.
@item
Don't write @code{INSERT DELAYED} to update log if @code{SQL_LOG_UPDATE=0}.
@item
Fixed problem with @code{REPLACE} on @code{HEAP} tables.
@item
Added possible character sets and time zone to @code{SHOW VARIABLES} output.
@item
Fixed bug in locking code that could result in locking problems with
concurrent inserts under high load.
@item
Fixed a problem with @code{DELETE} of many rows on a table with
compressed keys where MySQL scanned the index to find the rows.
@item
Fixed problem with @code{CHECK} on table with deleted keyblocks.
@item
Fixed a bug in reconnect (at the client side) where it didn't free memory
properly in some contexts.
@item
Fixed problems in update log when using @code{LAST_INSERT_ID()} to update
a table with an @code{AUTO_INCREMENT} key.
@item
Added @code{NULLIF()} function.
@item
Fixed bug when using @code{LOAD DATA INFILE} on a table with
@code{BLOB/TEXT} columns.
@item
Optimized @code{MyISAM} to be faster when inserting keys in sorted order.
@item
@code{EXPLAIN SELECT ...} now also prints out whether MySQL needs to
create a temporary table or use file sorting when resolving the @code{SELECT}.
@item
Added optimization to skip @code{ORDER BY} parts where the part is a
constant expression in the @code{WHERE} part.  Indexes can now be used
even if the @code{ORDER BY} doesn't match the index exactly, as long as
all the unused index parts and all the extra @code{ORDER BY}
columns are constants in the @code{WHERE} clause.  @xref{MySQL indexes}.
@item
@code{UPDATE} and @code{DELETE} on a whole unique key in the @code{WHERE} part
are now faster than before.
@item
Changed @code{RAID_CHUNKSIZE} to be in 1024-byte increments.
@item
Fixed core dump in @code{LOAD_FILE(NULL)}.
@end itemize


@node News-3.23.14, News-3.23.13, News-3.23.15, News-3.23.x
@appendixsubsec Changes in release 3.23.14

@itemize @bullet
@item
Added @code{mysql_real_escape_string()} function to the MySQL C API.
@item
Fixed a bug in @code{CONCAT()} where one of the arguments was a function
that returned a modified argument.
@item
Fixed a critical bug in @code{myisamchk}, where it updated the header in
the index file when one only checked the table.  This confused the
@code{mysqld} daemon if it updated the same table at the same time. Now
the status in the index file is only updated if one uses
@code{--update-state}.  With older @code{myisamchk} versions you should
use @code{--read-only} when only checking tables, if there is the
slightest chance that the @code{mysqld} server is working on the table at the
same time!
@item
Fixed that @code{DROP TABLE} is logged in the update log.
@item
Fixed problem when searching on @code{DECIMAL()} key field
where the column data contained leading zeros.
@item
Fix bug in @code{myisamchk} when the @code{AUTO_INCREMENT} column isn't
the first key.
@item
Allow @code{DATETIME} in ISO8601 format: 2000-03-12T12:00:00
@item
Dynamic character sets.  A @code{mysqld} binary can now handle many different
character sets (you can choose which when starting @code{mysqld}).
@item
Added command @code{REPAIR TABLE}.
@item
Added @code{mysql_thread_safe()} function to the MySQL C API.
@item
Added the @code{UMASK_DIR} environment variable.
@item
Added @code{CONNECTION_ID()} function to return the client connection thread
ID.
@item
When using @code{=} on @code{BLOB} or @code{VARCHAR BINARY} keys, where
only a part of the column was indexed, the whole column of the result
row wasn't compared.
@item
Fix for @code{sjis} character set and @code{ORDER BY}.
@item
When running in ANSI mode, don't allow columns to be used that aren't in
the @code{GROUP BY} part.
@end itemize


@node News-3.23.13, News-3.23.12, News-3.23.14, News-3.23.x
@appendixsubsec Changes in release 3.23.13

@itemize @bullet
@item
Fixed problem when doing locks on the same table more than 2 times in
the same @code{LOCK TABLE} command; this fixed the problem one got when running
the test-ATIS test with @code{--fast} or @code{--check-only-changed}.
@item
Added @code{SQL_BUFFER_RESULT} option to @code{SELECT}.
@item
Removed end space from double/float numbers in results from temporary
tables.
@item
Added @code{CHECK TABLE} command.
@item
Added changes for @code{MyISAM} in 3.23.12 that didn't get into the source
distribution because of CVS problems.
@item
Fixed bug so that @code{mysqladmin shutdown} will wait for the local server
to close down.
@item
Fixed a possible endless loop when calculating timestamp.
@item
Added @code{print_defaults} program to the @file{.rpm} files. Removed
@code{mysqlbug} from the client @file{.rpm} file.
@end itemize


@node News-3.23.12, News-3.23.11, News-3.23.13, News-3.23.x
@appendixsubsec Changes in release 3.23.12 (07 Mar 2000)

@itemize @bullet
@item
Fixed bug in @code{MyISAM} involving @code{REPLACE ... SELECT ...} which could
give a corrupted table.
@item
Fixed bug in @code{myisamchk} where it incorrectly reset the
@code{AUTO_INCREMENT} value.
@item
LOTS of patches for Linux Alpha. MySQL now appears to be relatively
stable on Alpha.
@item
Changed @code{DISTINCT} on @code{HEAP} temporary tables to use hashed
keys to quickly find duplicated rows. This mostly concerns queries of
type @code{SELECT DISTINCT ... GROUP BY ...}.  This fixes a problem where
not all duplicates were removed in queries of the above type.  In
addition, the new code is MUCH faster.
@item
Added patches to make MySQL compile on Mac OS X.
@item
Added @code{IF NOT EXISTS} clause to @code{CREATE DATABASE}.
@item
Added @code{--all-databases} and @code{--databases} options to @code{mysqldump}
to allow dumping of many databases at the same time.
@item
Fixed bug in compressed @code{DECIMAL()} index in @code{MyISAM} tables.
@item
Fixed bug when storing 0 into a timestamp.
@item
When doing @code{mysqladmin shutdown} on a local connection, @code{mysqladmin}
now waits until the PID file is gone before terminating.
@item
Fixed core dump with some @code{COUNT(DISTINCT ...)} queries.
@item
Fixed that @code{myisamchk} works properly with RAID tables.
@item
Fixed problem with @code{LEFT JOIN} and @code{key_field IS NULL}.
@item
Fixed bug in @code{net_clear()} which could give the error @code{Aborted
connection} in the MySQL clients.
@item
Added options @code{USE INDEX (key_list)} and @code{IGNORE INDEX (key_list)} as
parameters in @code{SELECT}.
@item
@code{DELETE} and @code{RENAME} should now work on @code{RAID} tables.
@end itemize


@node News-3.23.11, News-3.23.10, News-3.23.12, News-3.23.x
@appendixsubsec Changes in release 3.23.11

@itemize @bullet
@item
Allow the @code{ALTER TABLE tbl_name ADD (field_list)} syntax.
@item
Fixed problem with optimizer that could sometimes use incorrect keys.
@item
Fixed that @code{GRANT/REVOKE ALL PRIVILEGES} doesn't affect
@code{GRANT OPTION}.
@item
Removed extra @samp{)} from the output of @code{SHOW GRANTS}.
@item
Fixed problem when storing numbers in timestamps.
@item
Fix problem with time zones that have half hour offsets.
@item
Allow the syntax @code{UNIQUE INDEX} in @code{CREATE} statements.
@item
@code{mysqlhotcopy} - fast online hot-backup utility for local
MySQL databases. By Tim Bunce.
@item
New more secure @code{mysqlaccess}. Thanks to Steve Harvey for this.
@item
Added @code{--i-am-a-dummy} and @code{--safe-updates} options to @code{mysql}.
@item
Added @code{select_limit} and @code{max_join_size} variables to @code{mysql}.
@item
Added @code{SQL_MAX_JOIN_SIZE} and @code{SQL_SAFE_UPDATES} options.
@item
Added @code{READ LOCAL} lock that doesn't lock the table for concurrent
inserts. (This is used by @code{mysqldump}.)
@item
Changed that @code{LOCK TABLES ... READ} no longer allows concurrent
inserts.
@item
Added @code{--skip-delay-key-write} option to @code{mysqld}.
@item
Fixed security problem in the protocol regarding password checking.
@item
@code{_rowid} can now be used as an alias for an integer type unique indexed
column.
@item
Added back blocking of @code{SIGPIPE} when compiling with @code{--thread-safe-clients}
to make things safe for old clients.
@end itemize


@node News-3.23.10, News-3.23.9, News-3.23.11, News-3.23.x
@appendixsubsec Changes in release 3.23.10

@itemize @bullet
@item
Fixed bug in 3.23.9 where memory wasn't properly freed when using
@code{LOCK TABLES}.
@end itemize


@node News-3.23.9, News-3.23.8, News-3.23.10, News-3.23.x
@appendixsubsec Changes in release 3.23.9

@itemize @bullet
@item
Fixed problem that affected queries that did arithmetic on group functions.
@item
Fixed problem with timestamps and @code{INSERT DELAYED}.
@item
Fixed that @code{date_col BETWEEN const_date AND const_date} works.
@item
Fixed problem when only changing a 0 to @code{NULL} in a table with
@code{BLOB/TEXT} columns.
@item
Fixed bug in range optimizer when using many key parts and or on the middle
key parts:  @code{WHERE K1=1 and K3=2 and (K2=2 and K4=4 or K2=3 and K4=5)}
@item
Added @code{source} command to @code{mysql} to allow reading of batch files
inside the @code{mysql} client.  Original patch by Matthew Vanecek.
@item
Fixed critical problem with the @code{WITH GRANT OPTION} option.
@item
Don't give an unnecessary @code{GRANT} error when using tables from many
databases in the same query.
@item
Added VIO wrapper (needed for SSL support; by Andrei Errapart and
T@~onu Samuel).
@item
Fixed optimizer problem on @code{SELECT} when using many overlapping indexes.
MySQL should now be able to choose keys even better when there
are many keys to choose from.
@item
Changed optimizer to prefer a range key instead of a ref key when the
range key can uses more columns than the ref key (which only can use
columns with @code{=}).  For example, the following type of queries should now
be faster: @code{SELECT * from key_part_1=const and key_part_2 > const2}
@item
Fixed bug that a change of all @code{VARCHAR} columns to @code{CHAR} columns
didn't change row type from dynamic to fixed.
@item
Disabled floating-point exceptions for FreeBSD to fix core dump when
doing @code{SELECT FLOOR(POW(2,63))}.
@item
Renamed @code{mysqld} startup option from @code{--delay-key-write} to
@code{--delay-key-write-for-all-tables}.
@item
Added @code{read-next-on-key} to @code{HEAP} tables.  This should fix all
problems with @code{HEAP} tables when using non-@code{UNIQUE} keys.
@item
Added option to print default arguments to all clients.
@item
Added @code{--log-slow-queries} option to @code{mysqld} to log all queries
that take a long time to a separate log file with a time indicating how
long the query took.
@item
Fixed core dump when doing @code{WHERE key_col=RAND(...)}.
@item
Fixed optimization bug in @code{SELECT ... LEFT JOIN ... key_col IS NULL},
when @code{key_col} could contain @code{NULL} values.
@item
Fixed problem with 8-bit characters as separators in @code{LOAD DATA INFILE}.
@end itemize


@node News-3.23.8, News-3.23.7, News-3.23.9, News-3.23.x
@appendixsubsec Changes in release 3.23.8 (02 Jan 2000)

@itemize @bullet
@item
Fixed problem when handling indexfiles larger than 8G.
@item
Added latest patches to MIT-pthreads for NetBSD.
@item
Fixed problem with time zones that are < GMT - 11.
@item
Fixed a bug when deleting packed keys in @code{NISAM}.
@item
Fixed problem with @code{ISAM} when doing some @code{ORDER BY ... DESC} queries.
@item
Fixed bug when doing a join on a text key which didn't cover the whole key.
@item
Option @code{--delay-key-write} didn't enable delayed key writing.
@item
Fixed update of @code{TEXT} column which involved only case changes.
@item
Fixed that @code{INSERT DELAYED} doesn't update timestamps that are given.
@item
Added function @code{YEARWEEK()} and options @code{x}, @code{X}, @code{v} and
@code{V} to @code{DATE_FORMAT()}.
@item
Fixed problem with @code{MAX(indexed_column)} and @code{HEAP} tables.
@item
Fixed problem with @code{BLOB NULL} keys and @code{LIKE "prefix%"}.
@item
Fixed problem with @code{MyISAM} and fixed-length rows < 5 bytes.
@item
Fixed problem that could cause MySQL to touch freed memory when
doing very complicated @code{GROUP BY} queries.
@item
Fixed core dump if you got a crashed table where an @code{ENUM} field value
was too big.
@end itemize


@node News-3.23.7, News-3.23.6, News-3.23.8, News-3.23.x
@appendixsubsec Changes in release 3.23.7 (10 Dec 1999)

@itemize @bullet
@item
Fixed workaround under Linux to avoid problems with
@code{pthread_mutex_timedwait()},
which is used with @code{INSERT DELAYED}. @xref{Linux}.
@item
Fixed that one will get a 'disk full' error message if one gets disk full
when doing sorting (instead of waiting until we got more disk space).
@item
Fixed a bug in @code{MyISAM} with keys > 250 characters.
@item
In @code{MyISAM} one can now do an @code{INSERT} at the same time as other
threads are reading from the table.
@item
Added @code{max_write_lock_count} variable to @code{mysqld} to force a
@code{READ} lock after a certain number of @code{WRITE} locks.
@item
Inverted flag @code{delay_key_write} on @code{show variables}.
@item
Renamed @code{concurrency} variable to @code{thread_concurrency}.
@item
The following functions are now multi-byte-safe:
@code{LOCATE(substr,str)}, @code{POSITION(substr IN str)},
@code{LOCATE(substr,str,pos)}, @code{INSTR(str,substr)},
@code{LEFT(str,len)}, @code{RIGHT(str,len)},
@code{SUBSTRING(str,pos,len)}, @code{SUBSTRING(str FROM pos FOR len)},
@code{MID(str,pos,len)}, @code{SUBSTRING(str,pos)}, @code{SUBSTRING(str
FROM pos)}, @code{SUBSTRING_INDEX(str,delim,count)}, @code{RTRIM(str)},
@code{TRIM([[BOTH | TRAILING] [remstr] FROM] str)},
@code{REPLACE(str,from_str,to_str)}, @code{REVERSE(str)},
@code{INSERT(str,pos,len,newstr)}, @code{LCASE(str)}, @code{LOWER(str)},
@code{UCASE(str)} and @code{UPPER(str)}; patch by Wei He.
@item
Fix core dump when releasing a lock from a non-existent table.
@item
Remove locks on tables before starting to remove duplicates.
@item
Added option @code{FULL} to @code{SHOW PROCESSLIST}.
@item
Added option @code{--verbose} to @code{mysqladmin}.
@item
Fixed problem when automatically converting @code{HEAP} to @code{MyISAM}.
@item
Fixed bug in @code{HEAP} tables when doing insert + delete + insert + scan the
table.
@item
Fixed bugs on Alpha with @code{REPLACE()} and @code{LOAD DATA INFILE}.
@item
Added @code{interactive_timeout} variable to @code{mysqld}.
@item
Changed the argument to @code{mysql_data_seek()} from @code{ulong} to
@code{ulonglong}.
@end itemize


@node News-3.23.6, News-3.23.5, News-3.23.7, News-3.23.x
@appendixsubsec Changes in release 3.23.6

@itemize @bullet
@item
Added @code{-O lower_case_table_names=@{0|1@}} option to @code{mysqld} to allow
users to force table names to lowercase.
@item
Added @code{SELECT ... INTO DUMPFILE}.
@item
Added @code{--ansi} option to @code{mysqld} to make some functions
SQL-99 compatible.
@item
Temporary table names now start with @code{#sql}.
@item
Added quoting of identifiers with @code{`} (@code{"} in @code{--ansi} mode).
@item
Changed to use @code{snprintf()} when printing floats to avoid some buffer
overflows on FreeBSD.
@item
Made @code{FLOOR()} overflow safe on FreeBSD.
@item
Added @code{--quote-names} option to @code{mysqldump}.
@item
Fixed bug that one could make a part of a @code{PRIMARY KEY NOT NULL}.
@item
Fixed @code{encrypt()} to be thread-safe and not reuse buffer.
@item
Added @code{mysql_odbc_escape_string()} function to support big5 characters in
MyODBC.
@item
Rewrote the storage engine to use classes.  This introduces a lot of new code,
but will make table handling faster and better.
@item
Added patch by Sasha for user-defined variables.
@item
Changed that @code{FLOAT} and @code{DOUBLE} (without any length modifiers)
no longer are fixed decimal point numbers.
@item
Changed the meaning of @code{FLOAT(X)}: Now this is the same as @code{FLOAT} if
@code{X} <= 24 and a @code{DOUBLE} if 24 < @code{X} <= 53.
@item
@code{DECIMAL(X)} is now an alias for @code{DECIMAL(X,0)} and @code{DECIMAL}
is now an alias for @code{DECIMAL(10,0)}.  The same goes for @code{NUMERIC}.
@item
Added option @code{ROW_FORMAT=@{DEFAULT | DYNAMIC | FIXED | COMPRESSED@}} to
@code{CREATE_TABLE}.
@item
@code{DELETE FROM table_name} didn't work on temporary tables.
@item
Changed function @code{CHAR_LENGTH()} to be multi-byte character safe.
@item
Added function @code{ORD(string)}.
@end itemize


@node News-3.23.5, News-3.23.4, News-3.23.6, News-3.23.x
@appendixsubsec Changes in release 3.23.5 (20 Oct 1999)

@itemize @bullet
@item
Fixed some Y2K problems in the new date handling in 3.23.
@item
Fixed problem with @code{SELECT DISTINCT ... ORDER BY RAND()}.
@item
Added patches by Sergei A. Golubchik for text searching on the @code{MyISAM}
level.
@item
Fixed cache overflow problem when using full joins without keys.
@item
Fixed some configure issues.
@item
Some small changes to make parsing faster.
@item
Adding a column after the last field with @code{ALTER TABLE} didn't work.
@item
Fixed problem when using an @code{AUTO_INCREMENT} column in two keys
@item
With @code{MyISAM}, you now can have an @code{AUTO_INCREMENT} column as a key
sub part:
@code{CREATE TABLE foo (a INT NOT NULL AUTO_INCREMENT, b CHAR(5), PRIMARY KEY (b,a))}
@item
Fixed bug in @code{MyISAM} with packed char keys that could be @code{NULL}.
@item
@code{AS} on field name with @code{CREATE TABLE table_name SELECT ...} didn't
work.
@item
Allow use of @code{NATIONAL} and @code{NCHAR} when defining character columns.
This is the same as not using @code{BINARY}.
@item
Don't allow @code{NULL} columns in a @code{PRIMARY KEY} (only in @code{UNIQUE}
keys).
@item
Clear @code{LAST_INSERT_ID()} if one uses this in ODBC:
@code{WHERE auto_increment_column IS NULL}.  This seems to fix some problems
with Access.
@item
@code{SET SQL_AUTO_IS_NULL=0|1} now turns on/off the handling of
searching after the last inserted row with @code{WHERE
auto_increment_column IS NULL}.
@item
Added new variable @code{concurrency} to @code{mysqld} for Solaris.
@item
Added @code{--relative} option to @code{mysqladmin} to make
@code{extended-status} more useful to monitor changes.
@item
Fixed bug when using @code{COUNT(DISTINCT ...)} on an empty table.
@item
Added support for the Chinese character set GBK.
@item
Fixed problem with @code{LOAD DATA INFILE} and @code{BLOB} columns.
@item
Added bit operator @code{~} (negation).
@item
Fixed problem with UDF functions.
@end itemize


@node News-3.23.4, News-3.23.3, News-3.23.5, News-3.23.x
@appendixsubsec Changes in release 3.23.4 (28 Sep 1999)

@itemize @bullet
@item
Inserting a @code{DATETIME} into a @code{TIME} column no longer will
try to store 'days' in it.
@item
Fixed problem with storage of float/double on little endian machines.
(This affected @code{SUM()}.)
@item
Added connect timeout on TCP/IP connections.
@item
Fixed problem with @code{LIKE "%"} on an index that may have @code{NULL} values.
@item
@code{REVOKE ALL PRIVILEGES} didn't revoke all privileges.
@item
Allow creation of temporary tables with same name as the original table.
@item
When granting a user a @code{GRANT} option for a database, he couldn't grant
privileges to other users.
@item
New command: @code{SHOW GRANTS FOR user} (by Sinisa).
@item
New @code{date_add} syntax:  @code{date/datetime + INTERVAL # interval_type}.
By Joshua Chamas.
@item
Fixed privilege check for @code{LOAD DATA REPLACE}.
@item
Automatic fixing of broken include files on Solaris 2.7
@item
Some configure issues to fix problems with big filesystem detection.
@item
@code{REGEXP} is now case-insensitive if you use non-binary strings.
@end itemize


@node News-3.23.3, News-3.23.2, News-3.23.4, News-3.23.x
@appendixsubsec Changes in release 3.23.3

@itemize @bullet
@item
Added patches for MIT-pthreads on NetBSD.
@item
Fixed range bug in @code{MyISAM}.
@item
@code{ASC} is now the default again for @code{ORDER BY}.
@item
Added @code{LIMIT} to @code{UPDATE}.
@item
Added @code{mysql_change_user()} function to the MySQL C API.
@item
Added character set to @code{SHOW VARIABLES}.
@item
Added support of @code{--[whitespace]} comments.
@item
Allow @code{INSERT into tbl_name VALUES ()}, that is, you may now specify
an empty value list to insert a row in which each column is set to its
default value.
@item
Changed @code{SUBSTRING(text FROM pos)} to conform to SQL-99. (Before this
construct returned the rightmost @code{pos} characters.)
@item
@code{SUM()} with @code{GROUP BY} returned 0 on some systems.
@item
Changed output for @code{SHOW TABLE STATUS}.
@item
Added @code{DELAY_KEY_WRITE} option to @code{CREATE TABLE}.
@item
Allow @code{AUTO_INCREMENT} on any key part.
@item
Fixed problem with @code{YEAR(NOW())} and @code{YEAR(CURDATE())}.
@item
Added @code{CASE} construct.
@item
New function @code{COALESCE()}.
@end itemize


@node News-3.23.2, News-3.23.1, News-3.23.3, News-3.23.x
@appendixsubsec Changes in release 3.23.2 (09 Aug 1999)

@itemize @bullet
@item
Fixed range optimizer bug: @code{SELECT * FROM table_name WHERE
key_part1 >= const AND (key_part2 = const OR key_part2 = const)}.  The
bug was that some rows could be duplicated in the result.
@item
Running @code{myisamchk} without @code{-a} updated the index
distribution incorrectly.
@item
@code{SET SQL_LOW_PRIORITY_UPDATES=1} was causing a parse error.
@item
You can now update index columns that are used in the @code{WHERE} clause.
@code{UPDATE tbl_name SET KEY=KEY+1 WHERE KEY > 100}
@item
Date handling should now be a bit faster.
@item
Added handling of fuzzy dates (dates where day or month is 0), such as
@code{'1999-01-00'}.
@item
Fixed optimization of @code{SELECT ... WHERE key_part1=const1 AND
key_part_2=const2 AND key_part1=const4 AND key_part2=const4}; indextype
should be @code{range} instead of @code{ref}.
@item
Fixed @code{egcs} 1.1.2 optimizer bug (when using @code{BLOB} values) on Linux Alpha.
@item
Fixed problem with @code{LOCK TABLES} combined with @code{DELETE FROM table}.
@item
@code{MyISAM} tables now allow keys on @code{NULL} and @code{BLOB/TEXT} columns.
@item
The following join is now much faster:
@code{SELECT ... FROM t1 LEFT JOIN t2 ON ... WHERE t2.not_null_column IS NULL}.
@item
@code{ORDER BY} and @code{GROUP BY} can be done on functions.
@item
Changed handling of 'const_item' to allow handling of @code{ORDER BY RAND()}.
@item
Indexes are now used for @code{WHERE key_column = function}.
@item
Indexes are now used for @code{WHERE key_column = col_name} even if
the columns are not identically packed.
@item
Indexes are now used for @code{WHERE col_name IS NULL}.
@item
Changed heap tables to be stored in low_byte_first order (to make it easy
to convert to @code{MyISAM} tables)
@item
Automatic change of @code{HEAP} temporary tables to @code{MyISAM} tables
in case of ``table is full'' errors.
@item
Added @code{--init-file=file_name} option to @code{mysqld}.
@item
Added @code{COUNT(DISTINCT value, [value, ...])}.
@item
@code{CREATE TEMPORARY TABLE} now creates a temporary table, in its own
namespace, that is automatically deleted if connection is dropped.
@item
New reserved words (required for @code{CASE}):  @code{CASE, THEN, WHEN, ELSE and END}.
@item
New functions @code{EXPORT_SET()} and @code{MD5()}.
@item
Support for the GB2312 Chinese character set.
@end itemize


@node News-3.23.1, News-3.23.0, News-3.23.2, News-3.23.x
@appendixsubsec Changes in release 3.23.1

@itemize @bullet
@item
Fixed some compilation problems.
@end itemize


@node News-3.23.0,  , News-3.23.1, News-3.23.x
@appendixsubsec Changes in release 3.23.0 (05 Aug 1999: Alpha)

@itemize @bullet
@item
A new storage engine library (@code{MyISAM}) with a lot of new features.
@xref{MyISAM, , @code{MyISAM}}.
@item
You can create in-memory @code{HEAP} tables which are extremely fast for
lookups.
@item
Support for big files (63-bit) on OSs that support big files.
@item
New function @code{LOAD_FILE(filename)} to get the contents of a file as a
string value.
@item
New operator @code{<=>} which will act as @code{=} but will return TRUE
if both arguments are @code{NULL}.  This is useful for comparing changes
between tables.
@item
Added the ODBC 3.0 @code{EXTRACT(interval FROM datetime)} function.
@item
Columns defined as @code{FLOAT(X)} are not rounded on storage and may be
in scientific notation (1.0 E+10) when retrieved.
@item
@code{REPLACE} is now faster than before.
@item
Changed @code{LIKE} character comparison to behave as @code{=};
This means that @code{'e' LIKE ''} is now true.  (If the line doesn't
display correctly, the latter 'e' is a French 'e' with a dot above.)
@item
@code{SHOW TABLE STATUS} returns a lot of information about the tables.
@item
Added @code{LIKE} to the @code{SHOW STATUS} command.
@item
Added @code{Privileges} column to @code{SHOW COLUMNS}.
@item
Added @code{Packed} and @code{Comment} columns to @code{SHOW INDEX}.
@item
Added comments to tables (with @code{CREATE TABLE ... COMMENT "xxx"}).
@item
Added @code{UNIQUE}, as in
@code{CREATE TABLE table_name (col INT not null UNIQUE)}
@item
New create syntax: @code{CREATE TABLE table_name SELECT ...}
@item
New create syntax: @code{CREATE TABLE IF NOT EXISTS ...}
@item
Allow creation of @code{CHAR(0)} columns.
@item
@code{DATE_FORMAT()} now requires @samp{%} before any format character.
@item
@code{DELAYED} is now a reserved word (sorry about that :( ).
@item
An example procedure is added: @code{analyse}, file: @file{sql_analyse.c}.
This will describe the data in your query.  Try the following:
@example
SELECT ... FROM ...
WHERE ... PROCEDURE ANALYSE([max elements,[max memory]])
@end example

This procedure is extremely useful when you want to check the data in your
table!
@item
@code{BINARY} cast to force a string to be compared in case-sensitive fashion.
@item
Added @code{--skip-show-database} option to @code{mysqld}.
@item
Check whether a row has changed in an @code{UPDATE} now also works
with @code{BLOB}/@code{TEXT} columns.
@item
Added the @code{INNER} join syntax.  @strong{NOTE}:  This made @code{INNER}
a reserved word!
@item
Added support for netmasks to the hostname in the MySQL grant tables.
You can specify a netmask using the @code{IP/NETMASK} syntax.
@item
If you compare a @code{NOT NULL DATE/DATETIME} column with @code{IS
NULL}, this is changed to a compare against @code{0} to satisfy some ODBC
applications.  (By @email{shreeve@@uci.edu}.)
@item
@code{NULL IN (...)} now returns @code{NULL} instead of @code{0}.  This will
ensure that @code{null_column NOT IN (...)} doesn't match
@code{NULL} values.
@item
Fix storage of floating-point values in @code{TIME} columns.
@item
Changed parsing of @code{TIME} strings to be more strict.  Now the
fractional second part is detected (and currently skipped). The
following formats are supported:
@itemize
@item [[DAYS] [H]H:]MM:]SS[.fraction]
@item [[[[[H]H]H]H]MM]SS[.fraction]
@end itemize
@item
Detect (and ignore) fractional second part from @code{DATETIME}.
@item
Added the @code{LOW_PRIORITY} attribute to @code{LOAD DATA INFILE}.
@item
The default index name now uses the same case as the column name on which the
index name is based.
@item
Changed default number of connections to 100.
@item
Use bigger buffers when using @code{LOAD DATA INFILE}.
@item
@code{DECIMAL(x,y)} now works according to SQL-99.
@item
Added aggregate UDF functions. Thanks to Andreas F. Bobak
(@email{bobak@@relog.ch}) for this!
@item
@code{LAST_INSERT_ID()} is now updated for @code{INSERT INTO ... SELECT}.
@item
Some small changes to the join table optimizer to make some joins faster.
@item
@code{SELECT DISTINCT} is much faster; it uses the new @code{UNIQUE}
functionality in @code{MyISAM}. One difference compared to MySQL Version 3.22
is that the output of @code{DISTINCT} is no longer sorted.
@item
All C client API macros are now functions to make shared libraries more
reliable. Because of this, you can no longer call @code{mysql_num_fields()} on
a @code{MYSQL} object, you must use @code{mysql_field_count()} instead.
@item
Added use of @code{LIBWRAP}; patch by Henning P. Schmiedehausen.
@item
Don't allow @code{AUTO_INCREMENT} for other than numerical columns.
@item
Using @code{AUTO_INCREMENT} will now automatically make the column
@code{NOT NULL}.
@item
Show @code{NULL} as the default value for @code{AUTO_INCREMENT} columns.
@item
Added @code{SQL_BIG_RESULT}; @code{SQL_SMALL_RESULT} is now default.
@item
Added a shared library RPM. This enhancement was contributed by David
Fox (@email{dsfox@@cogsci.ucsd.edu}).
@item
Added  @code{--enable-large-files} and @code{--disable-large-files} switches
to @code{configure}. See @file{configure.in} for some systems where this is
automatically turned off because of broken implementations.
@item
Upgraded @code{readline} to 4.0.
@item
New @code{CREATE TABLE} options: @code{PACK_KEYS} and @code{CHECKSUM}.
@item
Added @code{--default-table-type} option to @code{mysqld}.
@end itemize


@node News-3.22.x, News-3.21.x, News-3.23.x, News
@appendixsec Changes in release 3.22.x (Old; discontinued)

@cindex changes, version 3.22

The 3.22 version has faster and safer connect code than version 3.21, as well
as a lot of new nice enhancements.
As there aren't really any major changes, upgrading from 3.21 to 3.22 should
be very easy and painless.  @xref{Upgrading-from-3.21}.

@menu
* News-3.22.35::                Changes in release 3.22.35
* News-3.22.34::                Changes in release 3.22.34
* News-3.22.33::                Changes in release 3.22.33
* News-3.22.32::                Changes in release 3.22.32 (14 Feb 2000)
* News-3.22.31::                Changes in release 3.22.31
* News-3.22.30::                Changes in release 3.22.30
* News-3.22.29::                Changes in release 3.22.29 (02 Jan 2000)
* News-3.22.28::                Changes in release 3.22.28 (20 Oct 1999)
* News-3.22.27::                Changes in release 3.22.27
* News-3.22.26::                Changes in release 3.22.26 (16 Sep 1999)
* News-3.22.25::                Changes in release 3.22.25
* News-3.22.24::                Changes in release 3.22.24 (05 Jul 1999)
* News-3.22.23::                Changes in release 3.22.23 (08 Jun 1999)
* News-3.22.22::                Changes in release 3.22.22 (30 Apr 1999)
* News-3.22.21::                Changes in release 3.22.21
* News-3.22.20::                Changes in release 3.22.20 (18 Mar 1999)
* News-3.22.19::                Changes in release 3.22.19 (Mar 1999: Production)
* News-3.22.18::                Changes in release 3.22.18
* News-3.22.17::                Changes in release 3.22.17
* News-3.22.16::                Changes in release 3.22.16 (Feb 1999: Gamma)
* News-3.22.15::                Changes in release 3.22.15
* News-3.22.14::                Changes in release 3.22.14
* News-3.22.13::                Changes in release 3.22.13
* News-3.22.12::                Changes in release 3.22.12
* News-3.22.11::                Changes in release 3.22.11
* News-3.22.10::                Changes in release 3.22.10
* News-3.22.9::                 Changes in release 3.22.9
* News-3.22.8::                 Changes in release 3.22.8
* News-3.22.7::                 Changes in release 3.22.7 (Sep 1998: Beta)
* News-3.22.6::                 Changes in release 3.22.6
* News-3.22.5::                 Changes in release 3.22.5
* News-3.22.4::                 Changes in release 3.22.4
* News-3.22.3::                 Changes in release 3.22.3
* News-3.22.2::                 Changes in release 3.22.2
* News-3.22.1::                 Changes in release 3.22.1 (Jun 1998: Alpha)
* News-3.22.0::                 Changes in release 3.22.0
@end menu


@node News-3.22.35, News-3.22.34, News-3.22.x, News-3.22.x
@appendixsubsec Changes in release 3.22.35

@itemize @bullet
@item
Fixed problem with @code{STD()}.
@item
Merged changes from the newest @code{ISAM} library from 3.23.
@item
Fixed problem with @code{INSERT DELAYED}.
@item
Fixed a bug core dump when using a @code{LEFT JOIN}/@code{STRAIGHT_JOIN}
on a table with only one row.
@end itemize


@node News-3.22.34, News-3.22.33, News-3.22.35, News-3.22.x
@appendixsubsec Changes in release 3.22.34

@itemize @bullet
@item
Fixed problem with @code{GROUP BY} on @code{TINYBLOB} columns; this
caused bugzilla to not show rows in some queries.
@item
Had to do total recompile of the Windows binary version as VC++ didn't
compile all relevant files for 3.22.33 :(
@end itemize


@node News-3.22.33, News-3.22.32, News-3.22.34, News-3.22.x
@appendixsubsec Changes in release 3.22.33

@itemize @bullet
@item
Fixed problems in Windows when locking tables with @code{LOCK TABLE}.
@item
Quicker kill of @code{SELECT DISTINCT} queries.
@end itemize


@node News-3.22.32, News-3.22.31, News-3.22.33, News-3.22.x
@appendixsubsec Changes in release 3.22.32 (14 Feb 2000)

@itemize @bullet
@item
Fixed problem when storing numbers in timestamps.
@item
Fix problem with time zones that have half hour offsets.
@item
Added @code{mysqlhotcopy}, a fast online hot-backup utility for local MySQL
databases. By Tim Bunce.
@item
New more secure @code{mysqlaccess}. Thanks to Steve Harvey for this.
@item
Fixed security problem in the protocol regarding password checking.
@item
Fixed problem that affected queries that did arithmetic on @code{GROUP} functions.
@item
Fixed a bug in the @code{ISAM} code when deleting rows on tables with
packed indexes.
@end itemize


@node News-3.22.31, News-3.22.30, News-3.22.32, News-3.22.x
@appendixsubsec Changes in release 3.22.31

@itemize @bullet
@item
A few small fixes for the Windows version.
@end itemize


@node News-3.22.30, News-3.22.29, News-3.22.31, News-3.22.x
@appendixsubsec Changes in release 3.22.30

@itemize @bullet
@item
Fixed optimizer problem on @code{SELECT} when using many overlapping indexes.
@item
Disabled floating-point exceptions for FreeBSD to fix core dump when
doing @code{SELECT FLOOR(POW(2,63))}.
@item
Added print of default arguments options to all clients.
@item
Fixed critical problem with the @code{WITH GRANT OPTION} option.
@item
Fixed non-critical Y2K problem when writing short date to log files.
@end itemize


@node News-3.22.29, News-3.22.28, News-3.22.30, News-3.22.x
@appendixsubsec Changes in release 3.22.29 (02 Jan 2000)

@itemize @bullet
@item
Upgraded the configure and include files to match the latest 3.23 version.
This should increase portability and make it easier to build shared libraries.
@item
Added latest patches to MIT-pthreads for NetBSD.
@item
Fixed problem with time zones that are < GMT -11.
@item
Fixed a bug when deleting packed keys in NISAM.
@item
Fixed problem that could cause MySQL to touch freed memory when
doing very complicated @code{GROUP BY} queries.
@item
Fixed core dump if you got a crashed table where an @code{ENUM} field value
was too big.
@item
Added @code{mysqlshutdown.exe} and @code{mysqlwatch.exe} to the Windows
distribution.
@item
Fixed problem when doing @code{ORDER BY} on a reference key.
@item
Fixed that @code{INSERT DELAYED} doesn't update timestamps that are given.
@end itemize


@node News-3.22.28, News-3.22.27, News-3.22.29, News-3.22.x
@appendixsubsec Changes in release 3.22.28 (20 Oct 1999)

@itemize @bullet
@item
Fixed problem with @code{LEFT JOIN} and @code{COUNT()} on a column which
was declared @code{NULL} + and it had a @code{DEFAULT} value.
@item
Fixed core dump problem when using @code{CONCAT()} in a @code{WHERE} clause.
@item
Fixed problem with @code{AVG()} and @code{STD()} with @code{NULL} values.
@end itemize


@node News-3.22.27, News-3.22.26, News-3.22.28, News-3.22.x
@appendixsubsec Changes in release 3.22.27

@itemize @bullet
@item
Fixed prototype in @file{my_ctype.h} when using other character sets.
@item
Some configure issues to fix problems with big filesystem detection.
@item
Fixed problem when sorting on big @code{BLOB} columns.
@item
@code{ROUND()} will now work on Windows.
@end itemize


@node News-3.22.26, News-3.22.25, News-3.22.27, News-3.22.x
@appendixsubsec Changes in release 3.22.26 (16 Sep 1999)

@itemize @bullet
@item
Fixed core dump with empty @code{BLOB/TEXT} column argument to
@code{REVERSE()}.
@item
Extended @code{/*! */} with version numbers.
@item
Changed @code{SUBSTRING(text FROM pos)} to conform to SQL-99. (Before this
construct returned the rightmost 'pos' characters.)
@item
Fixed problem with @code{LOCK TABLES} combined with @code{DELETE FROM table}
@item
Fixed problem that @code{INSERT ... SELECT} didn't use @code{BIG_TABLES}.
@item
@code{SET SQL_LOW_PRIORITY_UPDATES=#} didn't work.
@item
Password wasn't updated correctly if privileges didn't change on:
@code{GRANT ... IDENTIFIED BY}
@item
Fixed range optimizer bug in
@code{SELECT * FROM table_name WHERE key_part1 >= const AND (key_part2 = const
OR key_part2 = const)}.
@item
Fixed bug in compression key handling in @code{ISAM}.
@end itemize


@node News-3.22.25, News-3.22.24, News-3.22.26, News-3.22.x
@appendixsubsec Changes in release 3.22.25

@itemize @bullet
@item
Fixed some small problems with the installation.
@end itemize


@node News-3.22.24, News-3.22.23, News-3.22.25, News-3.22.x
@appendixsubsec Changes in release 3.22.24 (05 Jul 1999)

@itemize @bullet
@item
@code{DATA} is no longer a reserved word.
@item
Fixed optimizer bug with tables with only one row.
@item
Fixed bug when using @code{LOCK TABLES table_name READ; FLUSH TABLES;}
@item
Applied some patches for HP-UX.
@item
@code{isamchk} should now work on Windows.
@item
Changed @file{configure} to not use big file handling on Linux as this
crashes some Red Hat 6.0 systems
@end itemize


@node News-3.22.23, News-3.22.22, News-3.22.24, News-3.22.x
@appendixsubsec Changes in release 3.22.23 (08 Jun 1999)

@itemize @bullet
@item
Upgraded to use Autoconf 2.13, Automake 1.4 and @code{libtool} 1.3.2.
@item
Better support for SCO in @code{configure}.
@item
Added option @code{--defaults-file=file_name} to option file handling to force
use of only one specific option file.
@item
Extended @code{CREATE} syntax to ignore MySQL Version 3.23 keywords.
@item
Fixed deadlock problem when using @code{INSERT DELAYED} on a table locked with
@code{LOCK TABLES}.
@item
Fixed deadlock problem when using @code{DROP TABLE} on a table that was
locked by another thread.
@item
Add logging of @code{GRANT/REVOKE} commands in the update log.
@item
Fixed @code{isamchk} to detect a new error condition.
@item
Fixed bug in @code{NATURAL LEFT JOIN}.
@end itemize


@node News-3.22.22, News-3.22.21, News-3.22.23, News-3.22.x
@appendixsubsec Changes in release 3.22.22 (30 Apr 1999)

@itemize @bullet
@item
Fixed problem in the C API when you called @code{mysql_close()} directly after
@code{mysql_init()}.
@item
Better client error message when you can't open socket.
@item
Fixed @code{delayed_insert_thread} counting when you couldn't create a new
delayed_insert thread.
@item
Fixed bug in @code{CONCAT()} with many arguments.
@item
Added patches for DEC 3.2 and SCO.
@item
Fixed path-bug when installing MySQL as a service on NT.
@item
MySQL on Windows is now compiled with VC++ 6.0 instead of
with VC++ 5.0.
@item
New installation setup for MySQL on Windows.
@end itemize


@node News-3.22.21, News-3.22.20, News-3.22.22, News-3.22.x
@appendixsubsec Changes in release 3.22.21

@itemize @bullet
@item
Fixed problem with @code{DELETE FROM TABLE} when table was locked by
another thread.
@item
Fixed bug in @code{LEFT JOIN} involving empty tables.
@item
Changed the @code{mysql.db} column from @code{CHAR(32)} to @code{CHAR(60)}.
@item
@code{MODIFY} and @code{DELAYED} are no longer reserved words.
@item
Fixed a bug when storing days in a @code{TIME} column.
@item
Fixed a problem with @code{Host '...' is not allowed to connect to this MySQL
server} after one had inserted a new MySQL user with a @code{GRANT}
command.
@item
Changed to use @code{TCP_NODELAY} also on Linux (should give faster TCP/IP
connections).
@end itemize


@node News-3.22.20, News-3.22.19, News-3.22.21, News-3.22.x
@appendixsubsec Changes in release 3.22.20 (18 Mar 1999)

@itemize @bullet
@item
Fixed @code{STD()} for big tables when result should be 0.
@item
The update log didn't have newlines on some operating systems.
@item
@code{INSERT DELAYED} had some garbage at end in the update log.
@end itemize


@node News-3.22.19, News-3.22.18, News-3.22.20, News-3.22.x
@appendixsubsec Changes in release 3.22.19 (Mar 1999: Production)

@itemize @bullet
@item
Fixed bug in @code{mysql_install_db} (from 3.22.17).
@item
Changed default key cache size to 8M.
@item
Fixed problem with queries that needed temporary tables with @code{BLOB}
columns.
@end itemize


@node News-3.22.18, News-3.22.17, News-3.22.19, News-3.22.x
@appendixsubsec Changes in release 3.22.18

@itemize @bullet
@item
Fixes a fatal problem in 3.22.17 on Linux; after @code{shutdown}
not all threads died properly.
@item
Added option @code{-O flush_time=#} to @code{mysqld}.  This is mostly
useful on Windows and tells how often MySQL should close all
unused tables and flush all updated tables to disk.
@item
Fixed problem that a @code{VARCHAR} column compared with @code{CHAR} column
didn't use keys efficiently.
@end itemize


@node News-3.22.17, News-3.22.16, News-3.22.18, News-3.22.x
@appendixsubsec Changes in release 3.22.17

@itemize @bullet
@item
Fixed a core dump problem when using @code{--log-update} and connecting
without a default database.
@item
Fixed some @code{configure} and portability problems.
@item
Using @code{LEFT JOIN} on tables that had circular dependencies caused
@code{mysqld} to hang forever.
@end itemize


@node News-3.22.16, News-3.22.15, News-3.22.17, News-3.22.x
@appendixsubsec Changes in release 3.22.16 (Feb 1999: Gamma)

@itemize @bullet
@item
@code{mysqladmin processlist} could kill the server if a new user logged in.
@item
@code{DELETE FROM tbl_name WHERE key_column=col_name} didn't find any matching
rows.  Fixed.
@item
@code{DATE_ADD(column, ...)} didn't work.
@item
@code{INSERT DELAYED} could deadlock with status @code{upgrading lock}.
@item
Extended @code{ENCRYPT()} to take longer salt strings than 2 characters.
@item
@code{longlong2str} is now much faster than before.  For @code{Intel x86}
platforms, this function is written in optimized assembler.
@item
Added the @code{MODIFY} keyword to @code{ALTER TABLE}.
@end itemize


@node News-3.22.15, News-3.22.14, News-3.22.16, News-3.22.x
@appendixsubsec Changes in release 3.22.15

@itemize @bullet
@item
@code{GRANT} used with @code{IDENTIFIED BY} didn't take effect until privileges
were flushed.
@item
Name change of some variables in @code{SHOW STATUS}.
@item
Fixed problem with @code{ORDER BY} with 'only index' optimization when there
were multiple key definitions for a used column.
@item
@code{DATE} and @code{DATETIME} columns are now up to 5 times faster than
before.
@item
@code{INSERT DELAYED} can be used to let the client do other things while the
server inserts rows into a table.
@item
@code{LEFT JOIN USING (col1,col2)} didn't work if one used it with tables
from 2 different databases.
@item
@code{LOAD DATA LOCAL INFILE} didn't work in the Unix version because of
a missing file.
@item
Fixed problems with @code{VARCHAR}/@code{BLOB} on very short rows (< 4 bytes);
error 127 could occur when deleting rows.
@item
Updating @code{BLOB/TEXT} through formulas didn't work for short (< 256 char)
strings.
@item
When you did a @code{GRANT} on a new host, @code{mysqld} could die on the first
connect from this host.
@item
Fixed bug when one used @code{ORDER BY} on column name that was the same
name as an alias.
@item
Added @code{BENCHMARK(loop_count,expression)} function to time expressions.
@end itemize


@node News-3.22.14, News-3.22.13, News-3.22.15, News-3.22.x
@appendixsubsec Changes in release 3.22.14

@itemize @bullet
@item
Allow empty arguments to @code{mysqld} to make it easier to start from shell
scripts.
@item
Setting a @code{TIMESTAMP} column to @code{NULL} didn't record the timestamp
value in the update log.
@item
Fixed lock handler bug when one did
@code{INSERT INTO TABLE ... SELECT ... GROUP BY}.
@item
Added a patch for @code{localtime_r()} on Windows so that it will no lonher crash
if your date is > 2039, but instead will return a time of all zero.
@item
Names for
user-defined functions are no longer case-sensitive.
@item
Added escape of @code{^Z} (ASCII 26) to @code{\Z} as @code{^Z} doesn't
work with pipes on Windows.
@item
@code{mysql_fix_privileges} adds a new column to the @code{mysql.func} to
support aggregate UDF functions in future MySQL releases.
@end itemize


@node News-3.22.13, News-3.22.12, News-3.22.14, News-3.22.x
@appendixsubsec Changes in release 3.22.13

@itemize @bullet
@item
Saving @code{NOW()}, @code{CURDATE()} or @code{CURTIME()} directly in a
column didn't work.
@item
@code{SELECT COUNT(*) ... LEFT JOIN ...} didn't work with no @code{WHERE} part.
@item
Updated @file{config.guess} to allow MySQL to configure on
UnixWare 7.1.x.
@item
Changed the implementation of @code{pthread_cond()} on the Windows version.
@code{get_lock()} now correctly times out on Windows!
@end itemize


@node News-3.22.12, News-3.22.11, News-3.22.13, News-3.22.x
@appendixsubsec Changes in release 3.22.12

@itemize @bullet
@item
Fixed problem when using @code{DATE_ADD()} and @code{DATE_SUB()} in a
@code{WHERE} clause.
@item
You can now set the password for a user with the @code{GRANT ... TO user
IDENTIFIED BY 'password'} syntax.
@item
Fixed bug in @code{GRANT} checking with @code{SELECT} on many tables.
@item
Added missing file @code{mysql_fix_privilege_tables} to the RPM
distribution. This is not run by default because it relies on the client
package.
@item
Added option @code{SQL_SMALL_RESULT} to @code{SELECT} to force use of
fast temporary tables when you know that the result set will be small.
@item
Allow use of negative real numbers without a decimal point.
@item
Day number is now adjusted to maximum days in month if the resulting month
after @code{DATE_ADD}/@code{DATE_SUB()} doesn't have enough days.
@item
Fix that @code{GRANT} compares columns in case-insensitive fashion.
@item
Fixed a bug in @file{sql_list.h} that made @code{ALTER TABLE} dump core in
some contexts.
@item
The hostname in @code{user@@hostname} can now include @samp{.} and @samp{-}
without quotes in the context of the @code{GRANT}, @code{REVOKE} and
@code{SET PASSWORD FOR ...} statements.
@item
Fix for @code{isamchk} for tables which need big temporary files.
@end itemize


@node News-3.22.11, News-3.22.10, News-3.22.12, News-3.22.x
@appendixsubsec Changes in release 3.22.11

@itemize @bullet
@item
@strong{Important}: You must run the @code{mysql_fix_privilege_tables} script
when you upgrade to this version!  This is needed because of the new
@code{GRANT} system. If you don't do this, you will get @code{Access
denied} when you try to use @code{ALTER TABLE}, @code{CREATE INDEX}, or
@code{DROP INDEX}.
@item
@code{GRANT} to allow/deny users table and column access.
@item
Changed @code{USER()} to return a value in @code{user@@host} format.
Formerly it returned only @code{user}.
@item
Changed the syntax for how to set @code{PASSWORD} for another user.
@item
New command @code{FLUSH STATUS} that resets most status variables to zero.
@item
New status variables: @code{aborted_threads}, @code{aborted_connects}.
@item
New option variable: @code{connection_timeout}.
@item
Added support for Thai sorting (by Pruet Boonma
@email{pruet@@ds90.intanon.nectec.or.th}).
@item
Slovak and Japanese error messages.
@item
Configuration and portability fixes.
@item
Added option @code{SET SQL_WARNINGS=1} to get a warning count also for simple
(single-row) inserts.
@item
MySQL now uses @code{SIGTERM} instead of @code{SIGQUIT} with
shutdown to work better on FreeBSD.
@item
Added option @code{\G} (print vertically) to @code{mysql}.
@item
@code{SELECT HIGH_PRIORITY ...} killed @code{mysqld}.
@item
@code{IS NULL} on a @code{AUTO_INCREMENT} column in a @code{LEFT JOIN} didn't
work as expected.
@item
New function @code{MAKE_SET()}.
@end itemize


@node News-3.22.10, News-3.22.9, News-3.22.11, News-3.22.x
@appendixsubsec Changes in release 3.22.10

@itemize @bullet
@item
@code{mysql_install_db} no longer starts the MySQL server!  You
should start @code{mysqld} with @code{safe_mysqld} after installing it!  The
MySQL RPM will, however, start the server as before.
@item
Added @code{--bootstrap} option to @code{mysqld} and recoded
@code{mysql_install_db} to use it.  This will make it easier to install
MySQL with RPMs.
@item
Changed @code{+}, @code{-} (sign and minus), @code{*}, @code{/}, @code{%},
@code{ABS()} and @code{MOD()} to be @code{BIGINT} aware (64-bit safe).
@item
Fixed a bug in @code{ALTER TABLE} that caused @code{mysqld} to crash.
@item
MySQL now always reports the conflicting key values when a
duplicate key entry occurs. (Before this was only reported for @code{INSERT}.)
@item
New syntax: @code{INSERT INTO tbl_name SET col_name=value, col_name=value, ...}
@item
Most errors in the @file{.err} log are now prefixed with a time stamp.
@item
Added option @code{MYSQL_INIT_COMMAND} to @code{mysql_options()} to make
a query on connect or reconnect.
@item
Added option @code{MYSQL_READ_DEFAULT_FILE} and
@code{MYSQL_READ_DEFAULT_GROUP} to @code{mysql_options()} to read the
following parameters from the MySQL option files: @code{port},
@code{socket}, @code{compress}, @code{password}, @code{pipe}, @code{timeout},
@code{user}, @code{init-command}, @code{host} and @code{database}.
@item
Added @code{maybe_null} to the UDF structure.
@item
Added option @code{IGNORE} to @code{INSERT} statements with many rows.
@item
Fixed some problems with sorting of the @code{koi8} character sets; users of
@code{koi8} @strong{must} run @code{isamchk -rq} on each table that has an
index on a @code{CHAR} or @code{VARCHAR} column.
@item
New script @code{mysql_setpermission}, by Luuk de Boer.  It allows easy
creation of new users with permissions for specific databases.
@item
Allow use of hexadecimal strings (0x...) when specifying a constant string
(like in the column separators with @code{LOAD DATA INFILE}).
@item
Ported to OS/2 (thanks to Antony T. Curtis @email{antony.curtis@@olcs.net}).
@item
Added more variables to @code{SHOW STATUS} and changed format of output to
be like @code{SHOW VARIABLES}.
@item
Added @code{extended-status} command to @code{mysqladmin} which will show the
new status variables.
@end itemize


@node News-3.22.9, News-3.22.8, News-3.22.10, News-3.22.x
@appendixsubsec Changes in release 3.22.9

@itemize @bullet
@item
@code{SET SQL_LOG_UPDATE=0} caused a lockup of the server.
@item
New SQL command:  @code{FLUSH [ TABLES | HOSTS | LOGS | PRIVILEGES ] [, ...]}
@item
New SQL command:  @code{KILL} @code{thread_id}.
@item
Added casts and changed include files to make MySQL easier to
compile on AIX and DEC OSF/1 4.x
@item
Fixed conversion problem when using @code{ALTER TABLE} from a @code{INT}
to a short @code{CHAR()} column.
@item
Added @code{SELECT HIGH_PRIORITY}; this will get a lock for the
@code{SELECT} even if there is a thread waiting for another
@code{SELECT} to get a @code{WRITE LOCK}.
@item
Moved @code{wild_compare()} to string class to be able to use @code{LIKE} on
@code{BLOB}/@code{TEXT} columns with @code{\0}.
@item
Added @code{ESCAPE} option to @code{LIKE}.
@item
Added a lot more output to @code{mysqladmin debug}.
@item
You can now start @code{mysqld} on Windows with the @code{--flush} option.
This will flush all tables to disk after each update.  This makes things
much safer on the Windows platforms but also @strong{much} slower.
@end itemize


@node News-3.22.8, News-3.22.7, News-3.22.9, News-3.22.x
@appendixsubsec Changes in release 3.22.8

@itemize @bullet
@item
Czech character sets should now work much better.
@c You must also install
@c @uref{http://www.mysql.com/Downloads/Patches/czech-3.22.8-patch}.
@c This patch should also be installed if you are using a character set which
@c uses @code{my_strcoll()}!  The patch should always be safe to install (for any
@c system), but as this patch changes @code{ISAM} internals it's not yet in the
@c default distribution.
@item
@code{DATE_ADD()} and @code{DATE_SUB()} didn't work with group functions.
@item
@code{mysql} will now also try to reconnect on @code{USE database} commands.
@item
Fix problem with @code{ORDER BY} and @code{LEFT JOIN} and @code{const} tables.
@item
Fixed problem with @code{ORDER BY} if the first @code{ORDER BY} column
was a key and the rest of the @code{ORDER BY} columns wasn't part of the key.
@item
Fixed a big problem with @code{OPTIMIZE TABLE}.
@item
MySQL clients on NT will now by default first try to connect with
named pipes and after this with TCP/IP.
@item
Fixed a problem with @code{DROP TABLE} and @code{mysqladmin shutdown} on Windows
(a fatal bug from 3.22.6).
@item
Fixed problems with @code{TIME columns} and negative strings.
@item
Added an extra thread signal loop on shutdown to avoid some error messages
from the client.
@item
MySQL now uses the next available number as extension for the update
log file.
@item
Added patches for UNIXWARE 7.
@end itemize


@node News-3.22.7, News-3.22.6, News-3.22.8, News-3.22.x
@appendixsubsec Changes in release 3.22.7 (Sep 1998: Beta)

@itemize @bullet
@item
Added @code{LIMIT} clause for the @code{DELETE} statement.
@item
You can now use the @code{/*! ... */} syntax to hide MySQL-specific
keywords when you write portable code.  MySQL will parse the code
inside the comments as if the surrounding @code{/*!} and @code{*/} comment
characters didn't exist.
@item
@code{OPTIMIZE TABLE tbl_name} can now be used to reclaim disk space
after many deletes.  Currently, this uses @code{ALTER TABLE} to
regenerate the table, but in the future it will use an integrated
@code{isamchk} for more speed.
@item
Upgraded @code{libtool} to get the configure more portable.
@item
Fixed slow @code{UPDATE} and @code{DELETE} operations when using
@code{DATETIME} or @code{DATE} keys.
@item
Changed optimizer to make it better at deciding when to do a full join
and when using keys.
@item
You can now use @code{mysqladmin proc} to display information about your own
threads. Only users with the @code{PROCESS} privilege can get
information about all threads.
(In 4.0.2, you need the @code{SUPER} privilege for this.)
@item
Added handling of formats @code{YYMMDD}, @code{YYYYMMDD},
@code{YYMMDDHHMMSS} for numbers when using @code{DATETIME} and
@code{TIMESTAMP} types. (Formerly these formats only worked with strings.)
@item
Added connect option @code{CLIENT_IGNORE_SPACE} to allow use of spaces
after function names and before @samp{(} (Powerbuilder requires this).
This will make all function names reserved words.
@item
Added the @code{--log-long-format} option to @code{mysqld} to enable timestamps
and INSERT_IDs in the update log.
@item
Added @code{--where} option to @code{mysqldump} (patch by Jim Faucette).
@item
The lexical analyzer now uses ``perfect hashing'' for faster parsing of SQL
statements.
@end itemize


@node News-3.22.6, News-3.22.5, News-3.22.7, News-3.22.x
@appendixsubsec Changes in release 3.22.6

@itemize @bullet
@item
Faster @code{mysqldump}.
@item
For the @code{LOAD DATA INFILE} statement, you can now use the new @code{LOCAL}
keyword to read the file from the client.  @code{mysqlimport} will
automatically use @code{LOCAL} when importing with the TCP/IP protocol.
@item
Fixed small optimize problem when updating keys.
@item
Changed makefiles to support shared libraries.
@item
MySQL-NT can now use named pipes, which means that you can now use
MySQL-NT without having to install TCP/IP.
@end itemize


@node News-3.22.5, News-3.22.4, News-3.22.6, News-3.22.x
@appendixsubsec Changes in release 3.22.5

@itemize @bullet
@item
All table lock handing is changed to avoid some very subtle
deadlocks when using @code{DROP TABLE}, @code{ALTER TABLE}, @code{DELETE FROM
TABLE} and @code{mysqladmin flush-tables} under heavy usage.
Changed locking code to get better handling of locks of different types.
@item
Updated @code{DBI} to 1.00 and @code{DBD} to 1.2.0.
@item
Added a check that the error message file contains error messages suitable for
the current version of @code{mysqld}. (To avoid errors if you accidentally
try to use an old error message file.)
@item
All count structures in the client (@code{affected_rows()},
@code{insert_id()}, ...) are now of type @code{BIGINT} to allow 64-bit values
to be used.
This required a minor change in the MySQL protocol which should affect
only old clients when using tables with @code{AUTO_INCREMENT} values > 16M.
@item
The return type of @code{mysql_fetch_lengths()} has changed from @code{uint *}
to @code{ulong *}. This may give a warning for old clients but should work
on most machines.
@item
Change @code{mysys} and @code{dbug} libraries to allocate all thread variables
in one struct.  This makes it easier to make a threaded @file{libmysql.dll}
library.
@item
Use the result from @code{gethostname()} (instead of @code{uname()}) when
constructing @file{.pid} file names.
@item
New better compressed server/client protocol.
@item
@code{COUNT()}, @code{STD()} and @code{AVG()} are extended to handle more than
4G rows.
@item
You can now store values in the range @code{-838:59:59} <= x <=
@code{838:59:59} in a @code{TIME} column.
@item
@strong{Warning: Incompatible change!!}
If you set a @code{TIME} column to too short a value, MySQL now
assumes the value is given as: @code{[[[D ]HH:]MM:]SS} instead of
@code{HH[:MM[:SS]]}.
@item
@code{TIME_TO_SEC()} and @code{SEC_TO_TIME()} can now handle negative times
and hours up to 32767.
@item
Added new option
@code{SET SQL_LOG_UPDATE=@{0|1@}} to allow users with
the @code{PROCESS} privilege to bypass the update log.
(Modified patch from Sergey A Mukhin @email{violet@@rosnet.net}.)
@item
Fixed fatal bug in @code{LPAD()}.
@item
Initialize line buffer in @file{mysql.cc} to make @code{BLOB} reading from
pipes safer.
@item
Added @code{-O max_connect_errors=#} option to @code{mysqld}.
Connect errors are now reset for each correct connection.
@item
Increased the default value of @code{max_allowed_packet} to @code{1M} in
@code{mysqld}.
@item
Added @code{--low-priority-updates} option to @code{mysqld}, to give
table-modifying operations (@code{INSERT}, @code{REPLACE}, @code{UPDATE},
@code{DELETE}) lower priority than retrievals.  You can now use
@code{@{INSERT | REPLACE | UPDATE | DELETE@} LOW_PRIORITY ...} You can
also use @code{SET SQL_LOW_PRIORITY_UPDATES=@{0|1@}} to change
the priority for one thread.  One side effect is that @code{LOW_PRIORITY}
is now a reserved word. :(
@item
Add support for @code{INSERT INTO table ... VALUES(...),(...),(...)},
to allow inserting multiple rows with a single statement.
@item
@code{INSERT INTO tbl_name} is now also cached when used with @code{LOCK TABLES}.
(Previously only @code{INSERT ... SELECT} and @code{LOAD DATA INFILE} were
cached.)
@item
Allow @code{GROUP BY} functions with @code{HAVING}:
@example
mysql> SELECT col FROM table GROUP BY col HAVING COUNT(*)>0;
@end example
@item
@code{mysqld} will now ignore trailing @samp{;} characters in queries. This
is to make it easier to migrate from some other SQL servers that require the
trailing @samp{;}.
@item
Fix for corrupted fixed-format output generated by @code{SELECT INTO OUTFILE}.
@item
@strong{Warning: Incompatible change!}
Added Oracle @code{GREATEST()} and @code{LEAST()} functions.  You must now use
these instead of the @code{MAX()} and @code{MIN()} functions to get the
largest/smallest value from a list of values. These can now handle @code{REAL},
@code{BIGINT} and string (@code{CHAR} or @code{VARCHAR}) values.
@item
@strong{Warning: Incompatible change!}
@code{DAYOFWEEK()} had offset 0 for Sunday. Changed the offset to 1.
@item
Give an error for queries that mix @code{GROUP BY} columns and fields when
there is no @code{GROUP BY} specification.
@item
Added @code{--vertical} option to @code{mysql}, for printing results in
vertical mode.
@item
Index-only optimization; some queries are now resolved using
only indexes.  Until MySQL 4.0, this works only for numeric columns.
@xref{MySQL indexes, , MySQL indexes}.
@item
Lots of new benchmarks.
@item
A new C API chapter and lots of other improvements in the manual.
@end itemize


@node News-3.22.4, News-3.22.3, News-3.22.5, News-3.22.x
@appendixsubsec Changes in release 3.22.4

@itemize @bullet
@item
Added @code{--tmpdir} option to @code{mysqld}, for specifying the location
of the temporary file directory.
@item
MySQL now automatically changes a query from an ODBC client:
@example
SELECT ... FROM table WHERE auto_increment_column IS NULL
@end example
to:
@example
SELECT ... FROM table WHERE auto_increment_column == LAST_INSERT_ID()
@end example
This allows some ODBC programs (Delphi, Access) to retrieve the newly
inserted row to fetch the @code{AUTO_INCREMENT} id.
@item
@code{DROP TABLE} now waits for all users to free a table before deleting it.
@item
Fixed small memory leak in the new connect protocol.
@item
New functions @code{BIN()}, @code{OCT()}, @code{HEX()} and @code{CONV()} for
converting between different number bases.
@item
Added function @code{SUBSTRING()} with two arguments.
@item
If you created a table with a record length smaller than 5, you couldn't
delete rows from the table.
@item
Added optimization to remove @code{const} reference tables from @code{ORDER BY} and
@code{GROUP BY}.
@item
@code{mysqld} now automatically disables system locking on Linux and Windows,
and for systems that use MIT-pthreads.  You can force the use of locking
with the @code{--enable-external-locking} option.
@item
Added @code{--console} option to @code{mysqld}, to force a console window
(for error messages) when using Windows.
@item
Fixed table locks for Windows.
@item
Allow @samp{$} in identifiers.
@item
Changed name of user-specific configuration file from @file{my.cnf} to
@file{.my.cnf} (Unix only).
@item
Added @code{DATE_ADD()} and @code{DATE_SUB()} functions.
@end itemize


@node News-3.22.3, News-3.22.2, News-3.22.4, News-3.22.x
@appendixsubsec Changes in release 3.22.3

@itemize @bullet
@item
Fixed a lock problem (bug in MySQL Version 3.22.1) when closing temporary tables.
@item
Added missing @code{mysql_ping()} to the client library.
@item
Added @code{--compress} option to all MySQL clients.
@item
Changed @code{byte} to @code{char} in @file{mysql.h} and @file{mysql_com.h}.
@end itemize


@node News-3.22.2, News-3.22.1, News-3.22.3, News-3.22.x
@appendixsubsec Changes in release 3.22.2

@itemize @bullet
@item
Searching on multiple constant keys that matched more than 30% of the rows
didn't always use the best possible key.
@item
New functions @code{<<}, @code{>>}, @code{RPAD()} and @code{LPAD()}.
@item
You can now save default options (like passwords) in a configuration file
(@file{my.cnf}).
@item
Lots of small changes to get @code{ORDER BY} to work when no records are found
when using fields that are not in @code{GROUP BY} (MySQL extension).
@item
Added @code{--chroot} option to @code{mysqld}, to start @code{mysqld} in
a chroot environment (by Nikki Chumakov @email{nikkic@@cityline.ru}).
@item
Trailing spaces are now ignored when comparing case-sensitive strings;
this should fix some problems with ODBC and flag 512!
@item
Fixed a core dump bug in the range optimizer.
@item
Added @code{--one-thread} option to @code{mysqld}, for debugging with
LinuxThreads (or @code{glibc}).  (This replaces the @code{-T32} flag)
@item
Added @code{DROP TABLE IF EXISTS} to prevent an error from occurring if the
table doesn't exist.
@item
@code{IF} and @code{EXISTS} are now reserved words (they would have to
be sooner or later).
@item
Added lots of new options to @code{mysqldump}.
@item
Server error messages are now in @file{mysqld_error.h}.
@item
The server/client protocol now supports compression.
@item
All bug fixes from MySQL Version 3.21.32.
@end itemize


@node News-3.22.1, News-3.22.0, News-3.22.2, News-3.22.x
@appendixsubsec Changes in release 3.22.1 (Jun 1998: Alpha)

@itemize @bullet
@item
Added new C API function @code{mysql_ping()}.
@item
Added new API functions @code{mysql_init()} and @code{mysql_options()}.
You now MUST call @code{mysql_init()} before you call
@code{mysql_real_connect()}.
You don't have to call @code{mysql_init()} if you only use
@code{mysql_connect()}.
@item
Added @code{mysql_options(...,MYSQL_OPT_CONNECT_TIMEOUT,...)} so you can set a
timeout for connecting to a server.
@item
Added @code{--timeout} option to @code{mysqladmin}, as a test of
@code{mysql_options()}.
@item
Added @code{AFTER column} and @code{FIRST} options to
@code{ALTER TABLE ... ADD columns}.
This makes it possible to add a new column at some specific location
within a row in an existing table.
@item
@code{WEEK()} now takes an optional argument to allow handling of weeks when
the week starts on Monday (some European countries).  By default,
@code{WEEK()} assumes the week starts on Sunday.
@item
@code{TIME} columns weren't stored properly (bug in MySQL Version 3.22.0).
@item
@code{UPDATE} now returns information about how many rows were
matched and updated, and how many ``warnings'' occurred when doing the update.
@item
Fixed incorrect result from @code{FORMAT(-100,2)}.
@item
@code{ENUM} and @code{SET} columns were compared in binary (case-sensitive)
fashion; changed to be case-insensitive.
@end itemize


@node News-3.22.0,  , News-3.22.1, News-3.22.x
@appendixsubsec Changes in release 3.22.0

@itemize @bullet
@item
New (backward-compatible) connect protocol that allows you to
specify the database to use when connecting, to get much faster
connections to a specific database.

The @code{mysql_real_connect()} call is changed to:

@example
mysql_real_connect(MYSQL *mysql, const char *host, const char *user,
                   const char *passwd, const char *db, uint port,
                   const char *unix_socket, uint client_flag)
@end example
@item
Each connection is handled by its own thread, rather than by the
master @code{accept()} thread.  This fixes permanently the telnet bug
that was a topic on the mail list some time ago.
@item
All TCP/IP connections are now checked with backward-resolution of
the hostname to get better security. @code{mysqld} now has a local hostname
resolver cache so connections should actually be faster than before,
even with this feature.
@item
A site automatically will be blocked from future connections if someone
repeatedly connects with an ``improper header'' (like when one uses telnet).
@item
You can now refer to tables in different databases with references of the form
@code{tbl_name@@db_name} or @code{db_name.tbl_name}.  This makes it possible to
give a user read access to some tables and write access to others simply by
keeping them in different databases!
@item
Added @code{--user} option to @code{mysqld}, to allow it to run
as another Unix user (if it is started as the Unix @code{root} user).
@item
Added caching of users and access rights (for faster access rights checking)
@item
Normal users (not anonymous ones) can change their password with
@code{mysqladmin password "new_password"}.  This uses encrypted passwords
that are not logged in the normal MySQL log!
@item
All important string functions are now coded in assembler for x86 Linux
machines.  This gives a speedup of 10% in many cases.
@item
For tables that have many columns, the column names are now hashed for
much faster column name lookup (this will speed up some benchmark
tests a lot!)
@item
Some benchmarks are changed to get better individual timing.
(Some loops were so short that a specific test took < 2 seconds. The
loops have been changed to take about 20 seconds to make it easier
to compare different databases. A test that took 1-2 seconds before
now takes 11-24 seconds, which is much better)
@item
Re-arranged @code{SELECT} code to handle some very specific queries
involving group functions (like @code{COUNT(*)}) without a @code{GROUP BY} but
with @code{HAVING}. The following now works:
@example
mysql> SELECT COUNT(*) as C FROM table HAVING C > 1;
@end example
@item
Changed the protocol for field functions to be faster and avoid some
calls to @code{malloc()}.
@item
Added @code{-T32} option to @code{mysqld}, for running all queries under the
main thread.  This makes it possible to debug @code{mysqld} under Linux with
@code{gdb}!
@item
Added optimization of @code{not_null_column IS NULL} (needed for some Access
queries).
@item
Allow @code{STRAIGHT_JOIN} to be used between two tables to force the optimizer
to join them in a specific order.
@item
String functions now return @code{VARCHAR} rather than @code{CHAR} and
the column type is now @code{VARCHAR} for fields saved as @code{VARCHAR}.
This should make the @code{MyODBC} driver better, but may break some old
MySQL clients that don't handle @code{FIELD_TYPE_VARCHAR} the same
way as @code{FIELD_TYPE_CHAR}.
@item
@code{CREATE INDEX} and @code{DROP INDEX} are now implemented through
@code{ALTER TABLE}.
@code{CREATE TABLE} is still the recommended (fast) way to create indexes.
@item
Added @code{--set-variable} option @code{wait_timeout} to @code{mysqld}.
@item
Added time column to @code{mysqladmin processlist} to show how long a query
has taken or how long a thread has slept.
@item
Added lots of new variables to @code{show variables} and some new to
@code{show status}.
@item
Added new type @code{YEAR}. @code{YEAR} is stored in 1 byte with allowable
values of 0, and 1901 to 2155.
@item
Added new @code{DATE} type that is stored in 3 bytes rather than 4 bytes.
All new tables are created with the new date type if you don't use the
@code{--old-protocol} option to @code{mysqld}.
@item
Fixed bug in record caches; for some queries, you could get
@code{Error from table handler: #} on some operating systems.
@item
Added @code{--enable-assembler} option to @code{configure}, for x86 machines
(tested on Linux + @code{gcc}).  This will enable assembler functions for the
most important string functions for more speed!
@end itemize


@node News-3.21.x, News-3.20.x, News-3.22.x, News
@appendixsec Changes in release 3.21.x

@cindex changes, version 3.21

Version 3.21 is quite old now, and should be avoided if possible.  This
information is kept here for historical purposes only.

@menu
* News-3.21.33::                Changes in release 3.21.33
* News-3.21.32::                Changes in release 3.21.32
* News-3.21.31::                Changes in release 3.21.31
* News-3.21.30::                Changes in release 3.21.30
* News-3.21.29::                Changes in release 3.21.29
* News-3.21.28::                Changes in release 3.21.28
* News-3.21.27::                Changes in release 3.21.27
* News-3.21.26::                Changes in release 3.21.26
* News-3.21.25::                Changes in release 3.21.25
* News-3.21.24::                Changes in release 3.21.24
* News-3.21.23::                Changes in release 3.21.23
* News-3.21.22::                Changes in release 3.21.22
* News-3.21.21a::               Changes in release 3.21.21a
* News-3.21.21::                Changes in release 3.21.21
* News-3.21.20::                Changes in release 3.21.20
* News-3.21.19::                Changes in release 3.21.19
* News-3.21.18::                Changes in release 3.21.18
* News-3.21.17::                Changes in release 3.21.17
* News-3.21.16::                Changes in release 3.21.16
* News-3.21.15::                Changes in release 3.21.15
* News-3.21.14b::               Changes in release 3.21.14b
* News-3.21.14a::               Changes in release 3.21.14a
* News-3.21.13::                Changes in release 3.21.13
* News-3.21.12::                Changes in release 3.21.12
* News-3.21.11::                Changes in release 3.21.11
* News-3.21.10::                Changes in release 3.21.10
* News-3.21.9::                 Changes in release 3.21.9
* News-3.21.8::                 Changes in release 3.21.8
* News-3.21.7::                 Changes in release 3.21.7
* News-3.21.6::                 Changes in release 3.21.6
* News-3.21.5::                 Changes in release 3.21.5
* News-3.21.4::                 Changes in release 3.21.4
* News-3.21.3::                 Changes in release 3.21.3
* News-3.21.2::                 Changes in release 3.21.2
* News-3.21.0::                 Changes in release 3.21.0
@end menu


@node News-3.21.33, News-3.21.32, News-3.21.x, News-3.21.x
@appendixsubsec Changes in release 3.21.33

@itemize @bullet
@item
Fixed problem when sending @code{SIGHUP} to @code{mysqld};
@code{mysqld} core dumped when starting from boot on some systems.
@item
Fixed problem with losing a little memory for some connections.
@item
@code{DELETE FROM tbl_name} without a @code{WHERE} condition is now done the
long way when you use @code{LOCK TABLES} or if the table is in use, to
avoid race conditions.
@item
@code{INSERT INTO TABLE (timestamp_column) VALUES (NULL);} didn't set timestamp.
@end itemize


@node News-3.21.32, News-3.21.31, News-3.21.33, News-3.21.x
@appendixsubsec Changes in release 3.21.32

@itemize @bullet
@item
Fixed some possible race conditions when doing many reopen/close on the same
tables under heavy load!  This can happen if you execute @code{mysqladmin
refresh} often. This could in some very rare cases corrupt the header of the
index file and cause error 126 or 138.

@item
Fixed fatal bug in @code{refresh()} when running with the
@code{--skip-external-locking} option.  There was a ``very small'' time gap after
a @code{mysqladmin refresh} when a table could be corrupted if one
thread updated a table while another thread did @code{mysqladmin
refresh} and another thread started a new update ont the same table
before the first thread had finished.  A refresh (or
@code{--flush-tables}) will now not return until all used tables are
closed!
@item
@code{SELECT DISTINCT} with a @code{WHERE} clause that didn't match any rows
returned a row in some contexts (bug only in 3.21.31).
@item
@code{GROUP BY} + @code{ORDER BY} returned one empty row when no rows where
found.
@item
Fixed a bug in the range optimizer that wrote
@code{Use_count: Wrong count for ...} in the error log file.
@end itemize


@node News-3.21.31, News-3.21.30, News-3.21.32, News-3.21.x
@appendixsubsec Changes in release 3.21.31

@itemize @bullet
@item
Fixed a sign extension problem for the @code{TINYINT} type on Irix.
@item
Fixed problem with @code{LEFT("constant_string",function)}.
@item
Fixed problem with @code{FIND_IN_SET()}.
@item
@code{LEFT JOIN} core dumped if the second table is used with a constant
@code{WHERE/ON} expression that uniquely identifies one record.
@item
Fixed problems with @code{DATE_FORMAT()} and incorrect dates.
@code{DATE_FORMAT()} now ignores @code{'%'} to make it possible to extend
it more easily in the future.
@end itemize


@node News-3.21.30, News-3.21.29, News-3.21.31, News-3.21.x
@appendixsubsec Changes in release 3.21.30

@itemize @bullet
@item
@code{mysql} now returns an exit code > 0 if the query returned an error.
@item
Saving of command-line history to file in @code{mysql} client.
By Tommy Larsen @email{tommy@@mix.hive.no}.
@item
Fixed problem with empty lines that were ignored in @file{mysql.cc}.
@item
Save the pid of the signal handler thread in the pid file instead
of the pid of the main thread.
@item
Added patch by @email{tommy@@valley.ne.jp} to support Japanese characters
SJIS and UJIS.
@item
Changed @code{safe_mysqld} to redirect startup messages to
@code{'hostname'.err} instead
of @code{'hostname'.log} to reclaim file space on @code{mysqladmin refresh}.
@item
@code{ENUM} always had the first entry as default value.
@item
@code{ALTER TABLE} wrote two entries to the update log.
@item
@code{sql_acc()} now closes the @code{mysql} grant tables after a reload to
save table space and memory.
@item
Changed @code{LOAD DATA} to use less memory with tables and @code{BLOB}
columns.
@item
Sorting on a function which made a division / 0 produced a wrong set
in some cases.
@item
Fixed @code{SELECT} problem with @code{LEFT()} when using the @code{czech}
character set.
@item
Fixed problem in @code{isamchk}; it couldn't repair a packed table in a very
unusual case.
@item
@code{SELECT} statements with @code{&} or @code{|} (bit functions) failed on
columns with @code{NULL} values.
@item
When comparing a field = field, where one of the fields was a part key,
only the length of the part key was compared.
@end itemize


@node News-3.21.29, News-3.21.28, News-3.21.30, News-3.21.x
@appendixsubsec Changes in release 3.21.29

@itemize @bullet
@item
@code{LOCK TABLES} + @code{DELETE from tbl_name} never removed locks properly.
@item
Fixed problem when grouping on an @code{OR} function.
@item
Fixed permission problem with @code{umask()} and creating new databases.
@item
Fixed permission problem on result file with @code{SELECT ... INTO OUTFILE ...}
@item
Fixed problem in range optimizer (core dump) for a very complex query.
@item
Fixed problem when using @code{MIN(integer)} or @code{MAX(integer)} in
@code{GROUP BY}.
@item
Fixed bug on Alpha when using integer keys. (Other keys worked on Alpha.)
@item
Fixed bug in @code{WEEK("XXXX-xx-01")}.
@end itemize


@node News-3.21.28, News-3.21.27, News-3.21.29, News-3.21.x
@appendixsubsec Changes in release 3.21.28

@itemize @bullet
@item
Fixed socket permission (clients couldn't connect to Unix socket on Linux).
@item
Fixed bug in record caches; for some queries, you could get
@code{Error from table handler: #} on some operating systems.
@end itemize


@node News-3.21.27, News-3.21.26, News-3.21.28, News-3.21.x
@appendixsubsec Changes in release 3.21.27

@itemize @bullet
@item
Added user level lock functions @code{GET_LOCK(string,timeout)},
@code{RELEASE_LOCK(string)}.
@item
Added @code{Opened_tables} to @code{show status}.
@item
Changed connect timeout to 3 seconds to make it somewhat harder
for crackers to kill @code{mysqld} through telnet + TCP/IP.
@item
Fixed bug in range optimizer when using
@code{WHERE key_part_1 >= something AND key_part_2 <= something_else}.
@item
Changed @code{configure} for detection of FreeBSD 3.0 9803xx and above
@item
@code{WHERE} with @code{string_col_key = constant_string} didn't always
find all rows if the column had many values differing only with
characters of the same sort value (like e and e with an accent).
@item
Strings keys looked up with 'ref' were not compared in case-sensitive fashion.
@item
Added @code{umask()} to make log files non-readable for normal users.
@item
Ignore users with old (8-byte) password on startup if not using
@code{--old-protocol} option to @code{mysqld}.
@item
@code{SELECT} which matched all key fields returned the values in the
case of the matched values, not of the found values. (Minor problem.)
@end itemize


@node News-3.21.26, News-3.21.25, News-3.21.27, News-3.21.x
@appendixsubsec Changes in release 3.21.26

@itemize @bullet
@item
@code{FROM_DAYS(0)} now returns "0000-00-00".
@item
In @code{DATE_FORMAT()}, PM and AM were swapped for hours 00 and 12.
@item
Extended the default maximum key size to 256.
@item
Fixed bug when using @code{BLOB}/@code{TEXT} in @code{GROUP BY} with many
tables.
@item
An @code{ENUM} field that is not declared @code{NOT NULL} has @code{NULL} as
the default value.
(Previously, the default value was the first enumeration value.)
@item
Fixed bug in the join optimizer code when using many part keys
on the same key:  @code{INDEX (Organization,Surname(35),Initials(35))}.
@item
Added some tests to the table order optimizer to get some cases with
@code{SELECT ... FROM many_tables} much faster.
@item
Added a retry loop around @code{accept()} to possibly fix some problems on some
Linux machines.
@end itemize


@node News-3.21.25, News-3.21.24, News-3.21.26, News-3.21.x
@appendixsubsec Changes in release 3.21.25

@itemize @bullet
@item
Changed @code{typedef 'string'} to @code{typedef 'my_string'} for better
portability.
@item
You can now kill threads that are waiting on a disk-full condition.
@item
Fixed some problems with UDF functions.
@item
Added long options to @code{isamchk}. Try @code{isamchk --help}.
@item
Fixed a bug when using 8 bytes long (alpha); @code{filesort()} didn't work.
Affects @code{DISTINCT}, @code{ORDER BY} and @code{GROUP BY} on 64-bit
processors.
@end itemize


@node News-3.21.24, News-3.21.23, News-3.21.25, News-3.21.x
@appendixsubsec Changes in release 3.21.24

@itemize @bullet
@item
Dynamic loadable functions. Based on source from Alexis Mikhailov.
@item
You couldn't delete from a table if no one had done a @code{SELECT} on the
table.
@item
Fixed problem with range optimizer with many @code{OR} operators on key parts
inside each other.
@item
Recoded @code{MIN()} and @code{MAX()} to work properly with strings and
@code{HAVING}.
@item
Changed default umask value for new files from @code{0664} to @code{0660}.
@item
Fixed problem with @code{LEFT JOIN} and constant expressions in the @code{ON}
part.
@item
Added Italian error messages from @email{brenno@@dewinter.com}.
@item
@code{configure} now works better on OSF/1 (tested on 4.0D).
@item
Added hooks to allow @code{LIKE} optimization with international character
support.
@item
Upgraded @code{DBI} to 0.93.
@end itemize


@node News-3.21.23, News-3.21.22, News-3.21.24, News-3.21.x
@appendixsubsec Changes in release 3.21.23

@itemize @bullet
@item
The following symbols are now reserved words:
@code{TIME}, @code{DATE}, @code{TIMESTAMP}, @code{TEXT}, @code{BIT},
@code{ENUM}, @code{NO}, @code{ACTION}, @code{CHECK}, @code{YEAR},
@code{MONTH}, @code{DAY}, @code{HOUR}, @code{MINUTE}, @code{SECOND},
@code{STATUS}, @code{VARIABLES}.
@item
Setting a @code{TIMESTAMP} to @code{NULL} in @code{LOAD DATA INFILE ...} didn't
set the current time for the @code{TIMESTAMP}.
@item
Fix @code{BETWEEN} to recognize binary strings. Now @code{BETWEEN} is
case-sensitive.
@item
Added @code{--skip-thread-priority} option to @code{mysqld}, for systems
where @code{mysqld}'s thread scheduling doesn't work properly (BSDI 3.1).
@item
Added ODBC functions @code{DAYNAME()} and @code{MONTHNAME()}.
@item
Added function @code{TIME_FORMAT()}.  This works like @code{DATE_FORMAT()},
but takes a time string (@code{'HH:MM:SS'}) as argument.
@item
Fixed unlikely(?) key optimizer bug when using @code{OR} operators of key parts
inside @code{AND} expressions.
@item
Added @code{variables} command to @code{mysqladmin}.
@item
A lot of small changes to the binary releases.
@item
Fixed a bug in the new protocol from MySQL Version 3.21.20.
@item
Changed @code{ALTER TABLE} to work with Windows (Windows can't rename
open files).  Also fixed a couple of small bugs in the Windows version.
@item
All standard MySQL clients are now ported to MySQL for Windows.
@item
MySQL can now be started as a service on NT.
@end itemize


@node News-3.21.22, News-3.21.21a, News-3.21.23, News-3.21.x
@appendixsubsec Changes in release 3.21.22

@itemize @bullet
@item
Starting with this version, all MySQL distributions will be
configured, compiled and tested with @code{crash-me} and the benchmarks on
the following platforms: SunOS 5.6 sun4u, SunOS 5.5.1 sun4u, SunOS 4.14 sun4c,
SunOS 5.6 i86pc, Irix 6.3 mips5k, HP-UX 10.20 hppa, AIX 4.2.1 ppc,
OSF/1 V4.0 alpha, FreeBSD 2.2.2 i86pc and BSDI 3.1 i386.
@item
Fix @code{COUNT(*)} problems when the @code{WHERE} clause didn't match any
records.  (Bug from 3.21.17.)
@item
Removed that @code{NULL = NULL} is true.  Now you must use @code{IS NULL}
or @code{IS NOT NULL} to test whether a value is @code{NULL}.
(This is according to SQL-99 but may break
old applications that are ported from @code{mSQL}.)
You can get the old behavior by compiling with @code{-DmSQL_COMPLIANT}.
@item
Fixed bug that core dumped when using many @code{LEFT OUTER JOIN} clauses.
@item
Fixed bug in @code{ORDER BY} on string formula with possible @code{NULL} values.
@item
Fixed problem in range optimizer when using @code{<=} on sub index.
@item
Added functions @code{DAYOFYEAR()}, @code{DAYOFMONTH()}, @code{MONTH()},
@code{YEAR()}, @code{WEEK()}, @code{QUARTER()}, @code{HOUR()}, @code{MINUTE()},
@code{SECOND()} and @code{FIND_IN_SET()}.
@item
Added @code{SHOW VARIABLES} command.
@item
Added support of ``long constant strings'' from SQL-99:
@example
mysql> SELECT 'first ' 'second';       -> 'first second'
@end example
@item
Upgraded Msql-Mysql-modules to 1.1825.
@item
Upgraded @code{mysqlaccess} to 2.02.
@item
Fixed problem with Russian character set and @code{LIKE}.
@item
Ported to OpenBSD 2.1.
@item
New Dutch error messages.
@end itemize


@node News-3.21.21a, News-3.21.21, News-3.21.22, News-3.21.x
@appendixsubsec Changes in release 3.21.21a

@itemize @bullet
@item
Configure changes for some operating systems.
@end itemize


@node News-3.21.21, News-3.21.20, News-3.21.21a, News-3.21.x
@appendixsubsec Changes in release 3.21.21

@itemize @bullet
@item
Fixed optimizer bug when using
@code{WHERE data_field = date_field2 AND date_field2 = constant}.
@item
Added @code{SHOW STATUS} command.
@item
Removed @file{manual.ps} from the source distribution to make it smaller.
@end itemize


@node News-3.21.20, News-3.21.19, News-3.21.21, News-3.21.x
@appendixsubsec Changes in release 3.21.20

@itemize @bullet
@item
Changed the maximum table name and column name lengths from 32 to 64.
@item
Aliases can now be of ``any'' length.
@item
Fixed @code{mysqladmin stat} to return the right number of queries.
@item
Changed protocol (downward compatible) to mark if a column has the
@code{AUTO_INCREMENT} attribute or is a @code{TIMESTAMP}. This is needed for
the new Java driver.
@item
Added Hebrew sorting order by Zeev Suraski.
@item
Solaris 2.6: Fixed @code{configure} bugs and increased maximum table size
from 2G to 4G.
@end itemize


@node News-3.21.19, News-3.21.18, News-3.21.20, News-3.21.x
@appendixsubsec Changes in release 3.21.19

@itemize @bullet
@item
Upgraded @code{DBD} to 1.1823. This version implements @code{mysql_use_result}
in @code{DBD-Mysql}.
@item
Benchmarks updated for empress (by Luuk).
@item
Fixed a case of slow range searching.
@item
Configure fixes (@file{Docs} directory).
@item
Added function @code{REVERSE()} (by Zeev Suraski).
@end itemize


@node News-3.21.18, News-3.21.17, News-3.21.19, News-3.21.x
@appendixsubsec Changes in release 3.21.18

@itemize @bullet
@item
Issue error message if client C functions are called in wrong order.
@item
Added automatic reconnect to the @file{libmysql.c} library. If a write command
fails, an automatic reconnect is done.
@item
Small sort sets no longer use temporary files.
@item
Upgraded @code{DBI} to 0.91.
@item
Fixed a couple of problems with @code{LEFT OUTER JOIN}.
@item
Added @code{CROSS JOIN} syntax. @code{CROSS} is now a reserved word.
@item
Recoded @code{yacc}/@code{bison} stack allocation to be even safer and to allow
MySQL to handle even bigger expressions.
@item
Fixed a couple of problems with the update log.
@item
@code{ORDER BY} was slow when used with key ranges.
@end itemize


@node News-3.21.17, News-3.21.16, News-3.21.18, News-3.21.x
@appendixsubsec Changes in release 3.21.17

@itemize @bullet
@item
Changed documentation string of @code{--with-unix-socket-path} to avoid
confusion.
@item
Added ODBC and SQL-99 style @code{LEFT OUTER JOIN}.
@item
The following are new reserved words: @code{LEFT}, @code{NATURAL},
@code{USING}.
@item
The client library now uses the value of the environment variable
@code{MYSQL_HOST} as the default host if it's defined.
@item
@code{SELECT col_name, SUM(expr)} now returns @code{NULL} for @code{col_name}
when there are matching rows.
@item
Fixed problem with comparing binary strings and @code{BLOB} values with ASCII
characters over 127.
@item
Fixed lock problem: when freeing a read lock on a table with multiple
read locks, a thread waiting for a write lock would have been given the lock.
This shouldn't affect data integrity, but could possibly make @code{mysqld}
restart if one thread was reading data that another thread modified.
@item
@code{LIMIT offset,count} didn't work in @code{INSERT ... SELECT}.
@item
Optimized key block caching. This will be quicker than the old algorithm when
using bigger key caches.
@end itemize


@node News-3.21.16, News-3.21.15, News-3.21.17, News-3.21.x
@appendixsubsec Changes in release 3.21.16

@itemize @bullet
@item
Added ODBC 2.0 & 3.0 functions @code{POWER()}, @code{SPACE()},
@code{COT()}, @code{DEGREES()}, @code{RADIANS()}, @code{ROUND(2 arg)}
and @code{TRUNCATE()}.
@item
@strong{Warning: Incompatible change!} @code{LOCATE()} parameters were
swapped according to ODBC standard. Fixed.
@item
Added function @code{TIME_TO_SEC()}.
@item
In some cases, default values were not used for @code{NOT NULL} fields.
@item
Timestamp wasn't always updated properly in @code{UPDATE SET ...} statements.
@item
Allow empty strings as default values for @code{BLOB} and @code{TEXT}, to
be compatible with @code{mysqldump}.
@end itemize


@node News-3.21.15, News-3.21.14b, News-3.21.16, News-3.21.x
@appendixsubsec Changes in release 3.21.15

@itemize @bullet
@item
@strong{Warning: Incompatible change!} @code{mysqlperl} is now from
Msql-Mysql-modules. This means that @code{connect()} now takes
@code{host}, @code{database}, @code{user}, @code{password} arguments! The old
version took @code{host}, @code{database}, @code{password}, @code{user}.
@item
Allow @code{DATE '1997-01-01'}, @code{TIME '12:10:10'} and
@code{TIMESTAMP '1997-01-01 12:10:10'} formats required by SQL-99.
@strong{Warning: Incompatible change!} This has the unfortunate
side-effect that you no longer can have columns named @code{DATE}, @code{TIME}
or @code{TIMESTAMP}. :( Old columns can still be accessed through
@code{tablename.columnname}!)
@item
Changed Makefiles to hopefully work better with BSD systems. Also,
@file{manual.dvi} is now included in the distribution to avoid having stupid
@code{make} programs trying to rebuild it.
@item
@code{readline} library upgraded to version 2.1.
@item
A new sortorder german-1. That is a normal ISO-Latin1 with a german sort
order.
@item
Perl @code{DBI}/@code{DBD} is now included in the distribution. @code{DBI}
is now the recommended way to connect to MySQL from Perl.
@item
New portable benchmark suite with @code{DBD}, with test results from
@code{mSQL} 2.0.3, MySQL, PostgreSQL 6.2.1 and Solid server 2.2.
@item
@code{crash-me} is now included with the benchmarks; this is a Perl program
designed to find as many limits as possible in an SQL server. Tested with
@code{mSQL}, PostgreSQL, Solid and MySQL.
@item
Fixed bug in range-optimizer that crashed MySQL on some queries.
@item
Table and column name completion for @code{mysql} command-line tool, by Zeev
Suraski and Andi Gutmans.
@item
Added new command @code{REPLACE} that works like @code{INSERT} but
replaces conflicting records with the new record. @code{REPLACE INTO
TABLE ... SELECT ...} works also.
@item
Added new commands @code{CREATE DATABASE db_name} and @code{DROP
DATABASE db_name}.
@item
Added @code{RENAME} option to @code{ALTER TABLE}: @code{ALTER TABLE name
RENAME TO new_name}.
@item
@code{make_binary_distribution} now includes @file{libgcc.a} in
@file{libmysqlclient.a}. This should make linking work for people who don't
have @code{gcc}.
@item
Changed @code{net_write()} to @code{my_net_write()} because of a name
conflict with Sybase.
@item
@cindex ODBC compatibility
@cindex compatibility, with ODBC
New function @code{DAYOFWEEK()} compatible with ODBC.
@item
Stack checking and @code{bison} memory overrun checking to make MySQL
safer with weird queries.
@end itemize


@node News-3.21.14b, News-3.21.14a, News-3.21.15, News-3.21.x
@appendixsubsec Changes in release 3.21.14b

@itemize @bullet
@item
Fixed a couple of small @code{configure} problems on some platforms.
@end itemize


@node News-3.21.14a, News-3.21.13, News-3.21.14b, News-3.21.x
@appendixsubsec Changes in release 3.21.14a

@itemize @bullet
@item
Ported to SCO Openserver 5.0.4  with FSU Pthreads.
@item
HP-UX 10.20 should work.
@item
Added new function @code{DATE_FORMAT()}.
@item
Added @code{NOT IN}.
@item
Added automatic removal of 'ODBC function conversions': @code{@{fn now() @}}
@item
Handle ODBC 2.50.3 option flags.
@item
Fixed comparison of @code{DATE} and @code{TIME} values with @code{NULL}.
@item
Changed language name from germany to german to be consistent with
the other language names.
@item
Fixed sorting problem on functions returning a @code{FLOAT}. Previously, the
values were converted to @code{INT} values before sorting.
@item
Fixed slow sorting when sorting on key field when using
@code{key_column=constant}.
@item
Sorting on calculated @code{DOUBLE} values sorted on integer results instead.
@item
@code{mysql} no longer requires a database argument.
@item
Changed the place where @code{HAVING} should be. According to the SQL standards, it should
be after @code{GROUP BY} but before @code{ORDER BY}. MySQL Version 3.20
incorrectly had it last.
@item
Added Sybase command @code{USE database} to start using another database.
@item
Added automatic adjusting of number of connections and table cache size
if the maximum number of files that can be opened is less than needed.
This should fix that @code{mysqld} doesn't crash even if you haven't done a
@code{ulimit -n 256} before starting @code{mysqld}.
@item
Added lots of limit checks to make it safer when running with too little
memory or when doing weird queries.
@end itemize


@node News-3.21.13, News-3.21.12, News-3.21.14a, News-3.21.x
@appendixsubsec Changes in release 3.21.13

@itemize @bullet
@item
Added retry of interrupted reads and clearing of @code{errno}.
This makes Linux systems much safer!
@item
Fixed locking bug when using many aliases on the same table in the same
@code{SELECT}.
@item
Fixed bug with @code{LIKE} on number key.
@item
New error message so you can check whether the connection was lost while
the command was running or whether the connection was down from the start.
@item
Added @code{--table} option to @code{mysql} to print in table format.
Moved time and row information after query result.
Added automatic reconnect of lost connections.
@item
Added @code{!=} as a synonym for @code{<>}.
@item
Added function @code{VERSION()} to make easier logs.
@item
New multi-user test @file{tests/fork_test.pl} to put some strain on the
thread library.
@end itemize


@node News-3.21.12, News-3.21.11, News-3.21.13, News-3.21.x
@appendixsubsec Changes in release 3.21.12

@itemize @bullet
@item
Fixed @code{ftruncate()} call in MIT-pthreads. This made @code{isamchk}
destroy the @file{.ISM} files on (Free)BSD 2.x systems.
@item
Fixed broken @code{__P_} patch in MIT-pthreads.
@item
Many memory overrun checks. All string functions now return @code{NULL}
if the returned string should be longer than @code{max_allowed_packet} bytes.
@item
Changed the name of the @code{INTERVAL} type to @code{ENUM}, because
@code{INTERVAL} is used in SQL-99.
@item
In some cases, doing a @code{JOIN} + @code{GROUP} + @code{INTO OUTFILE},
the result wasn't grouped.
@item
@code{LIKE} with @code{'_'} as last character didn't work. Fixed.
@item
Added extended SQL-99 @code{TRIM()} function.
@item
Added @code{CURTIME()}.
@item
Added @code{ENCRYPT()} function by Zeev Suraski.
@item
Fixed better @code{FOREIGN KEY} syntax skipping. New reserved words:
@code{MATCH}, @code{FULL}, @code{PARTIAL}.
@item
@code{mysqld} now allows IP number and hostname for the @code{--bind-address}
option.
@item
Added @code{SET CHARACTER SET cp1251_koi8} to enable conversions of
data to and from the @code{cp1251_koi8} character set.
@item
Lots of changes for Windows 95 port. In theory, this version should now be
easily portable to Windows 95.
@item
Changed the @code{CREATE COLUMN} syntax of @code{NOT NULL} columns to be after
the @code{DEFAULT} value, as specified in the SQL-99 standard. This will
make @code{mysqldump} with @code{NOT NULL} and default values incompatible with
MySQL Version 3.20.
@item
Added many function name aliases so the functions can be used with
ODBC or SQL-92 syntax.
@item
Fixed syntax of @code{ALTER TABLE tbl_name ALTER COLUMN col_name SET DEFAULT
NULL}.
@item
Added @code{CHAR} and @code{BIT} as synonyms for @code{CHAR(1)}.
@item
Fixed core dump when updating as a user who has only @code{SELECT} privilege.
@item
@code{INSERT ... SELECT ... GROUP BY} didn't work in some cases. An
@code{Invalid use of group function} error occurred.
@item
When using @code{LIMIT}, @code{SELECT} now always uses keys instead of record
scan.  This will give better performance on @code{SELECT} and a @code{WHERE}
that matches many rows.
@item
Added Russian error messages.
@end itemize


@node News-3.21.11, News-3.21.10, News-3.21.12, News-3.21.x
@appendixsubsec Changes in release 3.21.11

@itemize @bullet
@item
Configure changes.
@item
MySQL now works with the new thread library on BSD/OS 3.0.
@item
Added new group functions @code{BIT_OR()} and @code{BIT_AND()}.
@item
Added compatibility functions @code{CHECK} and @code{REFERENCES}.
@code{CHECK} is now a reserved word.
@item
Added @code{ALL} option to @code{GRANT} for better compatibility. (@code{GRANT}
is still a dummy function.)
@item
Added partly translated Dutch error messages.
@item
Fixed bug in @code{ORDER BY} and @code{GROUP BY} with @code{NULL} columns.
@item
Added function @code{LAST_INSERT_ID()} SQL function to retrieve last
@code{AUTO_INCREMENT}
value.  This is intended for clients to ODBC that can't use the
@code{mysql_insert_id()} API function, but can be used by any client.
@item
Added @code{--flush-logs} option to @code{mysqladmin}.
@item
Added command @code{STATUS} to @code{mysql}.
@item
Fixed problem with @code{ORDER BY}/@code{GROUP BY} because of bug in @code{gcc}.
@item
Fixed problem with @code{INSERT ... SELECT ... GROUP BY}.
@end itemize


@node News-3.21.10, News-3.21.9, News-3.21.11, News-3.21.x
@appendixsubsec Changes in release 3.21.10

@itemize @bullet
@item
New program @code{mysqlaccess}.
@item
@code{CREATE} now supports all ODBC types and the @code{mSQL} @code{TEXT} type.
All ODBC 2.5 functions are also supported (added @code{REPEAT}). This provides
better portability.
@item
Added text types @code{TINYTEXT}, @code{TEXT}, @code{MEDIUMTEXT} and
@code{LONGTEXT}.  These are actually @code{BLOB}types, but all searching is
done in case-insensitive fashion.
@item
All old @code{BLOB} fields are now @code{TEXT} fields.  This only
changes that all searching on strings is done in case-sensitive fashion.
You must do an @code{ALTER TABLE} and change the datatype to @code{BLOB}
if you want to have tests done in case-sensitive fashion.
@item
Fixed some @code{configure} issues.
@item
Made the locking code a bit safer. Fixed very unlikely
deadlock situation.
@item
Fixed a couple of bugs in the range optimizer. Now the new range benchmark
@code{test-select} works.
@end itemize


@node News-3.21.9, News-3.21.8, News-3.21.10, News-3.21.x
@appendixsubsec Changes in release 3.21.9

@itemize @bullet
@item
Added @code{--enable-unix-socket=pathname} option to @code{configure}.
@item
Fixed a couple of portability problems with include files.
@item
Fixed bug in range calculation that could return empty
set when searching on multiple key with only one entry (very rare).
@item
Most things ported to FSU Pthreads, which should allow MySQL to
run on SCO. @xref{SCO}.
@end itemize


@node News-3.21.8, News-3.21.7, News-3.21.9, News-3.21.x
@appendixsubsec Changes in release 3.21.8

@itemize @bullet
@item
Works now in Solaris 2.6.
@item
Added handling of calculation of @code{SUM()} functions.
For example, you can now use @code{SUM(column)/COUNT(column)}.
@item
Added handling of trigometric functions:
@code{PI()}, @code{ACOS()}, @code{ASIN()}, @code{ATAN()}, @code{COS()},
@code{SIN()} and @code{TAN()}.
@item
New languages: Norwegian, Norwegian-ny and Portuguese.
@item
Fixed parameter bug in @code{net_print()} in @file{procedure.cc}.
@item
Fixed a couple of memory leaks.
@item
Now allow also the old @code{SELECT ... INTO OUTFILE} syntax.
@item
Fixed bug with @code{GROUP BY} and @code{SELECT} on key with many values.
@item
@code{mysql_fetch_lengths()} sometimes returned incorrect lengths when you used
@code{mysql_use_result()}. This affected at least some cases of
@code{mysqldump --quick}.
@item
Fixed bug in optimization of @code{WHERE const op field}.
@item
Fixed problem when sorting on @code{NULL} fields.
@item
Fixed a couple of 64-bit (Alpha) problems.
@item
Added @code{--pid-file=#} option to @code{mysqld}.
@item
Added date formatting to @code{FROM_UNIXTIME()}, originally by Zeev Suraski.
@item
Fixed bug in @code{BETWEEN} in range optimizer (did only test = of the first
argument).
@item
Added machine-dependent files for MIT-pthreads i386-SCO. There is probably
more to do to get this to work on SCO 3.5.
@end itemize


@node News-3.21.7, News-3.21.6, News-3.21.8, News-3.21.x
@appendixsubsec Changes in release 3.21.7

@itemize @bullet
@item
Changed @file{Makefile.am} to take advantage of Automake 1.2.
@item
Added the beginnings of a benchmark suite.
@item
Added more secure password handling.
@item
Added new client function @code{mysql_errno()}, to get the error number of
the error message. This makes error checking in the client much easier.
This makes the new server incompatible with the 3.20.x server when running
without @code{--old-protocol}.  The client code is backward-compatible.
More information can be found in the @file{README} file!
@item
Fixed some problems when using very long, illegal names.
@end itemize


@node News-3.21.6, News-3.21.5, News-3.21.7, News-3.21.x
@appendixsubsec Changes in release 3.21.6

@itemize @bullet
@item
Fixed more portability issues (incorrect @code{sigwait} and @code{sigset}
defines).
@item
@code{configure} should now be able to detect the last argument to
@code{accept()}.
@end itemize


@node News-3.21.5, News-3.21.4, News-3.21.6, News-3.21.x
@appendixsubsec Changes in release 3.21.5

@itemize @bullet
@item
Should now work with FreeBSD 3.0 if used with
@file{FreeBSD-3.0-libc_r-1.0.diff},
which can be found at @uref{http://www.mysql.com/downloads/os-freebsd.html}.
@item
Added new @code{-O tmp_table_size=#} option to @code{mysqld}.
@item
New function @code{FROM_UNIXTIME(timestamp)} which returns a date string in
@code{'YYYY-MM-DD HH:MM:SS'} format.
@item
New function @code{SEC_TO_TIME(seconds)} which returns a string in
@code{'HH:MM:SS'} format.
@item
New function @code{SUBSTRING_INDEX()}, originally by Zeev Suraski.
@end itemize


@node News-3.21.4, News-3.21.3, News-3.21.5, News-3.21.x
@appendixsubsec Changes in release 3.21.4

@itemize @bullet
@item
Should now configure and compile on OSF/1 4.0 with the DEC compiler.
@item
Configuration and compilation on BSD/OS 3.0 works, but due to some bugs in
BSD/OS 3.0, @code{mysqld} doesn't work on it yet.
@item
Configuration and compilation on FreeBSD 3.0 works, but I couldn't get
@code{pthread_create} to work.
@end itemize


@node News-3.21.3, News-3.21.2, News-3.21.4, News-3.21.x
@appendixsubsec Changes in release 3.21.3

@itemize @bullet
@item
Added reverse check lookup of hostnames to get better security.
@item
Fixed some possible buffer overflows if filenames that are too long are used.
@item
@code{mysqld} doesn't accept hostnames that start with digits followed by a
@code{'.'}, because the hostname may look like an IP number.
@item
Added @code{--skip-networking} option to @code{mysqld}, to allow only socket
connections.  (This will not work with MIT-pthreads!)
@item
Added check of too long table names for alias.
@item
Added check if database name is okay.
@item
Added check if too long table names.
@item
Removed incorrect @code{free()} that killed the server on
@code{CREATE DATABASE} or @code{DROP DATABASE}.
@item
Changed some @code{mysqld} @code{-O} options to better names.
@item
Added @code{-O join_cache_size=#} option to @code{mysqld}.
@item
Added @code{-O max_join_size=#} option to @code{mysqld}, to be able to set a
limit how big queries (in this case big = slow) one should be able to handle
without specifying @code{SET SQL_BIG_SELECTS=1}.  A # = is about 10
examined records. The default is ``unlimited''.
@item
When comparing a @code{TIME}, @code{DATE}, @code{DATETIME} or @code{TIMESTAMP}
column to a constant, the constant is converted to a time value before
performing the comparison.
This will make it easier to get ODBC (particularly Access97) to work with
the above types. It should also make dates easier to use and the comparisons
should be quicker than before.
@item
Applied patch from Jochen Wiedmann that allows @code{query()} in
@code{mysqlperl} to take a query with @code{\0} in it.
@item
Storing a timestamp with a 2-digit year (@code{YYMMDD}) didn't work.
@item
Fix that timestamp wasn't automatically updated if set in an @code{UPDATE}
clause.
@item
Now the automatic timestamp field is the FIRST timestamp field.
@item
@code{SELECT * INTO OUTFILE}, which didn't correctly if the outfile already
existed.
@item
@code{mysql} now shows the thread ID when starting or doing a reconnect.
@item
Changed the default sort buffer size from 2M to 1M.
@end itemize


@node News-3.21.2, News-3.21.0, News-3.21.3, News-3.21.x
@appendixsubsec Changes in release 3.21.2

@itemize @bullet
@item
The range optimizer is coded, but only 85% tested. It can be enabled with
@code{--new}, but it crashes core a lot yet...
@item
More portable. Should compile on AIX and alpha-digital.
At least the @code{isam} library should be relatively 64-bit clean.
@item
New @code{isamchk} which can detect and fix more problems.
@item
New options for @code{isamlog}.
@item
Using new version of Automake.
@item
Many small portability changes (from the AIX and alpha-digital port)
Better checking of pthread(s) library.
@item
czech error messages by @email{snajdr@@pvt.net}.
@item
Decreased size of some buffers to get fewer problems on systems with little
memory.  Also added more checks to handle ``out of memory'' problems.
@item
@code{mysqladmin}: you can now do @code{mysqladmin kill 5,6,7,8} to kill
multiple threads.
@item
When the maximum connection limit is reached, one extra connection by a user
with the @strong{process_acl} privilege is granted.
@item
Added @code{-O backlog=#} option to @code{mysqld}.
@item
Increased maximum packet size from 512K to 1024K for client.
@item
Almost all of the function code is now tested in the internal test suite.
@item
@code{ALTER TABLE} now returns warnings from field conversions.
@item
Port changed to 3306 (got it reserved from ISI).
@item
Added a fix for Visual FoxBase so that any schema name from a table
specification is automatically removed.
@item
New function @code{ASCII()}.
@item
Removed function @code{BETWEEN(a,b,c)}. Use the standard SQL
syntax instead: @code{expr BETWEEN expr AND expr}.
@item
MySQL no longer has to use an extra temporary table when sorting
on functions or @code{SUM()} functions.
@item
Fixed bug that you couldn't use @code{tbl_name.field_name} in @code{UPDATE}.
@item
Fixed @code{SELECT DISTINCT} when using 'hidden group'. For example:
@example
mysql> SELECT DISTINCT MOD(some_field,10) FROM test
    ->        GROUP BY some_field;
@end example
Note: @code{some_field} is normally in the @code{SELECT} part. Standard SQL should
require it.
@end itemize


@node News-3.21.0,  , News-3.21.2, News-3.21.x
@appendixsubsec Changes in release 3.21.0

@itemize @bullet
@item
New reserved words used: @code{INTERVAL}, @code{EXPLAIN}, @code{READ},
@code{WRITE}, @code{BINARY}.
@item
Added ODBC function @code{CHAR(num,...)}.
@item
New operator @code{IN}. This uses a binary search to find a match.
@item
New command @code{LOCK TABLES tbl_name [AS alias] @{READ|WRITE@} ...}
@item
Added @code{--log-update} option to @code{mysqld}, to get a log suitable for
incremental updates.
@item
New command @code{EXPLAIN SELECT ...} to get information about how the
optimizer will do the join.
@item
For easier client code, the client should no longer use
@code{FIELD_TYPE_TINY_BLOB}, @code{FIELD_TYPE_MEDIUM_BLOB},
@code{FIELD_TYPE_LONG_BLOB} or @code{FIELD_TYPE_VAR_STRING} (as
previously returned by @code{mysql_list_fields}).  You should instead use only
@code{FIELD_TYPE_BLOB} or @code{FIELD_TYPE_STRING}.  If you want exact
types, you should use the command @code{SHOW FIELDS}.
@item
Added varbinary syntax: @code{0x######} which can be used as a string
(default) or a number.
@item
@code{FIELD_TYPE_CHAR} is renamed to @code{FIELD_TYPE_TINY}.
@item
Changed all fields to C++ classes.
@item
Removed FORM struct.
@item
Fields with @code{DEFAULT} values no longer need to be @code{NOT NULL}.
@item
New field types:
@table @code
@item ENUM
A string which can take only a couple of defined values. The value is
stored as a 1-3 byte number that is mapped automatically to a string.
This is sorted according to string positions!
@item SET
A string which may have one or many string values separated with ','.
The string is stored as a 1-, 2-, 3-, 4- or 8-byte number where each bit stands
for a specific set member.  This is sorted according to the unsigned value
of the stored packed number.
@end table
@item
Now all function calculation is done with @code{double} or @code{long long}.
This will provide the full 64-bit range with bit functions and fix some
conversions that previously could result in precision losses.  One should
avoid using @code{unsigned long long} columns with full 64-bit range
(numbers bigger than 9223372036854775807) because calculations are done
with @code{signed long long}.
@item
@code{ORDER BY} will now put @code{NULL} field values first. @code{GROUP BY}
will also work with @code{NULL} values.
@item
Full @code{WHERE} with expressions.
@item
New range optimizer that can resolve ranges when some keypart prefix is
constant. Example:
@example
mysql> SELECT * FROM tbl_name
    ->          WHERE key_part_1="customer"
    ->          AND key_part_2>=10 AND key_part_2<=10;
@end example
@end itemize


@node News-3.20.x, News-3.19.x, News-3.21.x, News
@appendixsec Changes in release 3.20.x

@cindex changes, version 3.20

Version 3.20 is quite old now, and should be avoided if possible.  This
information is kept here for historical purposes only.

Changes from 3.20.18 to 3.20.32b are not documented here because the
3.21 release branched here. And the relevant changes are also
documented as changes to the 3.21 version.

@menu
* News-3.20.18::                Changes in release 3.20.18
* News-3.20.17::                Changes in release 3.20.17
* News-3.20.16::                Changes in release 3.20.16
* News-3.20.15::                Changes in release 3.20.15
* News-3.20.14::                Changes in release 3.20.14
* News-3.20.13::                Changes in release 3.20.13
* News-3.20.11::                Changes in release 3.20.11
* News-3.20.10::                Changes in release 3.20.10
* News-3.20.9::                 Changes in release 3.20.9
* News-3.20.8::                 Changes in release 3.20.8
* News-3.20.7::                 Changes in release 3.20.7
* News-3.20.6::                 Changes in release 3.20.6
* News-3.20.3::                 Changes in release 3.20.3
* News-3.20.0::                 Changes in release 3.20.0
@end menu


@node News-3.20.18, News-3.20.17, News-3.20.x, News-3.20.x
@appendixsubsec Changes in release 3.20.18

@itemize @bullet
@item
Added @code{-p#} (remove @code{#} directories from path) to @code{isamlog}.
All files are written with a relative path from the database directory
Now @code{mysqld} shouldn't crash on shutdown when using the
@code{--log-isam} option.
@item
New @code{mysqlperl} version. It is now compatible with @code{msqlperl-0.63}.
@item
New @code{DBD} module available.
@item
Added group function @code{STD()} (standard deviation).
@item
The @code{mysqld} server is now compiled by default without debugging
information.  This will make the daemon smaller and faster.
@item
Now one usually only has to specify the @code{--basedir} option to
@code{mysqld}. All other paths are relative in a normal installation.
@item
@code{BLOB} columns sometimes contained garbage when used with a @code{SELECT}
on more than one table and @code{ORDER BY}.
@item
Fixed that calculations that are not in @code{GROUP BY} work as expected
(SQL-99 extension).
Example:
@example
mysql> SELECT id,id+1 FROM table GROUP BY id;
@end example
@item
The test of using @code{MYSQL_PWD} was reversed. Now @code{MYSQL_PWD} is
enabled as default in the default release.
@item
Fixed conversion bug which caused @code{mysqld} to core dump with
Arithmetic error on SPARC-386.
@item
Added @code{--unbuffered} option to @code{mysql}, for new @code{mysqlaccess}.
@item
When using overlapping (unnecessary) keys and join over many tables,
the optimizer could get confused and return 0 records.
@end itemize


@node News-3.20.17, News-3.20.16, News-3.20.18, News-3.20.x
@appendixsubsec Changes in release 3.20.17

@itemize @bullet
@item
You can now use @code{BLOB} columns and the functions @code{IS NULL} and
@code{IS NOT NULL} in the @code{WHERE} clause.
@item
All communication packets and row buffers are now allocated dynamically
on demand. The default value of @code{max_allowed_packet} is now 64K for
the server and 512K for the client. This is mainly used to catch
incorrect packets that could trash all memory. The server limit may be
changed when it is started.
@item
Changed stack usage to use less memory.
@item
Changed @code{safe_mysqld} to check for running daemon.
@item
The @code{ELT()} function is renamed to @code{FIELD()}.  The new
@code{ELT()} function returns a value based on an index: @code{FIELD()}
is the inverse of @code{ELT()} Example: @code{ELT(2,"A","B","C")} returns
@code{"B"}. @code{FIELD("B","A","B","C")} returns @code{2}.
@item
@code{COUNT(field)}, where @code{field} could have a @code{NULL} value, now
works.
@item
A couple of bugs fixed in @code{SELECT ... GROUP BY}.
@item
Fixed memory overrun bug in @code{WHERE} with many unoptimizable brace levels.
@item
Fixed some small bugs in the grant code.
@item
If hostname isn't found by @code{get_hostname}, only the IP is checked.
Previously, you got @code{Access denied}.
@item
Inserts of timestamps with values didn't always work.
@item
@code{INSERT INTO ... SELECT ... WHERE} could give the error
@code{Duplicated field}.
@item
Added some tests to @code{safe_mysqld} to make it ``safer''.
@item
@code{LIKE} was case-sensitive in some places and case-insensitive in others.
Now @code{LIKE} is always case-insensitive.
@item
@file{mysql.cc}: Allow @code{'#'} anywhere on the line.
@item
New command @code{SET SQL_SELECT_LIMIT=#}. See the FAQ for more details.
@item
New version of the @code{mysqlaccess} script.
@item
Change @code{FROM_DAYS()} and @code{WEEKDAY()} to also take a full
@code{TIMESTAMP} or @code{DATETIME} as argument. Before they only took a
number of type @code{YYYYMMDD} or @code{YYMMDD}.
@item
Added new function @code{UNIX_TIMESTAMP(timestamp_column)}.
@end itemize


@node News-3.20.16, News-3.20.15, News-3.20.17, News-3.20.x
@appendixsubsec Changes in release 3.20.16

@itemize @bullet
@item
More changes in MIT-pthreads to get them safer. Fixed also some link
bugs at least in SunOS.
@item
Changed @code{mysqld} to work around a bug in MIT-pthreads. This makes multiple
small @code{SELECT} operations 20 times faster. Now @code{lock_test.pl} should
work.
@item
Added @code{mysql_FetchHash(handle)} to @code{mysqlperl}.
@item
The @code{mysqlbug} script is now distributed built to allow for reporting
bugs that appear during the build with it.
@item
Changed @file{libmysql.c} to prefer @code{getpwuid()} instead of
@code{cuserid()}.
@item
Fixed bug in @code{SELECT} optimizer when using many tables with the same
column used as key to different tables.
@item
Added new @code{latin2} and Russian @code{KOI8} character tables.
@item
Added support for a dummy @code{GRANT} command to satisfy Powerbuilder.
@end itemize


@node News-3.20.15, News-3.20.14, News-3.20.16, News-3.20.x
@appendixsubsec Changes in release 3.20.15

@itemize @bullet
@item
Fixed fatal bug @code{packets out of order} when using MIT-pthreads.
@item
Removed possible loop when a thread waits for command from client
and @code{fcntl()} fails. Thanks to Mike Bretz for finding this bug.
@item
Changed alarm loop in @file{mysqld.cc} because shutdown didn't always
succeed in Linux.
@item
Removed use of @code{termbits} from @file{mysql.cc}.  This conflicted with
@code{glibc} 2.0.
@item
Fixed some syntax errors for at least BSD and Linux.
@item
Fixed bug when doing a @code{SELECT} as superuser without a database.
@item
Fixed bug when doing @code{SELECT} with group calculation to outfile.
@end itemize


@node News-3.20.14, News-3.20.13, News-3.20.15, News-3.20.x
@appendixsubsec Changes in release 3.20.14

@itemize @bullet
@item
If one gives @code{-p} or @code{--password} option to @code{mysql} without
an argument, the user is solicited for the password from the tty.
@item
Added default password from @code{MYSQL_PWD} (by Elmar Haneke).
@item
Added command @code{kill} to @code{mysqladmin} to kill a specific
MySQL thread.
@item
Sometimes when doing a reconnect on a down connection this succeeded
first on second try.
@item
Fixed adding an @code{AUTO_INCREMENT} key with @code{ALTER_TABLE}.
@item
@code{AVG()} gave too small value on some @code{SELECT} statements with
@code{GROUP BY} and @code{ORDER BY}.
@item
Added new @code{DATETIME} type (by Giovanni Maruzzelli
@email{maruzz@@matrice.it}).
@item
Fixed that defining @code{DONT_USE_DEFAULT_FIELDS} works.
@item
Changed to use a thread to handle alarms instead of signals on Solaris to
avoid race conditions.
@item
Fixed default length of signed numbers. (George Harvey
@email{georgeh@@pinacl.co.uk}.)
@item
Allow anything for @code{CREATE INDEX}.
@item
Add prezeros when packing numbers to @code{DATE}, @code{TIME} and
@code{TIMESTAMP}.
@item
Fixed a bug in @code{OR} of multiple tables (gave empty set).
@item
Added many patches to MIT-pthreads. This fixes at least one lookup bug.
@end itemize


@node News-3.20.13, News-3.20.11, News-3.20.14, News-3.20.x
@appendixsubsec Changes in release 3.20.13

@itemize @bullet
@item
Added standard SQL-92 @code{DATE} and @code{TIME} types.
@item
Fixed bug in @code{SELECT} with @code{AND}-@code{OR} levels.
@item
Added support for Slovenian characters. The @file{Contrib} directory contains
source and instructions for adding other character sets.
@item
Fixed bug with @code{LIMIT} and @code{ORDER BY}.
@item
Allow @code{ORDER BY} and @code{GROUP BY} on items that aren't in the
@code{SELECT} list.
(Thanks to Wim Bonis @email{bonis@@kiss.de}, for pointing this out.)
@item
Allow setting of timestamp values in @code{INSERT}.
@item
Fixed bug with @code{SELECT ... WHERE ... = NULL}.
@item
Added changes for @code{glibc} 2.0. To get @code{glibc} to work, you should
add the @file{gibc-2.0-sigwait-patch} before compiling @code{glibc}.
@item
Fixed bug in @code{ALTER TABLE} when changing a @code{NOT NULL} field to
allow @code{NULL} values.
@item
Added some SQL-92 synonyms as field types to @code{CREATE TABLE}.
@code{CREATE TABLE} now allows @code{FLOAT(4)} and @code{FLOAT(8)} to mean
@code{FLOAT} and @code{DOUBLE}.
@item
New utility program @code{mysqlaccess} by @email{Yves.Carlier@@rug.ac.be}.
This program shows the access rights for a specific user and the grant
rows that determine this grant.
@item
Added @code{WHERE const op field} (by @email{bonis@@kiss.de}).
@end itemize


@node News-3.20.11, News-3.20.10, News-3.20.13, News-3.20.x
@appendixsubsec Changes in release 3.20.11

@itemize @bullet
@item
When using @code{SELECT ... INTO OUTFILE}, all temporary tables are ISAM
instead of HEAP to allow big dumps.
@item
Changed date functions to be string functions. This fixed some ``funny''
side effects when sorting on dates.
@item
Extended @code{ALTER TABLE} for SQL-92 compliance.
@item
Some minor compatibility changes.
@item
Added @code{--port} and @code{--socket} options to all utility programs and
@code{mysqld}.
@item
Fixed MIT-pthreads @code{readdir_r()}. Now @code{mysqladmin create database}
and @code{mysqladmin drop database} should work.
@item
Changed MIT-pthreads to use our @code{tempnam()}. This should fix the ``sort
aborted'' bug.
@item
Added sync of records count in @code{sql_update}. This fixed slow updates
on first connection. (Thanks to Vaclav Bittner for the test.)
@end itemize


@node News-3.20.10, News-3.20.9, News-3.20.11, News-3.20.x
@appendixsubsec Changes in release 3.20.10

@itemize @bullet
@item
New insert type: @code{INSERT INTO ... SELECT ...}
@item
@code{MEDIUMBLOB} fixed.
@item
Fixed bug in @code{ALTER TABLE} and @code{BLOB} values.
@item
@code{SELECT ... INTO OUTFILE} now creates the file in the current
database directory.
@item
@code{DROP TABLE} now can take a list of tables.
@item
Oracle synonym @code{DESCRIBE} (@code{DESC}).
@item
Changes to @code{make_binary_distribution}.
@item
Added some comments to installation instructions about @code{configure}'s
C++ link test.
@item
Added @code{--without-perl} option to @code{configure}.
@item
Lots of small portability changes.
@end itemize


@node News-3.20.9, News-3.20.8, News-3.20.10, News-3.20.x
@appendixsubsec Changes in release 3.20.9

@itemize @bullet
@item
@code{ALTER TABLE} didn't copy null bit. As a result, fields that were allowed
to have @code{NULL} values were always @code{NULL}.
@item
@code{CREATE} didn't take numbers as @code{DEFAULT}.
@item
Some compatibility changes for SunOS.
@item
Removed @file{config.cache} from old distribution.
@end itemize


@node News-3.20.8, News-3.20.7, News-3.20.9, News-3.20.x
@appendixsubsec Changes in release 3.20.8

@itemize @bullet
@item
Fixed bug with @code{ALTER TABLE} and multi-part keys.
@end itemize


@node News-3.20.7, News-3.20.6, News-3.20.8, News-3.20.x
@appendixsubsec Changes in release 3.20.7

@itemize @bullet
@item
New commands: @code{ALTER TABLE}, @code{SELECT ... INTO OUTFILE} and
@code{LOAD DATA INFILE}.
@item
New function: @code{NOW()}.
@item
Added new field @code{File_priv} to @code{mysql/user} table.
@item
New script @code{add_file_priv} which adds the new field @code{File_priv}
to the @code{user} table. This script must be executed if you want to
use the new @code{SELECT ... INTO} and @code{LOAD DATA INFILE ...} commands
with a version of MySQL earlier than 3.20.7.
@item
Fixed bug in locking code, which made @code{lock_test.pl} test fail.
@item
New files @file{NEW} and @file{BUGS}.
@item
Changed @file{select_test.c} and @file{insert_test.c} to include
@file{config.h}.
@item
Added @code{status} command to @code{mysqladmin} for short logging.
@item
Increased maximum number of keys to 16 and maximum number of key parts to 15.
@item
Use of sub keys. A key may now be a prefix of a string field.
@item
Added @code{-k} option to @code{mysqlshow}, to get key information for a table.
@item
Added long options to @code{mysqldump}.
@end itemize


@node News-3.20.6, News-3.20.3, News-3.20.7, News-3.20.x
@appendixsubsec Changes in release 3.20.6

@itemize @bullet
@item
Portable to more systems because of MIT-pthreads, which will
be used automatically if @code{configure} cannot find a @code{-lpthreads}
library.
@item
Added GNU-style long options to almost all programs. Test with
@code{@kbd{program} --help}.
@item
Some shared library support for Linux.
@item
The FAQ is now in @file{.texi} format and is available in @file{.html},
@file{.txt} and @file{.ps} formats.
@item
Added new SQL function @code{RAND([init])}.
@item
Changed @code{sql_lex} to handle @code{\0} unquoted, but the client can't send
the query through the C API, because it takes a str pointer.
You must use @code{mysql_real_query()} to send the query.
@item
Added API function @code{mysql_get_client_info()}.
@item
@code{mysqld} now uses the @code{N_MAX_KEY_LENGTH} from @file{nisam.h} as
the maximum allowable key length.
@item
The following now works:
@example
mysql> SELECT filter_nr,filter_nr FROM filter ORDER BY filter_nr;
@end example
Previously, this resulted in the error:
@code{Column: 'filter_nr' in order clause is ambiguous}.
@item
@code{mysql} now outputs @code{'\0'}, @code{'\t'}, @code{'\n'} and @code{'\\'}
when encountering ASCII 0, tab, newline or @code{'\'} while writing
tab-separated output.
This is to allow printing of binary data in a portable format.
To get the old behavior, use @code{-r} (or @code{--raw}).
@item
Added german error messages (60 of 80 error messages translated).
@item
Added new API function @code{mysql_fetch_lengths(MYSQL_RES *)}, which
returns an array of column lengths (of type @code{uint}).
@item
Fixed bug with @code{IS NULL} in @code{WHERE} clause.
@item
Changed the optimizer a little to get better results when searching on a key
part.
@item
Added @code{SELECT} option @code{STRAIGHT_JOIN} to tell the optimizer that
it should join tables in the given order.
@item
Added support for comments starting with @code{'--'} in @file{mysql.cc}
(Postgres syntax).
@item
You can have @code{SELECT} expressions and table columns in a @code{SELECT}
which are not used in the group part. This makes it efficient to implement
lookups.  The column that is used should be a constant for each group because
the value is calculated only once for the first row that is found for a group.
@example
mysql> SELECT id,lookup.text,SUM(*) FROM test,lookup
    ->        WHERE test.id=lookup.id GROUP BY id;
@end example
@item
Fixed bug in @code{SUM(function)} (could cause a core dump).
@item
Changed @code{AUTO_INCREMENT} placement in the SQL query:
@example
INSERT INTO table (auto_field) VALUES (0);
@end example
inserted 0, but it should insert an @code{AUTO_INCREMENT} value.
@item
@file{mysqlshow.c}: Added number of records in table. Had to change the
client code a little to fix this.
@item
@code{mysql} now allows doubled @code{''} or @code{""} within strings for
embedded @code{'} or @code{"}.
@item
New math functions:
@code{EXP()}, @code{LOG()}, @code{SQRT()}, @code{ROUND()}, @code{CEILING()}.
@end itemize


@node News-3.20.3, News-3.20.0, News-3.20.6, News-3.20.x
@appendixsubsec Changes in release 3.20.3

@itemize @bullet
@item
The @code{configure} source now compiles a thread-free client library
@code{-lmysqlclient}. This is the only library that needs to be linked
with client applications.  When using the binary releases, you must
link with @code{-lmysql -lmysys -ldbug -lmystrings} as before.
@item
New @code{readline} library from @code{bash-2.0}.
@item
LOTS of small changes to @code{configure} and makefiles (and related source).
@item
It should now be possible to compile in another directory using
@code{VPATH}. Tested with GNU Make 3.75.
@item
@code{safe_mysqld} and @code{mysql.server} changed to be more compatible
between the source and the binary releases.
@item
@code{LIMIT} now takes one or two numeric arguments.
If one argument is given, it indicates the maximum number of rows in
a result. If two arguments are given, the first argument indicates the offset
of the first row to return, the second is the maximum number of rows.
With this it's easy to do a poor man's next page/previous page WWW
application.
@item
Changed name of SQL function @code{FIELDS()} to @code{ELT()}.
Changed SQL function @code{INTERVALL()} to @code{INTERVAL()}.
@item
Made @code{SHOW COLUMNS} a synonym for @code{SHOW FIELDS}.
Added compatibility syntax @code{FRIEND KEY} to @code{CREATE TABLE}. In
MySQL, this creates a non-unique key on the given columns.
@item
Added @code{CREATE INDEX} and @code{DROP INDEX} as compatibility functions.
In MySQL, @code{CREATE INDEX} only checks if the index exists and
issues an error if it doesn't exist. @code{DROP INDEX} always succeeds.
@item
@file{mysqladmin.c}: added client version to version information.
@item
Fixed core dump bug in @code{sql_acl} (core on new connection).
@item
Removed @code{host}, @code{user} and @code{db} tables from database @code{test}
in the distribution.
@item
@code{FIELD_TYPE_CHAR} can now be signed (-128 to 127) or unsigned (0 to 255)
Previously, it was always unsigned.
@item
Bug fixes in @code{CONCAT()} and @code{WEEKDAY()}.
@item
Changed a lot of source to get @code{mysqld} to be compiled with SunPro
compiler.
@item
SQL functions must now have a @code{'('} immediately after the function name
(no intervening space).
For example, @code{'USER('} is regarded as beginning a function call, and
@code{'USER ('} is regarded as an identifier @code{USER} followed by a
@code{'('}, not as a function call.
@end itemize


@node News-3.20.0,  , News-3.20.3, News-3.20.x
@appendixsubsec Changes in release 3.20.0

@itemize @bullet
@item
The source distribution is done with @code{configure} and Automake.
It will make porting much easier.  The @code{readline} library is included
in the distribution.
@item
Separate client compilation:
the client code should be very easy to compile on systems which
don't have threads.
@item
The old Perl interface code is automatically compiled and installed.
Automatic compiling of @code{DBD} will follow when the new @code{DBD} code
is ported.
@item
Dynamic language support: @code{mysqld} can now be started with Swedish
or English (default) error messages.
@item
New functions: @code{INSERT()}, @code{RTRIM()}, @code{LTRIM()} and
@code{FORMAT()}.
@item
@code{mysqldump} now works correctly for all field types (even
@code{AUTO_INCREMENT}). The format for @code{SHOW FIELDS FROM tbl_name}
is changed so the @code{Type} column contains information suitable for
@code{CREATE TABLE}.  In previous releases, some @code{CREATE TABLE}
information had to be patched when re-creating tables.
@item
Some parser bugs from 3.19.5 (@code{BLOB} and @code{TIMESTAMP}) are corrected.
@code{TIMESTAMP} now returns different date information depending on its
create length.
@item
Changed parser to allow a database, table or field name to
start with a number or @code{'_'}.
@item
All old C code from Unireg changed to C++ and cleaned up. This makes
the daemon a little smaller and easier to understand.
@item
A lot of small bug fixes done.
@item
New @file{INSTALL} files (not final version) and some information regarding porting.
@end itemize


@node News-3.19.x,  , News-3.20.x, News
@appendixsec Changes in release 3.19.x

@cindex changes, version 3.19

Version 3.19 is quite old now, and should be avoided if possible.  This
information is kept here for historical purposes only.

@menu
* News-3.19.5::                 Changes in release 3.19.5
* News-3.19.4::                 Changes in release 3.19.4
* News-3.19.3::                 Changes in release 3.19.3
@end menu


@node News-3.19.5, News-3.19.4, News-3.19.x, News-3.19.x
@appendixsubsec Changes in release 3.19.5

@itemize @bullet
@item
Some new functions, some more optimization on joins.
@item
Should now compile clean on Linux (2.0.x).
@item
Added functions @code{DATABASE()}, @code{USER()}, @code{POW()},
@code{LOG10()} (needed for ODBC).
@item
In a @code{WHERE} with an @code{ORDER BY} on fields from only one table,
the table is now preferred as first table in a multi-join.
@item
@code{HAVING} and @code{IS NULL} or @code{IS NOT NULL} now works.
@item
A group on one column and a sort on a group function (@code{SUM()},
@code{AVG()}...) didn't work together. Fixed.
@item
@code{mysqldump}: Didn't send password to server.
@end itemize


@node News-3.19.4, News-3.19.3, News-3.19.5, News-3.19.x
@appendixsubsec Changes in release 3.19.4

@itemize @bullet
@item
Fixed horrible locking bug when inserting in one thread and reading
in another thread.
@item
Fixed one-off decimal bug.  1.00 was output as 1.0.
@item
Added attribute @code{'Locked'} to process list as information if a query is
locked by another query.
@item
Fixed full magic timestamp. Timestamp length may now be 14, 12, 10, 8, 6, 4
or 2 bytes.
@item
Sort on some numeric functions could sort incorrectly on last number.
@item
@code{IF(arg,syntax_error,syntax_error)} crashed.
@item
Added functions @code{CEILING()}, @code{ROUND()}, @code{EXP()}, @code{LOG()} and @code{SQRT()}.
@item
Enhanced @code{BETWEEN} to handle strings.
@end itemize


@node News-3.19.3,  , News-3.19.4, News-3.19.x
@appendixsubsec Changes in release 3.19.3

@itemize @bullet
@item
Fixed @code{SELECT} with grouping on @code{BLOB} columns not to return
incorrect @code{BLOB} info. Grouping, sorting and distinct on @code{BLOB}
columns will not yet work as
expected (probably it will group/sort by the first 7 characters in the
@code{BLOB}). Grouping on formulas with a fixed string size (use @code{MID()}
on a @code{BLOB}) should work.
@item
When doing a full join (no direct keys) on multiple tables with @code{BLOB}
fields, the @code{BLOB} was garbage on output.
@item
Fixed @code{DISTINCT} with calculated columns.
@end itemize





@node Porting, Environment variables, News, Top
@appendix Porting to Other Systems

@cindex porting, to other systems

This appendix will help you port MySQL to other operating systems.
Do check the list of currently supported operating systems first.
@xref{Which OS}.
If you have created a new port of MySQL, please let us know so that
we can list it here and on our web site (@uref{http://www.mysql.com/}),
recommending it to other users.

Note: If you create a new port of MySQL, you are free to copy and
distribute it under the @code{GPL} license, but it does not make you a
copyright holder of MySQL.

A working POSIX thread library is needed for the server. On Solaris 2.5
we use Sun PThreads (the native thread support in 2.4 and earlier
versions is not good enough), on Linux we use LinuxThreads by Xavier
Leroy, @email{Xavier.Leroy@@inria.fr}.

The hard part of porting to a new Unix variant without good native
thread support is probably to port MIT-pthreads. See
@file{mit-pthreads/README} and Programming POSIX Threads
(@uref{http://www.humanfactor.com/pthreads/}).

Up to MySQL 4.0.2, the MySQL distribution included a patched version of
Chris Provenzano's Pthreads from MIT (see the MIT Pthreads web page at
@uref{http://www.mit.edu/afs/sipb/project/pthreads/} and a programming
introduction at @uref{http://www.mit.edu:8001/people/proven/IAP_2000/}).
These can be used for some operating systems that do not have POSIX threads.
@xref{MIT-pthreads}.

It is also possible to use another user level thread package named
FSU Pthreads (see @uref{http://moss.csc.ncsu.edu/~mueller/pthreads/}).
This implementation is being used for the SCO port.

See the @file{thr_lock.c} and @file{thr_alarm.c} programs in the @file{mysys}
directory for some tests/examples of these problems.

Both the server and the client need a working C++ compiler. We use @code{gcc}
on many platforms. Other compilers that are known to work are SPARCworks,
Sun Forte, Irix @code{cc}, HP-UX @code{aCC}, IBM AIX @code{xlC_r}), Intel
@code{ecc} and Compaq @code{cxx}).

To compile only the client use @code{./configure --without-server}.

There is currently no support for only compiling the server, nor is it
likly to be added unless someone has a good reason for it.

If you want/need to change any @file{Makefile} or the configure script you
will also need GNU Automake and Autoconf.
@xref{Installing source tree}.

All steps needed to remake everything from the most basic files.

@example
/bin/rm */.deps/*.P
/bin/rm -f config.cache
aclocal
autoheader
aclocal
automake
autoconf
./configure --with-debug=full --prefix='your installation directory'

# The makefiles generated above need GNU make 3.75 or newer.
# (called gmake below)
gmake clean all install init-db
@end example

If you run into problems with a new port, you may have to do some debugging
of MySQL!
@xref{Debugging server}.

@strong{Note:} Before you start debugging @code{mysqld}, first get the test
programs @code{mysys/thr_alarm} and @code{mysys/thr_lock} to work.  This
will ensure that your thread installation has even a remote chance to work!

@menu
* Debugging server::            Debugging a MySQL server
* Debugging client::            Debugging a MySQL client
* The DBUG package::            The DBUG Package
* Locking methods::             Locking methods
* RTS-threads::                 Comments about RTS threads
* Thread packages::             Differences between different thread packages
@end menu


@node Debugging server, Debugging client, Porting, Porting
@appendixsec Debugging a MySQL server

@cindex server, debugging
@cindex debugging, server
@cindex crash

If you are using some functionality that is very new in MySQL,
you can try to run @code{mysqld} with the @code{--skip-new} (which will disable all
new, potentially unsafe functionality) or with @code{--safe-mode} which
disables a lot of optimization that may cause problems.
@xref{Crashing}.

If @code{mysqld} doesn't want to start, you should check that you don't have
any @file{my.cnf} files that interfere with your setup!
You can check your @file{my.cnf} arguments with @code{mysqld --print-defaults}
and avoid using them by starting with @code{mysqld --no-defaults ...}.

If @code{mysqld} starts to eat up CPU or memory or if it ``hangs'', you
can use @code{mysqladmin processlist status} to find out if someone is
executing a query that takes a long time.  It may be a good idea to
run @code{mysqladmin -i10 processlist status} in some window if you are
experiencing performance problems or problems when new clients can't connect.

The command @code{mysqladmin debug} will dump some information about
locks in use, used memory and query usage to the mysql log file. This
may help solve some problems.  This command also provides some useful
information even if you haven't compiled MySQL for debugging!

If the problem is that some tables are getting slower and slower you
should try to optimize the table with @code{OPTIMIZE TABLE} or
@code{myisamchk}.  @xref{MySQL Database Administration}. You should also
check the slow queries with @code{EXPLAIN}.

You should also read the OS-specific section in this manual for
problems that may be unique to your environment.
@xref{Operating System Specific Notes}.

@menu
* Compiling for debugging::     Compiling MYSQL for Debugging
* Making trace files::          Creating Trace Files
* Using gdb on mysqld::         Debugging mysqld under gdb
* Using stack trace::           Using a Stack Trace
* Using log files::             Using Log Files to Find Cause of Errors in mysqld
* Reproduceable test case::     Making a Test Case If You Experience Table Corruption
@end menu


@node Compiling for debugging, Making trace files, Debugging server, Debugging server
@appendixsubsec Compiling MYSQL for Debugging

If you have some very specific problem, you can always try to debug
MySQL.  To do this you must configure MySQL with the
@code{--with-debug} or the @code{--with-debug=full} option.  You can check
whether MySQL was compiled with debugging by doing:
@code{mysqld --help}.  If the @code{--debug} flag is listed with the
options then you have debugging enabled.  @code{mysqladmin ver} also
lists the @code{mysqld} version as @code{mysql ... --debug} in this case.

If you are using @code{gcc} or @code{egcs}, the recommended @code{configure} line is:

@example
CC=gcc CFLAGS="-O2" CXX=gcc CXXFLAGS="-O2 -felide-constructors \
   -fno-exceptions -fno-rtti" ./configure --prefix=/usr/local/mysql \
   --with-debug --with-extra-charsets=complex
@end example

This will avoid problems with the @code{libstdc++} library and with C++
exceptions (many compilers have problems with C++ exceptions in threaded
code) and compile a MySQL version with support for all character sets.

If you suspect a memory overrun error, you can configure MySQL
with @code{--with-debug=full}, which will install a memory allocation
(@code{SAFEMALLOC}) checker. However, running with @code{SAFEMALLOC} is
quite slow, so if you get performance problems you should start
@code{mysqld} with the @code{--skip-safemalloc} option. This will
disable the memory overrun checks for each call to @code{malloc()} and
@code{free()}.

If @code{mysqld} stops crashing when you compile it with
@code{--with-debug}, you have probably found a compiler bug or a timing
bug within MySQL.  In this case you can try to add @code{-g} to
the @code{CFLAGS} and @code{CXXFLAGS} variables above and not use
@code{--with-debug}. If @code{mysqld} now dies, you can at least attach
to it with @code{gdb} or use @code{gdb} on the core file to find out
what happened.

When you configure MySQL for debugging you automatically enable a
lot of extra safety check functions that monitor the health of @code{mysqld}.
If they find something ``unexpected,'' an entry will be written to
@code{stderr}, which @code{safe_mysqld} directs to the error log!  This also
means that if you are having some unexpected problems with MySQL and
are using a source distribution, the first thing you should do is to
configure MySQL for debugging!  (The second thing is to
send mail to a MySQL mailing list and ask for help.
@xref{Mailing-list}.
Please use the
@code{mysqlbug} script for all bug reports or questions regarding the
MySQL version you are using!

In the Windows MySQL distribution, @code{mysqld.exe} is by
default compiled with support for trace files.


@node Making trace files, Using gdb on mysqld, Compiling for debugging, Debugging server
@appendixsubsec Creating Trace Files

If the @code{mysqld} server doesn't start or if you can cause the
@code{mysqld} server to crash quickly, you can try to create a trace
file to find the problem.

To do this you have to have a @code{mysqld} that is compiled for debugging.
You can check this by executing @code{mysqld -V}.  If the version number
ends with @code{-debug}, it's compiled with support for trace files.

Start the @code{mysqld} server with a trace log in @file{/tmp/mysqld.trace}
(or @file{C:\mysqld.trace} on Windows):

@code{mysqld --debug}

On Windows you should also use the @code{--standalone} flag to not start
@code{mysqld} as a service:

In a console window do:

@example
mysqld --debug --standalone
@end example

After this, you can use the @code{mysql.exe} command-line tool in a
second console window to reproduce the problem. You can take down the above
@code{mysqld} server with @code{mysqladmin shutdown}.

Note that the trace file will get @strong{very big}!
If you want to have a smaller trace file, you can use something like:

@code{mysqld --debug=d,info,error,query,general,where:O,/tmp/mysqld.trace}

which only prints information with the most interesting tags in
@file{/tmp/mysqld.trace}.

If you make a bug report about this, please only send the lines from the
trace file to the appropriate mailing list where something seems to go
wrong! If you can't locate the wrong place, you can ftp the trace file,
together with a full bug report, to
@uref{ftp://support.mysql.com/pub/mysql/secret/} so that a MySQL
developer can take a look a this.

The trace file is made with the @strong{DBUG} package by Fred Fish.
@xref{The DBUG package}.


@node Using gdb on mysqld, Using stack trace, Making trace files, Debugging server
@appendixsubsec Debugging mysqld under gdb

@cindex gdb, using

On most systems you can also start @code{mysqld} from @code{gdb} to get
more information if @code{mysqld} crashes.

With some older @code{gdb} versions on Linux you must use @code{run
--one-thread} if you want to be able to debug @code{mysqld} threads.  In
this case you can only have one thread active at a time.  We recommend you
to upgrade to gdb 5.1 ASAP as thread debugging works much better with this
version!

When running @code{mysqld} under gdb, you should disable the stack trace
with @code{--skip-stack-trace} to be able to catch segfaults within gdb.

In MySQL 4.0.14 and above you should use the @code{--gdb} option to
mysqld.  This will install an interrupt handler for @code{SIGINT} (needed
to stop mysqld with @code{^C} to set breakpoints) and disable stack
tracing and core file handling.

It's very hard to debug MySQL under @code{gdb} if you do a lot of
new connections the whole time as @code{gdb} doesn't free the memory for
old threads.  You can avoid this problem by starting @code{mysqld} with
@code{-O thread_cache_size= 'max_connections +1'}.  In most cases just
using @code{-O thread_cache_size=5'} will help a lot!

If you want to get a core dump on Linux if @code{mysqld} dies with a
SIGSEGV signal, you can start @code{mysqld} with the @code{--core-file} option.
This core file can be used to make a backtrace that may help you
find out why @code{mysqld} died:

@example
shell> gdb mysqld core
gdb>   backtrace full
gdb>   exit
@end example

@xref{Crashing}.

If you are using gdb 4.17.x or above on Linux, you should install a
@file{.gdb} file, with the following information, in your current
directory:

@example
set print sevenbit off
handle SIGUSR1 nostop noprint
handle SIGUSR2 nostop noprint
handle SIGWAITING nostop noprint
handle SIGLWP nostop noprint
handle SIGPIPE nostop
handle SIGALRM nostop
handle SIGHUP nostop
handle SIGTERM nostop noprint
@end example

If you have problems debugging threads with gdb, you should download
gdb 5.x and try this instead. The new gdb version has very improved
thread handling!

Here is an example how to debug mysqld:

@example
shell> gdb /usr/local/libexec/mysqld
gdb> run
...
backtrace full # Do this when mysqld crashes
@end example

Include the above output in a mail generated with @code{mysqlbug} and
mail this to the general MySQL mailing list.
@xref{Mailing-list}.

If @code{mysqld} hangs you can try to use some system tools like
@code{strace} or @code{/usr/proc/bin/pstack} to examine where
@code{mysqld} has hung.

@example
strace /tmp/log libexec/mysqld
@end example

@findex DBI->trace
@findex trace DBI method
@tindex DBI_TRACE environment variable
@tindex Environment variable, DBI_TRACE
If you are using the Perl @code{DBI} interface, you can turn on
debugging information by using the @code{trace} method or by
setting the @code{DBI_TRACE} environment variable.


@node Using stack trace, Using log files, Using gdb on mysqld, Debugging server
@appendixsubsec Using a Stack Trace

On some operating systems, the error log will contain a stack trace if
@code{mysqld} dies unexpectedly. You can use this to find out where (and
maybe why) @code{mysqld} died. @xref{Error log}.  To get a stack trace,
you must not compile @code{mysqld} with the @code{-fomit-frame-pointer}
option to gcc. @xref{Compiling for debugging}.

If the error file contains something like the following:

@example
mysqld got signal 11;
The manual section 'Debugging a MySQL server' tells you how to use a
stack trace and/or the core file to produce a readable backtrace that may
help in finding out why mysqld died
Attemping backtrace. You can use the following information to find out
where mysqld died.  If you see no messages after this, something went
terribly wrong
stack range sanity check, ok, backtrace follows
0x40077552
0x81281a0
0x8128f47
0x8127be0
0x8127995
0x8104947
0x80ff28f
0x810131b
0x80ee4bc
0x80c3c91
0x80c6b43
0x80c1fd9
0x80c1686
@end example

you can find where @code{mysqld} died by doing the following:

@enumerate
@item
Copy the above numbers to a file, for example @file{mysqld.stack}.

@item
Make a symbol file for the @code{mysqld} server:
@example
nm -n libexec/mysqld > /tmp/mysqld.sym
@end example

Note that most MySQL binary distributions (except for the "debug" packages,
where this information is included inside of the binaries themselves)
already ship with the above file, named @code{mysqld.sym.gz}.
In this case you can simply unpack it by doing:

@example
gunzip < bin/mysqld.sym.gz > /tmp/mysqld.sym
@end example

@item
Execute @code{resolve_stack_dump -s /tmp/mysqld.sym -n mysqld.stack}.

This will print out where @code{mysqld} died. If this doesn't help you
find out why @code{mysqld} died, you should make a bug report and include
the output from the above command with the bug report.

Note however that in most cases it will not help us to just have a stack
trace to find the reason for the problem.  To be able to locate the bug
or provide a workaround, we would in most cases need to know the query
that killed @code{mysqld} and preferable a test case so that we can
repeat the problem!  @xref{Bug reports}.
@end enumerate


@node Using log files, Reproduceable test case, Using stack trace, Debugging server
@appendixsubsec Using Log Files to Find Cause of Errors in mysqld

Note that before starting @code{mysqld} with @code{--log} you should
check all your tables with @code{myisamchk}.
@xref{MySQL Database Administration}.

If @code{mysqld} dies or hangs, you should start @code{mysqld} with
@code{--log}.  When @code{mysqld} dies again, you can examine the end of
the log file for the query that killed @code{mysqld}.

If you are using @code{--log} without a file name, the log is stored in
the database directory as 'hostname'.log In most cases it's the last
query in the log file that killed @code{mysqld}, but if possible you
should verify this by restarting @code{mysqld} and executing the found
query from the @code{mysql} command-line tools. If this works, you
should also test all complicated queries that didn't complete.

You can also try the command @code{EXPLAIN} on all @code{SELECT}
statements that takes a long time to ensure that @code{mysqld} is using
indexes properly. @xref{EXPLAIN, , @code{EXPLAIN}}.

You can find the queries that take a long time to execute by starting
@code{mysqld} with @code{--log-slow-queries}. @xref{Slow query log}.

If you find the text @code{mysqld restarted} in the error log file
(normally named @file{hostname.err}) you have probably found a query
that causes @code{mysqld} to fail.  If this happens you should check all
your tables with @code{myisamchk} (@pxref{MySQL Database Administration}),
and test the queries in the MySQL log files to see if one doesn't
work.  If you find such a query, try first upgrading to the newest
MySQL version.  If this doesn't help and you can't find anything
in the @code{mysql} mail archive, you should report the bug to a MySQL
mailing list.
The mailing lists are described at
@uref{http://lists.mysql.com/}, which also has links to online
list archives.

If you have started @code{mysqld} with @code{myisam-recover},
MySQL will automatically check and try to repair @code{MyISAM}
tables if they are marked as 'not closed properly' or 'crashed'.  If
this happens, MySQL will write an entry in the
@code{hostname.err} file @code{'Warning: Checking table ...'} which is
followed by @code{Warning: Repairing table} if the table needs to be
repaired.  If you get a lot of these errors, without @code{mysqld} having
died unexpectedly just before, then something is wrong and needs to
be investigated further. @xref{Server options}.

It's not a good sign if @code{mysqld} did died unexpectedly,
but in this case one shouldn't investigate the @code{Checking table...}
messages but instead try to find out why @code{mysqld} died.


@node Reproduceable test case,  , Using log files, Debugging server
@appendixsubsec Making a Test Case If You Experience Table Corruption

If you get corrupted tables or if @code{mysqld} always fails after some
update commands, you can test if this bug is reproducible by doing the
following:

@itemize @bullet
@item
Take down the MySQL daemon (with @code{mysqladmin shutdown}).
@item
Make a backup of the tables (to guard against the very unlikely case that
the repair will do something bad).
@item
Check all tables with @code{myisamchk -s database/*.MYI}.  Repair any
wrong tables with @code{myisamchk -r database/table.MYI}.
@item
Make a second backup of the tables.
@item
Remove (or move away) any old log files from the MySQL data
directory if you need more space.
@item
Start @code{mysqld} with @code{--log-bin}. @xref{Binary log}.
If you want to find a query that crashes @code{mysqld}, you should use
@code{--log --log-bin}.
@item
When you have gotten a crashed table, stop the @code{mysqld server}.
@item
Restore the backup.
@item
Restart the @code{mysqld} server @strong{without} @code{--log-bin}
@item
Re-execute the commands with @code{mysqlbinlog update-log-file | mysql}.
The update log is saved in the MySQL database directory with
the name @code{hostname-bin.#}.
@item
If the tables are corrupted again or you can get @code{mysqld} to die with the
above command, you have found reproducible bug that should be easy to
fix! FTP the tables and the binary log to
@uref{ftp://support.mysql.com/pub/mysql/secret/} and enter it into
our bugs system at @uref{http://bugs.mysql.com/}.
If you are a support customer), you can also @email{support@@mysql.com} to
alert the MySQL team about the problem and have it fixed as soon as possible.
@end itemize

You can also use the script @code{mysql_find_rows} to just execute some of the
update statements if you want to narrow down the problem.


@node Debugging client, The DBUG package, Debugging server, Porting
@appendixsec Debugging a MySQL client

@cindex debugging, client
@cindex clients, debugging

To be able to debug a MySQL client with the integrated debug package,
you should configure MySQL with @code{--with-debug} or
@code{--with-debug=full}.  @xref{configure options}.

@tindex MYSQL_DEBUG environment variable
@tindex Environment variable, MYSQL_DEBUG
Before running a client, you should set the @code{MYSQL_DEBUG} environment
variable:

@example
shell> MYSQL_DEBUG=d:t:O,/tmp/client.trace
shell> export MYSQL_DEBUG
@end example

This causes clients to generate a trace file in @file{/tmp/client.trace}.

If you have problems with your own client code, you should attempt to
connect to the server and run your query using a client that is known to
work.  Do this by running @code{mysql} in debugging mode (assuming you
have compiled MySQL with debugging on):

@example
shell> mysql --debug=d:t:O,/tmp/client.trace
@end example

This will provide useful information in case you mail a bug report.
@xref{Bug reports}.

If your client crashes at some 'legal' looking code, you should check
that your @file{mysql.h} include file matches your mysql library file.
A very common mistake is to use an old @file{mysql.h} file from an old
MySQL installation with new MySQL library.


@node The DBUG package, Locking methods, Debugging client, Porting
@appendixsec The DBUG Package

@cindex DBUG package

The MySQL server and most MySQL clients are compiled
with the DBUG package originally made by Fred Fish.  When one has configured
MySQL for debugging, this package makes it possible to get a trace
file of what the program is debugging. @xref{Making trace files}.

One uses the debug package by invoking the program with the
@code{--debug="..."} or the @code{-#...} option.

Most MySQL programs has a default debug string that will be
used if you don't specify an option to @code{--debug}.  The default
trace file is usually @code{/tmp/programname.trace} on Unix and
@code{\programname.trace} on Windows.

The debug control string is a sequence of colon-separated fields
as follows:

@example
<field_1>:<field_2>:...:<field_N>
@end example

Each field consists of a mandatory flag character followed by
an optional "," and comma-separated list of modifiers:

@example
flag[,modifier,modifier,...,modifier]
@end example

The currently recognized flag characters are:

@multitable @columnfractions .05 .95
@item @strong{Flag} @tab @strong{Description}
@item d @tab Enable output from DBUG_<N> macros for the current state. May be followed by a list of keywords which selects output only for the DBUG macros with that keyword. An empty list of keywords implies output for all macros.
@item D @tab Delay after each debugger output line. The argument is the number of tenths of seconds to delay, subject to machine capabilities. That is, @code{-#D,20} is delay two seconds.
@item f @tab Limit debugging and/or tracing, and profiling to the list of named functions.  Note that a null list will disable all functions.   The appropriate "d" or "t" flags must still be given, this flag only limits their actions if they are enabled.
@item F @tab Identify the source file name for each line of debug or trace output.
@item i @tab Identify the process with the PID or thread ID for each line of debug or trace output.
@item g @tab Enable profiling.  Create a file called 'dbugmon.out' containing information that can be used to profile the program.  May be followed by a list of keywords that select profiling only for the functions in that list.  A null list implies that all functions are considered.
@item L @tab Identify the source file line number for each line of debug or trace output.
@item n @tab Print the current function nesting depth for each line of debug or trace output.
@item N @tab Number each line of dbug output.
@item o @tab Redirect the debugger output stream to the specified file.  The default output is stderr.
@item O @tab As @code{o} but the file is really flushed between each write. When needed the file is closed and reopened between each write.
@item p @tab Limit debugger actions to specified processes. A process must be identified with the DBUG_PROCESS macro and match one in the list for debugger actions to occur.
@item P @tab Print the current process name for each line of debug or trace output.
@item r @tab When pushing a new state, do not inherit the previous state's function nesting level. Useful when the output is to start at the left margin.
@item S @tab Do function _sanity(_file_,_line_) at each debugged function until _sanity() returns something that differs from 0. (Mostly used with safemalloc to find memory leaks)
@item t @tab Enable function call/exit trace lines. May be followed by a list (containing only one modifier) giving a numeric maximum trace level, beyond which no output will occur for either debugging or tracing macros.  The default is a compile time option.
@end multitable

Some examples of debug control strings which might appear on a shell
command-line (the "-#" is typically used to introduce a control string
to an application program) are:

@example
-#d:t
-#d:f,main,subr1:F:L:t,20
-#d,input,output,files:n
-#d:t:i:O,\\mysqld.trace
@end example

In MySQL, common tags to print (with the @code{d} option) are:
@code{enter},@code{exit},@code{error},@code{warning},@code{info} and
@code{loop}.


@node Locking methods, RTS-threads, The DBUG package, Porting
@appendixsec Locking methods

@cindex locking methods
@cindex methods, locking

Currently MySQL only supports table locking for
@code{ISAM}/@code{MyISAM} and @code{HEAP} tables,
page-level locking for @code{BDB} tables and
row-level locking for @code{InnoDB} tables.
@xref{Internal locking}.
With @code{MyISAM} tables one can freely mix @code{INSERT} and
@code{SELECT} without locks, if the @code{INSERT} statements are non-conflicting
(that is, whenever they append to the end of the table file rather than
filling freespace from deleted rows/data).

Starting in version 3.23.33, you can analyse the table lock contention
on your system by checking @code{Table_locks_waited} and
@code{Table_locks_immediate} environment variables.

To decide if you want to use a table type with row-level locking,
you will want to look at what the application does and what the
select/update pattern of the data is.

Pros for row locking:

@itemize @bullet
@item
Fewer lock conflicts when accessing different rows in many threads.
@item
Fewer changes for rollbacks.
@item
Makes it possible to lock a single row a long time.
@end itemize

Cons:

@itemize @bullet
@item
Takes more memory than page level or table locks.
@item
Is slower than page level or table locks when used on a big part of the table,
because one has to do many more locks.
@item
Is definitely much worse than other locks if you do often do @code{GROUP
BY} on a large part of the data or if one has to often scan the whole table.
@item
With higher level locks one can also more easily support locks of
different types to tune the application as the lock overhead is less
notable as for row level locks.
@end itemize

Table locks are superior to page level / row level locks in the
following cases:

@itemize @bullet
@item
Mostly reads
@item
Read and updates on strict keys; this is where one updates or deletes
a row that can be fetched with one key read:
@example
UPDATE table_name SET column=value WHERE unique_key#
DELETE FROM table_name WHERE unique_key=#
@end example
@item
@code{SELECT} combined with @code{INSERT} (and very few @code{UPDATE}
and @code{DELETE} statements).
@item
Many scans / @code{GROUP BY} on the whole table without any writers.
@end itemize

Other options than row / page level locking:

Versioning (like we use in MySQL for concurrent inserts) where
you can have one writer at the same time as many readers.  This means
that the database/table supports different views for the data depending
on when one started to access it. Other names for this are time travel,
copy on write or copy on demand.

Copy on demand is in many case much better than page or row level
locking; the worst case does, however, use much more memory than
when using normal locks.

Instead of using row level locks one can use application level locks
(like get_lock/release_lock in MySQL).  This works
only in well-behaved applications.

In many cases one can do an educated guess which locking type is best
for the application, but generally it's very hard to say that a given
lock type is better than another; everything depends on the application
and different part of the application may require different lock types.

Here are some tips about locking in MySQL:

Most web applications do lots of selects, very few
deletes, updates mainly on keys, and inserts in some specific tables.
The base MySQL setup is very well tuned for this.

Concurrent users are not a problem if you don't mix updates with selects
that need to examine many rows in the same table.

If you mix inserts and deletes on the same table, then @code{INSERT DELAYED}
may be of great help.

You can also use @code{LOCK TABLES} to speed up things (many updates within
a single lock is much faster than updates without locks).  Splitting
thing to different tables will also help.

If you encounter speed problems with the table locks in MySQL, you
may be able to solve these by converting some of your tables to @code{InnoDB}
or @code{BDB} tables.
@xref{InnoDB}. @xref{BDB}.

The optimization section in the manual covers many different aspects of
how to tune applications. @xref{Tips}.


@node RTS-threads, Thread packages, Locking methods, Porting
@appendixsec Comments about RTS threads

@cindex RTS-threads
@cindex threads, RTS

I have tried to use the RTS thread packages with MySQL but
stumbled on the following problems:

They use an old version of a lot of POSIX calls and it is very tedious to
make wrappers for all functions. I am inclined to think that it would
be easier to change the thread libraries to the newest POSIX
specification.

Some wrappers are already written. See @file{mysys/my_pthread.c} for more info.

At least the following should be changed:

@code{pthread_get_specific} should use one argument.
@code{sigwait} should take two arguments.
A lot of functions (at least @code{pthread_cond_wait},
@code{pthread_cond_timedwait()})
should return the error code on error. Now they return -1 and set @code{errno}.

Another problem is that user-level threads use the @code{ALRM} signal and this
aborts a lot of functions (@code{read}, @code{write}, @code{open}...).
MySQL should do a retry on interrupt on all of these but it is
not that easy to verify it.

The biggest unsolved problem is the following:

To get thread-level alarms I changed @file{mysys/thr_alarm.c} to wait between
alarms with @code{pthread_cond_timedwait()}, but this aborts with error
@code{EINTR}.  I tried to debug the thread library as to why this happens,
but couldn't find any easy solution.

If someone wants to try MySQL with RTS threads I suggest the
following:

@itemize @bullet
@item
Change functions MySQL uses from the thread library to POSIX.
This shouldn't take that long.
@item
Compile all libraries with the @code{-DHAVE_rts_threads}.
@item
Compile @code{thr_alarm}.
@item
If there are some small differences in the implementation, they may be fixed
by changing @file{my_pthread.h} and @file{my_pthread.c}.
@item
Run @code{thr_alarm}. If it runs without any ``warning'', ``error'' or aborted
messages, you are on the right track. Here is a successful run on
Solaris:
@example
Main thread: 1
Thread 0 (5) started
Thread: 5  Waiting
process_alarm
Thread 1 (6) started
Thread: 6  Waiting
process_alarm
process_alarm
thread_alarm
Thread: 6  Slept for 1 (1) sec
Thread: 6  Waiting
process_alarm
process_alarm
thread_alarm
Thread: 6  Slept for 2 (2) sec
Thread: 6  Simulation of no alarm needed
Thread: 6  Slept for 0 (3) sec
Thread: 6  Waiting
process_alarm
process_alarm
thread_alarm
Thread: 6  Slept for 4 (4) sec
Thread: 6  Waiting
process_alarm
thread_alarm
Thread: 5  Slept for 10 (10) sec
Thread: 5  Waiting
process_alarm
process_alarm
thread_alarm
Thread: 6  Slept for 5 (5) sec
Thread: 6  Waiting
process_alarm
process_alarm

...
thread_alarm
Thread: 5  Slept for 0 (1) sec
end
@end example
@end itemize


@node Thread packages,  , RTS-threads, Porting
@appendixsec Differences between different thread packages

@cindex thread packages, differences between

MySQL is very dependent on the thread package used. So when
choosing a good platform for MySQL, the thread package is very
important.

There are at least three types of thread packages:

@itemize @bullet
@item
User threads in a single process. Thread switching is managed with
alarms and the threads library manages all non-thread-safe functions
with locks. Read, write and select operations are usually managed with a
thread-specific select that switches to another thread if the running
threads have to wait for data.  If the user thread packages are
integrated in the standard libs (FreeBSD and BSDI threads) the thread
package requires less overhead than thread packages that have to map all
unsafe calls (MIT-pthreads, FSU Pthreads and RTS threads).  In some
environments (for example, SCO), all system calls are thread-safe so the
mapping can be done very easily (FSU Pthreads on SCO).  Downside: All
mapped calls take a little time and it's quite tricky to be able to
handle all situations. There are usually also some system calls that are
not handled by the thread package (like MIT-pthreads and sockets). Thread
scheduling isn't always optimal.
@item
User threads in separate processes. Thread switching is done by the
kernel and all data are shared between threads.  The thread package
manages the standard thread calls to allow sharing data between threads.
LinuxThreads is using this method.  Downside: Lots of processes. Thread
creating is slow. If one thread dies the rest are usually left hanging
and you must kill them all before restarting. Thread switching is
somewhat expensive.
@item
Kernel threads. Thread switching is handled by the thread library or the
kernel and is very fast. Everything is done in one process, but on some
systems, @code{ps} may show the different threads. If one thread aborts, the
whole process aborts. Most system calls are thread-safe and should
require very little overhead.  Solaris, HP-UX, AIX and OSF/1 have kernel
threads.
@end itemize

In some systems kernel threads are managed by integrating user
level threads in the system libraries. In such cases, the thread
switching can only be done by the thread library and the kernel isn't
really ``thread aware''.




@node Environment variables, Regexp, Porting, Top
@appendix Environment Variables

@cindex environment variables, list of

Here is a list of all the environment variables that are used directly or
indirectly by MySQL. Most of these can also be found in other
places in this manual.

Note that any options on the command-line take precedence over
values specified in configuration files and environment variables, and
values in configuration files take precedence over values in environment
variables.

In many cases it's preferable to use a configure file instead of environment
variables to modify the behavior of MySQL. @xref{Option files}.

@tindex CXX environment variable
@tindex Environment variable, CXX
@tindex CC environment variable
@tindex Environment variable, CC
@tindex CFLAGS environment variable
@tindex Environment variable, CFLAGS
@tindex CXXFLAGS environment variable
@tindex Environment variable, CXXFLAGS
@tindex DBI_USER environment variable
@tindex Environment variable, DBI_USER
@tindex DBI_TRACE environment variable
@tindex Environment variable, DBI_TRACE
@tindex HOME environment variable
@tindex Environment variable, HOME
@tindex LD_RUN_PATH environment variable
@tindex Environment variable, LD_RUN_PATH
@tindex MYSQL_DEBUG environment variable
@tindex Environment variable, MYSQL_DEBUG
@tindex MYSQL_HISTFILE environment variable
@tindex Environment variable, MYSQL_HISTFILE
@tindex MYSQL_HOST environment variable
@tindex Environment variable, MYSQL_HOST
@tindex MYSQL_PS1 environment variable
@tindex Environment variable, MYSQL_PS1
@tindex MYSQL_PWD environment variable
@tindex Environment variable, MYSQL_PWD
@tindex MYSQL_TCP_PORT environment variable
@tindex Environment variable, MYSQL_TCP_PORT
@tindex MYSQL_UNIX_PORT environment variable
@tindex Environment variable, MYSQL_UNIX_PORT
@tindex PATH environment variable
@tindex Environment variable, PATH
@tindex TMPDIR environment variable
@tindex Environment variable, TMPDIR
@tindex TZ environment variable
@tindex Environment variable, TZ
@tindex UMASK_DIR environment variable
@tindex Environment variable, UMASK_DIR
@tindex UMASK environment variable
@tindex Environment variable, UMASK
@tindex USER environment variable
@tindex Environment variable, USER

@multitable @columnfractions .25 .70
@item @strong{Variable} @tab @strong{Description}
@item @code{CXX}  @tab Set this to your C++ compiler when running configure.
@item @code{CC}  @tab Set this to your C compiler when running configure.
@item @code{CFLAGS} @tab Flags for your C compiler when running configure.
@item @code{CXXFLAGS} @tab Flags for your C++ compiler when running configure.
@item @code{DBI_USER} @tab The default username for Perl DBI.
@item @code{DBI_TRACE} @tab Used when tracing Perl DBI.
@item @code{HOME} @tab The default path for the @code{mysql} history file is @file{$HOME/.mysql_history}.
@item @code{LD_RUN_PATH} @tab Used to specify where your @file{libmysqlclient.so} is.
@item @code{MYSQL_DEBUG} @tab Debug-trace options when debugging.
@item @code{MYSQL_HISTFILE} @tab The path to the @code{mysql} history file.
@item @code{MYSQL_HOST} @tab Default hostname used by the @code{mysql} command-line client.
@item @code{MYSQL_PS1} @tab Command prompt to use in the @code{mysql} command-line client. @xref{mysql}.
@item @code{MYSQL_PWD} @tab The default password when connecting to @code{mysqld}. Note that use of this is insecure!
@item @code{MYSQL_TCP_PORT} @tab The default TCP/IP port.
@item @code{MYSQL_UNIX_PORT} @tab The default socket; used for connections to @code{localhost}.
@item @code{PATH} @tab Used by the shell to finds the MySQL programs.
@item @code{TMPDIR} @tab The directory where temporary tables/files are created.
@item @code{TZ} @tab This should be set to your local time zone. @xref{Timezone problems}.
@item @code{UMASK_DIR} @tab The user-directory creation mask when creating directories. Note that this is ANDed with @code{UMASK}!
@item @code{UMASK} @tab The user-file creation mask when creating files.
@item @code{USER} @tab The default user on Windows to use when connecting to @code{mysqld}.
@end multitable




@node Regexp, GPL license, Environment variables, Top
@appendix MySQL Regular Expressions

@cindex regex
@cindex regular expression syntax, described
@cindex syntax, regular expression

A regular expression (regex) is a powerful way of specifying a complex search.

MySQL uses Henry Spencer's implementation of regular
expressions, which is aimed at conformance with POSIX
1003.2. MySQL uses the extended version.

This is a simplistic reference that skips the details. To get more exact
information, see Henry Spencer's @code{regex(7)} manual page that is
included in the source distribution. @xref{Credits}.

A regular expression describes a set of strings. The simplest regexp is
one that has no special characters in it. For example, the regexp
@code{hello} matches @code{hello} and nothing else.

Non-trivial regular expressions use certain special constructs so that
they can match more than one string. For example, the regexp
@code{hello|word} matches either the string @code{hello} or the string
@code{word}.

As a more complex example, the regexp @code{B[an]*s} matches any of the
strings @code{Bananas}, @code{Baaaaas}, @code{Bs}, and any other string
starting with a @code{B}, ending with an @code{s}, and containing any
number of @code{a} or @code{n} characters in between.

A regular expression may use any of the following special
characters/constructs:
@table @code
@item ^
Match the beginning of a string.
@example
mysql> SELECT "fo\nfo" REGEXP "^fo$";           -> 0
mysql> SELECT "fofo" REGEXP "^fo";              -> 1
@end example
@item $
Match the end of a string.
@example
mysql> SELECT "fo\no" REGEXP "^fo\no$";         -> 1
mysql> SELECT "fo\no" REGEXP "^fo$";            -> 0
@end example
@item .
Match any character (including newline).
@example
mysql> SELECT "fofo" REGEXP "^f.*";             -> 1
mysql> SELECT "fo\nfo" REGEXP "^f.*";           -> 1
@end example
@item a*
Match any sequence of zero or more @code{a} characters.
@example
mysql> SELECT "Ban" REGEXP "^Ba*n";             -> 1
mysql> SELECT "Baaan" REGEXP "^Ba*n";           -> 1
mysql> SELECT "Bn" REGEXP "^Ba*n";              -> 1
@end example
@item a+
Match any sequence of one or more @code{a} characters.
@example
mysql> SELECT "Ban" REGEXP "^Ba+n";             -> 1
mysql> SELECT "Bn" REGEXP "^Ba+n";              -> 0
@end example
@item a?
Match either zero or one @code{a} character.
@example
mysql> SELECT "Bn" REGEXP "^Ba?n";              -> 1
mysql> SELECT "Ban" REGEXP "^Ba?n";             -> 1
mysql> SELECT "Baan" REGEXP "^Ba?n";            -> 0
@end example
@item de|abc
Match either of the sequences @code{de} or @code{abc}.
@example
mysql> SELECT "pi" REGEXP "pi|apa";             -> 1
mysql> SELECT "axe" REGEXP "pi|apa";            -> 0
mysql> SELECT "apa" REGEXP "pi|apa";            -> 1
mysql> SELECT "apa" REGEXP "^(pi|apa)$";        -> 1
mysql> SELECT "pi" REGEXP "^(pi|apa)$";         -> 1
mysql> SELECT "pix" REGEXP "^(pi|apa)$";        -> 0
@end example
@item (abc)*
Match zero or more instances of the sequence @code{abc}.
@example
mysql> SELECT "pi" REGEXP "^(pi)*$";            -> 1
mysql> SELECT "pip" REGEXP "^(pi)*$";           -> 0
mysql> SELECT "pipi" REGEXP "^(pi)*$";          -> 1
@end example
@item @{1@}
@itemx @{2,3@}
The is a more general way of writing regexps that match many
occurrences of the previous atom.
@table @code
@item a*
Can be written as @code{a@{0,@}}.
@item a+
Can be written as @code{a@{1,@}}.
@item a?
Can be written as @code{a@{0,1@}}.
@end table
To be more precise, an atom followed by a bound containing one integer
@code{i} and no comma matches a sequence of exactly @code{i} matches of
the atom. An atom followed by a bound containing one integer @code{i}
and a comma matches a sequence of @code{i} or more matches of the atom.
An atom followed by a bound containing two integers @code{i} and
@code{j} matches a sequence of @code{i} through @code{j} (inclusive)
matches of the atom.

Both arguments must be in the range from @code{0} to @code{RE_DUP_MAX}
(default 255), inclusive.  If there are two arguments, the second must be
greater than or equal to the first.
@item [a-dX]
@itemx [^a-dX]
Matches
any character which is (or is not, if ^ is used) either @code{a}, @code{b},
@code{c}, @code{d} or @code{X}. To include a literal @code{]} character,
it must immediately follow the opening bracket @code{[}.  To include a
literal @code{-} character, it must be written first or last. So
@code{[0-9]} matches any decimal digit. Any character that does not have
a defined meaning inside a @code{[]} pair has no special meaning and
matches only itself.
@example
mysql> SELECT "aXbc" REGEXP "[a-dXYZ]";         -> 1
mysql> SELECT "aXbc" REGEXP "^[a-dXYZ]$";       -> 0
mysql> SELECT "aXbc" REGEXP "^[a-dXYZ]+$";      -> 1
mysql> SELECT "aXbc" REGEXP "^[^a-dXYZ]+$";     -> 0
mysql> SELECT "gheis" REGEXP "^[^a-dXYZ]+$";    -> 1
mysql> SELECT "gheisa" REGEXP "^[^a-dXYZ]+$";   -> 0
@end example
@item [[.characters.]]
The sequence of characters of that collating element. @code{characters}
is either a single character or a character name like @code{newline}.
You can find the full list of character names in @file{regexp/cname.h}.

@item [=character_class=]
An equivalence class, standing for the sequences of characters of all
collating elements equivalent to that one, including itself.

For example, if @code{o} and @code{(+)} are the members of an
equivalence class, then @code{[[=o=]]}, @code{[[=(+)=]]}, and
@code{[o(+)]} are all synonymous. An equivalence class may not be an
endpoint of a range.

@item [:character_class:]
Within a bracket expression, the name of a character class enclosed in
@code{[:} and @code{:]} stands for the list of all characters belonging
to that class. Standard character class names are:

@multitable @columnfractions .10 .10 .10
@item @strong{Name} @tab @strong{Name} @tab @strong{Name}
@item alnum @tab digit @tab punct
@item alpha @tab graph @tab space
@item blank @tab lower @tab upper
@item cntrl @tab print @tab xdigit
@end multitable

These stand for the character classes defined in the @code{ctype(3)} manual
page. A locale may provide others. A character class may not be used as an
endpoint of a range.
@example
mysql> SELECT "justalnums" REGEXP "[[:alnum:]]+";       -> 1
mysql> SELECT "!!" REGEXP "[[:alnum:]]+";               -> 0
@end example

@item [[:<:]]
@itemx [[:>:]]
These match the null string at the beginning and end of a word
respectively.  A word is defined as a sequence of word characters which
is neither preceded nor followed by word characters. A word character is
an alnum character (as defined by @code{ctype(3)}) or an underscore
(@code{_}).
@example
mysql> SELECT "a word a" REGEXP "[[:<:]]word[[:>:]]";      -> 1
mysql> SELECT "a xword a" REGEXP "[[:<:]]word[[:>:]]";     -> 0
@end example
@end table

@example
mysql> SELECT "weeknights" REGEXP "^(wee|week)(knights|nights)$"; -> 1
@end example




@node GPL license, Function Index, Regexp, Top
@appendix GNU General Public License

@cindex GPL, General Public License
@cindex GPL, GNU General Public License

@center Version 2, June 1991

@display
Copyright @copyright{} 1989, 1991 Free Software Foundation, Inc.
59 Temple Place - Suite 330, Boston, MA  02111-1307, USA

Everyone is permitted to copy and distribute verbatim copies
of this license document, but changing it is not allowed.
@end display

@heading Preamble

  The licenses for most software are designed to take away your
freedom to share and change it.  By contrast, the GNU General Public
License is intended to guarantee your freedom to share and change free
software---to make sure the software is free for all its users.  This
General Public License applies to most of the Free Software
Foundation's software and to any other program whose authors commit to
using it.  (Some other Free Software Foundation software is covered by
the GNU Library General Public License instead.)  You can apply it to
your programs, too.

  When we speak of free software, we are referring to freedom, not
price.  Our General Public Licenses are designed to make sure that you
have the freedom to distribute copies of free software (and charge for
this service if you wish), that you receive source code or can get it
if you want it, that you can change the software or use pieces of it
in new free programs; and that you know you can do these things.

  To protect your rights, we need to make restrictions that forbid
anyone to deny you these rights or to ask you to surrender the rights.
These restrictions translate to certain responsibilities for you if you
distribute copies of the software, or if you modify it.

  For example, if you distribute copies of such a program, whether
gratis or for a fee, you must give the recipients all the rights that
you have.  You must make sure that they, too, receive or can get the
source code.  And you must show them these terms so they know their
rights.

  We protect your rights with two steps: (1) copyright the software, and
(2) offer you this license which gives you legal permission to copy,
distribute and/or modify the software.

  Also, for each author's protection and ours, we want to make certain
that everyone understands that there is no warranty for this free
software.  If the software is modified by someone else and passed on, we
want its recipients to know that what they have is not the original, so
that any problems introduced by others will not reflect on the original
authors' reputations.

  Finally, any free program is threatened constantly by software
patents.  We wish to avoid the danger that redistributors of a free
program will individually obtain patent licenses, in effect making the
program proprietary.  To prevent this, we have made it clear that any
patent must be licensed for everyone's free use or not licensed at all.

  The precise terms and conditions for copying, distribution and
modification follow.

@iftex
@heading TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION
@end iftex
@ifinfo
@center GNU GENERAL PUBLIC LICENSE
@center TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION
@end ifinfo

@enumerate 0
@item
This License applies to any program or other work which contains
a notice placed by the copyright holder saying it may be distributed
under the terms of this General Public License.  The ``Program'', below,
refers to any such program or work, and a ``work based on the Program''
means either the Program or any derivative work under copyright law:
that is to say, a work containing the Program or a portion of it,
either verbatim or with modifications and/or translated into another
language.  (Hereinafter, translation is included without limitation in
the term ``modification''.)  Each licensee is addressed as ``you''.

Activities other than copying, distribution and modification are not
covered by this License; they are outside its scope.  The act of
running the Program is not restricted, and the output from the Program
is covered only if its contents constitute a work based on the
Program (independent of having been made by running the Program).
Whether that is true depends on what the Program does.

@item
You may copy and distribute verbatim copies of the Program's
source code as you receive it, in any medium, provided that you
conspicuously and appropriately publish on each copy an appropriate
copyright notice and disclaimer of warranty; keep intact all the
notices that refer to this License and to the absence of any warranty;
and give any other recipients of the Program a copy of this License
along with the Program.

You may charge a fee for the physical act of transferring a copy, and
you may at your option offer warranty protection in exchange for a fee.

@item
You may modify your copy or copies of the Program or any portion
of it, thus forming a work based on the Program, and copy and
distribute such modifications or work under the terms of Section 1
above, provided that you also meet all of these conditions:

@enumerate a
@item
You must cause the modified files to carry prominent notices
stating that you changed the files and the date of any change.

@item
You must cause any work that you distribute or publish, that in
whole or in part contains or is derived from the Program or any
part thereof, to be licensed as a whole at no charge to all third
parties under the terms of this License.

@item
If the modified program normally reads commands interactively
when run, you must cause it, when started running for such
interactive use in the most ordinary way, to print or display an
announcement including an appropriate copyright notice and a
notice that there is no warranty (or else, saying that you provide
a warranty) and that users may redistribute the program under
these conditions, and telling the user how to view a copy of this
License.  (Exception: if the Program itself is interactive but
does not normally print such an announcement, your work based on
the Program is not required to print an announcement.)
@end enumerate

These requirements apply to the modified work as a whole.  If
identifiable sections of that work are not derived from the Program,
and can be reasonably considered independent and separate works in
themselves, then this License, and its terms, do not apply to those
sections when you distribute them as separate works.  But when you
distribute the same sections as part of a whole which is a work based
on the Program, the distribution of the whole must be on the terms of
this License, whose permissions for other licensees extend to the
entire whole, and thus to each and every part regardless of who wrote it.

Thus, it is not the intent of this section to claim rights or contest
your rights to work written entirely by you; rather, the intent is to
exercise the right to control the distribution of derivative or
collective works based on the Program.

In addition, mere aggregation of another work not based on the Program
with the Program (or with a work based on the Program) on a volume of
a storage or distribution medium does not bring the other work under
the scope of this License.

@item
You may copy and distribute the Program (or a work based on it,
under Section 2) in object code or executable form under the terms of
Sections 1 and 2 above provided that you also do one of the following:

@enumerate a
@item
Accompany it with the complete corresponding machine-readable
source code, which must be distributed under the terms of Sections
1 and 2 above on a medium customarily used for software interchange; or,

@item
Accompany it with a written offer, valid for at least three
years, to give any third-party, for a charge no more than your
cost of physically performing source distribution, a complete
machine-readable copy of the corresponding source code, to be
distributed under the terms of Sections 1 and 2 above on a medium
customarily used for software interchange; or,

@item
Accompany it with the information you received as to the offer
to distribute corresponding source code.  (This alternative is
allowed only for noncommercial distribution and only if you
received the program in object code or executable form with such
an offer, in accord with Subsection b above.)
@end enumerate

The source code for a work means the preferred form of the work for
making modifications to it.  For an executable work, complete source
code means all the source code for all modules it contains, plus any
associated interface definition files, plus the scripts used to
control compilation and installation of the executable.  However, as a
special exception, the source code distributed need not include
anything that is normally distributed (in either source or binary
form) with the major components (compiler, kernel, and so on) of the
operating system on which the executable runs, unless that component
itself accompanies the executable.

If distribution of executable or object code is made by offering
access to copy from a designated place, then offering equivalent
access to copy the source code from the same place counts as
distribution of the source code, even though third parties are not
compelled to copy the source along with the object code.

@item
You may not copy, modify, sublicense, or distribute the Program
except as expressly provided under this License.  Any attempt
otherwise to copy, modify, sublicense or distribute the Program is
void, and will automatically terminate your rights under this License.
However, parties who have received copies, or rights, from you under
this License will not have their licenses terminated so long as such
parties remain in full compliance.

@item
You are not required to accept this License, since you have not
signed it.  However, nothing else grants you permission to modify or
distribute the Program or its derivative works.  These actions are
prohibited by law if you do not accept this License.  Therefore, by
modifying or distributing the Program (or any work based on the
Program), you indicate your acceptance of this License to do so, and
all its terms and conditions for copying, distributing or modifying
the Program or works based on it.

@item
Each time you redistribute the Program (or any work based on the
Program), the recipient automatically receives a license from the
original licensor to copy, distribute or modify the Program subject to
these terms and conditions.  You may not impose any further
restrictions on the recipients' exercise of the rights granted herein.
You are not responsible for enforcing compliance by third parties to
this License.

@item
If, as a consequence of a court judgment or allegation of patent
infringement or for any other reason (not limited to patent issues),
conditions are imposed on you (whether by court order, agreement or
otherwise) that contradict the conditions of this License, they do not
excuse you from the conditions of this License.  If you cannot
distribute so as to satisfy simultaneously your obligations under this
License and any other pertinent obligations, then as a consequence you
may not distribute the Program at all.  For example, if a patent
license would not permit royalty-free redistribution of the Program by
all those who receive copies directly or indirectly through you, then
the only way you could satisfy both it and this License would be to
refrain entirely from distribution of the Program.

If any portion of this section is held invalid or unenforceable under
any particular circumstance, the balance of the section is intended to
apply and the section as a whole is intended to apply in other
circumstances.

It is not the purpose of this section to induce you to infringe any
patents or other property right claims or to contest validity of any
such claims; this section has the sole purpose of protecting the
integrity of the free software distribution system, which is
implemented by public license practices.  Many people have made
generous contributions to the wide range of software distributed
through that system in reliance on consistent application of that
system; it is up to the author/donor to decide if he or she is willing
to distribute software through any other system and a licensee cannot
impose that choice.

This section is intended to make thoroughly clear what is believed to
be a consequence of the rest of this License.

@item
If the distribution and/or use of the Program is restricted in
certain countries either by patents or by copyrighted interfaces, the
original copyright holder who places the Program under this License
may add an explicit geographical distribution limitation excluding
those countries, so that distribution is permitted only in or among
countries not thus excluded.  In such case, this License incorporates
the limitation as if written in the body of this License.

@item
The Free Software Foundation may publish revised and/or new versions
of the General Public License from time to time.  Such new versions will
be similar in spirit to the present version, but may differ in detail to
address new problems or concerns.

Each version is given a distinguishing version number.  If the Program
specifies a version number of this License which applies to it and ``any
later version'', you have the option of following the terms and conditions
either of that version or of any later version published by the Free
Software Foundation.  If the Program does not specify a version number of
this License, you may choose any version ever published by the Free Software
Foundation.

@item
If you wish to incorporate parts of the Program into other free
programs whose distribution conditions are different, write to the author
to ask for permission.  For software which is copyrighted by the Free
Software Foundation, write to the Free Software Foundation; we sometimes
make exceptions for this.  Our decision will be guided by the two goals
of preserving the free status of all derivatives of our free software and
of promoting the sharing and reuse of software generally.

@iftex
@heading NO WARRANTY
@end iftex
@ifinfo
@center NO WARRANTY
@end ifinfo

@item
BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY
FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW.  EXCEPT WHEN
OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES
PROVIDE THE PROGRAM ``AS IS'' WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED
OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  THE ENTIRE RISK AS
TO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU.  SHOULD THE
PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING,
REPAIR OR CORRECTION.

@item
IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR
REDISTRIBUTE THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES,
INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING
OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED
TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY
YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER
PROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.
@end enumerate

@iftex
@heading END OF TERMS AND CONDITIONS
@end iftex
@ifinfo
@center END OF TERMS AND CONDITIONS
@end ifinfo

@page
@heading How to Apply These Terms to Your New Programs

  If you develop a new program, and you want it to be of the greatest
possible use to the public, the best way to achieve this is to make it
free software which everyone can redistribute and change under these terms.

  To do so, attach the following notices to the program.  It is safest
to attach them to the start of each source file to most effectively
convey the exclusion of warranty; and each file should have at least
the ``copyright'' line and a pointer to where the full notice is found.

@smallexample
@var{one line to give the program's name and a brief idea of what it does.}
Copyright (C) @var{yyyy}  @var{name of author}

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
@end smallexample

Also add information on how to contact you by electronic and paper mail.

If the program is interactive, make it output a short notice like this
when it starts in an interactive mode:

@smallexample
Gnomovision version 69, Copyright (C) 19@var{yy} @var{name of author}
Gnomovision comes with ABSOLUTELY NO WARRANTY; for details type `show w'.
This is free software, and you are welcome to redistribute it
under certain conditions; type `show c' for details.
@end smallexample

The hypothetical commands @samp{show w} and @samp{show c} should show
the appropriate parts of the General Public License.  Of course, the
commands you use may be called something other than @samp{show w} and
@samp{show c}; they could even be mouse-clicks or menu items---whatever
suits your program.

You should also get your employer (if you work as a programmer) or your
school, if any, to sign a ``copyright disclaimer'' for the program, if
necessary.  Here is a sample; alter the names:

@example
Yoyodyne, Inc., hereby disclaims all copyright interest in the program
`Gnomovision' (which makes passes at compilers) written by James Hacker.

@var{signature of Ty Coon}, 1 April 1989
Ty Coon, President of Vice
@end example

This General Public License does not permit incorporating your program into
proprietary programs.  If your program is a subroutine library, you may
consider it more useful to permit linking proprietary applications with the
library.  If this is what you want to do, use the GNU Library General
Public License instead of this License.

@page



@node Function Index, Concept Index, GPL license, Top
@unnumbered SQL command, type and function index

@printindex fn

@page


@node Concept Index,  , Function Index, Top
@unnumbered Concept Index

@printindex cp





@bye
